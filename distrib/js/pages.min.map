{"version":3,"file":"pages.min.js","sources":["pages.js"],"names":["$","IX","ns","formFields","name","type","palceholder","clz","key","field","validators","notEmpty","message","stringLength","min","max","loginName","callback","val","length","valid","placeholder","mobile","FormFieldHT","IListManager","_","each","el","$XP","register","CommonLoginFormEls","split","MobileLoginFormEls","DynamicPWD","cfg","$btn","getParams","$XF","waitingTime","timmer","callServer","Hualala","Global","getMobileDynamicPWD","getDynamicPWD","cbFn","params","res","UI","TopTip","msg","button","waiting","count","setInterval","clearInterval","attr","tpl","str","replaceAll","text","bindEvent","unbind","on","hasClass","trigger","Common","AuthCode","container","$img","find","$progress","genAuthCode","toggleProgress","isShow","getAuthCode","code","setAuthCode","Date","getTime","setTimeout","e","target","init","genCode","Entry","initLogin","Stapes","subclass","constructor","this","$container","mode","loginCallServer","formKeys","formFieldHT","$subBtn","$authCode","authCode","$dinamicPWDBtn","dinamicPWD","progress","fvOpts","$formPanel","switchLoginMode","proto","self","parent","getByKeys","initValidFieldOpts","dynamicLoginCallServer","$dynamicPWDBtn","$groupName","$userMobile","bv","data","validateField","isValidField","els","getFormData","ret","v","k","initLoginForm","f","addClass","removeClass","groupName","bootstrapValidator","fields","$form","preventDefault","Debug","info","resultcode","document","location","href","PageRoute","createPath","delegate","validate","keyCode","$this","tabIdx","parseInt","blur","is","focus","jQuery","window","toptip","PopoverMsgTip","QueryModel","origCities","origAreas","origShops","isReady","getShopQuerySchema","initDataModel","cityHT","areaHT","shopHT","c","cid","shopLst","filter","s","areaLst","a","pluck","inherit","aid","sid","set","ds_city","ds_area","ds_shop","hasReady","getCities","ids","isEmpty","isString","ds","get","getShops","getShopsByAreaID","areaID","getAll","getShopsByCityID","cityID","getAreas","destroy","Shop","QueryView","needShopCreate","$queryBox","$filter","$query","loadTemplates","model","keywordLst","renderLayout","emit","getFilterParams","queryTpl","Handlebars","compile","TplLib","filterTpl","registerPartial","mapChosenShopData","cities","city","cityName","shops","push","items","map","shop","mapRenderLayoutData","filterCities","mapFilterData","queryChosenShops","shopCity","toggle","optGrp","chkCtrlRight","curPageRight","getCurPageUserRight","disabled","enabled","n","renderData","html","prepend","initShopChosenPanel","btn_all","focusClz","o","unshift","matcher","Pymatch","sections","getMatchedFn","searchText","setNames","shopName","matchedSections","match","matchedOptions","shopID","chosen","width","placeholder_text","no_results_text","allow_single_deselect","change","renderAreaFilter","remove","append","updateFilterCityLayout","updateFilterAreaLayout","getQueryParams","first","focusedBtn","QueryController","sessionData","getSessionData","resultController","view","reload","distory","query","pageNo","pageSize","load","CardListModel","pageCount","totalSize","ds_page","updatePagerParams","pagerParamkeys","indexOf","getPagerParams","updateDataStore","pageHT","shopIDs","mShop","BaseShopModel","resetDataStore","clear","getShopModelByShopID","updateShopStatus","status","failFn","successFn","updateShopBusinessStatus","id","switchShopStatusCallServer","switchShopStatus","switchShopBusinessStatusCallServer","switchShopServiceFeatureStatus","switchShopBusinessStatus","setServiceFeature","sName","serviceFeatures","join","operation","switchBusinessStatus","setServiceParams","serviceID","strType","newData","revParamJson","takeawayParamJson","JSON","parse","stringify","checkSpotOrder","replace","concat","CardListView","$resultBox","$list","$pager","emptyBar","initLayout","layoutTpl","htm","initPager","baseCfg","total","page","maxVisible","leaps","IXPager","tooltip","selector","path","listTpl","itemTpl","tagTpl","mapTags","d","tagKeys","tags","t","mapRenderData","getTags","tag","address","byteLen","strByteLength","slugAddr","substrByte","img","getSourceImage","height","quality","tel","infoHref","menuHref","checked","shopCard","list","initSwitcher","bootstrapSwitch","size","onColor","offColor","onText","offText","state","$chkbox","Confirm","title","okFn","_shopID","cancelFn","render","pagerParams","empty","EmptyPlaceholder","show","ShopListView","shopBusinessSwitcherTipHT","initShopBusinessSwitcherTips","businessName","businessID","initBusinessModal","settleID","initBindSettleModal","tips","TypeDef","ShopBusinessSwitcherTips","tip","getBusinessSwitcherTipsByName","ht","getBusinessDesc","operationMode","businessInfo","renderKeys","minuteIntervalOpts","MinuteIntervalOptions","getMinutIntervalLabel","m","businessStatus","getBusinessSwitcherStatus","businessDesc","r","Constants","CashUnit","object","slice","lastIndexOf","getShopBusiness","business","ShopBusiness","businessHT","businessCfg","item","switcherStatus","toString","desc","mapBusinessRenderData","icon","switcherName","open","label","hideBtn","chkHasAccountRole","loginUsr","getSessionUser","usrRoles","roles","SiteRoleType","role","roleType","matchedID","settleUnitID","hideAccount","settleName","btn","shopOpen","shopItem","$switchers","changeSubSwitchersStatus","idx","$el","$parentSwitcher","$switcherEl","$subSwitchers","businessSwitcherTip","businessData","curBusinessData","parents","Setting","editServiceView","triggerEl","serviceName","$trigger","bindSettleUnitView","settleInfo","settleUnitName","LoadingModal","ShopListController","ShopListModel","loadingModal","start","hide","reloadPager","ShopMap","options","extend","defaults","sContent","$searchBox","searchBox","$mapResult","mapResult","mapPoint","isAreaSearched","isSearchMap","keyword","area","lng","lat","mapCanvasId","serach","prototype","mapParams","BMap","Map","addControl","NavigationControl","enableScrollWheelZoom","$keyword","$searchBtn","searchParams","trim","searchMap","loadMap","centerAndZoom","Point","marker","Marker","enableMassClear","raiseOnDrag","enableDragging","addOverlay","openInfoWindow","InfoWindow","addEventListener","setResult","point","local","LocalSearch","renderOptions","pageCapacity","onInfoHtmlSet","poi","onMarkersSet","search","setSearchCompleteCallback","getStatus","BMAP_STATUS_SUCCESS","Alert","setMarkersSetCallback","pois","i","pos","getPosition","initCuisines","$cuisine1","$cuisine2","G","getCuisines","rsp","resultmsg","topTip","siblings","U","createChosen","records","cuisineID","cuisineName","initAreas","$selectBox","areaName","initCities","isActive","getSelectText","$select","initCreate","$wizard","bootstrapWizard","bsWizard","$step1","$step2","$step3","$city","$area","operationModeType","Typedef","fillSelect","timepicker","minuteStep","showMeridian","disableFocus","showInputs","excluded","telOrMobile","PCCL","numeric","openingHoursStart","time","openingHoursEnd","startTimeField","cuisineID1","$uploadImg","imagePath","IMAGE_ROOT","uploadImg","onSuccess","imgPath","$dlg","src","IMAGE_RESOURCE_DOMAIN","modal","dataStep1","$shopSettingLink","$curStep","activePane","isValid","parseForm","cuisineName1","cuisineName2","cuisineID2","openingHours","keywords","updateShopBaseInfo","createShop","eq","next","mapInfo","mapLongitudeValue","mapLatitudeValue","mapLongitudeValueBaiDu","mapLatitudeValueBaiDu","setShopMap","updateReadMode","not","$p","shopInfo","S","initInfo","pageType","$shopFuncNav","createShopFuncNav","imgHost","getShopInfo","createShopInfoHead","$shopInfoHead","before","openTime","operationModeName","appendTo","$target","coords","formData","console","log","shopData","throttle","method","context","clearTimeout","tId","call","initMenu","initFoodChosen","foods","foodName","foodID","$foodName","searchFood","scrollFood","viewBottom","scrollTop","foodsBottom","$foods","offset","top","current","renderFoods","previewImg","fileInput","files","reader","FileReader","onload","result","readAsDataURL","$checked","$chekbox","takeawayTag","$takeawayTag","isHasImage","filterFoods","$foodCount","foodTpl","findFood","cfs","classifiedFoods","foodClass","foodCategoryID","apply","p","grep","food","classifyFoods","foodsData","l","foodCategoryName","updateFood","takeoutPackagingFee","parseFloat","prePrice","price","vipPrice","unit","inAarry","units","imgePath","hwp","imageHWP","w","Math","round","h","imgSrc","imgRoot","discountIco","isDiscount","takeawayIco","activeIco","foodIsActive","arr","obj","foodParams","ef","editFoodTpl","$menu","$foodClass","$foodSearch","$editFood","modalEditFood","getShopMenu","$alert","$foodClassBox","category","foodNameTpl","closest","$foodPic","submit","imgCallback","json","parseJSON","url","foodIcos","foodPic","hotTag1","hotTag2","hotTag3","ModalDialog","hideCloseBtn","footer","minOrderCount","integer","between","foodIco","prop","param","$foodIco","tasteList","0","1","2","fn","tplData","shopUrl","getShopUrl","shopListLink","resetPwdTpl","$resetPwdForm","sizeCls","$feedback","$feedbackIcon","$errMsg","$pwd","toggleClass","setShopClientPwd","hLLAgentLoginPWD","isPlainObject","currentPageName","shopFuncs","R","$ul","shopFunc","getPageLabelByName","initShopList","$body","queryShop","HomePageInit","initShopBaseInfoMgr","BreadCrumb","hideRoot","nodes","getParentNamesByPath","BaseInfoMgrInit","initFoodMenuMgr","FoodMenuMgrInit","initCreateShop","$shopCreateWizard","pcClientPath","CreateShopInit","ServiceFormElsCfg","advanceTime","defaultVal","validCfg","noticeTime","getMinuteIntervalOptions","startLabel","minAmount","prefix","surfix","greaterThan","inclusive","value","serviceAmount","freeServiceAmount","holidayFlag","HolidayFlagOptions","openDays","digits","servicePeriods","group","reserveTableTime","reserveTableDesc","takeawayDeliveryAgent","takeawayDeliveryTime","takeawayScope","takeawayScopeDesc","submitSMSTemplateID","checkSMSTemplateID","payMethod","PayMethodOptions","needInputTableName","onLabel","offLabel","supportInvoice","supportCommitToSoftware","payMethodAtShop","PayMethodAtShopOptions","payBeforeCommit","PayBeforeCommitOptions","fetchFoodMode","FetchFoodModeOptions","ServiceFormElsHT","labelClz","minID","maxID","minName","maxName","serviceList","serviceInfo","getServiceInfo","isFn","nsExisted","getNS","formParams","initModal","renderForm","btnTpl","registerHelper","conditional","hash","inverse","getModalTitle","afterRemove","body","initTimePicker","showSeconds","servData","dialog","act","serializeForm","decodeTimeStr","substr","encodeTimeStr","mapServiceFormElsData","formEls","elCfg","op","selected","formClz","btns","getSettleUnitsCallServer","queryAccount","bindSettleUnitCallServer","bindSettleUnitByShopID","$footer","origSettleData","itemID","curSettleUnit","settle","bindItems","oldSettleID","settleUnitNameLabel","settleList","initShopMgr","ShopMgrInit","AccountListModel","transCreateBeginTime","transCreateEndTime","transStatus","transType","groupID","minTransAmount","maxTransAmount","ds_account","accountHT","accountIDs","account","mAccount","BaseAccountModel","getAccounts","getAccountModelByID","accountID","Account","getSessionSite","withdrawCash","poundageAmount","poundageMinAmount","transAmount","settleBalance","newSettleBalance","sub","delete","deleteAccount","edit","editAccount","add","addAccount","AccountTransListModel","queryAccountTransDetail","ds_trans","transHT","transIDs","trans","transID","mTrans","BaseTransactionModel","getDataByPageNo","getModelByID","AccountQueryShopModel","getAccountQueryShop","AccountQueryShopResultModel","origData","dataStore","initDataStore","end","_shop","ceil","AccountListView","bindCardEvent","settleAccountID","WithdrawCashView","parentView","updateSettleBalance","hasDefault","bankInfo","mapBankInfo","bankAccountStr","codeMask","disableWithdraw","bankIcon","bankComName","shopCount","accountCard","accounts","refresh","mapPoundageAmountStr","mapPoundageMinAmountStr","mapFormElsData","accountInfoKeys","warningTextTpl","warningText","accountInfo","valStr","lessThan","accuracy","QueryTransFormElsCfg","transCreateTime","FSMTransStatus","FSMTransType","QueryTransFormElsHT","TransResultCols","AccountTransListView","$queryForm","tableTpl","tblClz","tblHeaders","cols","colClz","thead","rows","initQueryEls","bindQueryEvent","datetimepicker","format","startDate","autoclose","minView","todayBtn","todayHighlight","language","$picker","prev","orderKey","orderID","AccountTransDetailModal","getQueryFormParams","serializeArray","getDateByFormat","mapTimeData","s1","mapTransStatus","mapTransType","types","mapCashData","prettyNumeric","standardPrice","mapTransChanged","transSalesCommission","transPoundage","transChanged","mapColsRenderData","row","colKeys","col","transactionCost","hideBtnTransType","btnClz","SUATransItemID","colCount","results","AccountQueryShopView","AccountQueryShopResultView","shopTable","AccountListController","AccountQueryShopController","resultContainer","AccountQueryShopResultController","AccountMgrController","transaDetailCtrl","TransactionDetailController","AccountActs","AccountMgrView","$nav","breadCrumbs","$schema","$detail","initBreadCrumbs","parentNames","clickFn","isLastNode","shift","schemaTpl","withDrawTpl","withdraw","queryShops","AccountEditView","AccountQueryShopModal","okLabel","acts","acts1","clone","isDetail","_act","isFirst","AccountEditFormElsCfg","receiverType","AccountReceiverTypes","receiverName","bankAccount","bankCode","BankOptions","bankName","remark","defaultAccount","helpClz","help","receiverLinkman","receiverMobile","receiverEmail","emailAddress","AccountEditFormElsHT","ops","resetBankCode","$combo","$bankNameIcon","queryCtrl","initQueryBox","PersonUnit","getOrderSubTypeLabel","orderSubType","getGenderLabel","GENDER","mapUserFields","fieldType","userSex","_fields","fieldLabelCfg","OrderPayFieldLabelLib","mapOrderFields","orderSubTypeLabel","formatDateTimeValue","isAlreadyPaid","orderStatus","mapPayFields","mapFoodsFields","dishes","categories","groupBy","dish","cate","foodCategorySum","_dishes","_dish","prettyPrice","userName","userLoginMobile","orderCheckPWD","person","timeName","tableName","shopOrderKey","orderTime","orderCreateTime","statusName","takeoutAddress","consumptionTypeName","promotionDesc","orderRemark","foodAmount","paidAmount","promotionTotalAmount","discountAmount","freeAmount","giftAmount","presentInfo","cardDiscountAmount","pointBalance","moneyBalance","takeoutPackagingAmount","orderTotal","orderRefundAmount","shopTel","foodPrice","OrderPayDetailElsCfg","userFields","mapFn","orderFields","payFields","foodsFields","transTypes","transTypeHT","initTransTypeLib","tplName","callServerName","queryKeys","mapQueryParams","mapOrderPayDetail","fieldsets","fieldCfg","pick","printDetail","content","mapFsmCustomerDetail","settleUnitDetail","customerCard","transTypeLabel","acc","cashKeys","last","_k","initAccountListPage","accountListPanel","initAccountMgrPage","ctx","getPageContextByPath","accountModel","mgrView","AccountMgrInit","AccountListInit","OrderQueryResultModel","statisticKeys","pagerKeys","queryParamsKeys","hasPager","recordModel","BaseOrderRecordModel","initQueryParams","ds_record","ds_statistic","recordHT","recordIDs","mRecord","__id__","updateStatisticDataStore","statisticHT","getRecordsByPageNo","getRecordModelByID","getCityByCityID","getStatisticData","Order","order","OrderQueryTableHeaderCfg","OrderQueryDuringTableHeaderCfg","OrderQueryDishHotTableHeaderCfg","OrderQueryUserTableHeaderCfg","mapColItemRenderData","rowIdx","colKey","pageName","getGender","_shortName","getOrderStatus","div","link","endDate","mapQueryOrderResultRenderData","statisticData","ftCols","rowspan","colspan","tfoot","mapQueryOrderDuringRenderData","mapQueryDishesHotRenderData","mapQueryUserRenderData","renderQueryOrderResult","$result","OrderQueryResultView","loadTemplate","resultTpl","arguments","renderRecords","renderFn","OrderListController","queryVals","vals","QueryFormElsCfg","OrderStatus","userMobile","QueryFormElsHT","mapOrderQueryFormRenderData","mapOrderQueryBaseFormRenderData","mapDishesHotQueryFormRenderData","mapUsersQueryFormRenderData","comboOptsTpl","initQueryFormEls","initCityComboOpts","initShopComboOpts","initChosenPanel","_cfg","chosenPanelCfg","changeFn","py","curCityID","optTpl","opts","sectionsData","chosenCityID","curShopID","initOrderPageLayout","mapNavRenderData","curDateStamp","toText","navs","OrderSubNavType","active","navTpl","$navbar","initOrderChartPage","pageCfg","pkeys","initQueryOrderPage","$pageBody","findWhere","queryOrderDetail","mapResultRenderData","renderResult","mapRenderDataFn","initQueryOrderDayDetailPage","queryOrderDayDetail","initQueryOrderDuringDetailPage","queryOrderDuringDetail","initQueryOrderDishesHotPage","queryOrderDishesHot","initQueryOrderCustomerPage","queryUserOrderStatistic","OrderPageLayoutInit","OrderChartInit","QueryOrderInit","QueryOrderByDayDetailInit","QueryOrderByDuringDetailInit","QueryOrderDishesHotInit","QueryOrderCustomerInit","BaseUserFormElsCfg","loginPWD","noChinese","plainPWD","userRemark","userEmail","accountStatus","roleBinding","bindedMobile","loadingText","dynamicCode","BaseUserFormElsHT","ResetPWDFormKeys","BaseUserFormKeys","RoleBindingFormKeys","BindMobileFormKeys","ResetPWDView","evtType","initBaseCfg","initUIComponents","getViewMode","resetPWDModal","closeModal","renderBtns","User","UserBaseInfoView","userBaseInfoModal","UserBindMobileView","hidden","mobileBinded","dynamicPWD","groupLoginName","UserRoleView","userRoleModal","mapRoleBindingElsData","binded","roleDesc","btnLabel","disabledBtn","updateRoleBindStatus","mUser","roleInfo","getRoleInfoByType","$chk","updateRoleBind","bindModal","BindShopModal","mutiSelect","BindSettleAccountModal","BindShopMultiModal","WizardCfg","WizardCtrls","CreateUserModal","wizardID","BaseUserModel","stepViewHT","renderWizardLayout","initWizard","enableGoToNextStep","backdrop","showFooter","afterHide","mapWizardLayoutData","stepNavs","steps","step","getTabContentIDByIndex","$navBar","$tab","initUserBaseInfoView","cntID","viewMode","stepView","switchWizardCtrlStatus","getNextStep","initResetPWDView","initUserRoleView","commitUserInfo","$cnt","commitStep","tabClass","nextSelector","previousSelector","finishSelector","onTabClick","onInit","nIdx","onNext","$curNav","$curTab","curID","onPrevious","onTabChange","cIdx","nextID","$nextCnt","nextView","onTabShow","onFinish","getPrevieousStep","curIdx","PanelGroupCfg","panelClz","expanded","UserMgrModal","$btnGrp","curPanelName","userModel","$bindMobilePanel","$resetPWDPanel","panelGrpHT","initUserModel","bindBtnGrpEvent","userData","updateCurPanelName","curTarget","mapLayoutRenderData","panelGrpID","panels","renderPanelGrpLayout","renderModalBtns","undelegate","QueryShopController","itemsCache","querySettleCallServer","updateItemsCache","cache","without","updateRoleItemsBind","queryModel","collapseBtnTpl","chkShopBinded","mapShopTree","mapShopData","curShopLst","checkedCount","nodeClz","nodeType","parentID","hideCollapse","unBinded","reject","mapAreaData","curAreaLst","areas","_queryModel","bindParentNode","pID","$pEl","$childEls","unCheckEls","$chkBox","$icon","collapsed","getBindItems","$els","UserListModel","queryID","ds_user","userHT","user","removeUsers","isArray","unregister","getUsers","users","getUserModelByUserID","userID","getUserModelByUserLoginName","addItem","resetPWDCallServer","resetPWDInShopGroupChildAccount","editUserCallServer","updateShopGroupChildAccount","addUserCallServer","addShopGroupChildAccount","removeCallServer","removeShopGroupChildAccount","unbindMobileCallServer","unbindMobileInShopGroupChildAccount","bindMobileCallServer","bindMobileInShopGroupChildAccount","updateRoleBindingCallServer","updateRoleBinding","queryRoleBindingCallServer","queryRoleBinding","updateUserModel","updateRoleStore","roleCfg","roleHT","roleTypes","siteRoleType","_r","getRoleBindings","addUser","postParams","editUser","resetPWD","editRole","postData","unbindMobile","bindMobile","QueryShopResultModel","UserCtrlBtns","UserListView","$queryBar","$emptyBar","ctrlTpl","roleBindingTpl","mapUserStatusLabel","UserStatus","mapListRenderData","mapItemRenderData","userItem","oUserStatus","accountStatusClz","mobileIsBinded","accountStatusLabel","cellClz","mapChosenUserData","rerenderUser","$tr","prependTo","after","renderQueryPanel","queryChosenUsers","$oldQueryBar","mapUserBtns","sessionUser","sessionLoginName","renderUserCtrl","$ctrlBar","o1","css","display","right","animate","$otherCtrls","initReviewRoleModal","initSetRoleModal","initResetPWDModal","initUserBaseInfoModal","$curTR","initCreateUserModal","moveToTarget","$tar","smoothScrollMiddle","resetPWDView","userBaseInfoView","userRoleView","renderRoleBinding","shopSchemaModel","settleData","accountName","_items","matched","click","getShopsData","shopQueryModel","getSettleData","createUserView","QueryShopResultView","shopNameLabel","viewCfg","UserListController","QueryShopResultController","reset","initUserMgrPage","queryShopGroupChildAccount","UserListInit","BaseChartTitle","subtext","x","y","textAlign","BaseChartTooltip","formatter","BaseChartToolBox","feature","mark","dataView","readOnly","restore","saveAsImage","BaseChartLegend","orient","MemberSchemaChartConfigs","chartClz","CRM","MemberSchemaTableHeaderConfigs","MemberSchemaModel","queryCrmMemberSchema","ds_member","memberSummarize","memberHT","summarize","members","cardLevelName","getMemberByLevelNames","names","getLevelChartData","getGenderChartData","summary","genders","getSourceChartData","sources","MemberSchemaView","$tableBox","$chartBox","chartsCfg","charts","mapTableRenderData","memberData","tableHeader","colNames","math","mapColData","member","mapCardLevelTip","isVipPrice","discountRate","multi","discountRange","discountDescription","switchLevelUpPoint","tableRenderData","tblTpl","Net","loadJsFiles","ECHART_PATH","$box","oChart","echarts","showLoading","effect","renderChart","cfgs","legendCfg","toolboxCfg","tooltipCfg","titleCfg","tipTitle","chartOptions","opt","levels","series","legend","toolbox","calculable","radius","center","option","$chart","hideLoading","setOption","hideLoadingModal","showLoadingModal","MemberSchemaController","loaded","loading","formatDate","dateStr","initParams","$crm","$vipServiceTel","$vipServiceRemark","$p1","$p2","getCrmParams","site","crmParams","serviceStartTime","serviceEndTime","pointClearDate","isPointCanPay","vipServiceTel","vipServiceRemark","setCrmParams","initVipLevels","renderTbody","keys","trs","keyInfo","meta","Meta","$cell","Funcs","$table","C","formatDateStr","icos","date","number","$td","ico","toFixed","description","pointRate","actionTime","$headTR","ths","getVipLevels","filterVipLevels","level","getSetById","sets","saveMoneySetID","preProcessSets","createSwitch","$checkbox","setID","stateText","switchCrmRechargeSetState","rs","initRecharge","renderSets","getCrmRechargeSets","crmRechargeSetsTpl","renderDialog","setId","isAdd","undefined","dTitle","levelID","switchCardLevelID","$editSet","editSetTpl","vipLevelTpl","setName","setSaveMoney","returnMoney","returnPoint","submitSet","renderCrmQueryTable","$tbody","staticData","crmQueryTableKeys","icoOk","j","cardNO","test","M","isMobileChecked","queryCrm","formatPostDate","CrmTypeDef","tplLib","cardStatus","customerSex","sourceWay","crmQueryTableHeads","initQuery","$levels","slideToggle","args","createTimeStart","createTimeEnd","initDetail","cardID","renderCrmDetail","photoImage","defaultAvatar","$basicInfo","$div","basicInfo","renderCrmTransDetail","$theadTR","$trans","transDetail","renderCrmUserEvents","$events","event","eventWay","getEventNews","winFlag","way","flag","renderCrmUserGifts","$gifts","gift","renderCrmCardLogs","$logs","cardLog","logType","getData","customerName","customerBirthday","createTime","createShopName","customerMobile","giveBalance","saveMoneyTotal","pointGetTotal","consumptionTotal","consumptionCount","lastConsumptionTime","transTime","transShopName","consumptionAmount","moneyChange","pointChange","transAfterMoneyBalanceSum","transAfterPointBalance","transRemark","eventName","eventNews","giftName","getWay","giftStatus","usingShopName","usingTime","validUntilDate","operator","$tpl","initPreferential","submitPref","cpref","updateCrmPreferential","$ctr","replaceWith","createPrefTR","findPref","prefs","inArray","renderCrmPreferential","pref","stateIco","getCrmPreferential","discountType","pointType","action","$crmPref","createSchemaChosen","tplForm","fpref","renderThead","$thead","$th","newRow","sort","ignore","module","queryStartTime","queryEndTime","sumRecords","datasets","sumSets","$tfoot","fkeys","transRecords","initModule","$mbody","sumWay","today","$well","tplWell","tplTable","$sort","sortClass","orderBy","-1","TransSum","TransDetail","CardSum","RechargeSum","viewDetail","sum","initTransSum","shopCharge","shopConsumption","shopChargeCount","shopChargeSum","shopChargeGiftSum","shopChargeReturnPointSum","shopConsumptionCount","shopconsumptionAmountSum","shopMinusMoneySum","shopConsumeDeductPointSum","shopConsumptionReturnPointSum","initTransDetail","transCount","moneyChangeSum","pointChangeSum","transReceiptsTxt","initCardSum","curMonth","getMonth","month","curMonthCardCount","cardCount","useableCardCount","initRechargeSum","saveMoneyCount","saveMoneyAmountSum","saveReturnMoneyAmountSum","rechargeWay","saveMoneyCashSum","saveMoneyCardSum","saveMoneyCheckSum","saveMoneyOtherSum","saveMoneyOnlineChargeSum","initCRMPageLayout","subNavCfg","initCRMHomePage","CRMMemberSubNavType","initMemberSchema","initQueryMember","initMemberDetail","initCardStatistic","initDealSummary","CRMDealSubNavType","initDealDetail","initRechargeReconciliation","initCRMSettingsParams","CRMParamsSubNavType","initCRMSettingsLevels","initRechargePackageBusiness","initShopSpecialPrice","CRMPageLayoutInit","CRMHomePageInit","MemberSchemaInit","QueryMemberInit","MemberDetailInit","CardStatisticInit","DealSummaryInit","DealDetailInit","RechargeReconciliationInit","CRMSettingsParamsInit","CRMSettingsLevelsInit","RechargePackageBusinessInit","ShopSpecialPriceInit","Weixin","initReply","mpID","deleteReply","deleteWeixinAutoReplyRole","replies","splice","findReply","renderReplies","getReplies","submitReply","reply","$replyForm","resourceID","resources","replyContent","resTitle","pushMsgType","replyMsgType","resType","resourceVaule","pReply","queryParams","getWeixinAutoReplyList","pushMsg","pushContentType","pushContent","emptyAlert","tplTr","W","$queryReply","tplReplyForm","$resView","createResourceChosen","done","initSubscribe","$subscribe","$save","subscribe","pushEvent","getWeixinSubscribe","subsc","getMenus","record","menuJson","menuObj","menu","menus","renderMenu","dls","softType","softWenChoose","sm","$dl","dt","subMenus","sub_button","dd","$menuWrap","$noMenuTip","selectedMenu","resovleMenuClick","toAction","addMenu","menuCount","editMenuTpl","menuType","$input","importMenu","$buttons","loadData","always","resetButtons","saveMenu","procPostMenuData","publishMenu","removeAttr","_menus","menuInfo","getMenuInfo","methodName","methods","$menuHover","$menuClick","index","from","to","actionName","$actions","fadeIn","showTip","$showTip","chooseAction","sendMsg","resID","$resWrap","resSelect","saveMsg","pres","toPage","createLinkSelector","$selectWrap","$contentWrap","dataHolder","saveLink","$cont","cont","scanCode","addSubMenu","subMenuCount","subMenu","editMenu","deleteMenu","moveMenuUp","temp","moveMenuDown","maxIndex","$pageCont","initAdvertorial","getAds","ads","$headBtn","$article","$loading","renderAds","adTpl","addAd","$adCont","ad","$adSubTitle","sGroupName","adEditor","setContent","editAd","delAd","disBtn","resetBtn","saveAd","getContent","saveAction","updateAd","createAd","_ad","concelEdit","$adTitle","$adPreview","UM","delEditor","emotions","getEmotions","toolbar","extendUM","getEditor","initContent","checkResItem","resItem","$linkCont","noLinkCont","digest","editCont","resArr","resContent","activeRes","$resEdit","resEditTpl","$resForm","$resTitle","$resDigest","createResourceView","$activeRes","resTypeContent","urlOrCity","imgUpload","imgHWP","replaceStr","imgUrl","submitFunc","updateCont","createCont","_cont","isMul","$icoDel","$addSubRes","maxMutilContSize","$res","pop","$lastMask","resSubTpl","$mask","resetConts","isLoaded","allConts","$cols","renderConts","$noCont","deleteCont","scrollConts","isLoading","loadConts","limitBottom","$win","fallBottom","$fall","isAnimated","conts","_conts","colArr","resActionTpl","mod","queueAnimation","elems","opacity","scroll","layout","$_cols","getCols","3","4","off","$me","initText","getTxts","$txts","txts","isAllLoaded","txt","txtCont","parseEmotions","txtsTpl","editTxt","$txt","$txtTitle","txtEditor","$editNavTitle","$viewing","$editing","delTxt","addTxt","saveTxt","filterTxt","_txt","updateTxt","createTxt","contents","nodeValue","nodeName","toLowerCase","alt","innerHTML","execCommand","actions","getLinkTypes","subTitle","api","urlTpl","firstItem","eventStatus","gameWay","initWeixinPageLayout","renderWxAcountInfo","insertAfter","sessionGroupID","getWeixinAccounts","mpName","cv","WX","df","resolve","matchField","Deferred","getWeixinResources","resName","$msg","$a","promise","imgTpl","em","eTitle","editing","$resWiew","$resItem","linkID","linkCont","that","linkTypes","renderLinkContent","linkInfo","$linkName","$linkContent","eventIdWay","eventID","createQQEmotionPanel","$ret","createWeixinUrl","linkType","chref","env","urlHost","arg1","g","arg2","_args","arg3","urlPart","registerUI","me","eduibutton","edui","eduipopup","zIndex","$popupBody","getBodyContainer","$preview","$li","$root","root","setTopEditor","attachTo","offsetTop","offsetLeft","caretLeft","caretTop","addListener","queryCommandState","linkTpl","$link","_href","homeInit","replyInit","WeixinAdminSubNavType","subscribeInit","menuInit","advertorialInit","WeixinMaterialSubNavType","contentInit","textInit","HMCM","MCM","GiftMgrResultModel","BaseGiftModel","gridType","ds_items","__gridtype__","giftItemID","faildFn","deleteMCMGift","createGift","post","createMCMGift","editGift","editMCMGift","saveCache","bindShops","shopNames","usingCityIDs","BaseEventModel","evt","CardLevelIDSet","getEventCardSet","eventTypes","MCMDataSet","EventTypes","eventCardSet","getEventCardClz","eventTypeSet","deleteMCMEvent","switchEvent","switchMCMEvent","update","getMCMEventByID","loadCardLevelIDs","createEvent","editEvent","setData","MCMGiftListHeaderCfg","MCMEventListHeaderCfg","giftCardTpl","giftValue","giftTypes","GiftTypes","giftType","card","userInfo","eventCardTpl","eventType","mapGiftsQueryResultRenderData","rowSet","giftRule","subRows","mapEventsQueryResultRenderData","bundleGiftsQueryResultEvent","giftModel","MCMWizardModal","modalClz","wizardClz","modalTitle","onWizardInit","wizardMode","initGiftBaseInfoStep","onStepCommit","onGiftWizardStepCommit","onStepChange","onGiftWizardStepChange","bundleWizardEvent","bundleGiftWizardEvent","wizardStepsCfg","GiftWizardCfg","wizardCtrls","$ruleRow","jumpPage","$row","bundleEventsQueryResultEvent","eventModel","initEventBaseInfoStep","onEventWizardStepCommit","onEventWizardStepChange","bundleEventWizardEvent","EventWizardCfg","initEventDetailModal","renderQueryResult","initEventSwitcher","switchEventCardLayout","itemModel","$col","switchEventCtrlRow","mapEventDetailRenderData","mapCardData","mapBaseInfoData","infoLabelClz","mapGiftsData","giftKeys","mainKey","giftLevelCount","gifts","surplusCount","giftItems","hasGifts","QueryResultView","bundleEvent","QueryResultControler","bindModelEvent","bindViewEvent","deleteItem","QueryFormKeys","GiftMgrQueryKeys","GiftSendStatisticQueryKeys","GiftUsedStatisticQueryKeys","EventMgrQueryKeys","EventTrackBaseQueryKeys","addGift","timeRange","usingShopID","eventTime","addEvent","cardLevelID","bundleGiftsQueryEvent","bundleEventsQueryEvent","mapGiftQueryFormRenderData","hasAddBtn","mapEventQueryFormRenderData","mapGiftDetailGetWayQueryFormRenderData","mapGiftDetailUsedQueryFormRenderData","mapEventTrackQueryFormRenderData","eventDetail","bundleQueryEvent","initEventTypeComboOpts","initEventIsActiveComboOpts","initEventTimePicker","initGiftTypeComboOpts","tabCntID","initGiftDetailGetWayComboOpts","initGiftDetailGiftStatusComboOpts","initCardLevelComboOpts","initWinTypeComboOpts","curGetWay","getWayTypes","GiftDistributeTypes","curVal","GiftStatus","curGiftType","curEventType","curIsActive","EventIsActive","renderShopChosenRenderOptions","cardLevels","EventCardLevels","renderCombo","_cardLevels","winTypes","WinTypes","JoinTypes","registerStepView","getStepView","switchViewMode","giftEffectTimeHours","SecondsOfDay","GiftSetFormElsCfg","giftRemark","validityDays","egiftEffectTimeHours","reduce","memo","isHolidaysUsing","GiftIsHolidayUsing","usingTimeType","GiftUsingTimeTypes","foodScope","GiftFoodScope","supportOrderType","GiftSupportOrderTypes","isOfflineCanUsing","GiftIsOfflineUsing","moneyLimitType","GiftMonetaryLimitTypes","moenyLimitValue","GiftSetFormElsHT","getGiftTypeSet","mapGiftBaseInfoFormElsData","giftLabel","GiftBaseInfoFormKeys","GiftBaseInfoStepView","$giftValue","$giftValueLabel","isNaN","giftTypeSet","wizardModalView","initGiftRuleStep","GiftRuleFormKeys","mapGiftRuleFormElsData","contains","GiftRuleStepView","$moenyLimitValue","$inputGrp","chooseShop","ChooseShopModal","chosenShopNames","chosenShopIDs","getCheckboxVal","checkbox","getRadiboxVal","radiobox","ShopQueryModel","chosenShops","chosenCitys","initChosenData","uniq","clearChosenData","getChosenData","mapComboOptions","_shops","mapChosenDataOptions","_chosneShops","initInput","optGrpTpl","inputTpl","chooseShopOptions","chosenShopOptions","chooseShopOpts","comboName","chosenShopOpts","refreshCombo","comboLeftOpts","comboRightOpts","$grp","stopPropagation","$comboLeft","$comboRight","chosenData","EventSetFormElsCfg","eventRemark","dateRange","chkDeductPoints","deductPoints","chkSendPoints","sendPoints","radioCountCycleDays","EventCountCycleDays","partInTimes","isVipBirthdayMonth","IsVIPBirthdayMonth","maxPartInPerson","EventSetFormElsHT","countCycleDays","EventBaseInfoFormKeys","mapEventBaseInfoFormElsData","EventBaseInfoStepView","stepFns","EventRuleFormKeys","mapEventRuleFormElsData","eventStartDate","eventEndDate","EventRuleStepView","initDatePicker","setSwitcherLayout","setRadioCountCycleDaysLayout","$nextFormGroup","$radio","$text","getDateRange","getDeductPoints","getSendPoints","getPartinTimesSet","radioVal","initEventRuleStep","EventGiftsSetHT","EventGiftSetFormKeys","EventGiftLevelCount","GiftLevelNames","EventGiftSetFormElsCfg","EGiftID","EGiftName","EGiftTotalCount","EGiftValidUntilDayCount","EGiftOdds","EGiftEffectTimeHours","mapEventGiftFormElsData","giftLevelName","addbtn","delbtn","giftSet","form","isDivForm","EventGiftSetStepView","formTpl","resetGiftSet","PickGiftModal","selectedFn","$triggerEl","giftID","panel","$panel","initEventGiftSetStep","renderPickGiftQueryResult","initPanel","getMCMGifts","mapEventDetailData","EventOpenStepView","initEventOpenStep","BaseGiftSendModel","getGiftGetWayTypeSet","getGiftStatusTypeSet","MCMQueryGiftSendHeaderCfg","mapGiftDetailQuerySendRenderData","BaseGiftUsedModel","MCMQueryGiftUsedHeaderCfg","mapGiftDetailQueryUsedRenderData","GiftDetailDonateGiftCtrlFormKeys","GiftDetailPayGiftCtrlFormKeys","GiftDetailPayGiftOnlineCtrlFormKeys","FormElsCfg","regMobile","giftCount","chkSendSms","smsContent","recirculable","getRemark","voucherName","voucherValue","voucherTotalCount","voucherPrice","movePoint","readonly","sponsorMobile","FormElsHT","mapDonateGiftFormRenderData","mapPayGiftFormRenderData","mapPayGiftOnlineFormRenderData","initDonateGiftFormUIComponent","$panelFooter","initPayGiftFormUIComponent","initPayGiftOnlineFormUIComponent","initAccountChosenPanel","bundleDonateGiftFormEvent","$smsContent","mGiftDetail","initDonateGiftValidFieldOpts","genSMSMessage","serializeDonateGiftForm","giftDetailDonateGift","initFormPanel","bundlePayGiftFormEvent","initPayGiftValidFieldOpts","serializePayGiftForm","bundlePayGiftOnlineFormEvent","initPayGiftOnlineValidFieldOpts","serializePayGiftOnlineForm","giftDetailPayGiftOnline","giftInfo","siteInfo","HualalaWebSite","renderChosenPanelOptions","MCMGiftDetailFormPanel","panelTitle","$panelBody","bundleFormEvent","GiftDetailPage","getMCMGiftDetail","pageCtx","tabViewHT","$tabs","gridTpl","getDetail","initBreadCrumb","mapTabNavData","nav","mapGiftStatisticGridData","getways","include","genGridHeader","genRowData","rowData","rowHeader","gs","colkeys","genGridFooter","getway","giftData","giftTypeLabel","giftTypeUnit","grid","bindPageEvent","tab","$tabCnt","activedTabView","getTabView","initTabSend","initTabUsed","initTabGive","initTabPay","initTabOnlineSale","queryMCMGiftDetailGetWayInfo","queryMCMGiftDetailUsedInfo","BaseEventTrackModel","MCMQueryEventTrackBaseHeaderCfg","mapEventTrackQueryResultRenderData","bundleEventTrackQueryResultEvent","getEventTypeSet","EventTrackPage","$eventTrack","initEventTrackData","getMCMEventTrack","MCMHomePageInit","MCMGiftsMgrInit","MCMGiftDetailInit","MCMEventMgrInit","getMCMEvents","MCMEventTrackInit","isSupportedBrowser","bd","Browser","isIE","version","allowOldVersion","Cookie","browserLib","$jumbotron","Router","check","initPageLayout","session","isLogin","isSuperAdmin","bindMobileWizard","mapRanderData","header","hualalaUrl","merchantRoot","logoutPath","getLogoutJumpToUrl","logo","getDefaultImage","aboutPath","contactPath","gozapLogo","$wrapper","userMgr","DEFAULT_OPTIONS","feedbackIcons","invalid","validating","validator","$field","regxStr","regX","RegExp","initSiteNavBar","navToggleTpl","rights","getSessionUserRight","rightHT","iterate","SiteNavType","hasRight","subnavs","isCurrentPage","noPath","isSubNav","$navToggle","$header","initHomePage","getSessionRoles","getSessionPCClient","pageBrickConfigs","itemClz","$bricks","bricks","eType","initLoginPage","$loginBox","bannerImg","initAboutPage","$page","initContactPage","initPCClientDownloadPage","brickClz","LoginInit","AboutInit","ContactInit","PCClientDownloadInit","IndexInit","loadSession","appData","initMainPage","tick","getTimeInMS","loadAppData","initRouteEngine","ajaxSetup","beforeSend","xhr","setRequestHeader","ajaxEngine","ajaxFn","ajax","baseUrl","HOME","commonUrl","CommonSite","isSessionUser","_name","APPInitialized","pageParams","pageInitFn","hasNoNavPages","commonPages","mappingRoute","_path","_reg","bingo","_pattern","Path2NameMapping","getPathByName","PageConfigurations","err","reg","genPath","isInitialized","Route","detectPageInitializor","_checkItem","fname","_list","_fn","_checking","fnames","loop","_check","Array","toSet","checkReady","emptyFn","maxAge","expire","_detect","put","I1ToNManager","detect","pageConfigs","bodyClz","PageInitiator","parentName","_pageInit","flush","config","route","re","initFn","handler","listen","getCurrentPath","fragment","getFragment","curContext","curName"],"mappings":"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IAAM,wCAAyCjW,MAAQ,OACvDiW,IAAM,wCAAyCjW,MAAQ,OACvDiW,IAAM,wCAAyCjW,MAAQ,OACvDiW,IAAM,wCAAyCjW,MAAQ,QACvDiW,IAAM,wCAAyCjW,MAAQ,OACvDiW,IAAM,wCAAyCjW,MAAQ,QACvDiW,IAAM,wCAAyCjW,MAAQ,QACvDiW,IAAM,wCAAyCjW,MAAQ,OACvDiW,IAAM,wCAAyCjW,MAAQ,OACvDiW,IAAM,wCAAyCjW,MAAQ,OACvDiW,IAAM,wCAAyCjW,MAAQ,QACvDiW,IAAM,wCAAyCjW,MAAQ,OACvDiW,IAAM,wCAAyCjW,MAAQ,OACvDiW,IAAM,wCAAyCjW,MAAQ,MACvDiW,IAAM,wCAAyCjW,MAAQ,OACvDiW,IAAM,wCAAyCjW,MAAQ,OACvDiW,IAAM,wCAAyCjW,MAAQ,OACvDiW,IAAM,wCAAyCjW,MAAQ,OACvDiW,IAAM,wCAAyCjW,MAAQ,OACvDiW,IAAM,wCAAyCjW,MAAQ,OACvDiW,IAAM,wCAAyCjW,MAAQ,OACvDiW,IAAM,wCAAyCjW,MAAQ,MACvDiW,IAAM,wCAAyCjW,MAAQ,OACvDiW,IAAM,wCAAyCjW,MAAQ,OACvDiW,IAAM,wCAAyCjW,MAAQ,OACvDiW,IAAM,wCAAyCjW,MAAQ,OACvDiW,IAAM,wCAAyCjW,MAAQ,OACvDiW,IAAM,wCAAyCjW,MAAQ,OACvDiW,IAAM,wCAAyCjW,MAAQ,OACvDiW,IAAM,wCAAyCjW,MAAQ,OACvDiW,IAAM,wCAAyCjW,MAAQ,OACvDiW,IAAM,wCAAyCjW,MAAQ,MACvDiW,IAAM,wCAAyCjW,MAAQ,OACvDiW,IAAM,wCAAyCjW,MAAQ,OACvDiW,IAAM,wCAAyCjW,MAAQ,OACvDiW,IAAM,wCAAyCjW,MAAQ,OACvDiW,IAAM,wCAAyCjW,MAAQ,OACvDiW,IAAM,wCAAyCjW,MAAQ,OACvDiW,IAAM,wCAAyCjW,MAAQ,OACvDiW,IAAM,wCAAyCjW,MAAQ,MACvDiW,IAAM,wCAAyCjW,MAAQ,MACvDiW,IAAM,wCAAyCjW,MAAQ,OACvDiW,IAAM,wCAAyCjW,MAAQ,OACvDiW,IAAM,wCAAyCjW,MAAQ,OACvDiW,IAAM,wCAAyCj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","sourcesContent":["/** \r\n * -------------------------------------------------\r\n * Copyright (c) 2014, All rights reserved. \r\n * Hualala-Merchant-Management\r\n * \r\n * @version : 0.1.0\r\n * @author : HuHao\r\n * @description : Hualala Merchant Management System.  \r\n * -------------------------------------------------\r\n */ \r\n\r\n(function ($, window) {\r\n\tIX.ns('Hualala.Entry');\r\n\tvar formFields = [\r\n\t\t{\r\n\t\t\tname : 'group_name', type : 'text', palceholder : '请输入主账号', clz : 'form-control input-md',\r\n\t\t\tkey : 'groupName',\r\n\t\t\tfield : {\r\n\t\t\t\tvalidators : {\r\n\t\t\t\t\tnotEmpty : {\r\n\t\t\t\t\t\tmessage : \"请输入主账号\"\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\t{\r\n\t\t\tname : 'group_subname', type : 'text', palceholder : '请输入子账号', clz : 'form-control input-md',\r\n\t\t\tkey : 'childName',\r\n\t\t\tfield : {\r\n\t\t\t\tvalidators : {\r\n\t\t\t\t\tnotEmpty : {\r\n\t\t\t\t\t\tmessage : \"用户账号不能为空\"\r\n\t\t\t\t\t},\r\n\t\t\t\t\tstringLength : {\r\n\t\t\t\t\t\tmin : 3,\r\n\t\t\t\t\t\tmax : 50,\r\n\t\t\t\t\t\tmessage : \"账号名称长度在3-50个字符之间\"\r\n\t\t\t\t\t},\r\n\t\t\t\t\tloginName : {\r\n\t\t\t\t\t\tmessage : \"账号名称只能包含数字、英文字母和下划线(_)\"\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\t{\r\n\t\t\tname : 'login_pwd', type : 'password', palceholder : '请输入登陆密码', clz : 'form-control input-md',\r\n\t\t\tkey : 'password',\r\n\t\t\tfield : {\r\n\t\t\t\tvalidators : {\r\n\t\t\t\t\tnotEmpty : {\r\n\t\t\t\t\t\tmessage : \"请输入登陆密码\"\r\n\t\t\t\t\t},\r\n\t\t\t\t\tcallback : {\r\n\t\t\t\t\t\tcallback : function (val, validator, $field) {\r\n\t\t\t\t\t\t\tvar min = 6, max = 32;\r\n\t\t\t\t\t\t\tif (val.length < 6 || val.length > 32) {\r\n\t\t\t\t\t\t\t\treturn {\r\n\t\t\t\t\t\t\t\t\tvalid : false,\r\n\t\t\t\t\t\t\t\t\tmessage : '密码长度必须在' + min + '位到' + max + '位之间'\r\n\t\t\t\t\t\t\t\t};\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\treturn {\r\n\t\t\t\t\t\t\t\tvalid : true\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\t{\r\n\t\t\tname : 'login_auth', type : 'text', palceholder : '请输入验证码', clz : 'form-control input-md',\r\n\t\t\tkey : 'authCode',\r\n\t\t\tfield : {\r\n\t\t\t\tvalidators : {\r\n\t\t\t\t\tnotEmpty : {\r\n\t\t\t\t\t\tmessage : \"请输入验证码\"\r\n\t\t\t\t\t}/*,\r\n\t\t\t\t\tcallback : function (val, validator, $field) {\r\n\t\t\t\t\t\tif (val != $('[name=auth_code]').val()) {\r\n\t\t\t\t\t\t\treturn {\r\n\t\t\t\t\t\t\t\tvalid : false,\r\n\t\t\t\t\t\t\t\tmessage : '验证码错误'\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\treturn {valid : true};\r\n\t\t\t\t\t}*/\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\t{\r\n\t\t\tname : 'group_mobile', type : 'text', placeholder : '请输入账号绑定的手机号', clz : 'form-control input-md',\r\n\t\t\tkey : 'userMobile',\r\n\t\t\tfield : {\r\n\t\t\t\tvalidators : {\r\n\t\t\t\t\tnotEmpty : {\r\n\t\t\t\t\t\tmessage : \"请输入账号绑定的手机号\"\r\n\t\t\t\t\t},\r\n\t\t\t\t\tmobile : {\r\n\t\t\t\t\t\tmessage : \"请输入中国地区正确的手机号\"\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\t{\r\n\t\t\tname : 'mobile_pwd', type : 'password', placeholder : '短信动态密码', clz : 'form-control input-md',\r\n\t\t\tkey : 'dynamicPwd',\r\n\t\t\tfield : {\r\n\t\t\t\tvalidators : {\r\n\t\t\t\t\tnotEmpty : {\r\n\t\t\t\t\t\tmessage : \"请输入短信动态密码\"\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t];\r\n\tvar FormFieldHT = new IX.IListManager();\r\n\t_.each(formFields, function (el) {\r\n\t\tvar name = $XP(el, 'name');\r\n\t\tFormFieldHT.register(name, el);\r\n\t});\r\n\tvar CommonLoginFormEls = 'group_name,group_subname,login_pwd,login_auth'.split(','),\r\n\t\tMobileLoginFormEls = 'group_name,group_mobile,mobile_pwd'.split(',');\r\n\r\n\tvar DynamicPWD = function (cfg) {\r\n\t\tvar $btn = $($XP(cfg, '$btn')),\r\n\t\t\tgetParams = $XF(cfg, 'getParams'),\r\n\t\t\twaitingTime = $XP(cfg, 'waiting', 60),\r\n\t\t\ttimmer = null;\r\n\t\tvar callServer = Hualala.Global.getMobileDynamicPWD;\r\n\t\tvar getDynamicPWD = function (cbFn) {\r\n\t\t\tvar params = getParams();\r\n\t\t\tif (!params) {\r\n\t\t\t\t$btn.button('reset');\r\n\t\t\t\treturn ;\r\n\t\t\t}\r\n\t\t\tcallServer(params, function (res) {\r\n\t\t\t\tif ($XP(res, 'resultcode') == \"000\") {\r\n\t\t\t\t\tHualala.UI.TopTip({\r\n\t\t\t\t\t\ttype : 'success',\r\n\t\t\t\t\t\tmsg : $XP(res, 'resultmsg', \"短信发送成功\")\r\n\t\t\t\t\t});\r\n\t\t\t\t\tcbFn();\r\n\t\t\t\t} else {\r\n\t\t\t\t\tHualala.UI.TopTip({\r\n\t\t\t\t\t\ttype : 'danger',\r\n\t\t\t\t\t\tmsg : $XP(res, 'resultmsg', \"发送动态密码失败\")\r\n\t\t\t\t\t});\r\n\t\t\t\t\t$btn.button('reset');\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t});\r\n\t\t};\r\n\t\tvar waiting = function () {\r\n\t\t\tvar count = waitingTime;\r\n\t\t\ttimmer = setInterval(function () {\r\n\t\t\t\tcount--;\r\n\t\t\t\tif (count == 0) {\r\n\t\t\t\t\tclearInterval(timmer);\r\n\t\t\t\t\t$btn.attr('data-loading-text', '发送中...');\r\n\t\t\t\t\t$btn.button('reset');\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\tvar tpl = '{time}秒后重试',\r\n\t\t\t\t\tstr = tpl.replaceAll('{time}', count);\r\n\t\t\t\t$btn.text(str);\r\n\t\t\t}, 1000);\r\n\t\t};\r\n\t\tvar bindEvent = function () {\r\n\t\t\t$btn.unbind('click').on('click', function (e) {\r\n\t\t\t\tif ($btn.hasClass('disabled')) return;\r\n\t\t\t\t$btn.button('loading');\r\n\t\t\t\tgetDynamicPWD(waiting);\r\n\t\t\t});\r\n\t\t};\r\n\t\tbindEvent();\r\n\t\treturn {\r\n\t\t\tgetDynamicPWD : function () {$btn.trigger('click');}\r\n\t\t};\r\n\t};\r\n\tHualala.Common.DynamicPWD = DynamicPWD;\r\n\r\n\t/**\r\n\t * 生成AuthCode实例\r\n\t * @param {Object} cfg {container}\r\n\t */\r\n\tvar AuthCode = function (cfg) {\r\n\t\tvar container = $($XP(cfg, 'container')),\r\n\t\t\t$img = container.find('.auth-img'),\r\n\t\t\t$progress = container.find('.progress');\r\n\t\tvar callServer = Hualala.Global.genAuthCode;\r\n\t\tvar toggleProgress = function (isShow) {\r\n\t\t\t$progress[isShow ? 'removeClass' : 'addClass']('hidden');\r\n\t\t\t$img[isShow ? 'addClass' : 'removeClass']('hidden');\r\n\t\t};\r\n\t\tvar getAuthCode = function (cbFn) {\r\n\t\t\ttoggleProgress(true);\r\n\t\t\tcallServer({}, function (res) {\r\n\t\t\t\tvar code = null;\r\n\t\t\t\tif ($XP(res, 'resultcode') == \"000\") {\r\n\t\t\t\t\tcode = $XP(res, 'data.code', null);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tHualala.UI.TopTip({\r\n\t\t\t\t\t\ttype : 'warning',\r\n\t\t\t\t\t\tmsg : \"获取验证码失败\"\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t\ttoggleProgress();\r\n\t\t\t\t}\r\n\t\t\t\tcbFn(code);\r\n\t\t\t});\r\n\t\t};\r\n\t\tvar setAuthCode = function (code) {\r\n\t\t\tif (!code) {\r\n\t\t\t\tsetTimeout(function () {\r\n\t\t\t\t\tgetAuthCode(setAuthCode);\r\n\t\t\t\t}, 1000);\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\t$img.attr('src', code + '?' + (new Date()).getTime());\r\n\t\t\t// FOR TEST\r\n\t\t\tsetTimeout(function () {\r\n\t\t\t\ttoggleProgress();\r\n\t\t\t}, 500);\r\n\t\t};\r\n\t\tvar bindEvent = function () {\r\n\t\t\tcontainer.find('.auth-img').unbind('click').on('click', function (e) {\r\n\t\t\t\t$img = $(e.target);\r\n\t\t\t\tgetAuthCode(setAuthCode);\r\n\t\t\t});\r\n\t\t};\r\n\t\tvar init = function () {\r\n\t\t\tgetAuthCode(setAuthCode);\r\n\t\t\tbindEvent();\r\n\t\t};\r\n\t\tinit();\r\n\t\treturn {\r\n\t\t\tgenCode : function () {\r\n\t\t\t\tgetAuthCode(setAuthCode);\r\n\t\t\t}\r\n\t\t};\r\n\t};\r\n\r\n\tHualala.Entry.initLogin = Stapes.subclass({\r\n\t\t/**\r\n\t\t * 构造登录界面\r\n\t\t * @param  {Object} cfg \r\n\t\t *         {\r\n\t\t *         \t\t$container : jQueryObj\r\n\t\t *         \t\tmode : 'common' | 'mobile'\r\n\t\t *         }\r\n\t\t * @return {Object}     实例\r\n\t\t */\r\n\t\tconstructor : function (cfg) {\r\n\t\t\tthis.$container = $XP(cfg, '$container');\r\n\t\t\tthis.mode = $XP(cfg, 'mode', 'common');\r\n\t\t\tthis.callServer = Hualala.Global.loginCallServer;\r\n\t\t\tthis.formKeys = [];\r\n\t\t\tthis.formFieldHT = FormFieldHT;\r\n\t\t\tthis.formFields = [];\r\n\t\t\tthis.$subBtn = null;\r\n\t\t\tthis.$authCode = null;\r\n\t\t\tthis.authCode = null;\r\n\t\t\tthis.$dinamicPWDBtn = null;\r\n\t\t\tthis.dinamicPWD = null;\r\n\t\t\tthis.progress = null;\r\n\t\t\tthis.fvOpts = null;\r\n\t\t\tthis.$formPanel = null;\r\n\t\t\tthis.switchLoginMode(this.mode);\r\n\t\t\tthis.bindEvent();\r\n\t\t}\r\n\t});\r\n\tHualala.Entry.initLogin.proto({\r\n\t\tswitchLoginMode : function (mode) {\r\n\t\t\tvar self = this;\r\n\t\t\tself.mode = mode;\r\n\t\t\tif (self.mode == 'common') {\r\n\t\t\t\tself.callServer = Hualala.Global.loginCallServer;\r\n\t\t\t\tself.formKeys = CommonLoginFormEls;\r\n\t\t\t\tself.$formPanel = self.$container.find('.panel-login');\r\n\t\t\t\tself.$subBtn = self.$container.find('#login_sub');\r\n\t\t\t\tself.$progress = self.$subBtn.parent().find('.progress');\r\n\t\t\t\tself.$authCode = self.$container.find('.ix-authcode');\r\n\t\t\t\tself.authCode = new AuthCode({\r\n\t\t\t\t\tcontainer : self.$authCode\r\n\t\t\t\t});\r\n\t\t\t\tself.formFields = self.formFieldHT.getByKeys(self.formKeys);\r\n\t\t\t\tself.fvOpts = self.initValidFieldOpts();\r\n\t\t\t} else  if (self.mode == 'mobile') {\r\n\t\t\t\tself.callServer = Hualala.Global.dynamicLoginCallServer;\r\n\t\t\t\tself.formKeys = MobileLoginFormEls;\r\n\t\t\t\tself.$formPanel = self.$container.find('.panel-forget-pwd');\r\n\t\t\t\tself.$subBtn = self.$container.find('#login_mobile');\r\n\t\t\t\tself.$progress = self.$subBtn.parent().find('.progress');\r\n\t\t\t\tself.$dynamicPWDBtn = self.$container.find('.btn-mobile-pwd');\r\n\t\t\t\tself.dinamicPWD = new DynamicPWD({\r\n\t\t\t\t\t$btn : self.$dynamicPWDBtn,\r\n\t\t\t\t\tgetParams : function () {\r\n\t\t\t\t\t\tvar $groupName = self.$formPanel.find('#group_name'),\r\n\t\t\t\t\t\t\t$userMobile = self.$formPanel.find('#group_mobile'),\r\n\t\t\t\t\t\t\tbv = self.$formPanel.data('bootstrapValidator');\r\n\t\t\t\t\t\tif (!bv.validateField($groupName).isValidField($groupName) \r\n\t\t\t\t\t\t\t|| !bv.validateField($userMobile).isValidField($userMobile)) {\r\n\t\t\t\t\t\t\treturn null;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tvar els = self.getFormData();\r\n\t\t\t\t\t\tvar ret = {};\r\n\t\t\t\t\t\t_.each(els, function (v, k) {\r\n\t\t\t\t\t\t\tif (k == 'groupName' || k == 'userMobile') {\r\n\t\t\t\t\t\t\t\tret[k] = v;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t\treturn ret;\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t\tself.formFields = self.formFieldHT.getByKeys(self.formKeys);\r\n\t\t\t\tself.fvOpts = self.initValidFieldOpts();\r\n\t\t\t}\r\n\t\t\tself.initLoginForm();\r\n\t\t},\r\n\t\ttoggleProgress : function (isShow) {\r\n\t\t\tvar self = this;\r\n\t\t\tself.$progress[isShow ? 'removeClass' : 'addClass']('hidden');\r\n\t\t\tself.$subBtn[isShow ? 'addClass' : 'removeClass']('hidden');\r\n\t\t},\r\n\t\t// 表单校验配置项\r\n\t\tinitValidFieldOpts : function () {\r\n\t\t\tvar self = this, ret = {};\r\n\t\t\t_.each(self.formFields, function (f, i, l) {\r\n\t\t\t\tvar key = $XP(f, 'name'), field = $XP(f, 'field');\r\n\t\t\t\tret[key] = field;\r\n\t\t\t});\r\n\t\t\treturn ret;\r\n\t\t},\r\n\t\t// 获取表单数据\r\n\t\tgetFormData : function () {\r\n\t\t\tvar self = this;\r\n\t\t\tvar params = {};\r\n\t\t\t_.each(self.formFields, function (f, i, l) {\r\n\t\t\t\tvar name = $XP(f, 'name'), key = $XP(f, 'key'),\r\n\t\t\t\t\tval = $('[name=' + name + ']', self.$formPanel).val();\r\n\t\t\t\tparams[key] = val;\r\n\t\t\t});\r\n\t\t\treturn params;\r\n\t\t},\r\n\t\tinitLoginForm : function () {\r\n\t\t\tvar self = this;\r\n\t\t\tself.$container.find('.panel-warning').addClass('hidden');\r\n\t\t\tself.$formPanel.removeClass('hidden');\r\n\t\t\tself.$formPanel.find('#group_name').val(self.groupName);\r\n\t\t\tif (self.$formPanel.data('bootstrapValidator')) return;\r\n\t\t\tself.$formPanel.bootstrapValidator({\r\n\t\t\t\ttrigger : 'blur',\r\n\t\t\t\tfields : self.fvOpts\r\n\t\t\t}).on('success.field.bv', function (e, data) {\r\n\t\t\t\tvar field = $XP(data, 'field');\r\n\t\t\t\tif (field == 'group_mobile') {\r\n\t\t\t\t\tself.$dynamicPWDBtn.removeClass('disabled').attr('disabled', false);\r\n\t\t\t\t}\r\n\t\t\t}).on('error.field.bv', function (e, data) {\r\n\t\t\t\tvar $form = $(e.target),\r\n\t\t\t\t\tbv = $form.data('bootstrapValidator');\r\n\t\t\t\tself.toggleProgress();\r\n\t\t\t\tvar field = $XP(data, 'field');\r\n\t\t\t\tif (field == 'group_mobile' || field == 'group_name') {\r\n\t\t\t\t\tself.$dynamicPWDBtn.addClass('disabled').attr('disabled', true);\r\n\t\t\t\t}\r\n\t\t\t}).on('success.form.bv', function (e, data) {\r\n\t\t\t\te.preventDefault();\r\n\t\t\t\tvar $form = $(e.target),\r\n\t\t\t\t\tbv = $form.data('bootstrapValidator'),\r\n\t\t\t\t\tparams = self.getFormData();\r\n\t\t\t\tIX.Debug.info('INFO: Login Params : ');\r\n\t\t\t\tIX.Debug.info(params);\r\n\t\t\t\tself.callServer(params, function (res) {\r\n\t\t\t\t\tif (res.resultcode == '000') {\r\n\t\t\t\t\t\tdocument.location.href = Hualala.PageRoute.createPath('main'); \r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tHualala.UI.TopTip({\r\n\t\t\t\t\t\t\ttype : 'danger',\r\n\t\t\t\t\t\t\tmsg : $XP(res, 'resultmsg')\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t\tif (self.mode == 'common') {\r\n\t\t\t\t\t\t\tself.authCode.genCode();\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\tself.toggleProgress();\r\n\t\t\t\t\tself.$subBtn.attr('disabled', false);\r\n\t\t\t\t});\r\n\t\t\t});\r\n\t\t\tself.$formPanel.bootstrapValidator('resetForm');\r\n\t\t\tself.$dynamicPWDBtn && self.$dynamicPWDBtn.removeClass('disabled').attr('disabled', false);\r\n\t\t},\r\n\t\tbindEvent : function () {\r\n\t\t\tvar self = this;\r\n\t\t\tself.$container.delegate('#login_sub, #login_mobile', 'click', function (e) {\r\n\t\t\t\tself.toggleProgress(true);\r\n\t\t\t\tvar bv = self.$formPanel.data('bootstrapValidator');\r\n\t\t\t\tbv.validate();\r\n\t\t\t});\r\n\t\t\tself.$container.delegate('.form-control[tabIndex]', 'keyup', function (e) {\r\n\t\t\t\tif (e.keyCode != 13) return;\r\n\t\t\t\tvar $this = $(this), tabIdx = parseInt($this.attr('tabIndex')),\r\n\t\t\t\t\tel = $('.form-control[tabIndex=' + (tabIdx + 1) + ']');\r\n\r\n\t\t\t\t$this.blur();\r\n\t\t\t\t(el.length > 0 && !el.is('.btn')) ? el.focus() : self.$subBtn.trigger('click');\r\n\t\t\t\t\r\n\t\t\t});\r\n\t\t\tself.$container.delegate('.btn-change-mode', 'click', function (e) {\r\n\t\t\t\tvar $btn = $(this), mode = $btn.attr('data-mode');\r\n\t\t\t\tself.groupName = self.$formPanel.find('#group_name').val();\r\n\t\t\t\tself.toggleProgress();\r\n\t\t\t\tself.switchLoginMode(mode);\r\n\t\t\t});\r\n\t\t}\r\n\t});\r\n})(jQuery, window);;(function ($, window) {\r\n\tIX.ns(\"Hualala.Shop\");\r\n\tvar popoverMsg = Hualala.UI.PopoverMsgTip;\r\n\tvar toptip = Hualala.UI.TopTip;\r\n\tvar QueryModel = Stapes.subclass({\r\n\t\tconstructor : function () {\r\n\t\t\t// 原始数据\r\n\t\t\tthis.origCities = [];\r\n\t\t\tthis.origAreas = [];\r\n\t\t\tthis.origShops = [];\r\n\t\t\t// 数据是否已经加载完毕\r\n\t\t\tthis.isReady = false;\r\n\t\t\tthis.callServer = Hualala.Global.getShopQuerySchema;\r\n\t\t}\r\n\t});\r\n\tQueryModel.proto({\r\n\t\t// 数据模型初始化，获取查询条件的数据\r\n\t\tinit : function (params, cbFn) {\r\n\t\t\tvar self = this;\r\n\t\t\tself.isReady = false;\r\n\t\t\tself.callServer(params, function (res) {\r\n\t\t\t\tif (res.resultcode == '000') {\r\n\t\t\t\t\t// 装填原始数据\r\n\t\t\t\t\tself.origCities = $XP(res, 'data.cities', []);\r\n\t\t\t\t\tself.origAreas = $XP(res, 'data.areas', []);\r\n\t\t\t\t\tself.origShops = $XP(res, 'data.shops', []);\r\n\t\t\t\t\tself.initDataModel();\r\n\t\t\t\t\tself.isReady = true;\r\n\t\t\t\t} else {\r\n\t\t\t\t\ttoptip({\r\n\t\t\t\t\t\tmsg : $XP(res, 'resultmsg', ''),\r\n\t\t\t\t\t\ttype : 'danger'\r\n\t\t\t\t\t});\r\n\t\t\t\t\tself.isReady = false;\r\n\t\t\t\t}\r\n\t\t\t\tcbFn(self);\r\n\t\t\t});\r\n\t\t},\r\n\t\t// 初始化整体数据模型\r\n\t\t// ds_city, ds_area, ds_shop\r\n\t\tinitDataModel : function () {\r\n\t\t\tvar self = this;\r\n\t\t\tvar cityHT = new IX.IListManager(),\r\n\t\t\t\tareaHT = new IX.IListManager(),\r\n\t\t\t\tshopHT = new IX.IListManager();\r\n\t\t\t_.each(this.origCities, function (c, i, l) {\r\n\t\t\t\tvar cid = $XP(c, 'cityID'), \r\n\t\t\t\t\tshopLst = _.filter(self.origShops, function (s) {\r\n\t\t\t\t\t\treturn $XP(s, 'cityID') == cid;\r\n\t\t\t\t\t}),\r\n\t\t\t\t\tareaLst = _.filter(self.origAreas, function (a) {\r\n\t\t\t\t\t\treturn $XP(a, 'cityID') == cid;\r\n\t\t\t\t\t});\r\n\t\t\t\tshopLst = _.pluck(shopLst, 'shopID');\r\n\t\t\t\tareaLst = _.pluck(areaLst, 'areaID');\r\n\t\t\t\tcityHT.register(cid, IX.inherit(c, {\r\n\t\t\t\t\tshopLst : shopLst,\r\n\t\t\t\t\tareaLst : areaLst\r\n\t\t\t\t}));\r\n\t\t\t});\r\n\t\t\t_.each(this.origAreas, function (a, i, l) {\r\n\t\t\t\tvar aid = $XP(a, 'areaID'),\r\n\t\t\t\t\tshopLst = _.filter(self.origShops, function (s) {\r\n\t\t\t\t\t\treturn $XP(s, 'areaID') == aid;\r\n\t\t\t\t\t});\r\n\t\t\t\tshopLst = _.pluck(shopLst, 'shopID');\r\n\t\t\t\tareaHT.register(aid, IX.inherit(a, {\r\n\t\t\t\t\tshopLst : shopLst\r\n\t\t\t\t}));\r\n\t\t\t});\r\n\t\t\t_.each(this.origShops, function (s, i, l) {\r\n\t\t\t\tvar sid = $XP(s, 'shopID');\r\n\t\t\t\tshopHT.register(sid, s);\r\n\t\t\t});\r\n\t\t\tself.set({\r\n\t\t\t\tds_city : cityHT,\r\n\t\t\t\tds_area : areaHT,\r\n\t\t\t\tds_shop : shopHT\r\n\t\t\t});\r\n\t\t},\r\n\t\t// 数据是否准备完成\r\n\t\thasReady : function () {return this.isReady;},\r\n\t\t/**\r\n\t\t * 通过cityIDs获取城市数据\r\n\t\t * @param  {String|Array|NULL} ids cityID，如果参数是一个城市的cityID，获取一个城市的数据；如果参数是cityID的数组，获取多个城市数据；如果不传参数，获取全部城市数据\r\n\t\t * @return {Array|NULL}\t如果没有找到匹配的城市数据返回null，否则返回城市数据的数组数据     \r\n\t\t */\r\n\t\tgetCities : function (ids) {\r\n\t\t\tids = IX.isEmpty(ids) ? null : (IX.isString(ids) ? [ids] : ids);\r\n\t\t\tvar ds = this.get('ds_city');\r\n\t\t\tvar ret = null;\r\n\t\t\tret = ds[!ids ? 'getAll' : 'getByKeys'](ids);\r\n\t\t\treturn ret;\r\n\t\t},\r\n\t\t/**\r\n\t\t * 通过shopIDs获取店铺数据\r\n\t\t * @param  {String|Array|NULL} ids shopID，如果参数是一个店铺的shopID，获取一个店铺的数据；如果参数是shopID的数组，获取多个店铺数据；如果不传参数，获取全部店铺数据\r\n\t\t * @return {Array|NULL}\t如果没有找到匹配的店铺数据返回null，否则返回店铺数据的数组数据     \r\n\t\t */\r\n\t\tgetShops : function (ids) {\r\n\t\t\tids = IX.isEmpty(ids) ? null : (IX.isString(ids) ? [ids] : ids);\r\n\t\t\tvar ds = this.get('ds_shop');\r\n\t\t\tvar ret = null;\r\n\t\t\tret = ds[!ids ? 'getAll' : 'getByKeys'](ids);\r\n\t\t\treturn ret;\r\n\t\t},\r\n\t\t/**\r\n\t\t * 获取指定区域下的店铺数据\r\n\t\t * @param  {String} areaID 指定区域ID\r\n\t\t * @return {Array|NULL} 如果没有找到匹配的店铺数据返回null，否则返回店铺数据的数组数据\r\n\t\t */\r\n\t\tgetShopsByAreaID : function (areaID) {\r\n\t\t\tif (!areaID) return null;\r\n\t\t\tvar ds = this.get('ds_shop');\r\n\t\t\tvar ret = _.filter(ds.getAll(), function (s, idx) {\r\n\t\t\t\tvar aid = $XP(s, 'areaID');\r\n\t\t\t\treturn areaID == aid;\r\n\t\t\t});\r\n\t\t\treturn ret.length == 0 ? null : ret;\r\n\t\t},\r\n\t\t/**\r\n\t\t * 获取指定城市的店铺数据\r\n\t\t * @param  {String} cityID 指定城市ID\r\n\t\t * @return {Array|NULL} 如果没有找到匹配的店铺数据返回null，否则返回店铺数据的数组数据\r\n\t\t */\r\n\t\tgetShopsByCityID : function (cityID) {\r\n\t\t\tif (!cityID) return null;\r\n\t\t\tvar ds = this.get('ds_shop');\r\n\t\t\tvar ret = _.filter(ds.getAll(), function (s, idx) {\r\n\t\t\t\tvar cid = $XP(s, 'cityID');\r\n\t\t\t\treturn cityID == cid;\r\n\t\t\t});\r\n\t\t\treturn ret.length == 0 ? null : ret;\r\n\t\t},\r\n\t\t/**\r\n\t\t * 通过areaIDs获取区域数据\r\n\t\t * @param  {String|Array|NULL} ids areaID，如果参数是一个区域的areaID，获取一个区域的数据；如果参数是areaID的数组，获取多个区域数据；如果不传参数，获取全部区域数据\r\n\t\t * @return {Array|NULL}\t如果没有找到匹配的区域数据返回null，否则返回区域数据的数组数据     \r\n\t\t */\r\n\t\tgetAreas : function (ids) {\r\n\t\t\tids = IX.isEmpty(ids) ? null : (IX.isString(ids) ? [ids] : ids);\r\n\t\t\tvar ds = this.get('ds_area');\r\n\t\t\tvar ret = null;\r\n\t\t\tret = ds[!ids ? 'getAll' : 'getByKeys'](ids);\r\n\t\t\treturn ret;\r\n\t\t},\r\n\t\tdestroy : function () {\r\n\t\t\tthis.origCities = [];\r\n\t\t\tthis.origAreas = [];\r\n\t\t\tthis.origShops = [];\r\n\t\t\tthis.isReady = false;\r\n\t\t}\r\n\t});\r\n\tHualala.Shop.QueryModel = QueryModel;\r\n})(jQuery, window);;(function ($, window) {\r\n\tIX.ns(\"Hualala.Shop\");\r\n\tvar popoverMsg = Hualala.UI.PopoverMsgTip;\r\n\tvar toptip = Hualala.UI.TopTip;\r\n\tvar QueryView = Stapes.subclass({\r\n\t\tconstructor : function () {\r\n\t\t\t// View层是否初始化完毕\r\n\t\t\tthis.isReady = false;\r\n\t\t\t// 是否开放创建店铺功能\r\n\t\t\tthis.needShopCreate = false;\r\n\t\t\t// View层容器\r\n\t\t\tthis.$container = null;\r\n\t\t\tthis.$queryBox = null;\r\n\t\t\t// 过滤部分容器\r\n\t\t\tthis.$filter = null;\r\n\t\t\t// 搜索部分容器\r\n\t\t\tthis.$query = null;\r\n\t\t\tthis.loadTemplates();\r\n\t\t}\r\n\t});\r\n\tQueryView.proto({\r\n\t\t// 初始化View层\r\n\t\tinit : function (cfg) {\r\n\t\t\tthis.model = $XP(cfg, 'model', null);\r\n\t\t\tthis.needShopCreate = $XP(cfg, 'needShopCreate', false);\r\n\t\t\tthis.$container = $XP(cfg, 'container', null);\r\n\t\t\tif (!this.model || !this.$container || this.$container.length == 0) {\r\n\t\t\t\tthrow(\"Init Query View Failed!!\");\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tthis.keywordLst = null;\r\n\t\t\tthis.renderLayout();\r\n\t\t\tthis.bindEvent();\r\n\t\t\tthis.isReady = true;\r\n\t\t\tthis.emit('filter', this.getFilterParams());\r\n\r\n\t\t},\r\n\t\t// 判断是否View初始化完毕\r\n\t\thasReady : function () {return this.isReady;},\r\n\t\t// 加载View层需要的模板\r\n\t\tloadTemplates : function () {\r\n\t\t\tvar queryTpl = Handlebars.compile(Hualala.TplLib.get('tpl_shop_query')),\r\n\t\t\t\tfilterTpl = Handlebars.compile(Hualala.TplLib.get('tpl_shop_filter'));\r\n\t\t\t// 注册子模板\r\n\t\t\tHandlebars.registerPartial(\"shopCity\", Hualala.TplLib.get('tpl_shop_filter'));\r\n\t\t\tHandlebars.registerPartial(\"toggle\", Hualala.TplLib.get('tpl_site_navbarToggle'));\r\n\t\t\t// Handlebars.registerPartial(\"shopArea\", Hualala.TplLib.get('tpl_shop_filter'));\r\n\t\t\tthis.set({\r\n\t\t\t\tqueryTpl : queryTpl,\r\n\t\t\t\tfilterTpl : filterTpl\r\n\t\t\t});\r\n\t\t},\r\n\t\t// 生成搜索栏店铺选择框组件的渲染数据\r\n\t\tmapChosenShopData : function () {\r\n\t\t\tvar self = this;\r\n\t\t\tvar cities = this.model.getCities();\r\n\t\t\tvar ret = [];\r\n\t\t\t_.each(cities, function (city, i, l) {\r\n\t\t\t\tvar cityName = $XP(city, 'cityName', ''),\r\n\t\t\t\t\tcityID = $XP(city, 'cityID', ''),\r\n\t\t\t\t\tshopLst = $XP(city, 'shopLst');\r\n\t\t\t\tvar shops = self.model.getShops(shopLst);\r\n\t\t\t\tret.push({\r\n\t\t\t\t\tname : cityName,\r\n\t\t\t\t\titems : _.map(shops, function (shop, j, l) {\r\n\t\t\t\t\t\treturn {\r\n\t\t\t\t\t\t\tcode : $XP(shop, 'shopID'),\r\n\t\t\t\t\t\t\tname : $XP(shop, 'shopName')\r\n\t\t\t\t\t\t};\r\n\t\t\t\t\t})\r\n\t\t\t\t});\r\n\t\t\t});\r\n\t\t\treturn ret;\r\n\t\t},\r\n\t\t// 生成渲染数据\r\n\t\tmapRenderLayoutData : function () {\r\n\t\t\tvar cities = this.model.getCities(),\r\n\t\t\t\tshops = this.model.getShops();\r\n\t\t\tvar filterCities = this.mapFilterData({\r\n\t\t\t\t\ttype : 'city',\r\n\t\t\t\t\tname : '城市：',\r\n\t\t\t\t\tfocus : 0,\r\n\t\t\t\t\tdata : cities\r\n\t\t\t\t}),\r\n\t\t\t\tqueryChosenShops = this.mapChosenShopData();\r\n\t\t\treturn {\r\n\t\t\t\tclz : '',\r\n\t\t\t\tshopCity : filterCities,\r\n\t\t\t\ttoggle : {target : '#shop_query'},\r\n\t\t\t\tneedShopCreate : this.needShopCreate,\r\n\t\t\t\toptGrp : queryChosenShops\r\n\t\t\t};\r\n\t\t},\r\n\t\tchkCtrlRight : function () {\r\n\t\t\tvar self = this;\r\n\t\t\tvar curPageRight = Hualala.Common.getCurPageUserRight();\r\n\t\t\tvar disabled = $XP(curPageRight, 'right.disabled', []),\r\n\t\t\t\tenabled = $XP(curPageRight, 'right.enabled', []);\r\n\t\t\t_.each(disabled, function (n) {\r\n\t\t\t\tself.$query.find('[data-btn-name=' + n + ']').attr('disabled', true).addClass('invisible');\r\n\t\t\t});\r\n\t\t\t_.each(enabled, function (n) {\r\n\t\t\t\tself.$query.find('[data-btn-name=' + n + ']').attr('disabled', false).removeClass('invisible');\r\n\t\t\t});\r\n\t\t},\r\n\t\t// 渲染整体query 框架\r\n\t\trenderLayout : function () {\r\n\t\t\tvar self = this,\r\n\t\t\t\tqueryTpl = self.get('queryTpl'),\r\n\t\t\t\tmodel = self.model;\r\n\t\t\tvar renderData = self.mapRenderLayoutData();\r\n\t\t\tvar html = queryTpl(renderData);\r\n\t\t\tthis.$queryBox = $(html);\r\n\t\t\tthis.$container.prepend(this.$queryBox);\r\n\t\t\tthis.$filter = this.$queryBox.find('.filter');\r\n\t\t\tthis.$query = this.$queryBox.find('.query');\r\n\t\t\tthis.initShopChosenPanel();\r\n\t\t\tthis.chkCtrlRight();\r\n\t\t},\r\n\t\t// 生成渲染地区的渲染数据\r\n\t\tmapFilterData : function (cfg) {\r\n\t\t\tvar data = $XP(cfg, 'data', []),\r\n\t\t\t\ttype = $XP(cfg, 'type'),\r\n\t\t\t\tname = $XP(cfg, 'name'),\r\n\t\t\t\tfocus = $XP(cfg, 'focus', 0),\r\n\t\t\t\tret = {\r\n\t\t\t\t\ttype : type,\r\n\t\t\t\t\tname : name,\r\n\t\t\t\t\titems : []\r\n\t\t\t\t},\r\n\t\t\t\tcount = 0;\r\n\t\t\tvar btn_all = {\r\n\t\t\t\tfocusClz : '',\r\n\t\t\t\ttype : type,\r\n\t\t\t\tcode : -1,\r\n\t\t\t\tname : '全部',\r\n\t\t\t\tcount : 0\r\n\t\t\t};\r\n\t\t\tret.items = _.map(data, function (o, i, l) {\r\n\t\t\t\tvar key = type + 'Count';\r\n\t\t\t\tvar c = parseInt($XP(o, key, 0));\r\n\t\t\t\tcount += c;\r\n\t\t\t\treturn {\r\n\t\t\t\t\tfocusClz : '',\r\n\t\t\t\t\ttype : type,\r\n\t\t\t\t\tcode : $XP(o, (type + 'ID'), ''),\r\n\t\t\t\t\tname : $XP(o, (type + 'Name'), ''),\r\n\t\t\t\t\tcount : c\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\tbtn_all = IX.inherit(btn_all, {\r\n\t\t\t\tcount : count,\r\n\t\t\t\tfocusClz : ''\r\n\t\t\t});\r\n\t\t\tret.items.unshift(btn_all);\r\n\t\t\tret.items[focus]['focusClz'] = 'disabled';\r\n\t\t\treturn ret;\r\n\t\t},\r\n\t\tinitShopChosenPanel : function () {\r\n\t\t\tvar self = this;\r\n\t\t\tvar matcher = (new Pymatch([]));\r\n\t\t\tvar sections = self.model.getShops();\r\n\t\t\tvar getMatchedFn = function (searchText) {\r\n\t\t\t\tmatcher.setNames(_.map(sections, function (el) {\r\n\t\t\t\t\treturn IX.inherit(el, {\r\n\t\t\t\t\t\tname : el.shopName\r\n\t\t\t\t\t});\r\n\t\t\t\t}));\r\n\t\t\t\tvar matchedSections = matcher.match(searchText);\r\n\t\t\t\tvar matchedOptions = {};\r\n\t\t\t\t_.each(matchedSections, function (el, i) {\r\n\t\t\t\t\tmatchedOptions[el[0].shopID] = true;\r\n\t\t\t\t});\r\n\t\t\t\treturn matchedOptions;\r\n\t\t\t};\r\n\t\t\tself.$query.find('.navbar-form[role=\"search\"] select').chosen({\r\n\t\t\t\twidth : '200px',\r\n\t\t\t\tplaceholder_text : \"请选择店铺名称\",\r\n\t\t\t\t// max_selected_options: 1,\r\n\t\t\t\tno_results_text : \"抱歉，没有找到！\",\r\n\t\t\t\tallow_single_deselect : true,\r\n\t\t\t\tgetMatchedFn : getMatchedFn\r\n\t\t\t}).change(function (e) {\r\n\t\t\t\tvar $this = $(this);\r\n\t\t\t\tself.keywordLst = $this.val();\r\n\t\t\t});\r\n\t\t},\r\n\t\t// 渲染filter\r\n\t\trenderAreaFilter : function (data) {\r\n\t\t\tvar self = this,\r\n\t\t\t\tfilterTpl = self.get('filterTpl'),\r\n\t\t\t\tmodel = self.model;\r\n\t\t\tvar renderData = self.mapFilterData({\r\n\t\t\t\ttype : 'area',\r\n\t\t\t\tname : '区域：',\r\n\t\t\t\tfocus : 0,\r\n\t\t\t\tdata : data\r\n\t\t\t});\r\n\t\t\tvar html = filterTpl(renderData);\r\n\t\t\tthis.$filter.find('.area').remove();\r\n\t\t\tthis.$filter.append(html);\r\n\t\t\tthis.initShopChosenPanel();\r\n\t\t},\r\n\t\tupdateFilterCityLayout : function (cityID) {\r\n\t\t\tvar self = this;\r\n\t\t\tvar data = null;\r\n\t\t\tif (cityID != -1) {\r\n\t\t\t\tdata = self.model.getCities(cityID);\r\n\t\t\t\tdata = $XP(data[0], 'areaLst', null);\r\n\t\t\t\tdata = self.model.getAreas(data);\r\n\t\t\t\tself.renderAreaFilter(data);\r\n\t\t\t} else {\r\n\t\t\t\tself.$filter.find('.area').remove();\r\n\t\t\t}\r\n\t\t\tself.$filter.find('.btn-link[data-city]').removeClass('disabled');\r\n\t\t\tself.$filter.find('.btn-link[data-city=' + cityID + ']').addClass('disabled');\r\n\t\t},\r\n\t\tupdateFilterAreaLayout : function (areaID) {\r\n\t\t\tvar self = this;\r\n\t\t\tself.$filter.find('.btn-link[data-area]').removeClass('disabled');\r\n\t\t\tself.$filter.find('.btn-link[data-area=' + areaID + ']').addClass('disabled');\r\n\t\t},\r\n\t\t// 绑定View层操作\r\n\t\tbindEvent : function () {\r\n\t\t\tvar self = this;\r\n\t\t\tthis.$filter.on('click', '.btn-link[data-city]', function (e) {\r\n\t\t\t\tvar $btn = $(this);\r\n\t\t\t\tvar cityID = $btn.attr('data-city');\r\n\t\t\t\t// var data = null;\r\n\t\t\t\t// if (cityID != -1) {\r\n\t\t\t\t// \tdata = self.model.getCities(cityID);\r\n\t\t\t\t// \tdata = $XP(data[0], 'areaLst', null);\r\n\t\t\t\t// \tdata = self.model.getAreas(data);\r\n\t\t\t\t// \tself.renderAreaFilter(data);\r\n\t\t\t\t// } else {\r\n\t\t\t\t// \tself.$filter.find('.area').remove();\r\n\t\t\t\t// }\r\n\t\t\t\t// self.$filter.find('.btn-link[data-city]').removeClass('disabled');\r\n\t\t\t\t// $btn.addClass('disabled');\r\n\t\t\t\tself.updateFilterCityLayout(cityID);\r\n\t\t\t\tself.emit('filter', self.getFilterParams());\r\n\t\t\t});\r\n\t\t\tthis.$filter.on('click', '.btn-link[data-area]', function (e) {\r\n\t\t\t\tvar $btn = $(this);\r\n\t\t\t\tvar areaID = $btn.attr('data-area');\r\n\t\t\t\t// self.$filter.find('.btn-link[data-area]').removeClass('disabled');\r\n\t\t\t\t// $btn.addClass('disabled');\r\n\t\t\t\tself.updateFilterAreaLayout(areaID);\r\n\t\t\t\tself.emit('filter', self.getFilterParams());\r\n\t\t\t});\r\n\t\t\tthis.$query.on('click', '.create-shop', function (e) {\r\n\t\t\t\tvar $btn = $(this);\r\n\t\t\t\tdocument.location.href = Hualala.PageRoute.createPath('shopCreate');\r\n\t\t\t});\r\n\t\t\tthis.$query.on('click', '.query-btn', function (e) {\r\n\t\t\t\tvar $btn = $(this);\r\n\t\t\t\tvar shopID = self.keywordLst || null,\r\n\t\t\t\t\tshop = null, cityID = -1, areaID = -1;\r\n\t\t\t\tif (!IX.isEmpty(shopID)) {\r\n\t\t\t\t\tshop = self.model.getShops(shopID)[0];\r\n\t\t\t\t\tcityID = $XP(shop, 'cityID', -1);\r\n\t\t\t\t\tareaID = $XP(shop, 'areaID', -1);\r\n\t\t\t\t}\r\n\t\t\t\tself.updateFilterCityLayout(cityID);\r\n\t\t\t\tself.updateFilterAreaLayout(areaID);\r\n\t\t\t\tself.emit('query', self.getQueryParams());\r\n\t\t\t});\r\n\t\t\tthis.$query.on('keyup', '.chosen-container', function (e) {\r\n\t\t\t\tvar $this = $(this);\r\n\t\t\t\tif ($this.hasClass('chosen-container-active') && !$this.hasClass('chosen-with-drop')) {\r\n\t\t\t\t\t$this.find('input').first().trigger('blur.chosen');\r\n\t\t\t\t\tself.$query.find('.query-btn').trigger('click');\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t},\r\n\t\tdestroy : function () {\r\n\t\t\tthis.isReady = false;\r\n\t\t\tthis.needShopCreate = false;\r\n\t\t\tthis.$container.find('.shop-query').remove();\r\n\t\t\tthis.$queryBox = null;\r\n\t\t\tthis.$filter = null;\r\n\t\t\tthis.$query = null;\r\n\t\t},\r\n\t\t// 获取过滤参数\r\n\t\tgetFilterParams : function () {\r\n\t\t\t// TODO\r\n\t\t\tvar self = this;\r\n\t\t\tvar focusedBtn = self.$filter.find('.btn-link.disabled');\r\n\t\t\tvar cityID = focusedBtn.filter('[data-city]').attr('data-city'),\r\n\t\t\t\tareaID = focusedBtn.filter('[data-area]').attr('data-area');\r\n\t\t\tcityID = (!cityID || cityID == -1) ? '' : cityID;\r\n\t\t\tareaID = (!areaID || areaID == -1) ? '' : areaID;\r\n\t\t\treturn {\r\n\t\t\t\tcityID : cityID,\r\n\t\t\t\tareaID : areaID,\r\n\t\t\t\tkeywordLst : ''\r\n\t\t\t};\r\n\t\t},\r\n\t\t// 获取搜索参数\r\n\t\tgetQueryParams : function () {\r\n\t\t\t// TODO\r\n\t\t\tvar self = this;\r\n\t\t\tvar keywordLst = self.keywordLst || null;\r\n\t\t\tvar params = self.getFilterParams();\r\n\t\t\tvar shops = self.model.getShops();\r\n\t\t\tif (IX.isEmpty(keywordLst)) {\r\n\t\t\t\tkeywordLst = '';\r\n\t\t\t} else {\r\n\t\t\t\tkeywordLst = $XP(_.find(shops, function (el) {\r\n\t\t\t\t\treturn $XP(el, 'shopID') == keywordLst;\r\n\t\t\t\t}), 'shopName', '');\r\n\t\t\t}\r\n\t\t\treturn IX.inherit(params, {\r\n\t\t\t\tkeywordLst : keywordLst\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t});\r\n\tHualala.Shop.QueryView = QueryView;\r\n})(jQuery, window);;(function ($, window) {\r\n\tIX.ns(\"Hualala.Shop\");\r\n\tvar popoverMsg = Hualala.UI.PopoverMsgTip;\r\n\tvar toptip = Hualala.UI.TopTip;\r\n\tvar QueryModel = Hualala.Shop.QueryModel;\r\n\tvar QueryView = Hualala.Shop.QueryView;\r\n\tvar QueryController = Stapes.subclass({\r\n\t\t/**\r\n\t\t * 店铺查询控制器\r\n\t\t * @param  {Object} cfg 配置数据\r\n\t\t *            @param {Boolean} cfg.needShopCreate 是否开启创建店铺功能\r\n\t\t *            @param {JQueryObj} container 容器\r\n\t\t *            @param {Object} resultController 结果输出控制器\r\n\t\t * @return {Object}     \r\n\t\t */\r\n\t\tconstructor : function (cfg) {\r\n\t\t\tthis.set({\r\n\t\t\t\tsessionData : Hualala.getSessionData()\r\n\t\t\t});\r\n\t\t\tthis.container = $XP(cfg, 'container', null);\r\n\t\t\tthis.needShopCreate = $XP(cfg, 'needShopCreate', false);\r\n\t\t\tthis.resultController = $XP(cfg, 'resultController', null);\r\n\t\t\tthis.model = new QueryModel();\r\n\t\t\tthis.view = new QueryView();\r\n\t\t\tthis.init();\r\n\t\t}\r\n\t});\r\n\tQueryController.proto({\r\n\t\t// 初始化控制器\r\n\t\tinit : function () {\r\n\t\t\tvar self = this;\r\n\t\t\tself.bindEvent();\r\n\t\t\tself.model.emit('load', function () {\r\n\t\t\t\tif (!self.model.hasReady()) {\r\n\t\t\t\t\tthrow(\"Shop Query Init Failed!!\");\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\t// 加载View层\r\n\t\t\t\tself.view.emit('init');\r\n\t\t\t});\r\n\t\t},\r\n\t\t// 绑定事件\r\n\t\tbindEvent : function () {\r\n\t\t\t// 控制器的事件绑定\r\n\t\t\tthis.on({\r\n\t\t\t\treload : function () {\r\n\t\t\t\t\tvar self = this;\r\n\t\t\t\t\tself.model.distory();\r\n\t\t\t\t\tself.view.distory();\r\n\t\t\t\t\tself.init();\r\n\t\t\t\t},\r\n\t\t\t\tquery : function (params) {\r\n\t\t\t\t\tvar self = this;\r\n\t\t\t\t\tIX.Debug.info(\"DEBUG: Shop Query Controller Query Params : \");\r\n\t\t\t\t\tIX.Debug.info(params);\r\n\t\t\t\t\tself.resultController && self.resultController.emit('load', IX.inherit(params, {\r\n\t\t\t\t\t\tpageNo : 1,\r\n\t\t\t\t\t\tpageSize : 15\r\n\t\t\t\t\t}));\r\n\t\t\t\t}\r\n\t\t\t}, this);\r\n\t\t\t// 模型的事件绑定\r\n\t\t\tthis.model.on({\r\n\t\t\t\tload : function (cbFn) {\r\n\t\t\t\t\tvar self = this,\r\n\t\t\t\t\t\tparams = $XP(self.get('sessionData'), 'user', {});\r\n\t\t\t\t\tself.model.init(params, cbFn);\r\n\t\t\t\t}\r\n\t\t\t}, this);\r\n\t\t\t// 视图事件绑定\r\n\t\t\tthis.view.on({\r\n\t\t\t\tinit : function () {\r\n\t\t\t\t\tvar self = this;\r\n\t\t\t\t\tself.view.init({\r\n\t\t\t\t\t\tmodel : self.model,\r\n\t\t\t\t\t\tneedShopCreate : self.needShopCreate,\r\n\t\t\t\t\t\tcontainer : self.container\r\n\t\t\t\t\t});\r\n\t\t\t\t},\r\n\t\t\t\t// 过滤操作，触发显示结果\r\n\t\t\t\tfilter : function (params) {\r\n\t\t\t\t\tvar self = this;\r\n\t\t\t\t\tself.emit('query', params);\r\n\t\t\t\t\t//TODO 重置Query的chosenPanel\r\n\t\t\t\t},\r\n\t\t\t\t// 搜索操作，触发显示结果\r\n\t\t\t\tquery : function (params) {\r\n\t\t\t\t\tvar self = this;\r\n\t\t\t\t\tself.emit('query', params);\r\n\t\t\t\t}\r\n\t\t\t}, this);\r\n\t\t}\r\n\t});\r\n\tHualala.Shop.QueryController = QueryController;\r\n})(jQuery, window);;(function ($, window) {\r\n\tIX.ns(\"Hualala.Shop\");\r\n\tvar popoverMsg = Hualala.UI.PopoverMsgTip;\r\n\tvar toptip = Hualala.UI.TopTip;\r\n\tvar CardListModel = Stapes.subclass({\r\n\t\t/**\r\n\t\t * 构造卡片店铺列表的数据模型\r\n\t\t * @param  {Object} cfg 配置信息\r\n\t\t *           @param {Function} callServer 获取数据接口\r\n\t\t * @return {Object}     \r\n\t\t */\r\n\t\tconstructor : function (cfg) {\r\n\t\t\tthis.callServer = $XP(cfg, 'callServer', null);\r\n\t\t\tif (!this.callServer) {\r\n\t\t\t\tthrow(\"callServer is empty!\");\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t}\r\n\t});\r\n\tCardListModel.proto({\r\n\t\tinit : function (params) {\r\n\t\t\tthis.set({\r\n\t\t\t\tpageCount : 0,\r\n\t\t\t\ttotalSize : 0,\r\n\t\t\t\tpageNo : $XP(params, 'pageNo', 1),\r\n\t\t\t\tpageSize : $XP(params, 'pageSize', 15),\r\n\t\t\t\tcityID : $XP(params, 'cityID', ''),\r\n\t\t\t\tareaID : $XP(params, 'areaID', ''),\r\n\t\t\t\tkeywordLst : $XP(params, 'keywordLst', ''),\r\n\t\t\t\tds_shop : new IX.IListManager(),\r\n\t\t\t\tds_page : new IX.IListManager()\r\n\t\t\t});\r\n\t\t},\r\n\t\tupdatePagerParams : function (params) {\r\n\t\t\tvar self = this;\r\n\t\t\tvar pagerParamkeys = 'pageCount,totalSize,pageNo,pageSize,cityID,areaID,keywordLst';\r\n\t\t\t// _.each(pagerParamkeys.split(','), function (k, i, l) {\r\n\t\t\t// \tswitch(k) {\r\n\t\t\t// \t\tcase 'pageCount': \r\n\t\t\t// \t\tcase 'totalSize' :\r\n\t\t\t// \t\t\tself.set(k, $XP(params, k, 0));\r\n\t\t\t// \t\t\tbreak;\r\n\t\t\t// \t\tcase 'pageNo' : \r\n\t\t\t// \t\t\tself.set(k, $XP(params, k, 1));\r\n\t\t\t// \t\t\tbreak;\r\n\t\t\t// \t\tcase 'pageSize' :\r\n\t\t\t// \t\t\tself.set(k, $XP(params, k, 15));\r\n\t\t\t// \t\t\tbreak;\r\n\t\t\t// \t\tdefault:\r\n\t\t\t// \t\t\tself.set(k, $XP(params, k, ''));\r\n\t\t\t// \t\t\tbreak;\r\n\t\t\t// \t}\r\n\t\t\t// });\r\n\t\t\t_.each(params, function (v, k, l) {\r\n\t\t\t\tif (pagerParamkeys.indexOf(k) > -1) {\r\n\t\t\t\t\tself.set(k, v);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t},\r\n\t\tgetPagerParams : function () {\r\n\t\t\t// return {\r\n\t\t\t// \tPage : {\r\n\t\t\t// \t\tpageNo : this.get('pageNo'),\r\n\t\t\t// \t\tpageSize : this.get('pageSize')\r\n\t\t\t// \t},\r\n\t\t\t// \tcityID : this.get('cityID'),\r\n\t\t\t// \tareaID : this.get('areaID'),\r\n\t\t\t// \tkeywordLst : this.get('keywordLst')\r\n\t\t\t// };\r\n\t\t\treturn {\r\n\t\t\t\tpageNo : this.get('pageNo'),\r\n\t\t\t\tpageSize : this.get('pageSize'),\r\n\t\t\t\tcityID : this.get('cityID'),\r\n\t\t\t\tareaID : this.get('areaID'),\r\n\t\t\t\tkeywordLst : this.get('keywordLst')\r\n\t\t\t};\r\n\t\t},\r\n\t\tupdateDataStore : function (data, pageNo) {\r\n\t\t\tvar self = this,\r\n\t\t\t\tshopHT = self.get('ds_shop'),\r\n\t\t\t\tpageHT = self.get('ds_page');\r\n\t\t\tvar shopIDs = _.map(data, function (shop, i, l) {\r\n\t\t\t\t// var shopID = $XP(shop, 'shopID');\r\n\t\t\t\t// shopHT.register(shopID, shop);\r\n\t\t\t\t// return shopID;\r\n\t\t\t\tvar shopID = $XP(shop, 'shopID'),\r\n\t\t\t\t\tmShop = new BaseShopModel(shop);\r\n\t\t\t\tshopHT.register(shopID, mShop);\r\n\t\t\t\treturn shopID;\r\n\t\t\t});\r\n\t\t\tpageHT.register(pageNo, shopIDs);\r\n\t\t},\r\n\t\tresetDataStore : function () {\r\n\t\t\tvar self = this,\r\n\t\t\t\tshopHT = self.get('ds_shop'),\r\n\t\t\t\tpageHT = self.get('ds_page');\r\n\t\t\tshopHT.clear();\r\n\t\t\tpageHT.clear();\r\n\t\t},\r\n\t\tload : function (params, cbFn) {\r\n\t\t\tvar self = this;\r\n\t\t\tself.updatePagerParams(params);\r\n\t\t\tself.callServer(self.getPagerParams(), function (res) {\r\n\t\t\t\tif (res.resultcode == '000') {\r\n\t\t\t\t\tself.updateDataStore($XP(res, 'data.records', []), $XP(res, 'data.page.pageNo'));\r\n\t\t\t\t\tself.updatePagerParams($XP(res, 'data.page', {}));\r\n\t\t\t\t} else {\r\n\t\t\t\t\ttoptip({\r\n\t\t\t\t\t\tmsg : $XP(res, 'resultmsg', ''),\r\n\t\t\t\t\t\ttype : 'danger'\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t\tcbFn(self);\r\n\t\t\t});\r\n\t\t},\r\n\t\tgetShops : function (pageNo) {\r\n\t\t\tvar self = this,\r\n\t\t\t\tshopHT = self.get('ds_shop'),\r\n\t\t\t\tpageHT = self.get('ds_page');\r\n\t\t\tvar ret = _.map(shopHT.getByKeys(pageHT.get(pageNo)), function (mShop, i, l) {\r\n\t\t\t\treturn mShop.getAll();\r\n\t\t\t});\r\n\t\t\tIX.Debug.info(\"DEBUG: Shop Card List Model PageData : \");\r\n\t\t\tIX.Debug.info(ret);\r\n\t\t\treturn ret;\r\n\t\t},\r\n\t\tgetShopModelByShopID : function (shopID) {\r\n\t\t\tvar self = this,\r\n\t\t\t\tshopHT = self.get('ds_shop');\r\n\t\t\treturn shopHT.get(shopID);\r\n\t\t},\r\n\t\t// 更新店铺状态\r\n\t\tupdateShopStatus : function (shopID, status, failFn, successFn) {\r\n\t\t\tvar self = this,\r\n\t\t\t\tshopHT = self.get('ds_shop');\r\n\t\t\tvar shop = shopHT.get(shopID);\r\n\t\t\t// shop = IX.inherit(shop, {\r\n\t\t\t// \tstatus : status\r\n\t\t\t// });\r\n\t\t\t// shopHT.register(shopID, shop);\r\n\t\t\t// shop.set('status', status);\r\n\t\t\tshop.emit('switchShopStatus', {\r\n\t\t\t\tstatus : status,\r\n\t\t\t\tfailFn : failFn,\r\n\t\t\t\tsuccessFn : successFn\r\n\t\t\t});\r\n\t\t},\r\n\t\t// 更新店铺业务状态\r\n\t\tupdateShopBusinessStatus : function (params, failFn, successFn) {\r\n\t\t\tvar self = this,\r\n\t\t\t\tshopHT = self.get('ds_shop'),\r\n\t\t\t\tshopID = $XP(params, 'shopID'),\r\n\t\t\t\tshop = shopHT.get(shopID);\r\n\t\t\tshop.emit('switchBusinessStatus', {\r\n\t\t\t\tname : $XP(params, 'name'),\r\n\t\t\t\tid : $XP(params, 'id'),\r\n\t\t\t\tstatus : $XP(params, 'status', 0),\r\n\t\t\t\tfailFn : failFn,\r\n\t\t\t\tsuccessFn : successFn\r\n\t\t\t});\r\n\r\n\t\t}\r\n\t});\r\n\r\n\r\n\tHualala.Shop.CardListModel = CardListModel;\r\n\r\n\tvar BaseShopModel = Stapes.subclass({\r\n\t\tconstructor : function (shop) {\r\n\t\t\tthis.switchShopStatusCallServer = Hualala.Global.switchShopStatus;\r\n\t\t\tthis.switchShopBusinessStatusCallServer = Hualala.Global.switchShopServiceFeatureStatus;\r\n\t\t\tthis.set(shop);\r\n\t\t\tthis.bindEvent();\r\n\t\t}\r\n\t});\r\n\tBaseShopModel.proto({\r\n\t\tswitchShopStatus : function (status, failFn, successFn) {\r\n\t\t\tvar self = this,\r\n\t\t\t\tshopID = self.get('shopID');\r\n\t\t\tself.set('status', status);\r\n\t\t\tIX.Debug.info(\"DEBUG: Base Shop Model [\" + self.get('shopID') + \"] Status :\" + status);\r\n\t\t\tthis.switchShopStatusCallServer({\r\n\t\t\t\tshopID : shopID,\r\n\t\t\t\tstatus : status\r\n\t\t\t}, function (res) {\r\n\t\t\t\tif (res.resultcode !== '000') {\r\n\t\t\t\t\t\r\n\t\t\t\t\ttoptip({\r\n\t\t\t\t\t\tmsg : $XP(res, 'resultmsg', ''),\r\n\t\t\t\t\t\ttype : 'danger'\r\n\t\t\t\t\t});\r\n\t\t\t\t\tself.set('status', !status ? 1 : 0);\r\n\t\t\t\t\tfailFn(shopID);\r\n\t\t\t\t\t\r\n\t\t\t\t} else {\r\n\t\t\t\t\ttoptip({\r\n\t\t\t\t\t\tmsg : !status ? '关闭成功！' : '开启成功！',\r\n\t\t\t\t\t\ttype : 'success'\r\n\t\t\t\t\t});\r\n\t\t\t\t\tsuccessFn(shopID);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t},\r\n\t\tswitchShopBusinessStatus : function (params) {\r\n\t\t\tvar self = this,\r\n\t\t\t\tshopID = self.get('shopID');\r\n\t\t\tvar failFn = $XF(params, 'failFn'),\r\n\t\t\t\tsuccessFn = $XF(params, 'successFn'),\r\n\t\t\t\tname = $XP(params, 'name'),\r\n\t\t\t\tid = $XP(params, 'id'),\r\n\t\t\t\tstatus = $XP(params, 'status');\r\n\t\t\tvar setServiceFeature = function (sName, s) {\r\n\t\t\t\tvar serviceFeatures = self.get('serviceFeatures').split(',');\r\n\t\t\t\t// 更新serviceFeature\r\n\t\t\t\tif (s == 1) {\r\n\t\t\t\t\tserviceFeatures.push(sName);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tserviceFeatures = _.filter(serviceFeatures, function (el) {\r\n\t\t\t\t\t\treturn el !== sName;\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t\tself.set('serviceFeatures', serviceFeatures.join(','));\r\n\t\t\t};\r\n\t\t\tsetServiceFeature(name, status);\r\n\t\t\tIX.Debug.info(\"DEBUG: Switch Shop [\" + self.get('shopID') + \"] ServiceFeature: \" + self.get('serviceFeatures'));\r\n\t\t\tthis.switchShopBusinessStatusCallServer({\r\n\t\t\t\tshopID : shopID,\r\n\t\t\t\tserviceFeatures : name,\r\n\t\t\t\toperation : status\r\n\t\t\t}, function (res) {\r\n\t\t\t\tif (res.resultcode !== '000') {\r\n\t\t\t\t\ttoptip({\r\n\t\t\t\t\t\tmsg : $XP(res, 'resultmsg', ''),\r\n\t\t\t\t\t\ttype : 'danger'\r\n\t\t\t\t\t});\r\n\t\t\t\t\tsetServiceFeature(name, !status ? 1 : 0);\r\n\t\t\t\t\tfailFn({\r\n\t\t\t\t\t\tshopID : shopID,\r\n\t\t\t\t\t\tid : id\r\n\t\t\t\t\t});\r\n\t\t\t\t} else {\r\n\t\t\t\t\ttoptip({\r\n\t\t\t\t\t\tmsg : !status ? '关闭成功！' : '开启成功！',\r\n\t\t\t\t\t\ttype : 'success'\r\n\t\t\t\t\t});\r\n\t\t\t\t\tsuccessFn({\r\n\t\t\t\t\t\tmShop : self,\r\n\t\t\t\t\t\tid : id,\r\n\t\t\t\t\t\tname : name\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t},\r\n\t\tbindEvent : function () {\r\n\t\t\tvar self = this;\r\n\t\t\tthis.on({\r\n\t\t\t\t\"switchShopStatus\" : function (params) {\r\n\t\t\t\t\tvar status = $XP(params, 'status'),\r\n\t\t\t\t\t\tfailFn = $XF(params, 'failFn'),\r\n\t\t\t\t\t\tsuccessFn = $XF(params, 'successFn');\r\n\t\t\t\t\tthis.switchShopStatus(status, failFn, successFn);\r\n\t\t\t\t},\r\n\t\t\t\t\"switchBusinessStatus\" : function (params) {\r\n\t\t\t\t\tthis.switchShopBusinessStatus(params);\r\n\t\t\t\t},\r\n\t\t\t\t\"setServiceParams\" : function (cfg) {\r\n\t\t\t\t\tvar callServer = $XF(cfg, 'callServer'),\r\n\t\t\t\t\t\tparams = $XP(cfg, 'params', {}),\r\n\t\t\t\t\t\tserviceID = $XP(cfg, 'serviceID'),\r\n\t\t\t\t\t\tshopID = self.get('shopID'),\r\n\t\t\t\t\t\tfailFn = $XF(cfg, 'failFn'),\r\n\t\t\t\t\t\tsuccessFn = $XF(cfg, 'successFn');\r\n\t\t\t\t\tcallServer(IX.inherit(params, {\r\n\t\t\t\t\t\tshopID : shopID,\r\n\t\t\t\t\t\tstrType : serviceID\r\n\t\t\t\t\t}), function (res) {\r\n\t\t\t\t\t\tif (res.resultcode !== '000') {\r\n\t\t\t\t\t\t\ttoptip({\r\n\t\t\t\t\t\t\t\tmsg : $XP(res, 'resultmsg', ''),\r\n\t\t\t\t\t\t\t\ttype : 'danger'\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\tfailFn();\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tvar newData = {};\r\n\t\t\t\t\t\t\tnewData[serviceID] = params;\r\n\t\t\t\t\t\t\t// var revParamJson = JSON.parse(self.get('revParamJson'));\r\n\t\t\t\t\t\t\tvar revParamJson = self.get('revParamJson') || null,\r\n\t\t\t\t\t\t\t\ttakeawayParamJson = self.get('takeawayParamJson') || null;\r\n\t\t\t\t\t\t\tvar serviceFeatures = self.get('serviceFeatures');\r\n\t\t\t\t\t\t\trevParamJson = !revParamJson ? {} : JSON.parse(revParamJson);\r\n\t\t\t\t\t\t\ttakeawayParamJson = !takeawayParamJson ? {} : JSON.parse(takeawayParamJson);\r\n\t\t\t\t\t\t\tif (serviceID == 20 || serviceID == 21) {\r\n\t\t\t\t\t\t\t\ttakeawayParamJson = IX.inherit(takeawayParamJson, newData);\r\n\t\t\t\t\t\t\t\t// self.set('revParamJson', JSON.stringify(takeawayParamJson));\r\n\t\t\t\t\t\t\t\tself.set('takeawayParamJson', JSON.stringify(takeawayParamJson));\r\n\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\trevParamJson = IX.inherit(revParamJson, newData);\r\n\t\t\t\t\t\t\t\tself.set('revParamJson', JSON.stringify(revParamJson));\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\tif (serviceID == 41) {\r\n\t\t\t\t\t\t\t\tvar checkSpotOrder = $XP(params, 'checkSpotOrder', 0);\r\n\t\t\t\t\t\t\t\tif (checkSpotOrder == 0) {\r\n\t\t\t\t\t\t\t\t\tserviceFeatures = serviceFeatures.replace('spot_pay,', '');\r\n\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\tserviceFeatures = serviceFeatures.concat('spot_pay,');\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\tself.set('serviceFeatures', serviceFeatures);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tsuccessFn();\r\n\t\t\t\t\t\t\ttoptip({\r\n\t\t\t\t\t\t\t\tmsg : '配置成功!',\r\n\t\t\t\t\t\t\t\ttype : 'success'\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\t});\r\n})(jQuery, window);;(function ($, window) {\r\n\tIX.ns(\"Hualala.Shop\");\r\n\tvar popoverMsg = Hualala.UI.PopoverMsgTip;\r\n\tvar toptip = Hualala.UI.TopTip;\r\n\tvar CardListView = Stapes.subclass({\r\n\t\tconstructor : function () {\r\n\t\t\t// View层容器\r\n\t\t\tthis.$container = null;\r\n\t\t\t// 结果容器\r\n\t\t\tthis.$resultBox = null;\r\n\t\t\t// 结果列表\r\n\t\t\tthis.$list = null;\r\n\t\t\t// 分页容器\r\n\t\t\tthis.$pager = null;\r\n\t\t\tthis.emptyBar = null;\r\n\t\t\tthis.loadTemplates();\r\n\t\t}\r\n\t});\r\n\tCardListView.proto({\r\n\t\tinit : function (cfg) {\r\n\t\t\tthis.$container = $XP(cfg, 'container', null);\r\n\t\t\tthis.model = $XP(cfg, 'model', null);\r\n\t\t\tif (!this.$container || !this.model) {\r\n\t\t\t\tthrow(\"CardList View Init Failed!\");\r\n\t\t\t\treturn ;\r\n\t\t\t}\r\n\t\t\tthis.initLayout();\r\n\t\t},\r\n\t\tinitLayout : function () {\r\n\t\t\tvar layoutTpl = this.get('layoutTpl');\r\n\t\t\tvar htm = layoutTpl();\r\n\t\t\tthis.$container.append(htm);\r\n\t\t\tthis.$resultBox = this.$container.find('.shop-list');\r\n\t\t\tthis.$list = this.$container.find('.shop-list-body');\r\n\t\t\tthis.$pager = this.$container.find('.page-selection');\r\n\t\t\tthis.initPager();\r\n\t\t\tthis.bindEvent();\r\n\t\t},\r\n\t\tinitPager : function (params) {\r\n\t\t\tvar baseCfg = {\r\n\t\t\t\ttotal : 0,\r\n\t\t\t\tpage : 1,\r\n\t\t\t\tmaxVisible : 10,\r\n\t\t\t\tleaps : true\r\n\t\t\t};\r\n\t\t\tthis.$pager.IXPager(IX.inherit(baseCfg, params));\r\n\t\t},\r\n\t\tbindEvent : function () {\r\n\t\t\tvar self = this;\r\n\t\t\tself.$list.tooltip({\r\n\t\t\t\tselector : '[title]'\r\n\t\t\t});\r\n\t\t\tself.$list.on('click', '.btn[data-href]', function (e) {\r\n\t\t\t\tvar $btn = $(this),\r\n\t\t\t\t\tpath = $btn.attr('data-href');\r\n\t\t\t\tif (!IX.isEmpty(path)) {\r\n\t\t\t\t\tdocument.location.href = path;\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\tself.$pager.on('page', function (e, pageNo) {\r\n\t\t\t\tvar params = self.model.getPagerParams();\r\n\t\t\t\tparams['pageNo'] = pageNo;\r\n\t\t\t\tself.model.emit('load', IX.inherit(params, {\r\n\t\t\t\t\tpageNo : $XP(params, 'pageNo', 1),\r\n\t\t\t\t\tpageSize : $XP(params, 'pageSize', 15)\r\n\t\t\t\t}));\r\n\t\t\t});\r\n\t\t},\r\n\t\t// 加载View层所需模板\r\n\t\tloadTemplates : function () {\r\n\t\t\tvar layoutTpl = Handlebars.compile(Hualala.TplLib.get('tpl_shop_list_layout')),\r\n\t\t\t\tlistTpl = Handlebars.compile(Hualala.TplLib.get('tpl_shop_list')),\r\n\t\t\t\titemTpl = Handlebars.compile(Hualala.TplLib.get('tpl_shop_card')),\r\n\t\t\t\ttagTpl = Handlebars.compile(Hualala.TplLib.get('tpl_shop_tags'));\r\n\t\t\t// 注册shopCard子模板\r\n\t\t\tHandlebars.registerPartial(\"shopTag\", Hualala.TplLib.get('tpl_shop_tags'));\r\n\t\t\tHandlebars.registerPartial(\"shopCard\", Hualala.TplLib.get('tpl_shop_card'));\r\n\r\n\t\t\tthis.set({\r\n\t\t\t\tlayoutTpl : layoutTpl,\r\n\t\t\t\tlistTpl : listTpl,\r\n\t\t\t\titemTpl : itemTpl,\r\n\t\t\t\ttagTpl : tagTpl\r\n\t\t\t});\r\n\t\t},\r\n\t\t// 组装标签\r\n\t\tmapTags : function (d) {\r\n\t\t\tvar self = this,\r\n\t\t\t\ttagKeys = 'areaName,cuisineName1,cuisineName2'.split(',');\r\n\t\t\tvar tags = _.map(tagKeys, function (k) {\r\n\t\t\t\treturn $XP(d, k, null);\r\n\t\t\t});\r\n\t\t\treturn _.filter(tags, function (t) {\r\n\t\t\t\treturn !IX.isEmpty(t);\r\n\t\t\t});\r\n\t\t},\r\n\t\t// 格式化渲染数据\r\n\t\tmapRenderData : function (data) {\r\n\t\t\tvar self = this;\r\n\t\t\tvar getTags = function (tags) {\r\n\t\t\t\treturn _.map(tags, function (t, i, l) {\r\n\t\t\t\t\treturn {\r\n\t\t\t\t\t\tclz : 'label-info',\r\n\t\t\t\t\t\ttag : t\r\n\t\t\t\t\t};\r\n\t\t\t\t});\r\n\t\t\t};\r\n\t\t\tvar ret = _.map(data, function (shop, i, l) {\r\n\t\t\t\tvar address = $XP(shop, 'address', ''),\r\n\t\t\t\t\tbyteLen = Hualala.Common.strByteLength(address),\r\n\t\t\t\t\tslugAddr = '';\r\n\t\t\t\tslugAddr = byteLen < 72 ? address : (Hualala.Common.substrByte(address, 70) + '...');\r\n\t\t\t\treturn {\r\n\t\t\t\t\tclz : '',\r\n\t\t\t\t\tid : $XP(shop, 'shopID', ''),\r\n\t\t\t\t\tname : $XP(shop, 'shopName', ''),\r\n\t\t\t\t\timg : Hualala.Common.getSourceImage($XP(shop, 'imagePath', ''), {\r\n\t\t\t\t\t\twidth : 100,\r\n\t\t\t\t\t\theight : 100,\r\n\t\t\t\t\t\tquality : 50\r\n\t\t\t\t\t}),\r\n\t\t\t\t\t// tags : getTags($XP(shop, 'tags', [])),\r\n\t\t\t\t\ttags : getTags(self.mapTags(shop)),\r\n\t\t\t\t\taddress : address,\r\n\t\t\t\t\tslugAddr : slugAddr,\r\n\t\t\t\t\ttel : $XP(shop, 'tel', ''),\r\n\t\t\t\t\tinfoHref : Hualala.PageRoute.createPath('shopInfo', [$XP(shop, 'shopID', '')]),\r\n\t\t\t\t\tmenuHref : Hualala.PageRoute.createPath('shopMenu', [$XP(shop, 'shopID', '')]),\r\n\t\t\t\t\tchecked : $XP(shop, 'status') == 1 ? 'checked' : ''\r\n\t\t\t\t};\r\n\t\t\t});\r\n\t\t\treturn {\r\n\t\t\t\tshopCard : {\r\n\t\t\t\t\tlist : ret\r\n\t\t\t\t}\r\n\t\t\t};\r\n\t\t},\r\n\t\t// 渲染开关\r\n\t\tinitSwitcher : function (selector) {\r\n\t\t\tvar self = this;\r\n\t\t\tself.$list.find(selector).bootstrapSwitch({\r\n\t\t\t\t// baseClass : 'ix-bs-switch',\r\n\t\t\t\t// wrapperClass : 'ix-bs-switch-wrapper',\r\n\t\t\t\tsize : 'normal',\r\n\t\t\t\tonColor : 'success',\r\n\t\t\t\toffColor : 'default',\r\n\t\t\t\tonText : '已开通',\r\n\t\t\t\toffText : '未开通'\r\n\t\t\t});\r\n\t\t\t// 绑定开关事件\r\n\t\t\tself.$list.find(selector).on('switchChange.bootstrapSwitch', function (e, state) {\r\n\t\t\t\tvar $chkbox = $(this),\r\n\t\t\t\t\tshopID = $chkbox.attr('data-shop'),\r\n\t\t\t\t\tstate = !state ? 0 : 1;\r\n\t\t\t\tHualala.UI.Confirm({\r\n\t\t\t\t\ttitle : (state == 1 ? \"开启\" : \"关闭\") + \"店铺\",\r\n\t\t\t\t\tmsg : \"你确定要\" + (state == 1 ? \"开启\" : \"关闭\") + \"店铺？\",\r\n\t\t\t\t\tokFn : function () {\r\n\t\t\t\t\t\tself.model.updateShopStatus(shopID, state, function (_shopID) {\r\n\t\t\t\t\t\t\tself.$list.find(selector).filter('[data-shop=' + _shopID + ']').bootstrapSwitch('toggleState', true);\r\n\t\t\t\t\t\t}, function (_shopID) {\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t},\r\n\t\t\t\t\tcancelFn : function () {\r\n\t\t\t\t\t\tself.$list.find(selector).filter('[data-shop=' + shopID + ']').bootstrapSwitch('toggleState', true);\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t});\r\n\t\t},\r\n\t\t// 渲染view\r\n\t\trender : function () {\r\n\t\t\tvar self = this,\r\n\t\t\t\tmodel = self.model,\r\n\t\t\t\tpagerParams = model.getPagerParams(),\r\n\t\t\t\tpageNo = $XP(pagerParams, 'pageNo');\r\n\t\t\tvar shops = model.getShops(pageNo);\r\n\t\t\tvar renderData = self.mapRenderData(shops);\r\n\t\t\tvar listTpl = self.get('listTpl');\r\n\t\t\tvar html = listTpl(renderData);\r\n\t\t\tself.emptyBar && self.emptyBar.destroy();\r\n\t\t\tself.$list.empty();\r\n\t\t\tif (shops.length == 0) {\r\n\t\t\t\tself.emptyBar = new Hualala.UI.EmptyPlaceholder({\r\n\t\t\t\t\tcontainer : self.$list\r\n\t\t\t\t});\r\n\t\t\t\tself.emptyBar.show();\r\n\t\t\t} else {\r\n\t\t\t\tself.$list.html(html);\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tself.initPager({\r\n\t\t\t\ttotal : model.get('pageCount'),\r\n\t\t\t\tpage : model.get('pageNo'),\r\n\t\t\t\thref : 'javascript:void(0);'\r\n\t\t\t});\r\n\t\t\t// self.$list.find(':checkbox[name*=switcher_]').bootstrapSwitch();\r\n\t\t\tself.initSwitcher(':checkbox[name=switcher]');\r\n\t\t}\r\n\t});\r\n\r\n\tHualala.Shop.CardListView = CardListView;\r\n\r\n\tvar ShopListView = CardListView.subclass({\r\n\t\tconstructor : function () {\r\n\t\t\t// View层容器\r\n\t\t\tthis.$container = null;\r\n\t\t\t// 结果容器\r\n\t\t\tthis.$resultBox = null;\r\n\t\t\t// 结果列表\r\n\t\t\tthis.$list = null;\r\n\t\t\t// 分页容器\r\n\t\t\tthis.$pager = null;\r\n\t\t\tthis.emptyBar = null;\r\n\t\t\t// 开关相关提示消息\r\n\t\t\tthis.shopBusinessSwitcherTipHT = new IX.IListManager();\r\n\t\t\tthis.loadTemplates();\r\n\t\t\tthis.initShopBusinessSwitcherTips();\r\n\t\t}\r\n\t});\r\n\tShopListView.proto({\r\n\t\tbindEvent : function () {\r\n\t\t\tvar self = this;\r\n\t\t\tself.$list.tooltip({\r\n\t\t\t\tselector : '[title]'\r\n\t\t\t});\r\n\t\t\tself.$pager.on('page', function (e, pageNo) {\r\n\t\t\t\tvar params = self.model.getPagerParams();\r\n\t\t\t\tparams['pageNo'] = pageNo;\r\n\t\t\t\tself.model.emit('load', IX.inherit(params, {\r\n\t\t\t\t\tpageNo : $XP(params, 'pageNo', 1),\r\n\t\t\t\t\tpageSize : $XP(params, 'pageSize', 15)\r\n\t\t\t\t}));\r\n\t\t\t});\r\n\t\t\t// 弹出修改业务窗口\r\n\t\t\tself.$list.on('click', '.btn[data-business]', function (e) {\r\n\t\t\t\tvar $btn = $(this),\r\n\t\t\t\t\tshopID = $btn.attr('data-shop'),\r\n\t\t\t\t\tmShop = self.model.getShopModelByShopID(shopID),\r\n\t\t\t\t\tbusinessName = $btn.attr('data-business'),\r\n\t\t\t\t\tbusinessID = $btn.attr('data-business-id'),\r\n\t\t\t\t\tserviceFeatures = mShop.get('serviceFeatures');\r\n\t\t\t\tself.initBusinessModal($btn, shopID, businessName, businessID, serviceFeatures);\r\n\t\t\t});\r\n\t\t\tself.$list.on('click', '.bind-settle', function (e) {\r\n\t\t\t\tvar $btn = $(this),\r\n\t\t\t\t\tsettleID = $btn.attr('data-id'),\r\n\t\t\t\t\tshopID = $btn.attr('data-shop');\r\n\t\t\t\tself.initBindSettleModal($btn, settleID, shopID);\r\n\t\t\t});\r\n\t\t},\r\n\t\t// 加载店铺业务开关相关的提示消息\r\n\t\tinitShopBusinessSwitcherTips : function () {\r\n\t\t\tvar self = this,\r\n\t\t\t\ttips = Hualala.TypeDef.ShopBusinessSwitcherTips;\r\n\t\t\t_.each(tips, function (tip) {\r\n\t\t\t\tvar name = $XP(tip, 'name');\r\n\t\t\t\tself.shopBusinessSwitcherTipHT.register(name, tip);\r\n\t\t\t});\r\n\t\t},\r\n\t\t// 通过名字获取店铺业务开关相关提示信息\r\n\t\tgetBusinessSwitcherTipsByName : function (name) {\r\n\t\t\tvar self = this,\r\n\t\t\t\tht = self.shopBusinessSwitcherTipHT;\r\n\t\t\treturn ht.get(name);\r\n\t\t},\r\n\t\t// 加载View层所需模板\r\n\t\tloadTemplates : function () {\r\n\t\t\tvar layoutTpl = Handlebars.compile(Hualala.TplLib.get('tpl_shop_list_layout')),\r\n\t\t\t\tlistTpl = Handlebars.compile(Hualala.TplLib.get('tpl_shop_list')),\r\n\t\t\t\titemTpl = Handlebars.compile(Hualala.TplLib.get('tpl_shop_list_item')),\r\n\t\t\t\ttagTpl = Handlebars.compile(Hualala.TplLib.get('tpl_shop_tags'));\r\n\t\t\t// 注册shopCard子模板\r\n\t\t\tHandlebars.registerPartial(\"shopTag\", Hualala.TplLib.get('tpl_shop_tags'));\r\n\t\t\tHandlebars.registerPartial(\"shopItem\", Hualala.TplLib.get('tpl_shop_list_item'));\r\n\r\n\t\t\tthis.set({\r\n\t\t\t\tlayoutTpl : layoutTpl,\r\n\t\t\t\tlistTpl : listTpl,\r\n\t\t\t\titemTpl : itemTpl,\r\n\t\t\t\ttagTpl : tagTpl\r\n\t\t\t});\r\n\t\t},\r\n\t\t/**\r\n\t\t * 获取店铺业务描述信息\r\n\t\t * @param  {Int} businessID    业务ID(10:常规预订,11:闪吃,20:外送,21:到店自提,41:店内自助)\r\n\t\t * @param  {Int} operationMode 餐厅运营模式 0：正餐；1：正餐\r\n\t\t * @param  {Object} businessInfo  业务配置信息\r\n\t\t * @param {String} businessName 业务名称\r\n\t\t * @param {String} ShopID 店铺ID\r\n\t\t * @return {String}               业务配置描述\r\n\t\t */\r\n\t\tgetBusinessDesc : function (businessID, operationMode, businessInfo, businessName, shopID) {\r\n\t\t\tvar self = this;\r\n\t\t\tvar tpl = null, renderKeys = null, params = null, htm = '';\r\n\t\t\tvar minuteIntervalOpts = Hualala.TypeDef.MinuteIntervalOptions();\r\n\t\t\tvar getMinutIntervalLabel = function (v) {\r\n\t\t\t\tvar m = _.find(minuteIntervalOpts, function (el, i) {\r\n\t\t\t\t\treturn $XP(el, 'value') == v;\r\n\t\t\t\t});\r\n\t\t\t\treturn $XP(m, 'label', '');\r\n\t\t\t};\r\n\t\t\tvar businessStatus = self.getBusinessSwitcherStatus(shopID, businessName),\r\n\t\t\t\tbusinessDesc = $XP(self.getBusinessSwitcherTipsByName(businessName), 'desc', '');\r\n\t\t\tswitch(businessID) {\r\n\t\t\t\t// 常规预定点菜\r\n\t\t\t\tcase 10:\r\n\t\t\t\t\ttpl = Handlebars.compile(Hualala.TplLib.get('tpl_shop_commonreserve_desc'));\r\n\t\t\t\t\trenderKeys = 'advanceTime,noticeTime,minAmount,reserveTableTime,reserveTableDesc,payMethod'.split(',');\r\n\t\t\t\t\tparams = _.map(renderKeys, function (k) {\r\n\t\t\t\t\t\tvar r = $XP(businessInfo, k, '');\r\n\t\t\t\t\t\tswitch(k) {\r\n\t\t\t\t\t\t\tcase \"advanceTime\":\r\n\t\t\t\t\t\t\t\tr = IX.isEmpty(r) || r == 0 ? '不限制顾客提前预定时间, ' : ('顾客需提前' + getMinutIntervalLabel(r) + '预订, ');\r\n\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\tcase \"noticeTime\":\r\n\t\t\t\t\t\t\t\tr = IX.isEmpty(r) || r == 0 ? '订单立即通知餐厅, ' : ('订单提前' + getMinutIntervalLabel(r) + '通知餐厅, ');\r\n\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\tcase \"minAmount\":\r\n\t\t\t\t\t\t\t\tr = IX.isEmpty(r) || r == 0 ? '' : ('最低消费' + r + Hualala.Constants.CashUnit + ', ');\r\n\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\tcase \"reserveTableTime\":\r\n\t\t\t\t\t\t\t\tr = IX.isEmpty(r) || r == 0 ? '' : ('留位' + getMinutIntervalLabel(r) + ', ');\r\n\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\tcase \"reserveTableDesc\":\r\n\t\t\t\t\t\t\t\tr = IX.isEmpty(r) ? '' : r + ',';\r\n\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\tcase \"payMethod\":\r\n\t\t\t\t\t\t\t\tr = (r == 0 ? '仅支持在线支付' : (r == 1 ? '仅支持线下支付' : '线上及线下支付均支持')) + ', ';\r\n\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\treturn r;\r\n\t\t\t\t\t});\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t// 闪吃描述\r\n\t\t\t\tcase 11:\r\n\t\t\t\t\ttpl = Handlebars.compile(Hualala.TplLib.get('tpl_shop_justeat_desc'));\r\n\t\t\t\t\trenderKeys = 'servicePeriods,holidayFlag,minAmount,advanceTime,noticeTime,reserveTableTime,reserveTableDesc,payMethod'.split(',');\r\n\t\t\t\t\tparams = _.map(renderKeys, function (k) {\r\n\t\t\t\t\t\tvar r = $XP(businessInfo, k, '');\r\n\t\t\t\t\t\tswitch(k) {\r\n\t\t\t\t\t\t\tcase \"servicePeriods\" :\r\n\t\t\t\t\t\t\t\tr = '开放时间段：' + r.replace(',', '-').replace(/([\\d]{2})([\\d]{2})/g, '$1:$2') + ', ';\r\n\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\tcase \"holidayFlag\" : \r\n\t\t\t\t\t\t\t\tr = (r == 0 ? '工作日及节假日均开放' : (r == 1 ? '仅节假日开放' : '仅工作日开放')) + ', ';\r\n\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\tcase \"minAmount\" : \r\n\t\t\t\t\t\t\t\tr = IX.isEmpty(r) || r == 0 ? '' : ('最低消费' + r + Hualala.Constants.CashUnit + ', ');\r\n\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\tcase \"advanceTime\" : \r\n\t\t\t\t\t\t\t\tr = IX.isEmpty(r) || r == 0 ? '不限制顾客提前预定时间, ' : ('顾客需提前' + getMinutIntervalLabel(r) + '预订, ');\r\n\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\tcase \"noticeTime\" : \r\n\t\t\t\t\t\t\t\tr = IX.isEmpty(r) || r == 0 ? '订单立即通知餐厅, ' : ('订单提前' + getMinutIntervalLabel(r) + '通知餐厅, ');\r\n\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\tcase \"reserveTableTime\" : \r\n\t\t\t\t\t\t\t\tr = IX.isEmpty(r) || r == 0 ? '' : ('留位' + getMinutIntervalLabel(r) + ', ');\r\n\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\tcase \"reserveTableDesc\" : \r\n\t\t\t\t\t\t\t\tr = IX.isEmpty(r) ? '' : r + ',';\r\n\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\tcase \"payMethod\":\r\n\t\t\t\t\t\t\t\tr = (r == 0 ? '仅支持在线支付' : (r == 1 ? '仅支持线下支付' : '线上及线下支付均支持')) + ', ';\r\n\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\treturn r;\r\n\t\t\t\t\t});\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t// 店内自助描述\r\n\t\t\t\tcase 41:\r\n\t\t\t\t\ttpl = Handlebars.compile(Hualala.TplLib.get('tpl_shop_spotorder_desc'));\r\n\t\t\t\t\trenderKeys = operationMode == 0 ?\r\n\t\t\t\t\t\t// 'isDinner,supportCommitToSoftware,payMethodAtShop,payBeforeCommit'.split(',') :\r\n\t\t\t\t\t\t'isDinner,supportCommitToSoftware,checkSpotOrder,payBeforeCommit'.split(',') :\r\n\t\t\t\t\t\t'isDinner,supportCommitToSoftware,fetchFoodMode'.split(',');\r\n\t\t\t\t\tparams = _.map(renderKeys, function (k) {\r\n\t\t\t\t\t\tvar r = $XP(businessInfo, k, '');\r\n\t\t\t\t\t\tswitch(k) {\r\n\t\t\t\t\t\t\tcase \"isDinner\":\r\n\t\t\t\t\t\t\t\tr = operationMode == 0 ? true : false;\r\n\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\tcase \"supportCommitToSoftware\":\r\n\t\t\t\t\t\t\t\tif (IX.isEmpty(r)) {\r\n\t\t\t\t\t\t\t\t\tr = '支持下单到餐饮软件, ';\r\n\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\tr = (r == 1 ? '支持' : '不支持') + '下单到餐饮软件, ';\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\tcase \"fetchFoodMode\":\r\n\t\t\t\t\t\t\t\tr = '下单后' + (r == 1 ? '凭牌号' : (r == 2 ? '直接' : '凭流水号')) + '在收银台取餐, ';\r\n\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\tcase \"checkSpotOrder\":\r\n\t\t\t\t\t\t\t\tr = (r == 1 ? '支持' : '不支持') + '顾客通过手机结账, ';\r\n\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\tcase \"payMethodAtShop\":\r\n\t\t\t\t\t\t\t\tr = (r == 1 ? '餐前先通过手机结账' : (r == 2 ? '餐后可通过手机结账' : '不能用手机结账')) + ', ';\r\n\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\tcase \"payBeforeCommit\":\r\n\t\t\t\t\t\t\t\t// r = r == 1 ? '支付完成后才能下单, ' : '';\r\n\t\t\t\t\t\t\t\tr = (r == 1 ? '餐前' : '餐后') + '结账, ';\r\n\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\treturn r;\r\n\t\t\t\t\t});\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t// 外卖\r\n\t\t\t\tcase 20:\r\n\t\t\t\t\ttpl = Handlebars.compile(Hualala.TplLib.get('tpl_shop_takeaway_desc'));\r\n\t\t\t\t\trenderKeys = 'servicePeriods,holidayFlag,noticeTime,takeawayDeliveryTime,minAmount,serviceAmount,freeServiceAmount,takeawayScope,payMethod'.split(',');\r\n\t\t\t\t\tparams = _.map(renderKeys, function (k) {\r\n\t\t\t\t\t\tvar r = $XP(businessInfo, k, '');\r\n\t\t\t\t\t\tswitch(k) {\r\n\t\t\t\t\t\t\tcase \"servicePeriods\" :\r\n\t\t\t\t\t\t\t\tr = '开放时间段：' + r.replace(',', '-').replace(/([\\d]{2})([\\d]{2})/g, '$1:$2') + ', ';\r\n\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\tcase \"holidayFlag\" : \r\n\t\t\t\t\t\t\t\tr = (r == 0 ? '工作日及节假日均开放' : (r == 1 ? '仅节假日开放' : '仅工作日开放')) + ', ';\r\n\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\tcase \"noticeTime\" : \r\n\t\t\t\t\t\t\t\tr = IX.isEmpty(r) || r == 0 ? '订单立即通知餐厅, ' : ('订单提前' + getMinutIntervalLabel(r) + '通知餐厅, ');\r\n\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\tcase \"takeawayDeliveryTime\" :\r\n\t\t\t\t\t\t\t\tr = IX.isEmpty(r) || r == 0 ? '立即送达, ' : ('预计' + r + '分钟送达, ');\r\n\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\tcase \"minAmount\":\r\n\t\t\t\t\t\t\t\tr = (IX.isEmpty(r) || r == 0 ? 0 : r) + '元起送, ';\r\n\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\tcase \"serviceAmount\" :\r\n\t\t\t\t\t\t\t\tr = IX.isEmpty(r) || r == 0 ? '免费送餐, ' : (r + '元送餐费');\r\n\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\tcase \"freeServiceAmount\" :\r\n\t\t\t\t\t\t\t\tr = IX.isEmpty(r) || r == 0 ? '' : ('(满' + r + '元免送餐费), ');\r\n\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\tcase \"takeawayScope\" :\r\n\t\t\t\t\t\t\t\tr = IX.isEmpty(r) || r == 0 ? '' : ('送餐范围' + r + '公里, ');\r\n\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\tcase \"payMethod\":\r\n\t\t\t\t\t\t\t\tr = (r == 0 ? '仅支持在线支付' : (r == 1 ? '仅支持线下支付' : '线上及线下支付均支持')) + ', ';\r\n\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\treturn r;\r\n\t\t\t\t\t});\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t// 自提\r\n\t\t\t\tcase 21:\r\n\t\t\t\t\ttpl = Handlebars.compile(Hualala.TplLib.get('tpl_shop_takeout_desc'));\r\n\t\t\t\t\trenderKeys = 'servicePeriods,holidayFlag,advanceTime,noticeTime,minAmount,payMethod'.split(',');\r\n\t\t\t\t\tparams = _.map(renderKeys, function (k) {\r\n\t\t\t\t\t\tvar r = $XP(businessInfo, k, '');\r\n\t\t\t\t\t\tswitch(k) {\r\n\t\t\t\t\t\t\tcase \"servicePeriods\" :\r\n\t\t\t\t\t\t\t\tr = '开放时间段：' + r.replace(',', '-').replace(/([\\d]{2})([\\d]{2})/g, '$1:$2') + ', ';\r\n\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\tcase \"holidayFlag\" : \r\n\t\t\t\t\t\t\t\tr = (r == 0 ? '工作日及节假日均开放' : (r == 1 ? '仅节假日开放' : '仅工作日开放')) + ', ';\r\n\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\tcase \"advanceTime\":\r\n\t\t\t\t\t\t\t\tr = IX.isEmpty(r) || r == 0 ? '不限制顾客提前预定时间, ' : ('顾客需提前' + getMinutIntervalLabel(r) + '预订, ');\r\n\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\tcase \"noticeTime\" : \r\n\t\t\t\t\t\t\t\tr = IX.isEmpty(r) || r == 0 ? '订单立即通知餐厅, ' : ('订单提前' + getMinutIntervalLabel(r) + '通知餐厅, ');\r\n\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\tcase \"minAmount\" : \r\n\t\t\t\t\t\t\t\tr = IX.isEmpty(r) || r == 0 ? '' : ('最低消费' + r + Hualala.Constants.CashUnit + ', ');\r\n\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\tcase \"payMethod\":\r\n\t\t\t\t\t\t\t\tr = (r == 0 ? '仅支持在线支付' : (r == 1 ? '仅支持线下支付' : '线上及线下支付均支持')) + ', ';\r\n\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\treturn r;\r\n\t\t\t\t\t});\r\n\t\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t\tif (businessID == 11 || businessID == 41 || businessID == 10 || businessID == 20 || businessID == 21) {\r\n\t\t\t\thtm = tpl(_.object(renderKeys, params));\r\n\t\t\t\thtm = htm.slice(0, htm.lastIndexOf(','));\r\n\t\t\t\thtm = businessStatus == 1 ? htm : businessDesc\r\n\t\t\t} else {\r\n\t\t\t\thtm = businessDesc;\r\n\t\t\t}\r\n\r\n\t\t\treturn htm;\r\n\t\t},\r\n\t\t// 获取店铺业务状态\r\n\t\t// @param name 店铺业务名称\r\n\t\tgetBusinessSwitcherStatus : function (shopID, name) {\r\n\t\t\tvar self = this,\r\n\t\t\t\tmShop = self.model.getShopModelByShopID(shopID);\r\n\t\t\tvar serviceFeatures = mShop.get('serviceFeatures') || '';\r\n\t\t\treturn serviceFeatures.indexOf(name) >= 0 ? 1 : 0;\r\n\t\t},\r\n\t\t// 获取店铺业务信息数据\r\n\t\tgetShopBusiness : function (shop) {\r\n\t\t\tvar self = this;\r\n\t\t\tvar business = Hualala.TypeDef.ShopBusiness,\r\n\t\t\t\tbusinessHT = new IX.IListManager(),\r\n\t\t\t\tshopID = $XP(shop, 'shopID'),\r\n\t\t\t\tserviceFeatures = $XP(shop, 'serviceFeatures', ''),\r\n\t\t\t\t// businessCfg = JSON.parse($XP(shop, 'revParamJson', {})),\r\n\t\t\t\tbusinessCfg = null,\r\n\t\t\t\trevParamJson = $XP(shop, 'revParamJson', null),\r\n\t\t\t\ttakeawayParamJson = $XP(shop, 'takeawayParamJson', null);\r\n\t\t\trevParamJson = !revParamJson ? {} : JSON.parse(revParamJson);\r\n\t\t\ttakeawayParamJson = !takeawayParamJson ? {} : JSON.parse(takeawayParamJson);\r\n\t\t\tbusinessCfg = IX.inherit(revParamJson, takeawayParamJson);\r\n\t\t\tvar ret = null;\r\n\t\t\t_.each(business, function (item, i, l) {\r\n\t\t\t\tvar id = $XP(item, 'id'), name = $XP(item, 'name'),\r\n\t\t\t\t\tswitcherStatus = self.getBusinessSwitcherStatus(shopID, name),\r\n\t\t\t\t\tbusinessInfo = $XP(businessCfg, id.toString(), {}),\r\n\t\t\t\t\toperationMode = $XP(shop, 'operationMode', null);\r\n\t\t\t\tif (id == '41') {\r\n\t\t\t\t\tbusinessInfo = IX.inherit(businessInfo, {\r\n\t\t\t\t\t\tcheckSpotOrder : serviceFeatures.indexOf('spot_pay') >= 0 ? 1 : 0\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t\tvar ret = IX.inherit(item, businessInfo, {\r\n\t\t\t\t\tswitcherStatus : switcherStatus,\r\n\t\t\t\t\tshopID : shopID,\r\n\t\t\t\t\tdesc : self.getBusinessDesc(id, operationMode, businessInfo, name, shopID)\r\n\t\t\t\t});\r\n\t\t\t\tbusinessHT.register(name, ret);\r\n\t\t\t});\r\n\t\t\tret = _.filter(businessHT.getAll(), function (el) {\r\n\t\t\t\treturn $XP(el, 'businessIsSupported', false) == true;\r\n\t\t\t});\r\n\t\t\treturn ret;\r\n\t\t},\r\n\t\t// 获取店铺业务信息渲染数据\r\n\t\tmapBusinessRenderData : function (shop) {\r\n\t\t\tvar self = this,\r\n\t\t\t\tdata = self.getShopBusiness(shop);\r\n\t\t\treturn _.map(data, function (el) {\r\n\t\t\t\tvar name = $XP(el, 'name'),\r\n\t\t\t\t\ticon = 'icon-' + name,\r\n\t\t\t\t\tswitcherName = 'switcher_business',\r\n\t\t\t\t\topen = $XP(el, 'switcherStatus') == 1 ? 'checked' : '';\r\n\t\t\t\treturn {\r\n\t\t\t\t\ticon : icon,\r\n\t\t\t\t\tlabel : $XP(el, 'label'),\r\n\t\t\t\t\tswitcherName : switcherName,\r\n\t\t\t\t\tshopID : $XP(el, 'shopID'),\r\n\t\t\t\t\ttype : name,\r\n\t\t\t\t\tid : $XP(el, 'id'),\r\n\t\t\t\t\topen : open,\r\n\t\t\t\t\tdesc : $XP(el, 'desc', ''),\r\n\t\t\t\t\tserviceFeatures : $XP(shop, 'serviceFeatures', ''),\r\n\t\t\t\t\thideBtn : (name == 'bi' || name == 'crm') ? 'disabled hidden' : ''\r\n\t\t\t\t};\r\n\t\t\t});\r\n\t\t},\r\n\t\t// 校验是否有财务或更高权限\r\n\t\tchkHasAccountRole : function () {\r\n\t\t\tvar loginUsr = Hualala.getSessionUser(),\r\n\t\t\t\tusrRoles = $XP(loginUsr, 'role');\r\n\t\t\t\troles = Hualala.TypeDef.SiteRoleType;\r\n\t\t\tvar ret = _.find(roles, function (role) {\r\n\t\t\t\tvar roleType = $XP(role, 'roleType');\r\n\t\t\t\tvar matchedID = _.find(usrRoles, function (v) {\r\n\t\t\t\t\treturn $XP(role, 'roleType') == v;\r\n\t\t\t\t});\r\n\t\t\t\treturn !!matchedID && (roleType != 'manager');\r\n\t\t\t});\r\n\t\t\treturn !!ret;\r\n\t\t},\r\n\t\t// 格式化渲染数据\r\n\t\tmapRenderData : function (data) {\r\n\t\t\tvar self = this;\r\n\t\t\tvar ret = _.map(data, function (shop, i, l) {\r\n\t\t\t\tvar settleUnitID = $XP(shop, 'settleID', '');\r\n\t\t\t\treturn {\r\n\t\t\t\t\tclz : '',\r\n\t\t\t\t\tshopID : $XP(shop, 'shopID', ''),\r\n\t\t\t\t\tshopName : $XP(shop, 'shopName', ''),\r\n\t\t\t\t\thideAccount : self.chkHasAccountRole() ? true : false,\r\n\t\t\t\t\tsettleID : settleUnitID,\r\n\t\t\t\t\tsettleName : $XP(shop, 'settleName', ''),\r\n\t\t\t\t\tbtn : {\r\n\t\t\t\t\t\tclz : 'bind-settle',\r\n\t\t\t\t\t\tlabel : (IX.isEmpty(settleUnitID) || settleUnitID == 0) ? '绑定结算账户' : '修改'\r\n\t\t\t\t\t},\r\n\t\t\t\t\tswitcherName : 'switcher_status',\r\n\t\t\t\t\tshopOpen : $XP(shop, 'status') == 1 ? 'checked' : '',\r\n\t\t\t\t\tbusiness : self.mapBusinessRenderData(shop)\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\treturn {\r\n\t\t\t\tshopItem : {\r\n\t\t\t\t\tlist : ret\r\n\t\t\t\t}\r\n\t\t\t};\r\n\t\t},\r\n\t\t// 渲染开关\r\n\t\tinitSwitcher : function (switcherName) {\r\n\t\t\tvar self = this;\r\n\t\t\tvar $switchers = self.$list.find(':checkbox[name=' + switcherName + ']');\r\n\t\t\tvar changeSubSwitchersStatus = function () {\r\n\t\t\t\t$switchers.each(function (idx, el) {\r\n\t\t\t\t\tvar $el = $(el),\r\n\t\t\t\t\t\tshopID = $el.attr('data-shop'),\r\n\t\t\t\t\t\t$parentSwitcher = $(':checkbox[name=switcher_status][data-shop=' + shopID + ']'),\r\n\t\t\t\t\t\tchecked = $parentSwitcher[0].checked;\r\n\t\t\t\t\t$el.bootstrapSwitch('disabled', !checked ? true : false);\r\n\t\t\t\t});\r\n\t\t\t};\r\n\t\t\t$switchers.bootstrapSwitch({\r\n\t\t\t\t// baseClass : 'ix-bs-switch',\r\n\t\t\t\t// wrapperClass : 'ix-bs-switch-wrapper',\r\n\t\t\t\tsize : 'normal',\r\n\t\t\t\tonColor : switcherName == 'switcher_business' ? 'primary' : 'success',\r\n\t\t\t\toffColor : 'default',\r\n\t\t\t\tonText : '已开通',\r\n\t\t\t\toffText : '未开通'\r\n\t\t\t});\r\n\t\t\tif (switcherName == 'switcher_business') {\r\n\t\t\t\tchangeSubSwitchersStatus();\r\n\t\t\t}\r\n\t\t\t$switchers.on('switchChange.bootstrapSwitch', function (e, state) {\r\n\t\t\t\tvar $chkbox = $(this), name = $chkbox.attr('name'), shopID = $chkbox.attr('data-shop'),\r\n\t\t\t\t\tstate = !state ? 0 : 1, business = $chkbox.attr('data-business'), businessID = $chkbox.attr('data-business-id');\r\n\t\t\t\tif (name == 'switcher_status') {\r\n\t\t\t\t\tHualala.UI.Confirm({\r\n\t\t\t\t\t\ttitle : (state == 1 ? \"开启\" : \"关闭\") + \"店铺\",\r\n\t\t\t\t\t\tmsg : \"你确定要\" + (state == 1 ? \"开启\" : \"关闭\") + \"店铺？\",\r\n\t\t\t\t\t\tokFn : function () {\r\n\t\t\t\t\t\t\tself.model.updateShopStatus(shopID, state, function (_shopID) {\r\n\t\t\t\t\t\t\t\tvar $switcherEl = self.$list.find(':checkbox[name=' + switcherName + ']').filter('[data-shop=' + _shopID + ']'),\r\n\t\t\t\t\t\t\t\t\t$subSwitchers = self.$list.find(':checkbox[name=switcher_business]').filter('[data-shop=' + _shopID + ']');\r\n\t\t\t\t\t\t\t\t$switcherEl.bootstrapSwitch('toggleState', true);\r\n\t\t\t\t\t\t\t\t$subSwitchers.bootstrapSwitch('disabled', state == 0 ? false : true);\r\n\t\t\t\t\t\t\t}, function (_shopID) {\r\n\t\t\t\t\t\t\t\tvar $switcherEl = self.$list.find(':checkbox[name=' + switcherName + ']').filter('[data-shop=' + _shopID + ']'),\r\n\t\t\t\t\t\t\t\t\t$subSwitchers = self.$list.find(':checkbox[name=switcher_business]').filter('[data-shop=' + _shopID + ']');\r\n\t\t\t\t\t\t\t\t$subSwitchers.bootstrapSwitch('disabled', state == 0 ? true : false);\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\tcancelFn : function () {\r\n\t\t\t\t\t\t\t$chkbox.bootstrapSwitch('toggleState', true);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t\t\r\n\t\t\t\t} else {\r\n\t\t\t\t\tvar businessSwitcherTip = self.getBusinessSwitcherTipsByName(business),\r\n\t\t\t\t\t\ttitle = (state == 1 ? '开启' : '关闭') + $XP(businessSwitcherTip, 'title', ''),\r\n\t\t\t\t\t\tmsg = $XP(businessSwitcherTip, (state == 1 ? 'switchOn' : 'switchOff'), '');\r\n\t\t\t\t\tHualala.UI.Confirm({\r\n\t\t\t\t\t\ttitle : title,\r\n\t\t\t\t\t\tmsg : msg,\r\n\t\t\t\t\t\t// okLabel : '',\r\n\t\t\t\t\t\tokFn : function () {\r\n\t\t\t\t\t\t\tself.model.updateShopBusinessStatus({\r\n\t\t\t\t\t\t\t\tshopID : shopID,\r\n\t\t\t\t\t\t\t\tname : business,\r\n\t\t\t\t\t\t\t\tid : businessID,\r\n\t\t\t\t\t\t\t\tstatus : state\r\n\t\t\t\t\t\t\t}, function (params) {\r\n\t\t\t\t\t\t\t\tself.$list.find(':checkbox[name=' + switcherName + ']').filter('[data-shop=' + $XP(params, 'shopID') + '][data-business-id=' + $XP(params, 'id') + ']')\r\n\t\t\t\t\t\t\t\t\t.bootstrapSwitch('toggleState', true);\r\n\t\t\t\t\t\t\t}, function (params) {\r\n\t\t\t\t\t\t\t\tvar mShop = $XP(params, 'mShop'), serviceID = $XP(params, 'id'), businessName = $XP(params, 'name'),\r\n\t\t\t\t\t\t\t\t\tshop = mShop.getAll(), businessData = self.getShopBusiness(shop);\r\n\t\t\t\t\t\t\t\tvar curBusinessData = _.find(businessData, function (el) {return el.name == businessName;});\r\n\t\t\t\t\t\t\t\tvar desc = $XP(curBusinessData, 'desc', '');\r\n\r\n\t\t\t\t\t\t\t\t$chkbox.parents('.shop-business').find('.desc').html(desc);\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\tcancelFn : function () {\r\n\t\t\t\t\t\t\t$chkbox.bootstrapSwitch('toggleState', true);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t\t\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t},\r\n\t\t// 渲染开关\r\n\t\t// initSwitcher : function (selector) {\r\n\t\t// \tvar self = this;\r\n\t\t// \tself.$list.find(selector).bootstrapSwitch({\r\n\t\t// \t\t// baseClass : 'ix-bs-switch',\r\n\t\t// \t\t// wrapperClass : 'ix-bs-switch-wrapper',\r\n\t\t// \t\tsize : 'normal',\r\n\t\t// \t\tonColor : selector == ':checkbox[name=switcher_business]' ? 'primary' : 'success',\r\n\t\t// \t\toffColor : 'default',\r\n\t\t// \t\tonText : '已开通',\r\n\t\t// \t\toffText : '未开通'\r\n\t\t// \t});\r\n\t\t// \t// 绑定开关事件\r\n\t\t// \tself.$list.find(selector).on('switchChange.bootstrapSwitch', function (e, state) {\r\n\t\t// \t\tvar $chkbox = $(this),\r\n\t\t// \t\t\tname = $chkbox.attr('name'),\r\n\t\t// \t\t\tshopID = $chkbox.attr('data-shop'),\r\n\t\t// \t\t\tstate = !state ? 0 : 1,\r\n\t\t// \t\t\tbusiness = $chkbox.attr('data-business'),\r\n\t\t// \t\t\tbusinessID = $chkbox.attr('data-business-id');\r\n\t\t// \t\tif (name == 'switcher_status') {\r\n\t\t// \t\t\tself.model.updateShopStatus(shopID, state, function (_shopID) {\r\n\t\t// \t\t\t\tself.$list.find(selector).filter('[data-shop=' + _shopID + ']').bootstrapSwitch('toggleState', true);\r\n\t\t// \t\t\t});\r\n\t\t// \t\t} else {\r\n\t\t// \t\t\tself.model.updateShopBusinessStatus({\r\n\t\t// \t\t\t\tshopID : shopID,\r\n\t\t// \t\t\t\tname : business,\r\n\t\t// \t\t\t\tid : businessID,\r\n\t\t// \t\t\t\tstatus : state\r\n\t\t// \t\t\t}, function (params) {\r\n\t\t// \t\t\t\tself.$list.find(selector).filter('[data-shop=' + $XP(params, 'shopID') + '][data-business-id=' + $XP(params, 'id') + ']')\r\n\t\t// \t\t\t\t\t.bootstrapSwitch('toggleState', true);\r\n\t\t// \t\t\t});\r\n\t\t// \t\t}\r\n\t\t\t\t\r\n\t\t// \t});\r\n\t\t// },\r\n\t\t// 渲染view\r\n\t\trender : function () {\r\n\t\t\tvar self = this,\r\n\t\t\t\tmodel = self.model,\r\n\t\t\t\tpagerParams = model.getPagerParams(),\r\n\t\t\t\tpageNo = $XP(pagerParams, 'pageNo');\r\n\t\t\tvar shops = model.getShops(pageNo);\r\n\t\t\tvar renderData = self.mapRenderData(shops);\r\n\t\t\tvar listTpl = self.get('listTpl');\r\n\t\t\tvar html = listTpl(renderData);\r\n\t\t\tself.emptyBar && self.emptyBar.destroy();\r\n\t\t\tself.$list.empty();\r\n\t\t\tif (shops.length == 0) {\r\n\t\t\t\tself.emptyBar = new Hualala.UI.EmptyPlaceholder({\r\n\t\t\t\t\tcontainer : self.$list\r\n\t\t\t\t});\r\n\t\t\t\tself.emptyBar.show();\r\n\t\t\t} else {\r\n\t\t\t\tself.$list.html(html);\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\t\r\n\t\t\tself.initPager({\r\n\t\t\t\ttotal : model.get('pageCount'),\r\n\t\t\t\tpage : model.get('pageNo'),\r\n\t\t\t\thref : 'javascript:void(0);'\r\n\t\t\t});\r\n\t\t\t// self.$list.find(':checkbox[name*=switcher_]').bootstrapSwitch();\r\n\t\t\t// self.initSwitcher(':checkbox[name=switcher_business]');\r\n\t\t\t// self.initSwitcher(':checkbox[name=switcher_status]');\r\n\t\t\tself.initSwitcher('switcher_business');\r\n\t\t\tself.initSwitcher('switcher_status');\r\n\t\t},\r\n\t\t// 生成业务编辑窗口\r\n\t\tinitBusinessModal : function (trigger, shopID, name, id, serviceFeatures) {\r\n\t\t\tvar self = this;\r\n\t\t\tvar editView = new Hualala.Setting.editServiceView({\r\n\t\t\t\ttriggerEl : trigger,\r\n\t\t\t\tserviceID : id,\r\n\t\t\t\tserviceName : name,\r\n\t\t\t\tserviceFeatures : serviceFeatures,\r\n\t\t\t\tmodel : self.model.getShopModelByShopID(shopID),\r\n\t\t\t\tsuccessFn : function (mShop, serviceID, businessInfo, $trigger) {\r\n\t\t\t\t\tvar operationMode = mShop.get('operationMode'),\r\n\t\t\t\t\t\tbusinessName = $trigger.attr('data-business'),\r\n\t\t\t\t\t\tshopID = $trigger.attr('data-shop'),\r\n\t\t\t\t\t\tdesc = self.getBusinessDesc(parseInt(serviceID), operationMode, businessInfo, businessName, shopID);\r\n\r\n\t\t\t\t\t$trigger.parents('.shop-business').find('.desc').html(desc);\r\n\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t},\r\n\t\t// 生成绑定结算账号窗口\r\n\t\tinitBindSettleModal : function (trigger, settleID, shopID) {\r\n\t\t\tvar self = this;\r\n\t\t\tvar view = new Hualala.Setting.bindSettleUnitView({\r\n\t\t\t\ttriggerEl : trigger,\r\n\t\t\t\tsettleID : settleID,\r\n\t\t\t\tmodel : self.model.getShopModelByShopID(shopID),\r\n\t\t\t\tsuccessFn : function (mShop, $trigger, settleInfo) {\r\n\t\t\t\t\tvar settleUnitID = $XP(settleInfo, 'settleUnitID'),\r\n\t\t\t\t\t\tsettleUnitName = $XP(settleInfo, 'settleUnitName', '');\r\n\t\t\t\t\t$trigger.attr('data-id', settleUnitID);\r\n\t\t\t\t\t$trigger.parent().find('.account-name').html(settleUnitName);\r\n\t\t\t\t\tmShop.set({\r\n\t\t\t\t\t\tsettleID : settleUnitID,\r\n\t\t\t\t\t\tsettleName : settleUnitName\r\n\t\t\t\t\t})\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\t});\r\n\tHualala.Shop.ShopListView = ShopListView;\r\n})(jQuery, window);;(function ($, window) {\r\n\tIX.ns(\"Hualala.Shop\");\r\n\tvar popoverMsg = Hualala.UI.PopoverMsgTip;\r\n\tvar toptip = Hualala.UI.TopTip;\r\n\tvar LoadingModal = Hualala.UI.LoadingModal;\r\n\tvar ShopListModel = Hualala.Shop.ShopListModel;\r\n\tvar ShopListView = Hualala.Shop.ShopListView;\r\n\tvar ShopListController = Stapes.subclass({\r\n\t\t/**\r\n\t\t * 店铺结果列表控制器\r\n\t\t * @param  {Object} cfg 配置参数\r\n\t\t *          @param {JQueryObj} container 容器\r\n\t\t *          @param {Object} view  店铺结果的View模块实例\r\n\t\t *          @param {Object} model 店铺结果的数据模块实例\r\n\t\t * @return {Object}     \r\n\t\t */\r\n\t\tconstructor : function (cfg) {\r\n\t\t\tthis.set({\r\n\t\t\t\tsessionData : Hualala.getSessionData()\r\n\t\t\t});\r\n\t\t\tthis.container = $XP(cfg, 'container', null);\r\n\t\t\tthis.view = $XP(cfg, 'view', null),\r\n\t\t\tthis.model = $XP(cfg, 'model', null);\r\n\t\t\tif (!this.view || !this.model || !this.container) {\r\n\t\t\t\tthrow(\"Shop List init faild!!\");\r\n\t\t\t}\r\n\t\t\tthis.isReady = false;\r\n\t\t\tthis.bindEvent();\r\n\t\t}\r\n\t});\r\n\tShopListController.proto({\r\n\t\tinit : function (params) {\r\n\t\t\tthis.model.init(params);\r\n\t\t\tthis.view.init({\r\n\t\t\t\tmodel : this.model,\r\n\t\t\t\tcontainer : this.container\r\n\t\t\t});\r\n\t\t\tthis.loadingModal = new LoadingModal({\r\n\t\t\t\tstart : 100\r\n\t\t\t});\r\n\t\t\tthis.isReady = true;\r\n\t\t},\r\n\t\thasReady : function () {return this.isReady;},\r\n\t\tbindEvent : function () {\r\n\t\t\tthis.on({\r\n\t\t\t\tload : function (params) {\r\n\t\t\t\t\tvar self = this;\r\n\t\t\t\t\tif (!self.hasReady()) {\r\n\t\t\t\t\t\tself.init(params);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tself.model.emit('load', params);\r\n\t\t\t\t}\r\n\t\t\t}, this);\r\n\t\t\tthis.model.on({\r\n\t\t\t\tload : function (params) {\r\n\t\t\t\t\tvar self = this;\r\n\t\t\t\t\tvar cbFn = function () {\r\n\t\t\t\t\t\tself.view.emit('render');\r\n\t\t\t\t\t\tself.loadingModal.hide();\r\n\t\t\t\t\t};\r\n\t\t\t\t\tself.loadingModal.show();\r\n\t\t\t\t\tself.model.load(params, cbFn);\r\n\t\t\t\t},\r\n\t\t\t\t// \"update:totalSize\" : function (v) {\r\n\t\t\t\t// \tvar self = this;\r\n\t\t\t\t// \tself.view.initPager({\r\n\t\t\t\t// \t\ttotal : self.get('totalSize'),\r\n\t\t\t\t// \t\tpage : self.get('pageNo')\r\n\t\t\t\t// \t});\r\n\t\t\t\t// }\r\n\t\t\t}, this);\r\n\t\t\tthis.view.on({\r\n\t\t\t\trender : function () {\r\n\t\t\t\t\tvar self = this;\r\n\t\t\t\t\tself.view.render();\r\n\t\t\t\t},\r\n\t\t\t\treloadPager : function (params) {\r\n\t\t\t\t\tvar self = this;\r\n\t\t\t\t\tself.view.initPager(params);\r\n\t\t\t\t}\r\n\t\t\t}, this);\r\n\t\t}\r\n\t});\r\n\tHualala.Shop.ShopListController = ShopListController;\r\n})(jQuery, window);;\r\n;(function($) \r\n{\r\n\tvar defaults = {\r\n            data : {\r\n                isSearchMap: false,\r\n                keyword: '',\r\n                shopName: '',\r\n                tel: '',\r\n                address: '',\r\n                city: '',\r\n                area: '',\r\n                lng: '',\r\n                lat: ''\r\n            },\r\n            searchBox: '.search-box',\r\n            mapResult: '.map-result',\r\n            //mapContainer: '#shopMap',\r\n            mapCanvasId: 'mapCanvas',\r\n            load: function() { },\r\n            serach: function() { }\r\n        };\r\n\tfunction ShopMap(options)\r\n    {\r\n        this.cfg = $.extend({}, defaults, options);\r\n        //this.$shopMap = $(mapContainer);\r\n        this.sContent = '';\r\n        this.$searchBox = $(this.cfg.searchBox);\r\n        this.$mapResult = $(this.cfg.mapResult);\r\n        this.map = '';\r\n        this.mapPoint = {};\r\n        this.isAreaSearched = false;\r\n    }\r\n\tShopMap.prototype = \r\n    {\r\n        init: function()\r\n        {\r\n            var self = this,\r\n                markerTrick = false,\r\n                mapParams = self.cfg.data;\r\n            self.map = new BMap.Map(self.cfg.mapCanvasId);\r\n            //添加默认缩放平移控件\r\n            self.map.addControl(new BMap.NavigationControl());\r\n            self.map.enableScrollWheelZoom();\r\n            self.sContent = [\r\n                '<dl class=\"map-shop-info\">',\r\n                    '<dt>' + mapParams.shopName + '</dt>',\r\n                    '<dd>',\r\n                        '<p><span>电话：</span>' + mapParams.tel + '</p>',\r\n                        '<p><span>地址：</span>' + mapParams.address + '</p>',\r\n                    '</dd>',\r\n                '</dl>'\r\n            ].join('');\r\n            \r\n            self[(mapParams.isSearchMap || !mapParams.lng || !mapParams.lat ? 'search' : 'load') + 'Map'](mapParams);\r\n            \r\n            if(self.$searchBox[0])\r\n            {\r\n                var $keyword = self.$searchBox.find('.map-keyword'),\r\n                    $searchBtn = self.$searchBox.find('.map-search-btn'),\r\n                    searchParams = $.extend({}, self.cfg.data);\r\n                $searchBtn.on('click', function ()\r\n                {\r\n                    searchParams.keyword = $.trim($keyword.val());\r\n                    self.searchMap(searchParams);\r\n                });\r\n            }\r\n            \r\n            \r\n            return this;\r\n        },\r\n        loadMap: function(data)\r\n        {\r\n            var self = this;\r\n            data = data || self.cfg.data;\r\n            self.map.centerAndZoom(new BMap.Point(data.lng, data.lat), 14);\r\n            self.map.enableScrollWheelZoom();\r\n\r\n            var marker = new BMap.Marker(new BMap.Point(data.lng, data.lat), \r\n                {\r\n                    enableMassClear: true,\r\n                    raiseOnDrag: true\r\n                });\r\n            marker.enableDragging();\r\n            self.map.addOverlay(marker);\r\n            marker.openInfoWindow(new BMap.InfoWindow(self.sContent));\r\n           /* map.addEventListener(\"click\", function(e){\r\n                if(!(e.overlay)){\r\n                    map.clearOverlays();\r\n                    marker.show();\r\n                    map.addOverlay(marker);\r\n                    marker.setPosition(e.point);\r\n                    setResult(e.point.lng, e.point.lat);\r\n                }\r\n            });*/\r\n            marker.addEventListener(\"click\", function(e)\r\n            {\r\n                 marker.openInfoWindow(new BMap.InfoWindow(self.sContent));\r\n            });\r\n            marker.addEventListener(\"dragend\", function(e)\r\n            {\r\n                self.setResult(e.point.lng, e.point.lat);\r\n            });\r\n            self.setResult(data.lng, data.lat);\r\n        },\r\n        searchMap : function (data)\r\n        {\r\n            var self = this;\r\n            data = data || self.cfg.data;\r\n            //self.map.centerAndZoom(new BMap.Point(116.404, 39.915), 14);\r\n            //self.map.enableScrollWheelZoom();\r\n                \r\n            var local = new BMap.LocalSearch(self.map, {\r\n                renderOptions: {map: self.map},\r\n                pageCapacity: 1,\r\n                onInfoHtmlSet : function (poi) {\r\n                    poi.marker.openInfoWindow(new BMap.InfoWindow(self.sContent));\r\n                    //target.openInfoWindow(infoWindow);\r\n                },\r\n                onMarkersSet : function (poi) {\r\n                    //console.info(poi.marker.infoWindow);\r\n                }\r\n            });\r\n            \r\n            local.search(data.keyword || data.address || data.area || data.city);\r\n            \r\n            local.setSearchCompleteCallback(function(results)\r\n            {\r\n                if(local.getStatus() !== BMAP_STATUS_SUCCESS)\r\n                {\r\n                    Hualala.UI.Alert({msg: '抱歉，百度地图未搜到您要查询的精确位置，现为您显示该位置所在的城市或区域，您可以通过移动地图上的标记来精确定位要查询的位置。'});\r\n                    if(!self.isAreaSearched)\r\n                    {\r\n                        self.isAreaSearched = true;\r\n                        local.search(data.area);\r\n                    }\r\n                    else\r\n                    {\r\n                        local.search(data.city);\r\n                    }\r\n                }\r\n            });\r\n            local.setMarkersSetCallback(function(pois)\r\n            {\r\n                for(var i = pois.length; i--;)\r\n                {\r\n                    var marker = pois[i].marker;\r\n                    marker.enableDragging();\r\n                    self.setResult(marker.point.lng, marker.point.lat);\r\n                    //var mapParams = {\r\n                    //  width : 250,     // 信息窗口宽度\r\n                    //  height: 100,     // 信息窗口高度\r\n                    //  title : \"Hello\"  // 信息窗口标题\r\n                    //}\r\n                    //var infoWindow = new BMap.InfoWindow(\"World\", mapParams);  // 创建信息窗口对象\r\n                    //map.openInfoWindow(infoWindow,point); //开启信息窗口\r\n                    marker.openInfoWindow(new BMap.InfoWindow(self.sContent));\r\n                    marker.addEventListener(\"click\", function(e)\r\n                    {\r\n                       // markerTrick = true;\r\n                        var pos = this.getPosition();\r\n                        self.setResult(pos.lng, pos.lat);\r\n                    });\r\n                    marker.addEventListener(\"dragend\", function(e)\r\n                    {\r\n                        self.setResult(e.point.lng, e.point.lat);\r\n                    });\r\n                }\r\n            });\r\n            \r\n        },\r\n         /*\r\n         * setResult : 定义得到标注经纬度后的操作\r\n         * 请修改此函数以满足您的需求\r\n         * lng: 标注的经度\r\n         * lat: 标注的纬度\r\n         */\r\n        setResult: function (lng, lat)\r\n        {\r\n            var self = this;\r\n            self.mapPoint = { lng: lng, lat: lat };\r\n            self.$mapResult[0] && self.$mapResult.html('您店铺的经度：' + lng + '    纬度： ' + lat);\r\n        }\r\n\t}\r\n    IX.ns(\"Hualala.Shop\");\r\n    Hualala.Shop.map = function(options) \r\n    { \r\n        return new ShopMap(options).init(); \r\n    };\r\n}(jQuery));\r\n\r\n\r\n\r\n\r\n\r\n\r\n;(function ($, window) {\r\nIX.ns('Hualala.Shop');\r\nvar G = Hualala.Global,\r\n    U = Hualala.UI,\r\n    topTip = U.TopTip;\r\n// 初始化创建店铺页面\r\nHualala.Shop.initCreate = function ($wizard)\r\n{\r\n    \r\n    //初始化向导控件\r\n    $wizard.bootstrapWizard();\r\n    var bsWizard = $wizard.data('bootstrapWizard'),\r\n        $step1 = $wizard.find('#tab1'),\r\n        $step2 = $wizard.find('#tab2'),\r\n        $step3 = $wizard.find('#tab3'),\r\n        $city = $step1.find('#cityID'),\r\n        $area = $step1.find('#areaID'),\r\n        $cuisine1 = $step1.find('#cuisineID1'),\r\n        $cuisine2 = $step1.find('#cuisineID2'),\r\n        bv = null,\r\n        operationModeType = Hualala.Shop.Typedef.operationMode;\r\n    \r\n    U.fillSelect($step1.find('#operationMode'), operationModeType);\r\n    // 初始化城市列表下拉框\r\n    initCities($city);\r\n    U.createChosen($area, [], 1, 1, { width: '100%', placeholder_text : \"请先选择或输入所在城市\", }, false);\r\n    U.createChosen($cuisine1, [], 1, 1, { width: '100%', placeholder_text : \"请先选择或输入所在城市\", }, false);\r\n    U.createChosen($cuisine2, [], 1, 1, { width: '100%', placeholder_text : \"请先选择或输入所在城市\", }, false);\r\n    \r\n    // 根据所选择的城市设置地标、菜系下拉列表\r\n    $city.on('change', function ()\r\n    {\r\n        var cityID = $(this).val();\r\n        if(!cityID) return;\r\n        \r\n        initAreas($area, cityID);\r\n        initCuisines($cuisine1, $cuisine2, cityID);\r\n        \r\n    });\r\n    // 初始化timepicker\r\n    $step1.find('#openingHoursStart, #openingHoursEnd').timepicker({\r\n        minuteStep: 1,\r\n        showMeridian: false,\r\n        disableFocus : true,\r\n        showInputs : false\r\n    });\r\n    // 初始化表单验证\r\n    $step1.bootstrapValidator({\r\n        excluded: ':disabled',\r\n        fields: {\r\n            shopName: {\r\n                message: '店铺名无效',\r\n                validators: {\r\n                    notEmpty: {\r\n                        message: '店铺名不能为空'\r\n                    },\r\n                    stringLength: {\r\n                        min: 2,\r\n                        max: 100,\r\n                        message: '店铺名长度必须在2到100个字符之间'\r\n                    }\r\n                }\r\n            },\r\n            cityID: {\r\n                validators: { notEmpty: { message: '请选择店铺所在城市' } }\r\n            },\r\n            tel: {\r\n                validators: {\r\n                    notEmpty: { message: '店铺电话不能为空' },\r\n                    telOrMobile: { message: '' }\r\n                }\r\n            },\r\n            address: {\r\n                validators: {\r\n                    notEmpty: { message: '店铺地址不能为空' },\r\n                    stringLength: {\r\n                        min: 1,\r\n                        max: 80,\r\n                        message: '店铺地址不能超过80个字符'\r\n                    }\r\n                }\r\n            },\r\n            PCCL: {\r\n                validators: {\r\n                    notEmpty: { message: '人均消费不能为空' },\r\n                    numeric: { message: '人均消费必须是金额数字' }\r\n                }\r\n            },\r\n            operationMode: {\r\n                validators: {\r\n                    notEmpty: { message: '请选择店铺运营模式' }\r\n                }\r\n            },\r\n            openingHoursStart: {\r\n                validators: {\r\n                    notEmpty: { message: '每天营业开始时间不能空' },\r\n                    time: { message: '' }\r\n                }\r\n            },\r\n            openingHoursEnd: {\r\n                validators: {\r\n                    notEmpty: { message: '每天营业结束时间不能空' },\r\n                    time: {\r\n                        message: '',\r\n                        startTimeField: 'openingHoursStart'\r\n                    }\r\n                }\r\n            },\r\n            areaID: {\r\n                validators: {\r\n                    notEmpty: { message: '请选择店铺所在地标' }\r\n                }\r\n            },\r\n            cuisineID1: {\r\n                validators: {\r\n                    notEmpty: { message: '请选择菜系1' }\r\n                }\r\n            }\r\n        }\r\n    });\r\n    bv = $step1.data('bootstrapValidator');\r\n    \r\n    var $uploadImg = $step1.find('#uploadImg'),\r\n        imagePath = ''; // 门头图图片路径\r\n    $uploadImg.find('img').attr('src', G.IMAGE_ROOT + '/shop_head_img_default.png');\r\n    // 上传门头图\r\n    $uploadImg.find('button, img').on('click', function()\r\n    {\r\n        U.uploadImg({\r\n            onSuccess: function (imgPath, $dlg)\r\n            {\r\n                var src = G.IMAGE_RESOURCE_DOMAIN + '/' + imgPath + '?quality=70';\r\n                imagePath = imgPath;\r\n                $uploadImg.find('img').attr('src', src);\r\n                $dlg.modal('hide');\r\n            }\r\n        });\r\n    });\r\n    //bsWizard.show(1);\r\n    var dataStep1 = null, // 第一步店铺基本信息数据\r\n        map = null, // 地图组件实例\r\n        shopID = '',\r\n        $searchBox = $step2.find('.map-search-box'),\r\n        $shopSettingLink = $step3.find('#shopSettingLink');\r\n    // 向导组件的下一步行为控制\r\n    $wizard.find('#nextStep').on('click', function()\r\n    {\r\n        var $curStep = bsWizard.activePane();\r\n        // 第一步\r\n        if($curStep.is('#tab1'))\r\n        {\r\n            //$select.blur();\r\n            if(!bv.validate().isValid()) return;\r\n            // 数据提交前预处理\r\n            dataStep1 = Hualala.Common.parseForm($step1);\r\n            dataStep1.shopID = shopID;\r\n            dataStep1.shopName = dataStep1.shopName.replace('（', '(').replace('）', ')');\r\n            dataStep1.areaName = getSelectText($area);\r\n            dataStep1.cuisineName1 = getSelectText($cuisine1);\r\n            dataStep1.cuisineName2 = dataStep1.cuisineID2 ? getSelectText($cuisine2) : '';\r\n            dataStep1.imagePath = imagePath;\r\n            dataStep1.openingHours = dataStep1.openingHoursStart + '-' + dataStep1.openingHoursEnd;\r\n            var keywords = [dataStep1.shopName, dataStep1.address, dataStep1.cuisineName1];\r\n            dataStep1.cuisineName2 && keywords.push(dataStep1.cuisineName2);\r\n            keywords.push(dataStep1.areaName);\r\n            dataStep1.keywordLst = keywords.join(' | ');\r\n            // 根据店铺是否已经产生调用不同的服务\r\n            var callServer = shopID ? G.updateShopBaseInfo : G.createShop;\r\n            callServer(dataStep1, function(rsp)\r\n            {\r\n                if(rsp.resultcode != '000')\r\n                {\r\n                    rsp.resultmsg && topTip({msg: rsp.resultmsg, type: 'danger'});\r\n                    return;\r\n                }\r\n                shopID = shopID || rsp.data.records[0].shopID;\r\n                $step3.find('h4 span').eq(1).text(dataStep1.shopName);\r\n                $shopSettingLink.attr('href', Hualala.PageRoute.createPath('setting'));\r\n                // 进入第二步标注地图\r\n                bsWizard.next();\r\n                // 地图对象必须在第二步面板显示出来后初始化\r\n                map = Hualala.Shop.map({data: {\r\n                    isSearchMap: true,\r\n                    shopName: dataStep1.shopName,\r\n                    tel: dataStep1.tel,\r\n                    address: dataStep1.address,\r\n                    area: dataStep1.areaName,\r\n                    city: getSelectText($city)\r\n                }, searchBox: $searchBox});\r\n                \r\n            });\r\n            \r\n            return;\r\n        }\r\n        // 第二步\r\n        if($curStep.is('#tab2'))\r\n        {\r\n            var lng = map.mapPoint.lng, lat = map.mapPoint.lat,\r\n                mapInfo = {\r\n                    shopID: shopID,\r\n                    mapLongitudeValue: lng,\r\n                    mapLatitudeValue: lat,\r\n                    mapLongitudeValueBaiDu: lng,\r\n                    mapLatitudeValueBaiDu: lat\r\n                };\r\n            var callServer = G.setShopMap;\r\n            callServer(mapInfo, function(rsp)\r\n            {\r\n                if(rsp.resultcode != '000')\r\n                {\r\n                    rsp.resultmsg && topTip({msg: rsp.resultmsg, type: 'danger'});\r\n                    return;\r\n                }\r\n            });\r\n        }\r\n        bsWizard.next();\r\n    });\r\n    \r\n}\r\n// 初始化菜系下拉列表\r\nfunction initCuisines($cuisine1, $cuisine2, cityID)\r\n{\r\n    G.getCuisines({cityID: cityID}, function(rsp)\r\n    {\r\n        if(rsp.resultcode != '000')\r\n        {\r\n            rsp.resultmsg && topTip({msg: rsp.resultmsg, type: 'danger'});\r\n            return;\r\n        }\r\n        $cuisine1.siblings('.chosen-container').remove();\r\n        U.createChosen($cuisine1.show().data('chosen', null), rsp.data.records || [], 'cuisineID', 'cuisineName', { width: '100%' }, { cuisineID: '', cuisineName: '--请选择--' }).blur().change(function(){ $(this).blur() });\r\n        $cuisine2.siblings('.chosen-container').remove();\r\n        U.createChosen($cuisine2.show().data('chosen', null), rsp.data.records || [], 'cuisineID', 'cuisineName', { width: '100%' }, { cuisineID: '', cuisineName: '--不限--' }).blur().change(function(){ $(this).blur() });\r\n    });\r\n    \r\n}\r\n// 初始化地标下拉列表\r\nfunction initAreas($selectBox, cityID)\r\n{\r\n    G.getAreas({cityID: cityID}, function(rsp)\r\n    {\r\n        if(rsp.resultcode != '000')\r\n        {\r\n            rsp.resultmsg && topTip({msg: rsp.resultmsg, type: 'danger'});\r\n            return;\r\n        }\r\n        $selectBox.siblings('.chosen-container').remove();\r\n        U.createChosen($selectBox.show().data('chosen', null), rsp.data.records || [], 'areaID', 'areaName', { width: '100%' }, { areaID: '', areaName: '--请选择--' })\r\n        .blur().change(function(){ $(this).blur() });\r\n    });\r\n    \r\n}\r\n// 初始化城市下拉列表\r\nfunction initCities($selectBox)\r\n{\r\n    G.getCities({isActive: 1}, function(rsp)\r\n    {\r\n        if(rsp.resultcode != '000')\r\n        {\r\n            rsp.resultmsg && topTip({msg: rsp.resultmsg, type: 'danger'});\r\n            return;\r\n        }\r\n        \r\n        U.createChosen($selectBox, rsp.data.records || [], 'cityID', 'cityName', { width: '100%' }, { cityID: '', cityName: '--请选择--' })\r\n        .change(function(){ $(this).blur() });\r\n    });\r\n    \r\n}\r\n\r\n// 处理并获取下拉列表当前选择项的文本\r\nfunction getSelectText($select)\r\n{\r\n    return $select.find('option:selected').text().replace(/-/g, '');\r\n}\r\n\r\n})(jQuery, window);\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n;(function ($, window) {\r\nIX.ns('Hualala.Shop');\r\nvar G = Hualala.Global,\r\n    U = Hualala.UI,\r\n    S = Hualala.Shop,\r\n    topTip = U.TopTip,\r\n    parseForm = Hualala.Common.parseForm;\r\n// 初始化店铺店铺详情页面\r\nS.initInfo = function ($container, pageType, params)\r\n{\r\n    if(!params) return;\r\n    // 渲染店铺功能导航\r\n    var $shopFuncNav = S.createShopFuncNav(pageType, params, $container);\r\n    \r\n    var shopID = params, shopInfo = null,\r\n        operationModeType = Hualala.Shop.Typedef.operationMode,\r\n        $form = null, $city = null, $area = null, \r\n        $cuisine1 = null, $cuisine2 = null,\r\n        imagePath = '', $img = null,\r\n        imgHost = G.IMAGE_RESOURCE_DOMAIN + '/',\r\n        bv = null, map = null;\r\n    \r\n    G.getShopInfo({shopID : shopID}, function (rsp)\r\n    {\r\n        if(rsp.resultcode != '000')\r\n        {\r\n            rsp.resultmsg && topTip({msg: rsp.resultmsg, type: 'danger'});\r\n            return;\r\n        }\r\n        shopInfo = rsp.data.records[0];\r\n        \r\n        // 渲染店铺详情头部\r\n        S.createShopInfoHead(shopInfo, $container, function($shopInfoHead)\r\n        {\r\n            $shopFuncNav.before($shopInfoHead);\r\n        });\r\n        \r\n        var openTime = shopInfo.openingHours.split('-');\r\n        shopInfo.openingHoursStart = openTime[0];\r\n        shopInfo.openingHoursEnd = openTime[1];\r\n        shopInfo.operationModeName = operationModeType[shopInfo.operationMode];\r\n        \r\n        var tpl = Handlebars.compile(Hualala.TplLib.get('tpl_shop_info'));\r\n        $form = $(tpl(shopInfo)).appendTo($container);\r\n        $city = $form.find('#cityID'),\r\n        $area = $form.find('#areaID'),\r\n        $cuisine1 = $form.find('#cuisineID1'),\r\n        $cuisine2 = $form.find('#cuisineID2');\r\n        \r\n        U.fillSelect($form.find('#operationMode'), operationModeType).val(shopInfo.operationMode);\r\n        // 初始化城市列表下拉框\r\n        $city.on('change', function (e, areaID, cuisineID1, cuisineID2)\r\n        {\r\n            var cityID = $(this).val();\r\n            if(!cityID) return;\r\n            \r\n            initAreas($area, cityID, areaID);\r\n            initCuisines($cuisine1, $cuisine2, cityID, cuisineID1, cuisineID2);\r\n        });\r\n        initCities($city, shopInfo);\r\n        // 根据所选择的城市设置地标、菜系下拉列表\r\n        \r\n        // 初始化timepicker\r\n        $form.find('#openingHoursStart, #openingHoursEnd').timepicker({\r\n            minuteStep: 1,\r\n            showMeridian: false,\r\n            disableFocus : true,\r\n            showInputs : false\r\n        });\r\n        // 初始化表单验证\r\n        $form.bootstrapValidator({\r\n            excluded: ':disabled',\r\n            fields: {\r\n                shopName: {\r\n                    message: '店铺名无效',\r\n                    validators: {\r\n                        notEmpty: {\r\n                            message: '店铺名不能为空'\r\n                        },\r\n                        stringLength: {\r\n                            min: 2,\r\n                            max: 100,\r\n                            message: '店铺名长度必须在2到100个字符之间'\r\n                        }\r\n                    }\r\n                },\r\n                cityID: {\r\n                    validators: { notEmpty: { message: '请选择店铺所在城市' } }\r\n                },\r\n                tel: {\r\n                    validators: {\r\n                        notEmpty: { message: '店铺电话不能为空' },\r\n                        telOrMobile: { message: '' }\r\n                    }\r\n                },\r\n                address: {\r\n                    validators: {\r\n                        notEmpty: { message: '店铺地址不能为空' },\r\n                        stringLength: {\r\n                            min: 1,\r\n                            max: 80,\r\n                            message: '店铺地址不能超过80个字符'\r\n                        }\r\n                    }\r\n                },\r\n                PCCL: {\r\n                    validators: {\r\n                        notEmpty: { message: '人均消费不能为空' },\r\n                        numeric: { message: '人均消费必须是金额数字' }\r\n                    }\r\n                },\r\n                operationMode: {\r\n                    validators: {\r\n                        notEmpty: { message: '请选择店铺运营模式' }\r\n                    }\r\n                },\r\n                openingHoursStart: {\r\n                    validators: {\r\n                        notEmpty: { message: '每天营业开始时间不能空' },\r\n                        time: { message: '' }\r\n                    }\r\n                },\r\n                openingHoursEnd: {\r\n                    validators: {\r\n                        notEmpty: { message: '每天营业结束时间不能空' },\r\n                        time: {\r\n                            message: '',\r\n                            startTimeField: 'openingHoursStart'\r\n                        }\r\n                    }\r\n                },\r\n                areaID: {\r\n                    validators: {\r\n                        notEmpty: { message: '请选择店铺所在地标' }\r\n                    }\r\n                },\r\n                cuisineID1: {\r\n                    validators: {\r\n                        notEmpty: { message: '请选择菜系1' }\r\n                    }\r\n                }\r\n            }\r\n        }).on('submit', function(){ return false });\r\n        bv = $form.data('bootstrapValidator');\r\n        \r\n        var $uploadImg = $form.find('#uploadImg');\r\n        $img = $uploadImg.find('img').attr('src', G.IMAGE_ROOT + '/shop_head_img_default.png');\r\n        imagePath = shopInfo.imagePath;\r\n        imagePath && $img.attr('src', imgHost + imagePath + '?quality=70');\r\n\r\n        map = S.map({data: {\r\n            isSearchMap: false,\r\n            shopName: shopInfo.shopName,\r\n            tel: shopInfo.tel,\r\n            address: shopInfo.address,\r\n            area: shopInfo.areaName,\r\n            city: shopInfo.cityName,\r\n            lng: shopInfo.mapLongitudeValueBaiDu,\r\n            lat: shopInfo.mapLatitudeValueBaiDu\r\n        }});\r\n        \r\n    });\r\n    // click 事件 delegate\r\n    $container.on('click', function(e)\r\n    {\r\n        var $target = $(e.target);\r\n        // 修改门头图\r\n        if($target.is('.edit-mode #uploadImg img, .edit-mode #uploadImg a'))\r\n        {\r\n            U.uploadImg({\r\n                onSuccess: function (imgPath, $dlg)\r\n                {\r\n                    imagePath = imgPath;\r\n                    $img.attr('src', imgHost + imgPath);\r\n                    $dlg.modal('hide');\r\n                }\r\n            });\r\n        }\r\n        // 重新标记地图\r\n        if($target.is('#remarkMap'))\r\n        {\r\n            if(bv.isValidField('shopName') && bv.isValidField('tel') && bv.isValidField('address'))\r\n            {\r\n                var coords = map.mapPoint,\r\n                    formData = parseForm($form); console.log(formData);\r\n                map = S.map({data: {\r\n                    isSearchMap: false,\r\n                    shopName: formData.shopName,\r\n                    tel: formData.tel,\r\n                    address: formData.address,\r\n                    area: getSelectText($area),\r\n                    city: getSelectText($city),\r\n                    lng: coords.lng,\r\n                    lat: coords.lat\r\n                }});\r\n                \r\n                var mapInfo = {\r\n                        shopID: shopID,\r\n                        mapLongitudeValue: coords.lng,\r\n                        mapLatitudeValue: coords.lat,\r\n                        mapLongitudeValueBaiDu: coords.lng,\r\n                        mapLatitudeValueBaiDu: coords.lat\r\n                    };\r\n                // 标注店铺地图callServer调用\r\n                G.setShopMap(mapInfo, function(rsp)\r\n                {\r\n                    if(rsp.resultcode != '000')\r\n                    {\r\n                        rsp.resultmsg && topTip({msg: rsp.resultmsg, type: 'danger'});\r\n                        return;\r\n                    }\r\n                    \r\n                    topTip({msg: '重新标记地图成功！', type: 'success'});\r\n                    \r\n                });\r\n                \r\n            }\r\n            else\r\n            {\r\n                topTip({msg: '店铺相关信息填写有误！', type: 'danger'});\r\n            }\r\n            \r\n        }\r\n        // 切换为编辑模式\r\n        if($target.is('#editBtn'))\r\n        {\r\n            $form.removeClass('read-mode').addClass('edit-mode');\r\n        }\r\n        // 保存店铺基本信息修改\r\n        if($target.is('#saveBtn'))\r\n        {\r\n            if(!bv.validate().isValid()) return;\r\n            // 数据提交前预处理\r\n            var shopData = parseForm($form);\r\n            shopData.shopID = shopID;\r\n            shopData.shopName = shopData.shopName.replace('（', '(').replace('）', ')');\r\n            shopData.areaName = getSelectText($area);\r\n            shopData.cuisineName1 = getSelectText($cuisine1);\r\n            shopData.cuisineName2 = shopData.cuisineID2 ? getSelectText($cuisine2) : '';\r\n            shopData.imagePath = imagePath;\r\n            shopData.openingHours = shopData.openingHoursStart + '-' + shopData.openingHoursEnd;\r\n            var keywords = [shopData.shopName, shopData.address, shopData.cuisineName1];\r\n            shopData.cuisineName2 && keywords.push(shopData.cuisineName2);\r\n            keywords.push(shopData.areaName);\r\n            shopData.keywordLst = keywords.join(' | ');\r\n            // 保存店铺基本信息callServer调用\r\n            G.updateShopBaseInfo(shopData, function(rsp)\r\n            {\r\n                if(rsp.resultcode != '000')\r\n                {\r\n                    rsp.resultmsg && topTip({msg: rsp.resultmsg, type: 'danger'});\r\n                    return;\r\n                }\r\n                \r\n                $form.removeClass('edit-mode').addClass('read-mode');\r\n                topTip({msg: '保存成功！', type: 'success'});\r\n                updateReadMode($form, shopData);\r\n            });\r\n        }\r\n    });\r\n    \r\n}\r\n// 保存提交后更新店铺信息只读模式\r\nfunction updateReadMode($form, data)\r\n{\r\n    $form.find('input, select').not('.map-keyword, #openingHoursEnd').each(function ()\r\n    {\r\n        var $this = $(this),\r\n            $p = $this.siblings('p');\r\n        if($this.is('#openingHoursStart'))\r\n            $p.text(data.openingHours);\r\n        else if($this.is('select'))\r\n            $p.text(getSelectText($this));\r\n        else\r\n            $p.text($this.val());\r\n    });\r\n}\r\n// 初始化菜系下拉列表\r\nfunction initCuisines($cuisine1, $cuisine2, cityID, cuisineID1, cuisineID2)\r\n{\r\n    var callServer = G.getCuisines;\r\n    callServer({cityID: cityID}, function(rsp)\r\n    {\r\n        if(rsp.resultcode != '000')\r\n        {\r\n            rsp.resultmsg && topTip({msg: rsp.resultmsg, type: 'danger'});\r\n            return;\r\n        }\r\n        \r\n        $cuisine1.siblings('.chosen-container').remove();\r\n        U.createChosen($cuisine1.show().data('chosen', null), rsp.data.records || [], 'cuisineID', 'cuisineName', { width: '100%', placeholder_text : '请选择或输入菜系1' }, false, cuisineID1 || '')\r\n        .blur().change(function(){ $(this).blur() });\r\n        \r\n        $cuisine2.siblings('.chosen-container').remove();\r\n        U.createChosen($cuisine2.show().data('chosen', null), rsp.data.records || [], 'cuisineID', 'cuisineName', { width: '100%', placeholder_text : '请选择或输入菜系2' }, { cuisineID: '', cuisineName: '--不限--' }, cuisineID2 || '')\r\n        .blur().change(function(){ $(this).blur() });\r\n    });\r\n    \r\n}\r\n// 初始化地标下拉列表\r\nfunction initAreas($area, cityID, areaID)\r\n{\r\n    G.getAreas({cityID: cityID}, function(rsp)\r\n    {\r\n        if(rsp.resultcode != '000')\r\n        {\r\n            rsp.resultmsg && topTip({msg: rsp.resultmsg, type: 'danger'});\r\n            return;\r\n        }\r\n        \r\n        $area.siblings('.chosen-container').remove();\r\n        U.createChosen($area.show().data('chosen', null), rsp.data.records || [], 'areaID', 'areaName', { width: '100%', placeholder_text : '请选择或输入地标' }, false, areaID || '')\r\n        .blur().change(function(){ $(this).blur() });\r\n    });\r\n    \r\n}\r\n\r\n// 初始化城市下拉列表\r\nfunction initCities($city, shopInfo)\r\n{\r\n    G.getCities({isActive: 1}, function(rsp)\r\n    {\r\n        if(rsp.resultcode != '000')\r\n        {\r\n            rsp.resultmsg && topTip({msg: rsp.resultmsg, type: 'danger'});\r\n            return;\r\n        }\r\n        \r\n        U.createChosen($city, rsp.data.records || [], 'cityID', 'cityName', { width: '100%', placeholder_text : '请选择或输入所在城市' }, false, shopInfo.cityID)\r\n        .trigger('change', [shopInfo.areaID, shopInfo.cuisineID1, shopInfo.cuisineID2])\r\n        .change(function(){ $(this).blur() });\r\n    });\r\n    \r\n}\r\n\r\n// 处理并获取下拉列表当前选择项的文本\r\nfunction getSelectText($select)\r\n{\r\n    return $select.find('option:selected').text().replace(/-/g, '');\r\n}\r\n\r\n})(jQuery, window);\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n;(function ($, window) {\r\nIX.ns('Hualala.Shop');\r\n\r\n// 初始化店铺菜品页面\r\nHualala.Shop.initMenu = function ($container, pageType, params)\r\n{\r\n    if(!params) return;\r\n    \r\n    var G = Hualala.Global,\r\n        U = Hualala.UI,\r\n        topTip = U.TopTip;\r\n    \r\n    var shopID = params;\r\n        imgHost = G.IMAGE_RESOURCE_DOMAIN + '/',\r\n        imgRoot = G.IMAGE_ROOT + '/';\r\n\r\n    var classifiedFoods = null, //已分类菜品\r\n        foodClass = '', //当菜菜品类别的 foodCategoryID\r\n        foods = null, //当前表格显示的菜品数组\r\n        current = 0, //页面滚动时渲染foods所在的索引\r\n        size = 10, // 首次或者滚动加载的food数量\r\n        searchParams = null, //菜品搜索过滤参数\r\n        //修改菜品弹出框里几个 radio 的名称\r\n        foodParams = ['hotTag', 'takeawayTag', 'isDiscount'],\r\n        food = null, //当前菜品\r\n        ef = null; //修改菜品后用于向服务器发送的数据\r\n        \r\n    //单个菜品模板（菜品表格中的一行）\r\n    var foodTpl = Handlebars.compile(Hualala.TplLib.get('tpl_food')),\r\n        //修改菜品弹出框模板\r\n        editFoodTpl = Handlebars.compile(Hualala.TplLib.get('tpl_edit_food'));\r\n        //页面主内容\r\n    var $menu = $(Hualala.TplLib.get('tpl_shop_menu')),\r\n        $foodClass = null, //菜品类别 UI 对象集合\r\n        $foodSearch = $menu.find('#foodSearch'),\r\n        $takeawayTag = $foodSearch.find('#takeawayTag'),\r\n        $foodName = $foodSearch.find('#foodName'),\r\n        $chekbox = $foodSearch.find('input[type=checkbox]'),\r\n        $tblHead = $menu.find('.tbl-foods thead'),\r\n        $foodCount = $menu.find('#foodSearchInfo span'),\r\n        $foods = $menu.find('.tbl-foods tbody'),\r\n        $editFood = null,\r\n        modalEditFood = null, \r\n        bv = null; //表单验证器\r\n    //调用服务，根据 shopID 获取所有分类和菜品信息\r\n    G.getShopMenu({shopID : shopID}, function (rsp)\r\n    {\r\n        if(rsp.resultcode != '000')\r\n        {\r\n            rsp.resultmsg && topTip({msg: rsp.resultmsg, type: 'danger'});\r\n            return;\r\n        }\r\n        var records = rsp.data.records;\r\n        if(!records || records.length == 0)\r\n        {\r\n            var $alert = $('<div class=\"alert alert-warning t-c\">此店铺暂无菜品，您可以通过下载<a target=\"_blank\">PC客户端</a>上传菜品数据。</div>');\r\n            $alert.find('a').attr('href', Hualala.PageRoute.createPath('pcclient'));\r\n            $alert.appendTo($container);\r\n            return;\r\n        }\r\n        classifiedFoods = classifyFoods(records);\r\n        renderFoods(); //渲染所有菜品\r\n        //渲染菜品分类\r\n        var $foodClassBox = $menu.find('#foodClassBox').append($('<span class=\"current-food-class\"></span>').text('全部菜品 (' + foods.length + ')'));\r\n        \r\n        for(var id in classifiedFoods)\r\n        {\r\n            var category = classifiedFoods[id]; \r\n            $('<span></span>').data('id', id).text(category.foodCategoryName + ' (' + category.foods.length + ')').appendTo($foodClassBox);\r\n        }\r\n        $foodClass = $foodClassBox.find('span');\r\n        \r\n        var foodNameTpl = Handlebars.compile(Hualala.TplLib.get('tpl_food_name'));\r\n        $foodName.html(foodNameTpl({classifiedFoods: classifiedFoods}));\r\n        initFoodChosen();\r\n        $menu.appendTo($container);\r\n    });\r\n    \r\n    function initFoodChosen() \r\n    {\r\n        var matcher = (new Pymatch([]));\r\n        var sections = foods;\r\n        var getMatchedFn = function (searchText) {\r\n            matcher.setNames(_.map(sections, function (el) {\r\n                return IX.inherit(el, {\r\n                    name : el.foodName\r\n                });\r\n            }));\r\n            var matchedSections = matcher.match(searchText);\r\n            var matchedOptions = {};\r\n            _.each(matchedSections, function (el, i) {\r\n                matchedOptions[el[0].foodID] = true;\r\n            });\r\n            return matchedOptions;\r\n        };\r\n        $foodName.chosen({\r\n            width : '200px',\r\n            placeholder_text : \"选择或输入菜品名称\",\r\n            // max_selected_options: 1,\r\n            no_results_text : \"抱歉，没有相关菜品！\",\r\n            allow_single_deselect : true,\r\n            getMatchedFn : getMatchedFn\r\n        }).change(function()\r\n        {\r\n            searchFood();\r\n        });\r\n    }\r\n    \r\n    //页面滚动时加载更多菜品\r\n    $(window).on('scroll', function(e)\r\n    {\r\n        if(foods) throttle(scrollFood);\r\n    });\r\n    \r\n    function scrollFood()\r\n    {\r\n        var viewBottom = $(window).scrollTop() + $(window).height(),\r\n            foodsBottom = $foods.offset().top + $foods.height();\r\n        \r\n        if(foodsBottom < viewBottom && current < foods.length)\r\n        {\r\n            renderFoods();\r\n        }\r\n    }\r\n    \r\n    $(document).on('change', function(e)\r\n    {\r\n        var $target = $(e.target);\r\n        //菜品过滤筛选\r\n        if($target.is('#takeawayTag , #foodSearch input[type=checkbox]'))\r\n        {\r\n            searchFood();\r\n        }\r\n        //自定义按钮组相关\r\n        if($target.is('.form-food input[type=radio]'))\r\n        {\r\n            $target.closest('div').find('label').removeClass('active')\r\n            .find('input:checked').parent().addClass('active');\r\n        }\r\n        //修改菜品图片\r\n        if($target.is('.food-pic input'))\r\n        {\r\n            var $foodPic = $editFood.filter('.food-pic');\r\n            if($target.val())\r\n            {\r\n                $foodPic.addClass('loading');\r\n                previewImg($target[0], $foodPic.find('img'));\r\n                $foodPic.submit();\r\n            }\r\n        }\r\n        \r\n    });\r\n    \r\n    top.imgCallback = function(rsp)\r\n    {\r\n        var $foodPic = $editFood.filter('.food-pic');\r\n        var json = $.parseJSON(rsp),\r\n            status = json.status;\r\n        if(status == 'success')\r\n        {\r\n            var url = json.url,\r\n                imageHWP = json.imageHWP || '';\r\n            ef.imagePath = url;\r\n            if(imageHWP) ef.imageHWP = imageHWP;\r\n            if(!window.FileReader)\r\n            {\r\n                $foodPic.find('img').attr('src', imgHost + url.replace(/\\.\\w+$/, (imageHWP ? '=200x' + Math.round(200 * imageHWP) : '') + '$&?quality=70'));\r\n            }\r\n        }\r\n        else\r\n        {\r\n            topTip({msg: status + '：菜品图片上传失败'});\r\n        }\r\n        $foodPic.removeClass('loading');\r\n        $('#imgResponse').remove();\r\n    }\r\n    \r\n    //图片上传本地预览\r\n    function previewImg(fileInput, $img)\r\n    {\r\n        if (fileInput.files && fileInput.files[0])  \r\n        {\r\n            var reader = new FileReader();  \r\n            reader.onload = function(e){\r\n                $img.attr('src', e.target.result);\r\n            }\r\n            reader.readAsDataURL(fileInput.files[0]);  \r\n        }\r\n    }\r\n    \r\n    //修改菜品\r\n    $foods.on('click', 'tr', function()\r\n    {\r\n        var $this = $(this);\r\n        food = findFood($this.data('cid'), $this.data('id'));\r\n        //菜品图标：招、荐、新\r\n        var foodIcos = ['isSpecialty', 'isRecommend', 'isNew'],\r\n            path = food.imgePath;\r\n        \r\n        food.foodPic = path ? imgHost + path + '?quality=70' : imgRoot + 'food_bg.png';\r\n        //辣度\r\n        food.hotTag1 = imgRoot + 'hottag1.png';\r\n        food.hotTag2 = imgRoot + 'hottag2.png';\r\n        food.hotTag3 = imgRoot + 'hottag3.png';\r\n        \r\n        $editFood = $(editFoodTpl(food));\r\n        //弹出对话框\r\n        modalEditFood = new U.ModalDialog({\r\n            id: 'editFood',\r\n            title: '修改菜品',\r\n            html: $editFood,\r\n            hideCloseBtn: false\r\n        }).show();\r\n        modalEditFood._.footer.find('.btn-ok').text('保存修改');\r\n        modalEditFood._.footer.find('.btn-close').text('返回');\r\n        //初始化表单验证\r\n        bv = $editFood.filter('.form-food').bootstrapValidator({\r\n            fields: {\r\n                minOrderCount: {\r\n                    validators: {\r\n                        notEmpty: {\r\n                            message: '起售份数不能为空'\r\n                        },\r\n                        integer: {\r\n                            message: '起售份数必须是整数'\r\n                        },\r\n                        between: {\r\n                            min: 1,\r\n                            max: 99,\r\n                            message: '起售份数必须在1到99之间'\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n        }).data('bootstrapValidator');\r\n        //初始化ef\r\n        ef = {shopID: shopID, foodID: $this.data('id')};\r\n        for(var i = foodIcos.length; i--;)\r\n        {\r\n            var foodIco = foodIcos[i];\r\n            ef[foodIco] = '0';\r\n            if(food[foodIco] == 1)\r\n            {\r\n                $editFood.find('input[name=foodIco][value=' + foodIco +']').prop('checked', true).trigger('change');\r\n            }\r\n        }\r\n        for(var i = foodParams.length; i--;)\r\n        {\r\n            var param = foodParams[i];\r\n            $editFood.find('input[name=' + param + '][value=' + food[param] +']').prop('checked', true).trigger('change');\r\n        }\r\n        //菜品“可售/停售”\r\n        $editFood.find('input[name=isActive][value=' + food.foodIsActive + ']').prop('checked', true).trigger('change');\r\n    });\r\n    \r\n    $(document).on('click', function(e)\r\n    {\r\n        var $target = $(e.target);\r\n        //修改菜品“保存修改”\r\n        if($target.is('#editFood .btn-ok'))\r\n        {\r\n            if(!bv.validate().isValid()) return;\r\n            \r\n            var $foodIco = $editFood.find('input[name=foodIco]:checked').not('[value=none]');\r\n            if($foodIco[0]) ef[$foodIco.val()] = '1';\r\n            \r\n            for(var i = foodParams.length; i--;)\r\n            {\r\n                var param = foodParams[i];\r\n                ef[param] = $editFood.find('input[name=' + param + ']').filter(':checked').val();\r\n            }\r\n            ef.isActive = $editFood.find('input[name=isActive]:checked').val();\r\n            ef.minOrderCount = $editFood.find('input[name=minOrderCount]').val();\r\n            ef.tasteList = $.trim($editFood.find('input[name=tasteList]').val());\r\n            //调用修改菜品相关服务\r\n            G.updateFood(ef, function (rsp)\r\n            {\r\n                if(rsp.resultcode != '000')\r\n                {\r\n                    rsp.resultmsg && topTip({msg: rsp.resultmsg, type: 'danger'});\r\n                    return;\r\n                }\r\n                \r\n                modalEditFood.hide();\r\n                $.extend(food, ef);\r\n                if(ef.imagePath) food.imgePath = ef.imagePath;\r\n                food.foodIsActive = food.isActive;\r\n                updateFood(food);\r\n                $foods.empty();\r\n                renderFoods(true);\r\n            });\r\n        }\r\n        //点击某个菜品类别渲染对应菜品\r\n        if($target.is('#foodClassBox span'))\r\n        {\r\n            $foodClass.removeClass('current-food-class');\r\n            $target.addClass('current-food-class');\r\n            foodClass = $target.data('id');\r\n            $takeawayTag.val('');\r\n            $foodName.val('');\r\n            $chekbox.prop('checked', false);\r\n            searchParams = null;\r\n            current = 0;\r\n            renderFoods();\r\n        }\r\n        //搜索过滤菜品\r\n        /*if($target.is('#btnSearchFood'))\r\n        {\r\n            searchFood();\r\n        }*/\r\n        \r\n    });\r\n    \r\n    /*$foodName.on('keydown', function(e)\r\n    {\r\n        e.keyCode == 13 && searchFood();\r\n    });*/\r\n    //过滤筛选菜品UI\r\n    function searchFood()\r\n    {\r\n        var $checked = $chekbox.filter(':checked'),\r\n            takeawayTag = $.trim($takeawayTag.val()),\r\n            foodID = $.trim($foodName.val());\r\n        if(takeawayTag || foodID || $checked.length)\r\n        {\r\n            searchParams = {};\r\n            if(takeawayTag) searchParams.takeawayTag = takeawayTag;\r\n            if(foodID) searchParams.foodID = foodID;\r\n            $checked.each(function ()\r\n            {\r\n                if(this.id == 'isHasImage')\r\n                    searchParams.isHasImage = '0';\r\n                else\r\n                    searchParams[this.id] = '1';\r\n            });\r\n        }\r\n        else\r\n        {\r\n            searchParams = null;\r\n        }\r\n        current = 0;\r\n        renderFoods();\r\n    }\r\n    \r\n    //渲染菜品\r\n    function renderFoods(start)\r\n    {\r\n        foods = filterFoods();\r\n        $foodCount.text(foods.length);\r\n        if(current == 0) $foods.empty();\r\n        $foods.append(foodTpl({foods: foods.slice(start ? 0 : current, current + size)}));\r\n        current += size;\r\n        //$foods.find('img').lazyload();\r\n    }\r\n    //在某个菜品分类下根据foodID查找某个菜品\r\n    function findFood(cid, id)\r\n    {\r\n        var cfs = classifiedFoods[cid].foods; \r\n        for(var i = cfs.length; i--;)\r\n        {\r\n            if(cfs[i].foodID == id) return cfs[i];\r\n        }\r\n        return null;\r\n    }\r\n    //根据各种条件过滤菜品\r\n    function filterFoods()\r\n    {\r\n        var result = [];\r\n        if(!foodClass)\r\n        {\r\n            for(var foodCategoryID in classifiedFoods)\r\n            {\r\n                result.push.apply(result, classifiedFoods[foodCategoryID].foods);\r\n            }\r\n        }\r\n        else\r\n        {\r\n            result = classifiedFoods[foodClass].foods;\r\n        }\r\n        \r\n        for(p in searchParams)\r\n        {\r\n            result = $.grep(result, function (food)\r\n            {\r\n                return food[p] == searchParams[p];\r\n            });\r\n        }\r\n        \r\n        return result;\r\n    }\r\n    //将菜品分类\r\n    function classifyFoods(foodsData)\r\n    {\r\n        var result = {};\r\n        for(i = 0, l = foodsData.length; i < l; i++)\r\n        {\r\n            var food = foodsData[i], cid = food.foodCategoryID;\r\n            //根据foodCategoryID分类\r\n            result[cid] = result[cid] || {foods: [], foodCategoryName: food.foodCategoryName};\r\n            //某个菜品可能无foodID\r\n            if(!food.foodID) continue;\r\n            \r\n            updateFood(food);\r\n            \r\n            food.takeoutPackagingFee = food.takeoutPackagingFee > 0 ? parseFloat(food.takeoutPackagingFee) : '';\r\n            \r\n            if(food.prePrice == -1 || food.prePrice == food.price)\r\n            {\r\n                food.prePrice = food.price;\r\n                food.price = '';\r\n            }\r\n            if(food.vipPrice == -1 || food.vipPrice >= food.prePrice)\r\n            {\r\n                food.vipPrice = '';\r\n            }\r\n            food.price = food.price || '';\r\n            food.prePrice = food.prePrice || '';\r\n            food.vipPrice = food.vipPrice || '';\r\n            \r\n            var cfs = result[cid].foods,\r\n                unit = {\r\n                    unit: food.unit ? food.unit + ':' : '',\r\n                    price: food.price ? '￥' + parseFloat(food.price) : '',\r\n                    prePrice: food.prePrice ? '￥' + parseFloat(food.prePrice) : '',\r\n                    vipPrice: food.vipPrice ? '￥' + parseFloat(food.vipPrice) : ''\r\n                },\r\n                idx = inAarry(cfs, food, 'foodID');\r\n            //if(unit.prePrice == '￥NaN') console.log(food);\r\n            if(idx == -1)\r\n            {\r\n                food.units = [unit];\r\n                cfs.push(food);\r\n            }\r\n            else\r\n            {//将相同foodID的菜品按照规格合并\r\n                cfs[idx].units.push(unit);\r\n            }\r\n            \r\n        }\r\n        return result;\r\n    }\r\n    //更新某个菜品在表格中显示的相关属性\r\n    function updateFood(food)\r\n    {\r\n        var path = food.imgePath;\r\n        if(path)\r\n        {\r\n            var hwp = food.imageHWP, min = 92,\r\n                w = hwp > 1 ? min : Math.round(min / hwp),\r\n                h = hwp > 1 ? Math.round(min * hwp) : min;\r\n            food.imgSrc = imgHost + path.replace(/\\.\\w+$/, (hwp ? '=' + w + 'x' + h : '') + '$&?quality=70');\r\n        }\r\n        else\r\n            food.imgSrc = imgRoot + 'dino80.png';\r\n        \r\n        food.discountIco = food.isDiscount == 1 ? 'glyphicon-ok' : 'glyphicon-minus';\r\n        food.takeawayIco = food.takeawayTag > 0 ? 'glyphicon-ok' : 'glyphicon-minus';\r\n        food.activeIco = food.foodIsActive == 1 ? 'glyphicon-ok' : 'glyphicon-minus';\r\n    }\r\n    \r\n    //根据对象的一个属性检查某个对象是否在一个对象数组中\r\n    function inAarry(arr, obj, key)\r\n    {\r\n        for(var i = 0, l = arr.length; i < l; i++)\r\n        {\r\n            if(arr[i][key] == obj[key]) return i;\r\n        }\r\n        return -1;\r\n    }\r\n    \r\n}\r\n//将频繁执行的代码延迟执行以提高性能\r\nfunction throttle(method, context)\r\n{\r\n    clearTimeout(method.tId);\r\n    method.tId = setTimeout(function()\r\n    {\r\n        method.call(context);\r\n    }, 100);\r\n}\r\n\r\n})(jQuery, window);\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n;(function ($, window) {\r\n\t\r\n})(jQuery, window);;(function ($, window) {\r\n\tIX.ns(\"Hualala.Shop\");\r\n    \r\n    Hualala.Shop.Typedef = {\r\n        operationMode: { '0': '正餐', '1': '快餐', '2': '美食广场' }\r\n    };\r\n    \r\n    /**\r\n\t  * 渲染店铺详情页头部\r\n\t  * @param {Object | String} shopInfo 店铺ID或者店铺详情信息对象\r\n\t  * @param {jQuery Object} container  容器\r\n      * @param {function} callback  回调函数，参数是店铺详情头部的jQuery对象\r\n\t  * @return {NULL} \r\n\t  */\r\n    Hualala.Shop.createShopInfoHead = function(shopInfo, container, callback)\r\n    {\r\n        var $container = container || $('#ix_wrapper > .ix-body > .container'),\r\n            $shopInfoHead = $('<div class=\"bs-callout shop-info-head\"></div>');\r\n        !callback && $shopInfoHead.appendTo($container);\r\n        \r\n        var fn = function (shopInfo)\r\n        {\r\n            var tplData = {\r\n                    shopName: shopInfo.shopName,\r\n                    shopUrl: Hualala.Common.getShopUrl(shopInfo.shopID),\r\n                    shopListLink: Hualala.PageRoute.createPath('shop'),\r\n                    checked: shopInfo.status == 1 ? 'checked' : ''\r\n                };\r\n            \r\n            var tpl = Handlebars.compile(Hualala.TplLib.get('tpl_shop_info_head'));\r\n            \r\n            $shopInfoHead.append($(tpl(tplData))).find('input').bootstrapSwitch({\r\n                onColor : 'success',\r\n                onText : '已开通',\r\n                offText : '未开通'\r\n            }).on('switchChange.bootstrapSwitch', function (e, state)\r\n            {//店铺状态切换\r\n                var $chkbox = $(this);\r\n                Hualala.Global.switchShopStatus({shopID: shopInfo.shopID, status: +state}, function (rsp)\r\n                {\r\n                    if(rsp.resultcode != '000')\r\n                    {\r\n                        $chkbox.bootstrapSwitch('toggleState', true);\r\n                        rsp.resultmsg && Hualala.UI.TopTip({msg: rsp.resultmsg, type: 'danger'});\r\n                        return;\r\n                    }\r\n                    Hualala.UI.TopTip({\r\n                        msg: !+state ? '关闭成功' : '开启成功', \r\n                        type: 'success'\r\n                    })\r\n                });\r\n\t\t\t});;\r\n            //重置代理程序密码\r\n            $shopInfoHead.find('#resetPwd').on('click', function ()\r\n            {\r\n                var resetPwdTpl = Handlebars.compile(Hualala.TplLib.get('tpl_set_shop_client_pwd'));\r\n                var $resetPwdForm = $(resetPwdTpl(shopInfo));\r\n                //弹出重置代理程序密码模态框\r\n                var modal = new Hualala.UI.ModalDialog({\r\n                    id: 'resetCltPwdDlg',\r\n                    title: '重置代理程序密码',\r\n                    html: $resetPwdForm,\r\n                    sizeCls: 'modal-sm',\r\n                    hideCloseBtn: false\r\n                }).show();\r\n                var $feedback = $resetPwdForm.find('.has-feedback'),\r\n                    $feedbackIcon = $feedback.find('.form-control-feedback'),\r\n                    $errMsg = $feedback.find('small');\r\n                var $pwd = $resetPwdForm.find('#shopClinetPwd').data('validate', false).on('blur', function ()\r\n                {//验证密码输入\r\n                    var $this = $(this),\r\n                        l = $.trim($this.val()).length;\r\n                    $this.data('validate', false);\r\n                    if(!l)\r\n                        $errMsg.text('密码不能为空');\r\n                    else if(l < 6 || l > 16)\r\n                        $errMsg.text('密码长度必须在6到16个字符之间');\r\n                    else\r\n                    {\r\n                        $errMsg.text('');\r\n                        $this.data('validate', true);\r\n                    }\r\n                        \r\n                    var isValid = $this.data('validate');\r\n                    $feedback.toggleClass('has-success', isValid).toggleClass('has-error', !isValid);\r\n                    $feedbackIcon.toggleClass('glyphicon-ok', isValid).toggleClass('glyphicon-remove', !isValid);\r\n                });\r\n                //密码/明文切换\r\n                $resetPwdForm.find('#showPwd').change(function()\r\n                {\r\n                    $pwd.attr('type', this.checked ? 'text' : 'password');\r\n                });\r\n                //提交密码重设请求\r\n                modal._.footer.find('.btn-ok').on('click', function ()\r\n                {\r\n                    if(!$pwd.trigger('blur').data('validate')) return;\r\n                    \r\n                    Hualala.Global.setShopClientPwd({shopID: shopInfo.shopID, hLLAgentLoginPWD: $pwd.val()}, function (rsp)\r\n                    {\r\n                        if(rsp.resultcode != '000')\r\n                        {\r\n                            rsp.resultmsg && Hualala.UI.TopTip({msg: rsp.resultmsg, type: 'danger'});\r\n                            return;\r\n                        }\r\n                        modal.hide();\r\n                        Hualala.UI.TopTip({msg: '重置代理程序密码成功！', type: 'success'});\r\n                    });\r\n                    \r\n                });\r\n                \r\n            });\r\n            //执行回调函数\r\n            callback && callback($shopInfoHead);\r\n        };\r\n        //如果是参数shopInfo是店铺详情对象\r\n        if($.isPlainObject(shopInfo))\r\n        {\r\n            fn(shopInfo);\r\n            return;\r\n        }\r\n        //如果参数shopInfo是shopID，发送ajax获取店铺详情信息\r\n        Hualala.Global.getShopInfo({shopID: shopInfo}, function (rsp)\r\n        {\r\n            if(rsp.resultcode != '000')\r\n            {\r\n                rsp.resultmsg && Hualala.UI.TopTip({msg: rsp.resultmsg, type: 'danger'});\r\n                return;\r\n            }\r\n            var shopInfo = rsp.data.records[0];\r\n            fn(shopInfo);\r\n        });\r\n        \r\n    };\r\n    \r\n    // 店铺详情页功能导航\r\n    Hualala.Shop.createShopFuncNav = function (currentPageName, shopID, container)\r\n    {\r\n        var shopFuncs = ['shopInfo', 'shopMenu'],\r\n            R = Hualala.PageRoute,\r\n            $ul = $('<ul class=\"nav navbar-nav\"></ul>'),\r\n            $container = container || $('#ix_wrapper > .ix-body > .container');\r\n        \r\n        for(i = 0, l = shopFuncs.length; i < l; i++)\r\n        {\r\n            var shopFunc = shopFuncs[i],\r\n                isActive = shopFunc == currentPageName,\r\n                path = isActive ? 'javascript:;' : R.createPath(shopFunc, [shopID]),\r\n                label = R.getPageLabelByName(shopFunc);\r\n            \r\n            $('<li></li>').toggleClass('active', isActive).append($('<a></a>').attr('href', path).text(label)).appendTo($ul);\r\n        }\r\n        \r\n        return $('<div class=\"navbar navbar-default shop-func-nav\"></div>').append($ul).appendTo($container);\r\n    };\r\n    \r\n\tvar initShopList = function (pageType, params) {\r\n        var $body = $('#ix_wrapper > .ix-body > .container');\r\n\t\tvar queryPanel = new Hualala.Shop.QueryController({\r\n\t\t\tneedShopCreate : true,\r\n\t\t\tcontainer : $body,\r\n\t\t\tresultController : new Hualala.Shop.ShopListController({\r\n\t\t\t\tcontainer : $body,\r\n\t\t\t\tmodel : new Hualala.Shop.CardListModel({callServer : Hualala.Global.queryShop}),\r\n\t\t\t\tview : new Hualala.Shop.CardListView()\r\n\t\t\t})\r\n\t\t});\r\n\t\t// TODO 店铺管理首页，店铺查询及列表展示页面\r\n\t};\r\n\tHualala.Shop.HomePageInit = initShopList;\r\n\r\n\tvar initShopBaseInfoMgr = function (pageType, params) {\r\n        var $body = $('#ix_wrapper > .ix-body > .container');\r\n        Hualala.UI.BreadCrumb({\r\n            container: $body,\r\n            hideRoot: true,\r\n            nodes: Hualala.PageRoute.getParentNamesByPath()\r\n        });\r\n\t\tHualala.Shop.initInfo($body, pageType, params);\r\n\t};\r\n\tHualala.Shop.BaseInfoMgrInit = initShopBaseInfoMgr;\r\n\r\n\tvar initFoodMenuMgr = function (pageType, params) {\r\n\t\tvar $body = $('#ix_wrapper > .ix-body > .container');\r\n\t\tHualala.UI.BreadCrumb({\r\n            container: $body,\r\n            hideRoot: true,\r\n            nodes: Hualala.PageRoute.getParentNamesByPath()\r\n        });\r\n        Hualala.Shop.createShopInfoHead(params, $body);\r\n        Hualala.Shop.createShopFuncNav(pageType, params, $body);\r\n        Hualala.Shop.initMenu($body, pageType, params);\r\n\t};\r\n\tHualala.Shop.FoodMenuMgrInit = initFoodMenuMgr;\r\n\r\n\tvar initCreateShop = function (pageType, params) {\r\n\t\tvar $body = $('#ix_wrapper > .ix-body > .container');\r\n        Hualala.UI.BreadCrumb({\r\n            container: $body,\r\n            hideRoot: true,\r\n            nodes: Hualala.PageRoute.getParentNamesByPath()\r\n        });\r\n        var tpl = Handlebars.compile(Hualala.TplLib.get('tpl_shop_create')),\r\n            $shopCreateWizard = $(tpl({\r\n                pcClientPath: Hualala.PageRoute.createPath('pcclient')\r\n            }));\r\n\t\t$body.append($shopCreateWizard);\r\n        Hualala.Shop.initCreate($shopCreateWizard);\r\n\t\t\r\n\t};\r\n\tHualala.Shop.CreateShopInit = initCreateShop;\r\n\r\n\t\r\n})(jQuery, window);;(function ($, window) {\r\n\tIX.ns(\"Hualala.Setting\");\r\n\tvar popoverMsg = Hualala.UI.PopoverMsgTip;\r\n\tvar toptip = Hualala.UI.TopTip;\r\n\tvar ServiceFormElsCfg = {\r\n\t\tadvanceTime : {\r\n\t\t\ttype : 'combo',\r\n\t\t\tlabel : '用户提前预订时间',\r\n\t\t\tdefaultVal : 0,\r\n\t\t\t// prefix : '$',\r\n\t\t\t// surfix : '元',\r\n\t\t\toptions : Hualala.TypeDef.MinuteIntervalOptions(),\r\n\t\t\tvalidCfg : {\r\n\t\t\t\tvalidators : {\r\n\t\t\t\t\tnotEmpty : {\r\n\t\t\t\t\t\tmessage : \"请输入用户提前预订时间\"\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\tnoticeTime : {\r\n\t\t\ttype : 'combo',\r\n\t\t\tlabel : '订单提前通知时间',\r\n\t\t\tdefaultVal : 0,\r\n\t\t\t// @Note for 1.1 modify MinuteIntervalOptions first option label (#4105)\r\n\t\t\t// options : Hualala.TypeDef.MinuteIntervalOptions(),\r\n\t\t\toptions : Hualala.Common.getMinuteIntervalOptions({startLabel : \"用户下单后立即通知\"}),\r\n\t\t\tvalidCfg : {\r\n\t\t\t\tvalidators : {\r\n\t\t\t\t\tnotEmpty : {\r\n\t\t\t\t\t\tmessage : \"请输入订单提前通知时间\"\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\tminAmount : {\r\n\t\t\ttype : 'text',\r\n\t\t\tlabel : '最低消费金额',\r\n\t\t\tprefix : '￥',\r\n\t\t\tsurfix : Hualala.Constants.CashUnit,\r\n\t\t\tdefaultVal : 0,\r\n\t\t\tvalidCfg : {\r\n\t\t\t\tvalidators : {\r\n\t\t\t\t\tnotEmpty : {\r\n\t\t\t\t\t\tmessage : \"请输入最低消费金额\"\r\n\t\t\t\t\t},\r\n\t\t\t\t\tnumeric : {\r\n\t\t\t\t\t\tmessage: \"最低消费金额必须为数字\"\r\n\t\t\t\t\t},\r\n\t\t\t\t\tgreaterThan : {\r\n\t\t\t\t\t\tinclusive : true,\r\n\t\t\t\t\t\tvalue : 0,\r\n\t\t\t\t\t\tmessage : \"最低消费金额必须大于或等于0\"\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\tserviceAmount : {\r\n\t\t\ttype : 'text',\r\n\t\t\tlabel : '服务费',\r\n\t\t\tprefix : '￥',\r\n\t\t\tsurfix : Hualala.Constants.CashUnit,\r\n\t\t\tdefaultVal : 0,\r\n\t\t\tvalidCfg : {\r\n\t\t\t\tvalidators : {\r\n\t\t\t\t\tnumeric : {\r\n\t\t\t\t\t\tmessage: \"服务费必须为数字\"\r\n\t\t\t\t\t},\r\n\t\t\t\t\tgreaterThan : {\r\n\t\t\t\t\t\tinclusive : true,\r\n\t\t\t\t\t\tvalue : 0,\r\n\t\t\t\t\t\tmessage : \"服务费必须大于或等于0\"\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\tfreeServiceAmount : {\r\n\t\t\ttype : 'text',\r\n\t\t\tlabel : '免服务费菜品金额',\r\n\t\t\tprefix : '￥',\r\n\t\t\tsurfix : Hualala.Constants.CashUnit,\r\n\t\t\tdefaultVal : 0,\r\n\t\t\tvalidCfg : {\r\n\t\t\t\tvalidators : {\r\n\t\t\t\t\tnumeric : {\r\n\t\t\t\t\t\tmessage: \"免服务费菜品金额必须为数字\"\r\n\t\t\t\t\t},\r\n\t\t\t\t\tgreaterThan : {\r\n\t\t\t\t\t\tinclusive : true,\r\n\t\t\t\t\t\tvalue : 0,\r\n\t\t\t\t\t\tmessage : \"免服务费菜品金额必须大于或等于0\"\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\tholidayFlag : {\r\n\t\t\ttype : 'combo',\r\n\t\t\tlabel : '节假日开放',\r\n\t\t\tdefaultVal : 0,\r\n\t\t\toptions : Hualala.TypeDef.HolidayFlagOptions,\r\n\t\t\tvalidCfg : {\r\n\t\t\t\tvalidators : {\r\n\t\t\t\t\tnotEmpty : {\r\n\t\t\t\t\t\tmessage : \"请选择节假日开放类型\"\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\topenDays : {\r\n\t\t\ttype : 'text',\r\n\t\t\tlabel : '开放服务天数',\r\n\t\t\tsurfix : '天',\r\n\t\t\tdefaultVal : '',\r\n\t\t\tvalidCfg : {\r\n\t\t\t\tvalidators : {\r\n\t\t\t\t\tnotEmpty : {\r\n\t\t\t\t\t\tmessage : \"请输入开放服务天数\"\r\n\t\t\t\t\t},\r\n\t\t\t\t\tdigits : {\r\n\t\t\t\t\t\tmessage: \"开放服务天数必须为数字\"\r\n\t\t\t\t\t},\r\n\t\t\t\t\tgreaterThan : {\r\n\t\t\t\t\t\tinclusive : true,\r\n\t\t\t\t\t\tvalue : 0,\r\n\t\t\t\t\t\tmessage : \"开放服务天数必须大于或等于0\"\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\tservicePeriods : {\r\n\t\t\ttype : 'section',\r\n\t\t\tlabel : '开放时段',\r\n\t\t\tmin : {\r\n\t\t\t\ttype : 'timepicker',\r\n\t\t\t\tsurfix : '<span class=\"glyphicon glyphicon-time\"></span>',\r\n\t\t\t\tdefaultVal : '',\r\n\t\t\t\tvalidCfg : {\r\n\t\t\t\t\tgroup : '.min-input',\r\n\t\t\t\t\tvalidators : {\r\n\t\t\t\t\t\tnotEmpty : {\r\n\t\t\t\t\t\t\tmessage : \"请输入起始时间\"\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tmax : {\r\n\t\t\t\ttype : 'timepicker',\r\n\t\t\t\tsurfix : '<span class=\"glyphicon glyphicon-time\"></span>',\r\n\t\t\t\tdefaultVal : '',\r\n\t\t\t\tvalidCfg : {\r\n\t\t\t\t\tgroup : '.max-input',\r\n\t\t\t\t\tvalidators : {\r\n\t\t\t\t\t\tnotEmpty : {\r\n\t\t\t\t\t\t\tmessage : \"请输入结束时间\"\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\treserveTableTime : {\r\n\t\t\ttype : 'combo',\r\n\t\t\tlabel : '留位时间',\r\n\t\t\tdefaultVal : 0,\r\n\t\t\toptions : Hualala.TypeDef.MinuteIntervalOptions(60),\r\n\t\t\tvalidCfg : {\r\n\t\t\t\tvalidators : {\r\n\t\t\t\t\tnotEmpty : {\r\n\t\t\t\t\t\tmessage : \"请选择留位时间\"\r\n\t\t\t\t\t},\r\n\t\t\t\t\tnumeric : {\r\n\t\t\t\t\t\tmessage: \"留位时间必须为数字\"\r\n\t\t\t\t\t},\r\n\t\t\t\t\tgreaterThan : {\r\n\t\t\t\t\t\tinclusive : true,\r\n\t\t\t\t\t\tvalue : 0,\r\n\t\t\t\t\t\tmessage : \"留位时间必须大于或等于0\"\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\treserveTableDesc : {\r\n\t\t\ttype : 'text',\r\n\t\t\tlabel : '留位特别说明',\r\n\t\t\tdefaultVal : '',\r\n\t\t\tvalidCfg : {\r\n\t\t\t\tvalidators : {\r\n\t\t\t\t\tstringLength : {\r\n\t\t\t\t\t\tmax : 40,\r\n\t\t\t\t\t\tmessage : '留位特别说明不能超过40个字'\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\ttakeawayDeliveryAgent : {\r\n\t\t\ttype : 'text',\r\n\t\t\tlabel : '配送单位',\r\n\t\t\tdefaultVal : '自助配送',\r\n\t\t\tvalidCfg : {}\r\n\t\t},\r\n\t\ttakeawayDeliveryTime : {\r\n\t\t\ttype : 'text',\r\n\t\t\tlabel : '预计送餐所需时间',\r\n\t\t\tsurfix : '分钟',\r\n\t\t\tdefaultVal : '',\r\n\t\t\tvalidCfg : {\r\n\t\t\t\tvalidators : {\r\n\t\t\t\t\tnotEmpty : {\r\n\t\t\t\t\t\tmessage : \"请输入预计送餐所需时间\"\r\n\t\t\t\t\t},\r\n\t\t\t\t\tnumeric : {\r\n\t\t\t\t\t\tmessage: \"预计送餐所需时间必须为数字\"\r\n\t\t\t\t\t},\r\n\t\t\t\t\tgreaterThan : {\r\n\t\t\t\t\t\tinclusive : true,\r\n\t\t\t\t\t\tvalue : 0,\r\n\t\t\t\t\t\tmessage : \"预计送餐所需时间必须大于或等于0\"\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\ttakeawayScope : {\r\n\t\t\ttype : 'text',\r\n\t\t\tlabel : '送餐范围',\r\n\t\t\tsurfix : '公里',\r\n\t\t\tdefaultVal : '',\r\n\t\t\tvalidCfg : {\r\n\t\t\t\tvalidators : {\r\n\t\t\t\t\tnotEmpty : {\r\n\t\t\t\t\t\tmessage : \"请输入送餐范围\"\r\n\t\t\t\t\t},\r\n\t\t\t\t\tnumeric : {\r\n\t\t\t\t\t\tmessage: \"送餐范围必须为数字\"\r\n\t\t\t\t\t},\r\n\t\t\t\t\tgreaterThan : {\r\n\t\t\t\t\t\tinclusive : true,\r\n\t\t\t\t\t\tvalue : 0,\r\n\t\t\t\t\t\tmessage : \"送餐范围必须大于或等于0\"\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\ttakeawayScopeDesc : {\r\n\t\t\ttype : 'text',\r\n\t\t\tlabel : '送餐范围说明',\r\n\t\t\tdefaultVal : '',\r\n\t\t\tvalidCfg : {\r\n\t\t\t\tvalidators : {\r\n\t\t\t\t\tstringLength : {\r\n\t\t\t\t\t\tmax : 200,\r\n\t\t\t\t\t\tmessage : '送餐范围说明不能超过200个字'\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\tsubmitSMSTemplateID : {\r\n\t\t\ttype : 'hidden',\r\n\t\t\tdefaultVal : ''\r\n\t\t},\r\n\t\tcheckSMSTemplateID : {\r\n\t\t\ttype : 'hidden',\r\n\t\t\tdefaultVal : ''\r\n\t\t},\r\n\t\tpayMethod : {\r\n\t\t\ttype : 'combo',\r\n\t\t\tlabel : '可选支付方式',\r\n\t\t\tdefaultVal : 0,\r\n\t\t\toptions : Hualala.TypeDef.PayMethodOptions,\r\n\t\t\tvalidCfg : {\r\n\t\t\t\tvalidators : {\r\n\t\t\t\t\tnotEmpty : {\r\n\t\t\t\t\t\tmessage : \"请选择可选支付方式\"\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\tneedInputTableName : {\r\n\t\t\ttype : 'switcher',\r\n\t\t\tlabel : '下单时输入桌号',\r\n\t\t\tdefaultVal : 1,\r\n\t\t\tonLabel : '需要',\r\n\t\t\toffLabel : '不需要',\r\n\t\t\tvalidCfg : {\r\n\t\t\t\tvalidators : {\r\n\t\t\t\t\t\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\tsupportInvoice : {\r\n\t\t\ttype : 'switcher',\r\n\t\t\tlabel : '提供发票',\r\n\t\t\tdefaultVal : 1,\r\n\t\t\tonLabel : '需要',\r\n\t\t\toffLabel : '不需要',\r\n\t\t\tvalidCfg : {\r\n\t\t\t\tvalidators : {\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t\r\n\t\t},\r\n\t\tsupportCommitToSoftware : {\r\n\t\t\ttype : 'switcher',\r\n\t\t\tlabel : '下单到餐饮软件',\r\n\t\t\tdefaultVal : 1,\r\n\t\t\tonLabel : '支持',\r\n\t\t\toffLabel : '不支持',\r\n\t\t\tvalidCfg : {\r\n\t\t\t\tvalidators : {\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\tpayMethodAtShop : {\r\n\t\t\ttype : 'combo',\r\n\t\t\tlabel : '店内支付方式',\r\n\t\t\tdefaultVal : 0,\r\n\t\t\toptions : Hualala.TypeDef.PayMethodAtShopOptions,\r\n\t\t\tvalidCfg : {\r\n\t\t\t\tvalidators : {\r\n\t\t\t\t\tnotEmpty : {\r\n\t\t\t\t\t\tmessage : \"请选择店内支付方式\"\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\tcheckSpotOrder : {\r\n\t\t\ttype : 'switcher',\r\n\t\t\tlabel : '支持手机结账',\r\n\t\t\tdefaultVal : 1,\r\n\t\t\tonLabel : '支持',\r\n\t\t\toffLabel : '不支持',\r\n\t\t\tvalidCfg : {\r\n\t\t\t\tvalidators : {}\r\n\t\t\t}\r\n\t\t},\r\n\t\t// @NOTE: for 1.1 modify payBeforeCommit to combobox(#4105)\r\n\t\t// payBeforeCommit : {\r\n\t\t// \ttype : 'switcher',\r\n\t\t// \tlabel : '支持餐前结账',\r\n\t\t// \tdefaultVal : 1,\r\n\t\t// \tonLabel : '支持',\r\n\t\t// \toffLabel : '不支持',\r\n\t\t// \tvalidCfg : {\r\n\t\t// \t\tvalidators : {}\r\n\t\t// \t}\r\n\t\t\t\r\n\t\t// },\r\n\t\tpayBeforeCommit : {\r\n\t\t\ttype : 'combo',\r\n\t\t\tlabel : '结账模式',\r\n\t\t\tdefaultVal : 1,\r\n\t\t\toptions : Hualala.TypeDef.PayBeforeCommitOptions,\r\n\t\t\tvalidCfg : {\r\n\t\t\t\tvalidators : {}\r\n\t\t\t}\r\n\t\t},\r\n\t\tfetchFoodMode : {\r\n\t\t\ttype : 'combo',\r\n\t\t\tlabel : '下单后出餐模式',\r\n\t\t\tdefaultVal : 0,\r\n\t\t\toptions : Hualala.TypeDef.FetchFoodModeOptions,\r\n\t\t\tvalidCfg : {\r\n\t\t\t\tvalidators : {\r\n\t\t\t\t\tnotEmpty : {\r\n\t\t\t\t\t\tmessage : \"下单后出餐模式不能为空\"\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n\tvar ServiceFormElsHT = new IX.IListManager();\r\n\t_.each(ServiceFormElsCfg, function (el, k) {\r\n\t\tvar type = $XP(el, 'type');\r\n\t\tvar labelClz = 'col-sm-offset-1 col-sm-3 control-label';\r\n\t\tif (type == 'section') {\r\n\t\t\tvar id = minID = k + '_min_' + IX.id(), maxID = k + '_max_' + IX.id(),\r\n\t\t\t\tminName = k + '_min', maxName = k + '_max',\r\n\t\t\t\tmin = IX.inherit($XP(el, 'min', {}), {\r\n\t\t\t\t\tid : minID, name : minName, clz : 'col-sm-3',\r\n\t\t\t\t}), max = IX.inherit($XP(el, 'max', {}), {\r\n\t\t\t\t\tid : maxID, name : maxName, clz : 'col-sm-3',\r\n\t\t\t\t});\r\n\t\t\tServiceFormElsHT.register(k, IX.inherit(el, {\r\n\t\t\t\tid : id,\r\n\t\t\t\tlabelClz : labelClz,\r\n\t\t\t\tmin : min,\r\n\t\t\t\tmax : max\r\n\t\t\t}));\r\n\t\t} else {\r\n\t\t\tServiceFormElsHT.register(k, IX.inherit(el, {\r\n\t\t\t\tid : k + '_' + IX.id(),\r\n\t\t\t\tname : k,\r\n\t\t\t\tlabelClz : labelClz,\r\n\t\t\t\tclz : 'col-sm-5'\r\n\t\t\t}));\r\n\t\t}\r\n\t});\r\n\t\r\n\tvar editServiceView = Stapes.subclass({\r\n\t\t/**\r\n\t\t * 编辑业务详情\r\n\t\t * @param  {Object} cfg {triggerEl, serviceID, serviceName, model}\r\n\t\t *              @param {jQueryObj} triggerEl 触发元素 \r\n\t\t *              @param {String} serviceID 业务ID\r\n\t\t *              @param {String} serviceName 业务名称\r\n\t\t *              @param {Object} model 店铺数据模型\r\n\t\t *              @param {String} serviceFeatures 店铺服务信息\r\n\t\t *              @param {Function} successFn 编辑成功后的回调\r\n\t\t * @return {NULL}    \r\n\t\t */\r\n\t\tconstructor : function (cfg) {\r\n\t\t\tthis.$trigger = $XP(cfg, 'triggerEl');\r\n\t\t\tthis.serviceID = $XP(cfg, 'serviceID', null);\r\n\t\t\tthis.serviceName = $XP(cfg, 'serviceName', null);\r\n\t\t\tthis.model = $XP(cfg, 'model', null);\r\n\t\t\tthis.serviceFeatures = $XP(cfg, 'serviceFeatures', '');\r\n\t\t\tthis.serviceList = Hualala.TypeDef.ShopBusiness;\r\n\t\t\tthis.modal = null;\r\n\t\t\tthis.successFn = $XF(cfg, 'successFn');\r\n\t\t\tif (!this.serviceID || !this.serviceName || !this.model) {\r\n\t\t\t\tthrow(\"Service View init failed!\");\r\n\t\t\t}\r\n\t\t\tthis.loadTemplates();\r\n\t\t\tthis.serviceInfo = this.getServiceInfo('id', this.serviceID);\r\n\t\t\tthis.callServer = $XP(this.serviceInfo, 'callServer', '');\r\n\t\t\tif (IX.isFn(this.callServer)) {\r\n\t\t\t\tthis.callServer = this.callServer;\r\n\t\t\t} else if (!IX.isString(this.callServer)) {\r\n\t\t\t\tthrow(\"Configuration failed : Invalid Page Initialized for \" + this.callServer);\r\n\t\t\t\treturn false;\r\n\t\t\t} else if (IX.nsExisted(this.callServer)) {\r\n\t\t\t\tthis.callServer = IX.getNS(this.callServer);\r\n\t\t\t}\r\n\t\t\t// var revParamJson = JSON.parse(this.model.get('revParamJson'));\r\n\t\t\tvar revParamJson = this.model.get('revParamJson') || null,\r\n\t\t\t\ttakeawayParamJson = this.model.get('takeawayParamJson') || null,\r\n\t\t\t\tbusinessCfg = null;\r\n\t\t\trevParamJson = !revParamJson ? {} : JSON.parse(revParamJson);\r\n\t\t\ttakeawayParamJson = !takeawayParamJson ? {} : JSON.parse(takeawayParamJson);\r\n\t\t\tbusinessCfg = IX.inherit(revParamJson, takeawayParamJson);\r\n\t\t\tthis.formParams = $XP(businessCfg, this.serviceID);\r\n\t\t\tthis.initModal();\r\n\t\t\tthis.renderForm();\r\n\t\t\tthis.bindEvent();\r\n\t\t\tthis.emit('show');\r\n\t\t}\r\n\t});\r\n\teditServiceView.proto({\r\n\t\tloadTemplates : function () {\r\n\t\t\tvar layoutTpl = Handlebars.compile(Hualala.TplLib.get('tpl_shop_service_form_layout')),\r\n\t\t\t\tbtnTpl = Handlebars.compile(Hualala.TplLib.get('tpl_shop_modal_btns'));\r\n\t\t\tHandlebars.registerHelper('checkFormElementType', function (conditional, options) {\r\n\t\t\t\treturn (conditional == options.hash.type) ? options.fn(this) : options.inverse(this);\r\n\t\t\t});\r\n\t\t\tHandlebars.registerHelper('isInputGroup', function (prefix, surfix, options) {\r\n\t\t\t\treturn (!prefix && !surfix) ? options.inverse(this) : options.fn(this);\r\n\t\t\t});\r\n\t\t\tthis.set({\r\n\t\t\t\tlayoutTpl : layoutTpl,\r\n\t\t\t\tbtnTpl : btnTpl\r\n\t\t\t});\r\n\t\t},\t\r\n\t\tinitModal : function () {\r\n\t\t\tvar self = this;\r\n\t\t\tself.modal = new Hualala.UI.ModalDialog({\r\n\t\t\t\tid : 'service_edit',\r\n\t\t\t\tclz : 'service-modal',\r\n\t\t\t\ttitle : self.getModalTitle(),\r\n\t\t\t\tafterRemove : function () {\r\n\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t},\r\n\t\tinitSwitcher : function (selector) {\r\n\t\t\tvar self = this;\r\n\t\t\tself.modal._.body.find(selector).each(function () {\r\n\t\t\t\tvar $el = $(this),\r\n\t\t\t\t\tonLabel = $el.attr('data-onLabel'),\r\n\t\t\t\t\toffLabel = $el.attr('data-offLabel');\r\n\t\t\t\t$el.bootstrapSwitch({\r\n\t\t\t\t\tsize : 'normal',\r\n\t\t\t\t\tonColor : 'primary',\r\n\t\t\t\t\toffColor : 'default',\r\n\t\t\t\t\tonText : onLabel,\r\n\t\t\t\t\toffText : offLabel\r\n\t\t\t\t});\r\n\t\t\t});\r\n\t\t},\r\n\t\tinitTimePicker : function (selector) {\r\n\t\t\tvar self = this;\r\n\t\t\tself.modal._.body.find(selector).timepicker({\r\n\t\t\t\tminuteStep : 30,\r\n\t\t\t\tshowSeconds : false,\r\n\t\t\t\tshowMeridian :  false,\r\n\t\t\t\tdisableFocus : true,\r\n\t\t\t\tshowInputs : false\r\n\t\t\t});\r\n\t\t},\r\n\t\tgetServiceInfo : function (key, val) {\r\n\t\t\tvar self = this;\r\n\t\t\tvar operationMode = self.model.get('operationMode');\r\n\t\t\tvar servData = IX.inherit({}, _.find(this.serviceList, function (v) {return v[key] == val}));\r\n\t\t\tif (!IX.isEmpty($XP(servData, 'operationMode'))) {\r\n\t\t\t\tservData = IX.inherit(servData, {\r\n\t\t\t\t\tformKeys : $XP(servData, 'operationMode.' + operationMode)\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t\treturn servData;\r\n\t\t},\r\n\t\tgetModalTitle : function () {\r\n\t\t\treturn $XP(this.serviceInfo, 'label') + '配置';\r\n\t\t},\r\n\t\tbindEvent : function () {\r\n\t\t\tvar self = this;\r\n\t\t\tvar fvOpts = self.initValidFieldOpts();\r\n\t\t\tthis.on({\r\n\t\t\t\tshow : function () {\r\n\t\t\t\t\tthis.modal.show();\r\n\t\t\t\t},\r\n\t\t\t\thide : function () {\r\n\t\t\t\t\tthis.modal.hide();\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\tself.modal._.dialog.find('.btn').on('click', function (e) {\r\n\t\t\t\tvar $btn = $(this),\r\n\t\t\t\t\tact = $btn.attr('name');\r\n\t\t\t\tif (act == 'cancel') {\r\n\t\t\t\t\tself.emit('hide');\r\n\t\t\t\t} else {\r\n\t\t\t\t\tvar bv = self.modal._.body.find('form').data('bootstrapValidator');\r\n\t\t\t\t\t$btn.button('提交中...');\r\n\t\t\t\t\tbv.validate();\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\tself.modal._.body.find('form').bootstrapValidator({\r\n\t\t\t\ttrigger : 'blur',\r\n\t\t\t\tfields : fvOpts\r\n\t\t\t}).on('error.field.bv', function (e, data) {\r\n\t\t\t\tvar $form = $(e.target),\r\n\t\t\t\t\tbv = $form.data('bootstrapValidator');\r\n\t\t\t}).on('success.form.bv', function (e, data) {\r\n\t\t\t\te.preventDefault();\r\n\t\t\t\tvar $form = $(e.target),\r\n\t\t\t\t\tbv = $form.data('bootstrapValidator');\r\n\t\t\t\tvar formParams = self.serializeForm();\r\n\t\t\t\tIX.Debug.info(\"DEBUG: Shop Business Service Edit View Form Params : \");\r\n\t\t\t\tIX.Debug.info(formParams);\r\n\t\t\t\tself.model.emit('setServiceParams', {\r\n\t\t\t\t\tcallServer : self.callServer,\r\n\t\t\t\t\tparams : formParams,\r\n\t\t\t\t\tserviceID : self.serviceID,\r\n\t\t\t\t\tfailFn : function () {\r\n\t\t\t\t\t\tself.modal._.footer.find('.btn[name=submit]').button('reset');\r\n\t\t\t\t\t},\r\n\t\t\t\t\tsuccessFn : function () {\r\n\t\t\t\t\t\tself.modal._.footer.find('.btn[name=submit]').button('reset');\r\n\t\t\t\t\t\tself.emit('hide');\r\n\t\t\t\t\t\tself.successFn(self.model, self.serviceID, formParams, self.$trigger);\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t});;\r\n\t\t},\r\n\t\tdecodeTimeStr : function (t) {\r\n\t\t\tif (t.length == 0) return '';\r\n\t\t\treturn t.substr(0,2) + ':' + t.substr(2);\r\n\t\t},\r\n\t\tencodeTimeStr : function (min, max) {\r\n\t\t\treturn (min + ',' + max).replace(/\\:/g, '');\r\n\t\t},\r\n\t\t// 获取表单元素渲染数据\r\n\t\tmapServiceFormElsData : function () {\r\n\t\t\tvar self = this,\r\n\t\t\t\tformKeys = $XP(self.serviceInfo, 'formKeys', '').split(','),\r\n\t\t\t\tformEls = _.map(formKeys, function (key) {\r\n\t\t\t\t\tvar elCfg = ServiceFormElsHT.get(key),\r\n\t\t\t\t\t\ttype = $XP(elCfg, 'type');\r\n\t\t\t\t\tif (type == 'section' && key == 'servicePeriods') {\r\n\t\t\t\t\t\tvar v = $XP(self.formParams, key, '').split(',');\r\n\t\t\t\t\t\tv = _.map(v, function (t) {\r\n\t\t\t\t\t\t\treturn self.decodeTimeStr(t);\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t\treturn IX.inherit(elCfg, {\r\n\t\t\t\t\t\t\tmin : IX.inherit($XP(elCfg, 'min'), {\r\n\t\t\t\t\t\t\t\tvalue : v[0] || $XP(elCfg, 'min.defaultVal')\r\n\t\t\t\t\t\t\t}),\r\n\t\t\t\t\t\t\tmax : IX.inherit($XP(elCfg, 'max'), {\r\n\t\t\t\t\t\t\t\tvalue : v[1] || $XP(elCfg, 'max.defaultVal')\r\n\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t} else if (type == 'combo') {\r\n\t\t\t\t\t\tvar v = $XP(self.formParams, key, $XP(elCfg, 'defaultVal')),\r\n\t\t\t\t\t\t\toptions = _.map($XP(elCfg, 'options'), function (op) {\r\n\t\t\t\t\t\t\t\treturn IX.inherit(op, {\r\n\t\t\t\t\t\t\t\t\tselected : $XP(op, 'value') == v ? 'selected' : ''\r\n\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\treturn IX.inherit(elCfg, {\r\n\t\t\t\t\t\t\tvalue : $XP(self.formParams, key, $XP(elCfg, 'defaultVal')),\r\n\t\t\t\t\t\t\toptions : options\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t} else if (type == 'switcher') {\r\n\t\t\t\t\t\tif (key == 'checkSpotOrder') {\r\n\t\t\t\t\t\t\treturn IX.inherit(elCfg, {\r\n\t\t\t\t\t\t\t\tchecked : self.serviceFeatures.indexOf('spot_pay') >= 0 ? 'checked' : ''\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\treturn IX.inherit(elCfg, {\r\n\t\t\t\t\t\t\t\tchecked : $XP(self.formParams, key) == $XP(elCfg, 'defaultVal') ? 'checked' : ''\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t} else if (type == 'text' && self.serviceID == \"20\" && key == \"minAmount\") {\r\n\t\t\t\t\t\treturn IX.inherit(elCfg, {\r\n\t\t\t\t\t\t\tlabel : \"起送金额\",\r\n\t\t\t\t\t\t\tvalue : $XP(self.formParams, key, 0)\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t} else if (type == 'text' && self.serviceID == \"20\" && key == \"serviceAmount\") {\r\n\t\t\t\t\t\treturn IX.inherit(elCfg, {\r\n\t\t\t\t\t\t\tlabel : \"送餐费\",\r\n\t\t\t\t\t\t\tvalue : $XP(self.formParams, key, 0)\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t} else if (type == 'text' && self.serviceID == \"20\" && key == \"freeServiceAmount\") {\r\n\t\t\t\t\t\treturn IX.inherit(elCfg, {\r\n\t\t\t\t\t\t\tlabel : \"免送餐费金额\",\r\n\t\t\t\t\t\t\tprefix : '满',\r\n\t\t\t\t\t\t\tsurfix : Hualala.Constants.CashUnit + \"，免送餐费\",\r\n\t\t\t\t\t\t\tvalue : $XP(self.formParams, key, $XP(elCfg, 'defaultVal'))\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\treturn IX.inherit(elCfg, {\r\n\t\t\t\t\t\t\tvalue : $XP(self.formParams, key, $XP(elCfg, 'defaultVal'))\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\tIX.Debug.info(\"DEBUG: Shop Business Service Edit View Form Elements : \");\r\n\t\t\tIX.Debug.info(formEls);\r\n\t\t\treturn formEls;\r\n\t\t},\r\n\t\t// 渲染表单\r\n\t\trenderForm : function () {\r\n\t\t\tvar self = this,\r\n\t\t\t\tfvOpts = self.initValidFieldOpts(),\r\n\t\t\t\trenderData = self.mapServiceFormElsData(),\r\n\t\t\t\ttpl = self.get('layoutTpl'),\r\n\t\t\t\tbtnTpl = self.get('btnTpl'),\r\n\t\t\t\thtm = tpl({\r\n\t\t\t\t\tformClz : 'shop-service-form form-feedback-out',\r\n\t\t\t\t\titems : renderData\r\n\t\t\t\t});\r\n\t\t\tself.modal._.body.html(htm);\r\n\t\t\tself.modal._.footer.html(btnTpl({\r\n\t\t\t\tbtns : [\r\n\t\t\t\t\t{clz : 'btn-default', name : 'cancel', label : '取消'},\r\n\t\t\t\t\t{clz : 'btn-warning', name : 'submit', label : '保存'}\r\n\t\t\t\t]\r\n\t\t\t}));\r\n\r\n\t\t\tself.initSwitcher(':checkbox[data-type=switcher]');\r\n\t\t\tself.initTimePicker('[data-type=timepicker]');\r\n\r\n\t\t},\r\n\t\t// 获取表单数据\r\n\t\tserializeForm : function () {\r\n\t\t\tvar self = this,\r\n\t\t\t\tformKeys = $XP(self.serviceInfo, 'formKeys', '').split(','),\r\n\t\t\t\tret = {},\r\n\t\t\t\tformEls = _.map(formKeys, function (key) {\r\n\t\t\t\t\tvar elCfg = ServiceFormElsHT.get(key),\r\n\t\t\t\t\t\ttype = $XP(elCfg, 'type');\r\n\t\t\t\t\tif (type == 'section' && key == 'servicePeriods') {\r\n\t\t\t\t\t\tvar min = $('[name=' + key + '_min]').val(),\r\n\t\t\t\t\t\t\tmax = $('[name=' + key + '_max]').val();\r\n\t\t\t\t\t\tret[key] = self.encodeTimeStr(min, max);\r\n\t\t\t\t\t} else if (type == 'switcher') {\r\n\t\t\t\t\t\t// ret[key] = $('[name=' + key + ']').attr('checked') ? 1 : 0;\r\n\t\t\t\t\t\tret[key] = !$('[name=' + key + ']').data('bootstrapSwitch').options.state ? 0 : 1;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tret[key] = $('[name=' + key + ']').val();\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\treturn ret;\r\n\t\t},\r\n\t\t// 获取表单验证配置\r\n\t\tinitValidFieldOpts : function () {\r\n\t\t\tvar self = this,\r\n\t\t\t\tformKeys = $XP(self.serviceInfo, 'formKeys', '').split(','),\r\n\t\t\t\tret = {};\r\n\t\t\t_.each(formKeys, function (key) {\r\n\t\t\t\tvar elCfg = ServiceFormElsHT.get(key),\r\n\t\t\t\t\ttype = $XP(elCfg, 'type');\r\n\t\t\t\tif (type == 'section') {\r\n\t\t\t\t\tvar min = key + '_min', max = key + '_max';\r\n\t\t\t\t\tret[min] = $XP(elCfg, 'min.validCfg', {});\r\n\t\t\t\t\tret[max] = $XP(elCfg, 'max.validCfg', {});\r\n\t\t\t\t} else {\r\n\t\t\t\t\tret[key] = $XP(elCfg, 'validCfg', {});\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\treturn ret;\r\n\t\t}\r\n\t});\r\n\tHualala.Setting.editServiceView = editServiceView;\r\n\r\n\r\n\tvar bindSettleUnitView = Stapes.subclass({\r\n\t\tconstructor : function (cfg) {\r\n\t\t\tthis.$trigger = $XP(cfg, 'triggerEl', null);\r\n\t\t\tthis.settleID = $XP(cfg, 'settleID', '');\r\n\t\t\tthis.model = $XP(cfg, 'model', null);\r\n\t\t\tthis.successFn = $XF(cfg, 'successFn');\r\n\t\t\tthis.getSettleUnitsCallServer = Hualala.Global.queryAccount;\r\n\t\t\tthis.bindSettleUnitCallServer = Hualala.Global.bindSettleUnitByShopID;\r\n\t\t\tthis.modal = null;\r\n\t\t\tthis.$body = null;\r\n\t\t\tthis.$footer = null;\r\n\t\t\tif (!this.$trigger || !this.settleID || !this.model) {\r\n\t\t\t\tthrow(\"Bind Settle Unit View init failed!\");\r\n\t\t\t}\r\n\t\t\tthis.loadTemplates();\r\n\t\t\tthis.initModal();\r\n\t\t\tthis.bindEvent();\r\n\t\t\tthis.emit('load');\r\n\t\t}\r\n\t});\r\n\tbindSettleUnitView.proto({\r\n\t\tloadTemplates : function () {\r\n\t\t\tvar self = this;\r\n\t\t\tvar layoutTpl = Handlebars.compile(Hualala.TplLib.get('tpl_role_bind_shop')),\r\n\t\t\t\tlistTpl = Handlebars.compile(Hualala.TplLib.get('tpl_settle_list')),\r\n\t\t\t\titemTpl = Handlebars.compile(Hualala.TplLib.get('tpl_settle_item'));\r\n\t\t\tHandlebars.registerPartial(\"settleItem\", Hualala.TplLib.get('tpl_settle_item'));\r\n\t\t\tHandlebars.registerHelper('checkItemType', function (conditional, options) {\r\n\t\t\t\treturn (conditional == options.hash.type) ? options.fn(this) : options.inverse(this);\r\n\t\t\t});\r\n\t\t\tthis.set({\r\n\t\t\t\tlayoutTpl : layoutTpl,\r\n\t\t\t\tlistTpl : listTpl,\r\n\t\t\t\titemTpl : itemTpl\r\n\t\t\t});\r\n\t\t},\r\n\t\tinitModal : function () {\r\n\t\t\tvar self = this;\r\n\t\t\tself.modal = new Hualala.UI.ModalDialog({\r\n\t\t\t\tid : 'bind_settle_modal',\r\n\t\t\t\tclz : 'account-modal',\r\n\t\t\t\ttitle : \"绑定结算账户\"\r\n\t\t\t});\r\n\t\t\tself.$body = self.modal._.body;\r\n\t\t\tself.$footer = self.modal._.footer;\r\n\t\t\tvar layoutTpl = self.get('layoutTpl'),\r\n\t\t\t\thtm = layoutTpl({\r\n\t\t\t\t\tclz : '',\r\n\t\t\t\t\ttitle : '选择店铺要绑定的结算账户'\r\n\t\t\t\t});\r\n\t\t\tself.$body.html(htm);\r\n\t\t\tself.$resultBox = self.$body.find('.result-box');\r\n\t\t},\r\n\t\tbindEvent : function () {\r\n\t\t\tvar self = this;\r\n\t\t\tthis.on({\r\n\t\t\t\t\"show\" : function () {\r\n\t\t\t\t\tself.modal.show();\r\n\t\t\t\t},\r\n\t\t\t\t\"hide\" : function () {\r\n\t\t\t\t\tself.modal.hide();\r\n\t\t\t\t},\r\n\t\t\t\t\"load\" : function () {\r\n\t\t\t\t\tif (!self.origSettleData) {\r\n\t\t\t\t\t\tself.getSettleUnitsCallServer({}, function (res) {\r\n\t\t\t\t\t\t\tif (res.resultcode != '000') {\r\n\t\t\t\t\t\t\t\ttoptip({\r\n\t\t\t\t\t\t\t\t\tmsg : $XP(res, 'resultmsg', ''),\r\n\t\t\t\t\t\t\t\t\ttype : 'danger'\r\n\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t\tself.emit('hide');\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\tself.origSettleData = $XP(res, 'data.records', []);\r\n\t\t\t\t\t\t\t\tself.render(self.origSettleData);\r\n\t\t\t\t\t\t\t\tself.emit('show');\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tself.render(self.origSettleData);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\tself.$resultBox.tooltip({\r\n\t\t\t\tselector : '[title]'\r\n\t\t\t});\r\n\t\t\tself.$resultBox.delegate(':radio', 'change', function (e) {\r\n\t\t\t\tvar $el = $(this),\r\n\t\t\t\t\tchecked = !this.checked ? false : true,\r\n\t\t\t\t\titemID = $el.val();\r\n\t\t\t\tself.curSettleUnit = _.find(self.origSettleData, function (settle) {return $XP(settle, 'settleUnitID', '') == itemID;});\r\n\t\t\t});\r\n\t\t\tself.$footer.delegate('.btn', 'click', function (e) {\r\n\t\t\t\tvar $btn = $(this),\r\n\t\t\t\t\tact = $btn.hasClass('btn-ok') ? 'ok' : 'cancel';\r\n\t\t\t\tif (act == 'cancel') {\r\n\t\t\t\t\tself.emit('hide');\r\n\t\t\t\t} else {\r\n\t\t\t\t\t// 设置角色绑定店铺数据\r\n\t\t\t\t\tself.bindItems();\r\n\t\t\t\t\t\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t},\r\n\t\tbindItems : function () {\r\n\t\t\tvar self = this;\r\n\t\t\tself.bindSettleUnitCallServer({\r\n\t\t\t\tshopID : self.model.get('shopID'),\r\n\t\t\t\tsettleID : $XP(self.curSettleUnit, 'settleUnitID'),\r\n\t\t\t\tsettleName : $XP(self.curSettleUnit, 'settleUnitName'),\r\n\t\t\t\toldSettleID : self.settleID\r\n\t\t\t}, function (res) {\r\n\t\t\t\tif (res.resultcode != '000') {\r\n\t\t\t\t\ttoptip({\r\n\t\t\t\t\t\tmsg : $XP(res, 'resultmsg', ''),\r\n\t\t\t\t\t\ttype : 'danger'\r\n\t\t\t\t\t});\r\n\t\t\t\t} else {\r\n\t\t\t\t\ttoptip({\r\n\t\t\t\t\t\tmsg : '绑定成功',\r\n\t\t\t\t\t\ttype : 'success'\r\n\t\t\t\t\t});\r\n\t\t\t\t\tself.emit('hide');\r\n\t\t\t\t\tself.successFn(self.model, self.$trigger, self.curSettleUnit);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t},\r\n\t\tmapRenderData : function (data) {\r\n\t\t\tvar self = this;\r\n\t\t\tvar ret = _.map(data, function (settle, i, l) {\r\n\t\t\t\tvar id = $XP(settle, 'settleUnitID'),\r\n\t\t\t\t\tchecked = id == self.settleID ? 'checked' : '';\r\n\t\t\t\tif (checked == 'checked') {\r\n\t\t\t\t\tself.curSettleUnit = settle;\r\n\t\t\t\t}\r\n\t\t\t\treturn IX.inherit(settle, {\r\n\t\t\t\t\ttype : 'radio',\r\n\t\t\t\t\tclz : 'bind-item',\r\n\t\t\t\t\tsettleUnitNameLabel : $XP(settle, 'settleUnitName', ''),\r\n\t\t\t\t\tchecked : checked\r\n\t\t\t\t});\r\n\t\t\t});\r\n\t\t\treturn ret;\r\n\t\t},\r\n\t\trender : function (data) {\r\n\t\t\tvar self = this,\t\r\n\t\t\t\tlistTpl = self.get('listTpl');\r\n\t\t\tvar renderData = self.mapRenderData(data);\r\n\t\t\tvar htm = listTpl({\r\n\t\t\t\tsettleList : {\r\n\t\t\t\t\tlist : renderData\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\tself.$resultBox.html(htm);\r\n\t\t}\r\n\t});\r\n\tHualala.Setting.bindSettleUnitView = bindSettleUnitView;\r\n})(jQuery, window);;(function ($, window) {\r\n\tIX.ns(\"Hualala.Setting\");\r\n\tvar initShopMgr = function (pageType, params) {\r\n\t\tvar $body = $('#ix_wrapper > .ix-body > .container');\r\n\t\tvar queryPanel = new Hualala.Shop.QueryController({\r\n\t\t\tneedShopCreate : false,\r\n\t\t\tcontainer : $body,\r\n\t\t\tresultController : new Hualala.Shop.ShopListController({\r\n\t\t\t\tcontainer : $body,\r\n\t\t\t\tmodel : new Hualala.Shop.CardListModel({callServer : Hualala.Global.queryShop}),\r\n\t\t\t\tview : new Hualala.Shop.ShopListView()\r\n\t\t\t})\r\n\t\t});\r\n\t};\r\n\tHualala.Setting.ShopMgrInit = initShopMgr;\r\n})(jQuery, window);;(function ($, window) {\r\n\tIX.ns(\"Hualala.Account\");\r\n\tvar popoverMsg = Hualala.UI.PopoverMsgTip;\r\n\tvar toptip = Hualala.UI.TopTip;\r\n\tvar CardListModel = Hualala.Shop.CardListModel;\r\n\tvar AccountListModel = CardListModel.subclass({\r\n\t\tconstructor : CardListModel.prototype.constructor\r\n\t});\r\n\tAccountListModel.proto({\r\n\t\tinit : function (params) {\r\n\t\t\tthis.set({\r\n\t\t\t\tpageCount : 0,\r\n\t\t\t\ttotalSize : 0,\r\n\t\t\t\tpageNo : $XP(params, 'pageNo', 1),\r\n\t\t\t\tpageSize : $XP(params, 'pageSize', 15),\r\n\t\t\t\ttransCreateBeginTime : $XP(params, 'transCreateBeginTime', ''),\r\n\t\t\t\ttransCreateEndTime : $XP(params, 'transCreateEndTime', ''),\r\n\t\t\t\tsettleUnitID : $XP(params, 'settleUnitID', ''),\r\n\t\t\t\ttransStatus : $XP(params, 'transStatus', ''),\r\n\t\t\t\ttransType : $XP(params, 'transType', ''),\r\n\t\t\t\tgroupID : $XP(params, 'groupID', ''),\r\n\t\t\t\tminTransAmount : $XP(params, 'minTransAmount', ''),\r\n\t\t\t\tmaxTransAmount : $XP(params, 'maxTransAmount', ''),\r\n\t\t\t\tds_account : new IX.IListManager(),\r\n\t\t\t\tds_page : new IX.IListManager()\r\n\t\t\t});\r\n\t\t},\r\n\t\tupdatePagerParams : function (params) {\r\n\t\t\tvar self = this;\r\n\t\t\tvar pagerParamkeys = 'pageCount,totalSize,pageNo,pageSize,transCreateBeginTime,transCreateEndTime,settleUnitID,transStatus,transType,groupID,minTransAmount,maxTransAmount';\r\n\t\t\t_.each(params, function (v, k, l) {\r\n\t\t\t\tif (pagerParamkeys.indexOf(k) > -1) {\r\n\t\t\t\t\tself.set(k, v);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t},\r\n\t\tgetPagerParams : function () {\r\n\t\t\t// return {\r\n\t\t\t// \tPage : {\r\n\t\t\t// \t\tpageNo : this.get('pageNo'),\r\n\t\t\t// \t\tpageSize : this.get('pageSize')\r\n\t\t\t// \t},\r\n\t\t\t// \tsettleUnitID : this.get('settleUnitID'),\r\n\t\t\t// \ttransCreateBeginTime : this.get('transCreateBeginTime'),\r\n\t\t\t// \ttransCreateEndTime : this.get('transCreateEndTime'),\r\n\t\t\t// \ttransStatus : this.get('transStatus'),\r\n\t\t\t// \ttransType : this.get('transType'),\r\n\t\t\t// \tgroupID : this.get('groupID'),\r\n\t\t\t// \tminTransAmount : this.get('minTransAmount'),\r\n\t\t\t// \tmaxTransAmount : this.get('maxTransAmount')\r\n\t\t\t// };\r\n\t\t\treturn {\r\n\t\t\t\tpageNo : this.get('pageNo'),\r\n\t\t\t\tpageSize : this.get('pageSize'),\r\n\t\t\t\tsettleUnitID : this.get('settleUnitID'),\r\n\t\t\t\ttransCreateBeginTime : this.get('transCreateBeginTime'),\r\n\t\t\t\ttransCreateEndTime : this.get('transCreateEndTime'),\r\n\t\t\t\ttransStatus : this.get('transStatus'),\r\n\t\t\t\ttransType : this.get('transType'),\r\n\t\t\t\tgroupID : this.get('groupID'),\r\n\t\t\t\tminTransAmount : this.get('minTransAmount'),\r\n\t\t\t\tmaxTransAmount : this.get('maxTransAmount')\r\n\t\t\t};\r\n\t\t},\r\n\t\tupdateDataStore : function (data, pageNo) {\r\n\t\t\tvar self = this,\r\n\t\t\t\taccountHT = self.get('ds_account'),\r\n\t\t\t\tpageHT = self.get('ds_page');\r\n\t\t\tvar accountIDs = _.map(data, function (account, i, l) {\r\n\t\t\t\tvar settleUnitID = $XP(account, 'settleUnitID'),\r\n\t\t\t\t\tmAccount = new BaseAccountModel(account);\r\n\t\t\t\taccountHT.register(settleUnitID, mAccount);\r\n\t\t\t\treturn settleUnitID;\r\n\t\t\t});\r\n\t\t\tpageHT.register(pageNo, accountIDs);\r\n\t\t},\r\n\t\tresetDataStore : function () {\r\n\t\t\tvar self = this,\r\n\t\t\t\taccountHT = self.get('ds_account'),\r\n\t\t\t\tpageHT = self.get('ds_page');\r\n\t\t\taccountHT.clear();\r\n\t\t\tpageHT.clear();\r\n\t\t},\r\n\t\tload : function (params, cbFn) {\r\n\t\t\tvar self = this;\r\n\t\t\tself.updatePagerParams(params);\r\n\t\t\tself.callServer(self.getPagerParams(), function (res) {\r\n\t\t\t\tif (res.resultcode == '000') {\r\n\t\t\t\t\tself.updateDataStore($XP(res, 'data.records', []), $XP(res, 'data.page.pageNo'));\r\n\t\t\t\t\tself.updatePagerParams(IX.inherit($XP(res, 'data', {}), $XP(res, 'data.page', {})));\r\n\t\t\t\t} else {\r\n\t\t\t\t\ttoptip({\r\n\t\t\t\t\t\tmsg : $XP(res, 'resultmsg', ''),\r\n\t\t\t\t\t\ttype : 'danger'\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t\tcbFn(self);\r\n\t\t\t});\r\n\t\t},\r\n\t\tgetAccounts : function (pageNo) {\r\n\t\t\tvar self = this,\r\n\t\t\t\taccountHT = self.get('ds_account'),\r\n\t\t\t\tpageHT = self.get('ds_page');\r\n\t\t\tvar ret = _.map(accountHT.getByKeys(pageHT.get(pageNo)), function (mAccount) {\r\n\t\t\t\treturn mAccount.getAll();\r\n\t\t\t});\r\n\t\t\tIX.Debug.info(\"DEBUG: Account List Model PageData :\");\r\n\t\t\tIX.Debug.info(ret);\r\n\t\t\treturn ret;\r\n\t\t},\r\n\t\tgetAccountModelByID : function (accountID) {\r\n\t\t\tvar self = this,\t\r\n\t\t\t\taccountHT = self.get('ds_account');\r\n\t\t\treturn accountHT.get(accountID);\r\n\t\t}\r\n\t});\r\n\r\n\r\n\tHualala.Account.AccountListModel = AccountListModel;\r\n\r\n\tvar BaseAccountModel = Stapes.subclass({\r\n\t\tconstructor : function (account) {\r\n\t\t\t!IX.isEmpty(account) && this.set(account);\r\n\t\t\tthis.bindEvent();\r\n\t\t}\r\n\t});\r\n\tBaseAccountModel.proto({\r\n\t\tbindEvent : function () {\r\n\t\t\tvar self = this;\r\n\t\t\tself.on({\r\n\t\t\t\t\"load\" : function (params) {\r\n\t\t\t\t\tvar settleUnitID = $XP(params, 'settleUnitID'),\r\n\t\t\t\t\t\tcbFn = $XF(params, 'cbFn');\r\n\t\t\t\t\tvar callServer = Hualala.Global.queryAccount,\r\n\t\t\t\t\t\tgroupID = $XP(Hualala.getSessionSite(), 'groupID', '');\r\n\t\t\t\t\tcallServer({\r\n\t\t\t\t\t\tsettleUnitID : settleUnitID,\r\n\t\t\t\t\t\tgroupID : groupID\r\n\t\t\t\t\t}, function (res) {\r\n\t\t\t\t\t\tvar records = $XP(res, \"data.records\", []);\r\n\t\t\t\t\t\tif (records.length == 0) {\r\n\t\t\t\t\t\t\tthrow(\"get Account Data (\" + settleUnitID + \") Failed!\");\r\n\t\t\t\t\t\t\treturn ;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tself.set(records[0]);\r\n\t\t\t\t\t\tcbFn();\r\n\t\t\t\t\t});\r\n\t\t\t\t},\r\n\t\t\t\t// 提现\r\n\t\t\t\t\"withdrawCash\" : function (cfg) {\r\n\t\t\t\t\tvar callServer = Hualala.Global.withdrawCash,\r\n\t\t\t\t\t\tparams = $XP(cfg, 'params', {}),\r\n\t\t\t\t\t\tsettleUnitID = self.get('settleUnitID'),\r\n\t\t\t\t\t\tfailFn = $XF(cfg, 'failFn'),\r\n\t\t\t\t\t\tsuccessFn = $XF(cfg, 'successFn'),\r\n\t\t\t\t\t\tpoundageAmount = self.get('poundageAmount') || 0,\r\n\t\t\t\t\t\tpoundageMinAmount = self.get('poundageMinAmount') || 0;\r\n\t\t\t\t\tcallServer(IX.inherit(params, {\r\n\t\t\t\t\t\tsettleUnitID : settleUnitID,\r\n\t\t\t\t\t\tpoundageAmount : poundageAmount,\r\n\t\t\t\t\t\tpoundageMinAmount : poundageMinAmount\r\n\t\t\t\t\t}), function (res) {\r\n\t\t\t\t\t\tif (res.resultcode !== '000') {\r\n\t\t\t\t\t\t\ttoptip({\r\n\t\t\t\t\t\t\t\tmsg : $XP(res, 'resultmsg', ''),\r\n\t\t\t\t\t\t\t\ttype : 'danger'\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\tfailFn();\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tvar transAmount = $XP(params, 'transAmount', 0),\r\n\t\t\t\t\t\t\t\tsettleBalance = self.get('settleBalance') || 0,\r\n\t\t\t\t\t\t\t\tnewSettleBalance = Hualala.Common.Math.sub(settleBalance - transAmount);\r\n\t\t\t\t\t\t\tself.set('settleBalance', newSettleBalance);\r\n\t\t\t\t\t\t\t// TODO update View\r\n\t\t\t\t\t\t\tsuccessFn();\r\n\t\t\t\t\t\t\ttoptip({\r\n\t\t\t\t\t\t\t\tmsg : '提现成功!',\r\n\t\t\t\t\t\t\t\ttype : 'success'\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t},\r\n\t\t\t\t// 删除结算账户\r\n\t\t\t\t\"delete\" : function (cfg) {\r\n\t\t\t\t\tvar callServer = Hualala.Global.deleteAccount,\r\n\t\t\t\t\t\tsettleUnitID = self.get('settleUnitID'),\r\n\t\t\t\t\t\tgroupID = $XP(Hualala.getSessionSite(), 'groupID', ''),\r\n\t\t\t\t\t\tfailFn = $XF(cfg, 'failFn'),\r\n\t\t\t\t\t\tsuccessFn = $XF(cfg, 'successFn');\r\n\t\t\t\t\tcallServer({\r\n\t\t\t\t\t\tsettleUnitID : settleUnitID,\r\n\t\t\t\t\t\tgroupID : groupID\r\n\t\t\t\t\t}, function (res) {\r\n\t\t\t\t\t\tif (res.resultcode !== '000') {\r\n\t\t\t\t\t\t\ttoptip({\r\n\t\t\t\t\t\t\t\tmsg : $XP(res, 'resultmsg', ''),\r\n\t\t\t\t\t\t\t\ttype : 'danger'\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\tfailFn(settleUnitID);\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\ttoptip({\r\n\t\t\t\t\t\t\t\tmsg : '删除成功!',\r\n\t\t\t\t\t\t\t\ttype : 'success'\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t// TODO update View\r\n\t\t\t\t\t\t\tsuccessFn(settleUnitID);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t},\r\n\t\t\t\t// 编辑结算账户\r\n\t\t\t\t\"edit\" : function (cfg) {\r\n\t\t\t\t\tvar callServer = Hualala.Global.editAccount,\r\n\t\t\t\t\t\tsettleUnitID = self.get('settleUnitID'),\r\n\t\t\t\t\t\tgroupID = $XP(Hualala.getSessionSite(), 'groupID', ''),\r\n\t\t\t\t\t\tfailFn = $XF(cfg, 'failFn'),\r\n\t\t\t\t\t\tsuccessFn = $XF(cfg, 'successFn');\r\n\t\t\t\t\tcallServer(IX.inherit($XP(cfg, 'params', {}), {\r\n\t\t\t\t\t\tgroupID : groupID,\r\n\t\t\t\t\t\tsettleUnitID : settleUnitID\r\n\t\t\t\t\t}), function (res) {\r\n\t\t\t\t\t\tif (res.resultcode !== '000') {\r\n\t\t\t\t\t\t\ttoptip({\r\n\t\t\t\t\t\t\t\tmsg : $XP(res, 'resultmsg', ''),\r\n\t\t\t\t\t\t\t\ttype : 'danger'\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\tfailFn(settleUnitID);\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\ttoptip({\r\n\t\t\t\t\t\t\t\tmsg : '修改成功!',\r\n\t\t\t\t\t\t\t\ttype : 'success'\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t// TODO update View\r\n\t\t\t\t\t\t\tself.set($XP(cfg, 'params', {}));\r\n\t\t\t\t\t\t\tsuccessFn(settleUnitID);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t},\r\n\t\t\t\t// 添加结算账户\r\n\t\t\t\t\"add\" : function (cfg) {\r\n\t\t\t\t\tvar callServer = Hualala.Global.addAccount,\r\n\t\t\t\t\t\tgroupID = $XP(Hualala.getSessionSite(), 'groupID', ''),\r\n\t\t\t\t\t\tfailFn = $XF(cfg, 'failFn'),\r\n\t\t\t\t\t\tsuccessFn = $XF(cfg, 'successFn');\r\n\t\t\t\t\tcallServer(IX.inherit($XP(cfg, 'params', {}), {\r\n\t\t\t\t\t\tgroupID : groupID\r\n\t\t\t\t\t}), function (res) {\r\n\t\t\t\t\t\tif (res.resultcode !== '000') {\r\n\t\t\t\t\t\t\ttoptip({\r\n\t\t\t\t\t\t\t\tmsg : $XP(res, 'resultmsg', ''),\r\n\t\t\t\t\t\t\t\ttype : 'danger'\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\tfailFn();\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\ttoptip({\r\n\t\t\t\t\t\t\t\tmsg : '添加成功!',\r\n\t\t\t\t\t\t\t\ttype : 'success'\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t// TODO update View\r\n\t\t\t\t\t\t\tself.set($XP(cfg, 'params', {}));\r\n\t\t\t\t\t\t\tsuccessFn();\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\t});\r\n\r\n\tHualala.Account.BaseAccountModel = BaseAccountModel;\r\n\r\n\tvar AccountTransListModel = AccountListModel.subclass({\r\n\t\tconstructor : function () {\r\n\t\t\tthis.callServer = Hualala.Global.queryAccountTransDetail;\r\n\t\t}\r\n\t});\r\n\tAccountTransListModel.proto({\r\n\t\tinit : function (params) {\r\n\t\t\tthis.set({\r\n\t\t\t\tpageCount : 0,\r\n\t\t\t\ttotalSize : 0,\r\n\t\t\t\tpageNo : $XP(params, 'pageNo', 1),\r\n\t\t\t\tpageSize : $XP(params, 'pageSize', 15),\r\n\t\t\t\ttransCreateBeginTime : $XP(params, 'transCreateBeginTime', ''),\r\n\t\t\t\ttransCreateEndTime : $XP(params, 'transCreateEndTime', ''),\r\n\t\t\t\tsettleUnitID : $XP(params, 'settleUnitID', ''),\r\n\t\t\t\ttransStatus : $XP(params, 'transStatus', ''),\r\n\t\t\t\ttransType : $XP(params, 'transType', ''),\r\n\t\t\t\tgroupID : $XP(params, 'groupID', ''),\r\n\t\t\t\tminTransAmount : $XP(params, 'minTransAmount', ''),\r\n\t\t\t\tmaxTransAmount : $XP(params, 'maxTransAmount', ''),\r\n\t\t\t\tds_trans : new IX.IListManager(),\r\n\t\t\t\tds_page : new IX.IListManager()\r\n\t\t\t});\r\n\t\t},\r\n\t\tupdateDataStore : function (data, pageNo) {\r\n\t\t\tvar self = this,\r\n\t\t\t\ttransHT = self.get('ds_trans'),\r\n\t\t\t\tpageHT = self.get('ds_page');\r\n\t\t\tvar transIDs = _.map(data, function (trans, i, l) {\r\n\t\t\t\tvar transID = $XP(trans, 'SUATransItemID'),\r\n\t\t\t\t\tmTrans = new BaseTransactionModel(trans);\r\n\t\t\t\ttransHT.register(transID, mTrans);\r\n\t\t\t\treturn transID;\r\n\t\t\t});\r\n\t\t\tpageHT.register(pageNo, transIDs);\r\n\t\t},\r\n\t\tresetDataStore : function () {\r\n\t\t\tvar self = this,\r\n\t\t\t\ttransHT = self.get('ds_trans'),\r\n\t\t\t\tpageHT = self.get('ds_page');\r\n\t\t\ttransHT.clear();\r\n\t\t\tpageHT.clear();\r\n\t\t},\r\n\t\tload : function (params, cbFn) {\r\n\t\t\tvar self = this;\r\n\t\t\tself.updatePagerParams(params);\r\n\t\t\tself.callServer(self.getPagerParams(), function (res) {\r\n\t\t\t\tif (res.resultcode == '000') {\r\n\t\t\t\t\tself.updateDataStore($XP(res, 'data.records', []), $XP(res, 'data.page.pageNo'));\r\n\t\t\t\t\tself.updatePagerParams(IX.inherit($XP(res, 'data', {}), $XP(res, 'data.page', {})));\r\n\t\t\t\t} else {\r\n\t\t\t\t\ttoptip({\r\n\t\t\t\t\t\tmsg : $XP(res, 'resultmsg', ''),\r\n\t\t\t\t\t\ttype : 'danger'\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t\tcbFn(self);\r\n\t\t\t});\r\n\t\t},\r\n\t\tgetDataByPageNo : function (pageNo) {\r\n\t\t\tvar self = this,\r\n\t\t\t\ttransHT = self.get('ds_trans'),\r\n\t\t\t\tpageHT = self.get('ds_page');\r\n\t\t\tvar ret = _.map(transHT.getByKeys(pageHT.get(pageNo)), function (mTrans) {\r\n\t\t\t\treturn mTrans.getAll();\r\n\t\t\t});\r\n\t\t\tIX.Debug.info(\"DEBUG: Account TransList Model PageData :\");\r\n\t\t\tIX.Debug.info(ret);\r\n\t\t\treturn ret;\r\n\t\t},\r\n\t\tgetModelByID : function (transID) {\r\n\t\t\tvar self = this,\t\r\n\t\t\t\ttransHT = self.get('ds_trans');\r\n\t\t\treturn transHT.get(transID);\r\n\t\t}\r\n\t});\r\n\r\n\tHualala.Account.AccountTransListModel = AccountTransListModel;\r\n\r\n\tvar BaseTransactionModel = BaseAccountModel.subclass({\r\n\t\tconstructor : BaseAccountModel.prototype.constructor\r\n\t});\r\n\tBaseTransactionModel.proto({\r\n\t\tbindEvent : function () {\r\n\t\t\tvar self = this;\r\n\t\t\t\r\n\t\t}\r\n\t});\r\n\r\n\tHualala.Account.BaseTransactionModel = BaseTransactionModel;\r\n\r\n\tvar AccountQueryShopModel = Hualala.Shop.QueryModel.subclass({\r\n\t\tconstructor : function () {\r\n\t\t\t// 原始数据\r\n\t\t\tthis.origCities = [];\r\n\t\t\tthis.origAreas = [];\r\n\t\t\tthis.origShops = [];\r\n\t\t\t// 数据是否已经加载完毕\r\n\t\t\tthis.isReady = false;\r\n\t\t\t// this.callServer = Hualala.Global.getShopQuerySchema;\r\n\t\t\tthis.callServer = Hualala.Global.getAccountQueryShop;\r\n\t\t}\r\n\t});\r\n\r\n\tHualala.Account.AccountQueryShopModel = AccountQueryShopModel;\r\n\r\n\tvar AccountQueryShopResultModel = Hualala.Shop.CardListModel.subclass({\r\n\t\tconstructor : function () {\r\n\t\t\tthis.origData = null;\r\n\t\t\t\r\n\t\t\tthis.dataStore = new IX.IListManager();\r\n\t\t}\r\n\t});\r\n\tAccountQueryShopResultModel.proto({\r\n\t\tinitDataStore : function (data) {\r\n\t\t\tvar self = this;\r\n\t\t\tself.origData = data;\r\n\t\t\t_.each(self.origData, function (shop) {\r\n\t\t\t\tself.dataStore.register($XP(shop, 'shipID'), shop);\r\n\t\t\t});\r\n\t\t},\r\n\t\tload : function (params, cbFn) {\r\n\t\t\tvar self = this;\r\n\t\t\tself.updatePagerParams(params);\r\n\t\t\tvar pageNo = self.get('pageNo'),\r\n\t\t\t\tpageSize = self.get('pageSize'),\r\n\t\t\t\tcityID = self.get('cityID'),\r\n\t\t\t\tareaID = self.get('areaID'),\r\n\t\t\t\tkeywordLst = self.get('keywordLst'),\r\n\t\t\t\ttotalSize = 0,\r\n\t\t\t\tstart = (pageNo - 1) * pageSize,\r\n\t\t\t\tend = pageSize * pageNo,\r\n\t\t\t\tpageCount = 0;\r\n\t\t\tvar shops = [];\r\n\t\t\tshops = areaID.length > 0 ? _.filter(self.origData, function (_shop) {\r\n\t\t\t\treturn $XP(_shop, 'areaID') == areaID;\r\n\t\t\t}) : self.origData;\r\n\t\t\tshops = cityID.length > 0 ? _.filter(shops, function (_shop) {\r\n\t\t\t\treturn $XP(_shop, 'cityID') == cityID;\r\n\t\t\t}) : shops;\r\n\t\t\tshops = keywordLst.length > 0 ? _.filter(shops, function (_shop) {\r\n\t\t\t\treturn $XP(_shop, 'shopName') == keywordLst;\r\n\t\t\t}) : shops;\r\n\t\t\ttotalSize = shops.length;\r\n\t\t\tpageCount = Math.ceil(totalSize / pageSize);\r\n\t\t\tshops = _.filter(shops, function (_shop, idx) {\r\n\t\t\t\treturn idx >= start && idx < end;\r\n\t\t\t});\r\n\t\t\tself.updateDataStore(shops, pageNo);\r\n\t\t\tself.updatePagerParams({\r\n\t\t\t\tpageCount : pageCount,\r\n\t\t\t\ttotalSize : totalSize,\r\n\t\t\t\tpageNo : pageNo,\r\n\t\t\t\tpageSize : pageSize\r\n\t\t\t});\r\n\t\t\tcbFn(self);\r\n\t\t}\r\n\t});\r\n\r\n\tHualala.Account.AccountQueryShopResultModel = AccountQueryShopResultModel;\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n})(jQuery, window);;(function ($, window) {\r\n\tIX.ns(\"Hualala.Account\");\r\n\tvar popoverMsg = Hualala.UI.PopoverMsgTip;\r\n\tvar toptip = Hualala.UI.TopTip;\r\n\tvar CardListView = Hualala.Shop.CardListView;\r\n\tvar AccountListView = CardListView.subclass({\r\n\t\tconstructor : CardListView.prototype.constructor\r\n\t});\r\n\tAccountListView.proto({\r\n\t\t// 重载loadTemplates\r\n\t\t// 加载View层所需要的模板\r\n\t\tloadTemplates : function () {\r\n\t\t\tvar layoutTpl = Handlebars.compile(Hualala.TplLib.get('tpl_account_list_layout')),\r\n\t\t\t\tlistTpl = Handlebars.compile(Hualala.TplLib.get('tpl_account_list')),\r\n\t\t\t\titemTpl = Handlebars.compile(Hualala.TplLib.get('tpl_account_card')),\r\n\t\t\t\taddAccountTpl = Handlebars.compile(Hualala.TplLib.get('tpl_addAccount_Card'));\r\n\t\t\t// 注册accountCard子模板\r\n\t\t\tHandlebars.registerPartial(\"accountCard\", Hualala.TplLib.get('tpl_account_card'));\r\n\t\t\t// @NOTE: 新需求STORY #1074，任何权限的用户都不允许添加结算账户，所以屏蔽掉添加结算账户的片段\r\n\t\t\t// Handlebars.registerPartial(\"addAccountCard\", Hualala.TplLib.get('tpl_addAccount_Card'));\r\n\r\n\t\t\tthis.set({\r\n\t\t\t\tlayoutTpl : layoutTpl,\r\n\t\t\t\tlistTpl : listTpl,\r\n\t\t\t\titemTpl : itemTpl\r\n\t\t\t});\r\n\t\t},\r\n\t\t// 重载initLayout\r\n\t\tinitLayout : function () {\r\n\t\t\tvar layoutTpl = this.get('layoutTpl');\r\n\t\t\tvar htm = layoutTpl();\r\n\t\t\tthis.$container.append(htm);\r\n\t\t\tthis.$resultBox = this.$container.find('.account-list');\r\n\t\t\tthis.$list = this.$container.find('.account-list-body');\r\n\t\t\tthis.$pager = this.$container.find('.page-selection');\r\n\t\t\tthis.initPager();\r\n\t\t\tthis.bindEvent();\r\n\t\t\tthis.bindCardEvent();\r\n\t\t},\r\n\t\tbindCardEvent : function () {\r\n\t\t\tvar self = this;\r\n\t\t\tself.$list.on('click', '.btn.withdraw', function (e) {\r\n\t\t\t\tvar $btn = $(this);\r\n\t\t\t\tvar settleAccountID = $btn.parents('.bank-card').attr('data-id');\r\n\t\t\t\tif ($btn.hasClass('disabled')) return;\r\n\t\t\t\t// 提现操作\r\n\t\t\t\tvar modal = new WithdrawCashView({\r\n\t\t\t\t\ttriggerEl : $btn,\r\n\t\t\t\t\tsettleUnitID : settleAccountID,\r\n\t\t\t\t\tmodel : self.model.getAccountModelByID(settleAccountID),\r\n\t\t\t\t\tparentView : self\r\n\t\t\t\t});\r\n\t\t\t});\r\n\t\t\t// @NOTE: 新需求STORY #1074，任何权限的用户都不允许添加结算账户，所以屏蔽掉添加结算账户的片段\r\n\t\t\t// self.$list.on('click', '.create-account', function (e) {\r\n\t\t\t// \tvar $btn = $(this);\r\n\t\t\t// \t// TODO 创建账户\r\n\t\t\t// \tvar editAccount = new Hualala.Account.AccountEditView({\r\n\t\t\t// \t\ttriggerEl : $btn,\r\n\t\t\t// \t\tmode : 'add',\r\n\t\t\t// \t\tmodel : null,\r\n\t\t\t// \t\tparentView : self\r\n\t\t\t// \t});\r\n\t\t\t// });\r\n\t\t\tself.on({\r\n\t\t\t\t'updateSettleBalance' : function (mAccount) {\r\n\t\t\t\t\tvar settleUnitID = mAccount.get('settleUnitID'),\r\n\t\t\t\t\t\tsettleBalance = mAccount.get('settleBalance');\r\n\t\t\t\t\tself.$container.find('[data-id=' + settleUnitID + '] .cash > strong').html(settleBalance);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t},\r\n\t\tchkCtrlRight : function () {\r\n\t\t\tvar self = this;\r\n\t\t\tvar curPageRight = Hualala.Common.getCurPageUserRight();\r\n\t\t\tvar disabled = $XP(curPageRight, 'right.disabled', []),\r\n\t\t\t\tenabled = $XP(curPageRight, 'right.enabled', []);\r\n\t\t\t_.each(disabled, function (n) {\r\n\t\t\t\tself.$list.find('[data-btn-name=' + n + ']').attr('disabled', true).addClass('invisible');\r\n\t\t\t});\r\n\t\t\t_.each(enabled, function (n) {\r\n\t\t\t\tself.$list.find('[data-btn-name=' + n + ']').attr('disabled', false).removeClass('invisible');\r\n\t\t\t});\r\n\t\t},\r\n\t\t// 重载格式化渲染数据\r\n\t\tmapRenderData : function (data) {\r\n\t\t\tvar self = this;\r\n\t\t\tvar ret = _.map(data, function (account, i, l) {\r\n\t\t\t\tvar settleUnitID = $XP(account, 'settleUnitID'),\r\n\t\t\t\t\thasDefault = $XP(account, 'defaultAccount', 0) == 0 ? false : true,\r\n\t\t\t\t\tbankInfo = Hualala.Common.mapBankInfo($XP(account, 'bankCode')),\r\n\t\t\t\t\tbankAccountStr = Hualala.Common.codeMask($XP(account, 'bankAccount', ''), 0, -4),\r\n\t\t\t\t\tsettleBalance = parseFloat($XP(account, 'settleBalance', 0));\r\n\r\n\t\t\t\treturn {\r\n\t\t\t\t\tsettleUnitID : settleUnitID,\r\n\t\t\t\t\thasDefault : hasDefault,\r\n\t\t\t\t\tsettleUnitName : $XP(account, 'settleUnitName', ''),\r\n\t\t\t\t\tdisableWithdraw : settleBalance <= 0 ? 'disabled' : '',\r\n\t\t\t\t\tsettleBalance : settleBalance,\r\n\t\t\t\t\tbankIcon : $XP(bankInfo, 'icon_16', ''),\r\n\t\t\t\t\tbankComName : $XP(bankInfo, 'name', ''),\r\n\t\t\t\t\tbankAccountStr : $XP(bankAccountStr, 'val', '').replace(/([\\w|*]{4})/g, '$1 ').replace(/([*])/g, '<span>$1</span>'),\r\n\t\t\t\t\tshopCount : parseInt($XP(account, 'shopCount', 0)),\r\n\t\t\t\t\tpath : Hualala.PageRoute.createPath('accountDetail', [settleUnitID])\r\n\t\t\t\t};\r\n\t\t\t});\r\n\t\t\treturn {\r\n\t\t\t\taccountCard : {\r\n\t\t\t\t\tlist : ret\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\t// 重载渲染列表\r\n\t\trender : function () {\r\n\t\t\tvar self = this,\r\n\t\t\t\tmodel = self.model,\r\n\t\t\t\tpagerParams = model.getPagerParams(),\r\n\t\t\t\tpageNo = $XP(pagerParams, 'pageNo');\r\n\t\t\tvar accounts = model.getAccounts(pageNo);\r\n\t\t\tvar renderData = self.mapRenderData(accounts);\r\n\t\t\tvar listTpl = self.get('listTpl');\r\n\t\t\tvar html = listTpl(renderData);\r\n\t\t\t// self.$list.empty();\r\n\t\t\t// self.$list.html(html);\r\n\t\t\tself.emptyBar && self.emptyBar.destroy();\r\n\t\t\tself.$list.empty();\r\n\t\t\t// if (accounts.length == 0) {\r\n\t\t\t// \tself.emptyBar = new Hualala.UI.EmptyPlaceholder({\r\n\t\t\t// \t\tcontainer : self.$list\r\n\t\t\t// \t});\r\n\t\t\t// \tself.emptyBar.show();\r\n\t\t\t// } else {\r\n\t\t\t// \tself.$list.html(html);\r\n\t\t\t// \tself.chkCtrlRight();\r\n\t\t\t// }\r\n\t\t\tself.$list.html(html);\r\n\t\t\tself.chkCtrlRight();\r\n\t\t\tself.initPager({\r\n\t\t\t\ttotal : model.get('pageCount'),\r\n\t\t\t\tpage : model.get('pageNo'),\r\n\t\t\t\thref : 'javascript:void(0);'\r\n\t\t\t});\r\n\t\t},\r\n\t\trefresh : function () {\r\n\t\t\tvar self = this;\r\n\t\t\t// self.render();\r\n\t\t\tdocument.location.reload(false);\r\n\t\t}\r\n\t\t\r\n\t});\r\n\r\n\tHualala.Account.AccountListView = AccountListView;\r\n\r\n\tvar WithdrawCashView = Stapes.subclass({\r\n\t\t/**\r\n\t\t * 提现窗口\r\n\t\t * @param  {Object} cfg {triggerEl, settleUnitID, model}\r\n\t\t *              @param {jQueryObj} triggerEl 触发元素\r\n\t\t *              @param {String} settleUnitID 结算账户ID\r\n\t\t *              @param {Object} model 结算账户数据模型\r\n\t\t *              @param {Object} parentView 父级View层\r\n\t\t * @return {Obj}     提现实例\r\n\t\t */\r\n\t\tconstructor : function (cfg) {\r\n\t\t\tthis.$trigger = $XP(cfg, 'triggerEl');\r\n\t\t\tthis.settleUnitID = $XP(cfg, 'settleUnitID', null);\r\n\t\t\tthis.model = $XP(cfg, 'model', null);\r\n\t\t\tthis.parentView = $XP(cfg, 'parentView', null);\r\n\t\t\tthis.modal = null;\r\n\t\t\tif (!this.settleUnitID || !this.model) {\r\n\t\t\t\tthrow(\"Withdraw Cash View init failed!\");\r\n\t\t\t}\r\n\t\t\tthis.loadTemplates();\r\n\t\t\tthis.initModal();\r\n\t\t\tthis.renderForm();\r\n\t\t\tthis.bindEvent();\r\n\t\t\tthis.emit('show');\t\t\r\n\t\t}\r\n\t});\r\n\r\n\tWithdrawCashView.proto({\r\n\t\tloadTemplates : function () {\r\n\t\t\tvar layoutTpl = Handlebars.compile(Hualala.TplLib.get('tpl_withdraw_form')),\r\n\t\t\t\tbtnTpl = Handlebars.compile(Hualala.TplLib.get('tpl_shop_modal_btns'));\r\n\t\t\tthis.set({\r\n\t\t\t\tlayoutTpl : layoutTpl,\r\n\t\t\t\tbtnTpl : btnTpl\r\n\t\t\t});\r\n\t\t},\r\n\t\tinitModal : function () {\r\n\t\t\tvar self = this;\r\n\t\t\tself.modal = new Hualala.UI.ModalDialog({\r\n\t\t\t\tid : 'account_withdraw',\r\n\t\t\t\tclz : 'service-modal',\r\n\t\t\t\ttitle : '结算账户提现',\r\n\t\t\t\tafterRemove : function () {\r\n\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t},\r\n\t\tmapPoundageAmountStr : function (n) {\r\n\t\t\treturn (IX.isEmpty(n) || n == 0) ? '无手续费' : '<strong>' + n + '</strong>元';\r\n\t\t},\r\n\t\tmapPoundageMinAmountStr : function (n) {\r\n\t\t\treturn (IX.isEmpty(n) || n == 0) ? '不限' : ('<strong>' + n + '</strong>元');\r\n\t\t},\r\n\t\tmapFormElsData : function () {\r\n\t\t\tvar self = this,\r\n\t\t\t\taccountInfoKeys = [\r\n\t\t\t\t\t{key : 'settleUnitName', label : '结算账户名称'},\r\n\t\t\t\t\t{key : 'receiverName', label : '开户名'},\r\n\t\t\t\t\t{key : 'bankName', label : '开户行'},\r\n\t\t\t\t\t{key : 'bankAccount', label : '账号'},\r\n\t\t\t\t\t{key : 'settleBalance', label : '账户余额'},\r\n\t\t\t\t\t{key : 'poundageAmount', label : '提现手续费'},\r\n\t\t\t\t\t{key : 'poundageMinAmount', label : '免费提现最低金额'}\r\n\t\t\t\t];\r\n\t\t\tvar poundageAmount = self.model.get('poundageAmount'),\r\n\t\t\t\tpoundageMinAmount = self.model.get('poundageMinAmount'),\r\n\t\t\t\twarningTextTpl = '<p class=\"alert alert-warning \">'\r\n\t\t\t\t\t+ '由于提现操作需要向银行缴纳交易手续费<strong>{poundageAmount}</strong>元人民币，<br/>' \r\n\t\t\t\t\t+ '当提现金额高于<strong>{poundageMinAmount}</strong>(包含<strong>{poundageMinAmount}</strong>)元人民币，手续费由<strong>北京多来点信息技术有限公司</strong>支付；<br/>'\r\n\t\t\t\t\t+ '当提现金额低于<strong>{poundageMinAmount}</strong>元人民币，手续费由<strong>{settleUnitName}</strong>支付。<br/>'\r\n\t\t\t\t\t+ '</p>';\r\n\t\t\tvar warningText = '';\r\n\t\t\tif (!IX.isEmpty(poundageAmount) && poundageAmount != 0) {\r\n\t\t\t\twarningText = warningTextTpl.replaceAll('{poundageAmount}', poundageAmount)\r\n\t\t\t\t\t.replaceAll('{poundageMinAmount}', poundageMinAmount)\r\n\t\t\t\t\t.replaceAll('{settleUnitName}', self.model.get('settleUnitName'));\r\n\t\t\t}\r\n\t\t\tvar accountInfo = _.map(accountInfoKeys, function (el) {\r\n\t\t\t\tvar k = $XP(el, 'key');\r\n\t\t\t\tvar valStr = '';\r\n\t\t\t\tswitch(k) {\r\n\t\t\t\t\tcase 'poundageAmount':\r\n\t\t\t\t\t\tvalStr = self.mapPoundageAmountStr(self.model.get(k));\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 'poundageMinAmount':\r\n\t\t\t\t\t\tvalStr = self.mapPoundageMinAmountStr(self.model.get(k));\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 'settleBalance':\r\n\t\t\t\t\t\tvalStr = ('<strong>' + self.model.get(k) + '</strong>元');\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tdefault :\r\n\t\t\t\t\t\tvalStr = self.model.get(k);\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t\treturn {\r\n\t\t\t\t\tlabel : $XP(el, 'label', ''),\r\n\t\t\t\t\tvalue : valStr\r\n\t\t\t\t};\r\n\t\t\t});\r\n\r\n\t\t\treturn {\r\n\t\t\t\taccountInfo : accountInfo,\r\n\t\t\t\twarningText : warningText,\r\n\t\t\t\tformClz : 'account-withdraw-form form-feedback-out',\r\n\t\t\t\tlabelClz : 'col-sm-4 control-label',\r\n\t\t\t\tclz : 'col-sm-7',\r\n\t\t\t\tid : 'transAmount',\r\n\t\t\t\tlabel : '请输入提现金额',\r\n\t\t\t\tname : 'transAmount',\r\n\t\t\t\tvalue : self.model.get('settleBalance')\r\n\t\t\t};\r\n\t\t},\r\n\t\trenderForm : function () {\r\n\t\t\tvar self = this,\r\n\t\t\t\trenderData = self.mapFormElsData(),\r\n\t\t\t\ttpl = self.get('layoutTpl'),\r\n\t\t\t\tbtnTpl = self.get('btnTpl'),\r\n\t\t\t\thtm = tpl(renderData);\r\n\t\t\tself.modal._.body.html(htm);\r\n\t\t\tself.modal._.footer.html(btnTpl({\r\n\t\t\t\tbtns : [\r\n\t\t\t\t\t{clz : 'btn-default', name : 'cancel', label : '取消'},\r\n\t\t\t\t\t{clz : 'btn-warning', name : 'submit', label : '立即提现'}\r\n\t\t\t\t]\r\n\t\t\t}));\r\n\t\t},\r\n\t\tbindEvent : function () {\r\n\t\t\tvar self = this;\r\n\t\t\tthis.on({\r\n\t\t\t\tshow : function () {\r\n\t\t\t\t\tthis.modal.show();\r\n\t\t\t\t},\r\n\t\t\t\thide : function () {\r\n\t\t\t\t\tthis.modal.hide();\r\n\t\t\t\t\tthis.parentView.emit('updateSettleBalance', self.model);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\tself.modal._.dialog.find('.btn').on('click', function (e) {\r\n\t\t\t\tvar $btn = $(this),\r\n\t\t\t\t\tact = $btn.attr('name');\r\n\t\t\t\tif (act == 'cancel') {\r\n\t\t\t\t\tself.emit('hide');\r\n\t\t\t\t} else {\r\n\t\t\t\t\tvar bv = self.modal._.body.find('form').data('bootstrapValidator');\r\n\t\t\t\t\t$btn.button('提交中...');\r\n\t\t\t\t\tbv.validate();\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\tself.modal._.body.find('form').bootstrapValidator({\r\n\t\t\t\ttrigger : 'blur',\r\n\t\t\t\tfields : {\r\n\t\t\t\t\ttransAmount : {\r\n\t\t\t\t\t\tvalidators : {\r\n\t\t\t\t\t\t\tnotEmpty : {\r\n\t\t\t\t\t\t\t\tmessage : \"请输入提现金额\"\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\tnumeric : {\r\n\t\t\t\t\t\t\t\tmessage: \"提现金额必须为数字\"\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\tgreaterThan : {\r\n\t\t\t\t\t\t\t\tinclusive : false,\r\n\t\t\t\t\t\t\t\tvalue : self.model.get('poundageAmount') || 0,\r\n\t\t\t\t\t\t\t\tmessage : \"提现金额必须大于\" + self.model.get('poundageAmount') || 0\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\tlessThan : {\r\n\t\t\t\t\t\t\t\tinclusive : true,\r\n\t\t\t\t\t\t\t\tvalue : self.model.get('settleBalance'),\r\n\t\t\t\t\t\t\t\tmessage : \"提现金额不能超过账户余额\"\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\taccuracy : {\r\n\t\t\t\t\t\t\t\taccuracy : 2,\r\n\t\t\t\t\t\t\t\tmessage : \"输入现金只能精确到小数点后2位\"\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}).on('error.field.bv', function (e, data) {\r\n\t\t\t\tvar $form = $(e.target),\r\n\t\t\t\t\tbv = $form.data('bootstrapValidator');\r\n\t\t\t}).on('success.form.bv', function (e, data) {\r\n\t\t\t\te.preventDefault();\r\n\t\t\t\tvar $form = $(e.target),\r\n\t\t\t\t\tbv = $form.data('bootstrapValidator');\r\n\t\t\t\tvar formParams = self.serializeForm();\r\n\t\t\t\tself.model.emit('withdrawCash', {\r\n\t\t\t\t\tparams : formParams,\r\n\t\t\t\t\tfailFn : function () {\r\n\t\t\t\t\t\tself.modal._.footer.find('.btn[name=submit]').button('reset');\r\n\t\t\t\t\t},\r\n\t\t\t\t\tsuccessFn : function () {\r\n\t\t\t\t\t\tself.modal._.footer.find('.btn[name=submit]').button('reset');\r\n\t\t\t\t\t\tself.emit('hide');\r\n\t\t\t\t\t}\r\n\t\t\t\t})\r\n\t\t\t});\r\n\t\t},\r\n\t\tserializeForm : function () {\r\n\t\t\tvar self = this,\r\n\t\t\t\t$body = self.modal._.body;\r\n\t\t\treturn {\r\n\t\t\t\ttransAmount : $body.find('#transAmount').val()\r\n\t\t\t};\r\n\t\t}\r\n\r\n\t});\r\n\r\n\tHualala.Account.WithdrawCashView = WithdrawCashView;\r\n\r\n\tvar QueryTransFormElsCfg = {\r\n\t\ttransCreateTime : {\r\n\t\t\ttype : 'section',\r\n\t\t\tlabel : '日期',\r\n\t\t\tmin : {\r\n\t\t\t\ttype : 'datetimepicker',\r\n\t\t\t\tsurfix : '<span class=\"glyphicon glyphicon-calendar\"></span>',\r\n\t\t\t\tdefaultVal : '',\r\n\t\t\t\tvalidCfg : {\r\n\t\t\t\t\tgroup : '.min-input',\r\n\t\t\t\t\tvalidators : {}\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tmax : {\r\n\t\t\t\ttype : 'datetimepicker',\r\n\t\t\t\tsurfix : '<span class=\"glyphicon glyphicon-calendar\"></span>',\r\n\t\t\t\tdefaultVal : '',\r\n\t\t\t\tvalidCfg : {\r\n\t\t\t\t\tgroup : '.max-input',\r\n\t\t\t\t\tvalidators : {}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\ttransAmount : {\r\n\t\t\ttype : 'section',\r\n\t\t\tlabel : '金额',\r\n\t\t\tmin : {\r\n\t\t\t\ttype : 'text',\r\n\t\t\t\tprefix : '￥',\r\n\t\t\t\tsurfix : '元',\r\n\t\t\t\tdefaultVal : '',\r\n\t\t\t\tvalidCfg : {\r\n\t\t\t\t\tvalidators : {\r\n\t\t\t\t\t\tnumeric : {\r\n\t\t\t\t\t\t\tmessage: \"金额必须为数字\"\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\tgreaterThan : {\r\n\t\t\t\t\t\t\tinclusive : true,\r\n\t\t\t\t\t\t\tvalue : 0,\r\n\t\t\t\t\t\t\tmessage : \"金额必须大于或等于0\"\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tmax : {\r\n\t\t\t\ttype : 'text',\r\n\t\t\t\tprefix : '￥',\r\n\t\t\t\tsurfix : '元',\r\n\t\t\t\tdefaultVal : '',\r\n\t\t\t\tvalidCfg : {\r\n\t\t\t\t\tvalidators : {\r\n\t\t\t\t\t\tnumeric : {\r\n\t\t\t\t\t\t\tmessage: \"金额必须为数字\"\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\tgreaterThan : {\r\n\t\t\t\t\t\t\tinclusive : true,\r\n\t\t\t\t\t\t\tvalue : 0,\r\n\t\t\t\t\t\t\tmessage : \"金额必须大于或等于0\"\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\ttransStatus : {\r\n\t\t\ttype : 'combo',\r\n\t\t\tlabel : '状态',\r\n\t\t\tdefaultVal : '',\r\n\t\t\toptions : Hualala.TypeDef.FSMTransStatus,\r\n\t\t\tvalidCfg : {\r\n\t\t\t\tvalidators : {\r\n\t\t\t\t\t\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\ttransType : {\r\n\t\t\ttype : 'combo',\r\n\t\t\tlabel : '类型',\r\n\t\t\tdefaultVal : '',\r\n\t\t\toptions : Hualala.TypeDef.FSMTransType,\r\n\t\t\tvalidCfg : {\r\n\t\t\t\tvalidators : {\r\n\t\t\t\t\t\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\tbutton : {\r\n\t\t\ttype : 'button',\r\n\t\t\tclz : 'btn btn-block btn-warning',\r\n\t\t\tlabel : '查询'\r\n\t\t}\r\n\t};\r\n\tvar QueryTransFormElsHT = new IX.IListManager();\r\n\t_.each(QueryTransFormElsCfg, function (el, k) {\r\n\t\tvar type = $XP(el, 'type');\r\n\t\tvar labelClz = 'col-xs-2 col-sm-2 col-md-2 control-label';\r\n\t\tif (type == 'section') {\r\n\t\t\tvar id = minID = k + '_min_' + IX.id(), maxID = k + '_max_' + IX.id(),\r\n\t\t\t\tminName = k == 'transCreateTime' ? 'transCreateBeginTime' : 'minTransAmount',\r\n\t\t\t\tmaxName = k == 'transCreateTime' ? 'transCreateEndTime' : 'maxTransAmount',\r\n\t\t\t\tmin = IX.inherit($XP(el, 'min', {}), {\r\n\t\t\t\t\tid : minID, name : minName, clz : 'col-xs-5 col-sm-5 col-md-5',\r\n\t\t\t\t}), max = IX.inherit($XP(el, 'max', {}), {\r\n\t\t\t\t\tid : maxID, name : maxName, clz : 'col-xs-5 col-sm-5 col-md-5',\r\n\t\t\t\t});\r\n\t\t\tQueryTransFormElsHT.register(k, IX.inherit(el, {\r\n\t\t\t\tid : id,\r\n\t\t\t\tlabelClz : labelClz,\r\n\t\t\t\tmin : min,\r\n\t\t\t\tmax : max\r\n\t\t\t}));\r\n\t\t} else {\r\n\t\t\tQueryTransFormElsHT.register(k, IX.inherit(el, {\r\n\t\t\t\tid : k + '_' + IX.id(),\r\n\t\t\t\tname : k,\r\n\t\t\t\tlabelClz : labelClz,\r\n\t\t\t}, $XP(el, 'type') !== 'button' ? {clz : 'col-xs-5 col-sm-8 col-md-5'} : null));\r\n\t\t}\r\n\t});\r\n\tvar TransResultCols = [\r\n\t\t{clz : '', label : '时间'},\r\n\t\t{clz : '', label : '流水号'},\r\n\t\t{clz : '', label : '交易状态'},\r\n\t\t{clz : '', label : '交易类型'},\r\n\t\t{clz : '', label : '交易金额'},\r\n\t\t// {clz : '', label : '佣金'},\r\n\t\t// {clz : '', label : '手续费'},\r\n\t\t{clz : '', label : '交易费用'},\r\n\t\t{clz : '', label : '余额变动'},\r\n\t\t{clz : '', label : '交易后余额'},\r\n\t\t{clz : '', label : '操作'}\r\n\t];\r\n\r\n\tvar AccountTransListView = CardListView.subclass({\r\n\t\tconstructor : function () {\r\n\t\t\t// View层容器\r\n\t\t\tthis.$container = null;\r\n\t\t\t// 查询表单\r\n\t\t\tthis.$queryForm = null;\r\n\t\t\t// 结果容器\r\n\t\t\tthis.$resultBox = null;\r\n\t\t\t// 分页容器\r\n\t\t\tthis.$pager = null;\r\n\t\t\tthis.loadTemplates();\r\n\t\t}\r\n\t});\r\n\tAccountTransListView.proto({\r\n\t\tloadTemplates : function () {\r\n\t\t\tvar layoutTpl = Handlebars.compile(Hualala.TplLib.get('tpl_account_detail')),\r\n\t\t\t\ttableTpl = Handlebars.compile(Hualala.TplLib.get('tpl_transaQuery_result'));\r\n\t\t\tHandlebars.registerPartial(\"transaQueryForm\", Hualala.TplLib.get('tpl_transaQuery_form'));\r\n\t\t\tHandlebars.registerPartial(\"transaQueryResult\", Hualala.TplLib.get('tpl_transaQuery_result'));\r\n\t\t\tHandlebars.registerHelper('checkFormElementType', function (conditional, options) {\r\n\t\t\t\treturn (conditional == options.hash.type) ? options.fn(this) : options.inverse(this);\r\n\t\t\t});\r\n\t\t\tHandlebars.registerHelper('chkColType', function (conditional, options) {\r\n\t\t\t\treturn (conditional == options.hash.type) ? options.fn(this) : options.inverse(this);\r\n\t\t\t});\r\n\t\t\tthis.set({\r\n\t\t\t\tlayoutTpl : layoutTpl,\r\n\t\t\t\ttableTpl : tableTpl\r\n\t\t\t});\r\n\t\t},\r\n\t\tinitLayout : function () {\r\n\t\t\tvar layoutTpl = this.get('layoutTpl');\r\n\t\t\tvar result = [],\r\n\t\t\t\ttblClz = 'table-bordered table-striped table-hover ix-data-report',\r\n\t\t\t\ttblHeaders = TransResultCols,\r\n\t\t\t\tquery = {cols : [\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tcolClz : 'col-sm-6',\r\n\t\t\t\t\t\titems : QueryTransFormElsHT.getByKeys(['transCreateTime', 'transAmount'])\r\n\t\t\t\t\t},\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tcolClz : 'col-sm-4',\r\n\t\t\t\t\t\titems : QueryTransFormElsHT.getByKeys(['transType', 'transStatus'])\r\n\t\t\t\t\t},\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tcolClz : 'col-sm-2',\r\n\t\t\t\t\t\titems : QueryTransFormElsHT.getByKeys(['button'])\r\n\t\t\t\t\t}\r\n\t\t\t\t]};\r\n\t\t\tvar htm = layoutTpl({\r\n\t\t\t\tquery : query,\r\n\t\t\t\tresult : {\r\n\t\t\t\t\tclz : tblClz,\r\n\t\t\t\t\tthead : tblHeaders,\r\n\t\t\t\t\trows : result\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\tthis.$container.html(htm);\r\n\t\t\tthis.$queryForm = this.$container.find('.query-form');\r\n\t\t\tthis.$resultBox = this.$container.find('.query-result');\r\n\t\t\tthis.$pager = this.$container.find('.page-selection');\r\n\t\t\tthis.render();\r\n\t\t\t// this.initPager();\r\n\t\t\tthis.initQueryEls();\r\n\t\t\tthis.bindEvent();\r\n\t\t\tthis.bindQueryEvent();\r\n\t\t},\r\n\t\tinitQueryEls : function () {\r\n\t\t\tvar self = this;\r\n\t\t\tself.$queryForm.find('[data-type=datetimepicker]').datetimepicker({\r\n\t\t\t\tformat : 'yyyy/mm/dd',\r\n\t\t\t\tstartDate : '2010/01/01',\r\n\t\t\t\tautoclose : true,\r\n\t\t\t\tminView : 'month',\r\n\t\t\t\ttodayBtn : true,\r\n\t\t\t\ttodayHighlight : true,\r\n\t\t\t\tlanguage : 'zh-CN'\r\n\t\t\t});\r\n\t\t\tself.$queryForm.on('click', '.input-group-addon', function (e) {\r\n\t\t\t\tvar $this = $(this),\r\n\t\t\t\t\t$picker = $this.prev(':text[data-type=datetimepicker]');\r\n\t\t\t\tif ($picker.length > 0) {\r\n\t\t\t\t\t$picker.datetimepicker('show');\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t},\r\n\t\tbindEvent : function () {\r\n\t\t\tvar self = this;\r\n\t\t\tself.$resultBox.tooltip({\r\n\t\t\t\tselector : '[title]'\r\n\t\t\t});\r\n\t\t\tself.$resultBox.on('click', '.btn[data-href]', function (e) {\r\n\t\t\t\tvar $btn = $(this),\r\n\t\t\t\t\tpath = $btn.attr('data-href');\r\n\t\t\t\tif (!IX.isEmpty(path)) {\r\n\t\t\t\t\tdocument.location.href = path;\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\tself.$pager.on('page', function (e, pageNo) {\r\n\t\t\t\tvar params = self.model.getPagerParams();\r\n\t\t\t\tparams['pageNo'] = pageNo;\r\n\t\t\t\tself.model.emit('load', IX.inherit(params, {\r\n\t\t\t\t\tpageNo : $XP(params, 'pageNo', 1),\r\n\t\t\t\t\tpageSize : $XP(params, 'pageSize', 15)\r\n\t\t\t\t}));\r\n\t\t\t});\r\n\t\t},\r\n\t\tbindQueryEvent : function () {\r\n\t\t\tvar self = this;\r\n\t\t\tself.$resultBox.on('click', 'a[data-orderkey]', function (e) {\r\n\t\t\t\tvar $btn = $(this),\r\n\t\t\t\t\torderKey = $btn.attr('data-orderkey') || '',\r\n\t\t\t\t\ttransType = $btn.attr('data-type') || '',\r\n\t\t\t\t\ttransID = $btn.attr('data-id') || '',\r\n\t\t\t\t\torderID = $btn.attr('data-orderid') || '';\r\n\t\t\t\t// TODO show transaction detail modal\r\n\t\t\t\tvar detail = new Hualala.Account.AccountTransDetailModal({\r\n\t\t\t\t\ttriggerEl : $btn,\r\n\t\t\t\t\torderKey : orderKey,\r\n\t\t\t\t\torderID : orderID,\r\n\t\t\t\t\ttransType : transType,\r\n\t\t\t\t\ttransID : transID\r\n\t\t\t\t});\r\n\t\t\t});\r\n\t\t\tself.$queryForm.on('click', '.btn', function (e) {\r\n\t\t\t\t// TODO Update modal params and render query result\r\n\t\t\t\tvar params = self.getQueryFormParams();\r\n\t\t\t\tself.model.emit('load', params);\r\n\t\t\t});\r\n\t\t},\r\n\t\tgetQueryFormParams : function () {\r\n\t\t\tvar self = this;\r\n\t\t\t// var formKeys = ['transCreateBeginTime', 'transCreateEndTime', 'minTransAmount', 'maxTransAmount', 'transType', 'transStatus'];\r\n\t\t\tvar params = self.$queryForm.find('>form').serializeArray();\r\n\t\t\tvar ret = {};\r\n\t\t\t_.each(params, function (el, i) {\r\n\t\t\t\tvar k = $XP(el, 'name'), v = $XP(el, 'value', '');\r\n\t\t\t\tswitch(k) {\r\n\t\t\t\t\tcase 'transCreateBeginTime':\r\n\t\t\t\t\tcase 'transCreateEndTime':\r\n\t\t\t\t\t\tif (IX.isEmpty(v)) {\r\n\t\t\t\t\t\t\tv = '';\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tv = IX.Date.getDateByFormat(v, 'yyyyMMddHHmmss');\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tdefault :\r\n\t\t\t\t\t\tv = IX.isEmpty(v) ? '' : v;\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t\tret[k] = v;\r\n\t\t\t});\r\n\t\t\tIX.Debug.info(\"DEBUG: Account TransList View Query Form Params : \");\r\n\t\t\tIX.Debug.info(ret);\r\n\t\t\treturn ret;\r\n\t\t},\r\n\t\tmapTimeData : function (s) {\r\n\t\t\tvar r = {value : '', text : '', clz : 'date'};\r\n\t\t\tvar s1 = '';\r\n\t\t\tif (IX.isString(s) && s.length > 0) {\r\n\t\t\t\ts1 = s.replace(/([\\d]{4})([\\d]{2})([\\d]{2})([\\d]{2})([\\d]{2})([\\d]{2})/g, '$1/$2/$3 $4:$5:$6');\r\n\t\t\t\ts1 = IX.Date.getDateByFormat(s1, 'yyyy/MM/dd HH:mm');\r\n\t\t\t\tr = IX.inherit({value : s, text : s1});\r\n\t\t\t}\r\n\t\t\treturn r;\r\n\t\t},\r\n\t\tmapTransStatus : function (s) {\r\n\t\t\ts = (s + \"\") || '';\r\n\t\t\tvar status = Hualala.TypeDef.FSMTransStatus;\r\n\t\t\tvar m = _.filter(status, function (el) {\r\n\t\t\t\treturn $XP(el, 'value', '') == s;\r\n\t\t\t});\r\n\t\t\tif (s.length == 0 || m.length == 0) {\r\n\t\t\t\treturn {text : '', value : ''};\r\n\t\t\t}\r\n\t\t\treturn {text : $XP(m[0], 'label', ''), value : $XP(m[0], 'value', ''), clz : 'status'};\r\n\t\t},\r\n\t\tmapTransType : function (s) {\r\n\t\t\ts = s || '';\r\n\t\t\tvar types = Hualala.TypeDef.FSMTransType;\r\n\t\t\tvar m = _.filter(types, function (el) {\r\n\t\t\t\treturn $XP(el, 'value', '') == s;\r\n\t\t\t});\r\n\t\t\tif (s.length == 0 || m.length == 0) {\r\n\t\t\t\treturn {text : '', value : ''};\r\n\t\t\t}\r\n\t\t\treturn {text : $XP(m[0], 'label', ''), value : $XP(m[0], 'value', ''), clz : 'text'};\r\n\t\t},\r\n\t\tmapCashData : function (s) {\r\n\t\t\treturn {text : Hualala.Common.Math.prettyNumeric(Hualala.Common.Math.standardPrice(s)), value : s, clz : 'number'};\r\n\t\t},\r\n\t\tmapTransChanged : function (r) {\r\n\t\t\tvar transAmount = $XP(r, 'transAmount', 0),\r\n\t\t\t\ttransSalesCommission = $XP(r, 'transSalesCommission', 0),\r\n\t\t\t\ttransPoundage = $XP(r, 'transPoundage', 0),\r\n\t\t\t\ttransChanged = Hualala.Common.Math.sub(transAmount, transSalesCommission, transPoundage);\r\n\t\t\treturn {value : transChanged, text : Hualala.Common.Math.prettyNumeric(transChanged), clz : 'number'};\r\n\t\t},\r\n\t\tmapColsRenderData : function (row) {\r\n\t\t\tvar self = this;\r\n\t\t\tvar colKeys = 'transCreateTime,SUATransItemID,transStatus,transType,transAmount,transactionCost,transChanged,transAfterBalance,rowControl';\r\n\t\t\tvar col = {clz : '', type : 'text'};\r\n\r\n\t\t\tvar cols = _.map(colKeys.split(','), function (k, i) {\r\n\t\t\t\tvar r = null;\r\n\t\t\t\tswitch(k) {\r\n\t\t\t\t\tcase 'transCreateTime':\r\n\t\t\t\t\t\tr = self.mapTimeData($XP(row, k, ''));\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 'SUATransItemID':\r\n\t\t\t\t\t\tr = {value : $XP(row, k, ''), text : $XP(row, k, ''), clz : 'number'};\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 'transStatus':\r\n\t\t\t\t\t\tr = self.mapTransStatus($XP(row, k, ''));\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 'transType':\r\n\t\t\t\t\t\tr = self.mapTransType($XP(row, k, ''));\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 'transAmount':\r\n\t\t\t\t\t// case 'transSalesCommission':\r\n\t\t\t\t\t// case 'transPoundage':\r\n\t\t\t\t\tcase 'transAfterBalance':\r\n\t\t\t\t\t\tr = self.mapCashData($XP(row, k, ''));\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 'transactionCost':\r\n\t\t\t\t\t\tvar transSalesCommission = $XP(row, 'transSalesCommission', 0), transPoundage = $XP(row, 'transPoundage', 0);\r\n\t\t\t\t\t\tvar transactionCost = Hualala.Common.Math.add(transSalesCommission, transPoundage);\r\n\t\t\t\t\t\tr = self.mapCashData(transactionCost);\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 'transChanged':\r\n\t\t\t\t\t\tr = self.mapTransChanged(row);\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 'rowControl':\r\n\t\t\t\t\t\tvar transType = $XP(row, 'transType', ''),\r\n\t\t\t\t\t\t\ttransStatus = $XP(row, 'transStatus', '');\r\n\t\t\t\t\t\tvar hideBtnTransType = \"104,199,202,203,204,205,206,299\";\r\n\t\t\t\t\t\tr = {\r\n\t\t\t\t\t\t\ttype : 'button',\r\n\t\t\t\t\t\t\tbtnClz : (hideBtnTransType.indexOf(transType) >= 0 || (transType == \"203\" && transStatus < 1)) ? 'hidden' : '',\r\n\t\t\t\t\t\t\tlabel : '查看',\r\n\t\t\t\t\t\t\tSUATransItemID : $XP(row, 'SUATransItemID', ''),\r\n\t\t\t\t\t\t\ttransType : transType,\r\n\t\t\t\t\t\t\torderKey : $XP(row, 'orderKey', ''),\r\n\t\t\t\t\t\t\torderID : $XP(row, 'orderID', '')\r\n\t\t\t\t\t\t};\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t\treturn IX.inherit(col, r);\r\n\t\t\t});\r\n\t\t\treturn cols;\r\n\t\t},\r\n\t\tmapRenderData : function (data) {\r\n\t\t\tvar self = this;\r\n\t\t\tvar tblClz = 'table-bordered table-striped table-hover ix-data-report',\r\n\t\t\t\ttblHeaders = TransResultCols;\r\n\t\t\tvar rows = _.map(data, function (row) {\r\n\t\t\t\treturn {\r\n\t\t\t\t\tclz : '',\r\n\t\t\t\t\tcols : self.mapColsRenderData(row)\r\n\t\t\t\t};\r\n\t\t\t});\r\n\t\t\treturn {\r\n\t\t\t\tclz : tblClz,\r\n\t\t\t\tisEmpty : data.length == 0 ? true : false,\r\n\t\t\t\tcolCount : tblHeaders.length,\r\n\t\t\t\tthead : tblHeaders,\r\n\t\t\t\trows : rows\r\n\t\t\t};\r\n\t\t},\r\n\t\trender : function () {\r\n\t\t\tvar self = this,\r\n\t\t\t\tmodel = self.model,\r\n\t\t\t\tpagerParams = model.getPagerParams(),\r\n\t\t\t\tpageNo = $XP(pagerParams, 'pageNo');\r\n\t\t\tvar results = model.getDataByPageNo(pageNo);\r\n\t\t\tvar renderData = self.mapRenderData(results);\r\n\t\t\tvar tableTpl = self.get('tableTpl');\r\n\t\t\tvar html = tableTpl(renderData);\r\n\t\t\tself.$resultBox.empty();\r\n\t\t\tself.$resultBox.html(html);\r\n\t\t\tself.initPager({\r\n\t\t\t\ttotal : model.get('pageCount'),\r\n\t\t\t\tpage : model.get('pageNo'),\r\n\t\t\t\thref : 'javascript:void(0);'\r\n\t\t\t});\r\n\t\t}\r\n\t});\r\n\tHualala.Account.AccountTransListView = AccountTransListView;\r\n\r\n\tvar AccountQueryShopView = Hualala.Shop.QueryView.subclass({\r\n\t\tconstructor : Hualala.Shop.QueryView.prototype.constructor\r\n\t});\r\n\tHualala.Account.AccountQueryShopView = AccountQueryShopView;\r\n\r\n\tvar AccountQueryShopResultView = CardListView.subclass({\r\n\t\tconstructor : CardListView.prototype.constructor\r\n\t});\r\n\tAccountQueryShopResultView.proto({\r\n\t\tloadTemplates : function () {\r\n\t\t\tvar layoutTpl = Handlebars.compile(Hualala.TplLib.get('tpl_shop_list_layout')),\r\n\t\t\t\tlistTpl = Handlebars.compile(Hualala.TplLib.get('tpl_shop_list')),\r\n\t\t\t\titemTpl = Handlebars.compile(Hualala.TplLib.get('tpl_shop_table'));\r\n\t\t\t// 注册shopCard子模板\r\n\t\t\tHandlebars.registerPartial(\"shopTable\", Hualala.TplLib.get('tpl_shop_table'));\r\n\r\n\t\t\tthis.set({\r\n\t\t\t\tlayoutTpl : layoutTpl,\r\n\t\t\t\tlistTpl : listTpl,\r\n\t\t\t\titemTpl : itemTpl\r\n\t\t\t});\r\n\t\t},\r\n\t\t// 格式化渲染数据\r\n\t\tmapRenderData : function (data) {\r\n\t\t\tvar self = this;\r\n\t\t\t\r\n\t\t\tvar ret = _.map(data, function (shop, i, l) {\r\n\t\t\t\treturn {\r\n\t\t\t\t\tclz : '',\r\n\t\t\t\t\tid : $XP(shop, 'shopID', ''),\r\n\t\t\t\t\tname : $XP(shop, 'shopName', ''),\r\n\t\t\t\t\tcity : $XP(shop, 'cityName', '')\r\n\t\t\t\t};\r\n\t\t\t});\r\n\t\t\treturn {\r\n\t\t\t\tshopTable : {\r\n\t\t\t\t\tisEmpty : !data || data.length == 0 ? true : false,\r\n\t\t\t\t\tcolCount : 3,\r\n\t\t\t\t\trows : ret\r\n\t\t\t\t}\r\n\t\t\t};\r\n\t\t},\r\n\t\trender : function () {\r\n\t\t\tvar self = this,\r\n\t\t\t\tmodel = self.model,\r\n\t\t\t\tpagerParams = model.getPagerParams(),\r\n\t\t\t\tpageNo = $XP(pagerParams, 'pageNo');\r\n\t\t\tvar shops = model.getShops(pageNo);\r\n\t\t\tvar renderData = self.mapRenderData(shops);\r\n\t\t\tvar listTpl = self.get('listTpl');\r\n\t\t\tvar html = listTpl(renderData);\r\n\t\t\tself.$list.empty();\r\n\t\t\tself.$list.html(html);\r\n\t\t\tself.initPager({\r\n\t\t\t\ttotal : model.get('pageCount'),\r\n\t\t\t\tpage : model.get('pageNo'),\r\n\t\t\t\thref : 'javascript:void(0);'\r\n\t\t\t});\r\n\t\t}\r\n\t});\r\n\tHualala.Account.AccountQueryShopResultView = AccountQueryShopResultView;\r\n})(jQuery, window);;(function ($, window) {\r\n\tIX.ns(\"Hualala.Account\");\r\n\tvar popoverMsg = Hualala.UI.PopoverMsgTip;\r\n\tvar toptip = Hualala.UI.TopTip;\r\n\tvar AccountListModel = Hualala.Account.AccountListModel;\r\n\tvar AccountListView = Hualala.Account.AccountListView;\r\n\tvar ShopListController = Hualala.Shop.ShopListController;\r\n\r\n\tvar QueryModel = Hualala.Shop.QueryModel;\r\n\tvar QueryView = Hualala.Shop.QueryView;\r\n\tvar QueryController = Hualala.Shop.QueryController;\r\n\r\n\tvar AccountListController = ShopListController.subclass({\r\n\t\t/**\r\n\t\t * 结算账户列表控制器\r\n\t\t * @param  {Object} cfg 配置参数\r\n\t\t *          @param {JQueryObj} container 容器\r\n\t\t *          @param {Object} view  结果的View模块实例\r\n\t\t *          @param {Object} model 结果的数据模块实例\r\n\t\t * @return {Object}     \r\n\t\t */\r\n\t\tconstructor : ShopListController.prototype.constructor\r\n\t});\r\n\r\n\r\n\tHualala.Account.AccountListController = AccountListController;\r\n\r\n\tvar AccountQueryShopController = QueryController.subclass({\r\n\t\tconstructor : function (cfg) {\r\n\t\t\tthis.set({\r\n\t\t\t\tsessionData : Hualala.getSessionData()\r\n\t\t\t});\r\n\t\t\tthis.settleUnitID = $XP(cfg, 'settleUnitID', '');\r\n\t\t\tthis.settleName = $XP(cfg, 'settleName', '');\r\n\t\t\tthis.shopCount = $XP(cfg, 'shopCount', '');\r\n\t\t\tthis.container = $XP(cfg, 'container', null);\r\n\t\t\tthis.needShopCreate = false;\r\n\t\t\tthis.model = new Hualala.Account.AccountQueryShopModel();\r\n\t\t\tthis.view = new Hualala.Account.AccountQueryShopView();\r\n\t\t\tthis.resultContainer = $XP(cfg, 'resultContainer', null);\r\n\t\t\tthis.resultController = new Hualala.Account.AccountQueryShopResultController({\r\n\t\t\t\tcontainer : this.resultContainer,\r\n\t\t\t\tmodel : new Hualala.Account.AccountQueryShopResultModel(),\r\n\t\t\t\tview : new Hualala.Account.AccountQueryShopResultView()\r\n\t\t\t})\r\n\t\t\tthis.init();\r\n\t\t}\r\n\t});\r\n\tAccountQueryShopController.proto({\r\n\t\tinit : function () {\r\n\t\t\tvar self = this;\r\n\t\t\tself.bindEvent();\r\n\t\t\tself.model.emit('load', function () {\r\n\t\t\t\tif (!self.model.hasReady()) {\r\n\t\t\t\t\tthrow(\"Shop Query Init Failed!!\");\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\tself.resultController.initDataStore(self.model.getShops());\r\n\t\t\t\t// 加载View层\r\n\t\t\t\tself.view.emit('init');\r\n\t\t\t\t\r\n\t\t\t});\r\n\t\t},\r\n\t\t// 绑定事件\r\n\t\tbindEvent : function () {\r\n\t\t\t// 控制器的事件绑定\r\n\t\t\tthis.on({\r\n\t\t\t\treload : function () {\r\n\t\t\t\t\tvar self = this;\r\n\t\t\t\t\tself.model.distory();\r\n\t\t\t\t\tself.view.distory();\r\n\t\t\t\t\tself.init();\r\n\t\t\t\t},\r\n\t\t\t\tquery : function (params) {\r\n\t\t\t\t\tvar self = this;\r\n\t\t\t\t\tIX.Debug.info('DEBUG: Account Query Shops Params:');\r\n\t\t\t\t\tIX.Debug.info(params);\r\n\t\t\t\t\tself.resultController && self.resultController.emit('load', IX.inherit(params, {\r\n\t\t\t\t\t\tpageNo : 1,\r\n\t\t\t\t\t\tpageSize : 15\r\n\t\t\t\t\t}));\r\n\t\t\t\t}\r\n\t\t\t}, this);\r\n\t\t\t// 模型的事件绑定\r\n\t\t\tthis.model.on({\r\n\t\t\t\tload : function (cbFn) {\r\n\t\t\t\t\tvar self = this,\r\n\t\t\t\t\t\tparams = {\r\n\t\t\t\t\t\t\tsettleUnitID : self.settleUnitID,\r\n\t\t\t\t\t\t\tsettleName : self.settleName,\r\n\t\t\t\t\t\t\tshopCount : self.shopCount\r\n\t\t\t\t\t\t};\r\n\t\t\t\t\t\t// params = $XP(self.get('sessionData'), 'user', {});\r\n\t\t\t\t\tself.model.init(params, cbFn);\r\n\t\t\t\t}\r\n\t\t\t}, this);\r\n\t\t\t// 视图事件绑定\r\n\t\t\tthis.view.on({\r\n\t\t\t\tinit : function () {\r\n\t\t\t\t\tvar self = this;\r\n\t\t\t\t\tself.view.init({\r\n\t\t\t\t\t\tmodel : self.model,\r\n\t\t\t\t\t\tneedShopCreate : self.needShopCreate,\r\n\t\t\t\t\t\tcontainer : self.container\r\n\t\t\t\t\t});\r\n\t\t\t\t},\r\n\t\t\t\t// 过滤操作，触发显示结果\r\n\t\t\t\tfilter : function (params) {\r\n\t\t\t\t\tvar self = this;\r\n\t\t\t\t\tself.emit('query', params);\r\n\t\t\t\t\t//TODO 重置Query的chosenPanel\r\n\t\t\t\t},\r\n\t\t\t\t// 搜索操作，触发显示结果\r\n\t\t\t\tquery : function (params) {\r\n\t\t\t\t\tvar self = this;\r\n\t\t\t\t\tself.emit('query', params);\r\n\t\t\t\t}\r\n\t\t\t}, this);\r\n\t\t}\r\n\t});\r\n\tHualala.Account.AccountQueryShopController = AccountQueryShopController;\r\n\r\n\tvar AccountQueryShopResultController = Hualala.Shop.ShopListController.subclass({\r\n\t\tconstructor : Hualala.Shop.ShopListController.prototype.constructor\r\n\t});\r\n\tAccountQueryShopResultController.proto({\r\n\t\tinitDataStore : function (data) {\r\n\t\t\tthis.model.initDataStore(data);\r\n\t\t},\r\n\t\tbindEvent : function () {\r\n\t\t\tthis.on({\r\n\t\t\t\tload : function (params) {\r\n\t\t\t\t\tvar self = this;\r\n\t\t\t\t\tif (!self.hasReady()) {\r\n\t\t\t\t\t\tself.init(params);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tself.model.emit('load', params);\r\n\t\t\t\t}\r\n\t\t\t}, this);\r\n\t\t\tthis.model.on({\r\n\t\t\t\tload : function (params) {\r\n\t\t\t\t\tvar self = this;\r\n\t\t\t\t\tvar cbFn = function () {\r\n\t\t\t\t\t\tself.view.emit('render');\r\n\t\t\t\t\t};\r\n\t\t\t\t\tself.model.load(params, cbFn);\r\n\t\t\t\t}\r\n\t\t\t}, this);\r\n\t\t\tthis.view.on({\r\n\t\t\t\trender : function () {\r\n\t\t\t\t\tvar self = this;\r\n\t\t\t\t\tself.view.render();\r\n\t\t\t\t},\r\n\t\t\t\treloadPager : function () {\r\n\t\t\t\t\tvar self = this;\r\n\t\t\t\t\tself.view.initPager(params);\r\n\t\t\t\t}\r\n\t\t\t}, this);\r\n\t\t}\r\n\t});\r\n\tHualala.Account.AccountQueryShopResultController = AccountQueryShopResultController;\r\n\t\r\n})(jQuery, window);;(function ($, window) {\r\n\tIX.ns(\"Hualala.Account\");\r\n\tvar popoverMsg = Hualala.UI.PopoverMsgTip;\r\n\tvar toptip = Hualala.UI.TopTip;\r\n\tvar LoadingModal = Hualala.UI.LoadingModal;\r\n\tvar BaseAccountModel = Hualala.Account.BaseAccountModel;\r\n\r\n\t/*账户管理控制器*/\r\n\tvar AccountMgrController = Stapes.subclass({\r\n\t\t/**\r\n\t\t * 构造控制器\r\n\t\t * @param  {Object} cfg {container, settleUnitID, accountModel, mgrView, transaDetailCtrl}\r\n\t\t * @return {Object}     AccountMgrController实例\r\n\t\t */\r\n\t\tconstructor : function (cfg) {\r\n\t\t\tthis.container = $XP(cfg, 'container', null);\r\n\t\t\tthis.settleUnitID = $XP(cfg, 'settleUnitID', null);\r\n\t\t\tthis.model = $XP(cfg, 'accountModel', null);\r\n\t\t\tthis.view = $XP(cfg, 'mgrView', null);\r\n\t\t\tthis.transaDetailCtrl = $XP(cfg, 'transaDetailCtrl', null);\r\n\t\t\tif (!this.container || !this.model || !this.view || !this.transaDetailCtrl) {\r\n\t\t\t\tthrow(\"Account Detail Mgr Init Failed!!\");\r\n\t\t\t\treturn ;\r\n\t\t\t}\r\n\t\t\tthis.init();\r\n\t\t}\r\n\t});\r\n\tAccountMgrController.proto({\r\n\t\t// 初始化控制器\r\n\t\tinit : function () {\r\n\t\t\tvar self = this;\r\n\t\t\tself.bindEvent();\r\n\t\t\tself.model.emit('load', {\r\n\t\t\t\tsettleUnitID : self.settleUnitID,\r\n\t\t\t\tcbFn : function () {\r\n\t\t\t\t\tself.view.emit('init', {\r\n\t\t\t\t\t\tmodel : self.model,\r\n\t\t\t\t\t\tcontainer : self.container\r\n\t\t\t\t\t});\r\n\t\t\t\t\tself.view.emit('render');\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t},\r\n\t\t// 控制器绑定事件\r\n\t\tbindEvent : function () {\r\n\t\t\tthis.on({\r\n\t\t\t\t// 触发交易明细控制器进行查询\r\n\t\t\t\tquery : function () {\r\n\t\t\t\t\tvar self = this;\r\n\t\t\t\t\t\r\n\t\t\t\t}\r\n\t\t\t}, this);\r\n\t\t\t\r\n\t\t\tthis.view.on({\r\n\t\t\t\tinit : function (params) {\r\n\t\t\t\t\tvar self = this;\r\n\t\t\t\t\tself.view.init(params);\r\n\t\t\t\t\tself.transaDetailCtrl.init({\r\n\t\t\t\t\t\tcontainer : self.container.find('.account-detail-box'),\r\n\t\t\t\t\t\tsettleUnitID : self.settleUnitID\r\n\t\t\t\t\t});\r\n\t\t\t\t},\r\n\t\t\t\trender : function () {\r\n\t\t\t\t\tvar self = this;\r\n\t\t\t\t\tself.view.render();\r\n\t\t\t\t}\r\n\t\t\t}, this);\r\n\t\t}\r\n\t});\r\n\r\n\tHualala.Account.AccountMgrController = AccountMgrController; \r\n\r\n\t/*交易明细控制器*/\r\n\tvar TransactionDetailController = Stapes.subclass({\r\n\t\tconstructor: function () {\r\n\t\t\tthis.set({\r\n\t\t\t\tsessionData : Hualala.getSessionData()\r\n\t\t\t});\r\n\t\t\tthis.container = null;\r\n\t\t\tthis.settleUnitID = null;\r\n\t\t\tthis.model = new Hualala.Account.AccountTransListModel();\r\n\t\t\tthis.view = new Hualala.Account.AccountTransListView();\r\n\t\t\t\r\n\t\t}\r\n\t});\r\n\tTransactionDetailController.proto({\r\n\t\tinit : function (cfg) {\r\n\t\t\tvar self = this;\r\n\t\t\tself.container = $XP(cfg, 'container', null);\r\n\t\t\tself.settleUnitID = $XP(cfg, 'settleUnitID', '');\r\n\t\t\tself.loadingModal = new LoadingModal({\r\n\t\t\t\tstart : 100\r\n\t\t\t});\r\n\t\t\tif (!this.container || !this.model || !this.view) {\r\n\t\t\t\tthrow(\"Account Transaction Detail Mgr Init Failed!!\");\r\n\t\t\t\treturn ;\r\n\t\t\t}\r\n\t\t\tself.bindEvent();\r\n\t\t\tself.model.init({\r\n\t\t\t\t\r\n\t\t\t\tgroupID : $XP(self.get('sessionData'), 'site.groupID'),\r\n\t\t\t\tsettleUnitID : self.settleUnitID\r\n\t\t\t});\r\n\t\t\tself.model.emit('load', {\r\n\t\t\t\tpageNo : 1, pageSize : 15,\r\n\t\t\t\tcbFn : function (model) {\r\n\t\t\t\t\tself.view.emit('init', {\r\n\t\t\t\t\t\tcontainer : self.container,\r\n\t\t\t\t\t\tmodel : model\r\n\t\t\t\t\t});\r\n\t\t\t\t\tself.loadingModal.hide();\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t},\r\n\t\tbindEvent : function () {\r\n\t\t\tthis.model.on({\r\n\t\t\t\tload : function (params) {\r\n\t\t\t\t\tvar self = this;\r\n\t\t\t\t\tvar cbFn = $XP(params, 'cbFn', function () {\r\n\t\t\t\t\t\tself.view.emit('render');\r\n\t\t\t\t\t\tself.loadingModal.hide();\r\n\t\t\t\t\t});\r\n\t\t\t\t\tself.loadingModal.show();\r\n\t\t\t\t\tthis.model.load(params, cbFn);\r\n\t\t\t\t}\r\n\t\t\t}, this);\r\n\t\t\tthis.view.on({\r\n\t\t\t\tinit : function (cfg) {\r\n\t\t\t\t\tthis.view.init(cfg);\r\n\t\t\t\t},\r\n\t\t\t\trender : function () {\r\n\t\t\t\t\tthis.view.render();\r\n\t\t\t\t}\r\n\t\t\t}, this);\r\n\t\t}\r\n\t});\r\n\tHualala.Account.TransactionDetailController = TransactionDetailController;\r\n})(jQuery, window);\r\n;(function ($, window) {\r\n\tIX.ns(\"Hualala.Account\");\r\n\tvar popoverMsg = Hualala.UI.PopoverMsgTip;\r\n\tvar toptip = Hualala.UI.TopTip;\r\n\r\n\tvar AccountActs = [\r\n\t\t{clz : 'btn-success withdraw', act : 'withdraw', label : '提现'},\r\n\t\t{clz : 'btn-link', act : 'edit', label : '修改财务人员信息'},\r\n\t\t{clz : 'btn-link', act : 'queryShops', label : '查看全部店铺'},\r\n\t\t{clz : 'btn-link', act : 'delete', label : '删除此帐户'}\r\n\t];\r\n\r\n\tvar AccountMgrView = Stapes.subclass({\r\n\t\tconstructor : function () {\r\n\t\t\t// View层容器\r\n\t\t\tthis.$container = null;\r\n\t\t\t// 面包屑导航条\r\n\t\t\tthis.$nav = null;\r\n\t\t\tthis.breadCrumbs = null;\r\n\t\t\t// schema容器\r\n\t\t\tthis.$schema = null;\r\n\t\t\t// 交易详情\r\n\t\t\tthis.$detail = null;\r\n\r\n\t\t\tthis.model = null;\r\n\r\n\t\t\tthis.loadTemplates();\r\n\t\t}\r\n\t});\r\n\r\n\tAccountMgrView.proto({\r\n\t\t/**\r\n\t\t * 初始化View层\r\n\t\t * \r\n\t\t * @param  {Object} cfg {model, container}\r\n\t\t * @return {[type]}\r\n\t\t */\r\n\t\tinit : function (cfg) {\r\n\t\t\tthis.$container = $XP(cfg, 'container', null);\r\n\t\t\tthis.model = $XP(cfg, 'model', null);\r\n\t\t\tif (!this.$container || !this.model) {\r\n\t\t\t\tthrow(\"Account Detail View Init Failed!\");\r\n\t\t\t\treturn ;\r\n\t\t\t}\r\n\t\t\tthis.initLayout();\r\n\t\t},\r\n\t\tinitLayout : function () {\r\n\t\t\tvar layoutTpl = this.get('layoutTpl');\r\n\t\t\tvar htm = layoutTpl();\r\n\t\t\tthis.$container.html(htm);\r\n\t\t\tthis.$nav = this.$container.find('.account-nav');\r\n\t\t\tthis.$schema = this.$container.find('.account-schema-box');\r\n\t\t\tthis.$detail = this.$container.find('.account-detail-box');\r\n\t\t\tthis.bindEvent();\r\n\t\t},\r\n\t\tinitBreadCrumbs : function () {\r\n\t\t\tvar self = this,\r\n\t\t\t\t$nav = self.$nav,\r\n\t\t\t\tparentNames = Hualala.PageRoute.getParentNamesByPath();\r\n\t\t\tself.breadCrumbs = new Hualala.UI.BreadCrumb({\r\n\t\t\t\tcontainer : $nav,\r\n\t\t\t\thideRoot : true,\r\n\t\t\t\tnodes : parentNames,\r\n\t\t\t\tclz : 'account-crumbs',\r\n\t\t\t\tclickFn : function () {\r\n\t\t\t\t\tvar $this = $(this);\r\n\t\t\t\t\tdocument.location.href = $this.attr('data-href');\r\n\t\t\t\t},\r\n\t\t\t\tmapRenderData : function (data, hideRoot, clz) {\r\n\t\t\t\t\tvar list = _.map(data, function (el, idx, l) {\r\n\t\t\t\t\t\tvar label = $XP(el, 'label', ''),\r\n\t\t\t\t\t\t\tname = $XP(el, 'name', ''),\r\n\t\t\t\t\t\t\tpath = Hualala.PageRoute.createPath(name, [self.model.get('settleUnitID')]);\r\n\t\t\t\t\t\treturn {\r\n\t\t\t\t\t\t\tclz : 'crumb',\r\n\t\t\t\t\t\t\tlabel : label,\r\n\t\t\t\t\t\t\tpath : path,\r\n\t\t\t\t\t\t\tname : name,\r\n\t\t\t\t\t\t\tisLastNode : (data.length - 1 == idx) ? true : false\r\n\t\t\t\t\t\t};\r\n\t\t\t\t\t});\r\n\t\t\t\t\thideRoot === true && list.shift();\r\n\t\t\t\t\treturn {\r\n\t\t\t\t\t\tclz : clz,\r\n\t\t\t\t\t\titems : list\r\n\t\t\t\t\t};\r\n\t\t\t\t}\r\n\r\n\t\t\t});\r\n\r\n\t\t},\r\n\t\tloadTemplates : function () {\r\n\t\t\tvar layoutTpl = Handlebars.compile(Hualala.TplLib.get('tpl_accountMgr_layout')),\r\n\t\t\t\tschemaTpl = Handlebars.compile(Hualala.TplLib.get('tpl_account_schema')),\r\n\t\t\t\twithDrawTpl = Handlebars.compile(Hualala.TplLib.get('tpl_withdraw_form'));\r\n\t\t\t// 注册子模版\r\n\t\t\tHandlebars.registerPartial(\"accountCard\", Hualala.TplLib.get('tpl_account_card'));\r\n\t\t\tthis.set({\r\n\t\t\t\tlayoutTpl : layoutTpl,\r\n\t\t\t\tschemaTpl : schemaTpl,\r\n\t\t\t\twithDrawTpl : withDrawTpl\r\n\t\t\t});\r\n\t\t},\r\n\t\tbindEvent : function () {\r\n\t\t\tvar self = this;\r\n\t\t\tself.$schema.on('click', '.btn.withdraw', function (e) {\r\n\t\t\t\tif ($(this).hasClass('disabled')) return;\r\n\t\t\t\tself.withdraw($(this));\r\n\t\t\t});\r\n\t\t\tself.$schema.on('click', '[data-act]', function (e) {\r\n\t\t\t\tvar $btn = $(this);\r\n\t\t\t\tvar act = $btn.attr('data-act');\r\n\t\t\t\tif ($btn.hasClass('disabled')) return;\r\n\t\t\t\tswitch(act) {\r\n\t\t\t\t\tcase 'edit':\r\n\t\t\t\t\t\tself.editAccount($btn);\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 'queryShops':\r\n\t\t\t\t\t\tself.queryShops();\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 'delete':\r\n\t\t\t\t\t\tself.deleteAccount();\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\t\r\n\t\t\tself.on({\r\n\t\t\t\t'updateSettleBalance' : function (mAccount) {\r\n\t\t\t\t\tvar settleUnitID = mAccount.get('settleUnitID'),\r\n\t\t\t\t\t\tsettleBalance = Hualala.Common.Math.prettyNumeric(mAccount.get('settleBalance'));\r\n\t\t\t\t\tself.$container.find('[data-id=' + settleUnitID + '] .cash > strong').html(settleBalance);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t},\r\n\t\teditAccount : function ($trigger) {\r\n\t\t\t// triggerEl, mode, model, parentView\r\n\t\t\tvar editAccount = new AccountEditView({\r\n\t\t\t\ttriggerEl : $trigger,\r\n\t\t\t\tmode : 'edit',\r\n\t\t\t\tmodel : this.model,\r\n\t\t\t\tparentView : this\r\n\t\t\t});\r\n\t\t},\r\n\t\twithdraw : function ($trigger) {\r\n\t\t\tvar self = this;\r\n\t\t\t// 提现操作\r\n\t\t\tvar modal = new Hualala.Account.WithdrawCashView({\r\n\t\t\t\ttriggerEl : $trigger,\r\n\t\t\t\tsettleUnitID : self.model.get('settleUnitID'),\r\n\t\t\t\tmodel : self.model,\r\n\t\t\t\tparentView : self\r\n\t\t\t});\r\n\t\t},\r\n\t\tqueryShops : function ($trigger) {\r\n\t\t\tvar self = this;\r\n\t\t\tvar modal = new Hualala.Account.AccountQueryShopModal({\r\n\t\t\t\ttriggerEl : $trigger,\r\n\t\t\t\tsettleUnitID : self.model.get('settleUnitID'),\r\n\t\t\t\tmodel : self.model,\r\n\t\t\t\tparentView : self\r\n\t\t\t});\r\n\t\t},\r\n\t\tdeleteAccount : function () {\r\n\t\t\tvar self = this;\r\n\t\t\tHualala.UI.Confirm({\r\n\t\t\t\ttitle : '删除结算账户',\r\n\t\t\t\tmsg : '是否删除该账户？',\r\n\t\t\t\tokLabel : '删除',\r\n\t\t\t\tokFn : function () {\r\n\t\t\t\t\tself.model.emit('delete', {\r\n\t\t\t\t\t\tsuccessFn : function (settleUnitID) {\r\n\t\t\t\t\t\t\tdocument.location.href = Hualala.PageRoute.createPath('account', [settleUnitID]);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\t\r\n\t\t},\r\n\t\tmapRenderData : function () {\r\n\t\t\tvar self = this,\r\n\t\t\t\tmodel = self.model,\r\n\t\t\t\tacts = AccountActs,\r\n\t\t\t\tacts1 = _.filter(IX.clone(acts), function (el) {\r\n\t\t\t\t\treturn $XP(el, 'act') != 'withdraw';\r\n\t\t\t\t}),\r\n\t\t\t\taccountCard = null;\r\n\t\t\tvar settleUnitID = model.get('settleUnitID') || '',\r\n\t\t\t\thasDefault = model.get('defaultAccount') == 0 ? false : true,\r\n\t\t\t\tbankInfo = Hualala.Common.mapBankInfo(model.get('bankCode')),\r\n\t\t\t\tbankAccountStr = Hualala.Common.codeMask((model.get('bankAccount') || ''), 0, -4),\r\n\t\t\t\tsettleBalance = parseFloat(model.get('settleBalance') || 0),\r\n\t\t\t\tshopCount = parseInt(model.get('shopCount') || 0),\r\n\t\t\t\tdisableWithdraw = settleBalance <= 0 ? 'disabled' : '';\r\n\r\n\t\t\taccountCard = {\r\n\t\t\t\tclz : 'pull-left',\r\n\t\t\t\tsettleUnitID : settleUnitID,\r\n\t\t\t\thasDefault : hasDefault,\r\n\t\t\t\tsettleUnitName : model.get('settleUnitName') || '',\r\n\t\t\t\tdisableWithdraw : disableWithdraw,\r\n\t\t\t\tsettleBalance : settleBalance,\r\n\t\t\t\tbankIcon : $XP(bankInfo, 'icon_16', ''),\r\n\t\t\t\tbankComName : $XP(bankInfo, 'name', ''),\r\n\t\t\t\tbankAccountStr : $XP(bankAccountStr, 'val', '').replace(/([\\w|*]{4})/g, '$1 ').replace(/([*])/g, '<span>$1</span>'),\r\n\t\t\t\tshopCount : shopCount,\r\n\t\t\t\tpath : Hualala.PageRoute.createPath('accountDetail', [settleUnitID]),\r\n\t\t\t\tisDetail : true,\r\n\t\t\t\tacts : IX.map(acts1, function (el, i) {\r\n\t\t\t\t\tvar _act = $XP(el, 'act', '');\r\n\t\t\t\t\treturn IX.inherit(el, {\r\n\t\t\t\t\t\tisFirst : i == 0 ? true : false,\r\n\t\t\t\t\t\tdisabled : (_act == 'delete' && (settleBalance != 0 || shopCount != 0)) ? 'disabled' : ''\r\n\t\t\t\t\t});\r\n\t\t\t\t})\r\n\t\t\t};\r\n\t\t\treturn {\r\n\t\t\t\taccountCard : accountCard,\r\n\t\t\t\tacts : _.map(acts, function (el) {\r\n\t\t\t\t\tvar _act = $XP(el, 'act', '');\r\n\t\t\t\t\tif (_act == 'queryShops') {\r\n\t\t\t\t\t\treturn IX.inherit(el, {\r\n\t\t\t\t\t\t\tlabel : $XP(el, 'label', '') + '(' + shopCount + ')'\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t} else if (_act == 'withdraw') {\r\n\t\t\t\t\t\treturn IX.inherit(el, {\r\n\t\t\t\t\t\t\tdisableWithdraw : disableWithdraw\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t} else if (_act == 'delete') {\r\n\t\t\t\t\t\treturn IX.inherit(el, {\r\n\t\t\t\t\t\t\tdisabled : (settleBalance != 0 || shopCount != 0) ? 'disabled' : ''\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn el;\r\n\t\t\t\t})\r\n\t\t\t};\r\n\t\t},\r\n\t\trender : function () {\r\n\t\t\tvar self = this,\r\n\t\t\t\tmodel = self.model,\r\n\t\t\t\trenderData = self.mapRenderData(),\r\n\t\t\t\ttpl = self.get('schemaTpl');\r\n\t\t\tvar htm = tpl(renderData);\r\n\t\t\tself.initBreadCrumbs();\r\n\t\t\tself.$schema.html(htm);\r\n\t\t},\r\n\t\trefresh : function () {\r\n\t\t\tthis.render();\r\n\t\t}\r\n\t});\r\n\t\r\n\tHualala.Account.AccountMgrView = AccountMgrView; \r\n\r\n\r\n\t// 结算账户表单配置\r\n\tvar AccountEditFormElsCfg = {\r\n\t\treceiverType : {\r\n\t\t\ttype : \"radiogrp\",\r\n\t\t\tlabel : \"收款方类型\",\r\n\t\t\tdefaultVal : 2,\r\n\t\t\toptions : Hualala.TypeDef.AccountReceiverTypes,\r\n\t\t\tvalidCfg : {\r\n\t\t\t\tvalidators : {}\r\n\t\t\t}\r\n\t\t},\r\n\t\treceiverName : {\r\n\t\t\ttype : \"text\",\r\n\t\t\tlabel : \"收款单位/姓名\",\r\n\t\t\tdefaultVal : \"\",\r\n\t\t\tvalidCfg : {\r\n\t\t\t\tvalidators : {\r\n\t\t\t\t\tnotEmpty : {\r\n\t\t\t\t\t\tmessage : \"请输入收款单位/姓名\"\r\n\t\t\t\t\t},\r\n\t\t\t\t\tstringLength : {\r\n\t\t\t\t\t\tmax : 20,\r\n\t\t\t\t\t\tmessage : \"收款单位/姓名不能超过20个字\"\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\tsettleUnitName : {\r\n\t\t\ttype : \"text\",\r\n\t\t\tlabel : \"结算账户名称\",\r\n\t\t\tdefaultVal : \"\",\r\n\t\t\tvalidCfg : {\r\n\t\t\t\tvalidators : {\r\n\t\t\t\t\tnotEmpty : {\r\n\t\t\t\t\t\tmessage : \"请输入结算账户名称\"\r\n\t\t\t\t\t},\r\n\t\t\t\t\tstringLength : {\r\n\t\t\t\t\t\tmax : 50,\r\n\t\t\t\t\t\tmessage : \"结算账户名称不能超过50个字\"\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\tbankAccount : {\r\n\t\t\ttype : \"text\",\r\n\t\t\tlabel : \"转账账号\",\r\n\t\t\tdefaultVal : \"\",\r\n\t\t\tvalidCfg : {\r\n\t\t\t\tvalidators : {\r\n\t\t\t\t\tnotEmpty : {\r\n\t\t\t\t\t\tmessage : \"请输入转账账号\"\r\n\t\t\t\t\t},\r\n\t\t\t\t\tstringLength : {\r\n\t\t\t\t\t\tmax : 30,\r\n\t\t\t\t\t\tmessage : \"转账账号不能超过30个字\"\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\tbankCode : {\r\n\t\t\ttype : \"combo\",\r\n\t\t\tlabel : \"转账银行\",\r\n\t\t\tdefaultVal : \"CMB\",\r\n\t\t\toptions : Hualala.TypeDef.BankOptions,\r\n\t\t\tvalidCfg : {\r\n\t\t\t\tvalidators : {\r\n\t\t\t\t\tnotEmpty : {\r\n\t\t\t\t\t\tmessage : \"请选择转账银行\"\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\tbankName : {\r\n\t\t\ttype : \"text\",\r\n\t\t\tlabel : \"转账分行\",\r\n\t\t\tdefaultVal : \"\",\r\n\t\t\tprefix : '<span class=\"bank-name-icon icon-CMB-16\"></span>',\r\n\t\t\tvalidCfg : {\r\n\t\t\t\tvalidators : {\r\n\t\t\t\t\tnotEmpty : {\r\n\t\t\t\t\t\tmessage : \"请输入转账分行名称\"\r\n\t\t\t\t\t},\r\n\t\t\t\t\tstringLength : {\r\n\t\t\t\t\t\tmax : 40,\r\n\t\t\t\t\t\tmessage : \"转账分行不能超过40个字\"\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\tremark : {\r\n\t\t\ttype : \"text\",\r\n\t\t\tlabel : \"备注\",\r\n\t\t\tdefaultVal : \"\",\r\n\t\t\tvalidCfg : {\r\n\t\t\t\tvalidators : {\r\n\t\t\t\t\tstringLength : {\r\n\t\t\t\t\t\tmax : 250,\r\n\t\t\t\t\t\tmessage : \"备注不能超过250个字\"\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\tdefaultAccount : {\r\n\t\t\ttype : \"switcher\",\r\n\t\t\tlabel : \"默认账户\",\r\n\t\t\tdefaultVal : 1,\r\n\t\t\tonLabel : \"开启\",\r\n\t\t\toffLabel : \"关闭\",\r\n\t\t\thelpClz : \"help-block col-sm-12 text-center form-help-cutoff\",\r\n\t\t\thelp : \"<span class='cutoff'></span><span class='cutoff-text text-warning'>如需更改请与哗啦啦客服联系。</span>\",\r\n\t\t\tvalidCfg : {\r\n\t\t\t\tvalidators : {}\r\n\t\t\t}\r\n\t\t},\r\n\t\treceiverLinkman : {\r\n\t\t\ttype : \"text\",\r\n\t\t\tlabel : \"姓名\",\r\n\t\t\tdefaultVal : \"\",\r\n\t\t\tprefix : '<span class=\"glyphicon glyphicon-user\"></span>',\r\n\t\t\tvalidCfg : {\r\n\t\t\t\tvalidators : {\r\n\t\t\t\t\tnotEmpty : {\r\n\t\t\t\t\t\tmessage : \"请输入姓名\"\r\n\t\t\t\t\t},\r\n\t\t\t\t\tstringLength : {\r\n\t\t\t\t\t\tmax : 20,\r\n\t\t\t\t\t\tmessage : \"姓名不能超过20个字\"\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\treceiverMobile : {\r\n\t\t\ttype : \"text\",\r\n\t\t\tlabel : \"手机\",\r\n\t\t\tdefaultVal : \"\",\r\n\t\t\tprefix : '<span class=\"glyphicon glyphicon-phone\"></span>',\r\n\t\t\tvalidCfg : {\r\n\t\t\t\tvalidators : {\r\n\t\t\t\t\tnotEmpty : {\r\n\t\t\t\t\t\tmessage : \"请输入手机号\"\r\n\t\t\t\t\t},\r\n\t\t\t\t\tmobile : {message : \"请输入正确手机号\"}\r\n\t\t\t\t\t// stringLength : {\r\n\t\t\t\t\t// \tmax : 30,\r\n\t\t\t\t\t// \tmessage : \"手机不能超过30个字\"\r\n\t\t\t\t\t// }\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\treceiverEmail : {\r\n\t\t\ttype : \"text\",\r\n\t\t\tlabel : \"邮箱\",\r\n\t\t\tdefaultVal : \"\",\r\n\t\t\tprefix : '<span class=\"glyphicon glyphicon-envelope\"></span>',\r\n\t\t\tvalidCfg : {\r\n\t\t\t\tvalidators : {\r\n\t\t\t\t\temailAddress : {message : \"请输入正确邮箱账号\"}\r\n\t\t\t\t\t// stringLength : {\r\n\t\t\t\t\t// \tmax : 50,\r\n\t\t\t\t\t// \tmessage : \"邮箱不能超过30个字\"\r\n\t\t\t\t\t// }\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n\tvar AccountEditFormElsHT = new IX.IListManager();\r\n\t_.each(AccountEditFormElsCfg, function (el, k) {\r\n\t\tvar type = $XP(el, 'type');\r\n\t\tvar labelClz = 'col-sm-offset-1 col-sm-3 control-label';\r\n\t\tif (type == 'radiogrp') {\r\n\t\t\tvar ops = _.map($XP(el, 'options'), function (op) {\r\n\t\t\t\treturn IX.inherit(op, {\r\n\t\t\t\t\tid : k + '_' + IX.id(),\r\n\t\t\t\t\tname : k,\r\n\t\t\t\t\tclz : 'col-sm-5 radio-inline'\r\n\t\t\t\t});\r\n\t\t\t});\r\n\t\t\tAccountEditFormElsHT.register(k, IX.inherit(el, {\r\n\t\t\t\tid : '',\r\n\t\t\t\toptions : ops,\r\n\t\t\t\tlabelClz : labelClz,\r\n\t\t\t\tclz : 'col-sm-5'\r\n\t\t\t}));\r\n\t\t} else {\r\n\t\t\tAccountEditFormElsHT.register(k, IX.inherit(el, {\r\n\t\t\t\tid : k + '_' + IX.id(),\r\n\t\t\t\tname : k,\r\n\t\t\t\tlabelClz : labelClz,\r\n\t\t\t\tclz : 'col-sm-5'\r\n\t\t\t}));\r\n\t\t}\r\n\t\t\r\n\t});\r\n\t\r\n\t// 结算账户编辑窗口\r\n\tvar AccountEditView = Stapes.subclass({\r\n\t\t/**\r\n\t\t * 结算账户编辑窗口构造器\r\n\t\t * @param  {Object} cfg {triggerEl, mode, model, parentView}\r\n\t\t * \t\t\t\t@param {jQueryObj} triggerEl 出发元素\r\n\t\t * \t\t\t\t@param {String} mode  操作模式add:添加账户模式；edit:编辑模式; read:只读模式\r\n\t\t * \t\t\t\t@param {Object} model 结算账户数据模型\r\n\t\t * \t\t\t\t@param {Object} parentView 父级View层\r\n\t\t * @return {Object}\t\t账户编辑实例\r\n\t\t */\r\n\t\tconstructor : function (cfg) {\r\n\t\t\tthis.$trigger = $XP(cfg, 'trigger', null);\r\n\t\t\tthis.mode = $XP(cfg, 'mode', 'edit');\r\n\t\t\tthis.model = $XP(cfg, 'model', null) || new Hualala.Account.BaseAccountModel();\r\n\t\t\tthis.parentView = $XP(cfg, 'parentView', null);\r\n\t\t\tthis.modal = null;\r\n\t\t\tthis.formKeys = 'settleUnitName,receiverType,receiverName,bankAccount,bankCode,bankName,remark,defaultAccount,receiverLinkman,receiverMobile,receiverEmail'.split(',');\r\n\t\t\tthis.loadTemplates();\r\n\t\t\tthis.initModal();\r\n\t\t\tthis.renderForm();\r\n\t\t\tthis.bindEvent();\r\n\t\t\tthis.resetBankCode();\r\n\t\t\tthis.emit('show');\r\n\t\t}\r\n\t});\r\n\tAccountEditView.proto({\r\n\t\tloadTemplates : function () {\r\n\t\t\tvar layoutTpl = Handlebars.compile(Hualala.TplLib.get('tpl_account_edit')),\r\n\t\t\t\tbtnTpl = Handlebars.compile(Hualala.TplLib.get('tpl_shop_modal_btns'));\r\n\t\t\tHandlebars.registerHelper('checkFormElementType', function (conditional, options) {\r\n\t\t\t\treturn (conditional == options.hash.type) ? options.fn(this) : options.inverse(this);\r\n\t\t\t});\r\n\t\t\tHandlebars.registerHelper('isInputGroup', function (prefix, surfix, options) {\r\n\t\t\t\treturn (!prefix && !surfix) ? options.inverse(this) : options.fn(this);\r\n\t\t\t});\r\n\t\t\tthis.set({\r\n\t\t\t\tlayoutTpl : layoutTpl,\r\n\t\t\t\tbtnTpl : btnTpl\r\n\t\t\t});\r\n\t\t},\r\n\t\tgetModalTitle : function () {\r\n\t\t\treturn (this.mode == 'edit' ?  '修改' : '增加') + '财务人员信息';\r\n\t\t},\r\n\t\tinitModal : function () {\r\n\t\t\tvar self = this;\r\n\t\t\tself.modal = new Hualala.UI.ModalDialog({\r\n\t\t\t\tid : 'account_edit',\r\n\t\t\t\tclz : 'account-modal',\r\n\t\t\t\ttitle : self.getModalTitle(),\r\n\t\t\t\tafterRemove : function () {\r\n\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t},\r\n\t\tmapFormElsData : function () {\r\n\t\t\tvar self = this,\r\n\t\t\t\tmode = self.mode,\r\n\t\t\t\tformKeys = self.formKeys;\r\n\t\t\tvar formEls = _.map(formKeys, function (key) {\r\n\t\t\t\tvar elCfg = AccountEditFormElsHT.get(key),\r\n\t\t\t\t\ttype = $XP(elCfg, 'type');\r\n\t\t\t\tif (type == 'combo') {\r\n\t\t\t\t\tvar v = self.model.get(key) || $XP(elCfg, 'defaultVal'),\r\n\t\t\t\t\t\toptions = _.map($XP(elCfg, 'options'), function (op) {\r\n\t\t\t\t\t\t\treturn IX.inherit(op, {\r\n\t\t\t\t\t\t\t\tselected : $XP(op, 'value') == v ? 'selected' : ''\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\treturn IX.inherit(elCfg, {\r\n\t\t\t\t\t\tdisabled : mode == 'edit' ? 'disabled' : '',\r\n\t\t\t\t\t\tvalue : v,\r\n\t\t\t\t\t\toptions : options\r\n\t\t\t\t\t});\r\n\t\t\t\t} else if (type == 'radiogrp') {\r\n\t\t\t\t\tvar v = self.model.get(key) || $XP(elCfg, 'defaultVal'),\r\n\t\t\t\t\t\toptions = _.map($XP(elCfg, 'options'), function (op) {\r\n\t\t\t\t\t\t\treturn IX.inherit(op, {\r\n\t\t\t\t\t\t\t\tdisabled : mode == 'edit' ? 'disabled' : '',\r\n\t\t\t\t\t\t\t\tchecked : $XP(op, 'value') == v ? 'checked' : ''\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\treturn IX.inherit(elCfg, {\r\n\t\t\t\t\t\tvalue : v,\r\n\t\t\t\t\t\toptions : options\r\n\t\t\t\t\t});\r\n\t\t\t\t} else if (type == 'switcher') {\r\n\t\t\t\t\treturn IX.inherit(elCfg, {\r\n\t\t\t\t\t\tdisabled : mode == 'edit' ? 'disabled' : '',\r\n\t\t\t\t\t\tchecked : self.model.get(key) == $XP(elCfg, 'defaultVal') ? 'checked' : ''\r\n\t\t\t\t\t});\r\n\t\t\t\t} else {\r\n\t\t\t\t\treturn IX.inherit(elCfg, {\r\n\t\t\t\t\t\tdisabled : mode !== 'edit' ? '' : ((key == 'receiverLinkman' || key == 'receiverMobile' || key == 'receiverEmail') ? '' : 'disabled'),\r\n\t\t\t\t\t\tvalue : self.model.get(key) || $XP(elCfg, 'defaultVal')\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\treturn formEls;\r\n\t\t},\r\n\t\trenderForm : function () {\r\n\t\t\tvar self = this,\r\n\t\t\t\trenderData = self.mapFormElsData(),\r\n\t\t\t\tmode = self.mode,\r\n\t\t\t\ttpl = self.get('layoutTpl'),\r\n\t\t\t\tbtnTpl = self.get('btnTpl'),\r\n\t\t\t\thtm = tpl({\r\n\t\t\t\t\tformClz : 'account-form form-feedback-out',\r\n\t\t\t\t\titems : renderData\r\n\t\t\t\t});\r\n\t\t\tself.modal._.body.html(htm);\r\n\t\t\tself.modal._.footer.html(btnTpl({\r\n\t\t\t\tbtns : [\r\n\t\t\t\t\t{clz : 'btn-default', name : 'cancel', label : '取消'},\r\n\t\t\t\t\t{clz : 'btn-warning', name : 'submit', label : mode == 'edit' ? '保存' : '添加'}\r\n\t\t\t\t]\r\n\t\t\t}));\r\n\r\n\t\t\tself.initSwitcher(':checkbox[data-type=switcher]');\r\n\r\n\t\t},\r\n\t\tinitValidFieldOpts : function () {\r\n\t\t\tvar self = this,\r\n\t\t\t\tformKeys = self.formKeys,\r\n\t\t\t\tret = {};\r\n\t\t\t_.each(formKeys, function (key) {\r\n\t\t\t\tvar elCfg = AccountEditFormElsHT.get(key),\r\n\t\t\t\t\ttype = $XP(elCfg, 'type');\r\n\t\t\t\tif (type == 'section') {\r\n\t\t\t\t\tvar min = key + '_min', max = key + '_max';\r\n\t\t\t\t\tret[min] = $XP(elCfg, 'min.validCfg', {});\r\n\t\t\t\t\tret[max] = $XP(elCfg, 'max.validCfg', {});\r\n\t\t\t\t} else {\r\n\t\t\t\t\tret[key] = $XP(elCfg, 'validCfg', {});\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\treturn ret;\r\n\t\t},\r\n\t\tbindEvent : function () {\r\n\t\t\tvar self = this;\r\n\t\t\tvar fvOpts = self.initValidFieldOpts();\r\n\t\t\tthis.on({\r\n\t\t\t\tshow : function () {\r\n\t\t\t\t\tthis.modal.show();\r\n\t\t\t\t},\r\n\t\t\t\thide : function () {\r\n\t\t\t\t\tthis.modal.hide();\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\tself.modal._.dialog.find('.btn').on('click', function (e) {\r\n\t\t\t\tvar $btn = $(this),\r\n\t\t\t\t\tact = $btn.attr('name');\r\n\t\t\t\tif (act == 'cancel') {\r\n\t\t\t\t\tself.emit('hide');\r\n\t\t\t\t} else {\r\n\t\t\t\t\tvar bv = self.modal._.body.find('form').data('bootstrapValidator');\r\n\t\t\t\t\t$btn.button('提交中...');\r\n\t\t\t\t\tbv.validate();\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\tself.modal._.body.find('form [name=bankCode]').on('change', function (e) {\r\n\t\t\t\tvar $combo = $(this),\r\n\t\t\t\t\t$bankNameIcon = self.modal._.body.find('form .bank-name-icon'),\r\n\t\t\t\t\tval = $combo.val();\r\n\t\t\t\t$bankNameIcon.trigger('change', val);\r\n\t\t\t});\r\n\t\t\tself.modal._.body.find('form .bank-name-icon').on('change', function (e, v) {\r\n\t\t\t\tvar $bankNameIcon = $(this);\r\n\t\t\t\tvar bankInfo = Hualala.Common.mapBankInfo(v);\r\n\t\t\t\tIX.Debug.info(\"DEBUG: Account Bank Info : \");\r\n\t\t\t\tIX.Debug.info(bankInfo);\r\n\t\t\t\t$bankNameIcon.removeClass().addClass('bank-name-icon ' + $XP(bankInfo, 'icon_16', ''));\r\n\t\t\t});\r\n\t\t\tself.modal._.body.find('form').bootstrapValidator({\r\n\t\t\t\ttrigger : 'blur',\r\n\t\t\t\tfields : fvOpts\r\n\t\t\t}).on('error.field.bv', function (e, data) {\r\n\t\t\t\tvar $form = $(e.target),\r\n\t\t\t\t\tbv = $form.data('bootstrapValidator');\r\n\t\t\t}).on('success.form.bv', function (e, data) {\r\n\t\t\t\te.preventDefault();\r\n\t\t\t\tvar $form = $(e.target),\r\n\t\t\t\t\tbv = $form.data('bootstrapValidator');\r\n\t\t\t\tvar formParams = self.serializeForm();\r\n\t\t\t\tIX.Debug.info(\"DEBUG: Account Edit View Form Params : \");\r\n\t\t\t\tIX.Debug.info(formParams);\r\n\t\t\t\tself.model.emit(self.mode, {\r\n\t\t\t\t\tparams : formParams,\r\n\t\t\t\t\tfailFn : function () {\r\n\t\t\t\t\t\tself.modal._.footer.find('.btn[name=submit]').button('reset');\r\n\t\t\t\t\t},\r\n\t\t\t\t\tsuccessFn : function () {\r\n\t\t\t\t\t\tself.modal._.footer.find('.btn[name=submit]').button('reset');\r\n\t\t\t\t\t\tself.parentView && IX.isFn(self.parentView.refresh) && self.parentView.refresh();\r\n\t\t\t\t\t\tself.emit('hide');\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t});\r\n\t\t},\r\n\t\tresetBankCode : function () {\r\n\t\t\tvar self = this;\r\n\t\t\tvar bankCode = self.modal._.body.find('form [name=bankCode]').val();\r\n\t\t\tself.modal._.body.find('form .bank-name-icon').trigger('change', bankCode);\r\n\t\t},\r\n\t\tinitSwitcher : function (selector) {\r\n\t\t\tvar self = this;\r\n\t\t\tself.modal._.body.find(selector).each(function () {\r\n\t\t\t\tvar $el = $(this),\r\n\t\t\t\t\tonLabel = $el.attr('data-onLabel'),\r\n\t\t\t\t\toffLabel = $el.attr('data-offLabel');\r\n\t\t\t\t$el.bootstrapSwitch({\r\n\t\t\t\t\tsize : 'normal',\r\n\t\t\t\t\tonColor : 'primary',\r\n\t\t\t\t\toffColor : 'default',\r\n\t\t\t\t\tonText : onLabel,\r\n\t\t\t\t\toffText : offLabel\r\n\t\t\t\t});\r\n\t\t\t});\r\n\t\t},\r\n\t\tserializeForm : function () {\r\n\t\t\tvar self = this,\r\n\t\t\t\tformKeys = self.formKeys,\r\n\t\t\t\tret = {},\r\n\t\t\t\tformEls = _.map(formKeys, function (key) {\r\n\t\t\t\t\tvar elCfg = AccountEditFormElsHT.get(key),\r\n\t\t\t\t\t\ttype = $XP(elCfg, 'type');\r\n\t\t\t\t\tif (type == 'switcher') {\r\n\t\t\t\t\t\t// ret[key] = $('[name=' + key + ']').attr('checked') ? 1 : 0;\r\n\t\t\t\t\t\tret[key] = !$('[name=' + key + ']').data('bootstrapSwitch').options.state ? 0 : 1;\r\n\t\t\t\t\t} else if (type == 'radiogrp') {\r\n\t\t\t\t\t\tret[key] = $('[name=' + key + ']:checked').val();\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tret[key] = $('[name=' + key + ']').val();\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\treturn ret;\r\n\t\t}\r\n\t});\r\n\r\n\tHualala.Account.AccountEditView = AccountEditView;\r\n\r\n\tvar AccountQueryShopModal = Stapes.subclass({\r\n\t\tconstructor : function (cfg) {\r\n\t\t\tthis.$trigger = $XP(cfg, 'trigger', null);\r\n\t\t\tthis.model = $XP(cfg, 'model', null);\r\n\t\t\tthis.parentView = $XP(cfg, 'parentView', null);\r\n\t\t\tthis.modal = null;\r\n\t\t\tthis.$queryBox = null;\r\n\t\t\tthis.$resultBox = null;\r\n\t\t\tthis.queryCtrl = null;\r\n\t\t\tthis.set({\r\n\t\t\t\tsettleUnitID : this.model.get('settleUnitID'),\r\n\t\t\t\tsettleName : this.model.get('settleUnitName'),\r\n\t\t\t\tshopCount : this.model.get('shopCount'),\r\n\t\t\t});\r\n\r\n\t\t\tthis.loadTemplates();\r\n\t\t\tthis.initModal();\r\n\t\t\tthis.render();\r\n\t\t\tthis.bindEvent();\r\n\t\t\tthis.initQueryBox();\r\n\t\t\tthis.emit('show');\r\n\t\t}\r\n\t});\r\n\tAccountQueryShopModal.proto({\r\n\t\tloadTemplates : function () {\r\n\t\t\tvar layoutTpl = Handlebars.compile(Hualala.TplLib.get('tpl_account_query_shop')),\r\n\t\t\t\tbtnTpl = Handlebars.compile(Hualala.TplLib.get('tpl_shop_modal_btns'));\r\n\t\t\t\r\n\t\t\tthis.set({\r\n\t\t\t\tlayoutTpl : layoutTpl,\r\n\t\t\t\tbtnTpl : btnTpl\r\n\t\t\t});\r\n\t\t},\r\n\t\tinitModal : function () {\r\n\t\t\tvar self = this;\r\n\t\t\tself.modal = new Hualala.UI.ModalDialog({\r\n\t\t\t\tid : 'account_query_shop',\r\n\t\t\t\tclz : 'account-modal',\r\n\t\t\t\ttitle : \"结算账户关联店铺\",\r\n\t\t\t\tafterRemove : function () {\r\n\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t},\r\n\t\trender : function () {\r\n\t\t\tvar self = this,\r\n\t\t\t\tlayoutTpl = self.get('layoutTpl'),\r\n\t\t\t\tbtnTpl = self.get('btnTpl');\r\n\t\t\tvar settleUnitName = self.model.get('settleUnitName') || '',\r\n\t\t\t\tbtns = [{clz : 'btn-default', name : 'cancel', label : '关闭'}];\r\n\t\t\tvar htm = layoutTpl({\r\n\t\t\t\tclz : '',\r\n\t\t\t\ttitle : settleUnitName,\r\n\t\t\t\tlabel : \"结算账户名称\"\r\n\t\t\t});\r\n\t\t\tself.modal._.body.html(htm);\r\n\t\t\tself.modal._.footer.html(btnTpl({\r\n\t\t\t\tbtns : btns\r\n\t\t\t}));\r\n\t\t\tself.$queryBox = self.modal._.body.find('.query-box');\r\n\t\t\tself.$resultBox = self.modal._.body.find('.result-box');\r\n\t\t},\r\n\t\tbindEvent : function () {\r\n\t\t\tvar self = this;\r\n\t\t\tthis.on({\r\n\t\t\t\t\"show\" : function () {\r\n\t\t\t\t\tself.modal.show();\r\n\t\t\t\t},\r\n\t\t\t\t\"hide\" : function () {\r\n\t\t\t\t\tself.modal.hide();\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\tself.modal._.dialog.find('.btn').on('click', function (e) {\r\n\t\t\t\tvar $btn = $(this),\r\n\t\t\t\t\tact = $btn.attr('name');\r\n\t\t\t\tif (act == 'cancel') {\r\n\t\t\t\t\tself.emit('hide');\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t},\r\n\t\tinitQueryBox : function () {\r\n\t\t\tvar self = this;\r\n\t\t\tself.queryCtrl = new Hualala.Account.AccountQueryShopController({\r\n\t\t\t\tcontainer : self.$queryBox,\r\n\t\t\t\tresultContainer : self.$resultBox,\r\n\t\t\t\tsettleUnitID : self.get('settleUnitID'),\r\n\t\t\t\tsettleName : self.get('settleName'),\r\n\t\t\t\tshopCount : self.get('shopCount')\r\n\t\t\t\t// resultController : new Hualala.Account.AccountQueryShopResultController({\r\n\t\t\t\t// \tcontainer : self.$resultBox,\r\n\t\t\t\t// \tmodel : new Hualala.Account.AccountQueryShopResultModel(),\r\n\t\t\t\t// \tview : new Hualala.Account.AccountQueryShopResultView()\r\n\t\t\t\t// })\r\n\t\t\t});\r\n\t\t}\r\n\t});\r\n\tHualala.Account.AccountQueryShopModal = AccountQueryShopModal;\r\n\r\n\t// 结算账户交易明细\r\n\tvar PersonUnit = Hualala.Constants.PersonUnit,\r\n\t\tCashUnit = Hualala.Constants.CashUnit;\r\n\tvar getOrderSubTypeLabel = function (orderSubType) {\r\n\t\tif (IX.isEmpty(orderSubType)) return '';\r\n\t\tvar l = Hualala.TypeDef.ShopBusiness;\r\n\t\tvar m = _.find(l, function (el) {\r\n\t\t\tvar id = $XP(el, 'id');\r\n\t\t\treturn id == orderSubType;\r\n\t\t});\r\n\t\tif (!m) return '';\r\n\t\treturn $XP(m, 'label', '');\r\n\t};\r\n\tvar getGenderLabel = function (v) {\r\n\t\tif (IX.isEmpty(v)) return '';\r\n\t\tvar l = Hualala.TypeDef.GENDER;\r\n\t\tvar m = _.find(l, function (el) {\r\n\t\t\tvar id = $XP(el, 'value');\r\n\t\t\treturn id == v;\r\n\t\t});\r\n\t\tif (!m) return '';\r\n\t\treturn $XP(m, 'label', '');\r\n\t};\r\n\tvar mapUserFields = function (cfg, data) {\r\n\t\tvar label = $XP(cfg, 'label', ''), fieldType = $XP(cfg, 'fieldType', ''), fields = $XP(cfg, 'fields', []);\r\n\t\tvar userSex = $XP(data, 'userSex', '');\r\n\t\tuserSex = IX.isEmpty(userSex) ? '' : '(' + getGenderLabel(userSex) + ')';\r\n\t\tvar _fields = _.map(fields, function (key) {\r\n\t\t\tvar fieldLabelCfg = OrderPayFieldLabelLib[key], label = $XP(fieldLabelCfg, 'label', ''),\r\n\t\t\t\tunit = $XP(fieldLabelCfg, 'unit', ''), clz = $XP(fieldLabelCfg, 'clz', '');\r\n\t\t\tvar value = $XP(data, key, '');\r\n\t\t\tvalue += (key == 'userName') ? userSex : '';\r\n\t\t\tvalue += unit;\r\n\t\t\treturn {\r\n\t\t\t\tkey : key,\r\n\t\t\t\tclz : clz,\r\n\t\t\t\tlabel : label,\r\n\t\t\t\tvalue : value\r\n\t\t\t};\r\n\t\t});\r\n\t\treturn {\r\n\t\t\tlabel : label,\r\n\t\t\tfieldType : fieldType,\r\n\t\t\tfields : _fields\r\n\t\t};\r\n\t};\r\n\tvar mapOrderFields = function (cfg, data) {\r\n\t\tvar label = $XP(cfg, 'label', ''), fieldType = $XP(cfg, 'fieldType', ''), fields = $XP(cfg, 'fields', []);\r\n\t\tvar orderSubType = $XP(data, 'orderSubType', ''),\r\n\t\t\torderSubTypeLabel = getOrderSubTypeLabel(orderSubType);\r\n\t\torderSubTypeLabel = IX.isEmpty(orderSubTypeLabel) ? '' : '(' + orderSubTypeLabel + ')';\r\n\t\tvar _fields = _.map(fields, function (key) {\r\n\t\t\tvar fieldLabelCfg = OrderPayFieldLabelLib[key], label = $XP(fieldLabelCfg, 'label', ''),\r\n\t\t\t\tunit = $XP(fieldLabelCfg, 'unit', ''), clz = $XP(fieldLabelCfg, 'clz', '');\r\n\t\t\tvar value = $XP(data, key, '');\r\n\t\t\tswitch(key) {\r\n\t\t\t\tcase 'timeName':\r\n\t\t\t\tcase 'consumptionTypeName' :\r\n\t\t\t\tcase 'promotionDesc' :\r\n\t\t\t\tcase 'orderRemark':\r\n\t\t\t\t\tclz += IX.isEmpty(value) ? ' hidden' : '';\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'orderTime':\r\n\t\t\t\tcase 'orderCreateTime':\r\n\t\t\t\t\tvalue = IX.Date.getDateByFormat(Hualala.Common.formatDateTimeValue(value), 'yyyy/MM/dd HH:mm');\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'statusName':\r\n\t\t\t\t\tvar isAlreadyPaid = $XP(data, 'isAlreadyPaid', 0),\r\n\t\t\t\t\t\torderStatus = $XP(data, 'orderStatus', '');\r\n\t\t\t\t\tvar surfix = '';\r\n\t\t\t\t\tif (orderStatus >= 20 && isAlreadyPaid == 1) {\r\n\t\t\t\t\t\tsurfix = \"<span>线上付款</span>\";\r\n\t\t\t\t\t} else if (orderStatus >= 20 && isAlreadyPaid == 0) {\r\n\t\t\t\t\t\tsurfix = '<span color=\"red\">' + (orderStatus == 20 ? \"餐到付款\" : \"到店付款\") + \"</span>\";\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tsurfix = \"<span>未付款</span>\";\r\n\t\t\t\t\t}\r\n\t\t\t\t\tsurfix = '(' + surfix + ')';\r\n\t\t\t\t\tvalue = value + surfix;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'takeoutAddress' :\r\n\t\t\t\t\tclz += orderSubType == 20 || orderSubType == 21 ? '' : ' hidden';\r\n\t\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t\tvalue += unit;\r\n\t\t\treturn {\r\n\t\t\t\tkey : key,\r\n\t\t\t\tclz : clz,\r\n\t\t\t\tlabel : label,\r\n\t\t\t\tvalue : value\r\n\t\t\t};\r\n\t\t});\r\n\t\treturn {\r\n\t\t\tlabel : label,\r\n\t\t\torderSubTypeLabel : orderSubTypeLabel,\r\n\t\t\tfieldType : fieldType,\r\n\t\t\tfields : _fields\r\n\t\t};\r\n\t};\r\n\tvar mapPayFields = function (cfg, data) {\r\n\t\tvar label = $XP(cfg, 'label', ''), fieldType = $XP(cfg, 'fieldType', ''), fields = $XP(cfg, 'fields', []);\r\n\t\tvar orderSubType = $XP(data, 'orderSubType', '');\r\n\t\tvar _fields = _.map(fields, function (key) {\r\n\t\t\tvar fieldLabelCfg = OrderPayFieldLabelLib[key], label = $XP(fieldLabelCfg, 'label', ''),\r\n\t\t\t\tunit = $XP(fieldLabelCfg, 'unit', ''), clz = $XP(fieldLabelCfg, 'clz', '');\r\n\t\t\tvar value = $XP(data, key, '');\r\n\t\t\tswitch(key) {\r\n\t\t\t\tcase 'serviceAmount':\r\n\t\t\t\tcase 'discountAmount':\r\n\t\t\t\tcase 'freeAmount':\r\n\t\t\t\tcase 'giftAmount':\r\n\t\t\t\tcase 'cardDiscountAmount':\r\n\t\t\t\tcase 'pointBalance':\r\n\t\t\t\tcase 'moneyBalance':\r\n\t\t\t\tcase 'orderRefundAmount':\r\n\t\t\t\t\tclz += value == 0 ? ' hidden' : '';\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'presentInfo':\r\n\t\t\t\t\tclz += IX.isEmpty(value) ? ' hidden' : '';\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'takeoutPackagingAmount':\r\n\t\t\t\t\tclz += orderSubType == 20 || orderSubType == 21 ? '' : ' hidden';\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t}\r\n\t\t\tvalue += unit;\r\n\t\t\treturn {\r\n\t\t\t\tkey : key,\r\n\t\t\t\tclz : clz,\r\n\t\t\t\tlabel : label,\r\n\t\t\t\tvalue : value\r\n\t\t\t};\r\n\t\t});\r\n\t\treturn {\r\n\t\t\tlabel : label,\r\n\t\t\tfieldType : fieldType,\r\n\t\t\tfields : _fields\r\n\t\t};\r\n\t};\r\n\tvar mapFoodsFields = function (cfg, data) {\r\n\t\tvar label = $XP(cfg, 'label', ''), fieldType = $XP(cfg, 'fieldType', ''), fields = $XP(cfg, 'fields', []);\r\n\t\tvar dishes = $XP(data, 'records', []),\r\n\t\t\tcategories = _.groupBy(dishes, function (dish) {return $XP(dish, 'foodCategoryID');});\r\n\t\tcategories = _.map(categories, function (cate, key) {\r\n\t\t\tvar foodCategoryName = '';\r\n\t\t\tvar foodCategorySum = cate.length;\r\n\t\t\tvar _dishes = _.map(cate, function (dish) {\r\n\t\t\t\tvar _dish = {};\r\n\t\t\t\t_.each(fields, function (k) {\r\n\t\t\t\t\tvar v = $XP(dish, k, ''),\r\n\t\t\t\t\t\tunit = !IX.isEmpty(OrderPayFieldLabelLib[k]) && !IX.isEmpty(OrderPayFieldLabelLib[k]['unit']) && k != \"foodAmount\" ?\r\n\t\t\t\t\t\t\tOrderPayFieldLabelLib[k]['unit'] : '';\r\n\t\t\t\t\tif (k == \"foodAmount\") {\r\n\t\t\t\t\t\tv = Hualala.Common.Math.prettyPrice(v);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (k == 'foodCategoryName') {\r\n\t\t\t\t\t\tfoodCategoryName = v;\r\n\t\t\t\t\t}\r\n\t\t\t\t\t\r\n\t\t\t\t\t_dish[k] = v + unit;\r\n\t\t\t\t});\r\n\t\t\t\treturn _dish;\r\n\t\t\t});\r\n\t\t\treturn {\r\n\t\t\t\tfoodCategoryName : foodCategoryName,\r\n\t\t\t\tfoodCategorySum : '(' + foodCategorySum + ')',\r\n\t\t\t\tfoodCategoryID : key,\r\n\t\t\t\trows : _dishes\r\n\t\t\t}\r\n\t\t});\r\n\t\t\r\n\t\treturn {\r\n\t\t\tfieldType : fieldType,\r\n\t\t\tlabel : label,\r\n\t\t\tcategories : categories\r\n\t\t};\r\n\t};\r\n\tvar OrderPayFieldLabelLib = {\r\n\t\t\"userName\" : {label : \"姓名\", clz : \"col-xs-6\"},\r\n\t\t\"userLoginMobile\" : {label : \"手机\", clz : \"col-xs-6\"},\r\n\t\t\"orderID\" : {label : \"订单号\", clz : \"col-xs-6\"},\r\n\t\t\"orderCheckPWD\" : {label : \"消费密码\", clz : \"col-xs-6\"},\r\n\t\t\"person\" : {label : \"人数\", unit : PersonUnit, clz : \"col-xs-6\"},\r\n\t\t\"timeName\" : {label : \"餐段名称\", clz : \"col-xs-6\"},\r\n\t\t\"tableName\" : {label : \"桌台号\", clz : \"col-xs-6\"},\r\n\t\t\"shopOrderKey\" : {label : \"餐饮软件凭证号\", clz : \"col-xs-6\"},\r\n\t\t\"orderTime\" : {label : \"用餐时间\", clz : \"col-xs-12\"},\r\n\t\t\"orderCreateTime\" : {label : \"下单时间\", clz : \"col-xs-12\"},\r\n\t\t\"statusName\" : {label : \"订餐状态\", clz : \"col-xs-12\"},\r\n\t\t\"takeoutAddress\" : {label : \"外送地址\", clz : \"col-xs-6\"},\r\n\t\t\"consumptionTypeName\" : {label : \"用餐类型\", clz : \"col-xs-12\"},\r\n\t\t\"promotionDesc\" : {label : \"店家促销描述\", clz : \"col-xs-12\"},\r\n\t\t\"orderRemark\" : {label : \"订单备注\", clz : \"col-xs-12\"},\r\n\t\t\"foodAmount\" : {label : \"菜品金额\", unit : CashUnit, clz : \"col-xs-6\"},\r\n\t\t\"serviceAmount\" : {label : \"服务费\", unit : CashUnit, clz : \"col-xs-6\"},\r\n\t\t\"paidAmount\" : {label : \"买单前已付金额\", unit : CashUnit, clz : \"col-xs-6\"},\r\n\t\t\"promotionTotalAmount\" : {label : \"餐饮软件优惠金额\", unit : CashUnit, clz : \"col-xs-6\"},\r\n\t\t\"discountAmount\" : {label : \"商家折免\", unit : CashUnit, clz : \"col-xs-6\"},\r\n\t\t\"freeAmount\" : {label : \"商家减免\", unit : CashUnit, clz : \"col-xs-6\"},\r\n\t\t\"giftAmount\" : {label : \"商家代金券金额\", unit : CashUnit, clz : \"col-xs-6\"},\r\n\t\t\"presentInfo\" : {label : \"赠送\", clz : \"col-xs-6\"},\r\n\t\t\"cardDiscountAmount\" : {label : \"会员卡优惠\", unit : CashUnit, clz : \"col-xs-6\"},\r\n\t\t\"pointBalance\" : {label : \"积分抵扣\", unit : CashUnit, clz : \"col-xs-6\"},\r\n\t\t\"moneyBalance\" : {label : \"会员卡余额支付\", unit : CashUnit, clz : \"col-xs-6\"},\r\n\t\t\"takeoutPackagingAmount\" : {label : \"打包费\", unit : CashUnit, clz : \"col-xs-6\"},\r\n\t\t\"orderTotal\" : {label : \"订单金额\", unit : CashUnit, clz : \"col-xs-6\"},\r\n\t\t\"orderRefundAmount\" : {label : \"退款金额\", unit : CashUnit, clz : \"col-xs-6\"},\r\n\t\t\"shopName\" : {label : \"店铺名称\", clz : \"col-xs-6\"},\r\n\t\t\"shopTel\" : {label : \"电话\", clz : \"col-xs-6\"},\r\n\t\t\"foodPrice\" : {label : \"菜品价格\", unit : CashUnit}\r\n\t};\r\n\tvar OrderPayDetailElsCfg = {\r\n\t\tuserFields : {\r\n\t\t\tlabel : \"个人信息\",\r\n\t\t\tfieldType : \"list\",\r\n\t\t\tfields : [\"userName\",\"userLoginMobile\"],\r\n\t\t\tmapFn : mapUserFields\r\n\t\t},\r\n\t\torderFields : {\r\n\t\t\tlabel : \"订单信息\",\r\n\t\t\tfieldType : \"list\",\r\n\t\t\tfields : [\"orderID\",\"orderCheckPWD\",\"person\",\"timeName\",\"tableName\",\"shopOrderKey\",\"orderTime\",\"orderCreateTime\",\r\n\t\t\t\"statusName\",\"takeoutAddress\",\"consumptionTypeName\",\"promotionDesc\",\"orderRemark\"],\r\n\t\t\tmapFn : mapOrderFields\r\n\t\t},\r\n\t\tpayFields : {\r\n\t\t\tlabel : \"支付详情\",\r\n\t\t\tfieldType : \"list\",\r\n\t\t\tfields : [\"foodAmount\",\"serviceAmount\",\"paidAmount\",\"promotionTotalAmount\",\"discountAmount\",\r\n\t\t\t\"freeAmount\",\"giftAmount\",\"presentInfo\",\"cardDiscountAmount\",\"pointBalance\",\"moneyBalance\",\"takeoutPackagingAmount\",\r\n\t\t\t\"orderTotal\",\"orderRefundAmount\",\"shopName\",\"shopTel\"],\r\n\t\t\tmapFn : mapPayFields\r\n\t\t},\r\n\t\tfoodsFields : {\r\n\t\t\tlabel : \"菜品信息\",\r\n\t\t\tfieldType : \"table\",\r\n\t\t\tfields : [\"foodCategoryName\",\"foodCategoryID\",\"foodName\",\"foodUnit\",\"foodPrice\",\"foodAmount\"],\r\n\t\t\tmapFn : mapFoodsFields\r\n\t\t}\r\n\r\n\t};\r\n\t\r\n\tvar AccountTransDetailModal = Stapes.subclass({\r\n\t\t/**\r\n\t\t * 构造\r\n\t\t * @param  {Object} cfg {triggerEl, orderKey, orderID, transType, transID}\r\n\t\t * @return {Object}\r\n\t\t */\r\n\t\tconstructor : function (cfg) {\r\n\t\t\tthis.$trigger = $XP(cfg, 'triggerEl');\r\n\t\t\tthis.orderKey = $XP(cfg, 'orderKey', '');\r\n\t\t\tthis.orderID = $XP(cfg, 'orderID', '');\r\n\t\t\tthis.transType = $XP(cfg, 'transType', '');\r\n\t\t\tthis.transID = $XP(cfg, 'transID', '');\r\n\t\t\tthis.transTypes = Hualala.TypeDef.FSMTransType;\r\n\t\t\tthis.transTypeHT = new IX.IListManager();\r\n\t\t\tthis.initTransTypeLib();\r\n\t\t\tthis.modal = null;\r\n\t\t\tthis.tplName = $XP(this.transTypeHT.get(this.transType), 'tpl', null);\r\n\t\t\tthis.callServerName = $XP(this.transTypeHT.get(this.transType), 'queryCall', null);\r\n\t\t\tthis.callServer = null;\r\n\t\t\tif (IX.isFn(this.callServerName)) {\r\n\t\t\t\tthis.callServer = this.callServerName;\r\n\t\t\t} else if (!IX.isString(this.callServerName)) {\r\n\t\t\t\tthrow(\"Configuration failed : Invalid Page Initialized for \" + this.callServerName);\r\n\t\t\t\treturn false;\r\n\t\t\t} else if (IX.nsExisted(this.callServerName)) {\r\n\t\t\t\tthis.callServer = IX.getNS(this.callServerName);\r\n\t\t\t}\r\n\t\t\tthis.queryKeys = $XP(this.transTypeHT.get(this.transType), 'queryKeys', null);\r\n\t\t\tif (!this.tplName || !this.callServer) return null;\r\n\t\t\tthis.loadTemplates();\r\n\t\t\tthis.initModal();\r\n\t\t\tthis.bindEvent();\r\n\t\t\tthis.emit('load', this.mapQueryParams());\r\n\t\t}\r\n\t});\r\n\tAccountTransDetailModal.proto({\r\n\t\tinitTransTypeLib : function () {\r\n\t\t\tvar self = this;\r\n\t\t\t_.each(this.transTypes, function (el) {\r\n\t\t\t\tvar type = $XP(el, 'value', '').toString();\r\n\t\t\t\tif (type.length > 0) {\r\n\t\t\t\t\tself.transTypeHT.register(type, el);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t},\r\n\t\tloadTemplates : function () {\r\n\t\t\tvar self = this;\r\n\t\t\tvar layoutTpl = Handlebars.compile(Hualala.TplLib.get(self.tplName)),\r\n\t\t\t\tbtnTpl = Handlebars.compile(Hualala.TplLib.get('tpl_shop_modal_btns'));\r\n\t\t\tHandlebars.registerHelper('chkFieldType', function (conditional, options) {\r\n\t\t\t\treturn (conditional == options.hash.type) ? options.fn(this) : options.inverse(this);\r\n\t\t\t});\r\n\t\t\tthis.set({\r\n\t\t\t\tlayoutTpl : layoutTpl,\r\n\t\t\t\tbtnTpl : btnTpl\r\n\t\t\t});\r\n\t\t},\r\n\t\tinitModal : function () {\r\n\t\t\tvar self = this;\r\n\t\t\tself.modal = new Hualala.UI.ModalDialog({\r\n\t\t\t\tid : 'account_trans_detail',\r\n\t\t\t\tclz : 'account-modal',\r\n\t\t\t\tsizeCls : 'modal-lg',\r\n\t\t\t\ttitle : \"结算账户交易详情\",\r\n\t\t\t\tafterRemove : function () {\r\n\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t},\r\n\t\tbindEvent : function () {\r\n\t\t\tvar self = this;\r\n\t\t\tself.on({\r\n\t\t\t\t\"load\" : function (params) {\r\n\t\t\t\t\tself.callServer(params, function (res) {\r\n\t\t\t\t\t\tif (res.resultcode == '000') {\r\n\t\t\t\t\t\t\tself.render($XP(res, 'data', null));\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\ttoptip({\r\n\t\t\t\t\t\t\t\tmsg : $XP(res, 'resultmsg', ''),\r\n\t\t\t\t\t\t\t\ttype : 'danger'\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t},\r\n\t\t\t\t\"show\" : function () {\r\n\t\t\t\t\tself.modal.show();\r\n\t\t\t\t},\r\n\t\t\t\t\"hide\" : function () {\r\n\t\t\t\t\tself.modal.hide();\r\n\t\t\t\t}\r\n\t\t\t}, this);\r\n\t\t\tself.modal._.dialog.on('click', '.btn', function (e) {\r\n\t\t\t\tvar $btn = $(this),\r\n\t\t\t\t\tact = $btn.attr('name');\r\n\t\t\t\tif (act == 'cancel') {\r\n\t\t\t\t\tself.emit('hide');\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t},\r\n\t\tmapOrderPayDetail : function (data) {\r\n\t\t\tvar self = this;\r\n\t\t\tvar fieldsets = \"userFields,orderFields,payFields,foodsFields\".split(',');\r\n\t\t\tfieldsets = _.map(fieldsets, function (key, i) {\r\n\t\t\t\tvar fieldCfg = OrderPayDetailElsCfg[key];\r\n\t\t\t\tvar mapFn = $XF(fieldCfg, 'mapFn');\r\n\t\t\t\tvar cfg = _.pick(fieldCfg, 'label', 'fieldType', 'fields');\r\n\t\t\t\t// return mapFn(cfg, $XP(data, 'data', {}));\r\n\t\t\t\treturn mapFn(cfg, data);\r\n\t\t\t});\r\n\t\t\tIX.Debug.info(\"DEBUG: Account TransDetail Modal Order Pay Detail Fieldsets : \");\r\n\t\t\tIX.Debug.info(fieldsets);\r\n\t\t\tvar orderSubType = $XP(data, 'data.orderSubType', ''),\r\n\t\t\t\torderSubTypeLabel = getOrderSubTypeLabel(orderSubType);\r\n\t\t\torderSubTypeLabel = IX.isEmpty(orderSubTypeLabel) ? '' : '(' + orderSubTypeLabel + ')';\r\n\t\t\tvar printDetail = {\r\n\t\t\t\tlabel : \"订单打印内容\",\r\n\t\t\t\torderSubTypeLabel : orderSubTypeLabel,\r\n\t\t\t\tcontent : $XP(data, 'orderPrnStr', '').replace(/\\n/g, '<br/>')\r\n\t\t\t};\r\n\r\n\t\t\treturn {\r\n\t\t\t\tfieldsets : fieldsets,\r\n\t\t\t\tprintDetail : printDetail\r\n\t\t\t};\r\n\t\t},\r\n\t\tmapFsmCustomerDetail : function (data) {\r\n\t\t\tvar self = this;\r\n\t\t\tvar settleUnitDetail = $XP(data, 'settleUnitDetail', [])[0],\r\n\t\t\t\tcustomerCard = $XP(data, 'customerCard', [])[0];\r\n\t\t\tvar transType = $XP(settleUnitDetail, 'transType'),\r\n\t\t\t\ttransTypeLabel = $XP(self.transTypeHT.get(transType), 'label', '');\r\n\t\t\tsettleUnitDetail = IX.each(settleUnitDetail, {}, function (acc, el, k) {\r\n\t\t\t\tvar cashKeys = 'transAfterBalance,transAmount,transSalesCommission';\r\n\t\t\t\tif (cashKeys.indexOf(k) >= 0) {\r\n\t\t\t\t\tacc[k] = Hualala.Common.Math.prettyNumeric(Hualala.Common.Math.prettyPrice(el));\r\n\t\t\t\t} else if (k == 'transType') {\r\n\t\t\t\t\tacc = IX.inherit(acc, {\r\n\t\t\t\t\t\ttransType : el,\r\n\t\t\t\t\t\ttransTypeLabel : $XP(self.transTypeHT.get(el), 'label', '')\r\n\t\t\t\t\t});\r\n\t\t\t\t} else {\r\n\t\t\t\t\tacc[k] = el;\r\n\t\t\t\t}\r\n\t\t\t\treturn acc;\r\n\t\t\t});\r\n\t\t\tcustomerCard = IX.each(customerCard, {}, function (acc, el, k) {\r\n\t\t\t\tvar cashKeys = 'saveCashTotal,saveMoneyTotal,moneyBalance';\r\n\t\t\t\tif (cashKeys.indexOf(k) >= 0) {\r\n\t\t\t\t\tacc[k] = Hualala.Common.Math.prettyNumeric(Hualala.Common.Math.prettyPrice(el));\r\n\t\t\t\t} else {\r\n\t\t\t\t\tacc[k] = el;\r\n\t\t\t\t}\r\n\t\t\t\treturn acc;\r\n\t\t\t});\r\n\t\t\treturn {\r\n\t\t\t\tsettleUnitDetail : IX.inherit(settleUnitDetail, {\r\n\t\t\t\t\ttransTypeLabel : transTypeLabel\r\n\t\t\t\t}),\r\n\t\t\t\tcustomerCard : customerCard\r\n\t\t\t};\r\n\t\t},\r\n\t\tmapRenderData : function (data) {\r\n\t\t\tvar self = this;\r\n\t\t\tvar type = _.last(self.callServerName.split('.'));\r\n\t\t\tvar ret = null;\r\n\t\t\tswitch(type) {\r\n\t\t\t\tcase \"queryAccountOrderPayDetail\":\r\n\t\t\t\t\tret = self.mapOrderPayDetail(data);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase \"queryAccountFsmCustomerDetail\":\r\n\t\t\t\t\tret = self.mapFsmCustomerDetail(data);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tdefault : \r\n\t\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t\treturn ret;\r\n\t\t},\r\n\t\trender : function (data) {\r\n\t\t\tvar self = this;\r\n\t\t\tvar renderData = self.mapRenderData(data),\r\n\t\t\t\tlayoutTpl = self.get('layoutTpl'),\r\n\t\t\t\tbtnTpl = self.get('btnTpl');\r\n\t\t\tvar htm = layoutTpl(renderData);\r\n\t\t\tself.modal._.body.html(htm);\r\n\t\t\tself.modal._.footer.html(btnTpl({\r\n\t\t\t\tbtns : [\r\n\t\t\t\t\t{clz : 'btn-default', name : 'cancel', label : '关闭'}\r\n\t\t\t\t]\r\n\t\t\t}));\r\n\t\t\tself.emit('show');\r\n\t\t},\r\n\t\tmapQueryParams : function () {\r\n\t\t\tvar self = this;\r\n\t\t\tvar params = {};\r\n\t\t\t_.each(self.queryKeys.split(','), function (k) {\r\n\t\t\t\tvar _k = k == 'SUA_TransItemID' ? 'transID' : k;\r\n\t\t\t\tparams[k] = self[_k]; \r\n\t\t\t});\r\n\t\t\tIX.Debug.info('DEBUG: Account TransDetail Modal Query Params:');\r\n\t\t\tIX.Debug.info(params);\r\n\t\t\treturn params;\r\n\t\t}\r\n\t});\r\n\tHualala.Account.AccountTransDetailModal = AccountTransDetailModal;\r\n\r\n\t\r\n})(jQuery, window);;(function ($, window) {\r\n\tIX.ns(\"Hualala.Account\");\r\n\tvar initAccountListPage = function () {\r\n\t\tvar $body = $('#ix_wrapper > .ix-body > .container');\r\n\t\tvar accountListPanel = new Hualala.Account.AccountListController({\r\n\t\t\tcontainer : $body,\r\n\t\t\tview : new Hualala.Account.AccountListView(),\r\n\t\t\tmodel : new Hualala.Account.AccountListModel({\r\n\t\t\t\tcallServer : Hualala.Global.queryAccount\r\n\t\t\t})\r\n\t\t});\r\n\t\taccountListPanel.emit('load', {\r\n\t\t\tpageNo : 1,\r\n\t\t\tpageSize : 15\r\n\t\t});\r\n\t};\r\n\r\n\tvar initAccountMgrPage = function () {\r\n\t\tvar ctx = Hualala.PageRoute.getPageContextByPath();\r\n\t\tvar $body = $('#ix_wrapper > .ix-body > .container');\r\n\t\tvar accountMgrCtrl = new Hualala.Account.AccountMgrController({\r\n\t\t\tcontainer : $body,\r\n\t\t\tsettleUnitID : $XP(ctx, 'params', [])[0],\r\n\t\t\taccountModel : new Hualala.Account.BaseAccountModel(),\r\n\t\t\tmgrView : new Hualala.Account.AccountMgrView(),\r\n\t\t\ttransaDetailCtrl : new Hualala.Account.TransactionDetailController()\r\n\t\t});\r\n\t\t// $body.html(\"<h1>结算账户管理页面</h1>\");\r\n\t};\r\n\r\n\tHualala.Account.AccountMgrInit = initAccountMgrPage;\r\n\t\r\n\tHualala.Account.AccountListInit = initAccountListPage;\r\n})(jQuery, window);;(function ($, window) {\r\n\tIX.ns(\"Hualala.Order\");\r\n\tvar popoverMsg = Hualala.UI.PopoverMsgTip;\r\n\tvar toptip = Hualala.UI.TopTip;\r\n\r\n\tvar OrderQueryResultModel = Stapes.subclass({\r\n\t\t/**\r\n\t\t * 构造订单查询结果的数据模型 \r\n\t\t * @param  {Object} cfg\t配置信息\r\n\t\t * \t\t@param {Function} callServer 获取数据接口\r\n\t\t * \t\t@param {Array} queryKeys 搜索条件字段序列\r\n\t\t * \t\t@param {Array} cities 城市数据\r\n\t\t * \t\t@param {Function} initQueryParams 初始化搜索条件\r\n\t\t * \t\t@param {Boolean} hasPager 是否支持分页true:支持；false：不支持.default true\r\n\t\t * @return {Object}\r\n\t\t */\r\n\t\tconstructor : function (cfg) {\r\n\t\t\tthis.callServer = $XP(cfg, 'callServer', null);\r\n\t\t\tif (!this.callServer) {\r\n\t\t\t\tthrow(\"callServer is empty!\");\r\n\t\t\t\treturn ;\r\n\t\t\t}\r\n\t\t\tthis.cities = $XP(cfg, 'cities', []);\r\n\t\t\tthis.statisticKeys = 'count,foodAmount,giftAmountTotal,orderRefundAmount,orderRegAmount,orderTotal,orderAmount,shouldSettlementTotal,total';\r\n\t\t\tthis.queryKeys = $XP(cfg, 'queryKeys', []);\r\n\t\t\tthis.pagerKeys = 'pageCount,totalSize,pageNo,pageSize'.split(',');\r\n\t\t\tthis.queryParamsKeys = null;\r\n\t\t\tthis.hasPager = $XP(cfg, 'hasPager', true);\r\n\t\t\tthis.recordModel = $XP(cfg, 'recordModel', BaseOrderRecordModel);\r\n\t\t\tvar initQueryParams = $XF(cfg, 'initQueryParams');\r\n\t\t\tinitQueryParams.apply(this);\r\n\t\t}\r\n\t});\r\n\r\n\tOrderQueryResultModel.proto({\r\n\t\tinit : function (params, cities) {\r\n\t\t\tthis.cities = cities || this.cities;\r\n\t\t\tthis.set(IX.inherit({\r\n\t\t\t\tds_record : new IX.IListManager(),\r\n\t\t\t\tds_page : new IX.IListManager(),\r\n\t\t\t\tds_statistic : new IX.IListManager(),\r\n\t\t\t}, this.hasPager ? {\r\n\t\t\t\tpageCount : 0,\r\n\t\t\t\ttotalSize : 0,\r\n\t\t\t\tpageNo : $XP(params, 'pageNo', 1),\r\n\t\t\t\tpageSize : $XP(params, 'pageSize', 15)\r\n\t\t\t} : {}));\r\n\t\t\tthis.queryParamsKeys = !this.hasPager ? this.queryKeys : this.queryKeys.concat(this.pagerKeys);\r\n\t\t},\r\n\t\tupdatePagerParams : function (params) {\r\n\t\t\tvar self = this;\r\n\t\t\tvar queryParamsKeys = self.queryParamsKeys.join(',');\r\n\t\t\t_.each(params, function (v, k, l) {\r\n\t\t\t\tif (queryParamsKeys.indexOf(k) > -1) {\r\n\t\t\t\t\tself.set(k, v);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t},\r\n\t\tgetPagerParams : function () {\r\n\t\t\tvar self = this;\r\n\t\t\tvar ret = {};\r\n\t\t\t_.each(self.queryParamsKeys, function (k) {\r\n\t\t\t\tret[k] = self.get(k);\r\n\t\t\t});\r\n\t\t\treturn ret;\r\n\t\t},\r\n\t\tupdateDataStore : function (data, pageNo) {\r\n\t\t\tvar self = this,\r\n\t\t\t\trecordHT = self.get('ds_record'),\r\n\t\t\t\tpageHT = self.get('ds_page');\r\n\t\t\tpageNo = self.hasPager ? pageNo : 1;\r\n\t\t\tvar recordIDs = _.map(data, function (r, i, l) {\r\n\t\t\t\tvar id = pageNo + '_' + IX.id(),\r\n\t\t\t\t\tmRecord = new self.recordModel(IX.inherit(r, {\r\n\t\t\t\t\t\t'__id__' : id\r\n\t\t\t\t\t}));\r\n\t\t\t\trecordHT.register(id, mRecord);\r\n\t\t\t\treturn id;\r\n\t\t\t});\r\n\t\t\tpageHT.register(pageNo, recordIDs);\r\n\t\t},\r\n\t\tupdateStatisticDataStore : function (data) {\r\n\t\t\tvar self = this,\r\n\t\t\t\tstatisticHT = self.get('ds_statistic');\r\n\t\t\t_.each(self.statisticKeys.split(','), function (k) {\r\n\t\t\t\tvar v = $XP(data, k, '');\r\n\t\t\t\tstatisticHT.register(k, v);\r\n\t\t\t});\r\n\t\t},\r\n\t\tresetDataStore : function () {\r\n\t\t\tthis.recordHT.clear();\r\n\t\t\tthis.pageHT.clear();\r\n\t\t},\r\n\t\tload : function (params, cbFn) {\r\n\t\t\tvar self = this;\r\n\t\t\tself.updatePagerParams(params);\r\n\t\t\tself.callServer(self.getPagerParams(), function (res) {\r\n\t\t\t\tif (res.resultcode == '000') {\r\n\t\t\t\t\tself.updateDataStore($XP(res, 'data.records', []), $XP(res, 'data.page.pageNo'));\r\n\t\t\t\t\tself.updatePagerParams($XP(res, 'data.page', {}));\r\n\t\t\t\t\tself.updateStatisticDataStore($XP(res, 'data', {}));\r\n\t\t\t\t} else {\r\n\t\t\t\t\ttoptip({\r\n\t\t\t\t\t\tmsg : $XP(res, 'resultmsg', ''),\r\n\t\t\t\t\t\ttype : 'danger'\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t\tcbFn(self);\r\n\t\t\t});\r\n\t\t},\r\n\t\tgetRecordsByPageNo : function (pageNo) {\r\n\t\t\tvar self = this,\r\n\t\t\t\trecordHT = self.get('ds_record'),\r\n\t\t\t\tpageHT = self.get('ds_page');\r\n\t\t\tpageNo = !self.hasPager ? 1 : pageNo;\r\n\t\t\tvar ret = _.map(recordHT.getByKeys(pageHT.get(pageNo)), function (mRecord, i, l) {\r\n\t\t\t\treturn mRecord.getAll();\r\n\t\t\t});\r\n\t\t\tIX.Debug.info(\"DEBUG: Order Query Result Model PageData\");\r\n\t\t\tIX.Debug.info(ret);\r\n\t\t\treturn ret;\r\n\t\t},\r\n\t\tgetRecordModelByID : function (id) {\r\n\t\t\tvar self = this,\r\n\t\t\t\trecordHT = self.get('ds_record');\r\n\t\t\treturn recordHT.get(id);\r\n\t\t},\r\n\t\tgetCityByCityID : function (cityID) {\r\n\t\t\tif (IX.isEmpty(cityID)) return null;\r\n\t\t\tvar l = this.cities;\r\n\t\t\tvar m = _.find(l, function (el) {\r\n\t\t\t\treturn $XP(el, 'cityID') == cityID;\r\n\t\t\t});\r\n\t\t\treturn m;\r\n\t\t},\r\n\t\tgetStatisticData : function () {\r\n\t\t\tvar self = this,\r\n\t\t\t\tstatisticHT = self.get('ds_statistic'),\r\n\t\t\t\tret = {};\r\n\t\t\t_.each(self.statisticKeys.split(','), function(k) {\r\n\t\t\t\tret[k] = statisticHT.get(k);\r\n\t\t\t});\r\n\t\t\treturn ret;\r\n\t\t}\r\n\t});\r\n\r\n\tHualala.Order.OrderQueryResultModel = OrderQueryResultModel;\r\n\r\n\t/*订单查询结果基础数据模型 */\r\n\tvar BaseOrderRecordModel = Stapes.subclass({\r\n\t\tconstructor : function (order) {\r\n\t\t\tthis.set(order);\r\n\t\t}\r\n\t});\r\n\tBaseOrderRecordModel.proto({\r\n\r\n\t});\r\n\tHualala.Order.BaseOrderRecordModel = BaseOrderRecordModel;\r\n})(jQuery, window);;(function ($, window) {\r\n\tIX.ns(\"Hualala.Order\");\r\n\tvar popoverMsg = Hualala.UI.PopoverMsgTip;\r\n\tvar toptip = Hualala.UI.TopTip;\r\n\r\n\r\n\tvar OrderQueryTableHeaderCfg = [\r\n\t\t{key : \"cityID\", clz : \"text\", label : \"城市\"},\r\n\t\t{key : \"shopName\", clz : \"text\", label : \"店铺名称\"},\r\n\t\t{key : \"orderID\", clz : \"number\", label : \"订单号\"},\r\n\t\t{key : \"userName\", clz : \"text\", label : \"客户姓名\"},\r\n\t\t{key : \"orderTime\", clz : \"date\", label : \"就餐时间\"},\r\n\t\t{key : \"orderStatus\", clz : \"status\", label : \"订单状态\"},\r\n\t\t{key : \"orderTotal\", clz : \"number\", label : \"应付金额\"},\r\n\t\t{key : \"moneyBalance\", clz : \"number\", label : \"会员卡支付\"},\r\n\t\t{key : \"pointBalance\", clz : \"number\", label : \"会员卡积分支付\"},\r\n\t\t{key : \"orderRefundAmount\", clz : \"number\", label : \"退订/退款\"},\r\n\t\t{key : \"total\", clz : \"number\", label : \"应结金额\"},\r\n\t\t{key : \"shouldSettlementTotal\", clz : \"number\", label : \"结算金额\"},\r\n\t\t{key : \"rowControl\", clz : \"\", label : \"操作\"}\r\n\t];\r\n\tvar OrderQueryDuringTableHeaderCfg = [\r\n\t\t{key : \"cityID\", clz : \"text\", label : \"城市\"},\r\n\t\t{key : \"billDate\", clz : \"date\", label : \"日期\"},\r\n\t\t{key : \"count\", clz : \"number\", label : \"订单数\"},\r\n\t\t{key : \"giftAmountTotal\", clz : \"number\", label : \"代金券总金额\"},\r\n\t\t{key : \"orderTotal\", clz : \"number\", label : \"订单支付金额\"},\r\n\t\t{key : \"orderWaitTotal\", clz : \"number\", label : \"待消费订单金额\"},\r\n\t\t{key : \"orderRegAmount\", clz : \"number\", label : \"退款金额\"},\r\n\t\t{key : \"orderRefundAmount\", clz : \"number\", label : \"退订金额\"},\r\n\t\t{key : \"total\", clz : \"number\", label : \"成交金额\"},\r\n\t\t{key : \"orderTotal\", clz : \"number\", label : \"线下金额\"},\r\n\t\t{key : \"rowControl\", clz : \"\", label : \"操作\"}\r\n\t];\r\n\r\n\tvar OrderQueryDishHotTableHeaderCfg = [\r\n\t\t{key : \"index\", clz : \"number\", label : \"序号\"},\r\n\t\t{key : \"foodName\", clz : \"text\", label : \"菜品名称\"},\r\n\t\t{key : \"foodCategoryName\", clz : \"text\", label : \"分类名称\"},\r\n\t\t{key : \"sumPrice\", clz : \"number\", label : \"平均价格\"},\r\n\t\t{key : \"sumMaster\", clz : \"number\", label : \"销售份数\"}\r\n\t];\r\n\r\n\tvar OrderQueryUserTableHeaderCfg = [\r\n\t\t{key : \"userName\", clz : \"text\", label : \"姓名\"},\r\n\t\t{key : \"userSex\", clz : \"text\", label : \"性别\"},\r\n\t\t{key : \"userLoginMobile\", clz : \"text\", label : \"手机号\"},\r\n\t\t{key : \"sumRecord\", clz : \"number\", label : \"订餐次数\"},\r\n\t\t{key : \"foodAmount\", clz : \"number\", label : \"订餐金额\"},\r\n\t\t{key : \"minOrderTime\", clz : \"date\", label : \"首次订餐时间\"},\r\n\t\t{key : \"maxOrderTime\", clz : \"date\", label : \"最近订餐时间\"}\r\n\t];\r\n\r\n\tvar mapColItemRenderData = function (row, rowIdx, colKey) {\r\n\t\tvar self = this;\r\n\t\tvar ctx = Hualala.PageRoute.getPageContextByPath(), pageName = $XP(ctx, 'name'),\r\n\t\t\tpagerParams = self.model.getPagerParams(), queryKeys = self.model.queryKeys;\r\n\t\tvar r = {value : \"\", text : \"\"}, v = $XP(row, colKey, '');\r\n\t\tswitch(colKey) {\r\n\t\t\tcase \"cityID\":\r\n\t\t\t\tv = self.getCityByCityID(v);\r\n\t\t\t\tr.value = $XP(v, 'cityID', '');\r\n\t\t\t\tr.text = $XP(v, 'cityName', '');\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"userName\":\r\n\t\t\t\tvar m = $XP(row, 'userMobile', ''),\r\n\t\t\t\t\ts = Hualala.Common.getGender($XP(row, 'userSex', ''));\r\n\t\t\t\tvar _shortName = Hualala.Common.substrByte(v, 10) + '...';\r\n\t\t\t\ts = IX.isEmpty(s) ? '' : '(' + $XP(s, 'label', '') + ')';\r\n\t\t\t\tm = IX.isEmpty(m) ? '' : '(' + m + ')';\r\n\t\t\t\tr.value = $XP(row, 'userID', '');\r\n\t\t\t\tr.text = _shortName + s + m;\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"orderTime\":\r\n\t\t\tcase \"minOrderTime\":\r\n\t\t\tcase \"maxOrderTime\":\r\n\t\t\t\tr.value = v;\r\n\t\t\t\tr.text = IX.Date.getDateByFormat(Hualala.Common.formatDateTimeValue(v), 'yyyy/MM/dd HH:mm');\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"orderStatus\":\r\n\t\t\t\tv = Hualala.Common.getOrderStatus(v);\r\n\t\t\t\tr.value = $XP(v, 'value', '');\r\n\t\t\t\tr.text = $XP(v, 'label', '');\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"billDate\":\r\n\t\t\t\tr.value = v;\r\n\t\t\t\tr.text = IX.Date.getDateByFormat(Hualala.Common.formatDateTimeValue(v), 'yyyy/MM/dd');\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"index\" :\r\n\t\t\t\tr.value = rowIdx;\r\n\t\t\t\tr.text = rowIdx + 1;\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"sumMaster\":\r\n\t\t\t\tr.value = v;\r\n\t\t\t\tr.text = v + \"&nbsp;\" + $XP(row, 'foodUnit', '');\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"sumPrice\":\r\n\t\t\t\tr.value = v || 0;\r\n\t\t\t\tr.text = Hualala.Common.Math.prettyNumeric(Hualala.Common.Math.standardPrice(Hualala.Common.Math.div(r.value, $XP(row, 'sumMaster', 1))));\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"userSex\":\r\n\t\t\t\tr.value = v;\r\n\t\t\t\tr.text = $XP(Hualala.Common.getGender($XP(row, 'userSex', '')), 'label', '');\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"total\" : \r\n\t\t\tcase \"orderTotal\":\r\n\t\t\tcase \"moneyBalance\":\r\n\t\t\tcase \"pointBalance\":\r\n\t\t\tcase \"orderRefundAmount\":\r\n\t\t\tcase \"shouldSettlementTotal\":\r\n\t\t\t\tr.value = v;\r\n\t\t\t\tr.text = Hualala.Common.Math.prettyNumeric(Hualala.Common.Math.standardPrice(v));\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"foodAmount\" :\r\n\t\t\t\tr.value = v;\r\n\t\t\t\tr.text = Hualala.Common.Math.prettyNumeric(Hualala.Common.Math.standardPrice(v));\r\n\t\t\tcase \"rowControl\" :\r\n\t\t\t\tif (pageName == 'orderQuery') {\r\n\t\t\t\t\tr = {\r\n\t\t\t\t\t\ttype : 'button',\r\n\t\t\t\t\t\tbtns : [\r\n\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\tlabel : '查看详情', \r\n\t\t\t\t\t\t\t\tlink : 'javascript:void(0);', \r\n\t\t\t\t\t\t\t\tclz : 'query-order-detail', \r\n\t\t\t\t\t\t\t\tid : $XP(row, 'orderID', ''),\r\n\t\t\t\t\t\t\t\tkey : $XP(row, 'orderKey', ''), \r\n\t\t\t\t\t\t\t\ttype : ''\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t]\r\n\t\t\t\t\t};\r\n\t\t\t\t} else if (pageName == 'orderQueryDay' || pageName == 'orderQueryDuring' ) {\r\n\t\t\t\t\tpagerParams = IX.inherit(pagerParams, {\r\n\t\t\t\t\t\tshopID : $XP(row, 'shopID', '')\r\n\t\t\t\t\t});\r\n\t\t\t\t\tif (pageName == \"orderQueryDay\") {\r\n\t\t\t\t\t\tpagerParams = IX.inherit(pagerParams, {\r\n\t\t\t\t\t\t\tstartDate : $XP(row, 'billDate', ''),\r\n\t\t\t\t\t\t\tendDate : $XP(row, 'billDate', '')\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\t\t\t\t\tvar n = pageName == \"orderQueryDuring\" ? \"orderQueryDay\" : \"orderQuery\",\r\n\t\t\t\t\t\tparams = _.map(queryKeys, function (k) {\r\n\t\t\t\t\t\t\treturn $XP(pagerParams, k, '');\r\n\t\t\t\t\t\t}),\r\n\t\t\t\t\t\tlink = '';\r\n\t\t\t\t\t\tif (n == 'orderQuery') {\r\n\t\t\t\t\t\t\tparams = params.concat(['','','','']);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tlink = Hualala.PageRoute.createPath(n, params);\r\n\t\t\t\t\tr = {\r\n\t\t\t\t\t\ttype : 'button',\r\n\t\t\t\t\t\tbtns : [\r\n\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\tlabel : '查看详情', \r\n\t\t\t\t\t\t\t\tlink : link, \r\n\t\t\t\t\t\t\t\tclz : '', \r\n\t\t\t\t\t\t\t\tid : '', \r\n\t\t\t\t\t\t\t\ttype : ''\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t]\r\n\t\t\t\t\t};\r\n\t\t\t\t}\r\n\t\t\t\tbreak;\r\n\t\t\tdefault : \r\n\t\t\t\tr.value = r.text = $XP(row, colKey, '');\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\t\treturn r;\r\n\t};\r\n\r\n\t/**\r\n\t * 格式化需要渲染的结果数据\r\n\t * @param {Array|Object} records 搜索结果数据 \r\n\t * @return {Array|Obejct}\t格式化后的渲染数据\r\n\t */\r\n\tHualala.Order.mapQueryOrderResultRenderData = function (records) {\r\n\t\tvar self = this;\r\n\t\tvar clz = \"col-md-12\",\r\n\t\t\ttblClz = \"table-bordered table-striped table-hover ix-data-report\",\r\n\t\t\ttblHeaders = OrderQueryTableHeaderCfg,\r\n\t\t\tstatisticData = self.model.getStatisticData();\r\n\t\tvar mapColsRenderData = function (row, idx) {\r\n\t\t\tvar colKeys = _.map(tblHeaders, function (el) {\r\n\t\t\t\t// return $XP(el, 'key', '');\r\n\t\t\t\treturn {key : $XP(el, 'key', ''), clz : $XP(el, 'clz', '')};\r\n\t\t\t});\r\n\t\t\t// colKeys.push('rowControl');\r\n\t\t\tvar col = {clz : '', type : 'text'};\r\n\t\t\tvar cols = _.map(colKeys, function (k, i) {\r\n\t\t\t\tvar r = mapColItemRenderData.apply(self, [row, idx, $XP(k, 'key', '')]);\r\n\t\t\t\treturn IX.inherit(col, r, {clz : $XP(k, 'clz', '')});\r\n\t\t\t});\r\n\t\t\treturn cols;\r\n\t\t};\r\n\t\tvar rows = _.map(records, function (row, idx) {\r\n\t\t\treturn {\r\n\t\t\t\tclz : '',\r\n\t\t\t\tcols : mapColsRenderData(row, idx)\r\n\t\t\t};\r\n\t\t});\r\n\t\tvar statisticKeys = 'orderTotal,orderRefundAmount,total,shouldSettlementTotal';\r\n\t\tvar ftCols = _.map(statisticKeys.split(','), function (k) {\r\n\t\t\tvar v = $XP(statisticData, k, 0), rowspan = 1, clz = '', \r\n\t\t\t\tcolspan = k == \"orderTotal\" ? 3 : 1;\r\n\r\n\t\t\treturn {\r\n\t\t\t\tclz : clz,\r\n\t\t\t\tcolspan : colspan,\r\n\t\t\t\trowspan : rowspan,\r\n\t\t\t\ttext : Hualala.Common.Math.prettyNumeric(Hualala.Common.Math.standardPrice(v)),\r\n\t\t\t\tvalue : v\r\n\t\t\t};\r\n\t\t});\r\n\t\tftCols.unshift({\r\n\t\t\tclz : 'title', colspan : '6', rowspan : '1', value : '', text : '共计：'\r\n\t\t});\r\n\t\tftCols.push({clz : '', colspan : '', rowspan : '', value : '', text : ''});\r\n\t\tvar tfoot = [{\r\n\t\t\tclz : '',\r\n\t\t\tcols : ftCols\r\n\t\t}];\r\n\t\treturn {\r\n\t\t\tclz : clz,\r\n\t\t\ttblClz : tblClz,\r\n\t\t\tisEmpty : !records || records.length == 0 ? true : false,\r\n\t\t\tcolCount : tblHeaders.length,\r\n\t\t\tthead : tblHeaders,\r\n\t\t\trows : rows,\r\n\t\t\ttfoot : tfoot\r\n\t\t};\r\n\t};\r\n\t/**\r\n\t * 格式化需要渲染的结果数据（区间汇总，日汇总 ）\r\n\t * @param  {[type]} records\r\n\t * @return {[type]}\r\n\t */\r\n\tHualala.Order.mapQueryOrderDuringRenderData = function (records) {\r\n\t\tvar self = this;\r\n\t\tvar ctx = Hualala.PageRoute.getPageContextByPath();\r\n\t\tvar pageName = $XP(ctx, 'name');\r\n\t\tvar pagerParams = self.model.getPagerParams();\r\n\t\tvar queryKeys = self.model.queryKeys;\r\n\t\tvar clz = \"col-md-12\",\r\n\t\t\ttblClz = \"table-bordered table-striped table-hover ix-data-report\",\r\n\t\t\ttblHeaders = IX.clone(OrderQueryDuringTableHeaderCfg),\r\n\t\t\tstatisticData = self.model.getStatisticData();;\r\n\t\tif (pageName == 'orderQueryDuring') {\r\n\t\t\ttblHeaders = _.map(tblHeaders, function (el) {\r\n\t\t\t\tvar key = $XP(el, 'key', '');\r\n\t\t\t\tif (key == 'billDate') {\r\n\t\t\t\t\tel = IX.inherit(el, {\r\n\t\t\t\t\t\tkey : 'shopName', label : \"店铺名称\"\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t\treturn el;\r\n\t\t\t});\r\n\t\t}\r\n\t\tvar mapColsRenderData = function (row, idx) {\r\n\t\t\tvar colKeys = _.map(tblHeaders, function (el) {\r\n\t\t\t\t// return $XP(el, 'key', '');\r\n\t\t\t\treturn _.pick(el, 'key', 'clz');\r\n\t\t\t});\r\n\t\t\t// colKeys.push('rowControl');\r\n\t\t\tvar col = {clz : '', type : 'text'};\r\n\t\t\tvar cols = _.map(colKeys, function (k, i) {\r\n\t\t\t\tvar r = mapColItemRenderData.apply(self, [row, idx, $XP(k, 'key', '')]);\r\n\t\t\t\treturn IX.inherit(col, r, {clz : $XP(k, 'clz', '')});\r\n\t\t\t});\r\n\t\t\treturn cols;\r\n\t\t};\r\n\t\tvar rows = _.map(records, function (row, idx) {\r\n\t\t\treturn {\r\n\t\t\t\tclz : '',\r\n\t\t\t\tcols : mapColsRenderData(row, idx)\r\n\t\t\t};\r\n\t\t});\r\n\t\tvar statisticKeys = 'count,giftAmountTotal,orderTotal,orderWaitTotal,orderRegAmount,orderRefundAmount,total,orderAmount';\r\n\t\tvar ftCols = _.map(statisticKeys.split(','), function (k) {\r\n\t\t\tvar v = $XP(statisticData, k, 0), rowspan = 1, clz = '', \r\n\t\t\t\tcolspan = 1;\r\n\r\n\t\t\treturn {\r\n\t\t\t\tclz : clz,\r\n\t\t\t\tcolspan : colspan,\r\n\t\t\t\trowspan : rowspan,\r\n\t\t\t\ttext : (k == 'count' ? Hualala.Common.Math.prettyNumeric(v) : Hualala.Common.Math.prettyNumeric(Hualala.Common.Math.standardPrice(v))),\r\n\t\t\t\tvalue : v\r\n\t\t\t};\r\n\t\t});\r\n\t\tftCols.unshift({\r\n\t\t\tclz : 'title', colspan : '2', rowspan : '1', value : '', text : '共计：'\r\n\t\t});\r\n\t\tftCols.push({clz : '', colspan : '', rowspan : '', value : '', text : ''});\r\n\t\tvar tfoot = [{\r\n\t\t\tclz : '',\r\n\t\t\tcols : ftCols\r\n\t\t}];\r\n\t\treturn {\r\n\t\t\tclz : clz,\r\n\t\t\tisEmpty : !records || records.length == 0 ? true : false,\r\n\t\t\tcolCount : tblHeaders.length,\r\n\t\t\ttblClz : tblClz,\r\n\t\t\tthead : tblHeaders,\r\n\t\t\trows : rows,\r\n\t\t\ttfoot : tfoot\r\n\t\t};\r\n\t};\r\n\t/**\r\n\t * 格式化菜品排行榜渲染数据\r\n\t * @param  {[type]} records\r\n\t * @return {[type]}\r\n\t */\r\n\tHualala.Order.mapQueryDishesHotRenderData = function (records) {\r\n\t\tvar self = this;\r\n\t\tvar clz = \"col-md-12\",\r\n\t\t\ttblClz = \"table-bordered table-striped table-hover ix-data-report\",\r\n\t\t\ttblHeaders = OrderQueryDishHotTableHeaderCfg;\r\n\t\tvar mapColsRenderData = function (row, idx) {\r\n\t\t\tvar colKeys = _.map(tblHeaders, function (el) {\r\n\t\t\t\t// return $XP(el, 'key', '');\r\n\t\t\t\treturn _.pick(el, 'key', 'clz');\r\n\t\t\t});\r\n\t\t\t// colKeys.push('rowControl');\r\n\t\t\tvar col = {clz : '', type : 'text'};\r\n\t\t\tvar cols = _.map(colKeys, function (k, i) {\r\n\t\t\t\tvar r = mapColItemRenderData.apply(self, [row, idx, $XP(k, 'key', '')]);\r\n\t\t\t\treturn IX.inherit(col, r, {clz : $XP(k, 'clz', '')});\r\n\t\t\t});\r\n\t\t\treturn cols;\r\n\t\t};\r\n\t\tvar rows = _.map(records, function (row, idx) {\r\n\t\t\treturn {\r\n\t\t\t\tclz : '',\r\n\t\t\t\tcols : mapColsRenderData(row, idx)\r\n\t\t\t};\r\n\t\t});\r\n\t\treturn {\r\n\t\t\tclz : clz,\r\n\t\t\ttblClz : tblClz,\r\n\t\t\tisEmpty : !records || records.length == 0 ? true : false,\r\n\t\t\tcolCount : tblHeaders.length,\r\n\t\t\tthead : tblHeaders,\r\n\t\t\trows : rows\r\n\t\t};\r\n\t};\r\n\r\n\t/**\r\n\t * 格式化用户统计排行榜渲染数据\r\n\t * @param  {[type]} records\r\n\t * @return {[type]}\r\n\t */\r\n\tHualala.Order.mapQueryUserRenderData = function (records) {\r\n\t\tvar self = this;\r\n\t\tvar clz = \"col-md-12\",\r\n\t\t\ttblClz = \"table-bordered table-striped table-hover ix-data-report\",\r\n\t\t\ttblHeaders = OrderQueryUserTableHeaderCfg;\r\n\t\tvar mapColsRenderData = function (row, idx) {\r\n\t\t\tvar colKeys = _.map(tblHeaders, function (el) {\r\n\t\t\t\t// return $XP(el, 'key', '');\r\n\t\t\t\treturn _.pick(el, 'key', 'clz');\r\n\t\t\t});\r\n\t\t\t// colKeys.push('rowControl');\r\n\t\t\tvar col = {clz : '', type : 'text'};\r\n\t\t\tvar cols = _.map(colKeys, function (k, i) {\r\n\t\t\t\tvar r = mapColItemRenderData.apply(self, [row, idx, $XP(k, 'key', '')]);\r\n\t\t\t\treturn IX.inherit(col, r, {clz : $XP(k, 'clz', '')});\r\n\t\t\t});\r\n\t\t\treturn cols;\r\n\t\t};\r\n\t\tvar rows = _.map(records, function (row, idx) {\r\n\t\t\treturn {\r\n\t\t\t\tclz : '',\r\n\t\t\t\tcols : mapColsRenderData(row, idx)\r\n\t\t\t};\r\n\t\t});\r\n\r\n\t\treturn {\r\n\t\t\tclz : clz,\r\n\t\t\ttblClz : tblClz,\r\n\t\t\tisEmpty : !records || records.length == 0 ? true : false,\r\n\t\t\tcolCount : tblHeaders.length,\r\n\t\t\tthead : tblHeaders,\r\n\t\t\trows : rows\r\n\t\t};\r\n\t};\r\n\r\n\t/**\r\n\t * 渲染结果页面\r\n\t * @param  {Array|Object} data \t需要渲染成页面的数据\r\n\t * @return {NULL}\r\n\t */\r\n\tHualala.Order.renderQueryOrderResult = function (data) {\r\n\t\tvar self = this;\r\n\t\tself.$result.empty();\r\n\t\tself.$result.html(self.get('resultTpl')(data));\r\n\t};\r\n\r\n\tvar OrderQueryResultView = Stapes.subclass({\r\n\t\t/**\r\n\t\t * 构造View层\r\n\t\t * @param  {Object} cfg\r\n\t\t * \t\t\t@param {Function} mapResultRenderData 格式化渲染数据\r\n\t\t * \t\t\t@param {Function} renderResult 渲染方法\r\n\t\t * @return {Object}\r\n\t\t */\r\n\t\tconstructor : function (cfg) {\r\n\t\t\tthis.$container = null;\r\n\t\t\tthis.$resultBox = null;\r\n\t\t\tthis.$result = null;\r\n\t\t\tthis.$pager = null;\r\n\t\t\tthis.set('mapResultRenderData', $XF(cfg, 'mapResultRenderData'));\r\n\t\t\tthis.set('renderResult', $XF(cfg, 'renderResult'));\r\n\t\t\tthis.loadTemplate();\r\n\t\t}\r\n\t});\r\n\tOrderQueryResultView.proto({\r\n\t\t/**\r\n\t\t * 初始化View层\r\n\t\t * @param  {Object} cfg\r\n\t\t * \t\t\t@param {jQueryObj} container 容器\r\n\t\t * \t\t\t@param {Object} model 搜索结果数据模型\r\n\t\t * @return \r\n\t\t */\r\n\t\tinit : function (cfg) {\r\n\t\t\tthis.$container = $XP(cfg, 'container', null);\r\n\t\t\tthis.model = $XP(cfg, 'model', null);\r\n\t\t\tif (!this.$container || !this.model) {\r\n\t\t\t\tthrow(\"Query Result View Init Faild!\");\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tthis.initLayout();\r\n\t\t},\r\n\t\tloadTemplate : function () {\r\n\t\t\tvar layoutTpl = Handlebars.compile(Hualala.TplLib.get('tpl_shop_list_layout')),\r\n\t\t\t\tresultTpl = Handlebars.compile(Hualala.TplLib.get('tpl_base_datagrid'));\r\n\t\t\tHandlebars.registerPartial(\"colBtns\", Hualala.TplLib.get('tpl_base_grid_colbtns'));\r\n\t\t\tHandlebars.registerHelper('chkColType', function (conditional, options) {\r\n\t\t\t\treturn (conditional == options.hash.type) ? options.fn(this) : options.inverse(this);\r\n\t\t\t});\r\n\t\t\tthis.set({\r\n\t\t\t\tlayoutTpl : layoutTpl,\r\n\t\t\t\tresultTpl : resultTpl\r\n\t\t\t});\r\n\t\t},\r\n\t\tinitLayout : function () {\r\n\t\t\tvar layoutTpl = this.get('layoutTpl');\r\n\t\t\tvar htm = layoutTpl();\r\n\t\t\tthis.$container.append(htm);\r\n\t\t\tthis.$resultBox = this.$container.find('.shop-list');\r\n\t\t\tthis.$result = this.$container.find('.shop-list-body');\r\n\t\t\tthis.$pager = this.$container.find('.page-selection');\r\n\t\t\tthis.initPager();\r\n\t\t\tthis.bindEvent();\r\n\t\t},\r\n\t\tinitPager : function (params) {\r\n\t\t\tvar self = this;\r\n\t\t\tif (!self.model.hasPager) return;\r\n\t\t\tvar baseCfg = {total : 0, page : 1, maxVisible : 10, leaps : true};\r\n\t\t\tthis.$pager.IXPager(IX.inherit(baseCfg, params));\r\n\t\t},\r\n\t\tbindEvent : function () {\r\n\t\t\tvar self = this;\r\n\t\t\tself.model.hasPager && self.$pager.on('page', function (e, pageNo) {\r\n\t\t\t\tvar params = self.model.getPagerParams();\r\n\t\t\t\tparams['pageNo'] = pageNo;\r\n\t\t\t\tself.model.emit('load', IX.inherit(params, {\r\n\t\t\t\t\tpageNo : $XP(params, 'pageNo', 1),\r\n\t\t\t\t\tpageSize : $XP(params, 'pageSize', 15)\r\n\t\t\t\t}));\r\n\t\t\t});\r\n\t\t\tself.$resultBox.on('click', 'a.query-order-detail', function (e) {\r\n\t\t\t\tvar $btn = $(this),\r\n\t\t\t\t\torderKey = $btn.attr('data-key'),\r\n\t\t\t\t\torderID = $btn.attr('data-id'),\r\n\t\t\t\t\ttransType = '101';\r\n\t\t\t\tvar detail = new Hualala.Account.AccountTransDetailModal({\r\n\t\t\t\t\ttriggerEl : $btn,\r\n\t\t\t\t\torderKey : orderKey,\r\n\t\t\t\t\torderID : orderID,\r\n\t\t\t\t\ttransType : transType,\r\n\t\t\t\t\ttransID : ''\r\n\t\t\t\t});\r\n\r\n\t\t\t});\r\n\t\t},\r\n\t\tmapRenderData : function (records) {\r\n\t\t\tvar mapFn = this.get('mapResultRenderData');\r\n\t\t\tvar ret = IX.isFn(mapFn) ? mapFn.apply(this, arguments) : null;\r\n\t\t\treturn ret;\r\n\t\t},\r\n\t\trenderRecords : function (data) {\r\n\t\t\tvar renderFn = this.get('renderResult');\r\n\t\t\tIX.isFn(renderFn) && renderFn.apply(this, arguments);\r\n\t\t},\r\n\t\trender : function () {\r\n\t\t\tvar self = this,\r\n\t\t\t\tmodel = self.model,\r\n\t\t\t\thasPager = model.hasPager,\r\n\t\t\t\tpagerParams = model.getPagerParams(),\r\n\t\t\t\tpageNo = $XP(pagerParams, 'pageNo', 1);\r\n\t\t\tvar records = model.getRecordsByPageNo(pageNo);\r\n\t\t\tvar renderData = self.mapRenderData(records);\r\n\t\t\tself.renderRecords(renderData);\r\n\t\t\thasPager && self.initPager({\r\n\t\t\t\ttotal : model.get('pageCount'),\r\n\t\t\t\tpage : model.get('pageNo'),\r\n\t\t\t\thref : 'javascript:void(0);'\r\n\t\t\t});\r\n\t\t},\r\n\t\tgetCityByCityID : function (cityID) {\r\n\t\t\tvar self = this;\r\n\t\t\tvar c = self.model.getCityByCityID(cityID);\r\n\t\t\treturn c;\r\n\t\t}\r\n\t});\r\n\r\n\tHualala.Order.OrderQueryResultView = OrderQueryResultView;\r\n})(jQuery, window);\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n;(function ($, window) {\r\n\tIX.ns(\"Hualala.Order\");\r\n\tvar popoverMsg = Hualala.UI.PopoverMsgTip;\r\n\tvar toptip = Hualala.UI.TopTip;\r\n\tvar LoadingModal = Hualala.UI.LoadingModal;\r\n\r\n\tvar OrderListController = Stapes.subclass({\r\n\t\t/**\r\n\t\t * 构造搜索结果控制器\r\n\t\t * @param  {Object} cfg\r\n\t\t * \t\t\t@param {Object} view View层实例\r\n\t\t * \t\t\t@param {Object} model Model层实例\r\n\t\t * \t\t\t@param {JQueryObj} container 容器\r\n\t\t * @return {[type]}\r\n\t\t */\r\n\t\tconstructor : function (cfg) {\r\n\t\t\tthis.set({\r\n\t\t\t\tsessionData : Hualala.getSessionData()\r\n\t\t\t});\r\n\t\t\tthis.container = $XP(cfg, 'container', null);\r\n\t\t\tthis.view = $XP(cfg, 'view', null);\r\n\t\t\tthis.model = $XP(cfg, 'model', null);\r\n\t\t\tif (!this.view || !this.model || !this.container) {\r\n\t\t\t\tthrow(\"Query Result init faild!\");\r\n\t\t\t}\r\n\t\t\tthis.isReady = false;\r\n\t\t\tthis.bindEvent();\r\n\t\t}\r\n\t});\r\n\tOrderListController.proto({\r\n\t\tinit : function (params) {\r\n\t\t\tthis.model.init($XP(params, 'params', {}), $XP(params, 'cities', null));\r\n\t\t\tthis.view.init({\r\n\t\t\t\tmodel : this.model,\r\n\t\t\t\tcontainer : this.container\r\n\t\t\t});\r\n\t\t\tthis.loadingModal = new LoadingModal({\r\n\t\t\t\tstart : 100\r\n\t\t\t});\r\n\t\t\tthis.isReady = true;\r\n\t\t},\r\n\t\thasReady : function () {return this.isReady;},\r\n\t\tbindEvent : function () {\r\n\t\t\tthis.on({\r\n\t\t\t\tload : function (params) {\r\n\t\t\t\t\tvar self = this;\r\n\t\t\t\t\tif (!self.hasReady()) {\r\n\t\t\t\t\t\tself.init(params);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tself.model.emit('load', $XP(params, 'params', {}));\r\n\t\t\t\t}\r\n\t\t\t}, this);\r\n\t\t\tthis.model.on({\r\n\t\t\t\tload : function (params) {\r\n\t\t\t\t\tvar self = this;\r\n\t\t\t\t\tvar cbFn = function () {\r\n\t\t\t\t\t\tself.view.emit('render');\r\n\t\t\t\t\t\tself.loadingModal.hide();\r\n\t\t\t\t\t};\r\n\t\t\t\t\tself.loadingModal.show();\r\n\t\t\t\t\tself.model.load(params, cbFn);\r\n\t\t\t\t}\r\n\t\t\t}, this);\r\n\t\t\tthis.view.on({\r\n\t\t\t\trender : function () {\r\n\t\t\t\t\tvar self = this;\r\n\t\t\t\t\tself.view.render();\r\n\t\t\t\t}\r\n\t\t\t}, this);\r\n\t\t}\r\n\t});\r\n\r\n\tHualala.Order.OrderListController = OrderListController;\r\n})(jQuery, window);;(function ($, window) {\r\n\tIX.ns(\"Hualala.Order\");\r\n\tvar popoverMsg = Hualala.UI.PopoverMsgTip;\r\n\tvar toptip = Hualala.UI.TopTip;\r\n\r\n\tHualala.Order.initQueryParams = function () {\r\n\t\tvar ctx = Hualala.PageRoute.getPageContextByPath();\r\n\t\tvar self = this;\r\n\t\tvar queryVals = $XP(ctx, 'params', []);\r\n\t\tvar queryKeys = self.queryKeys;\r\n\t\tvar params = _.object(queryKeys, queryVals);\r\n\t\tself.set(params);\r\n\t};\r\n\r\n\tvar QueryModel = Hualala.Shop.QueryModel.subclass({\r\n\t\t/**\r\n\t\t * 构造订单搜索数据模型\r\n\t\t * @param  {Object} cfg\r\n\t\t * \t\t\t@param {Array} queryKeys 搜索字段\r\n\t\t * \t\t\t@param {Function} initQueryParams 初始化搜索字段方法\r\n\t\t * \t\t\t\r\n\t\t * @return {Object}\r\n\t\t */\r\n\t\tconstructor : function (cfg) {\r\n\t\t\t// 原始数据\r\n\t\t\tthis.origCities = [];\r\n\t\t\tthis.origAreas = [];\r\n\t\t\tthis.origShops = [];\r\n\t\t\tthis.queryKeys = $XP(cfg, 'queryKeys', []);\r\n\t\t\t// 数据是否已经加载完毕\r\n\t\t\tthis.isReady = false;\r\n\t\t\tthis.callServer = Hualala.Global.getShopQuerySchema;\r\n\t\t\tvar initQueryParams = $XF(cfg, 'initQueryParams');\r\n\t\t\tinitQueryParams.apply(this);\r\n\t\t}\r\n\t});\r\n\tQueryModel.proto({\r\n\t\tgetQueryParams : function () {\r\n\t\t\tvar self = this;\r\n\t\t\tvar vals = _.map(self.queryKeys, function (k) {\r\n\t\t\t\treturn self.get(k);\r\n\t\t\t});\r\n\t\t\tvar params = _.object(self.queryKeys, vals);\r\n\t\t\tIX.Debug.info(\"DEBUG: Order Query Model Query Params :\");\r\n\t\t\tIX.Debug.info(params);\r\n\t\t\treturn params;\r\n\t\t}\r\n\t});\r\n\r\n\tHualala.Order.QueryModel = QueryModel;\r\n})(jQuery, window);;(function ($, window) {\r\n\tIX.ns(\"Hualala.Order\");\r\n\tvar popoverMsg = Hualala.UI.PopoverMsgTip;\r\n\tvar toptip = Hualala.UI.TopTip;\r\n\r\n\t/**\r\n\t * 查询条件表单元素配置信息 \r\n\t * @type {Object}\r\n\t */\r\n\tHualala.Order.QueryFormElsCfg = {\r\n\t\torderTime : {\r\n\t\t\ttype : 'section',\r\n\t\t\tlabel : '日期',\r\n\t\t\tmin : {\r\n\t\t\t\ttype : 'datetimepicker',\r\n\t\t\t\t// surfix : '<span class=\"glyphicon glyphicon-calendar\"></span>',\r\n\t\t\t\tdefaultVal : '',\r\n\t\t\t\tvalidCfg : {\r\n\t\t\t\t\tgroup : '.min-input',\r\n\t\t\t\t\tvalidators : {}\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tmax : {\r\n\t\t\t\ttype : 'datetimepicker',\r\n\t\t\t\t// surfix : '<span class=\"glyphicon glyphicon-calendar\"></span>',\r\n\t\t\t\tdefaultVal : '',\r\n\t\t\t\tvalidCfg : {\r\n\t\t\t\t\tgroup : '.max-input',\r\n\t\t\t\t\tvalidators : {}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\tcityID : {\r\n\t\t\ttype : 'combo',\r\n\t\t\tlabel : '城市',\r\n\t\t\tdefaultVal : '',\r\n\t\t\toptions : [],\r\n\t\t\tvalidCfg : {\r\n\t\t\t\tvalidators : {}\r\n\t\t\t}\r\n\t\t},\r\n\t\tshopID : {\r\n\t\t\ttype : 'combo',\r\n\t\t\tlabel : '店铺',\r\n\t\t\tdefaultVal : '',\r\n\t\t\toptions : [],\r\n\t\t\tvalidCfg : {\r\n\t\t\t\tvalidators : {}\r\n\t\t\t}\r\n\t\t},\r\n\t\torderStatus : {\r\n\t\t\ttype : 'combo',\r\n\t\t\tlabel : '状态',\r\n\t\t\tdefaultVal : '',\r\n\t\t\toptions : Hualala.TypeDef.OrderStatus,\r\n\t\t\tvalidCfg : {\r\n\t\t\t\tvalidators : {}\r\n\t\t\t}\r\n\t\t},\r\n\t\torderTotal : {\r\n\t\t\ttype : 'section',\r\n\t\t\tlabel : '金额',\r\n\t\t\tmin : {\r\n\t\t\t\ttype : 'text',\r\n\t\t\t\t// prefix : '￥',\r\n\t\t\t\t// surfix : '元',\r\n\t\t\t\tdefaultVal : '',\r\n\t\t\t\tvalidCfg : {\r\n\t\t\t\t\tvalidators : {\r\n\t\t\t\t\t\tnumeric : {\r\n\t\t\t\t\t\t\tmessage: \"金额必须为数字\"\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\tgreaterThan : {\r\n\t\t\t\t\t\t\tinclusive : true,\r\n\t\t\t\t\t\t\tvalue : 0,\r\n\t\t\t\t\t\t\tmessage : \"金额必须大于或等于0\"\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tmax : {\r\n\t\t\t\ttype : 'text',\r\n\t\t\t\t// prefix : '￥',\r\n\t\t\t\t// surfix : '元',\r\n\t\t\t\tdefaultVal : '',\r\n\t\t\t\tvalidCfg : {\r\n\t\t\t\t\tvalidators : {\r\n\t\t\t\t\t\tnumeric : {\r\n\t\t\t\t\t\t\tmessage: \"金额必须为数字\"\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\tgreaterThan : {\r\n\t\t\t\t\t\t\tinclusive : true,\r\n\t\t\t\t\t\t\tvalue : 0,\r\n\t\t\t\t\t\t\tmessage : \"金额必须大于或等于0\"\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\torderID : {\r\n\t\t\ttype : 'text',\r\n\t\t\tlabel : '订单号',\r\n\t\t\tdefaultVal : '',\r\n\t\t\tvalidCfg : {\r\n\t\t\t\tvalidators : {\r\n\t\t\t\t\tnumeric : {\r\n\t\t\t\t\t\tmessage: \"订单号必须为数字\"\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\tuserMobile : {\r\n\t\t\ttype : 'text',\r\n\t\t\tlabel : '手机号',\r\n\t\t\tdefaultVal : '',\r\n\t\t\tvalidCfg : {\r\n\t\t\t\tvalidators : {\r\n\t\t\t\t\tnumeric : {\r\n\t\t\t\t\t\tmessage: \"手机号码必须为数字\"\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\tuserLoginMobile : {\r\n\t\t\ttype : 'text',\r\n\t\t\tlabel : '手机号',\r\n\t\t\tdefaultVal : '',\r\n\t\t\tvalidCfg : {\r\n\t\t\t\tvalidators : {\r\n\t\t\t\t\tnumeric : {\r\n\t\t\t\t\t\tmessage: \"手机号码必须为数字\"\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\tfoodCategoryName : {\r\n\t\t\ttype : 'text',\r\n\t\t\tlabel : '分类名称',\r\n\t\t\tdefaultVal : '',\r\n\t\t\tvalidCfg : {\r\n\t\t\t\tvalidators : {}\r\n\t\t\t}\r\n\t\t},\r\n\t\tuserName : {\r\n\t\t\ttype : 'text',\r\n\t\t\tlabel : '订餐人',\r\n\t\t\tdefaultVal : '',\r\n\t\t\tvalidCfg : {\r\n\t\t\t\tvalidators : {}\r\n\t\t\t}\r\n\t\t},\r\n\t\tbutton : {\r\n\t\t\ttype : 'button',\r\n\t\t\tclz : 'btn btn-block btn-warning',\r\n\t\t\tlabel : '查询'\r\n\t\t}\r\n\t};\r\n\tvar QueryFormElsHT = new IX.IListManager();\r\n\t_.each(Hualala.Order.QueryFormElsCfg, function (el, k) {\r\n\t\tvar type = $XP(el, 'type');\r\n\t\tvar labelClz = 'col-xs-2 col-sm-2 col-md-4 control-label';\r\n\t\tif (type == 'section') {\r\n\t\t\tvar id = minID = k + '_min_' + IX.id(), maxID = k + '_max_' + IX.id(),\r\n\t\t\t\tminName = k == 'orderTime' ? 'startDate' : 's_orderTotal',\r\n\t\t\t\tmaxName = k == 'orderTime' ? 'endDate' : 'e_orderTotal',\r\n\t\t\t\tmin = IX.inherit($XP(el, 'min', {}), {\r\n\t\t\t\t\tid : minID, name : minName, clz : 'col-xs-5 col-sm-5 col-md-5',\r\n\t\t\t\t}), max = IX.inherit($XP(el, 'max', {}), {\r\n\t\t\t\t\tid : maxID, name : maxName, clz : 'col-xs-5 col-sm-5 col-md-5',\r\n\t\t\t\t});\r\n\t\t\tQueryFormElsHT.register(k, IX.inherit(el, {\r\n\t\t\t\tid : id,\r\n\t\t\t\tlabelClz : 'col-xs-2 col-sm-2 col-md-2 control-label',\r\n\t\t\t\tmin : min,\r\n\t\t\t\tmax : max\r\n\t\t\t}));\r\n\t\t} else {\r\n\t\t\tQueryFormElsHT.register(k, IX.inherit(el, {\r\n\t\t\t\tid : k + '_' + IX.id(),\r\n\t\t\t\tname : k,\r\n\t\t\t\tlabelClz : labelClz,\r\n\t\t\t}, $XP(el, 'type') !== 'button' ? {clz : 'col-xs-8 col-sm-8 col-md-8'} : null));\r\n\t\t}\r\n\t});\r\n\r\n\t/**\r\n\t * 格式化订单搜索页面，搜索表单数据\r\n\t * @return {Object}\r\n\t */\r\n\tHualala.Order.mapOrderQueryFormRenderData = function () {\r\n\t\tvar self = this;\r\n\t\tvar queryKeys = self.model.queryKeys;\r\n\t\t// var query = {cols : [\r\n\t\t// \t{\r\n\t\t// \t\tcolClz : 'col-md-4',\r\n\t\t// \t\titems : QueryFormElsHT.getByKeys(['orderTime', 'orderTotal'])\r\n\t\t// \t},\r\n\t\t// \t{\r\n\t\t// \t\tcolClz : 'col-md-2',\r\n\t\t// \t\titems : QueryFormElsHT.getByKeys(['cityID', 'shopID'])\r\n\t\t// \t},\r\n\t\t// \t{\r\n\t\t// \t\tcolClz : 'col-md-3',\r\n\t\t// \t\titems : QueryFormElsHT.getByKeys(['orderStatus', 'orderID'])\r\n\t\t// \t},\r\n\t\t// \t{\r\n\t\t// \t\tcolClz : 'col-md-3',\r\n\t\t// \t\titems : QueryFormElsHT.getByKeys(['userMobile'])\r\n\t\t// \t},\r\n\t\t// \t{\r\n\t\t// \t\tcolClz : 'col-md-offset-1 col-md-2',\r\n\t\t// \t\titems : QueryFormElsHT.getByKeys(['button'])\r\n\t\t// \t}\r\n\t\t// ]};\r\n\t\tvar query = {cols : [\r\n\t\t\t{\r\n\t\t\t\tcolClz : 'col-md-4',\r\n\t\t\t\titems : QueryFormElsHT.getByKeys(['orderTime', 'orderTotal'])\r\n\t\t\t},\r\n\t\t\t{\r\n\t\t\t\tcolClz : 'col-md-2',\r\n\t\t\t\titems : QueryFormElsHT.getByKeys(['cityID', 'orderStatus'])\r\n\t\t\t},\r\n\t\t\t{\r\n\t\t\t\tcolClz : 'col-md-3',\r\n\t\t\t\titems : QueryFormElsHT.getByKeys(['shopID', 'orderID'])\r\n\t\t\t},\r\n\t\t\t{\r\n\t\t\t\tcolClz : 'col-md-3',\r\n\t\t\t\titems : QueryFormElsHT.getByKeys(['userMobile'])\r\n\t\t\t},\r\n\t\t\t{\r\n\t\t\t\tcolClz : 'col-md-offset-1 col-md-2',\r\n\t\t\t\titems : QueryFormElsHT.getByKeys(['button'])\r\n\t\t\t}\r\n\t\t]};\r\n\t\treturn {\r\n\t\t\tquery : query\r\n\t\t};\r\n\t};\r\n\r\n\t/**\r\n\t * 格式化订单日汇总,期间汇总搜索页面，搜索表单数据\r\n\t * @return {Object}\r\n\t */\r\n\tHualala.Order.mapOrderQueryBaseFormRenderData = function () {\r\n\t\tvar self = this;\r\n\t\tvar queryKeys = self.model.queryKeys;\r\n\t\tvar query = {cols : [\r\n\t\t\t{\r\n\t\t\t\tcolClz : 'col-md-4',\r\n\t\t\t\titems : QueryFormElsHT.getByKeys(['orderTime'])\r\n\t\t\t},\r\n\t\t\t{\r\n\t\t\t\tcolClz : 'col-md-2',\r\n\t\t\t\titems : QueryFormElsHT.getByKeys(['cityID'])\r\n\t\t\t},\r\n\t\t\t{\r\n\t\t\t\tcolClz : 'col-md-2',\r\n\t\t\t\titems : QueryFormElsHT.getByKeys(['shopID'])\r\n\t\t\t},\r\n\t\t\t{\r\n\t\t\t\tcolClz : 'col-md-2',\r\n\t\t\t\titems : QueryFormElsHT.getByKeys(['orderStatus'])\r\n\t\t\t},\r\n\t\t\t{\r\n\t\t\t\tcolClz : 'col-md-2',\r\n\t\t\t\titems : QueryFormElsHT.getByKeys(['button'])\r\n\t\t\t}\r\n\t\t]};\r\n\t\treturn {\r\n\t\t\tquery : query\r\n\t\t};\r\n\t};\r\n\r\n\t/**\r\n\t * 格式化菜品排行榜页面搜索表单数据\r\n\t * @return {Object}\r\n\t */\r\n\tHualala.Order.mapDishesHotQueryFormRenderData = function () {\r\n\t\tvar self = this;\r\n\t\tvar queryKeys = self.model.queryKeys;\r\n\t\tvar query = {cols : [\r\n\t\t\t{\r\n\t\t\t\tcolClz : 'col-md-2',\r\n\t\t\t\titems : QueryFormElsHT.getByKeys(['cityID'])\r\n\t\t\t},\r\n\t\t\t{\r\n\t\t\t\tcolClz : 'col-md-2',\r\n\t\t\t\titems : QueryFormElsHT.getByKeys(['shopID'])\r\n\t\t\t},\r\n\t\t\t{\r\n\t\t\t\tcolClz : 'col-md-4',\r\n\t\t\t\titems : QueryFormElsHT.getByKeys(['orderTime'])\r\n\t\t\t},\r\n\t\t\t{\r\n\t\t\t\tcolClz : 'col-md-2',\r\n\t\t\t\titems : QueryFormElsHT.getByKeys(['foodCategoryName'])\r\n\t\t\t},\r\n\t\t\t{\r\n\t\t\t\tcolClz : 'col-md-2',\r\n\t\t\t\titems : QueryFormElsHT.getByKeys(['button'])\r\n\t\t\t}\r\n\t\t]};\r\n\t\treturn {\r\n\t\t\tquery : query\r\n\t\t};\r\n\t};\r\n\r\n\t/**\r\n\t * 格式化用户统计页面搜索表单数据\r\n\t * @return {Object}\r\n\t */\r\n\tHualala.Order.mapUsersQueryFormRenderData = function () {\r\n\t\tvar self = this;\r\n\t\tvar queryKeys = self.model.queryKeys;\r\n\t\tvar query = {cols : [\r\n\t\t\t{\r\n\t\t\t\tcolClz : 'col-md-3',\r\n\t\t\t\titems : QueryFormElsHT.getByKeys(['cityID'])\r\n\t\t\t},\r\n\t\t\t{\r\n\t\t\t\tcolClz : 'col-md-3',\r\n\t\t\t\titems : QueryFormElsHT.getByKeys(['shopID'])\r\n\t\t\t},\r\n\t\t\t{\r\n\t\t\t\tcolClz : 'col-md-4',\r\n\t\t\t\titems : QueryFormElsHT.getByKeys(['orderTime'])\r\n\t\t\t},\r\n\t\t\t\r\n\t\t\t{\r\n\t\t\t\tcolClz : 'col-md-3',\r\n\t\t\t\titems : QueryFormElsHT.getByKeys(['userLoginMobile'])\r\n\t\t\t},\r\n\t\t\t{\r\n\t\t\t\tcolClz : 'col-md-3',\r\n\t\t\t\titems : QueryFormElsHT.getByKeys(['userName'])\r\n\t\t\t},\r\n\t\t\t{\r\n\t\t\t\tcolClz : 'col-md-offset-4 col-md-2',\r\n\t\t\t\titems : QueryFormElsHT.getByKeys(['button'])\r\n\t\t\t}\r\n\t\t]};\r\n\t\treturn {\r\n\t\t\tquery : query\r\n\t\t};\r\n\t};\r\n\r\n\tvar QueryView = Stapes.subclass({\r\n\t\t/**\r\n\t\t * 订单报表搜索View层构造\r\n\t\t * @param  {Object} cfg\r\n\t\t * \t\t\t@param {Function} mapRenderDataFn 整理渲染搜索表单数据\r\n\t\t * @return {Object}\r\n\t\t */\r\n\t\tconstructor : function (cfg) {\r\n\t\t\tthis.isReady = false;\r\n\t\t\tthis.$container = null;\r\n\t\t\tthis.$queryBox = null;\r\n\t\t\tthis.loadTemplates();\r\n\t\t\tthis.set('mapRenderDataFn', $XF(cfg, 'mapRenderDataFn'));\r\n\t\t}\r\n\t});\r\n\r\n\tQueryView.proto({\r\n\t\tinit : function (cfg) {\r\n\t\t\tthis.model = $XP(cfg, 'model', null);\r\n\t\t\tthis.$container = $XP(cfg, 'container', null);\r\n\t\t\tif (!this.model || !this.$container || this.$container.length == 0) {\r\n\t\t\t\tthrow(\"Init Query View Failed!!\");\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tthis.renderLayout();\r\n\t\t\tthis.bindEvent();\r\n\t\t\tthis.isReady = true;\r\n\t\t\tthis.emit('query', this.getQueryParams());\r\n\t\t},\r\n\t\t// 判断是否View初始化完毕\r\n\t\thasReady : function () {return this.isReady;},\r\n\t\tloadTemplates : function () {\r\n\t\t\tvar self = this;\r\n\t\t\tvar layoutTpl = Handlebars.compile(Hualala.TplLib.get('tpl_order_queryLayout')),\r\n\t\t\t\tcomboOptsTpl = Handlebars.compile(Hualala.TplLib.get('tpl_order_comboOpts'));\r\n\t\t\tHandlebars.registerPartial(\"orderQueryForm\", Hualala.TplLib.get('tpl_order_queryForm'));\r\n\t\t\tHandlebars.registerHelper('checkFormElementType', function (conditional, options) {\r\n\t\t\t\treturn (conditional == options.hash.type) ? options.fn(this) : options.inverse(this);\r\n\t\t\t});\r\n\t\t\tHandlebars.registerHelper('isInputGroup', function (prefix, surfix, options) {\r\n\t\t\t\treturn (!prefix && !surfix) ? options.inverse(this) : options.fn(this);\r\n\t\t\t});\r\n\t\t\tthis.set({\r\n\t\t\t\tlayoutTpl : layoutTpl,\r\n\t\t\t\tcomboOptsTpl : comboOptsTpl\r\n\t\t\t});\r\n\t\t},\r\n\t\tinitQueryFormEls : function () {\r\n\t\t\tvar self = this,\r\n\t\t\t\tels = self.model.getQueryParams(),\r\n\t\t\t\tcityID = $XP(els, 'cityID', ''),\r\n\t\t\t\tshopID = $XP(els, 'shopID', '');\r\n\t\t\tself.initCityComboOpts(cityID);\r\n\t\t\tself.initShopComboOpts(cityID, shopID);\r\n\t\t\t_.each(els, function (v, k) {\r\n\t\t\t\tif (k == 'startDate' || k == 'endDate') {\r\n\t\t\t\t\tv = IX.isEmpty(v) ? '' : IX.Date.getDateByFormat(Hualala.Common.formatDateTimeValue(v), 'yyyy/MM/dd');\r\n\t\t\t\t}\r\n\t\t\t\tself.$queryBox.find('[name=' + k + ']').val(v);\r\n\t\t\t});\r\n\t\t},\r\n\t\tinitChosenPanel : function (_cfg) {\r\n\t\t\tvar self = this,\r\n\t\t\t\tmatcher = (new Pymatch([])),\r\n\t\t\t\tsections = $XP(_cfg, 'sectionsData'),\r\n\t\t\t\t$target = $XP(_cfg, '$target'),\r\n\t\t\t\tchosenPanelCfg = $XP(_cfg, 'chosenPanelCfg', {}),\r\n\t\t\t\tchangeFn = $XF(_cfg, 'changeFn');\r\n\t\t\tvar getMatchedFn = function (searchText) {\r\n\t\t\t\tmatcher.setNames(_.map(sections, function (el) {\r\n\t\t\t\t\treturn IX.inherit(el, {\r\n\t\t\t\t\t\tname : el.label,\r\n\t\t\t\t\t\tpy : el.py\r\n\t\t\t\t\t});\r\n\t\t\t\t}));\r\n\t\t\t\tvar matchedSections = matcher.match(searchText);\r\n\t\t\t\tvar matchedOptions = {};\r\n\t\t\t\t_.each(matchedSections, function (el, i) {\r\n\t\t\t\t\tmatchedOptions[el[0].value] = true;\r\n\t\t\t\t});\r\n\t\t\t\treturn matchedOptions;\r\n\t\t\t};\r\n\t\t\tvar chosen = $target.data('chosen');\r\n\t\t\tchosen && chosen.destroy();\r\n\t\t\t$target.chosen(IX.inherit({\r\n\t\t\t\twidth : '200px',\r\n\t\t\t\tplaceholder_text : \"请选择\",\r\n\t\t\t\tno_results_text : \"抱歉，没有找到！\",\r\n\t\t\t\tallow_single_deselect : true\r\n\t\t\t}, chosenPanelCfg, {\r\n\t\t\t\tgetMatchedFn : getMatchedFn\r\n\t\t\t})).change(function (e) {\r\n\t\t\t\tchangeFn.apply(this, e);\r\n\t\t\t});\r\n\t\t},\r\n\t\tinitCityComboOpts : function (curCityID) {\r\n\t\t\tvar self = this,\r\n\t\t\t\tcities = self.model.getCities();\r\n\t\t\tif (IX.isEmpty(cities)) return ;\r\n\t\t\tcities = _.map(cities, function (city) {\r\n\t\t\t\tvar id = $XP(city, 'cityID', ''), name = $XP(city, 'cityName', '');\r\n\t\t\t\treturn {\r\n\t\t\t\t\tvalue : id,\r\n\t\t\t\t\tlabel : name,\r\n\t\t\t\t\tselected : id == curCityID ? 'selected' : '',\r\n\t\t\t\t\tpy : $XP(city, 'py', '')\r\n\t\t\t\t};\r\n\t\t\t});\r\n\t\t\tcities.unshift({\r\n\t\t\t\tvalue : '',\r\n\t\t\t\tlabel : '全部',\r\n\t\t\t\tselected : IX.isEmpty(curCityID) ? 'selected' : '',\r\n\t\t\t\tpy : 'quan;bu'\r\n\t\t\t});\r\n\t\t\tvar optTpl = self.get('comboOptsTpl'),\r\n\t\t\t\thtm = optTpl({\r\n\t\t\t\t\topts : cities\r\n\t\t\t\t}),\r\n\t\t\t\t$select = self.$queryBox.find('select[name=cityID]');\r\n\t\t\t$select.html(htm);\r\n\r\n\t\t\tself.initChosenPanel({\r\n\t\t\t\tchosenPanelCfg : {\r\n\t\t\t\t\twidth : $select.parent().width() + 'px',\r\n\t\t\t\t\tplaceholder_text : \"请选择城市\"\r\n\t\t\t\t},\r\n\t\t\t\tsectionsData : cities,\r\n\t\t\t\t$target : $select,\r\n\t\t\t\tchangeFn : function (e) {\r\n\t\t\t\t\tvar $this = $(this);\r\n\t\t\t\t\tself.chosenCityID = $this.val();\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t},\r\n\t\tinitShopComboOpts : function (curCityID, curShopID) {\r\n\t\t\tvar self = this,\r\n\t\t\t\tshops = IX.isEmpty(curCityID) ? self.model.getShops() : self.model.getShopsByCityID(curCityID);\r\n\t\t\tif (IX.isEmpty(shops)) return;\r\n\t\t\tshops = _.map(shops, function (shop) {\r\n\t\t\t\tvar id = $XP(shop, 'shopID', ''), name = $XP(shop, 'shopName', '');\r\n\t\t\t\treturn {\r\n\t\t\t\t\tvalue : id,\r\n\t\t\t\t\tlabel : name,\r\n\t\t\t\t\tselected : id == curShopID ? 'selected' : '',\r\n\t\t\t\t\tpy : $XP(shop, 'py', '')\r\n\t\t\t\t};\r\n\t\t\t});\r\n\t\t\tshops.unshift({\r\n\t\t\t\tvalue : '',\r\n\t\t\t\tlabel : '全部',\r\n\t\t\t\tselected : IX.isEmpty(curShopID) ? 'selected' : '',\r\n\t\t\t\tpy : 'quan;bu'\r\n\t\t\t});\r\n\t\t\tvar optTpl = self.get('comboOptsTpl'),\r\n\t\t\t\thtm = optTpl({\r\n\t\t\t\t\topts : shops\r\n\t\t\t\t}),\r\n\t\t\t\t$select = self.$queryBox.find('select[name=shopID]');\r\n\t\t\t$select.html(htm);\r\n\r\n\t\t\tself.initChosenPanel({\r\n\t\t\t\tchosenPanelCfg : {\r\n\t\t\t\t\twidth : $select.parent().width() + 'px',\r\n\t\t\t\t\tplaceholder_text : \"请选择店铺\"\r\n\t\t\t\t},\r\n\t\t\t\tsectionsData : shops,\r\n\t\t\t\t$target : $select,\r\n\t\t\t\tchangeFn : function (e) {\r\n\t\t\t\t\tvar $this = $(this);\r\n\t\t\t\t\tself.chosenCityID = $this.val();\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t},\r\n\t\tinitQueryEls : function () {\r\n\t\t\tvar self = this;\r\n\t\t\tself.$queryBox.find('[data-type=datetimepicker]').datetimepicker({\r\n\t\t\t\tformat : 'yyyy/mm/dd',\r\n\t\t\t\tstartDate : '2010/01/01',\r\n\t\t\t\tautoclose : true,\r\n\t\t\t\tminView : 'month',\r\n\t\t\t\ttodayBtn : true,\r\n\t\t\t\ttodayHighlight : true,\r\n\t\t\t\tlanguage : 'zh-CN'\r\n\t\t\t});\r\n\t\t\tself.$queryBox.on('click', '.input-group-addon', function (e) {\r\n\t\t\t\tvar $this = $(this),\r\n\t\t\t\t\t$picker = $this.prev(':text[data-type=datetimepicker]');\r\n\t\t\t\tif ($picker.length > 0) {\r\n\t\t\t\t\t$picker.datetimepicker('show');\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t},\r\n\t\tmapRenderLayoutData : function () {\r\n\t\t\tvar mapFn = this.get('mapRenderDataFn');\r\n\t\t\treturn IX.isFn(mapFn) && mapFn.apply(this);\r\n\t\t},\r\n\t\trenderLayout : function () {\r\n\t\t\tvar self = this,\r\n\t\t\t\tlayoutTpl = self.get('layoutTpl'),\r\n\t\t\t\tmodel = self.model;\r\n\t\t\tvar renderData = self.mapRenderLayoutData();\r\n\t\t\tvar html = layoutTpl(renderData);\r\n\t\t\tself.$queryBox = $(html);\r\n\t\t\tself.$container.html(self.$queryBox);\r\n\t\t\tself.initQueryFormEls();\r\n\t\t\tself.initQueryEls();\r\n\t\t},\r\n\t\tbindEvent : function () {\r\n\t\t\tvar self = this;\r\n\t\t\tself.$queryBox.on('change', 'select', function (e) {\r\n\t\t\t\tvar $this = $(this),\r\n\t\t\t\t\tv = $this.val();\r\n\t\t\t\tself.initShopComboOpts(v, '');\r\n\t\t\t});\r\n\t\t\tself.$queryBox.on('click', '.btn.btn-warning', function (e) {\r\n\t\t\t\tvar $this = $(this);\r\n\t\t\t\tself.emit('query', self.getQueryParams());\r\n\t\t\t});\r\n\t\t},\r\n\t\tgetQueryParams : function () {\r\n\t\t\tvar self = this,\r\n\t\t\t\tkeys = self.model.queryKeys,\r\n\t\t\t\t$form = self.$queryBox.find('form'),\r\n\t\t\t\tels = $form.serializeArray();\r\n\t\t\tels = _.map(els, function (el) {\r\n\t\t\t\tvar n = $XP(el, 'name'), v = $XP(el, 'value', '');\r\n\t\t\t\tif (n == 'startDate' || n == 'endDate') {\r\n\t\t\t\t\tv = IX.isEmpty(v) ? '' : IX.Date.getDateByFormat(v, 'yyyyMMdd');\r\n\t\t\t\t\treturn {\r\n\t\t\t\t\t\tname : n,\r\n\t\t\t\t\t\tvalue : v\r\n\t\t\t\t\t};\r\n\t\t\t\t}\r\n\t\t\t\treturn el;\r\n\t\t\t});\r\n\t\t\tels = _.object(_.pluck(els, 'name'), _.pluck(els, 'value'));\r\n\t\t\tself.model.set(els);\r\n\t\t\treturn els;\r\n\t\t}\r\n\r\n\t});\r\n\r\n\tHualala.Order.QueryView = QueryView;\r\n})(jQuery, window);;(function ($, window) {\r\n\tIX.ns(\"Hualala.Order\");\r\n\tvar popoverMsg = Hualala.UI.PopoverMsgTip;\r\n\tvar toptip = Hualala.UI.TopTip;\r\n\t\r\n\tvar QueryController = Hualala.Shop.QueryController.subclass({\r\n\t\t/**\r\n\t\t * 订单报表查询控制器\r\n\t\t * @param  {Object} cfg \r\n\t\t * \t\t\t@param {JQueryObj} container 容器\r\n\t\t * \t\t\t@param {Object} resultController 结果输出控制器\r\n\t\t * \t\t\t@param {Object} model 查询数据模型\r\n\t\t * \t\t\t@param {Object} view 查询界面模型\r\n\t\t * @return {Object}\t查询控制模块实例\r\n\t\t */\r\n\t\tconstructor : function (cfg) {\r\n\t\t\tthis.set({\r\n\t\t\t\tsessionData : Hualala.getSessionData()\r\n\t\t\t});\r\n\t\t\tthis.container = $XP(cfg, 'container', null);\r\n\t\t\tthis.resultController = $XP(cfg, 'resultController', null);\r\n\t\t\tthis.model = $XP(cfg, 'model', null);\r\n\t\t\tthis.view = $XP(cfg, 'view', null);\r\n\t\t\tif (!this.container || !this.model || !this.view || !this.resultController) {\r\n\t\t\t\tthrow(\"QueryController init faild!\");\r\n\t\t\t}\r\n\t\t\tthis.init();\r\n\t\t}\r\n\t});\r\n\tQueryController.proto({\r\n\t\t// 绑定事件\r\n\t\tbindEvent : function () {\r\n\t\t\t// 控制器的事件绑定\r\n\t\t\tthis.on({\r\n\t\t\t\treload : function () {\r\n\t\t\t\t\tvar self = this;\r\n\t\t\t\t\tself.model.distory();\r\n\t\t\t\t\tself.view.distory();\r\n\t\t\t\t\tself.init();\r\n\t\t\t\t},\r\n\t\t\t\tquery : function (params) {\r\n\t\t\t\t\tvar self = this;\r\n\t\t\t\t\tvar cities = self.model.getCities();\r\n\t\t\t\t\tIX.Debug.info('DEBUG: Order Query Controller Query Params:');\r\n\t\t\t\t\tIX.Debug.info(params);\r\n\t\t\t\t\tself.resultController && self.resultController.emit('load', {\r\n\t\t\t\t\t\tparams : IX.inherit(params, {\r\n\t\t\t\t\t\t\tpageNo : 1,\r\n\t\t\t\t\t\t\tpageSize : 15\r\n\t\t\t\t\t\t}),\r\n\t\t\t\t\t\tcities : cities\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t}, this);\r\n\t\t\t// 模型的事件绑定\r\n\t\t\tthis.model.on({\r\n\t\t\t\tload : function (cbFn) {\r\n\t\t\t\t\tvar self = this,\r\n\t\t\t\t\t\tparams = $XP(self.get('sessionData'), 'user', {});\r\n\t\t\t\t\tself.model.init(params, cbFn);\r\n\t\t\t\t}\r\n\t\t\t}, this);\r\n\t\t\t// 视图事件绑定\r\n\t\t\tthis.view.on({\r\n\t\t\t\tinit : function () {\r\n\t\t\t\t\tvar self = this;\r\n\t\t\t\t\tself.view.init({\r\n\t\t\t\t\t\tmodel : self.model,\r\n\t\t\t\t\t\tneedShopCreate : self.needShopCreate,\r\n\t\t\t\t\t\tcontainer : self.container\r\n\t\t\t\t\t});\r\n\t\t\t\t},\r\n\t\t\t\t// 过滤操作，触发显示结果\r\n\t\t\t\tfilter : function (params) {\r\n\t\t\t\t\tvar self = this;\r\n\t\t\t\t\tself.emit('query', params);\r\n\t\t\t\t\t//TODO 重置Query的chosenPanel\r\n\t\t\t\t},\r\n\t\t\t\t// 搜索操作，触发显示结果\r\n\t\t\t\tquery : function (params) {\r\n\t\t\t\t\tvar self = this;\r\n\t\t\t\t\tself.emit('query', params);\r\n\t\t\t\t}\r\n\t\t\t}, this);\r\n\t\t}\r\n\t});\r\n\tHualala.Order.QueryController = QueryController;\r\n})(jQuery, window);;(function ($, window) {\r\n\tIX.ns(\"Hualala.Order\");\r\n\t/*订单模块子页面布局*/\r\n\tvar initOrderPageLayout = function () {\r\n\t\tvar ctx = Hualala.PageRoute.getPageContextByPath();\r\n\t\tvar $body = $('#ix_wrapper > .ix-body > .container');\r\n\t\t$body.empty();\r\n\t\tvar mapNavRenderData = function () {\r\n\t\t\tvar curDateStamp = IX.Date.getDateByFormat(new Hualala.Date((new Date()).getTime() / 1000).toText(), 'yyyyMMdd');\r\n\t\t\tvar navs = _.map(Hualala.TypeDef.OrderSubNavType, function (v, i, list) {\r\n\t\t\t\tvar params = _.map($XP(v, 'pkeys', []), function (v) {\r\n\t\t\t\t\tif (v == 'startDate' || v == 'endDate') {\r\n\t\t\t\t\t\treturn curDateStamp;\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn '';\r\n\t\t\t\t});\r\n\r\n\t\t\t\treturn {\r\n\t\t\t\t\tactive : $XP(ctx, 'name') == v.name ? 'active' : '',\r\n\t\t\t\t\tdisabled : '',\r\n\t\t\t\t\tpath : Hualala.PageRoute.createPath(v.name, params) || '#',\r\n\t\t\t\t\tname : v.name,\r\n\t\t\t\t\tlabel : v.label,\r\n\t\t\t\t};\r\n\t\t\t});\r\n\t\t\treturn {\r\n\t\t\t\ttoggle : {\r\n\t\t\t\t\ttarget : '#order_navbar'\r\n\t\t\t\t},\r\n\t\t\t\titems : navs\r\n\t\t\t};\r\n\t\t};\r\n\t\tvar navTpl = Handlebars.compile(Hualala.TplLib.get('tpl_order_subnav'));\r\n\t\tHandlebars.registerPartial(\"toggle\", Hualala.TplLib.get('tpl_site_navbarToggle'));\r\n\t\t$body.html('<div class=\"order-subnav clearfix\" /><div class=\"order-body\" ><div class=\"order-query-box\"></div><div class=\"order-result-box\"></div></div>');\r\n\t\tvar $navbar = $body.find('.order-subnav'),\r\n\t\t\t$pageBody = $body.find('.order-body');\r\n\t\t$navbar.html(navTpl(mapNavRenderData()));\r\n\t};\r\n\t/*订单报表概览页面*/\r\n\tvar initOrderChartPage = function () {\r\n\t\tvar ctx = Hualala.PageRoute.getPageContextByPath();\r\n\t\tvar $body = $('#ix_wrapper > .ix-body > .container');\r\n\t\tinitOrderPageLayout();\r\n\t\t// Note: 暂时屏蔽概览页面，第二版将开启\r\n\t\tvar curDateStamp = IX.Date.getDateByFormat(new Hualala.Date((new Date()).getTime() / 1000).toText(), 'yyyyMMdd');\r\n\t\tvar pageCfg = _.find(Hualala.TypeDef.OrderSubNavType, function (el) {return el.name == 'orderQuery'}),\r\n\t\t\tpkeys = $XP(pageCfg, 'pkeys', []);\r\n\t\tpkeys = _.map(pkeys, function (v) {\r\n\t\t\tif (v == 'startDate' || v == 'endDate') {\r\n\t\t\t\treturn curDateStamp;\r\n\t\t\t}\r\n\t\t\treturn '';\r\n\t\t});\r\n\t\tdocument.location.href = Hualala.PageRoute.createPath('orderQuery', pkeys);\r\n\t};\r\n\t/*订单查询页面*/\r\n\tvar initQueryOrderPage = function () {\r\n\t\tvar ctx = Hualala.PageRoute.getPageContextByPath();\r\n\t\tvar $body = $('#ix_wrapper > .ix-body > .container');\r\n\t\tinitOrderPageLayout();\r\n\t\tvar $pageBody = $body.find('.order-body');\r\n\t\tvar queryKeys = $XP(_.findWhere(Hualala.TypeDef.OrderSubNavType, {name : $XP(ctx, 'name')}), 'pkeys');\r\n\t\tvar queryPanel = new Hualala.Order.QueryController({\r\n\t\t\tcontainer : $pageBody,\r\n\t\t\tresultController : new Hualala.Order.OrderListController({\r\n\t\t\t\tcontainer : $pageBody,\r\n\t\t\t\tmodel : new Hualala.Order.OrderQueryResultModel({\r\n\t\t\t\t\tcallServer : Hualala.Global.queryOrderDetail,\r\n\t\t\t\t\tqueryKeys : queryKeys,\r\n\t\t\t\t\tinitQueryParams : Hualala.Order.initQueryParams\r\n\t\t\t\t}),\r\n\t\t\t\tview : new Hualala.Order.OrderQueryResultView({\r\n\t\t\t\t\tmapResultRenderData : Hualala.Order.mapQueryOrderResultRenderData,\r\n\t\t\t\t\trenderResult : Hualala.Order.renderQueryOrderResult\r\n\t\t\t\t})\r\n\t\t\t}),\r\n\t\t\tmodel : new Hualala.Order.QueryModel({\r\n\t\t\t\tqueryKeys : queryKeys,\r\n\t\t\t\tinitQueryParams : Hualala.Order.initQueryParams\r\n\t\t\t}),\r\n\t\t\tview : new Hualala.Order.QueryView({\r\n\t\t\t\tmapRenderDataFn : Hualala.Order.mapOrderQueryFormRenderData\r\n\t\t\t})\r\n\t\t});\r\n\t};\r\n\t/*订单日汇总页面*/\r\n\tvar initQueryOrderDayDetailPage = function () {\r\n\t\tvar ctx = Hualala.PageRoute.getPageContextByPath();\r\n\t\tvar $body = $('#ix_wrapper > .ix-body > .container');\r\n\t\tinitOrderPageLayout();\r\n\t\tvar $pageBody = $body.find('.order-body');\r\n\t\tvar queryKeys = $XP(_.findWhere(Hualala.TypeDef.OrderSubNavType, {name : $XP(ctx, 'name')}), 'pkeys');\r\n\t\tvar queryPanel = new Hualala.Order.QueryController({\r\n\t\t\tcontainer : $pageBody,\r\n\t\t\tresultController : new Hualala.Order.OrderListController({\r\n\t\t\t\tcontainer : $pageBody,\r\n\t\t\t\tmodel : new Hualala.Order.OrderQueryResultModel({\r\n\t\t\t\t\tcallServer : Hualala.Global.queryOrderDayDetail,\r\n\t\t\t\t\tqueryKeys : queryKeys,\r\n\t\t\t\t\tinitQueryParams : Hualala.Order.initQueryParams\r\n\t\t\t\t}),\r\n\t\t\t\tview : new Hualala.Order.OrderQueryResultView({\r\n\t\t\t\t\tmapResultRenderData : Hualala.Order.mapQueryOrderDuringRenderData,\r\n\t\t\t\t\trenderResult : Hualala.Order.renderQueryOrderResult\r\n\t\t\t\t})\r\n\t\t\t}),\r\n\t\t\tmodel : new Hualala.Order.QueryModel({\r\n\t\t\t\tqueryKeys : queryKeys,\r\n\t\t\t\tinitQueryParams : Hualala.Order.initQueryParams\r\n\t\t\t}),\r\n\t\t\tview : new Hualala.Order.QueryView({\r\n\t\t\t\tmapRenderDataFn : Hualala.Order.mapOrderQueryBaseFormRenderData\r\n\t\t\t})\r\n\t\t});\r\n\t};\r\n\t/*订单期间汇总页面*/\r\n\tvar initQueryOrderDuringDetailPage = function () {\r\n\t\tvar ctx = Hualala.PageRoute.getPageContextByPath();\r\n\t\tvar $body = $('#ix_wrapper > .ix-body > .container');\r\n\t\tinitOrderPageLayout();\r\n\t\tvar $pageBody = $body.find('.order-body');\r\n\t\tvar queryKeys = $XP(_.findWhere(Hualala.TypeDef.OrderSubNavType, {name : $XP(ctx, 'name')}), 'pkeys');\r\n\t\tvar queryPanel = new Hualala.Order.QueryController({\r\n\t\t\tcontainer : $pageBody,\r\n\t\t\tresultController : new Hualala.Order.OrderListController({\r\n\t\t\t\tcontainer : $pageBody,\r\n\t\t\t\tmodel : new Hualala.Order.OrderQueryResultModel({\r\n\t\t\t\t\tcallServer : Hualala.Global.queryOrderDuringDetail,\r\n\t\t\t\t\tqueryKeys : queryKeys,\r\n\t\t\t\t\tinitQueryParams : Hualala.Order.initQueryParams\r\n\t\t\t\t}),\r\n\t\t\t\tview : new Hualala.Order.OrderQueryResultView({\r\n\t\t\t\t\tmapResultRenderData : Hualala.Order.mapQueryOrderDuringRenderData,\r\n\t\t\t\t\trenderResult : Hualala.Order.renderQueryOrderResult\r\n\t\t\t\t})\r\n\t\t\t}),\r\n\t\t\tmodel : new Hualala.Order.QueryModel({\r\n\t\t\t\tqueryKeys : queryKeys,\r\n\t\t\t\tinitQueryParams : Hualala.Order.initQueryParams\r\n\t\t\t}),\r\n\t\t\tview : new Hualala.Order.QueryView({\r\n\t\t\t\tmapRenderDataFn : Hualala.Order.mapOrderQueryBaseFormRenderData\r\n\t\t\t})\r\n\t\t});\r\n\t};\r\n\t/*菜品销售排行页面*/\r\n\tvar initQueryOrderDishesHotPage = function () {\r\n\t\tvar ctx = Hualala.PageRoute.getPageContextByPath();\r\n\t\tvar $body = $('#ix_wrapper > .ix-body > .container');\r\n\t\tinitOrderPageLayout();\r\n\t\tvar $pageBody = $body.find('.order-body');\r\n\t\tvar queryKeys = $XP(_.findWhere(Hualala.TypeDef.OrderSubNavType, {name : $XP(ctx, 'name')}), 'pkeys');\r\n\t\tvar queryPanel = new Hualala.Order.QueryController({\r\n\t\t\tcontainer : $pageBody,\r\n\t\t\tresultController : new Hualala.Order.OrderListController({\r\n\t\t\t\tcontainer : $pageBody,\r\n\t\t\t\tmodel : new Hualala.Order.OrderQueryResultModel({\r\n\t\t\t\t\thasPager : false,\r\n\t\t\t\t\tcallServer : Hualala.Global.queryOrderDishesHot,\r\n\t\t\t\t\tqueryKeys : queryKeys,\r\n\t\t\t\t\tinitQueryParams : Hualala.Order.initQueryParams\r\n\t\t\t\t}),\r\n\t\t\t\tview : new Hualala.Order.OrderQueryResultView({\r\n\t\t\t\t\tmapResultRenderData : Hualala.Order.mapQueryDishesHotRenderData,\r\n\t\t\t\t\trenderResult : Hualala.Order.renderQueryOrderResult\r\n\t\t\t\t})\r\n\t\t\t}),\r\n\t\t\tmodel : new Hualala.Order.QueryModel({\r\n\t\t\t\tqueryKeys : queryKeys,\r\n\t\t\t\tinitQueryParams : Hualala.Order.initQueryParams\r\n\t\t\t}),\r\n\t\t\tview : new Hualala.Order.QueryView({\r\n\t\t\t\tmapRenderDataFn : Hualala.Order.mapDishesHotQueryFormRenderData\r\n\t\t\t})\r\n\t\t});\r\n\t};\r\n\t/*顾客统计页面*/\r\n\tvar initQueryOrderCustomerPage = function () {\r\n\t\tvar ctx = Hualala.PageRoute.getPageContextByPath();\r\n\t\tvar $body = $('#ix_wrapper > .ix-body > .container');\r\n\t\tinitOrderPageLayout();\r\n\t\tvar $pageBody = $body.find('.order-body');\r\n\t\tvar queryKeys = $XP(_.findWhere(Hualala.TypeDef.OrderSubNavType, {name : $XP(ctx, 'name')}), 'pkeys');\r\n\t\tvar queryPanel = new Hualala.Order.QueryController({\r\n\t\t\tcontainer : $pageBody,\r\n\t\t\tresultController : new Hualala.Order.OrderListController({\r\n\t\t\t\tcontainer : $pageBody,\r\n\t\t\t\tmodel : new Hualala.Order.OrderQueryResultModel({\r\n\t\t\t\t\thasPager : false,\r\n\t\t\t\t\tcallServer : Hualala.Global.queryUserOrderStatistic,\r\n\t\t\t\t\tqueryKeys : queryKeys,\r\n\t\t\t\t\tinitQueryParams : Hualala.Order.initQueryParams\r\n\t\t\t\t}),\r\n\t\t\t\tview : new Hualala.Order.OrderQueryResultView({\r\n\t\t\t\t\tmapResultRenderData : Hualala.Order.mapQueryUserRenderData,\r\n\t\t\t\t\trenderResult : Hualala.Order.renderQueryOrderResult\r\n\t\t\t\t}) \r\n\t\t\t}),\r\n\t\t\tmodel : new Hualala.Order.QueryModel({\r\n\t\t\t\tqueryKeys : queryKeys,\r\n\t\t\t\tinitQueryParams : Hualala.Order.initQueryParams\r\n\t\t\t}),\r\n\t\t\tview : new Hualala.Order.QueryView({\r\n\t\t\t\tmapRenderDataFn : Hualala.Order.mapUsersQueryFormRenderData\r\n\t\t\t})\r\n\t\t});\r\n\t};\r\n\r\n\r\n\tHualala.Order.OrderPageLayoutInit = initOrderPageLayout;\r\n\tHualala.Order.OrderChartInit = initOrderChartPage;\r\n\tHualala.Order.QueryOrderInit = initQueryOrderPage;\r\n\tHualala.Order.QueryOrderByDayDetailInit = initQueryOrderDayDetailPage;\r\n\tHualala.Order.QueryOrderByDuringDetailInit = initQueryOrderDuringDetailPage;\r\n\tHualala.Order.QueryOrderDishesHotInit = initQueryOrderDishesHotPage;\r\n\tHualala.Order.QueryOrderCustomerInit = initQueryOrderCustomerPage;\r\n\r\n})(jQuery, window);;(function ($, window) {\r\n\tIX.ns(\"Hualala.User\");\r\n\tvar popoverMsg = Hualala.UI.PopoverMsgTip;\r\n\tvar toptip = Hualala.UI.TopTip;\r\n\tvar LoadingModal = Hualala.UI.LoadingModal;\r\n\r\n\tvar BaseUserFormElsCfg = {\r\n\t\tloginName : {\r\n\t\t\ttype : \"text\",\r\n\t\t\tlabel : \"账号名称\",\r\n\t\t\tmode : \"readonly\",\r\n\t\t\tdefaultVal : \"\",\r\n\t\t\tprefix : '<span class=\"glyphicon glyphicon-user\"></span>',\r\n\t\t\tvalidCfg : {\r\n\t\t\t\tvalidators : {\r\n\t\t\t\t\tnotEmpty : {\r\n\t\t\t\t\t\tmessage : \"请输入账号名称\"\r\n\t\t\t\t\t},\r\n\t\t\t\t\tstringLength : {\r\n\t\t\t\t\t\tmin : 3,\r\n\t\t\t\t\t\tmax : 50,\r\n\t\t\t\t\t\tmessage : \"账号名称长度在3-50个字符之间\"\r\n\t\t\t\t\t},\r\n\t\t\t\t\tloginName : {\r\n\t\t\t\t\t\tmessage : \"账号名称只能包含数字、英文字母和下划线(_)\"\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\t// loginName : {\r\n\t\t// \ttype : \"static\",\r\n\t\t// \tlabel : \"账号名称\",\r\n\t\t// \tdefaultVal : \"\",\r\n\t\t// \tvalidCfg : {}\r\n\t\t// },\r\n\t\taccountID : {\r\n\t\t\ttype : \"hidden\",\r\n\t\t\tdefaultVal : \"\"\r\n\t\t},\r\n\t\tloginPWD : {\r\n\t\t\ttype : \"password\",\r\n\t\t\tlabel : \"登录密码\",\r\n\t\t\tdefaultVal : \"\",\r\n\t\t\tprefix : '<span class=\"glyphicon glyphicon-lock\"></span>',\r\n\t\t\tvalidCfg : {\r\n\t\t\t\tvalidators : {\r\n\t\t\t\t\tnotEmpty : {\r\n\t\t\t\t\t\tmessage : \"请设置密码\"\r\n\t\t\t\t\t},\r\n\t\t\t\t\tstringLength : {\r\n\t\t\t\t\t\tmin : 6,\r\n\t\t\t\t\t\tmax : 16,\r\n\t\t\t\t\t\tmessage : \"请设置密码长度在6-16位之间\"\r\n\t\t\t\t\t},\r\n\t\t\t\t\tnoChinese : {\r\n\t\t\t\t\t\tmessage : \"密码不能含有中文字符\"\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\tplainPWD : {\r\n\t\t\ttype : \"checkbox\",\r\n\t\t\tlabel : \"显示明文\",\r\n\t\t\tdefaultVal : 1,\r\n\t\t\tonLabel : \"开启\",\r\n\t\t\toffLabel : \"关闭\",\r\n\t\t\tvalidCfg : {}\r\n\r\n\t\t},\r\n\t\tuserName : {\r\n\t\t\ttype : \"text\",\r\n\t\t\tlabel : \"用户姓名\",\r\n\t\t\tdefaultVal : \"\",\r\n\t\t\tprefix : '<span class=\"glyphicon glyphicon-user\"></span>',\r\n\t\t\tvalidCfg : {\r\n\t\t\t\tvalidators : {\r\n\t\t\t\t\tnotEmpty : {\r\n\t\t\t\t\t\tmessage : \"请输入用户名称\"\r\n\t\t\t\t\t},\r\n\t\t\t\t\tstringLength : {\r\n\t\t\t\t\t\tmax : 30,\r\n\t\t\t\t\t\tmessage : \"用户姓名最多可以输入30个字符\"\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\tuserRemark : {\r\n\t\t\ttype : \"text\",\r\n\t\t\tlabel : \"用户备注\",\r\n\t\t\tdefaultVal : \"\",\r\n\t\t\tprefix : '<span class=\"glyphicon glyphicon-bookmark\"></span>',\r\n\t\t\tvalidCfg : {\r\n\t\t\t\tvalidators : {\r\n\t\t\t\t\tstringLength : {\r\n\t\t\t\t\t\tmax : 30,\r\n\t\t\t\t\t\tmessage : \"用户备注最多可以输入30个字符\"\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\tuserEmail : {\r\n\t\t\ttype : \"text\",\r\n\t\t\tlabel : \"邮箱地址\",\r\n\t\t\tdefaultVal : \"\",\r\n\t\t\tprefix : '<span class=\"glyphicon glyphicon-envelope\"></span>',\r\n\t\t\tvalidCfg : {\r\n\t\t\t\tvalidators : {\r\n\t\t\t\t\temailAddress : {\r\n\t\t\t\t\t\tmessage : \"请输入正确的电子邮箱地址\"\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\taccountStatus : {\r\n\t\t\ttype : \"switcher\",\r\n\t\t\tlabel : \"账号状态\",\r\n\t\t\tdefaultVal : 1,\r\n\t\t\tonLabel : \"正常\",\r\n\t\t\toffLabel : \"停用\",\r\n\t\t\tvalidCfg : {\r\n\t\t\t\tvalidators : {}\r\n\t\t\t}\r\n\t\t},\r\n\t\troleBinding : {\r\n\t\t\ttype : \"roleBindGrp\",\r\n\t\t\tlabel : \"请选择角色权限\",\r\n\t\t\tdefaultVal : '',\r\n\t\t\tvalidCfg : {\r\n\r\n\t\t\t}\r\n\t\t},\r\n\t\tbindedMobile : {\r\n\t\t\ttype : \"staticwithbtns\",\r\n\t\t\tlabel : \"已绑定手机\",\r\n\t\t\tdefaultVal : \"\",\r\n\t\t\tbtns : [\r\n\t\t\t\t{clz : \"col-sm-2\", btnClz : \"btn-link\", label : \"更改手机号\", act : \"changeMobile\"},\r\n\t\t\t\t{clz : \"col-sm-2\", btnClz : \"btn-link\", label : \"解除绑定\", act : \"unbindMobile\"}\r\n\t\t\t],\r\n\t\t\tvalidCfg : {}\r\n\t\t},\r\n\t\tuserMobile : {\r\n\t\t\ttype : \"textwithbtns\",\r\n\t\t\tlabel : \"手机号\",\r\n\t\t\tdefaultVal : \"\",\r\n\t\t\tbtns : [\r\n\t\t\t\t{clz : \"col-sm-2\", btnClz : \"btn-warning\", label : \"获取验证码\", act : \"getCode\", loadingText : \"发送中...\"}\r\n\t\t\t],\r\n\t\t\tvalidCfg : {\r\n\t\t\t\tvalidators : {\r\n\t\t\t\t\tnotEmpty : {\r\n\t\t\t\t\t\tmessage : \"请输入要绑定的手机号\"\r\n\t\t\t\t\t},\r\n\t\t\t\t\tmobile : {\r\n\t\t\t\t\t\tmessage : \"请输入中国地区手机号\"\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\tdynamicCode : {\r\n\t\t\ttype : \"text\",\r\n\t\t\tlabel : \"验证码\",\r\n\t\t\tdefaultVal : \"\",\r\n\t\t\tvalidCfg : {\r\n\t\t\t\tvalidators : {\r\n\t\t\t\t\tnotEmpty : {\r\n\t\t\t\t\t\tmessage : \"请输入短信验证码\"\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n\r\n\tvar BaseUserFormElsHT = new IX.IListManager();\r\n\t_.each(BaseUserFormElsCfg, function (el, k) {\r\n\t\tvar type = $XP(el, 'type');\r\n\t\tvar labelClz = 'col-sm-offset-1 col-sm-3 control-label';\r\n\t\tif (type == \"checkbox\") {\r\n\t\t\tBaseUserFormElsHT.register(k, IX.inherit(el, {\r\n\t\t\t\tid : k + '_' + IX.id(),\r\n\t\t\t\tname : k,\r\n\t\t\t\tlabelClz : labelClz + ' invisible',\r\n\t\t\t\tclz : 'col-sm-5 checkbox'\r\n\t\t\t}));\r\n\t\t} else if (type == \"roleBindGrp\") {\r\n\t\t\tBaseUserFormElsHT.register(k, IX.inherit(el, {\r\n\t\t\t\tid : k + '_' + IX.id(),\r\n\t\t\t\tname : k,\r\n\t\t\t\tlabelClz : labelClz,\r\n\t\t\t\tclz : 'col-sm-offset-3 col-sm-8'\r\n\t\t\t}));\r\n\t\t} else if (type == \"staticwithbtns\") {\r\n\t\t\tBaseUserFormElsHT.register(k, IX.inherit(el, {\r\n\t\t\t\tid : k + '_' + IX.id(),\r\n\t\t\t\tname : k,\r\n\t\t\t\tlabelClz : labelClz,\r\n\t\t\t\tclz : 'col-sm-3'\r\n\t\t\t}));\r\n\t\t} else {\r\n\t\t\tBaseUserFormElsHT.register(k, IX.inherit(el, {\r\n\t\t\t\tid : k + '_' + IX.id(),\r\n\t\t\t\tname : k,\r\n\t\t\t\tlabelClz : labelClz,\r\n\t\t\t\tclz : 'col-sm-5'\r\n\t\t\t}));\r\n\t\t}\r\n\t\t\r\n\t});\r\n\r\n\tvar ResetPWDFormKeys = 'loginName,loginPWD,plainPWD,accountID'.split(','),\r\n\t\tBaseUserFormKeys = 'loginName,accountID,userName,userRemark,userEmail,accountStatus'.split(','),\r\n\t\tRoleBindingFormKeys = 'loginName,accountID,roleBinding'.split(','),\r\n\t\tBindMobileFormKeys = 'accountID,bindedMobile,userMobile,dynamicCode'.split(',');\r\n\r\n\tvar ResetPWDView = Stapes.subclass({\r\n\t\tconstructor : function (cfg) {\r\n\t\t\tthis.mode = $XP(cfg, 'mode', 'add');\r\n\t\t\tthis.$container = $XP(cfg, 'container', null);\r\n\t\t\tthis.parentView = $XP(cfg, 'parentView', null);\r\n\t\t\tthis.model = $XP(cfg, 'model', null);\r\n\t\t\tthis.evtType = $XP(cfg, 'evtType');\r\n\t\t\tthis.successFn = $XF(cfg, 'successFn');\r\n\t\t\tthis.failFn = $XF(cfg, 'failFn');\r\n\t\t\tif (!this.model || !this.parentView) {\r\n\t\t\t\tthrow(\"ResetPWDView init faild!\");\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tthis.initBaseCfg();\r\n\t\t\tthis.formParams = this.model.getAll();\r\n\t\t\tthis.loadTemplates();\r\n\t\t\tthis.renderForm();\r\n\t\t\tthis.initUIComponents();\r\n\t\t\tthis.bindEvent();\r\n\t\t}\r\n\t});\r\n\r\n\tResetPWDView.proto({\r\n\t\tgetViewMode : function () {return this.mode;},\r\n\t\tinitBaseCfg : function () {\r\n\t\t\tthis.formKeys = ResetPWDFormKeys;\r\n\t\t\tif (this.mode == 'edit') {\r\n\t\t\t\tthis.modal = this.parentView.resetPWDModal;\r\n\t\t\t\tthis.$body = this.modal._.body;\r\n\t\t\t\tthis.$footer = this.modal._.footer;\r\n\t\t\t} else {\r\n\t\t\t\tthis.$body = this.$container;\r\n\t\t\t\tthis.modal = null;\r\n\t\t\t\tthis.$footer = null;\r\n\t\t\t}\r\n\t\t},\r\n\t\tcloseModal : function () {\r\n\t\t\tthis.modal && this.modal.hide();\r\n\t\t},\r\n\t\tinitUIComponents : function () {},\r\n\t\tloadTemplates : function () {\r\n\t\t\tvar layoutTpl = Handlebars.compile(Hualala.TplLib.get('tpl_base_user_form')),\r\n\t\t\t\tbtnTpl = Handlebars.compile(Hualala.TplLib.get('tpl_shop_modal_btns'));\r\n\t\t\tHandlebars.registerHelper('checkFormElementType', function (conditional, options) {\r\n\t\t\t\treturn (conditional == options.hash.type) ? options.fn(this) : options.inverse(this);\r\n\t\t\t});\r\n\t\t\tHandlebars.registerHelper('isInputGroup', function (prefix, surfix, options) {\r\n\t\t\t\treturn (!prefix && !surfix) ? options.inverse(this) : options.fn(this);\r\n\t\t\t});\r\n\t\t\tthis.set({\r\n\t\t\t\tlayoutTpl : layoutTpl,\r\n\t\t\t\tbtnTpl : btnTpl\r\n\t\t\t});\r\n\t\t},\r\n\t\tmapFormElsData : function () {\r\n\t\t\tvar self = this,\r\n\t\t\t\tformKeys = self.formKeys;\r\n\t\t\tvar ret = _.map(formKeys, function (key) {\r\n\t\t\t\tvar elCfg = BaseUserFormElsHT.get(key),\r\n\t\t\t\t\ttype = $XP(elCfg, 'type');\r\n\t\t\t\tif (type == 'checkbox') {\r\n\t\t\t\t\treturn IX.inherit(elCfg, {\r\n\t\t\t\t\t\tchecked : $XP(self.formParams, key) == $XP(elCfg, 'defaultVal') ? 'checked' : ''\r\n\t\t\t\t\t});\r\n\t\t\t\t} else if (type == 'switcher') {\r\n\t\t\t\t\treturn IX.inherit(elCfg, {\r\n\t\t\t\t\t\tchecked : $XP(self.formParams, key) == $XP(elCfg, 'defaultVal') ? 'checked' : ''\r\n\t\t\t\t\t});\r\n\t\t\t\t} else {\r\n\t\t\t\t\treturn IX.inherit(elCfg, {\r\n\t\t\t\t\t\tvalue : $XP(self.formParams, key, $XP(elCfg, 'defaultVal', ''))\r\n\t\t\t\t\t}, (type == 'text' && self.mode == 'wizard_add' && key == 'loginName') ? {\r\n\t\t\t\t\t\tmode : ''\r\n\t\t\t\t\t} : {});\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\tIX.Debug.info(\"DEBUG: User ResetPWD Form Elements :\");\r\n\t\t\tIX.Debug.info(ret);\r\n\t\t\treturn ret;\r\n\t\t},\r\n\t\trenderBtns : function () {\r\n\t\t\tvar self = this, btnTpl = self.get('btnTpl');\r\n\t\t\tif (self.mode == 'edit') {\r\n\t\t\t\tself.$footer.html(btnTpl({\r\n\t\t\t\t\tbtns : [\r\n\t\t\t\t\t\t{clz : 'btn-default', name : 'cancel', label : '取消'},\r\n\t\t\t\t\t\t{clz : 'btn-warning', name : 'submit', label : '保存', loadingText : \"提交中...\"}\r\n\t\t\t\t\t]\r\n\t\t\t\t}));\r\n\t\t\t} else if (self.mode == 'personal_edit') {\r\n\t\t\t\tself.$container.append(btnTpl({\r\n\t\t\t\t\tbtns : [\r\n\t\t\t\t\t\t{clz : 'btn-warning col-sm-offset-5', name : 'submit', label : '确定', loadingText : \"提交中...\"}\r\n\t\t\t\t\t]\r\n\t\t\t\t}));\r\n\t\t\t}\r\n\t\t},\r\n\t\trenderForm : function () {\r\n\t\t\tvar self = this,\r\n\t\t\t\trenderData = self.mapFormElsData(),\r\n\t\t\t\ttpl = self.get('layoutTpl'),\r\n\t\t\t\tbtnTpl = self.get('btnTpl'),\r\n\t\t\t\thtm = tpl({\r\n\t\t\t\t\tformClz : 'user-form form-feedback-out',\r\n\t\t\t\t\titems : renderData\r\n\t\t\t\t});\r\n\t\t\tself.$body.html(htm);\r\n\t\t\tself.renderBtns();\r\n\t\t},\r\n\t\tbindEvent : function () {\r\n\t\t\tvar self = this,\r\n\t\t\t\tfvOpts = self.initValidFieldOpts();\r\n\t\t\tself.$body.delegate('form :checkbox', 'change', function(evt) {\r\n\t\t\t\tself.$body.find('.form-control[name=loginPWD]').attr('type', this.checked ? 'text' : 'password');\r\n\t\t\t});\r\n\t\t\tself.$footer && self.$footer.delegate('.btn', 'click', function (evt) {\r\n\t\t\t\tvar $btn = $(this), act = $btn.attr('name');\r\n\t\t\t\tif (act == 'cancel') {\r\n\t\t\t\t\tself.closeModal();\r\n\t\t\t\t} else {\r\n\t\t\t\t\tvar bv = self.$body.find('form').data('bootstrapValidator');\r\n\t\t\t\t\t// $btn.button('提交中...');\r\n\t\t\t\t\t$btn.button('loading');\r\n\t\t\t\t\tbv.validate();\r\n\t\t\t\t\t\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\tif (self.getViewMode() == 'personal_edit') {\r\n\t\t\t\tself.$body.delegate('.btn', 'click', function (evt) {\r\n\t\t\t\t\tvar $btn = $(this), act = $btn.attr('name');\r\n\t\t\t\t\tif (act == 'submit') {\r\n\t\t\t\t\t\tvar bv = self.$body.find('form').data('bootstrapValidator');\r\n\t\t\t\t\t\t$btn.button('loading');\r\n\t\t\t\t\t\tbv.validate();\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t\tself.$body.find('form').bootstrapValidator({\r\n\t\t\t\ttrigger : 'blur',\r\n\t\t\t\tfields : fvOpts\r\n\t\t\t}).on('error.field.bv', function (e, data) {\r\n\t\t\t\tvar $form = $(e.target),\r\n\t\t\t\t\tbv = $form.data('bootstrapValidator');\r\n\t\t\t\tself.failFn(self.model);\r\n\t\t\t}).on('success.form.bv', function (e, data) {\r\n\t\t\t\te.preventDefault();\r\n\t\t\t\tvar $form = $(e.target),\r\n\t\t\t\t\tbv = $form.data('bootstrapValidator');\r\n\t\t\t\tvar formParams = self.serializeForm();\r\n\t\t\t\tIX.Debug.info(\"DEBUG: User ResetPWD Form Params:\");\r\n\t\t\t\tIX.Debug.info(formParams);\r\n\t\t\t\tself.model.emit(self.evtType, {\r\n\t\t\t\t\tparams : formParams,\r\n\t\t\t\t\tfailFn : function () {\r\n\t\t\t\t\t\tself.$footer && self.$footer.find('.btn[name=submit]').button('reset');\r\n\t\t\t\t\t\tself.failFn(self.model);\r\n\t\t\t\t\t},\r\n\t\t\t\t\tsuccessFn : function () {\r\n\t\t\t\t\t\tself.successFn(self.model);\r\n\t\t\t\t\t\tself.$footer && self.$footer.find('.btn[name=submit]').button('reset');\r\n\t\t\t\t\t\tself.closeModal();\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t});\r\n\t\t\t\r\n\t\t},\r\n\t\tserializeForm : function () {\r\n\t\t\tvar self = this,\r\n\t\t\t\tformKeys = _.filter(self.formKeys, function (k) {\r\n\t\t\t\t\t// return k != 'loginName' && k != 'plainPWD';\r\n\t\t\t\t\treturn k != 'plainPWD';\r\n\t\t\t\t}),\r\n\t\t\t\tret = {},\r\n\t\t\t\tformEls = _.map(formKeys, function (key) {\r\n\t\t\t\t\tvar elCfg = BaseUserFormElsHT.get(key),\r\n\t\t\t\t\t\ttype = $XP(elCfg, 'type');\r\n\t\t\t\t\tif (type == 'switcher') {\r\n\t\t\t\t\t\tret[key] = !$('[name=' + key + ']', self.$body).data('bootstrapSwitch').options.state ? 0 : 1;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tret[key] = $('[name=' + key + ']', self.$body).val();\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\treturn ret;\r\n\t\t},\r\n\t\tinitValidFieldOpts : function () {\r\n\t\t\tvar self = this,\r\n\t\t\t\tformKeys = _.filter(self.formKeys, function (k) {\r\n\t\t\t\t\treturn k != 'plainPWD' && k != 'accountID';\r\n\t\t\t\t}),\r\n\t\t\t\tret = {};\r\n\t\t\t_.each(formKeys, function (key) {\r\n\t\t\t\tvar elCfg = BaseUserFormElsHT.get(key),\r\n\t\t\t\t\ttype = $XP(elCfg, 'type');\r\n\t\t\t\tret[key] = $XP(elCfg, 'validCfg', {});\r\n\t\t\t});\r\n\t\t\treturn ret;\r\n\t\t}\r\n\t});\r\n\r\n\tHualala.User.ResetPWDView = ResetPWDView;\r\n\r\n\tvar UserBaseInfoView = ResetPWDView.subclass({\r\n\t\tconstructor : ResetPWDView.prototype.constructor\r\n\t});\r\n\tUserBaseInfoView.proto({\r\n\t\tinitBaseCfg : function () {\r\n\t\t\tthis.formKeys = BaseUserFormKeys;\r\n\t\t\tif (this.mode == 'edit') {\r\n\t\t\t\tthis.modal = this.parentView.userBaseInfoModal;\r\n\t\t\t\tthis.$body = this.modal._.body;\r\n\t\t\t\tthis.$footer = this.modal._.footer;\r\n\t\t\t} else {\r\n\t\t\t\tthis.$body = this.$container;\r\n\t\t\t\tthis.modal = null;\r\n\t\t\t\tthis.$footer = null;\r\n\t\t\t}\r\n\t\t},\r\n\t\tinitSwitcher : function (selector) {\r\n\t\t\tvar self = this;\r\n\t\t\tself.$body.find(selector).each(function () {\r\n\t\t\t\tvar $el = $(this), onLabel = $el.attr('data-onLabel'), offLabel = $el.attr('data-offLabel');\r\n\t\t\t\t$el.bootstrapSwitch({\r\n\t\t\t\t\tsize : 'normal',\r\n\t\t\t\t\tonColor : 'primary',\r\n\t\t\t\t\toffColor : 'default',\r\n\t\t\t\t\tonText : onLabel,\r\n\t\t\t\t\toffText : offLabel\r\n\t\t\t\t})\r\n\t\t\t});\r\n\t\t},\r\n\t\tinitUIComponents : function () {\r\n\t\t\tvar self = this;\r\n\t\t\tself.initSwitcher(':checkbox[data-type=switcher]');\r\n\t\t}\r\n\t});\r\n\tHualala.User.UserBaseInfoView = UserBaseInfoView;\r\n\r\n\r\n\tvar UserBindMobileView = ResetPWDView.subclass({\r\n\t\tconstructor : ResetPWDView.prototype.constructor\r\n\t});\r\n\tUserBindMobileView.proto({\r\n\t\tinitBaseCfg : function () {\r\n\t\t\tthis.formKeys = BindMobileFormKeys;\r\n\t\t\tif (this.mode == 'edit') {\r\n\t\t\t\tthis.modal = this.parentView.userBaseInfoModal;\r\n\t\t\t\tthis.$body = this.modal._.body;\r\n\t\t\t\tthis.$footer = this.modal._.footer;\r\n\t\t\t} else {\r\n\t\t\t\tthis.$body = this.$container;\r\n\t\t\t\tthis.modal = null;\r\n\t\t\t\tthis.$footer = null;\r\n\t\t\t}\r\n\t\t},\r\n\t\tmapFormElsData : function () {\r\n\t\t\tvar self = this,\r\n\t\t\t\tformKeys = self.formKeys;\r\n\t\t\tvar ret = _.map(formKeys, function (key) {\r\n\t\t\t\tvar elCfg = BaseUserFormElsHT.get(key),\r\n\t\t\t\t\ttype = $XP(elCfg, 'type');\r\n\t\t\t\tif (type == 'staticwithbtns') {\r\n\t\t\t\t\tvar val = $XP(self.formParams, 'userMobile', '');\r\n\t\t\t\t\tvar hidden = $XP(self.formParams, 'mobileBinded') == 1 ? '' : 'hidden';\r\n\t\t\t\t\treturn IX.inherit(elCfg, {\r\n\t\t\t\t\t\tvalue : val,\r\n\t\t\t\t\t\thidden : hidden,\r\n\t\t\t\t\t\tlabelClz : 'col-sm-3 control-label'\r\n\t\t\t\t\t});\r\n\t\t\t\t} else if (type == 'textwithbtns') {\r\n\t\t\t\t\treturn IX.inherit(elCfg, {\r\n\t\t\t\t\t\tvalue : '',\r\n\t\t\t\t\t\tlabelClz : 'col-sm-3 control-label'\r\n\t\t\t\t\t});\r\n\t\t\t\t} else {\r\n\t\t\t\t\treturn IX.inherit(elCfg, {\r\n\t\t\t\t\t\tvalue : $XP(self.formParams, key, $XP(elCfg, 'defaultVal', '')),\r\n\t\t\t\t\t\tlabelClz : 'col-sm-3 control-label'\r\n\t\t\t\t\t}, (type == 'text' && self.mode == 'wizard_add' && key == 'loginName') ? {\r\n\t\t\t\t\t\tmode : ''\r\n\t\t\t\t\t} : {});\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\tIX.Debug.info(\"DEBUG: User ResetPWD Form Elements :\");\r\n\t\t\tIX.Debug.info(ret);\r\n\t\t\treturn ret;\r\n\t\t},\r\n\t\trenderBtns : function () {\r\n\t\t\tvar self = this;\r\n\t\t\tvar self = this, btnTpl = self.get('btnTpl');\r\n\t\t\tif (self.mode == 'personal_edit') {\r\n\t\t\t\tself.$container.append(btnTpl({\r\n\t\t\t\t\tbtns : [\r\n\t\t\t\t\t\t{clz : 'btn-warning col-sm-offset-5', name : 'submit', label : '绑定手机', loadingText : \"提交中...\"}\r\n\t\t\t\t\t]\r\n\t\t\t\t}));\r\n\t\t\t}\r\n\t\t},\r\n\t\tinitUIComponents : function () {\r\n\t\t\tvar self = this;\r\n\t\t\tvar mobileBinded = $XP(self.formParams, 'mobileBinded');\r\n\t\t\t// TODO init UI Components\r\n\t\t\tself.dynamicPWD = new Hualala.Common.DynamicPWD({\r\n\t\t\t\t$btn : self.$body.find('.btn-warning[data-act=getCode]'),\r\n\t\t\t\twaiting : 180,\r\n\t\t\t\tgetParams : function () {\r\n\t\t\t\t\tvar groupLoginName = self.model.get('groupLoginName'),\r\n\t\t\t\t\t\t$userMobile = self.$body.find(':text[name=userMobile]'),\r\n\t\t\t\t\t\tbv = self.$body.find('form').data('bootstrapValidator');\r\n\t\t\t\t\tif (!bv.validateField($userMobile).isValidField($userMobile)) {\r\n\t\t\t\t\t\treturn null;\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn {\r\n\t\t\t\t\t\tgroupName : groupLoginName,\r\n\t\t\t\t\t\tuserMobile : $userMobile.val()\r\n\t\t\t\t\t};\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\tif (mobileBinded == 1) {\r\n\t\t\t\tself.$body.find('.form-group').eq(0).show();\r\n\t\t\t\tself.$body.find('.form-group:gt(0)').hide();\r\n\t\t\t\tself.$body.find('.btn[name=submit]').hide();\r\n\t\t\t} else {\r\n\t\t\t\tself.$body.find('.form-group').eq(0).hide();\r\n\t\t\t\tself.$body.find('.form-group:gt(0)').show();\r\n\t\t\t\tself.$body.find('.btn[name=submit]').show();\r\n\t\t\t}\r\n\t\t\tself.$body.delegate('.btn[data-act]', 'click', function (e) {\r\n\t\t\t\tvar $btn = $(this), act = $btn.attr('data-act');\r\n\t\t\t\tif (act == 'unbindMobile') {\r\n\t\t\t\t\tHualala.UI.Confirm({\r\n\t\t\t\t\t\ttitle : '手机号解除绑定',\r\n\t\t\t\t\t\tmsg : '是否解除绑定账号(' + self.model.get('loginName') + ')的手机号？',\r\n\t\t\t\t\t\tokLabel : '解除绑定',\r\n\t\t\t\t\t\tokFn : function () {\r\n\t\t\t\t\t\t\tself.model.emit('unbindMobile', {\r\n\t\t\t\t\t\t\t\taccountID : self.model.get('accountID'),\r\n\t\t\t\t\t\t\t\tsuccessFn : function () {\r\n\t\t\t\t\t\t\t\t\tself.$body.find('.form-group').eq(0).hide();\r\n\t\t\t\t\t\t\t\t\tself.$body.find('.form-group:gt(0)').show();\r\n\t\t\t\t\t\t\t\t\tself.$body.find('.btn[name=submit]').show();\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t} else if (act == 'changeMobile') {\r\n\t\t\t\t\tself.$body.find('.form-group').eq(0).hide();\r\n\t\t\t\t\tself.$body.find('.form-group:gt(0)').show();\r\n\t\t\t\t\tself.$body.find('.btn[name=submit]').show();\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\t});\r\n\tHualala.User.UserBindMobileView = UserBindMobileView;\r\n\r\n\r\n\tvar UserRoleView = Stapes.subclass({\r\n\t\tconstructor : function (cfg) {\r\n\t\t\tthis.mode = $XP(cfg, 'mode', 'add');\r\n\t\t\tthis.$container = $XP(cfg, 'container', null);\r\n\t\t\tthis.parentView = $XP(cfg, 'parentView', null);\r\n\t\t\tthis.model = $XP(cfg, 'model', null);\r\n\t\t\tthis.evtType = $XP(cfg, 'evtType');\r\n\t\t\tthis.successFn = $XF(cfg, 'successFn');\r\n\t\t\tthis.failFn = $XF(cfg, 'failFn');\r\n\t\t\tif (!this.model || !this.parentView) {\r\n\t\t\t\tthrow(\"UserRoleView init faild!\");\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tthis.loadTemplates();\r\n\t\t\tthis.formParams = this.model.getAll();\r\n\t\t\tthis.initBaseCfg();\r\n\t\t\t\r\n\t\t\t\r\n\t\t}\r\n\t});\r\n\r\n\tUserRoleView.proto({\r\n\t\tgetViewMode : function () {return this.mode;},\r\n\t\tcloseModal : function () {\r\n\t\t\tthis.modal && this.modal.hide();\r\n\t\t},\r\n\t\tinitBaseCfg : function () {\r\n\t\t\tvar self = this;\r\n\t\t\tself.formKeys = RoleBindingFormKeys;\r\n\t\t\tif (this.mode == 'edit') {\r\n\t\t\t\tthis.modal = this.parentView.userRoleModal;\r\n\t\t\t\tthis.$body = this.modal._.body;\r\n\t\t\t\tthis.$footer = this.modal._.footer;\r\n\t\t\t} else {\r\n\t\t\t\tthis.modal = null;\r\n\t\t\t\tthis.$body = this.$container;\r\n\t\t\t\tthis.$footer = null;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tself.model.emit('queryRoleBinding', {\r\n\t\t\t\tsuccessFn : function () {\r\n\t\t\t\t\tself.renderForm();\r\n\t\t\t\t\tself.initUIComponents();\r\n\t\t\t\t\tself.bindEvent();\r\n\t\t\t\t},\r\n\t\t\t\tfailFn : function () {\r\n\t\t\t\t\tself.closeModal();\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t},\r\n\t\tloadTemplates : function () {\r\n\t\t\tvar layoutTpl = Handlebars.compile(Hualala.TplLib.get('tpl_base_user_form')),\r\n\t\t\t\tbtnTpl = Handlebars.compile(Hualala.TplLib.get('tpl_shop_modal_btns'));\r\n\t\t\tHandlebars.registerHelper('checkFormElementType', function (conditional, options) {\r\n\t\t\t\treturn (conditional == options.hash.type) ? options.fn(this) : options.inverse(this);\r\n\t\t\t});\r\n\t\t\tHandlebars.registerHelper('isInputGroup', function (prefix, surfix, options) {\r\n\t\t\t\treturn (!prefix && !surfix) ? options.inverse(this) : options.fn(this);\r\n\t\t\t});\r\n\t\t\tthis.set({\r\n\t\t\t\tlayoutTpl : layoutTpl,\r\n\t\t\t\tbtnTpl : btnTpl\r\n\t\t\t});\r\n\t\t},\r\n\t\tmapRoleBindingElsData : function () {\r\n\t\t\tvar self = this,\r\n\t\t\t\troles = self.model.get('roles');\r\n\t\t\tvar items = _.map(roles, function (role) {\r\n\t\t\t\tvar binded = $XP(role, 'binded', false),\r\n\t\t\t\t\tid = $XP(role, 'id', ''),\r\n\t\t\t\t\tname = $XP(role, 'name', ''),\r\n\t\t\t\t\ttype = $XP(role, 'roleType', ''),\r\n\t\t\t\t\troleDesc = $XP(role, 'desc', '');\r\n\t\t\t\treturn IX.inherit(role, {\r\n\t\t\t\t\ttype : type,\r\n\t\t\t\t\troleDesc : roleDesc,\r\n\t\t\t\t\tbtnLabel : type == 'finance' ? '绑定账号' : '绑定店铺',\r\n\t\t\t\t\thideBtn : type == 'general' || type == 'admin' ? 'hidden' : '',\r\n\t\t\t\t\tdisabledBtn : binded ? '' : 'disabled',\r\n\t\t\t\t\tchecked : binded ? 'checked' : ''\r\n\t\t\t\t});\r\n\r\n\t\t\t});\r\n\t\t\treturn {items : items};\r\n\t\t},\r\n\t\tmapFormElsData : function () {\r\n\t\t\tvar self = this,\r\n\t\t\t\tformKeys = self.formKeys;\r\n\t\t\tvar ret = _.map(formKeys, function (key) {\r\n\t\t\t\tvar elCfg = BaseUserFormElsHT.get(key),\r\n\t\t\t\t\ttype = $XP(elCfg, 'type');\r\n\t\t\t\tif (type == 'roleBindGrp') {\r\n\t\t\t\t\treturn IX.inherit(elCfg, self.mapRoleBindingElsData());\r\n\t\t\t\t} else {\r\n\t\t\t\t\treturn IX.inherit(elCfg, {\r\n\t\t\t\t\t\tvalue : $XP(self.formParams, key, $XP(elCfg, 'defaultVal', ''))\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\tIX.Debug.info(\"DEBUG: User ResetPWD Form Elements :\");\r\n\t\t\tIX.Debug.info(ret);\r\n\t\t\treturn ret;\r\n\t\t},\r\n\t\trenderForm : function () {\r\n\t\t\tvar self = this,\r\n\t\t\t\trenderData = self.mapFormElsData(),\r\n\t\t\t\ttpl = self.get('layoutTpl'),\r\n\t\t\t\tbtnTpl = self.get('btnTpl'),\r\n\t\t\t\thtm = tpl({\r\n\t\t\t\t\tformClz : 'role-form form-feedback-out',\r\n\t\t\t\t\titems : renderData\r\n\t\t\t\t});\r\n\t\t\tself.$body.html(htm);\r\n\t\t\tif (self.mode == 'edit') {\r\n\t\t\t\tself.$footer.html(btnTpl({\r\n\t\t\t\t\tbtns : [\r\n\t\t\t\t\t\t{clz : 'btn-default', name : 'cancel', label : '取消'},\r\n\t\t\t\t\t\t{clz : 'btn-warning', name : 'submit', label : '保存', loadingText : \"提交中...\"}\r\n\t\t\t\t\t]\r\n\t\t\t\t}));\r\n\t\t\t}\r\n\t\t\t\r\n\t\t},\r\n\t\tinitUIComponents : function () {\r\n\r\n\t\t},\r\n\t\t// 用于取消选中的角色\r\n\t\tupdateRoleBindStatus : function (roleType) {\r\n\t\t\tvar self = this, mUser = self.model;\r\n\t\t\tvar roleInfo = mUser.getRoleInfoByType(roleType),\r\n\t\t\t\titems = !$XP(roleInfo, 'binded') ? [] : $XP(roleInfo, 'items'),\r\n\t\t\t\t$chk = self.$body.find(':checkbox[name=' + roleType + ']');\r\n\t\t\tif (items.length <= 0) {\r\n\t\t\t\t$chk[0].checked = false;\r\n\t\t\t\t$chk.trigger('change');\r\n\t\t\t}\r\n\t\t},\r\n\t\tbindEvent : function () {\r\n\t\t\tvar self = this;\r\n\t\t\tself.$body.delegate('input:checkbox', 'change', function (e) {\r\n\t\t\t\tvar checked = !this.checked ? false : true,\r\n\t\t\t\t\t$chk = $(this), roleType = $chk.attr('name');\r\n\t\t\t\tvar $btn = $chk.parents('.checkbox').find('.btn[data-role=' + roleType + ']');\r\n\t\t\t\t$btn[!checked ? 'addClass' : 'removeClass']('disabled');\r\n\t\t\t\tif (checked) {\r\n\t\t\t\t\tself.model.updateRoleBind(roleType, checked);\r\n\t\t\t\t\t$btn.trigger('click');\r\n\t\t\t\t} else {\r\n\t\t\t\t\tself.model.updateRoleBind(roleType, checked);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\tself.$body.delegate('.btn[data-role]', 'click', function (e) {\r\n\t\t\t\tvar $btn = $(this), roleType = $btn.attr('data-role');\r\n\t\t\t\tswitch(roleType) {\r\n\t\t\t\t\tcase \"manager\":\r\n\t\t\t\t\t\tself.bindModal = new Hualala.User.BindShopModal({\r\n\t\t\t\t\t\t\ttrigger : $btn,\r\n\t\t\t\t\t\t\tmodel : self.model,\r\n\t\t\t\t\t\t\tparentView : self,\r\n\t\t\t\t\t\t\troleType : roleType,\r\n\t\t\t\t\t\t\tmutiSelect : false\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase \"finance\":\r\n\t\t\t\t\t\tself.bindModal = new Hualala.User.BindSettleAccountModal({\r\n\t\t\t\t\t\t\tmodel : self.model,\r\n\t\t\t\t\t\t\tparentView : self,\r\n\t\t\t\t\t\t\troleType : roleType,\r\n\t\t\t\t\t\t\tmutiSelect : true\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase \"area-manager\":\r\n\t\t\t\t\t\tself.bindModal = new Hualala.User.BindShopMultiModal({\r\n\t\t\t\t\t\t\tmodel : self.model,\r\n\t\t\t\t\t\t\troleType : roleType,\r\n\t\t\t\t\t\t\tparentView : self\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\tif (self.mode == 'edit') {\r\n\t\t\t\tself.$footer.delegate('.btn', 'click', function (e) {\r\n\t\t\t\t\tvar $btn = $(this), act = $btn.attr('name');\r\n\t\t\t\t\tif (act == 'cancel') {\r\n\t\t\t\t\t\tself.closeModal();\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\t$btn.button('loading');\r\n\t\t\t\t\t\tself.model.emit('editRole', {\r\n\t\t\t\t\t\t\tsuccessFn : function () {\r\n\t\t\t\t\t\t\t\tself.$footer.find('.btn[name=submit]').button('reset');\r\n\t\t\t\t\t\t\t\tself.closeModal();\r\n\t\t\t\t\t\t\t\tself.successFn(self.model);\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\tfailFn : function () {\r\n\t\t\t\t\t\t\t\tself.$footer.find('.btn[name=submit]').button('reset');\r\n\t\t\t\t\t\t\t\tself.closeModal();\r\n\t\t\t\t\t\t\t\tself.failFn(self.model);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t\t\r\n\t\t}\r\n\t});\r\n\r\n\tHualala.User.UserRoleView = UserRoleView;\r\n})(jQuery, window);\r\n(function ($, window) {\r\n\tIX.ns(\"Hualala.User\");\r\n\tvar popoverMsg = Hualala.UI.PopoverMsgTip;\r\n\tvar toptip = Hualala.UI.TopTip;\r\n\tvar LoadingModal = Hualala.UI.LoadingModal;\r\n\r\n\tvar WizardCfg = [\r\n\t\t{id : \"user_base_info\", label : \"基本信息\"},\r\n\t\t{id : \"user_login_pwd\", label : \"登录密码\"},\r\n\t\t{id : \"user_role_binding\", label : \"角色绑定\"}\r\n\t];\r\n\tvar WizardCtrls = [\r\n\t\t{clz : 'btn-default btn-prev', name : 'prev', label : '上一步', loadingText : '请稍候...'},\r\n\t\t{clz : 'btn-default btn-cancel', name : 'cancel', label : '取消', loadingText : '取消'},\r\n\t\t{clz : 'btn-warning btn-next', name : 'next', label : '下一步', loadingText : '请稍候...'},\r\n\t\t{clz : 'btn-success btn-finish ', name : 'finish', label : '完成', loadingText : '提交中...'}\r\n\t];\r\n\r\n\tvar CreateUserModal = Stapes.subclass({\r\n\t\tconstructor : function (cfg) {\r\n\t\t\tthis.parentView = $XP(cfg, 'parentView');\r\n\t\t\tthis.evtType = $XP(cfg, 'evtType', 'create');\r\n\t\t\tthis.successFn = $XF(cfg, 'successFn');\r\n\t\t\tthis.failFn = $XF(cfg, 'failFn');\r\n\t\t\tthis.modal = null;\r\n\t\t\tthis.$body = null;\r\n\t\t\tthis.$wizard = null;\r\n\t\t\tthis.wizardID = \"create_user_wizard\";\r\n\t\t\tthis.model = new Hualala.User.BaseUserModel();\r\n\t\t\tthis.stepViewHT = new IX.IListManager();\r\n\t\t\tthis.loadTemplates();\r\n\t\t\tthis.initModal();\r\n\t\t\tthis.renderWizardLayout();\r\n\t\t\tthis.initWizard();\r\n\t\t\t// 是否允许进入下一步\r\n\t\t\tthis.enableGoToNextStep = false;\r\n\t\t\tthis.bindEvent();\r\n\t\t}\r\n\t});\r\n\tCreateUserModal.proto({\r\n\t\tloadTemplates : function () {\r\n\t\t\tvar layoutTpl = Handlebars.compile(Hualala.TplLib.get('tpl_wizard_layout')),\r\n\t\t\t\tbtnTpl = Handlebars.compile(Hualala.TplLib.get('tpl_shop_modal_btns'));\r\n\t\t\tHandlebars.registerPartial(\"stepAction\", Hualala.TplLib.get('tpl_shop_modal_btns'));\r\n\t\t\t\r\n\t\t\tthis.set({\r\n\t\t\t\tlayoutTpl : layoutTpl,\r\n\t\t\t\tbtnTpl : btnTpl\r\n\t\t\t});\r\n\t\t},\r\n\t\tinitModal : function () {\r\n\t\t\tvar self = this;\r\n\t\t\tself.modal = new Hualala.UI.ModalDialog({\r\n\t\t\t\tid : \"create_user_modal\",\r\n\t\t\t\tclz : 'account-modal',\r\n\t\t\t\ttitle : \"添加用户账号\",\r\n\t\t\t\tbackdrop : 'static',\r\n\t\t\t\tshowFooter : false,\r\n\t\t\t\tafterHide : function () {\r\n\t\t\t\t\t\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\tself.$body = self.modal._.body;\r\n\t\t\tself.modal.show();\r\n\t\t},\r\n\t\tmapWizardLayoutData : function () {\r\n\t\t\tvar self = this,\r\n\t\t\t\tstepNavs = [],\r\n\t\t\t\tsteps = [];\r\n\t\t\tstepNavs = _.map(WizardCfg, function (step, i) {\r\n\t\t\t\tsteps.push({\r\n\t\t\t\t\tid : $XP(step, 'id')\r\n\t\t\t\t});\r\n\t\t\t\treturn IX.inherit(step, {\r\n\t\t\t\t\tidx : (i + 1)\r\n\t\t\t\t});\r\n\t\t\t});\r\n\t\t\treturn {\r\n\t\t\t\tid : self.wizardID,\r\n\t\t\t\tclz : 'wizard-create-user',\r\n\t\t\t\tstepNavs : stepNavs,\r\n\t\t\t\tsteps : steps,\r\n\t\t\t\tbtns : WizardCtrls\r\n\t\t\t};\r\n\t\t},\r\n\t\trenderWizardLayout : function () {\r\n\t\t\tvar self = this;\r\n\t\t\tvar renderData = self.mapWizardLayoutData(),\r\n\t\t\t\tlayoutTpl = self.get('layoutTpl'),\r\n\t\t\t\thtm = layoutTpl(renderData);\r\n\t\t\t\r\n\t\t\tself.$body.html(htm);\r\n\r\n\t\t\tself.modal.show();\r\n\t\t},\r\n\t\tgetTabContentIDByIndex : function ($navBar, idx) {\r\n\t\t\tvar $tab = $('li:eq(' + idx + ')', $navBar),\r\n\t\t\t\tid = $tab.find('a[data-toggle]').attr('href').replace('#', '');\r\n\t\t\treturn id;\r\n\t\t},\r\n\t\t// 账号基本信息View层\r\n\t\tinitUserBaseInfoView : function ($container, cntID, viewMode) {\r\n\t\t\tvar self = this,\r\n\t\t\t\tstepView = new Hualala.User.UserBaseInfoView({\r\n\t\t\t\t\tmode : viewMode,\r\n\t\t\t\t\tcontainer : $container,\r\n\t\t\t\t\tparentView : self,\r\n\t\t\t\t\tmodel : self.model,\r\n\t\t\t\t\tevtType : viewMode == 'wizard_add' ? 'addUser' : 'editUser',\r\n\t\t\t\t\tsuccessFn : function (mUser) {\r\n\t\t\t\t\t\tself.switchWizardCtrlStatus('reset');\r\n\t\t\t\t\t\tself.getNextStep();\r\n\t\t\t\t\t},\r\n\t\t\t\t\tfailFn : function (mUser) {\r\n\t\t\t\t\t\tself.switchWizardCtrlStatus('reset');\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\tself.stepViewHT.register(cntID, stepView);\r\n\t\t},\r\n\t\t// 充值密码View层\r\n\t\tinitResetPWDView : function ($container, cntID, viewMode) {\r\n\t\t\tvar self = this,\r\n\t\t\t\tstepView = new Hualala.User.ResetPWDView({\r\n\t\t\t\t\tmode : viewMode,\r\n\t\t\t\t\tcontainer : $container,\r\n\t\t\t\t\tparentView : self,\r\n\t\t\t\t\tmodel : self.model,\r\n\t\t\t\t\tevtType : 'resetPWD',\r\n\t\t\t\t\tsuccessFn : function (mUser) {\r\n\t\t\t\t\t\tself.switchWizardCtrlStatus('reset');\r\n\t\t\t\t\t\tself.getNextStep();\r\n\t\t\t\t\t},\r\n\t\t\t\t\tfailFn : function (mUser) {\r\n\t\t\t\t\t\tself.switchWizardCtrlStatus('reset');\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\tself.stepViewHT.register(cntID, stepView);\r\n\t\t},\r\n\t\t// 绑定角色View层\r\n\t\tinitUserRoleView : function ($container, cntID, viewMode) {\r\n\t\t\tvar self = this,\r\n\t\t\t\tstepView = new Hualala.User.UserRoleView({\r\n\t\t\t\t\tmode : viewMode,\r\n\t\t\t\t\tcontainer : $container,\r\n\t\t\t\t\tparentView : self,\r\n\t\t\t\t\tmodel : self.model,\r\n\t\t\t\t\tevtType : 'editRole',\r\n\t\t\t\t\tsuccessFn : function (mUser) {\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t},\r\n\t\t\t\t\tfailFn : function (mUser) {\r\n\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\tself.stepViewHT.register(cntID, stepView);\r\n\t\t},\r\n\t\t// 账号信息提交(基本信息，账号登录密码)\r\n\t\tcommitUserInfo : function (stepView) {\r\n\t\t\tvar self = this,\r\n\t\t\t\t$cnt = stepView.$body,\r\n\t\t\t\t$form = $cnt.find('form'),\r\n\t\t\t\tbv = $form.data('bootstrapValidator');\r\n\t\t\tself.switchWizardCtrlStatus('loading');\r\n\t\t\tbv.validate();\r\n\t\t},\r\n\t\t// 提交每个步骤的数据\r\n\t\tcommitStep : function (cntID) {\r\n\t\t\tvar self = this,\r\n\t\t\t\tstepView = self.stepViewHT.get(cntID);\r\n\t\t\tswitch(cntID) {\r\n\t\t\t\tcase \"user_base_info\":\r\n\t\t\t\tcase \"user_login_pwd\":\r\n\t\t\t\t\tself.commitUserInfo(stepView);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase \"user_role_binding\":\r\n\t\t\t\t\tself.model.emit('editRole', {\r\n\t\t\t\t\t\tsuccessFn : function () {\r\n\t\t\t\t\t\t\tself.successFn(self.model);\r\n\t\t\t\t\t\t\tself.modal.hide();\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\tfailFn : function () {\r\n\t\t\t\t\t\t\tself.failFn(self.model);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t},\r\n\t\tinitWizard : function () {\r\n\t\t\tvar self = this;\r\n\t\t\tself.$wizard = self.$body.find('#' + self.wizardID);\r\n\t\t\t\r\n\t\t\tself.$wizard.bsWizard({\r\n\t\t\t\t'tabClass' : 'tabClass',\r\n\t\t\t\t'nextSelector' : '.btn[name=next]',\r\n\t\t\t\t'previousSelector' : '.btn[name=prev]',\r\n\t\t\t\t'finishSelector' : '.btn[name=finish]',\r\n\t\t\t\tonTabClick : function () {return false;},\r\n\t\t\t\tonInit : function ($wizard, $navBar, nIdx) {\r\n\t\t\t\t\t// console.info('onInit');console.info(arguments);\r\n\t\t\t\t\t// 加载新建账号基本信息View层\r\n\t\t\t\t\tvar $tab = $('li:eq(' + nIdx + ')', self.$wizard),\r\n\t\t\t\t\t\tcntID = self.getTabContentIDByIndex($navBar, nIdx),\r\n\t\t\t\t\t\t$cnt = $('#' + cntID, self.$wizard);\r\n\t\t\t\t\tself.initUserBaseInfoView($cnt, cntID, 'wizard_add');\r\n\t\t\t\t},\r\n\t\t\t\t/**\r\n\t\t\t\t * fired next step button is clicked\r\n\t\t\t\t * @param  {jQueryObj} $curNav 当前步骤的导航标签\r\n\t\t\t\t * @param  {jQueryObj} $navBar 导航栏\r\n\t\t\t\t * @param  {Number} nIdx    下一步的索引值\r\n\t\t\t\t * @return {Boolean} false:不移动到下一步，true:移动到下一步\r\n\t\t\t\t *         \r\n\t\t\t\t */\r\n\t\t\t\tonNext : function ($curNav, $navBar, nIdx) {\r\n\t\t\t\t\t// console.info('onNext');\r\n\t\t\t\t\tvar $curTab = $($curNav.find('a[data-toggle]').attr('href')),\r\n\t\t\t\t\t\tcurID = $curTab.attr('id');\r\n\t\t\t\t\tif (self.enableGoToNextStep == false) {\r\n\t\t\t\t\t\tself.commitStep(curID);\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t}\r\n\t\t\t\t\tvar ret = self.enableGoToNextStep;\r\n\t\t\t\t\tself.enableGoToNextStep = false;\r\n\t\t\t\t\treturn ret;\r\n\t\t\t\t},\r\n\t\t\t\t/**\r\n\t\t\t\t * fired previous step button is clicked\r\n\t\t\t\t * @param  {jQueryObj} $curNav 当前步骤的导航标签\r\n\t\t\t\t * @param  {jQueryObj} $navBar 导航栏\r\n\t\t\t\t * @param  {Number} nIdx    下一步的索引值\r\n\t\t\t\t * @return {Boolean}         false:不移动到下一步，true:移动到下一步\r\n\t\t\t\t */\r\n\t\t\t\tonPrevious : function ($curNav, $navBar, nIdx) {\r\n\t\t\t\t\t// console.info('onPrevious');\r\n\t\t\t\t\tvar $curTab = $($curNav.find('a[data-toggle]').attr('href')),\r\n\t\t\t\t\t\tcurID = $curTab.attr('id');\r\n\t\t\t\t\t// if (self.enableGoToNextStep == false) {\r\n\t\t\t\t\t// \tself.commitStep(curID, function () {\r\n\t\t\t\t\t// \t\tself.enableGoToNextStep = true;\r\n\t\t\t\t\t// \t\tself.$wizard.bsWizard('previous');\r\n\t\t\t\t\t// \t});\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t// }\r\n\t\t\t\t\t// var ret = self.enableGoToNextStep;\r\n\t\t\t\t\t// self.enableGoToNextStep = false;\r\n\t\t\t\t\t// return ret;\r\n\t\t\t\t\treturn true;\r\n\t\t\t\t},\r\n\t\t\t\t/**\r\n\t\t\t\t * fired when a tab is changed\r\n\t\t\t\t * @param  {jQueryObj} $curNav 当前步骤的导航标签\r\n\t\t\t\t * @param  {jQueryObj} $navBar 导航栏\r\n\t\t\t\t * @param  {Number} nIdx    下一步的索引值\r\n\t\t\t\t * @param {Number} cIdx 当前步骤的索引\r\n\t\t\t\t * @return {Boolean} false:不移动到下一步，true:移动到下一步\r\n\t\t\t\t */\r\n\t\t\t\tonTabChange : function ($curNav, $navBar, cIdx, nIdx) {\r\n\t\t\t\t\t// console.info('onTabChange'); console.info(cIdx + '--->' + nIdx);\r\n\t\t\t\t\tvar curID = self.getTabContentIDByIndex($navBar, cIdx),\r\n\t\t\t\t\t\tnextID = self.getTabContentIDByIndex($navBar, nIdx),\r\n\t\t\t\t\t\t$nextCnt = $('#' + nextID, self.$wizard),\r\n\t\t\t\t\t\tnextView = self.stepViewHT.get(nextID);\r\n\r\n\t\t\t\t\tvar\tviewMode = !IX.isEmpty(nextView) ? nextView.getViewMode() : null;\r\n\t\t\t\t\t\t\r\n\t\t\t\t\tif (cIdx == -1 && nIdx == 0) return true;\r\n\t\t\t\t\tif (nIdx == 0 && nextView && viewMode == 'wizard_add') {\r\n\t\t\t\t\t\tself.initUserBaseInfoView($nextCnt, nextID, 'wizard_edit');\r\n\t\t\t\t\t\treturn true;\r\n\t\t\t\t\t} \r\n\t\t\t\t\tif (nIdx == 1) {\r\n\t\t\t\t\t\tIX.isEmpty(viewMode) && self.initResetPWDView($nextCnt, nextID, 'wizard_edit');\r\n\t\t\t\t\t} else if (nIdx == 2) {\r\n\t\t\t\t\t\tIX.isEmpty(viewMode) && self.initUserRoleView($nextCnt, nextID, 'wizard_edit');\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t\t/**\r\n\t\t\t\t * fired when a tab is shown\r\n\t\t\t\t * @param  {jQueryObj} $curNav 当前步骤的导航标签\r\n\t\t\t\t * @param  {jQueryObj} $navBar 导航栏\r\n\t\t\t\t * @param {Number} cIdx 当前步骤的索引\r\n\t\t\t\t * @return {Boolean} false:不移动到下一步，true:移动到下一步\r\n\t\t\t\t */\r\n\t\t\t\tonTabShow : function ($curNav, $navBar, cIdx) {\r\n\t\t\t\t\t// console.info('onTabShow');\r\n\t\t\t\t\t\r\n\t\t\t\t},\r\n\t\t\t\t/**\r\n\t\t\t\t * fired when finish button is clicked\r\n\t\t\t\t * @param  {jQueryObj} $curNav 当前步骤的导航标签\r\n\t\t\t\t * @param  {jQueryObj} $navBar 导航栏\r\n\t\t\t\t * @param {Number} cIdx 当前步骤的索引\r\n\t\t\t\t * @return {Boolean} false:不移动到下一步，true:移动到下一步\r\n\t\t\t\t */\r\n\t\t\t\tonFinish : function ($curNav, $navBar, cIdx) {\r\n\t\t\t\t\t// console.info('onFinish');\r\n\t\t\t\t\tvar $curTab = $($curNav.find('a[data-toggle]').attr('href')),\r\n\t\t\t\t\t\tcurID = $curTab.attr('id');\r\n\t\t\t\t\tself.commitStep(curID);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t},\r\n\t\tswitchWizardCtrlStatus : function (status) {\r\n\t\t\tvar self = this;\r\n\t\t\tself.$wizard.find('.wizard-ctrl .btn').button(status);\r\n\t\t},\r\n\t\tgetNextStep : function () {\r\n\t\t\tvar self = this;\r\n\t\t\tself.enableGoToNextStep = true;\r\n\t\t\tself.$wizard.bsWizard('next');\r\n\t\t},\r\n\t\tgetPrevieousStep : function () {\r\n\t\t\tvar self = this;\r\n\t\t\tself.enableGoToNextStep = true;\r\n\t\t\tself.$wizard.bsWizard('previeous');\r\n\t\t},\r\n\t\tbindEvent : function () {\r\n\t\t\tvar self = this;\r\n\t\t\tself.$wizard.find('.wizard-ctrl .btn-cancel').on('click', function (e) {\r\n\t\t\t\tvar $btn = $(this);\r\n\t\t\t\tvar curIdx = self.$wizard.bsWizard('currentIndex'), \r\n\t\t\t\t\tcntID = self.getTabContentIDByIndex(self.$wizard.find('.wizard-nav'), curIdx),\r\n\t\t\t\t\tstepView = self.stepViewHT.get(cntID),\r\n\t\t\t\t\tmode = stepView.getViewMode();\r\n\t\t\t\tvar accountID = self.model.get('accountID');\r\n\t\t\t\tif (!accountID && curIdx == 0) {\r\n\t\t\t\t\tself.modal.hide();\r\n\t\t\t\t} else {\r\n\t\t\t\t\tHualala.UI.Confirm({\r\n\t\t\t\t\t\ttitle : '取消创建账号',\r\n\t\t\t\t\t\tmsg : '是否取消创建新账户的操作？',\r\n\t\t\t\t\t\tokLabel : '确定',\r\n\t\t\t\t\t\tokFn : function () {\r\n\t\t\t\t\t\t\tself.model.emit('remove', {\r\n\t\t\t\t\t\t\t\tsuccessFn : function () {\r\n\t\t\t\t\t\t\t\t\tself.modal.hide();\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\r\n\t\t\t})\r\n\t\t}\r\n\t});\r\n\tHualala.User.CreateUserModal = CreateUserModal;\r\n})(jQuery, window);\r\n(function ($, window) {\r\n\tIX.ns(\"Hualala.User\");\r\n\tvar popoverMsg = Hualala.UI.PopoverMsgTip;\r\n\tvar toptip = Hualala.UI.TopTip;\r\n\tvar LoadingModal = Hualala.UI.LoadingModal;\r\n\r\n\tvar PanelGroupCfg = [\r\n\t\t{id : 'bind_mobile', title : \"绑定手机\", panelClz : 'in', expanded : 'true'},\r\n\t\t{id : 'reset_pwd', title : \"重置密码\", panelClz : '', expanded : 'false'}\r\n\t];\r\n\r\n\tvar UserMgrModal = Stapes.subclass({\r\n\t\tconstructor : function (cfg) {\r\n\t\t\tthis.$btnGrp = $XP(cfg, '$btnGrp');\r\n\t\t\tthis.curPanelName = $XP(cfg, 'curPanelName', 'bind_mobile');\r\n\t\t\tthis.userModel = null;\r\n\t\t\tthis.$body = null;\r\n\t\t\tthis.$bindMobilePanel = null;\r\n\t\t\tthis.$resetPWDPanel = null;\r\n\t\t\tthis.panelGrpHT = new IX.IListManager();\r\n\t\t\tthis.initUserModel();\r\n\t\t\tthis.loadTemplates();\r\n\t\t\tthis.bindBtnGrpEvent();\r\n\t\t}\r\n\t});\r\n\tUserMgrModal.proto({\r\n\t\tinitUserModel : function () {\r\n\t\t\tvar self = this,\r\n\t\t\t\tuserData = Hualala.getSessionUser();\r\n\t\t\tuserData = IX.inherit(userData, {\r\n\t\t\t\troleType : $XP(userData, 'role').join(',')\r\n\t\t\t});\r\n\t\t\tself.userModel = new Hualala.User.BaseUserModel(userData);\r\n\t\t},\r\n\t\tupdateCurPanelName : function (curTarget) {\r\n\t\t\tthis.curPanelName = curTarget;\r\n\t\t},\r\n\t\tloadTemplates : function () {\r\n\t\t\tvar layoutTpl = Handlebars.compile(Hualala.TplLib.get('tpl_user_mgr_layout')),\r\n\t\t\t\tbtnTpl = Handlebars.compile(Hualala.TplLib.get('tpl_shop_modal_btns'));\r\n\t\t\t\r\n\t\t\tthis.set({\r\n\t\t\t\tlayoutTpl : layoutTpl,\r\n\t\t\t\tbtnTpl : btnTpl\r\n\t\t\t});\r\n\t\t},\r\n\t\tmapLayoutRenderData : function () {\r\n\t\t\tvar self = this;\r\n\t\t\tvar data = _.map(PanelGroupCfg, function (el) {\r\n\t\t\t\tvar id = $XP(el, 'id');\r\n\t\t\t\treturn IX.inherit(el, {\r\n\t\t\t\t\tpanelClz : id == self.curPanelName ? 'in' : '',\r\n\t\t\t\t\texpanded : id == self.curPanelName ? 'true' : ''\r\n\t\t\t\t});\r\n\t\t\t});\r\n\t\t\treturn {\r\n\t\t\t\tpanelGrpID : 'user_mgr_panel',\r\n\t\t\t\tpanels : data\r\n\t\t\t};\r\n\t\t},\r\n\t\trenderPanelGrpLayout : function () {\r\n\t\t\tvar self = this,\r\n\t\t\t\tlayoutTpl = self.get('layoutTpl');\r\n\t\t\tvar renderData = self.mapLayoutRenderData();\r\n\t\t\tvar htm = layoutTpl(renderData);\r\n\t\t\tself.$body.html(htm);\r\n\t\t\tself.$bindMobilePanel = self.$body.find('#bind_mobile');\r\n\t\t\tself.$resetPWDPanel = self.$body.find('#reset_pwd');\r\n\t\t\tself.panelGrpHT.register('reset_pwd', new Hualala.User.ResetPWDView({\r\n\t\t\t\tmode : 'personal_edit',\r\n\t\t\t\tcontainer : self.$resetPWDPanel.find('.panel-body'),\r\n\t\t\t\tparentView : self,\r\n\t\t\t\tmodel : self.userModel,\r\n\t\t\t\tevtType : 'resetPWD',\r\n\t\t\t\tsuccessFn : function (mUser) {\r\n\t\t\t\t\tvar view = self.panelGrpHT.get('reset_pwd');\r\n\t\t\t\t\tview.$body.find('.btn[name=\"submit\"]').button('reset');\r\n\t\t\t\t},\r\n\t\t\t\tfailFn : function (mUser) {\r\n\t\t\t\t\tvar view = self.panelGrpHT.get('reset_pwd');\r\n\t\t\t\t\tview.$body.find('.btn[name=\"submit\"]').button('reset');\r\n\t\t\t\t}\r\n\t\t\t}));\r\n\t\t\tself.panelGrpHT.register('bind_mobile', new Hualala.User.UserBindMobileView({\r\n\t\t\t\tmode : 'personal_edit',\r\n\t\t\t\tcontainer : self.$bindMobilePanel.find('.panel-body'),\r\n\t\t\t\tparentView : self,\r\n\t\t\t\tmodel : self.userModel,\r\n\t\t\t\tevtType : 'bindMobile',\r\n\t\t\t\tsuccessFn : function (mUser) {\r\n\t\t\t\t\tvar view = self.panelGrpHT.get('bind_mobile');\r\n\t\t\t\t\tview.$body.find('.btn[name=\"submit\"]').button('reset');\r\n\t\t\t\t},\r\n\t\t\t\tfailFn : function (mUser) {\r\n\t\t\t\t\tvar view = self.panelGrpHT.get('bind_mobile');\r\n\t\t\t\t\tview.$body.find('.btn[name=\"submit\"]').button('reset');\r\n\t\t\t\t}\r\n\t\t\t}));\r\n\t\t\tself.renderModalBtns();\r\n\r\n\t\t},\r\n\t\trenderModalBtns : function () {\r\n\t\t\tvar self = this, btnTpl = self.get('btnTpl');\r\n\t\t\tself.modal._.footer.html(btnTpl({\r\n\t\t\t\tbtns : [\r\n\t\t\t\t\t{clz : 'btn-default', name : 'cancel', label : '关闭'}\r\n\t\t\t\t]\r\n\t\t\t}));\r\n\t\t\tself.modal._.footer.find('.btn-default').attr('data-dismiss', 'modal');\r\n\t\t},\r\n\t\tinitModal : function () {\r\n\t\t\tvar self = this;\r\n\t\t\tself.modal = new Hualala.UI.ModalDialog({\r\n\t\t\t\tid : \"user_mgr_modal\",\r\n\t\t\t\tclz : 'account-modal user-mgr-modal',\r\n\t\t\t\ttitle : \"个人管理\",\r\n\t\t\t\t// backdrop : 'static',\r\n\t\t\t\tshowFooter : true,\r\n\t\t\t\tafterHide : function () {\r\n\t\t\t\t\t\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\tself.$body = self.modal._.body;\r\n\t\t\tself.renderPanelGrpLayout();\r\n\r\n\t\t\tself.modal.show();\r\n\t\t},\r\n\t\tbindBtnGrpEvent : function () {\r\n\t\t\tvar self = this;\r\n\t\t\tself.$btnGrp.undelegate('.btn[data-target]', 'click');\r\n\t\t\tself.$btnGrp.delegate('.btn[data-target]', 'click', function(e) {\r\n\t\t\t\tvar $btn = $(this), curTarget = $btn.attr('data-target');\r\n\t\t\t\tself.updateCurPanelName(curTarget);\r\n\t\t\t\tself.initModal();\r\n\t\t\t});\r\n\t\t}\r\n\t});\r\n\tHualala.User.UserMgrModal = UserMgrModal;\r\n})(jQuery, window);;(function ($, window) {\r\n\tIX.ns(\"Hualala.User\");\r\n\tvar popoverMsg = Hualala.UI.PopoverMsgTip;\r\n\tvar toptip = Hualala.UI.TopTip;\r\n\tvar LoadingModal = Hualala.UI.LoadingModal;\r\n\r\n\tvar BindShopModal = Stapes.subclass({\r\n\t\tconstructor : function (cfg) {\r\n\t\t\tthis.$trigger = $XP(cfg, 'trigger', null);\r\n\t\t\tthis.model = $XP(cfg, 'model', null);\r\n\t\t\tthis.parentView = $XP(cfg, 'parentView', null);\r\n\t\t\tthis.modal = null;\r\n\t\t\tthis.$queryBox = null;\r\n\t\t\tthis.$resultBox = null;\r\n\t\t\tthis.queryCtrl = null;\r\n\t\t\tthis.set({\r\n\t\t\t\taccountID : this.model.get('accountID'),\r\n\t\t\t\troleType : $XP(cfg, 'roleType'),\r\n\t\t\t\tmutiSelect : $XP(cfg, 'mutiSelect', false)\r\n\t\t\t});\r\n\t\t\tthis.loadTemplates();\r\n\t\t\tthis.initModal();\r\n\t\t\tthis.render();\r\n\t\t\tthis.bindEvent();\r\n\t\t\tthis.initQueryBox();\r\n\t\t\tthis.emit('show');\r\n\t\t}\r\n\t\t\r\n\t});\r\n\tBindShopModal.proto({\r\n\t\tloadTemplates : function () {\r\n\t\t\tvar layoutTpl = Handlebars.compile(Hualala.TplLib.get('tpl_role_bind_shop')),\r\n\t\t\t\tbtnTpl = Handlebars.compile(Hualala.TplLib.get('tpl_shop_modal_btns'));\r\n\t\t\tthis.set({\r\n\t\t\t\tlayoutTpl : layoutTpl,\r\n\t\t\t\tbtnTpl : btnTpl\r\n\t\t\t});\r\n\t\t},\r\n\t\tinitModal : function () {\r\n\t\t\tvar self = this;\r\n\t\t\tself.modal = new Hualala.UI.ModalDialog({\r\n\t\t\t\tid : 'account_query_shop',\r\n\t\t\t\tclz : 'account-modal',\r\n\t\t\t\ttitle : \"选择所管辖的店铺\",\r\n\t\t\t\tbackdrop : \"static\"\r\n\t\t\t});\r\n\t\t},\r\n\t\trender : function () {\r\n\t\t\tvar self = this, layoutTpl = self.get('layoutTpl'),\r\n\t\t\t\tbtnTpl = self.get('btnTpl');\r\n\t\t\tvar roleInfo = self.model.getRoleInfoByType(self.get('roleType')),\r\n\t\t\t\tname = $XP(roleInfo, 'name', ''),\r\n\t\t\t\tbtns = [\r\n\t\t\t\t\t{clz : 'btn-default', name : 'cancel', label : '取消'},\r\n\t\t\t\t\t{clz : 'btn-warning', name : 'save', label : '确定'}\r\n\t\t\t\t];\r\n\t\t\t\thtm = layoutTpl({\r\n\t\t\t\t\tclz : '',\r\n\t\t\t\t\ttitle : \"选择\" + name + \"所管辖的店铺\"\r\n\t\t\t\t});\r\n\t\t\tself.modal._.body.html(htm);\r\n\t\t\tself.modal._.footer.html(btnTpl({\r\n\t\t\t\tbtns : btns\r\n\t\t\t}));\r\n\t\t\tself.$queryBox = self.modal._.body.find('.query-box');\r\n\t\t\tself.$resultBox = self.modal._.body.find('.result-box');\r\n\t\t},\r\n\t\tbindEvent : function () {\r\n\t\t\tvar self = this;\r\n\t\t\tthis.on({\r\n\t\t\t\t\"show\" : function () {\r\n\t\t\t\t\tself.modal.show();\r\n\t\t\t\t},\r\n\t\t\t\t\"hide\" : function () {\r\n\t\t\t\t\tself.modal.hide();\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\tself.modal._.dialog.find('.btn').on('click', function (e) {\r\n\t\t\t\tvar $btn = $(this),\r\n\t\t\t\t\tact = $btn.attr('name');\r\n\t\t\t\tif (act == 'cancel') {\r\n\t\t\t\t\tself.emit('hide');\r\n\t\t\t\t\tself.parentView.updateRoleBindStatus(self.get('roleType'));\r\n\t\t\t\t} else {\r\n\t\t\t\t\t// 设置角色绑定店铺数据\r\n\t\t\t\t\tself.queryCtrl.emit('bindItems');\r\n\t\t\t\t\tvar mUser = self.model, roleType = self.get('roleType'),\r\n\t\t\t\t\t\troleInfo = mUser.getRoleInfoByType(roleType),\r\n\t\t\t\t\t\titems = !$XP(roleInfo, 'binded') ? [] : $XP(roleInfo, 'items');\r\n\t\t\t\t\tif (items.length > 0) {\r\n\t\t\t\t\t\tself.emit('hide');\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\ttoptip({\r\n\t\t\t\t\t\t\tmsg : \"请选择要绑定的店铺\",\r\n\t\t\t\t\t\t\ttype : 'danger'\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t},\r\n\t\tinitQueryBox : function () {\r\n\t\t\tvar self = this;\r\n\t\t\tself.queryCtrl = new Hualala.User.QueryShopController({\r\n\t\t\t\tcontainer : self.$queryBox,\r\n\t\t\t\tresultContainer : self.$resultBox,\r\n\t\t\t\taccountID : this.model.get('accountID'),\r\n\t\t\t\troleType : self.get('roleType'),\r\n\t\t\t\tmutiSelect : self.get('mutiSelect'),\r\n\t\t\t\tuserModel : self.model\r\n\t\t\t});\r\n\t\t}\r\n\t});\r\n\r\n\tHualala.User.BindShopModal = BindShopModal;\r\n\r\n\t\r\n})(jQuery, window);\r\n\r\n(function ($, window) {\r\n\tIX.ns(\"Hualala.User\");\r\n\tvar popoverMsg = Hualala.UI.PopoverMsgTip;\r\n\tvar toptip = Hualala.UI.TopTip;\r\n\tvar LoadingModal = Hualala.UI.LoadingModal;\r\n\r\n\tvar BindSettleAccountModal = Stapes.subclass({\r\n\t\tconstructor : function (cfg) {\r\n\t\t\tthis.set({\r\n\t\t\t\tsessionData : Hualala.getSessionData()\r\n\t\t\t});\r\n\t\t\tthis.$trigger = $XP(cfg, 'trigger', null);\r\n\t\t\tthis.model = $XP(cfg, 'model', null);\r\n\t\t\tthis.parentView = $XP(cfg, 'parentView', null);\r\n\t\t\tthis.modal = null;\r\n\t\t\tthis.$resultBox = null;\r\n\t\t\tthis.set({\r\n\t\t\t\taccountID : this.model.get('accountID'),\r\n\t\t\t\troleType : $XP(cfg, 'roleType'),\r\n\t\t\t\tmutiSelect : $XP(cfg, 'mutiSelect', false),\r\n\t\t\t\titemsCache : null\r\n\t\t\t});\r\n\t\t\tthis.origSettleData = null;\r\n\t\t\tthis.querySettleCallServer = Hualala.Global.queryAccount;\r\n\t\t\tthis.$body = null;\r\n\t\t\tthis.$footer = null;\r\n\t\t\tthis.$resultBox = null;\r\n\t\t\tthis.loadTemplates();\r\n\t\t\tthis.initModal();\r\n\t\t\tthis.bindEvent();\r\n\t\t\tthis.emit('load');\r\n\t\t\tthis.emit('show');\r\n\t\t}\r\n\t});\r\n\tBindSettleAccountModal.proto({\r\n\t\tloadTemplates : function () {\r\n\t\t\tvar layoutTpl = Handlebars.compile(Hualala.TplLib.get('tpl_role_bind_shop')),\r\n\t\t\t\tlistTpl = Handlebars.compile(Hualala.TplLib.get('tpl_settle_list')),\r\n\t\t\t\titemTpl = Handlebars.compile(Hualala.TplLib.get('tpl_settle_item'));\r\n\t\t\tHandlebars.registerPartial(\"settleItem\", Hualala.TplLib.get('tpl_settle_item'));\r\n\t\t\tHandlebars.registerHelper('checkItemType', function (conditional, options) {\r\n\t\t\t\treturn (conditional == options.hash.type) ? options.fn(this) : options.inverse(this);\r\n\t\t\t});\r\n\t\t\tthis.set({\r\n\t\t\t\tlayoutTpl : layoutTpl,\r\n\t\t\t\tlistTpl : listTpl,\r\n\t\t\t\titemTpl : itemTpl\r\n\t\t\t});\r\n\t\t},\r\n\t\tinitModal : function () {\r\n\t\t\tvar self = this;\r\n\t\t\tself.modal = new Hualala.UI.ModalDialog({\r\n\t\t\t\tid : 'account_query_settle',\r\n\t\t\t\tclz : 'account-modal',\r\n\t\t\t\ttitle : \"选择所管辖的结算账户\",\r\n\t\t\t\tbackdrop : \"static\"\r\n\t\t\t});\r\n\t\t\tself.$body = self.modal._.body;\r\n\t\t\tself.$footer = self.modal._.footer;\r\n\t\t\tvar layoutTpl = self.get('layoutTpl'),\r\n\t\t\t\thtm = layoutTpl({\r\n\t\t\t\t\tclz : '',\r\n\t\t\t\t\ttitle : '选择财务所管辖的结算账户'\r\n\t\t\t\t});\r\n\t\t\tself.$body.html(htm);\r\n\t\t\tself.$resultBox = self.$body.find('.result-box');\r\n\t\t},\r\n\t\tmapRenderData : function (data) {\r\n\t\t\tvar self = this,\r\n\t\t\t\troleType = self.get('roleType'),\r\n\t\t\t\tmutiSelect = self.get('mutiSelect'),\r\n\t\t\t\titemsCache = self.get('itemsCache'),\r\n\t\t\t\tmUser = self.model;\r\n\t\t\tvar roleInfo = mUser.getRoleInfoByType(roleType),\r\n\t\t\t\titems = $XP(roleInfo, 'items', []);\r\n\t\t\titemsCache = !itemsCache ? items : itemsCache;\r\n\t\t\tself.set('itemsCache', itemsCache);\r\n\t\t\tvar ret = _.map(data, function (settle, i, l) {\r\n\t\t\t\tvar id = $XP(settle, 'settleUnitID'),\r\n\t\t\t\t\tchecked = !_.find(itemsCache, function (el) {return el == id}) ? '' : 'checked';\r\n\t\t\t\treturn IX.inherit(settle, {\r\n\t\t\t\t\ttype : !mutiSelect ? 'radio' : 'checkbox',\r\n\t\t\t\t\tclz : 'bind-item',\r\n\t\t\t\t\tsettleUnitNameLabel : $XP(settle, 'settleUnitName', ''),\r\n\t\t\t\t\tchecked : checked\r\n\t\t\t\t});\r\n\t\t\t});\r\n\t\t\t\r\n\t\t\treturn ret;\r\n\t\t},\r\n\t\trender : function (data) {\r\n\t\t\tvar self = this,\r\n\t\t\t\tlistTpl = self.get('listTpl');\r\n\t\t\tvar renderData = self.mapRenderData(data);\r\n\t\t\tvar htm = listTpl({\r\n\t\t\t\tsettleList : {\r\n\t\t\t\t\tlist : renderData\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\tself.$resultBox.html(htm);\r\n\t\t},\r\n\t\tbindEvent : function () {\r\n\t\t\tvar self = this;\r\n\t\t\tthis.on({\r\n\t\t\t\t\"show\" : function () {\r\n\t\t\t\t\tself.modal.show();\r\n\t\t\t\t},\r\n\t\t\t\t\"hide\" : function () {\r\n\t\t\t\t\tself.modal.hide();\r\n\t\t\t\t},\r\n\t\t\t\t\"load\" : function () {\r\n\t\t\t\t\tif (!self.origSettleData) {\r\n\t\t\t\t\t\tself.querySettleCallServer({}, function (res) {\r\n\t\t\t\t\t\t\tif (res.resultcode != '000') {\r\n\t\t\t\t\t\t\t\ttoptip({\r\n\t\t\t\t\t\t\t\t\tmsg : $XP(res, 'resultmsg', ''),\r\n\t\t\t\t\t\t\t\t\ttype : 'danger'\r\n\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\tself.render($XP(res, 'data.records', []));\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tself.render(self.origSettleData);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\tself.$resultBox.tooltip({\r\n\t\t\t\tselector : '[title]'\r\n\t\t\t});\r\n\t\t\tself.$resultBox.delegate(':radio,:checkbox', 'change', function (e) {\r\n\t\t\t\tvar $el = $(this),\r\n\t\t\t\t\tchecked = !this.checked ? false : true,\r\n\t\t\t\t\titemID = $el.val(),\r\n\t\t\t\t\tmutiSelect = self.get('mutiSelect'),\r\n\t\t\t\t\troleType = self.get('roleType');\r\n\t\t\t\tvar mUser = self.model;\r\n\t\t\t\t// mUser.updateRoleBind(roleType, itemID, mutiSelect, checked);\r\n\t\t\t\tself.updateItemsCache(roleType, itemID, mutiSelect, checked);\r\n\t\t\t});\r\n\t\t\tself.$footer.delegate('.btn', 'click', function (e) {\r\n\t\t\t\tvar $btn = $(this),\r\n\t\t\t\t\tact = $btn.hasClass('btn-close') ? 'cancel' : 'ok';\r\n\t\t\t\tvar cache = self.get('itemsCache');\r\n\t\t\t\tif (act == 'cancel') {\r\n\t\t\t\t\tself.emit('hide');\r\n\t\t\t\t\tself.parentView.updateRoleBindStatus(self.get('roleType'));\r\n\t\t\t\t} else {\r\n\t\t\t\t\t// 设置角色绑定店铺数据\r\n\t\t\t\t\tif (!cache || cache.length == 0) {\r\n\t\t\t\t\t\ttoptip({\r\n\t\t\t\t\t\t\tmsg : \"请选择要绑定的结算账户\",\r\n\t\t\t\t\t\t\ttype : 'danger'\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t\treturn ;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tself.bindItems();\r\n\t\t\t\t\tself.emit('hide');\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\t\r\n\t\t},\r\n\t\tupdateItemsCache : function (roleType, itemID, mutiSelect, checked) {\r\n\t\t\tvar self = this;\r\n\t\t\tvar itemsCache = self.get('itemsCache');\r\n\t\t\tif (mutiSelect) {\r\n\t\t\t\tif (!checked) {\r\n\t\t\t\t\titemsCache = _.without(itemsCache, itemID);\r\n\t\t\t\t} else {\r\n\t\t\t\t\titemsCache.push(itemID);\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\titemsCache = [itemID];\r\n\t\t\t}\r\n\t\t\tself.set('itemsCache', itemsCache);\r\n\t\t},\r\n\t\tbindItems : function () {\r\n\t\t\tvar self = this;\r\n\t\t\tvar mUser = self.model,\r\n\t\t\t\troleType = self.get('roleType');\r\n\t\t\tmUser.updateRoleItemsBind(roleType, self.get('itemsCache'));\r\n\t\t}\r\n\t});\r\n\r\n\tHualala.User.BindSettleAccountModal = BindSettleAccountModal;\r\n})(jQuery, window);\r\n\r\n(function ($, window) {\r\n\tIX.ns(\"Hualala.User\");\r\n\tvar popoverMsg = Hualala.UI.PopoverMsgTip;\r\n\tvar toptip = Hualala.UI.TopTip;\r\n\tvar LoadingModal = Hualala.UI.LoadingModal;\r\n\r\n\tvar BindShopMultiModal = Stapes.subclass({\r\n\t\tconstructor : function (cfg) {\r\n\t\t\tthis.set({\r\n\t\t\t\tsessionData : Hualala.getSessionData()\r\n\t\t\t});\r\n\t\t\tthis.$trigger = $XP(cfg, 'trigger', null);\r\n\t\t\tthis.model = $XP(cfg, 'model', null);\r\n\t\t\tthis.parentView = $XP(cfg, 'parentView', null);\r\n\t\t\tthis.modal = null;\r\n\t\t\tthis.$resultBox = null;\r\n\t\t\tthis.set({\r\n\t\t\t\taccountID : this.model.get('accountID'),\r\n\t\t\t\troleType : $XP(cfg, 'roleType'),\r\n\t\t\t\titemsCache : null\r\n\t\t\t});\r\n\t\t\tthis.queryModel = new Hualala.Shop.QueryModel();\r\n\t\t\tthis.$body = null;\r\n\t\t\tthis.$footer = null;\r\n\t\t\tthis.$resultBox = null;\r\n\t\t\tthis.loadTemplates();\r\n\t\t\tthis.initModal();\r\n\t\t\tthis.bindEvent();\r\n\t\t\tthis.emit('load');\r\n\r\n\t\t}\r\n\t});\r\n\tBindShopMultiModal.proto({\r\n\t\tloadTemplates : function () {\r\n\t\t\tvar layoutTpl = Handlebars.compile(Hualala.TplLib.get('tpl_role_bind_shop')),\r\n\t\t\t\tlistTpl = Handlebars.compile(Hualala.TplLib.get('tpl_shops_tree')),\r\n\t\t\t\tcollapseBtnTpl = Handlebars.compile(Hualala.TplLib.get('tpl_collapse_btn')),\r\n\t\t\t\titemTpl = Handlebars.compile(Hualala.TplLib.get('tpl_shop_checkbox'));\r\n\t\t\tHandlebars.registerPartial(\"collapseBtn\", Hualala.TplLib.get('tpl_collapse_btn'));\r\n\t\t\tHandlebars.registerPartial(\"item\", Hualala.TplLib.get('tpl_shop_checkbox'));\r\n\t\t\t\r\n\t\t\tthis.set({\r\n\t\t\t\tlayoutTpl : layoutTpl,\r\n\t\t\t\tlistTpl : listTpl,\r\n\t\t\t\tcollapseBtnTpl : collapseBtnTpl,\r\n\t\t\t\titemTpl : itemTpl\r\n\t\t\t});\r\n\t\t},\r\n\t\tinitModal : function () {\r\n\t\t\tvar self = this;\r\n\t\t\tself.modal = new Hualala.UI.ModalDialog({\r\n\t\t\t\tid : 'account_query_shop',\r\n\t\t\t\tclz : 'account-modal',\r\n\t\t\t\ttitle : \"选择所管辖的店铺\",\r\n\t\t\t\tbackdrop : \"static\"\r\n\t\t\t});\r\n\t\t\tself.$body = self.modal._.body;\r\n\t\t\tself.$footer = self.modal._.footer;\r\n\t\t\tvar layoutTpl = self.get('layoutTpl'),\r\n\t\t\t\thtm = layoutTpl({\r\n\t\t\t\t\tclz : '', \r\n\t\t\t\t\ttitle : \"选择区域经理所管辖的店铺\"\r\n\t\t\t\t});\r\n\t\t\tself.$body.html(htm);\r\n\t\t\tself.$resultBox = self.$body.find('.result-box');\r\n\t\t},\r\n\t\tchkShopBinded : function (shopID) {\r\n\t\t\tvar self = this, itemsCache = self.get('itemsCache');\r\n\t\t\treturn !_.find(itemsCache, function (el) {return el == shopID}) ? false : true;\r\n\t\t},\r\n\t\tmapShopTree : function () {\r\n\t\t\tvar self = this,\r\n\t\t\t\tqueryModel = self.queryModel;\r\n\t\t\tvar cities = queryModel.getCities(),\r\n\t\t\t\tareas = queryModel.getAreas();\r\n\t\t\tvar mapShopData = function (list) {\r\n\t\t\t\tvar curShopLst = queryModel.getShops(list);\r\n\t\t\t\tvar checkedCount = 0;\r\n\t\t\t\tvar shops = _.map(curShopLst, function (shop) {\r\n\t\t\t\t\tvar shopID = $XP(shop, 'shopID'),\r\n\t\t\t\t\t\tshopName = $XP(shop, 'shopName'),\r\n\t\t\t\t\t\tchecked = self.chkShopBinded(shopID);\r\n\t\t\t\t\tchecked && checkedCount++;\r\n\t\t\t\t\treturn {\r\n\t\t\t\t\t\tnodeClz : 'col-sm-4',\r\n\t\t\t\t\t\tnodeType : 'shop',\r\n\t\t\t\t\t\tid : shopID,\r\n\t\t\t\t\t\tname : shopName,\r\n\t\t\t\t\t\tparentID : $XP(shop, 'areaID'),\r\n\t\t\t\t\t\thideCollapse : 'hidden',\r\n\t\t\t\t\t\tchecked : checked ? 'checked' : ''\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t\tvar unBinded = _.reject(shops, function (el) {return el.checked == 'checked';});\r\n\t\t\t\treturn {\r\n\t\t\t\t\tshops : shops,\r\n\t\t\t\t\tchecked : unBinded.length > 0 ? '' : 'checked',\r\n\t\t\t\t\texpanded : checkedCount > 0 ? 'in' : ''\r\n\t\t\t\t};\r\n\t\t\t};\r\n\t\t\tvar mapAreaData = function (list) {\r\n\t\t\t\tvar curAreaLst = queryModel.getAreas(list);\r\n\t\t\t\tvar areas = _.map(curAreaLst, function (area) {\r\n\t\t\t\t\t\tvar areaID = $XP(area, 'areaID'),\r\n\t\t\t\t\t\t\tareaName = $XP(area, 'areaName'),\r\n\t\t\t\t\t\t\tshopLst = $XP(area, 'shopLst', []);\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\treturn IX.inherit({\r\n\t\t\t\t\t\t\tnodeClz : '',\r\n\t\t\t\t\t\t\tnodeType : 'area',\r\n\t\t\t\t\t\t\tid : areaID,\r\n\t\t\t\t\t\t\tname : areaName,\r\n\t\t\t\t\t\t\tparentID : $XP(area, 'cityID'),\r\n\t\t\t\t\t\t\thideCollapse : ''\r\n\t\t\t\t\t\t}, mapShopData(shopLst));\r\n\t\t\t\t\t});\r\n\t\t\t\tvar unBinded = _.reject(areas, function (el) {return el.checked == 'checked';});\r\n\t\t\t\treturn {\r\n\t\t\t\t\tareas : areas,\r\n\t\t\t\t\tchecked : unBinded.length > 0 ? '' : 'checked'\r\n\t\t\t\t};\r\n\t\t\t};\r\n\t\t\treturn _.map(cities, function (city) {\r\n\t\t\t\tvar cityID = $XP(city, 'cityID', ''),\r\n\t\t\t\t\tcityName = $XP(city, 'cityName', ''),\r\n\t\t\t\t\tareaLst = $XP(city, 'areaLst', []);\r\n\t\t\t\t\r\n\t\t\t\treturn IX.inherit({\r\n\t\t\t\t\tnodeClz : '',\r\n\t\t\t\t\tnodeType : 'city',\r\n\t\t\t\t\tid : cityID,\r\n\t\t\t\t\tname : cityName,\r\n\t\t\t\t\tparentID : 'root',\r\n\t\t\t\t\thideCollapse : ''\r\n\t\t\t\t}, mapAreaData(areaLst));\r\n\t\t\t});\r\n\t\t},\r\n\t\tmapRenderData : function () {\r\n\t\t\tvar self = this,\r\n\t\t\t\troleType = self.get('roleType'),\r\n\t\t\t\titemsCache = self.get('itemsCache'),\r\n\t\t\t\tmUser = self.model;\r\n\t\t\tvar roleInfo = mUser.getRoleInfoByType(roleType),\r\n\t\t\t\titems = $XP(roleInfo, 'items', []);\r\n\t\t\titemsCache = !itemsCache ? items : itemsCache;\r\n\t\t\tself.set('itemsCache', itemsCache);\r\n\t\t\treturn self.mapShopTree();\r\n\r\n\t\t},\r\n\t\trender : function () {\r\n\t\t\tvar self = this,\r\n\t\t\t\tlistTpl = self.get('listTpl');\r\n\t\t\tvar renderData = self.mapRenderData();\r\n\t\t\tvar htm = listTpl({\r\n\t\t\t\tcities : renderData\r\n\t\t\t});\r\n\t\t\tself.$resultBox.html(htm);\r\n\t\t},\r\n\t\tbindEvent : function () {\r\n\t\t\tvar self = this;\r\n\t\t\tthis.on({\r\n\t\t\t\t\"show\" : function () {\r\n\t\t\t\t\tself.modal.show();\r\n\t\t\t\t},\r\n\t\t\t\t\"hide\" : function () {\r\n\t\t\t\t\tself.modal.hide();\r\n\t\t\t\t},\r\n\t\t\t\t\"load\" : function () {\r\n\t\t\t\t\tself.queryModel.init($XP(self.get('sessionData'), 'user'), function (_queryModel) {\r\n\t\t\t\t\t\tself.queryModel = _queryModel;\r\n\t\t\t\t\t\tself.render();\r\n\t\t\t\t\t\tself.emit('show');\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\t\r\n\t\t\tvar bindParentNode = function (pID) {\r\n\t\t\t\tif (pID == 'root') return;\r\n\t\t\t\tvar $pEl = $(':checkbox[value=' + pID + ']'),\r\n\t\t\t\t\tparentID = $pEl.attr('data-parent'),\r\n\t\t\t\t\tval = $pEl.val(), name = $pEl.attr('name');\r\n\t\t\t\tvar $childEls = $('#' + name + '_' + val).find(':checkbox');\r\n\t\t\t\tvar unCheckEls = _.reject($childEls, function (el) {\r\n\t\t\t\t\treturn !!el.checked;\r\n\t\t\t\t});\r\n\t\t\t\tif (unCheckEls.length == 0) {\r\n\t\t\t\t\t$pEl[0].checked = true;\r\n\t\t\t\t} else {\r\n\t\t\t\t\t$pEl[0].checked = false;\r\n\t\t\t\t}\r\n\t\t\t\tbindParentNode(parentID);\r\n\t\t\t};\r\n\t\t\tself.$body.delegate(':checkbox', 'change', function (e) {\r\n\t\t\t\tvar $chkBox = $(this), type = $chkBox.attr('name'),\r\n\t\t\t\t\tchecked = !this.checked ? false : true,\r\n\t\t\t\t\tval = $chkBox.val(), parentID = $chkBox.attr('data-parent');\r\n\t\t\t\tif (type == \"shop\") {\r\n\t\t\t\t\t\r\n\t\t\t\t} else if (type == \"area\") {\r\n\t\t\t\t\t\r\n\t\t\t\t} else if (type == \"city\") {\r\n\t\t\t\t\t\r\n\t\t\t\t}\r\n\t\t\t\tif (type == \"area\" || type == \"city\") {\r\n\t\t\t\t\t$('#' + type + '_' + val).find(':checkbox').each(function () {\r\n\t\t\t\t\t\tthis.checked = checked;\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t\tbindParentNode(parentID);\r\n\t\t\t\t\r\n\t\t\t});\r\n\t\t\tself.$body.delegate('.btn-link[data-toggle=\"collapse\"]', 'click', function(event) {\r\n\t\t\t\tvar $btn = $(this), $icon = $btn.find('.glyphicon'),\r\n\t\t\t\t\tcollapsed = $icon.hasClass('glyphicon-chevron-down');\r\n\t\t\t\t$icon.removeClass().addClass(collapsed ? 'glyphicon glyphicon-chevron-up' : 'glyphicon glyphicon-chevron-down');\r\n\t\t\t});\r\n\t\t\tself.$footer.delegate('.btn', 'click', function (e) {\r\n\t\t\t\tvar $btn = $(this),\r\n\t\t\t\t\tact = $btn.hasClass('btn-close') ? 'cancel' : 'ok';\r\n\t\t\t\tvar cache = self.getBindItems();\r\n\t\t\t\tif (act == 'cancel') {\r\n\t\t\t\t\tself.emit('hide');\r\n\t\t\t\t\tself.parentView.updateRoleBindStatus(self.get('roleType'));\r\n\t\t\t\t} else {\r\n\t\t\t\t\t// 设置角色绑定店铺数据\r\n\t\t\t\t\tif (!cache || cache.length == 0) {\r\n\t\t\t\t\t\ttoptip({\r\n\t\t\t\t\t\t\tmsg : \"请选择要绑定的店铺\",\r\n\t\t\t\t\t\t\ttype : 'danger'\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t\treturn ;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tself.bindItems();\r\n\t\t\t\t\tself.emit('hide');\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t},\r\n\t\tgetBindItems : function () {\r\n\t\t\tvar self = this, $els = self.$body.find(':checked[name=shop]');\r\n\t\t\tvar ids = _.map($els, function (el) {\r\n\t\t\t\treturn $(el).val();\r\n\t\t\t});\r\n\t\t\treturn ids;\r\n\t\t},\r\n\t\tbindItems : function () {\r\n\t\t\tvar self = this, mUser = self.model,\r\n\t\t\t\troleType = self.get('roleType');\r\n\t\t\tvar ids = self.getBindItems();\r\n\t\t\tmUser.updateRoleItemsBind(roleType, ids);\r\n\t\t}\r\n\t});\r\n\r\n\tHualala.User.BindShopMultiModal = BindShopMultiModal;\r\n})(jQuery, window);;(function ($, window) {\r\n\tIX.ns(\"Hualala.User\");\r\n\tvar popoverMsg = Hualala.UI.PopoverMsgTip;\r\n\tvar toptip = Hualala.UI.TopTip;\r\n\tvar UserListModel = Stapes.subclass({\r\n\t\t/**\r\n\t\t * 构造用户列表的数据模型\r\n\t\t * @param  {Object} cfg 配置信息\r\n\t\t *         @param {Function} callServer 获取数据接口\r\n\t\t * @return {Object}     数据模型对象\r\n\t\t */\r\n\t\tconstructor : function (cfg) {\r\n\t\t\tthis.callServer = $XP(cfg, 'callServer', null);\r\n\t\t\tif (!this.callServer) {\r\n\t\t\t\tthrow(\"callServer is empty!\");\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t}\r\n\t});\r\n\tUserListModel.proto({\r\n\t\tinit : function (params) {\r\n\t\t\tthis.set({\r\n\t\t\t\tqueryID : $XP(params, 'queryID', ''),\r\n\t\t\t\tds_user : new IX.IListManager()\r\n\t\t\t});\r\n\t\t},\r\n\t\tupdatePagerParams : function (params) {\r\n\t\t\tvar self = this;\r\n\t\t\tvar pagerParamkeys = 'queryID';\r\n\t\t\t_.each(params, function (v, k, l) {\r\n\t\t\t\tif (pagerParamkeys.indexOf(k) > -1) {\r\n\t\t\t\t\tself.set(k, v);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t},\r\n\t\tgetPagerParams : function () {\r\n\t\t\treturn {\r\n\t\t\t\tqueryID : this.get('queryID')\r\n\t\t\t};\r\n\t\t},\r\n\t\tupdateDataStore : function (data) {\r\n\t\t\tvar self = this,\r\n\t\t\t\tuserHT = self.get('ds_user');\r\n\t\t\tvar ids = _.map(data, function (user, i, l) {\r\n\t\t\t\tvar id = $XP(user, 'accountID'),\r\n\t\t\t\t\tmUser = new BaseUserModel(user);\r\n\t\t\t\tuserHT.register(id, mUser);\r\n\t\t\t\treturn id;\r\n\t\t\t});\r\n\t\t\treturn ids;\r\n\t\t},\r\n\t\tresetDataStore : function () {\r\n\t\t\tvar self = this,\r\n\t\t\t\tuserHT = self.get('ds_user');\r\n\t\t\tuserHT.clear();\r\n\t\t},\r\n\t\tremoveUsers : function (ids) {\r\n\t\t\tvar self = this,\r\n\t\t\t\tuserHT = self.get('ds_user');\r\n\t\t\tif (!ids) userHT.clear();\r\n\t\t\tids = IX.isArray(ids) ? ids : [ids];\r\n\t\t\t_.each(ids, function (id) {\r\n\t\t\t\tuserHT.unregister(id);\r\n\t\t\t});\r\n\t\t},\r\n\t\tload : function (params, cbFn) {\r\n\t\t\tvar self = this;\r\n\t\t\tself.updatePagerParams(params);\r\n\t\t\tself.callServer(self.getPagerParams(), function (res) {\r\n\t\t\t\tif (res.resultcode == '000') {\r\n\t\t\t\t\tself.updateDataStore($XP(res, 'data.records', []));\r\n\t\t\t\t\tself.updatePagerParams($XP(res, 'data.page', {}));\r\n\t\t\t\t} else {\r\n\t\t\t\t\ttoptip({\r\n\t\t\t\t\t\tmsg : $XP(res, 'resultmsg', ''),\r\n\t\t\t\t\t\ttype : 'danger'\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t\tcbFn(self);\r\n\t\t\t});\r\n\t\t},\r\n\t\tgetUsers : function (ids) {\r\n\t\t\tvar self = this,\r\n\t\t\t\tuserHT = self.get('ds_user');\r\n\t\t\tvar users = !ids || !IX.isArray(ids) ? userHT.getAll() : userHT.get(ids);\r\n\t\t\tvar ret = _.map(users, function (mUser, i, l) {\r\n\t\t\t\treturn mUser.getAll();\r\n\t\t\t});\r\n\t\t\tIX.Debug.info(\"DEBUG: User List Model Data : \");\r\n\t\t\tIX.Debug.info(ret);\r\n\t\t\treturn ret;\r\n\t\t},\r\n\t\tgetUserModelByUserID : function (userID) {\r\n\t\t\tvar self = this,\r\n\t\t\t\tuserHT = self.get('ds_user');\r\n\t\t\treturn userHT.get(userID);\r\n\t\t},\r\n\t\tgetUserModelByUserLoginName : function (loginName) {\r\n\t\t\tvar self = this,\r\n\t\t\t\tuserHT = self.get('ds_user'),\r\n\t\t\t\tusers = userHT.getAll();\r\n\t\t\treturn _.find(users, function (user) {\r\n\t\t\t\treturn user.get('loginName') == loginName;\r\n\t\t\t});\r\n\t\t},\r\n\t\taddItem : function (mUser) {\r\n\t\t\tvar self = this,\r\n\t\t\t\tuserHT = self.get('ds_user'),\r\n\t\t\t\tid = mUser.get('accountID');\r\n\t\t\tuserHT.register(id, mUser);\r\n\t\t}\r\n\t});\r\n\tHualala.User.UserListModel = UserListModel;\r\n\r\n\tvar BaseUserModel = Stapes.subclass({\r\n\t\tconstructor : function (user) {\r\n\t\t\tthis.resetPWDCallServer = Hualala.Global.resetPWDInShopGroupChildAccount;\r\n\t\t\tthis.editUserCallServer = Hualala.Global.updateShopGroupChildAccount;\r\n\t\t\tthis.addUserCallServer = Hualala.Global.addShopGroupChildAccount;\r\n\t\t\tthis.removeCallServer = Hualala.Global.removeShopGroupChildAccount;\r\n\t\t\tthis.unbindMobileCallServer = Hualala.Global.unbindMobileInShopGroupChildAccount;\r\n\t\t\tthis.bindMobileCallServer = Hualala.Global.bindMobileInShopGroupChildAccount;\r\n\t\t\tthis.updateRoleBindingCallServer = Hualala.Global.updateRoleBinding;\r\n\t\t\tthis.queryRoleBindingCallServer = Hualala.Global.queryRoleBinding;\r\n\t\t\tthis.set(\"ds_role\", new IX.IListManager());\r\n\t\t\tif (!IX.isEmpty(user)) {\r\n\t\t\t\tthis.updateUserModel(user);\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\t// this.mapUserRoles();\r\n\t\t\tthis.bindEvent();\r\n\t\t}\r\n\t});\r\n\tBaseUserModel.proto({\r\n\t\tupdateUserModel : function (user) {\r\n\t\t\tthis.set(user);\r\n\t\t\tthis.updateRoleStore();\r\n\t\t},\r\n\t\tupdateRoleStore : function (roleCfg) {\r\n\t\t\tvar self = this, roleHT = self.get('ds_role'),\r\n\t\t\t\troleTypes = IX.isEmpty(roleCfg) ? (',' + this.get('roleType') + ',') : roleCfg,\r\n\t\t\t\tsiteRoleType = Hualala.TypeDef.SiteRoleType,\r\n\t\t\t\troleHT = self.get('ds_role');\r\n\t\t\troleHT.clear();\r\n\t\t\tvar roles = _.map(siteRoleType, function (role) {\r\n\t\t\t\t\tvar roleType = $XP(role, 'roleType');\r\n\t\t\t\t\tvar ret = null;\r\n\t\t\t\t\tif (IX.isString(roleTypes)) {\r\n\t\t\t\t\t\tret = IX.inherit(role, {\r\n\t\t\t\t\t\t\tbinded : roleTypes.indexOf(',' + roleType + ',') >= 0 ? true : false\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tvar _r = _.find(roleTypes, function (el) {\r\n\t\t\t\t\t\t\treturn $XP(el, 'type') == roleType;\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t\tret = IX.inherit(role, {\r\n\t\t\t\t\t\t\tbinded : !_r ? false : true,\r\n\t\t\t\t\t\t\titems : $XP(_r, 'items', [])\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\t\t\t\t\troleHT.register(roleType, ret);\r\n\t\t\t\t\treturn ret;\r\n\t\t\t\t});\r\n\t\t\t\r\n\t\t\tself.set('roles', roles);\r\n\t\t},\r\n\t\tgetRoleInfoByType : function (roleType) {\r\n\t\t\tvar self = this, roleHT = self.get('ds_role');\r\n\t\t\treturn roleHT.get(roleType);\r\n\t\t},\r\n\t\tupdateRoleItemsBind : function (roleType, items) {\r\n\t\t\tvar self = this;\r\n\t\t\tvar role = self.getRoleInfoByType(roleType);\r\n\t\t\trole.items = items || [];\r\n\r\n\t\t},\r\n\t\tupdateRoleBind : function (roleType, binded) {\r\n\t\t\tvar self = this;\r\n\t\t\tvar role = self.getRoleInfoByType(roleType);\r\n\t\t\trole.binded = !binded ? false : true;\r\n\t\t},\r\n\t\t// mapUserRoles : function () {\r\n\t\t// \tvar roleType = (this.get('roleType') + ',') || '';\r\n\t\t// \tvar siteRoleType = Hualala.TypeDef.SiteRoleType;\r\n\t\t// \tvar roles = _.reject(siteRoleType, function (role) {\r\n\t\t// \t\treturn roleType.indexOf($XP(role, 'roleType', '') + ',') < 0;\r\n\t\t// \t});\r\n\t\t// \tthis.set('roles', roles);\r\n\t\t// },\r\n\t\tgetRoleBindings : function () {\r\n\t\t\tvar self = this,\r\n\t\t\t\troleHT = self.get('ds_role'),\r\n\t\t\t\troles = roleHT.getAll();\r\n\t\t\tvar ret = _.reject(roles, function (role) {return !$XP(role, 'binded');});\r\n\t\t\tret = _.map(ret, function (role) {\r\n\t\t\t\treturn {\r\n\t\t\t\t\ttype : $XP(role, 'roleType'),\r\n\t\t\t\t\titems : $XP(role, 'items', [])\r\n\t\t\t\t};\r\n\t\t\t});\r\n\t\t\treturn ret;\r\n\t\t},\r\n\t\tbindEvent : function () {\r\n\t\t\tvar self = this;\r\n\t\t\tthis.on({\r\n\t\t\t\t\"addUser\" : function (params) {\r\n\t\t\t\t\t// TODO 新建账号基本信息\r\n\t\t\t\t\tvar successFn = $XF(params, 'successFn'),\r\n\t\t\t\t\t\tfailFn = $XF(params, 'failFn'),\r\n\t\t\t\t\t\tpostParams = $XP(params, 'params', {});\r\n\t\t\t\t\tself.addUserCallServer(postParams, function (res) {\r\n\t\t\t\t\t\tif (res.resultcode != '000') {\r\n\t\t\t\t\t\t\ttoptip({\r\n\t\t\t\t\t\t\t\tmsg : $XP(res, 'resultmsg', ''),\r\n\t\t\t\t\t\t\t\ttype : 'danger'\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\tfailFn();\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\ttoptip({\r\n\t\t\t\t\t\t\t\tmsg : \"保存成功!\",\r\n\t\t\t\t\t\t\t\ttype : 'success'\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\tself.updateUserModel($XP(res, 'data.records')[0]);\r\n\t\t\t\t\t\t\tsuccessFn();\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t},\r\n\t\t\t\t\"editUser\" : function (params) {\r\n\t\t\t\t\t// TODO 设置用户基本信息\r\n\t\t\t\t\tvar successFn = $XF(params, 'successFn'),\r\n\t\t\t\t\t\tfailFn = $XF(params, 'failFn'),\r\n\t\t\t\t\t\tpostParams = $XP(params, 'params', {});\r\n\t\t\t\t\tself.editUserCallServer(postParams, function (res) {\r\n\t\t\t\t\t\tif (res.resultcode != '000') {\r\n\t\t\t\t\t\t\ttoptip({\r\n\t\t\t\t\t\t\t\tmsg : $XP(res, 'resultmsg', ''),\r\n\t\t\t\t\t\t\t\ttype : 'danger'\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\tfailFn();\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\ttoptip({\r\n\t\t\t\t\t\t\t\tmsg : \"保存成功!\",\r\n\t\t\t\t\t\t\t\ttype : 'success'\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\tself.set(postParams);\r\n\t\t\t\t\t\t\tsuccessFn();\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t\t\t\r\n\t\t\t\t},\r\n\t\t\t\t\"resetPWD\" : function (params) {\r\n\t\t\t\t\t// TODO 重置用户密码\r\n\t\t\t\t\tvar self = this;\r\n\t\t\t\t\tvar loginPWD = $XP(params, 'params.loginPWD', ''),\r\n\t\t\t\t\t\tpostParams = $XP(params, 'params', {}),\r\n\t\t\t\t\t\tsuccessFn = $XF(params, 'successFn'),\r\n\t\t\t\t\t\tfailFn = $XF(params, 'failFn');\r\n\t\t\t\t\tpostParams = IX.inherit(postParams, {\r\n\t\t\t\t\t\taccountID : self.get('accountID')\r\n\t\t\t\t\t});\r\n\t\t\t\t\tself.resetPWDCallServer(postParams, function (res) {\r\n\t\t\t\t\t\tif (res.resultcode != '000') {\r\n\t\t\t\t\t\t\ttoptip({\r\n\t\t\t\t\t\t\t\tmsg : $XP(res, 'resultmsg', ''),\r\n\t\t\t\t\t\t\t\ttype : 'danger'\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\tfailFn();\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\ttoptip({\r\n\t\t\t\t\t\t\t\tmsg : \"保存成功!\",\r\n\t\t\t\t\t\t\t\ttype : 'success'\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\tsuccessFn();\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t},\r\n\t\t\t\t\"remove\" : function (params) {\r\n\t\t\t\t\t// 删除用户\r\n\t\t\t\t\tvar successFn = $XF(params, 'successFn');\r\n\t\t\t\t\tself.removeCallServer({\r\n\t\t\t\t\t\taccountID : self.get('accountID')\r\n\t\t\t\t\t}, function (res) {\r\n\t\t\t\t\t\tif (res.resultcode != '000') {\r\n\t\t\t\t\t\t\ttoptip({\r\n\t\t\t\t\t\t\t\tmsg : $XP(res, 'resultmsg', ''),\r\n\t\t\t\t\t\t\t\ttype : 'danger'\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\ttoptip({\r\n\t\t\t\t\t\t\t\tmsg : \"删除成功!\",\r\n\t\t\t\t\t\t\t\ttype : 'success'\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\tsuccessFn();\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t},\r\n\t\t\t\t\"editRole\" : function (params) {\r\n\t\t\t\t\t// TODO 设置用户角色权限\r\n\t\t\t\t\tvar successFn = $XF(params, 'successFn'),\r\n\t\t\t\t\t\tfailFn = $XF(params, 'failFn'),\r\n\t\t\t\t\t\tpostData = {\r\n\t\t\t\t\t\t\taccountID : self.get('accountID'),\r\n\t\t\t\t\t\t\troles : JSON.stringify(self.getRoleBindings())\r\n\t\t\t\t\t\t};\r\n\t\t\t\t\t\r\n\t\t\t\t\tself.updateRoleBindingCallServer(postData, function (res) {\r\n\t\t\t\t\t\tif (res.resultcode != '000') {\r\n\t\t\t\t\t\t\ttoptip({\r\n\t\t\t\t\t\t\t\tmsg : $XP(res, 'resultmsg', ''),\r\n\t\t\t\t\t\t\t\ttype : 'danger'\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\tfailFn();\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\ttoptip({\r\n\t\t\t\t\t\t\t\tmsg : \"保存成功!\",\r\n\t\t\t\t\t\t\t\ttype : 'success'\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\tsuccessFn();\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t},\r\n\t\t\t\t\"unbindMobile\" : function (params) {\r\n\t\t\t\t\t// 解绑定手机号\r\n\t\t\t\t\tvar successFn = $XF(params, 'successFn');\r\n\t\t\t\t\tself.unbindMobileCallServer({\r\n\t\t\t\t\t\taccountID : self.get('accountID')\r\n\t\t\t\t\t}, function (res) {\r\n\t\t\t\t\t\tif (res.resultcode !== '000') {\r\n\t\t\t\t\t\t\ttoptip({\r\n\t\t\t\t\t\t\t\tmsg : $XP(res, 'resultmsg', ''),\r\n\t\t\t\t\t\t\t\ttype : 'danger'\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\ttoptip({\r\n\t\t\t\t\t\t\t\tmsg : \"解绑定成功!\",\r\n\t\t\t\t\t\t\t\ttype : 'success'\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\tself.set('mobileBinded', 0);\r\n\t\t\t\t\t\t\tsuccessFn();\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t},\r\n\t\t\t\t\"bindMobile\" : function (params) {\r\n\t\t\t\t\t// 绑定手机号\r\n\t\t\t\t\tvar self = this;\r\n\t\t\t\t\tvar successFn = $XF(params, 'successFn'),\r\n\t\t\t\t\t\tfailFn = $XF(params, 'failFn'),\r\n\t\t\t\t\t\tpostData = IX.inherit($XP(params, 'params', {}), {\r\n\t\t\t\t\t\t\tgroupName : self.get('groupLoginName')\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\tself.bindMobileCallServer(postData, function (res) {\r\n\t\t\t\t\t\tif (res.resultcode != '000') {\r\n\t\t\t\t\t\t\ttoptip({\r\n\t\t\t\t\t\t\t\tmsg : $XP(res, 'resultmsg', ''),\r\n\t\t\t\t\t\t\t\ttype : 'danger'\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\tfailFn();\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\ttoptip({\r\n\t\t\t\t\t\t\t\tmsg : \"绑定成功!\",\r\n\t\t\t\t\t\t\t\ttype : 'success'\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\tself.set({\r\n\t\t\t\t\t\t\t\t'userMobile' : $XP(postData, 'userMobile'),\r\n\t\t\t\t\t\t\t\t'mobileBinded' : 1\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\tsuccessFn();\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t},\r\n\t\t\t\t\"queryRoleBinding\" : function (params) {\r\n\t\t\t\t\tvar successFn = $XF(params, 'successFn'),\r\n\t\t\t\t\t\tfailFn = $XF(params, 'failFn');\r\n\t\t\t\t\tself.queryRoleBindingCallServer({\r\n\t\t\t\t\t\taccountID : self.get('accountID')\r\n\t\t\t\t\t}, function (res) {\r\n\t\t\t\t\t\tif (res.resultcode != '000') {\r\n\t\t\t\t\t\t\ttoptip({\r\n\t\t\t\t\t\t\t\tmsg : $XP(res, 'resultmsg', ''),\r\n\t\t\t\t\t\t\t\ttype : 'danger'\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\tfailFn();\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tself.updateRoleStore($XP(res, 'data.roles', null));\r\n\t\t\t\t\t\t\tsuccessFn();\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\t});\r\n\tHualala.User.BaseUserModel = BaseUserModel;\r\n\t\r\n})(jQuery, window);\r\n(function ($, window) {\r\n\tIX.ns(\"Hualala.User\");\r\n\tvar popoverMsg = Hualala.UI.PopoverMsgTip;\r\n\tvar toptip = Hualala.UI.TopTip;\r\n\r\n\tvar QueryShopResultModel = Hualala.Shop.CardListModel.subclass({\r\n\t\tconstructor : function () {\r\n\t\t\tthis.origData = null;\r\n\t\t\tthis.dataStore = new IX.IListManager();\r\n\t\t}\r\n\t});\r\n\tQueryShopResultModel.proto({\r\n\t\tinitDataStore : function (data) {\r\n\t\t\tvar self = this;\r\n\t\t\tself.origData = data;\r\n\t\t\t_.each(self.origData, function (shop) {\r\n\t\t\t\tself.dataStore.register($XP(shop, 'shopID'), shop);\r\n\t\t\t});\r\n\t\t},\r\n\t\tload : function (params, cbFn) {\r\n\t\t\tvar self = this;\r\n\t\t\tself.updatePagerParams(params);\r\n\t\t\tvar pageNo = self.get('pageNo'),\r\n\t\t\t\tpageSize = self.get('pageSize'),\r\n\t\t\t\tcityID = self.get('cityID'),\r\n\t\t\t\tareaID = self.get('areaID'),\r\n\t\t\t\tkeywordLst = self.get('keywordLst'),\r\n\t\t\t\ttotalSize = 0,\r\n\t\t\t\tstart = (pageNo - 1) * pageSize,\r\n\t\t\t\tend = pageSize * pageNo,\r\n\t\t\t\tpageCount = 0;\r\n\t\t\tvar shops = [];\r\n\t\t\tshops = areaID.length > 0 ? _.filter(self.origData, function (_shop) {\r\n\t\t\t\treturn $XP(_shop, 'areaID') == areaID;\r\n\t\t\t}) : self.origData;\r\n\t\t\tshops = cityID.length > 0 ? _.filter(shops, function (_shop) {\r\n\t\t\t\treturn $XP(_shop, 'cityID') == cityID;\r\n\t\t\t}) : shops;\r\n\t\t\tshops = keywordLst.length > 0 ? _.filter(shops, function (_shop) {\r\n\t\t\t\treturn $XP(_shop, 'shopName') == keywordLst;\r\n\t\t\t}) : shops;\r\n\t\t\ttotalSize = shops.length;\r\n\t\t\tpageCount = Math.ceil(totalSize / pageSize);\r\n\t\t\tshops = _.filter(shops, function (_shop, idx) {\r\n\t\t\t\treturn idx >= start && idx < end;\r\n\t\t\t});\r\n\t\t\tself.updateDataStore(shops, pageNo);\r\n\t\t\tself.updatePagerParams({\r\n\t\t\t\tpageCount : pageCount,\r\n\t\t\t\ttotalSize : totalSize,\r\n\t\t\t\tpageNo : pageNo,\r\n\t\t\t\tpageSize : pageSize\r\n\t\t\t});\r\n\t\t\tcbFn(self);\r\n\t\t}\r\n\t});\r\n\r\n\tHualala.User.QueryShopResultModel = QueryShopResultModel;\r\n})(jQuery, window);\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n;(function ($, window) {\r\n\tIX.ns(\"Hualala.User\");\r\n\tvar popoverMsg = Hualala.UI.PopoverMsgTip;\r\n\tvar toptip = Hualala.UI.TopTip;\r\n\tvar LoadingModal = Hualala.UI.LoadingModal;\r\n\r\n\tvar UserCtrlBtns = [\r\n\t\t{act : \"reviewRole\", label : \"查看权限\", clz : \"btn-info\"},\r\n\t\t{act : \"editRole\", label : \"修改权限\", clz : \"btn-warning\"},\r\n\t\t{act : \"unbindMobile\", label : \"解绑手机\", clz : \"btn-warning\"},\r\n\t\t{act : \"resetPWD\", label : \"重置密码\", clz : \"btn-warning\"},\r\n\t\t{act : \"editUser\", label : \"修改账号\", clz : \"btn-warning\"},\r\n\t\t{act : \"remove\", label : \"删除账号\", clz : \"btn-danger\"}\r\n\t];\r\n\r\n\tvar UserListView = Stapes.subclass({\r\n\t\tconstructor : function () {\r\n\t\t\t// View层容器\r\n\t\t\tthis.$container = null;\r\n\t\t\t// 结果容器\r\n\t\t\tthis.$resultBox = null;\r\n\t\t\t// 结果列表\r\n\t\t\tthis.$list = null;\r\n\t\t\t// 分页容器\r\n\t\t\tthis.$pager = null;\r\n\t\t\t// 搜素栏\r\n\t\t\tthis.$queryBar = null;\r\n\t\t\tthis.$emptyBar = null;\r\n\t\t\tthis.loadTemplates();\r\n\t\t}\r\n\t});\r\n\tUserListView.proto({\r\n\t\tinit : function (cfg) {\r\n\t\t\tthis.$container = $XP(cfg, 'container', null);\r\n\t\t\tthis.model = $XP(cfg, 'model', null);\r\n\t\t\tif (!this.$container || !this.model) {\r\n\t\t\t\tthrow(\"User List View Init Failed!\");\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tthis.initLayout();\r\n\t\t\tthis.keywordLst = '';\r\n\t\t},\r\n\t\tinitLayout : function () {\r\n\t\t\tvar layoutTpl = this.get('layoutTpl');\r\n\t\t\tvar htm = layoutTpl();\r\n\t\t\tthis.$container.append(htm);\r\n\t\t\tthis.$resultBox = this.$container.find('.shop-list');\r\n\t\t\tthis.$list = this.$container.find('.shop-list-body');\r\n\t\t\tthis.$pager = this.$container.find('.page-selection');\r\n\t\t\t\r\n\t\t},\r\n\t\t// 加载View层模版\r\n\t\tloadTemplates : function () {\r\n\t\t\tvar layoutTpl = Handlebars.compile(Hualala.TplLib.get('tpl_shop_list_layout')),\r\n\t\t\t\tlistTpl = Handlebars.compile(Hualala.TplLib.get('tpl_user_list')),\r\n\t\t\t\tqueryTpl = Handlebars.compile(Hualala.TplLib.get('tpl_user_query')),\r\n\t\t\t\tctrlTpl = Handlebars.compile(Hualala.TplLib.get('tpl_user_ctrl')),\r\n\t\t\t\titemTpl = Handlebars.compile(Hualala.TplLib.get('tpl_user_item')),\r\n\t\t\t\tbtnTpl = Handlebars.compile(Hualala.TplLib.get('tpl_shop_modal_btns')),\r\n\t\t\t\troleBindingTpl = Handlebars.compile(Hualala.TplLib.get('tpl_role_binding_info'));\r\n\t\t\tHandlebars.registerPartial(\"userItem\", Hualala.TplLib.get('tpl_user_item'));\r\n\t\t\tthis.set({\r\n\t\t\t\tlayoutTpl : layoutTpl,\r\n\t\t\t\tqueryTpl : queryTpl,\r\n\t\t\t\tctrlTpl : ctrlTpl,\r\n\t\t\t\tlistTpl : listTpl,\r\n\t\t\t\tbtnTpl : btnTpl,\r\n\t\t\t\troleBindingTpl : roleBindingTpl,\r\n\t\t\t\titemTpl : itemTpl\r\n\t\t\t});\r\n\t\t},\r\n\t\t// 获取账号状态的配置\r\n\t\tmapUserStatusLabel : function (s) {\r\n\t\t\tvar self = this,\r\n\t\t\t\tstatus = Hualala.TypeDef.UserStatus;\r\n\t\t\treturn _.find(status, function (o) {\r\n\t\t\t\treturn $XP(o, 'value') == s;\r\n\t\t\t});\r\n\t\t},\r\n\t\t// 格式化列表渲染数据\r\n\t\tmapListRenderData : function (data) {\r\n\t\t\tvar self = this;\r\n\t\t\tvar ret = _.map(data, function (user, i, l) {\r\n\t\t\t\treturn self.mapItemRenderData(user);\r\n\t\t\t});\r\n\t\t\treturn {\r\n\t\t\t\tuserItem : {list : ret}\r\n\t\t\t};\r\n\t\t},\r\n\t\t// 格式化条目渲染数据\r\n\t\tmapItemRenderData : function (user) {\r\n\t\t\tvar self = this;\r\n\t\t\tvar oUserStatus = self.mapUserStatusLabel($XP(user, 'accountStatus'));\r\n\t\t\treturn IX.inherit(user, {\r\n\t\t\t\tclz : '',\r\n\t\t\t\taccountStatusClz : $XP(oUserStatus, 'value') == 0 ? 'label-danger' : 'label-success',\r\n\t\t\t\tmobileIsBinded : $XP(user, 'mobileBinded') == 0 ? false : true,\r\n\t\t\t\taccountStatusLabel : $XP(oUserStatus, 'label'),\r\n\t\t\t\tcellClz : $XP(user, 'mobileBinded') == 0 ? 'text-danger' : ''\r\n\t\t\t});\r\n\t\t},\r\n\t\t// 格式化搜索栏数据\r\n\t\tmapChosenUserData : function () {\r\n\t\t\tvar self = this;\r\n\t\t\tvar users = self.model.getUsers();\r\n\t\t\tvar ret = [];\r\n\t\t\tret.push({\r\n\t\t\t\tname : '账号',\r\n\t\t\t\titems : _.map(users, function (user, i, l) {\r\n\t\t\t\t\treturn {\r\n\t\t\t\t\t\tcode : $XP(user, 'accountID'),\r\n\t\t\t\t\t\tname : $XP(user, 'loginName') + '(' + $XP(user, 'userName') + ')'\r\n\t\t\t\t\t};\r\n\t\t\t\t})\r\n\t\t\t});\r\n\t\t\treturn ret;\r\n\t\t},\r\n\t\t// 渲染View层\r\n\t\trender : function () {\r\n\t\t\tvar self = this,\r\n\t\t\t\tmodel = self.model,\r\n\t\t\t\tpagerParams = model.getPagerParams(),\r\n\t\t\t\tqueryID = $XP(pagerParams, 'queryID', null);\r\n\t\t\tqueryID = IX.isString(queryID) && queryID.length > 0 ? [queryID] : null;\r\n\t\t\tvar users = model.getUsers(queryID);\r\n\t\t\tvar renderData = self.mapListRenderData(users);\r\n\t\t\tvar listTpl = self.get('listTpl');\r\n\t\t\tvar html = listTpl(renderData);\r\n\t\t\tself.$emptyBar && self.$emptyBar.destroy();\r\n\t\t\tself.$list.empty();\r\n\t\t\tif (users.length == 0) {\r\n\t\t\t\tself.$emptyBar = new Hualala.UI.EmptyPlaceholder({\r\n\t\t\t\t\tcontainer : self.$list\r\n\t\t\t\t});\r\n\t\t\t\tself.$emptyBar.show();\r\n\t\t\t} else {\r\n\t\t\t\tself.$list.html(html);\r\n\t\t\t}\r\n\t\t},\r\n\t\t// 渲染单条用户数据\r\n\t\trerenderUser : function (accountID) {\r\n\t\t\tvar self = this,\r\n\t\t\t\tmodel = self.model,\r\n\t\t\t\tmUser = model.getUserModelByUserID(accountID);\r\n\t\t\tvar renderData = self.mapItemRenderData(mUser.getAll()),\r\n\t\t\t\ttpl = self.get('itemTpl'),\r\n\t\t\t\thtm = tpl(renderData);\r\n\t\t\tvar $tr = self.$list.find('tr.user-item[data-id=' + accountID + ']');\r\n\t\t\tif ($tr.length == 0) {\r\n\t\t\t\t$(htm).prependTo(self.$list.find('table.table > tbody'));\r\n\t\t\t} else {\r\n\t\t\t\t$tr.after(htm);\r\n\t\t\t\t$tr.remove();\r\n\t\t\t}\r\n\t\t},\r\n\t\tinitChosenPanel : function () {\r\n\t\t\tvar self = this;\r\n\t\t\tvar matcher = (new Pymatch([]));\r\n\t\t\tvar sections = self.model.getUsers();\r\n\t\t\tvar getMatchedFn = function (searchText) {\r\n\t\t\t\tmatcher.setNames(_.map(sections, function (el) {\r\n\t\t\t\t\treturn IX.inherit(el, {\r\n\t\t\t\t\t\tname : el.loginName,\r\n\t\t\t\t\t\tpy : el.py + ';' + el.loginName + (!el.userMobile ? '' : (';' + el.userMobile.split(';')))\r\n\t\t\t\t\t});\r\n\t\t\t\t}));\r\n\t\t\t\tvar matchedSections = matcher.match(searchText);\r\n\t\t\t\tvar matchedOptions = {};\r\n\t\t\t\t_.each(matchedSections, function (el, i) {\r\n\t\t\t\t\tmatchedOptions[el[0].accountID] = true;\r\n\t\t\t\t});\r\n\t\t\t\treturn matchedOptions;\r\n\t\t\t};\r\n\t\t\tself.$queryBar.find('.navbar-form[role=\"search\"] select').chosen({\r\n\t\t\t\twidth : '200px',\r\n\t\t\t\tplaceholder_text : \"请选择账号\",\r\n\t\t\t\tno_results_text : \"抱歉，没有找到！\",\r\n\t\t\t\tallow_single_deselect : true,\r\n\t\t\t\tgetMatchedFn : getMatchedFn\r\n\t\t\t}).change(function (e) {\r\n\t\t\t\tvar $this = $(this);\r\n\t\t\t\t// self.model.updatePagerParams({queryID : $this.val()});\r\n\t\t\t\tself.keywordLst = $this.val();\r\n\t\t\t});\r\n\t\t},\r\n\t\t// 渲染搜索栏\r\n\t\trenderQueryPanel : function () {\r\n\t\t\tvar self = this;\r\n\t\t\tvar queryTpl = this.get('queryTpl');\r\n\t\t\tvar queryChosenUsers = this.mapChosenUserData();\r\n\t\t\tvar $oldQueryBar = self.$container.find('.shop-query');\r\n\t\t\tif ($oldQueryBar.length > 0) {\r\n\t\t\t\t$oldQueryBar.remove();\r\n\t\t\t}\r\n\t\t\tself.$queryBar = $(queryTpl({\r\n\t\t\t\toptGrp : queryChosenUsers\r\n\t\t\t}));\r\n\r\n\t\t\tself.$container.prepend(self.$queryBar);\r\n\t\t\tself.initChosenPanel();\r\n\t\t},\r\n\t\t// 格式化用户操作按钮渲染数据\r\n\t\tmapUserBtns : function (mUser) {\r\n\t\t\tvar self = this,\r\n\t\t\t\tsessionUser = Hualala.getSessionUser(),\r\n\t\t\t\tsessionLoginName = $XP(sessionUser, 'loginName', '');\r\n\t\t\tvar roleType = mUser.get('roleType'),\r\n\t\t\t\troles = mUser.get('roles'),\r\n\t\t\t\tmobileBinded = mUser.get('mobileBinded'),\r\n\t\t\t\tloginName = mUser.get('loginName');\r\n\t\t\troles = _.filter(roles, function (role) {\r\n\t\t\t\treturn $XP(role, 'binded') == true;\r\n\t\t\t});\r\n\t\t\treturn _.map(UserCtrlBtns, function (el) {\r\n\t\t\t\tvar act = $XP(el, 'act');\r\n\t\t\t\tif (act == 'reviewRole' && (!roles || roles.length == 0)) {\r\n\t\t\t\t\treturn IX.inherit(el, {\r\n\t\t\t\t\t\tclz : el.clz + ' hidden disabled'\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t\tif (act == 'unbindMobile' && mobileBinded == 0) {\r\n\t\t\t\t\treturn IX.inherit(el, {\r\n\t\t\t\t\t\tclz : el.clz + ' hidden disabled'\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t\tif (act == 'remove' && sessionLoginName == loginName) {\r\n\t\t\t\t\treturn IX.inherit(el, {\r\n\t\t\t\t\t\tclz : el.clz + ' hidden disabled'\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t\treturn el;\r\n\t\t\t});\r\n\t\t},\r\n\t\t// 渲染账号控制按钮\r\n\t\trenderUserCtrl : function (userID) {\r\n\t\t\tvar self = this;\r\n\t\t\tvar ctrlTpl = self.get('ctrlTpl');\r\n\t\t\tvar mUser = self.model.getUserModelByUserID(userID),\r\n\t\t\t\troles = mUser.get('roles'),\r\n\t\t\t\tbtns = self.mapUserBtns(mUser);\r\n\t\t\tvar $ctrlBar = $(ctrlTpl({\r\n\t\t\t\t\tid : userID,\r\n\t\t\t\t\tbtns : btns\r\n\t\t\t\t})).hide(),\r\n\t\t\t\t$tr = self.$list.find('tr[data-id=' + userID + ']'),\r\n\t\t\t\to = $tr.offset(),\r\n\t\t\t\to1 = self.$list.find('table tbody').offset(),\r\n\t\t\t\th = $tr.height(),\r\n\t\t\t\tw = $tr.width();\r\n\t\t\t// $tr.append($ctrlBar);\r\n\t\t\tself.$list.find('.table-responsive').append($ctrlBar);\r\n\t\t\t\r\n\t\t\t$ctrlBar.css({\r\n\t\t\t\theight : h + 'px',\r\n\t\t\t\twidth : 0,\r\n\t\t\t\tdisplay : 'block',\r\n\t\t\t\ttop : (o.top - o1.top) + 'px',\r\n\t\t\t\tright : 0\r\n\t\t\t});\r\n\t\t\t$ctrlBar.find('.user-ctrl-box').css({\r\n\t\t\t\twidth : w + 'px',\r\n\t\t\t\theight : h + 'px'\r\n\t\t\t});\r\n\t\t\t$ctrlBar.animate({\r\n\t\t\t\twidth : w + 'px'\r\n\t\t\t}, 400);\r\n\t\t},\r\n\t\tbindEvent : function () {\r\n\t\t\tvar self = this;\r\n\t\t\t// 用户操作按钮交互\r\n\t\t\tself.$list.on('mouseenter', 'tr.user-item', function (e) {\r\n\t\t\t\tvar $tr = $(this), userID = $tr.attr('data-id');\r\n\t\t\t\tself.renderUserCtrl(userID);\r\n\t\t\t\tvar $otherCtrls = self.$list.find('.user-ctrl[data-id!=' + userID + ']');\r\n\t\t\t\t$otherCtrls.length > 0 && $otherCtrls.trigger('mouseleave');\r\n\r\n\t\t\t});\r\n\t\t\tself.$list.on('mouseleave', '.user-ctrl', function (e) {\r\n\t\t\t\tvar $tr = $(this), userID = $tr.attr('data-id'),\r\n\t\t\t\t\t$ctrlBar = self.$list.find('.user-ctrl[data-id=' + userID + ']');\r\n\t\t\t\tvar w = $tr.width();\r\n\t\t\t\t$ctrlBar.animate({\r\n\t\t\t\t\twidth : 0\r\n\t\t\t\t}, 400, function () {\r\n\t\t\t\t\t$ctrlBar.remove();\r\n\t\t\t\t});\r\n\t\t\t\t\r\n\t\t\t});\r\n\t\t\tself.$list.on('click', '.user-ctrl .btn', function (e) {\r\n\t\t\t\tvar $btn = $(this), act = $btn.attr('data-act');\r\n\t\t\t\tvar accountID = $btn.parents('.user-ctrl').attr('data-id'),\r\n\t\t\t\t\tmUser = self.model.getUserModelByUserID(accountID),\r\n\t\t\t\t\tloginName = mUser.get('loginName') || '';\r\n\t\t\t\tswitch(act) {\r\n\t\t\t\t\tcase \"reviewRole\":\r\n\t\t\t\t\t\t// TODO 查看角色权限配置\r\n\t\t\t\t\t\tself.initReviewRoleModal(accountID, act);\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase \"editRole\":\r\n\t\t\t\t\t\t// TODO 编辑角色权限配置\r\n\t\t\t\t\t\tself.initSetRoleModal(accountID, act);\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase \"unbindMobile\":\r\n\t\t\t\t\t\t// TODO 解绑定手机\r\n\t\t\t\t\t\tHualala.UI.Confirm({\r\n\t\t\t\t\t\t\ttitle : '手机号解除绑定',\r\n\t\t\t\t\t\t\tmsg : '是否解除绑定账号(' + loginName + ')的手机号？',\r\n\t\t\t\t\t\t\tokLabel : '解除绑定',\r\n\t\t\t\t\t\t\tokFn : function () {\r\n\t\t\t\t\t\t\t\tself.model.emit(act, {\r\n\t\t\t\t\t\t\t\t\taccountID : accountID,\r\n\t\t\t\t\t\t\t\t\tsuccessFn : function () {\r\n\t\t\t\t\t\t\t\t\t\tself.rerenderUser(accountID);\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase \"resetPWD\":\r\n\t\t\t\t\t\t// TODO 重置密码\r\n\t\t\t\t\t\tself.initResetPWDModal(accountID, act);\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase \"editUser\":\r\n\t\t\t\t\t\t// TODO 编辑用户基本信息\r\n\t\t\t\t\t\tself.initUserBaseInfoModal(accountID, act);\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase \"remove\":\r\n\t\t\t\t\t\t// TODO 删除用户账号\r\n\t\t\t\t\t\tHualala.UI.Confirm({\r\n\t\t\t\t\t\t\ttitle : '删除账号',\r\n\t\t\t\t\t\t\tmsg : '是否删除账号(' + loginName + ')？',\r\n\t\t\t\t\t\t\tokLabel : '删除',\r\n\t\t\t\t\t\t\tokFn : function () {\r\n\t\t\t\t\t\t\t\tself.model.emit(act, {\r\n\t\t\t\t\t\t\t\t\taccountID : accountID,\r\n\t\t\t\t\t\t\t\t\tsuccessFn : function () {\r\n\t\t\t\t\t\t\t\t\t\tvar $curTR = self.$list.find('tr.user-item[data-id=' + accountID + ']');\r\n\t\t\t\t\t\t\t\t\t\tself.renderQueryPanel();\r\n\t\t\t\t\t\t\t\t\t\t$curTR.hide(400, function () {\r\n\t\t\t\t\t\t\t\t\t\t\t$curTR.remove();\r\n\t\t\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\t// 用户查询栏的操作\r\n\t\t\tself.$queryBar.parent().on('click', '.shop-query .btn', function (e) {\r\n\t\t\t\tvar $btn = $(this),\r\n\t\t\t\t\tact = $btn.attr('data-act');\r\n\t\t\t\tif (act == 'query') {\r\n\t\t\t\t\tself.model.updatePagerParams({queryID : (self.keywordLst || null)});\r\n\t\t\t\t\tself.emit('query', self.model.getPagerParams());\r\n\t\t\t\t} else if (act == 'create') {\r\n\t\t\t\t\t// TODO 创建用户向导\r\n\t\t\t\t\tself.initCreateUserModal(act);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\tself.$queryBar.parent().on('keyup', '.shop-query .chosen-container', function (e) {\r\n\t\t\t\tvar $this = $(this);\r\n\t\t\t\tif ($this.hasClass('chosen-container-active') && !$this.hasClass('chosen-with-drop')) {\r\n\t\t\t\t\t$this.find('input').first().trigger('blur.chosen');\r\n\t\t\t\t\tself.$queryBar.find('.query-btn').trigger('click');\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t},\r\n\t\t// 定位搜索的账号\r\n\t\tmoveToTarget : function (params) {\r\n\t\t\tvar self = this;\r\n\t\t\tvar accountID = $XP(params, 'queryID', null);\r\n\t\t\tif (!accountID) return;\r\n\t\t\tvar $tar = self.$list.find('tr.user-item[data-id=' + accountID + ']');\r\n\t\t\t$tar.removeClass('shake');\r\n\t\t\tHualala.Common.smoothScrollMiddle($tar, 400, function () {\r\n\t\t\t\tsetTimeout(function () {\r\n\t\t\t\t\t$tar.addClass('shake');\r\n\r\n\t\t\t\t}, 0);\r\n\t\t\t});\r\n\t\t},\r\n\t\t// 创建重置密码窗口\r\n\t\tinitResetPWDModal : function (accountID, evtType) {\r\n\t\t\tvar self = this, mUser = self.model.getUserModelByUserID(accountID);\r\n\t\t\tvar resetPWDModal = new Hualala.UI.ModalDialog({\r\n\t\t\t\tid : \"reset_pwd_modal\",\r\n\t\t\t\tclz : 'account-modal',\r\n\t\t\t\ttitle : \"重置密码\",\r\n\t\t\t\tafterHide : function () {\r\n\t\t\t\t\tself.resetPWDView = null;\r\n\t\t\t\t\tself.resetPWDModal = null;\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\tresetPWDModal.show();\r\n\t\t\tself.resetPWDModal = resetPWDModal;\r\n\t\t\tself.resetPWDView = new Hualala.User.ResetPWDView({\r\n\t\t\t\tmode : 'edit',\r\n\t\t\t\tparentView : self,\r\n\t\t\t\tmodel : mUser,\r\n\t\t\t\tevtType : evtType,\r\n\t\t\t\tsuccessFn : function (mUser) {\r\n\r\n\t\t\t\t},\r\n\t\t\t\tfailFn : function (mUser) {\r\n\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t},\r\n\t\t// 用户基本信息编辑窗口\r\n\t\tinitUserBaseInfoModal : function (accountID, evtType) {\r\n\t\t\tvar self = this, mUser = self.model.getUserModelByUserID(accountID);\r\n\t\t\tvar userBaseInfoModal = new Hualala.UI.ModalDialog({\r\n\t\t\t\tid : \"user_base_modal\",\r\n\t\t\t\tclz : 'account-modal',\r\n\t\t\t\ttitle : \"修改账号信息\",\r\n\t\t\t\tafterHide : function () {\r\n\t\t\t\t\tself.userBaseInfoView = null;\r\n\t\t\t\t\tself.userBaseInfoModal = null;\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\tuserBaseInfoModal.show();\r\n\t\t\tself.userBaseInfoModal = userBaseInfoModal;\r\n\t\t\tself.userBaseInfoView = new Hualala.User.UserBaseInfoView({\r\n\t\t\t\tmode : 'edit',\r\n\t\t\t\tparentView : self,\r\n\t\t\t\tmodel : mUser,\r\n\t\t\t\tevtType : evtType,\r\n\t\t\t\tsuccessFn : function (mUser) {\r\n\t\t\t\t\tself.rerenderUser(mUser.get('accountID'));\r\n\t\t\t\t\tself.renderQueryPanel();\r\n\t\t\t\t},\r\n\t\t\t\tfailFn : function (mUser) {\r\n\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t},\r\n\t\t// 角色设置窗口\r\n\t\tinitSetRoleModal : function (accountID, evtType) {\r\n\t\t\tvar self = this, mUser = self.model.getUserModelByUserID(accountID);\r\n\t\t\tvar userRoleModal = new Hualala.UI.ModalDialog({\r\n\t\t\t\tid : \"user_role_modal\",\r\n\t\t\t\tclz : \"account-modal\",\r\n\t\t\t\ttitle : \"修改角色信息\",\r\n\t\t\t\tafterHide : function () {\r\n\t\t\t\t\tself.userRoleModal = null;\r\n\t\t\t\t\tself.userRoleView = null;\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\tuserRoleModal.show();\r\n\t\t\tself.userRoleModal = userRoleModal;\r\n\t\t\tself.userRoleView = new Hualala.User.UserRoleView({\r\n\t\t\t\tmode : 'edit',\r\n\t\t\t\tparentView : self,\r\n\t\t\t\tmodel : mUser,\r\n\t\t\t\tevtType : evtType,\r\n\t\t\t\tsuccessFn : function (mUser) {\r\n\t\t\t\t\tself.rerenderUser(mUser.get('accountID'));\r\n\t\t\t\t},\r\n\t\t\t\tfailFn : function (mUser) {\r\n\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t},\r\n\t\trenderRoleBinding : function (mUser, modal, shopSchemaModel, settleData, roles) {\r\n\t\t\tvar self = this;\r\n\t\t\tvar $body = modal._.body, $footer = modal._.footer;\r\n\t\t\tvar accountName = mUser.get('loginName');\r\n\t\t\tvar renderData = _.map(roles, function (role) {\r\n\t\t\t\tvar items = $XP(role, 'items', []),\r\n\t\t\t\t\troleType = $XP(role, 'roleType', '');\r\n\t\t\t\tvar _items = [];\r\n\t\t\t\tif (roleType == 'finance') {\r\n\t\t\t\t\t_items = _.map(items, function (id) {\r\n\t\t\t\t\t\tvar matched = _.find(settleData, function (unit) {\r\n\t\t\t\t\t\t\treturn $XP(unit, 'settleUnitID') == id;\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t\treturn {\r\n\t\t\t\t\t\t\tid : id,\r\n\t\t\t\t\t\t\tname : $XP(matched, 'settleUnitName', '')\r\n\t\t\t\t\t\t};\r\n\t\t\t\t\t});\r\n\t\t\t\t} else if (roleType == 'manager' || roleType == 'area-manager') {\r\n\t\t\t\t\t_items = items.length == 0 ? [] : shopSchemaModel.getShops(items);\r\n\t\t\t\t\t_items = _.map(_items, function (item) {\r\n\t\t\t\t\t\treturn {\r\n\t\t\t\t\t\t\tid : $XP(item, 'shopID'),\r\n\t\t\t\t\t\t\tname : $XP(item, 'shopName')\r\n\t\t\t\t\t\t};\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t\treturn IX.inherit(role, {\r\n\t\t\t\t\titems : _items\r\n\t\t\t\t});\r\n\t\t\t});\r\n\t\t\trenderData = _.reject(renderData, function (el) {\r\n\t\t\t\treturn !$XP(el, 'binded');\r\n\t\t\t});\r\n\t\t\tvar tpl = self.get('roleBindingTpl'),\r\n\t\t\t\tbtnTpl = self.get('btnTpl'),\r\n\t\t\t\tbtns = [\r\n\t\t\t\t\t{clz : 'btn-default', name : 'cancel', label : '关闭'}\r\n\t\t\t\t];\r\n\t\t\tvar htm = tpl({\r\n\t\t\t\taccountName : accountName,\r\n\t\t\t\troles : renderData\r\n\t\t\t});\r\n\t\t\t$body.html(htm);\r\n\t\t\t$footer.html(btnTpl({\r\n\t\t\t\tbtns : btns\r\n\t\t\t}));\r\n\t\t\t$footer.find('.btn').click(function (e) {\r\n\t\t\t\tmodal.hide();\r\n\t\t\t});\r\n\t\t},\r\n\t\t// 查看角色设置窗口\r\n\t\tinitReviewRoleModal : function (accountID, evtType) {\r\n\t\t\tvar self = this, mUser = self.model.getUserModelByUserID(accountID);\r\n\t\t\tself.shopSchemaModel = null;\r\n\t\t\tself.settleData = null;\r\n\t\t\tvar modal = new Hualala.UI.ModalDialog({\r\n\t\t\t\tid : \"user_role_info_modal\",\r\n\t\t\t\tclz : \"account-modal\",\r\n\t\t\t\ttitle : \"查看账号权限设置\",\r\n\t\t\t\tafterHide : function () {\r\n\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\tmodal.show();\r\n\t\t\tvar getShopsData = function (cbFn) {\r\n\t\t\t\tvar shopQueryModel = new Hualala.Shop.QueryModel();\r\n\t\t\t\tshopQueryModel.init({}, cbFn);\r\n\t\t\t};\r\n\t\t\tvar getSettleData = function (cbFn) {\r\n\t\t\t\tvar callServer = Hualala.Global.queryAccount;\r\n\t\t\t\tcallServer({}, function (res) {\r\n\t\t\t\t\tif (res.resultcode != '000') {\r\n\t\t\t\t\t\ttoptip({\r\n\t\t\t\t\t\t\tmsg : $XP(res, 'resultmsg', ''),\r\n\t\t\t\t\t\t\ttype : 'danger'\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t\tmodal.hide();\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tcbFn($XP(res, 'data.records'));\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t};\r\n\t\t\tgetShopsData(function (queryModel) {\r\n\t\t\t\tself.shopSchemaModel = queryModel;\r\n\t\t\t\tgetSettleData(function (data) {\r\n\t\t\t\t\tself.settleData = data;\r\n\t\t\t\t\tmUser.emit('queryRoleBinding', {\r\n\t\t\t\t\t\tsuccessFn : function () {\r\n\t\t\t\t\t\t\tvar roles = mUser.get('roles');\r\n\t\t\t\t\t\t\tself.renderRoleBinding(mUser, modal, self.shopSchemaModel, self.settleData, roles);\r\n\t\t\t\t\t\t\tmodal.show();\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\tfailFn : function () {\r\n\t\t\t\t\t\t\tmodal.hide();\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t});\r\n\t\t\t});\r\n\t\t\t\r\n\t\t},\r\n\t\t// 创建账号\r\n\t\tinitCreateUserModal : function (evtType) {\r\n\t\t\tvar self = this;\r\n\t\t\tself.createUserView = new Hualala.User.CreateUserModal({\r\n\t\t\t\tmode : 'add',\r\n\t\t\t\tparentView : self,\r\n\t\t\t\tevtType : evtType,\r\n\t\t\t\tsuccessFn : function (mUser) {\r\n\t\t\t\t\t// TODO add item to list\r\n\t\t\t\t\tself.model.addItem(mUser);\r\n\t\t\t\t\tself.rerenderUser(mUser.get('accountID'));\r\n\t\t\t\t\tself.renderQueryPanel();\r\n\t\t\t\t},\r\n\t\t\t\tfailFn : function (mUser) {\r\n\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\t});\r\n\tHualala.User.UserListView = UserListView;\r\n\t\r\n})(jQuery, window);\r\n\r\n(function ($, window) {\r\n\tIX.ns(\"Hualala.User\");\r\n\tvar popoverMsg = Hualala.UI.PopoverMsgTip;\r\n\tvar toptip = Hualala.UI.TopTip;\r\n\tvar LoadingModal = Hualala.UI.LoadingModal;\r\n\r\n\tvar QueryShopResultView = Hualala.Shop.CardListView.subclass({\r\n\t\tconstructor : Hualala.Shop.CardListView.prototype.constructor\r\n\t});\r\n\tQueryShopResultView.proto({\r\n\t\tloadTemplates : function () {\r\n\t\t\tvar layoutTpl = Handlebars.compile(Hualala.TplLib.get('tpl_shop_list_layout')),\r\n\t\t\t\tlistTpl = Handlebars.compile(Hualala.TplLib.get('tpl_shop_list')),\r\n\t\t\t\titemTpl = Handlebars.compile(Hualala.TplLib.get('tpl_bind_shop_item'));\r\n\t\t\tHandlebars.registerPartial(\"shopCard\", Hualala.TplLib.get('tpl_bind_shop_item'));\r\n\t\t\tHandlebars.registerHelper('checkItemType', function (conditional, options) {\r\n\t\t\t\treturn (conditional == options.hash.type) ? options.fn(this) : options.inverse(this);\r\n\t\t\t});\r\n\t\t\tthis.set({\r\n\t\t\t\tlayoutTpl : layoutTpl,\r\n\t\t\t\tlistTpl : listTpl,\r\n\t\t\t\titemTpl : itemTpl,\r\n\t\t\t\titemsCache : null\r\n\t\t\t});\r\n\t\t},\r\n\t\tupdateItemsCache : function (roleType, itemID, mutiSelect, checked) {\r\n\t\t\tvar self = this;\r\n\t\t\tvar itemsCache = self.get('itemsCache');\r\n\t\t\tif (mutiSelect) {\r\n\t\t\t\tif (!checked) {\r\n\t\t\t\t\titemsCache = _.without(itemsCache, itemID);\r\n\t\t\t\t} else {\r\n\t\t\t\t\titemsCache.push(itemID);\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\titemsCache = [itemID];\r\n\t\t\t}\r\n\t\t\tself.set('itemsCache', itemsCache);\r\n\t\t},\r\n\t\t// 格式化渲染数据\r\n\t\tmapRenderData : function (data) {\r\n\t\t\tvar self = this;\r\n\t\t\tvar mutiSelect = self.get('mutiSelect'),\r\n\t\t\t\tmUser = self.get('userModel'),\r\n\t\t\t\troleType = self.get('roleType'),\r\n\t\t\t\troleInfo = mUser.getRoleInfoByType(roleType),\r\n\t\t\t\titems = !$XP(roleInfo, 'binded') ? [] : $XP(roleInfo, 'items');\r\n\t\t\tvar itemsCache = self.get('itemsCache');\r\n\t\t\titemsCache = !itemsCache ? items : itemsCache;\r\n\t\t\tself.set('itemsCache', itemsCache);\r\n\t\t\tvar ret = _.map(data, function (shop, i, l) {\r\n\t\t\t\tvar shopID = $XP(shop, 'shopID'),\r\n\t\t\t\t\tchecked = !_.find(itemsCache, function (el) {return el == shopID}) ? '' : 'checked';\r\n\t\t\t\treturn IX.inherit(shop, {\r\n\t\t\t\t\ttype : !mutiSelect ? 'radio' : 'checkbox',\r\n\t\t\t\t\tclz : 'bind-item',\r\n\t\t\t\t\tshopNameLabel : $XP(shop, 'shopName', ''),\r\n\t\t\t\t\tchecked : checked\r\n\t\t\t\t});\r\n\t\t\t});\r\n\t\t\treturn {\r\n\t\t\t\tshopCard : {\r\n\t\t\t\t\tlist : ret\r\n\t\t\t\t}\r\n\t\t\t};\r\n\t\t},\r\n\t\trender : function (viewCfg) {\r\n\t\t\tvar self = this,\r\n\t\t\t\tmodel = self.model,\r\n\t\t\t\tpagerParams = model.getPagerParams(),\r\n\t\t\t\tpageNo = $XP(pagerParams, 'pageNo');\r\n\t\t\tthis.set(viewCfg);\r\n\t\t\tvar shops = model.getShops(pageNo);\r\n\t\t\tvar renderData = self.mapRenderData(shops);\r\n\t\t\tvar listTpl = self.get('listTpl');\r\n\t\t\tvar html = listTpl(renderData);\r\n\t\t\tself.$list.empty();\r\n\t\t\tself.$list.html(html);\r\n\t\t\tself.initPager({\r\n\t\t\t\ttotal : model.get('pageCount'),\r\n\t\t\t\tpage : model.get('pageNo'),\r\n\t\t\t\thref : 'javascript:void(0);'\r\n\t\t\t});\r\n\t\t},\r\n\t\tbindEvent : function () {\r\n\t\t\tvar self = this;\r\n\t\t\tself.$list.tooltip({\r\n\t\t\t\tselector : '[title]'\r\n\t\t\t});\r\n\t\t\tself.$list.delegate(':radio,:checkbox', 'change', function (e) {\r\n\t\t\t\tvar $el = $(this),\r\n\t\t\t\t\tchecked = !this.checked ? false : true,\r\n\t\t\t\t\titemID = $el.val(),\r\n\t\t\t\t\tmutiSelect = self.get('mutiSelect'),\r\n\t\t\t\t\troleType = self.get('roleType');\r\n\t\t\t\tvar mUser = self.get('userModel');\r\n\t\t\t\t// mUser.updateRoleBind(roleType, itemID, mutiSelect, checked);\r\n\t\t\t\tself.updateItemsCache(roleType, itemID, mutiSelect, checked);\r\n\t\t\t});\r\n\t\t\tself.$pager.on('page', function (e, pageNo) {\r\n\t\t\t\tvar params = self.model.getPagerParams();\r\n\t\t\t\tparams['pageNo'] = pageNo;\r\n\t\t\t\tself.model.emit('load', IX.inherit(params, {\r\n\t\t\t\t\tpageNo : $XP(params, 'pageNo', 1),\r\n\t\t\t\t\tpageSize : $XP(params, 'pageSize', 15)\r\n\t\t\t\t}));\r\n\t\t\t});\r\n\t\t},\r\n\t\tbindItems : function () {\r\n\t\t\tvar self = this;\r\n\t\t\tvar mUser = self.get('userModel'),\r\n\t\t\t\troleType = self.get('roleType');\r\n\t\t\tmUser.updateRoleItemsBind(roleType, self.get('itemsCache'));\r\n\t\t}\r\n\t});\r\n\r\n\tHualala.User.QueryShopResultView = QueryShopResultView;\r\n})(jQuery, window);;(function ($, window) {\r\n\tIX.ns(\"Hualala.User\");\r\n\tvar popoverMsg = Hualala.UI.PopoverMsgTip;\r\n\tvar toptip = Hualala.UI.TopTip;\r\n\tvar LoadingModal = Hualala.UI.LoadingModal;\r\n\r\n\tvar UserListModel = Hualala.User.UserListModel;\r\n\tvar UserListView = Hualala.User.UserListView;\r\n\tvar UserListController = Stapes.subclass({\r\n\t\t/**\r\n\t\t * 店铺用户管理列表控制器\r\n\t\t * @param  {Object} cfg 配置参数\r\n\t\t *         @param {jQuery Object} container 容器\r\n\t\t *         @param {Object} view 用户列表的View层实例\r\n\t\t *         @param {Object} model 用户列表的数据层实例\r\n\t\t * @return {Object}     控制器对象\r\n\t\t */\r\n\t\tconstructor : function (cfg) {\r\n\t\t\tthis.set({\r\n\t\t\t\tsessionData : Hualala.getSessionData()\r\n\t\t\t});\r\n\t\t\tthis.container = $XP(cfg, 'container', null);\r\n\t\t\tthis.view = $XP(cfg, 'view', null);\r\n\t\t\tthis.model = $XP(cfg, 'model', null);\r\n\t\t\tif (!this.container || !this.view || !this.model ) {\r\n\t\t\t\tthrow(\"User List init faild!!\");\r\n\t\t\t}\r\n\t\t\tthis.isReady = false;\r\n\t\t\tthis.bindEvent();\r\n\t\t\tthis.init();\r\n\t\t}\r\n\t});\r\n\tUserListController.proto({\r\n\t\tinit : function (params) {\r\n\t\t\tthis.model.init(params);\r\n\t\t\tthis.view.init({\r\n\t\t\t\tmodel : this.model,\r\n\t\t\t\tcontainer : this.container\r\n\t\t\t});\r\n\t\t\tthis.loadingModal = new LoadingModal({start : 100});\r\n\t\t\tthis.isReady = true;\r\n\t\t\tthis.emit('load', {});\r\n\t\t},\r\n\t\thasReady : function () {return this.isReady;},\r\n\t\tbindEvent : function () {\r\n\t\t\tthis.on({\r\n\t\t\t\tload : function (params) {\r\n\t\t\t\t\tvar self = this;\r\n\t\t\t\t\tif (!self.hasReady()) {\r\n\t\t\t\t\t\tself.init(params);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tself.model.emit('load', params);\r\n\t\t\t\t}\r\n\t\t\t}, this);\r\n\t\t\tthis.model.on({\r\n\t\t\t\tload : function (params) {\r\n\t\t\t\t\tvar self = this;\r\n\t\t\t\t\tvar cbFn = function () {\r\n\t\t\t\t\t\tself.view.emit('render');\r\n\t\t\t\t\t\tself.loadingModal.hide();\r\n\t\t\t\t\t};\r\n\t\t\t\t\tself.loadingModal.show();\r\n\t\t\t\t\tself.model.load(params, cbFn);\r\n\t\t\t\t},\r\n\t\t\t\tunbindMobile : function (params) {\r\n\t\t\t\t\tvar self = this;\r\n\t\t\t\t\tvar mUser = self.model.getUserModelByUserID($XP(params, 'accountID'));\r\n\t\t\t\t\tmUser.emit('unbindMobile', {\r\n\t\t\t\t\t\tsuccessFn : function () {\r\n\t\t\t\t\t\t\t$XF(params, 'successFn')();\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t},\r\n\t\t\t\tremove : function (params) {\r\n\t\t\t\t\tvar self = this;\r\n\t\t\t\t\tvar accountID = $XP(params, 'accountID'),\r\n\t\t\t\t\t\tmUser = self.model.getUserModelByUserID(accountID);\r\n\t\t\t\t\tmUser.emit('remove', {\r\n\t\t\t\t\t\tsuccessFn : function () {\r\n\t\t\t\t\t\t\tself.model.removeUsers(accountID);\r\n\t\t\t\t\t\t\t$XF(params, 'successFn')();\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t},\r\n\t\t\t\tresetPWD : function (params) {\r\n\t\t\t\t\tvar self = this;\r\n\t\t\t\t\tvar mUser = self.model.getUserModelByUserID($XP(params, 'accountID'));\r\n\t\t\t\t\tmUser.emit('resetPWD', params);\r\n\t\t\t\t}\r\n\t\t\t}, this);\r\n\t\t\tthis.view.on({\r\n\t\t\t\trender : function () {\r\n\t\t\t\t\tvar self = this;\r\n\t\t\t\t\tself.view.render();\r\n\t\t\t\t\tself.view.renderQueryPanel();\r\n\t\t\t\t\tself.view.bindEvent();\r\n\t\t\t\t},\r\n\t\t\t\tquery : function (params) {\r\n\t\t\t\t\tvar self = this;\r\n\t\t\t\t\tself.view.moveToTarget(params);\r\n\t\t\t\t}\r\n\t\t\t}, this);\r\n\t\t}\r\n\t});\r\n\tHualala.User.UserListController = UserListController;\r\n\t\r\n})(jQuery, window);\r\n(function ($, window) {\r\n\tIX.ns(\"Hualala.User\");\r\n\tvar popoverMsg = Hualala.UI.PopoverMsgTip;\r\n\tvar toptip = Hualala.UI.TopTip;\r\n\tvar LoadingModal = Hualala.UI.LoadingModal;\r\n\r\n\tvar QueryShopController = Hualala.Shop.QueryController.subclass({\r\n\t\tconstructor : function (cfg) {\r\n\t\t\tthis.set({\r\n\t\t\t\tsessionData : Hualala.getSessionData()\r\n\t\t\t});\r\n\t\t\tthis.container = $XP(cfg, 'container', null);\r\n\t\t\tthis.resultContainer = $XP(cfg, 'resultContainer', null);\r\n\t\t\tthis.set({\r\n\t\t\t\taccountID : $XP(cfg, 'accountID', ''),\r\n\t\t\t\troleType : $XP(cfg, 'roleType', ''),\r\n\t\t\t\tmutiSelect : $XP(cfg, 'mutiSelect', false),\r\n\t\t\t\tuserModel : $XP(cfg, 'userModel')\r\n\t\t\t});\r\n\t\t\tthis.model = new Hualala.Shop.QueryModel();\r\n\t\t\tthis.view = new Hualala.Shop.QueryView();\r\n\t\t\tthis.resultController = new Hualala.User.QueryShopResultController({\r\n\t\t\t\tcontainer : this.resultContainer,\r\n\t\t\t\tmodel : new Hualala.User.QueryShopResultModel(),\r\n\t\t\t\tview : new Hualala.User.QueryShopResultView()\r\n\t\t\t});\r\n\t\t\tthis.init();\r\n\t\t}\r\n\t});\r\n\tQueryShopController.proto({\r\n\t\tinit : function () {\r\n\t\t\tvar self = this;\r\n\t\t\tself.bindEvent();\r\n\t\t\tself.model.emit('load', function () {\r\n\t\t\t\tif (!self.model.hasReady()) {\r\n\t\t\t\t\tthrow(\"Shop Query Init Failed!\");\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\tself.resultController.initDataStore(self.model.getShops(), {\r\n\t\t\t\t\taccountID : self.get('accountID'),\r\n\t\t\t\t\troleType : self.get('roleType'),\r\n\t\t\t\t\tmutiSelect : self.get('mutiSelect'),\r\n\t\t\t\t\tuserModel : self.get('userModel')\r\n\t\t\t\t});\r\n\t\t\t\tself.view.emit('init');\r\n\t\t\t\tself.emit('reset');\r\n\t\t\t});\r\n\t\t},\r\n\t\tbindEvent : function () {\r\n\t\t\tthis.on({\r\n\t\t\t\treload : function () {\r\n\t\t\t\t\tvar self = this;\r\n\t\t\t\t\tself.model.distory();\r\n\t\t\t\t\tself.view.distory();\r\n\t\t\t\t\tself.init();\r\n\t\t\t\t},\r\n\t\t\t\tquery : function (params) {\r\n\t\t\t\t\tvar self = this;\r\n\t\t\t\t\tIX.Debug.info('DEBUG: User Query Shops Params:');\r\n\t\t\t\t\tIX.Debug.info(params);\r\n\t\t\t\t\tself.resultController && self.resultController.emit('load', IX.inherit(params, {\r\n\t\t\t\t\t\tpageNo : 1,\r\n\t\t\t\t\t\tpageSize : 50\r\n\t\t\t\t\t}));\r\n\t\t\t\t},\r\n\t\t\t\tbindItems : function () {\r\n\t\t\t\t\tvar self = this;\r\n\t\t\t\t\tself.resultController && self.resultController.emit('bindItems');\r\n\t\t\t\t},\r\n\t\t\t\treset : function () {\r\n\t\t\t\t\tvar self = this;\r\n\t\t\t\t\tvar mUser = self.get('userModel'),\r\n\t\t\t\t\t\troleType = self.get('roleType'),\r\n\t\t\t\t\t\troleInfo = mUser.getRoleInfoByType(roleType),\r\n\t\t\t\t\t\titems = !$XP(roleInfo, 'binded') ? [] : $XP(roleInfo, 'items');\r\n\t\t\t\t\tif (items.length > 0) {\r\n\t\t\t\t\t\tself.view.keywordLst = items[0];\r\n\t\t\t\t\t\tvar shop = self.view.model.getShops(items)[0],\r\n\t\t\t\t\t\t\tcityID = $XP(shop, 'cityID', -1),\r\n\t\t\t\t\t\t\tareaID = $XP(shop, 'areaID', -1);\r\n\t\t\t\t\t\tself.view.updateFilterCityLayout(cityID);\r\n\t\t\t\t\t\tself.view.updateFilterAreaLayout(areaID);\r\n\t\t\t\t\t\tself.emit('query', self.view.getQueryParams());\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t}\r\n\t\t\t}, this);\r\n\t\t\tthis.model.on({\r\n\t\t\t\tload :function (cbFn) {\r\n\t\t\t\t\tvar self = this,\r\n\t\t\t\t\t\tparams = {\r\n\t\t\t\t\t\t\taccountID : self.get('accountID')\r\n\t\t\t\t\t\t};\r\n\t\t\t\t\tself.model.init(params, cbFn);\r\n\t\t\t\t}\r\n\t\t\t}, this);\r\n\t\t\tthis.view.on({\r\n\t\t\t\tinit : function () {\r\n\t\t\t\t\tvar self = this;\r\n\t\t\t\t\tself.view.init({\r\n\t\t\t\t\t\tmodel : self.model,\r\n\t\t\t\t\t\tcontainer : self.container\r\n\t\t\t\t\t});\r\n\t\t\t\t},\r\n\t\t\t\tfilter : function (params) {\r\n\t\t\t\t\tvar self = this;\r\n\t\t\t\t\tself.emit('query', params);\r\n\t\t\t\t},\r\n\t\t\t\tquery : function (params) {\r\n\t\t\t\t\tvar self = this;\r\n\t\t\t\t\tself.emit('query', params);\r\n\t\t\t\t}\r\n\t\t\t}, this);\r\n\t\t}\r\n\t});\r\n\tHualala.User.QueryShopController = QueryShopController;\r\n})(jQuery, window);\r\n\r\n(function ($, window) {\r\n\tIX.ns(\"Hualala.User\");\r\n\tvar popoverMsg = Hualala.UI.PopoverMsgTip;\r\n\tvar toptip = Hualala.UI.TopTip;\r\n\tvar LoadingModal = Hualala.UI.LoadingModal;\r\n\r\n\tvar QueryShopResultController = Hualala.Shop.ShopListController.subclass({\r\n\t\tconstructor : Hualala.Shop.ShopListController.prototype.constructor\r\n\t});\r\n\tQueryShopResultController.proto({\r\n\t\tinitDataStore : function (data, params) {\r\n\t\t\tthis.model.initDataStore(data);\r\n\t\t\tthis.set(params);\r\n\t\t},\r\n\t\tbindEvent : function () {\r\n\t\t\tthis.on({\r\n\t\t\t\tload : function (params) {\r\n\t\t\t\t\tvar self = this;\r\n\t\t\t\t\tif (!self.hasReady()) {\r\n\t\t\t\t\t\tself.init(params);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tself.model.emit('load', params);\r\n\t\t\t\t},\r\n\t\t\t\tbindItems : function () {\r\n\t\t\t\t\tvar self = this;\r\n\t\t\t\t\tself.view.bindItems();\r\n\t\t\t\t}\r\n\t\t\t}, this);\r\n\t\t\tthis.model.on({\r\n\t\t\t\tload : function (params) {\r\n\t\t\t\t\tvar self = this;\r\n\t\t\t\t\tvar cbFn = function () {\r\n\t\t\t\t\t\tself.view.emit('render');\r\n\t\t\t\t\t};\r\n\t\t\t\t\tself.model.load(params, cbFn);\r\n\t\t\t\t}\r\n\t\t\t}, this);\r\n\t\t\tthis.view.on({\r\n\t\t\t\trender : function () {\r\n\t\t\t\t\tvar self = this;\r\n\t\t\t\t\tself.view.render(this.getAll());\r\n\t\t\t\t},\r\n\t\t\t\treloadPager : function () {\r\n\t\t\t\t\tvar self = this;\r\n\t\t\t\t\tself.view.initPager(params);\r\n\t\t\t\t}\r\n\t\t\t}, this);\r\n\t\t}\r\n\t});\r\n\tHualala.User.QueryShopResultController = QueryShopResultController;\r\n})(jQuery, window);;(function ($, window) {\r\n\tIX.ns(\"Hualala.User\");\r\n\tvar initUserMgrPage = function () {\r\n\t\tvar $body = $('#ix_wrapper > .ix-body > .container');\r\n\t\tvar panel = new Hualala.User.UserListController({\r\n\t\t\tcontainer : $body,\r\n\t\t\tmodel : new Hualala.User.UserListModel({callServer : Hualala.Global.queryShopGroupChildAccount}),\r\n\t\t\tview : new Hualala.User.UserListView()\r\n\t\t});\r\n\t};\r\n\tHualala.User.UserListInit = initUserMgrPage;\r\n})($, window);;(function ($, window) {\r\n\tIX.ns(\"Hualala.CRM\");\r\n\tvar popoverMsg = Hualala.UI.PopoverMsgTip;\r\n\tvar toptip = Hualala.UI.TopTip;\r\n\tvar LoadingModal = Hualala.UI.LoadingModal;\r\n\r\n\t/*图标相关配置信息*/\r\n\tvar BaseChartTitle = {\r\n\t\ttext : '', subtext : '', x : 'center', y : 'top', textAlign : 'center'\r\n\t};\r\n\tvar BaseChartTooltip = {\r\n\t\ttrigger : 'item',\r\n\t\tformatter : \"{a} <br/>{b} : {c} (约{d}%)\"\r\n\t};\r\n\tvar BaseChartToolBox = {\r\n\t\tshow : true,\r\n\t\tfeature : {\r\n\t\t\tmark : {show : false},\r\n\t\t\tdataView : {show : false, readOnly : true},\r\n\t\t\trestore : {show : true},\r\n\t\t\tsaveAsImage : {show : true}\r\n\t\t}\r\n\t};\r\n\tvar BaseChartLegend = {\r\n\t\torient : 'vertical',\r\n\t\tx : 'left',\r\n\t\ty : '50px',\r\n\t\tdata : null\r\n\t};\r\n\r\n\tvar MemberSchemaChartConfigs = [\r\n\t\t{id : \"member_level_chart\", clz : \"col-xs-12 col-sm-6 \", chartClz : \"ix-chart-canvas\", label : \"会员等级占比图\"},\r\n\t\t{id : \"member_gender_chart\", clz : \"col-xs-12 col-sm-6 \", chartClz : \"ix-chart-canvas\", label : \"会员性别占比\"},\r\n\t\t{id : \"member_source_chart\", clz : \"col-xs-12 col-sm-12 \", chartClz : \"ix-chart-canvas\", label : \"会员来源占比图\"}\r\n\t];\r\n\tHualala.CRM.BaseChartTitle = BaseChartTitle;\r\n\tHualala.CRM.BaseChartTooltip = BaseChartTooltip;\r\n\tHualala.CRM.BaseChartToolBox = BaseChartToolBox;\r\n\tHualala.CRM.BaseChartLegend = BaseChartLegend;\r\n\tHualala.CRM.MemberSchemaChartConfigs = MemberSchemaChartConfigs;\r\n\r\n\tvar MemberSchemaTableHeaderConfigs = [\r\n\t\t{\r\n\t\t\tclz : '',\r\n\t\t\tcols : [\r\n\t\t\t\t{clz : '', label : '会员等级', colspan : '', rowspan : '2'},\r\n\t\t\t\t{clz : '', label : '会员数', colspan : '', rowspan : '2'},\r\n\t\t\t\t{clz : '', label : '所占比率', colspan : '', rowspan : '2'},\r\n\t\t\t\t{clz : '', label : '性别比率', colspan : '3', rowspan : ''},\r\n\t\t\t\t{clz : '', label : '来源比率', colspan : '2', rowspan : ''},\r\n\t\t\t\t{clz : '', label : '储值余额', colspan : '', rowspan : '2'},\r\n\t\t\t\t{clz : '', label : '积分余额', colspan : '', rowspan : '2'},\r\n\t\t\t\t{clz : '', label : '客单价<br/>(平均每单消费金额)', colspan : '', rowspan : '2'}\r\n\t\t\t]\r\n\t\t},\r\n\t\t{\r\n\t\t\tclz : '',\r\n\t\t\tcols : [\r\n\t\t\t\t{clz : '', label : '男', colspan : '', rowspan : ''},\r\n\t\t\t\t{clz : '', label : '女', colspan : '', rowspan : ''},\r\n\t\t\t\t{clz : '', label : '未知', colspan : '', rowspan : ''},\r\n\t\t\t\t{clz : '', label : '线上', colspan : '', rowspan : ''},\r\n\t\t\t\t{clz : '', label : '线下', colspan : '', rowspan : ''}\r\n\t\t\t]\r\n\t\t}\r\n\t];\r\n\tHualala.CRM.MemberSchemaTableHeaderConfigs = MemberSchemaTableHeaderConfigs;\r\n\r\n\tvar MemberSchemaModel = Stapes.subclass({\r\n\t\tconstructor : function (cfg) {\r\n\t\t\tthis.callServer = $XP(cfg, 'callServer', Hualala.Global.queryCrmMemberSchema);\r\n\t\t\tif (!this.callServer) {\r\n\t\t\t\tthrow(\"callServer is empty!\");\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t}\r\n\t});\r\n\tMemberSchemaModel.proto({\r\n\t\tinit : function (params) {\r\n\t\t\tthis.set({\r\n\t\t\t\tds_member : new IX.IListManager(),\r\n\t\t\t\tmemberSummarize : null\r\n\t\t\t});\r\n\t\t},\r\n\t\tload : function (params, cbFn) {\r\n\t\t\tvar self = this;\r\n\t\t\tself.callServer(params, function (res) {\r\n\t\t\t\tif (res.resultcode == '000') {\r\n\t\t\t\t\tself.updateDataStore($XP(res, 'data', {}));\r\n\t\t\t\t} else {\r\n\t\t\t\t\ttoptip({\r\n\t\t\t\t\t\tmsg : $XP(res, 'resultmsg', ''),\r\n\t\t\t\t\t\ttype : 'danger'\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t\tcbFn.apply(self);\r\n\t\t\t});\r\n\t\t},\r\n\t\tupdateDataStore : function (data) {\r\n\t\t\tvar self = this,\r\n\t\t\t\tmemberHT = self.get('ds_member');\r\n\t\t\tvar summarize = $XP(data, 'datasets.cardOverViewSummerrizingDs.data.records', []),\r\n\t\t\t\tmembers = $XP(data, 'records', []);\r\n\t\t\t_.each(members, function (m) {\r\n\t\t\t\tvar cardLevelName = $XP(m, 'cardLevelName');\r\n\t\t\t\tmemberHT.register(cardLevelName, m);\r\n\t\t\t});\r\n\t\t\tself.set('memberSummarize', summarize);\r\n\t\t},\r\n\t\tgetMemberByLevelNames : function (names) {\r\n\t\t\tvar self = this,\r\n\t\t\t\tmemberHT = self.get('ds_member');\r\n\t\t\tnames = IX.isString(names) ? [names] : names;\r\n\t\t\tif (IX.isEmpty(names)) {\r\n\t\t\t\treturn memberHT.getAll();\r\n\t\t\t}\r\n\t\t\treturn memberHT.getByKeys(names);\r\n\t\t},\r\n\t\tgetLevelChartData : function () {\r\n\t\t\tvar self = this,\r\n\t\t\t\tmembers = self.getMemberByLevelNames();\r\n\t\t\treturn _.map(members, function (m) {\r\n\t\t\t\treturn {\r\n\t\t\t\t\tname : $XP(m, 'cardLevelName', ''),\r\n\t\t\t\t\tvalue : parseInt($XP(m, 'cardCount', 0))\r\n\t\t\t\t};\r\n\t\t\t});\r\n\t\t},\r\n\t\tgetGenderChartData : function () {\r\n\t\t\tvar self = this,\r\n\t\t\t\tsummary = self.get('memberSummarize')[0] || {};\r\n\t\t\tvar genders = _.map(Hualala.TypeDef.GENDER, function (el) {\r\n\t\t\t\tvar v = parseInt($XP(el, 'value', 0)), name = null, value = null;\r\n\t\t\t\tswitch (v) {\r\n\t\t\t\t\tcase 0:\r\n\t\t\t\t\t\tname = \"女\";\r\n\t\t\t\t\t\tvalue = parseInt($XP(summary, 'sexFemaleCount', 0));\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 1:\r\n\t\t\t\t\t\tname = \"男\";\r\n\t\t\t\t\t\tvalue = parseInt($XP(summary, 'sexMaleCount', 0));\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 2:\r\n\t\t\t\t\t\tname = \"未知\"\r\n\t\t\t\t\t\tvalue = parseInt($XP(summary, 'sexUnknownCount', 0));\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t\treturn {\r\n\t\t\t\t\tname : name,\r\n\t\t\t\t\tvalue : value\r\n\t\t\t\t};\r\n\t\t\t});\r\n\t\t\treturn genders;\r\n\t\t},\r\n\t\tgetSourceChartData : function () {\r\n\t\t\tvar self = this,\r\n\t\t\t\tsummary = self.get('memberSummarize')[0] || {};\r\n\t\t\tvar sources = [{key : \"onLineCount\", name : \"线上\"}, {key : \"inShopCount\", name : \"线下\"}];\r\n\t\t\treturn _.map(sources, function (o) {\r\n\t\t\t\treturn {\r\n\t\t\t\t\tname : $XP(o, 'name', ''),\r\n\t\t\t\t\tvalue : parseInt($XP(summary, $XP(o, 'key'), 0))\r\n\t\t\t\t};\r\n\t\t\t});\r\n\t\t}\r\n\t});\r\n\tHualala.CRM.MemberSchemaModel = MemberSchemaModel;\r\n\r\n})(jQuery, window);;(function ($, window) {\r\n\tIX.ns(\"Hualala.CRM\");\r\n\tvar popoverMsg = Hualala.UI.PopoverMsgTip;\r\n\tvar toptip = Hualala.UI.TopTip;\r\n\tvar LoadingModal = Hualala.UI.LoadingModal;\r\n\t\r\n\tvar MemberSchemaView = Stapes.subclass({\r\n\t\tconstructor : function () {\r\n\t\t\t// View层容器\r\n\t\t\tthis.$container = null;\r\n\t\t\t// 数据表容器\r\n\t\t\tthis.$tableBox = null;\r\n\t\t\t// 图标容器\r\n\t\t\tthis.$chartBox = null;\r\n\t\t\t\r\n\t\t\tthis.$emptyBar = null;\r\n\t\t\tthis.chartsCfg = Hualala.CRM.MemberSchemaChartConfigs;\r\n\t\t\tthis.loadingModal = new LoadingModal({start : 100});\r\n\t\t\tthis.loadTemplates();\r\n\t\t}\r\n\t});\r\n\tMemberSchemaView.proto({\r\n\t\tinit : function (cfg) {\r\n\t\t\tthis.$container = $XP(cfg, 'container', null);\r\n\t\t\tthis.model = $XP(cfg, 'model', null);\r\n\t\t\tif (!this.$container || !this.model) {\r\n\t\t\t\tthrow(\"CRM Member Schema View Init Failed!\");\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tthis.initLayout();\r\n\t\t},\r\n\t\tloadTemplates : function () {\r\n\t\t\tvar layoutTpl = Handlebars.compile(Hualala.TplLib.get('tpl_crm_schema_layout')),\r\n\t\t\t\ttableTpl = Handlebars.compile(Hualala.TplLib.get('tpl_cmpx_datagrid'));\r\n\t\t\tHandlebars.registerHelper('chkColType', function (conditional, options) {\r\n\t\t\t\treturn (conditional == options.hash.type) ? options.fn(this) : options.inverse(this);\r\n\t\t\t});\r\n\t\t\tHandlebars.registerPartial(\"colBtns\", Hualala.TplLib.get('tpl_base_grid_colbtns'));\r\n\t\t\tthis.set({\r\n\t\t\t\tlayoutTpl : layoutTpl,\r\n\t\t\t\ttableTpl : tableTpl\r\n\t\t\t});\r\n\t\t},\r\n\t\tinitLayout : function () {\r\n\t\t\tvar self = this, layoutTpl = self.get('layoutTpl');\r\n\t\t\tself.$container.html(layoutTpl({charts : self.chartsCfg}));\r\n\t\t\tself.$tableBox = self.$container.find('.crm-schema-table');\r\n\t\t\tself.$chartBox = self.$container.find('.crm-schema-chart');\r\n\t\t},\r\n\t\tmapTableRenderData : function () {\r\n\t\t\tvar self = this, memberData = self.model.getMemberByLevelNames(),\r\n\t\t\t\tsummary = self.model.get('memberSummarize'),\r\n\t\t\t\ttableHeader = Hualala.CRM.MemberSchemaTableHeaderConfigs,\r\n\t\t\t\tcolNames = \"cardLevelName,cardCount,levelCardCountRate,sexMaleRate,sexFemaleRate,sexUnknownRate,onLineRate,inShopRate,moneyBalanceSum,pointBalanceSum,consumptionPerOrder\";\r\n\t\t\tvar math = Hualala.Common.Math;\r\n\t\t\tvar mapColData = function (member) {\r\n\t\t\t\tvar cols = _.map(colNames.split(','), function (k) {\r\n\t\t\t\t\tvar v = $XP(member, k, ''),\r\n\t\t\t\t\t\ttext = '', title = '', clz = '';\r\n\t\t\t\t\tvar mapCardLevelTip = function (m) {\r\n\t\t\t\t\t\tvar cardLevelName = $XP(m, 'cardLevelName'),\r\n\t\t\t\t\t\t\t// 0:不享受会员价，1：享受会员价\r\n\t\t\t\t\t\t\tisVipPrice = $XP(m, 'isVipPrice', 0) == 0 ? false : true,\r\n\t\t\t\t\t\t\tdiscountRate = $XP(m, 'discountRate', 1) == 1 ? \"不打折\" : ('打' + math.multi($XP(m, 'discountRate', 1), 10) + '折'),\r\n\t\t\t\t\t\t\t// 0：部分菜品打折，1：全部菜品打折\r\n\t\t\t\t\t\t\tdiscountRange = $XP(m, 'discountRange', 0) == 0 ? \"(部分不打折)，\" : \"\",\r\n\t\t\t\t\t\t\t// 折扣描述\r\n\t\t\t\t\t\t\tdiscountDescription = $XP(m, 'discountDescription', ''),\r\n\t\t\t\t\t\t\tswitchLevelUpPoint = $XP(m, 'switchLevelUpPoint', null);\r\n\t\t\t\t\t\tvar tpl = Handlebars.compile(Hualala.TplLib.get('tpl_crm_card_level_info'));\r\n\t\t\t\t\t\treturn tpl({\r\n\t\t\t\t\t\t\tcardLevelName : cardLevelName,\r\n\t\t\t\t\t\t\tisVipPrice : isVipPrice,\r\n\t\t\t\t\t\t\tdiscountRate : discountRate,\r\n\t\t\t\t\t\t\tdiscountRange : discountRange,\r\n\t\t\t\t\t\t\tdiscountDescription : IX.isEmpty(discountDescription) ? '' : (discountDescription + '，'),\r\n\t\t\t\t\t\t\tswitchLevelUpPoint : switchLevelUpPoint\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t};\r\n\t\t\t\t\tswitch (k) {\r\n\t\t\t\t\t\tcase 'cardCount':\r\n\t\t\t\t\t\t\ttext = parseInt(v);\r\n\t\t\t\t\t\t\tclz = 'number';\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\tcase 'levelCardCountRate':\r\n\t\t\t\t\t\tcase 'sexMaleRate':\r\n\t\t\t\t\t\tcase 'sexFemaleRate':\r\n\t\t\t\t\t\tcase 'sexUnknownRate':\r\n\t\t\t\t\t\tcase 'onLineRate':\r\n\t\t\t\t\t\tcase 'inShopRate':\r\n\t\t\t\t\t\t\ttext = v + '%';\r\n\t\t\t\t\t\t\tclz = 'number';\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\tcase 'moneyBalanceSum':\r\n\t\t\t\t\t\tcase 'pointBalanceSum':\r\n\t\t\t\t\t\tcase 'consumptionPerOrder':\r\n\t\t\t\t\t\t\ttext = math.prettyNumeric(math.standardPrice(v));\r\n\t\t\t\t\t\t\tclz = 'number';\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\tdefault : \r\n\t\t\t\t\t\t\ttext = v;\r\n\t\t\t\t\t\t\tclz = 'text';\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn {\r\n\t\t\t\t\t\tclz : clz,\r\n\t\t\t\t\t\ttype : 'text',\r\n\t\t\t\t\t\tvalue : v,\r\n\t\t\t\t\t\ttext : text,\r\n\t\t\t\t\t\ttitle : k == \"cardLevelName\" ? mapCardLevelTip(member) : ''\r\n\t\t\t\t\t};\r\n\t\t\t\t});\r\n\t\t\t\treturn cols;\r\n\t\t\t};\r\n\t\t\tvar rows = _.map(memberData, function (m) {\r\n\t\t\t\treturn {\r\n\t\t\t\t\tclz : '',\r\n\t\t\t\t\tcols : mapColData(m)\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\tvar tfoot = _.map(summary, function (r) {\r\n\t\t\t\tvar cols = mapColData(r);\r\n\t\t\t\tcols.shift();\r\n\t\t\t\tcols.unshift({\r\n\t\t\t\t\tclz : 'title',\r\n\t\t\t\t\tvalue : '',\r\n\t\t\t\t\ttext : '总价：'\r\n\t\t\t\t});\r\n\t\t\t\treturn {\r\n\t\t\t\t\tclz : '',\r\n\t\t\t\t\tcols : cols\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\treturn {\r\n\t\t\t\ttblClz : 'table table-bordered table-striped table-hover ix-data-report',\r\n\t\t\t\tthead : tableHeader,\r\n\t\t\t\trows : rows,\r\n\t\t\t\ttfoot : tfoot\r\n\t\t\t}\r\n\t\t},\r\n\t\trender : function () {\r\n\t\t\tvar self = this,\r\n\t\t\t\tmodel = self.model;\r\n\t\t\tvar tableRenderData = self.mapTableRenderData();\r\n\r\n\t\t\tvar tblTpl = self.get('tableTpl'),\r\n\t\t\t\thtml = tblTpl(tableRenderData);\r\n\t\t\tself.$tableBox.html(html);\r\n\t\t\tself.bindEvent();\r\n\t\t\tIX.Net.loadJsFiles([Hualala.Global.ECHART_PATH], function () {\r\n\t\t\t\tself.emit('loaded');\r\n\t\t\t\t_.map(Hualala.CRM.MemberSchemaChartConfigs, function (el) {\r\n\t\t\t\t\tvar id = $XP(el, 'id'), $box = $('#' + id);\r\n\t\t\t\t\t$box.css({height : '500px'});\r\n\t\t\t\t\tvar oChart = echarts.init($box[0]);\r\n\t\t\t\t\t$box.data('oChart', oChart);\r\n\t\t\t\t\toChart.showLoading({\r\n\t\t\t\t\t\ttext : \"加载中...\",\r\n\t\t\t\t\t\tx : 'center',\r\n\t\t\t\t\t\ty : 'center',\r\n\t\t\t\t\t\teffect : 'spin'\r\n\t\t\t\t\t});\r\n\t\t\t\t});\r\n\t\t\t\tself.renderChart();\r\n\t\t\t});\r\n\t\t\t\r\n\t\t\t\r\n\t\t},\r\n\t\trenderChart : function () {\r\n\t\t\tvar self = this, model = self.model;\r\n\t\t\tvar cfgs = Hualala.CRM.MemberSchemaChartConfigs,\r\n\t\t\t\tlegendCfg = Hualala.CRM.BaseChartLegend,\r\n\t\t\t\ttoolboxCfg = Hualala.CRM.BaseChartToolBox,\r\n\t\t\t\ttooltipCfg = Hualala.CRM.BaseChartTooltip,\r\n\t\t\t\ttitleCfg = Hualala.CRM.BaseChartTitle,\r\n\t\t\t\ttipTitle = '';\r\n\t\t\tvar chartOptions = _.map(cfgs, function (cfg) {\r\n\t\t\t\tvar id = $XP(cfg, 'id'), title = $XP(cfg, 'label');\r\n\t\t\t\tvar opt = {}, levels = null;\r\n\t\t\t\t\ttitle = IX.inherit(titleCfg, {text : title}),\r\n\t\t\t\t\tseries = null, legend = null;\r\n\t\t\t\tswitch (id) {\r\n\t\t\t\t\tcase \"member_level_chart\":\r\n\t\t\t\t\t\ttipTitle = \"会员等级\";\r\n\t\t\t\t\t\tseries = self.model.getLevelChartData();\r\n\t\t\t\t\t\tlevels = _.map(self.model.getMemberByLevelNames(), function (m) {\r\n\t\t\t\t\t\t\treturn $XP(m, 'cardLevelName', '');\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t\tlegend = IX.inherit(legendCfg, {data : levels});\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase \"member_gender_chart\":\r\n\t\t\t\t\t\ttipTitle = \"会员性别\";\r\n\t\t\t\t\t\tseries = self.model.getGenderChartData();\r\n\t\t\t\t\t\tlegend = IX.inherit(legendCfg, {data : ['男', '女', '未知']});\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase \"member_source_chart\":\r\n\t\t\t\t\t\ttipTitle = \"会员来源\";\r\n\t\t\t\t\t\tseries = self.model.getSourceChartData();\r\n\t\t\t\t\t\tlegend = IX.inherit(legendCfg, {data : ['线上', '线下']});\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t\topt = IX.inherit(opt, {\r\n\t\t\t\t\ttitle : title,\r\n\t\t\t\t\ttooltip : tooltipCfg,\r\n\t\t\t\t\ttoolbox : toolboxCfg,\r\n\t\t\t\t\tlegend : legend,\r\n\t\t\t\t\tcalculable : false,\r\n\t\t\t\t\tseries : [{\r\n\t\t\t\t\t\tname : tipTitle,\r\n\t\t\t\t\t\ttype : 'pie',\r\n\t\t\t\t\t\tradius : '55%',\r\n\t\t\t\t\t\tcenter : ['50%', '40%'],\r\n\t\t\t\t\t\tdata : series\r\n\t\t\t\t\t}]\r\n\t\t\t\t});\r\n\t\t\t\treturn {\r\n\t\t\t\t\tid : id,\r\n\t\t\t\t\toption : opt\r\n\t\t\t\t};\r\n\t\t\t});\r\n\t\t\t_.each(chartOptions, function (el) {\r\n\t\t\t\tvar id = $XP(el, 'id'), opt = $XP(el, 'option', {});\r\n\t\t\t\tvar $chart = $('#' + id);\r\n\t\t\t\tvar oChart = $chart.data('oChart');\r\n\t\t\t\toChart.hideLoading();\r\n\t\t\t\toChart.setOption(opt);\r\n\t\t\t});\r\n\t\t},\r\n\t\thideLoadingModal : function () {\r\n\t\t\tthis.loadingModal.hide();\r\n\t\t},\r\n\t\tshowLoadingModal : function () {\r\n\t\t\tthis.loadingModal.show();\r\n\t\t},\r\n\t\tbindEvent : function () {\r\n\t\t\tvar self = this;\r\n\t\t\tself.$tableBox.tooltip({\r\n\t\t\t\tselector : 'p[title]'\r\n\t\t\t});\r\n\t\t}\r\n\t});\r\n\tHualala.CRM.MemberSchemaView = MemberSchemaView;\r\n})(jQuery, window);;(function ($, window) {\r\n\tIX.ns(\"Hualala.CRM\");\r\n\tvar popoverMsg = Hualala.UI.PopoverMsgTip;\r\n\tvar toptip = Hualala.UI.TopTip;\r\n\tvar LoadingModal = Hualala.UI.LoadingModal;\r\n\t\r\n\tvar MemberSchemaController = Stapes.subclass({\r\n\t\t/**\r\n\t\t * 构造会员概览页面控制器\r\n\t\t * @param  {Object} cfg 配置参数\r\n\t\t *          @param {jQuery Object} container \r\n\t\t *          @param {Object} view 概要显示层实例\r\n\t\t *          @param {Object} model 概要数据层实例\r\n\t\t * @return {Object}     控制器实例\r\n\t\t */\r\n\t\tconstructor : function (cfg) {\r\n\t\t\tthis.set({\r\n\t\t\t\tsessionData : Hualala.getSessionData()\r\n\t\t\t});\r\n\t\t\tthis.container = $XP(cfg, 'container', null);\r\n\t\t\tthis.view = $XP(cfg, 'view', null);\r\n\t\t\tthis.model = $XP(cfg, 'model', null);\r\n\t\t\tif (!this.container || !this.view || !this.model ) {\r\n\t\t\t\tthrow(\"CRM Schema Controller init faild!!\");\r\n\t\t\t}\r\n\t\t\tthis.isReady = false;\r\n\t\t\tthis.bindEvent();\r\n\t\t\tthis.init();\r\n\t\t}\r\n\t});\r\n\tMemberSchemaController.proto({\r\n\t\tinit : function () {\r\n\t\t\tthis.model.init();\r\n\t\t\tthis.view.init({\r\n\t\t\t\tmodel : this.model,\r\n\t\t\t\tcontainer : this.container\r\n\t\t\t});\r\n\t\t\tthis.isReady = true;\r\n\t\t\tthis.emit('load', {});\r\n\t\t},\r\n\t\thasReady : function () { return this.isReady; },\r\n\t\tbindEvent : function () {\r\n\t\t\tthis.on({\r\n\t\t\t\tload : function (params) {\r\n\t\t\t\t\tvar self = this;\r\n\t\t\t\t\tvar cbFn = function () {\r\n\t\t\t\t\t\tself.view.emit('render');\r\n\t\t\t\t\t\t// self.view.emit('loaded');\r\n\t\t\t\t\t};\r\n\t\t\t\t\tself.view.emit('loading');\r\n\t\t\t\t\tself.model.load(params, cbFn);\r\n\t\t\t\t}\r\n\t\t\t}, this);\r\n\t\t\tthis.view.on({\r\n\t\t\t\trender : function () {\r\n\t\t\t\t\tvar self = this;\r\n\t\t\t\t\tself.view.render();\r\n\t\t\t\t},\r\n\t\t\t\tloaded : function () {\r\n\t\t\t\t\tthis.view.hideLoadingModal();\r\n\t\t\t\t},\r\n\t\t\t\tloading : function () {\r\n\t\t\t\t\tthis.view.showLoadingModal();\r\n\t\t\t\t}\r\n\t\t\t}, this);\r\n\t\t}\r\n\t});\r\n\tHualala.CRM.MemberSchemaController = MemberSchemaController;\r\n})(jQuery, window);;(function ($, window) {\r\n\tIX.ns(\"Hualala.CRM\");\r\n    var G = Hualala.Global,\r\n        topTip = Hualala.UI.TopTip;\r\n\tHualala.CRM.initParams = function($crm)\r\n    {\r\n        var $form = null, bv = null, itemID = null,\r\n            $vipServiceTel = null, $vipServiceRemark = null,\r\n            $p1 = null, $p2 = null;\r\n        \r\n        G.getCrmParams({groupID: Hualala.getSessionData().site.groupID}, function(rsp)\r\n        {\r\n            if(rsp.resultcode != '000')\r\n            {\r\n                rsp.resultmsg && topTip({msg: rsp.resultmsg, type: 'danger'});\r\n                return;\r\n            }\r\n            var crmParams = rsp.data;\r\n            itemID = crmParams.itemID;\r\n            crmParams.serviceStartTime = formatDate(crmParams.serviceStartTime);\r\n            crmParams.serviceEndTime = formatDate(crmParams.serviceEndTime);\r\n            crmParams.pointClearDate = +crmParams.pointClearDate == 0 ? '不清零' : formatDate(crmParams.pointClearDate);\r\n            crmParams.isPointCanPay = crmParams.isPointCanPay == 0 ? 'minus' : 'ok';\r\n            \r\n            $form = $(Handlebars.compile(Hualala.TplLib.get('tpl_crm_params'))(crmParams)).appendTo($crm);\r\n            \r\n            $vipServiceTel = $form.find('input[name=vipServiceTel]');\r\n            $vipServiceRemark = $form.find('textarea[name=vipServiceRemark]');\r\n            $p1 = $vipServiceTel.siblings('p');\r\n            $p2 = $vipServiceRemark.siblings('p');\r\n            \r\n            $form.bootstrapValidator({\r\n                fields: {\r\n                    vipServiceTel: {\r\n                        validators: {\r\n                            notEmpty: { message: '会员服务电话不能为空' },\r\n                            telOrMobile: { message: '' }\r\n                        }\r\n                    }\r\n                }\r\n            });\r\n            bv = $form.data('bootstrapValidator');\r\n        });\r\n        \r\n        \r\n        $crm.on('click', function(e)\r\n        {\r\n            var $target = $(e.target);\r\n            \r\n            if($target.is('.btn-edit, .btn-save')) e.preventDefault();\r\n            \r\n            if($target.is('.btn-edit'))\r\n            {\r\n                $form.removeClass('read-mode').addClass('edit-mode');\r\n            }\r\n            \r\n            if($target.is('.btn-save'))\r\n            {\r\n                if(!bv.validate().isValid()) return;\r\n                \r\n                var vipServiceTel = $vipServiceTel.val(),\r\n                    vipServiceRemark = $vipServiceRemark.val(),\r\n                    data = {\r\n                        itemID: itemID,\r\n                        vipServiceTel: vipServiceTel,\r\n                        vipServiceRemark: vipServiceRemark\r\n                    };\r\n                \r\n                G.setCrmParams(data, function(rsp)\r\n                {\r\n                    if(rsp.resultcode != '000')\r\n                    {\r\n                        rsp.resultmsg && topTip({msg: rsp.resultmsg, type: 'danger'});\r\n                        return;\r\n                    }\r\n                    \r\n                    $p1.text(vipServiceTel);\r\n                    $p2.text(vipServiceRemark);\r\n                    $form.removeClass('edit-mode').addClass('read-mode');\r\n                    topTip({msg: '保存成功！', type: 'success'});\r\n                });\r\n            }\r\n        });\r\n    };\r\n    \r\n    function formatDate(dateStr)\r\n    {\r\n        return dateStr.length == 8 ? dateStr.substr(0, 4) + '年' + parseInt(dateStr.substr(4, 2)) + '月' + parseInt(dateStr.substr(6)) + '日' : parseInt(dateStr.substr(0, 2)) + '月' + parseInt(dateStr.substr(2)) + '日';\r\n    }\r\n})(jQuery, window);\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n;(function ($, window) {\r\n\tIX.ns(\"Hualala.CRM\");\r\n    \r\n\tHualala.CRM.initVipLevels = function($crm)\r\n    {\r\n        var G = Hualala.Global,\r\n            C = Hualala.Common,\r\n            CrmTypeDef = Hualala.TypeDef.CRM,\r\n            formatDateStr = C.formatDateStr,\r\n            prettyNumeric = C.Math.prettyNumeric,\r\n            U = Hualala.UI,\r\n            topTip = Hualala.UI.TopTip;\r\n            \r\n        var Meta = {\r\n                isVipPrice: { '0': '不享受', '1': '享受' },\r\n                discountRange: { '0': '部分打折', '1': '全部打折' },\r\n                isActive: { '0': '未启用', '1': '已启用' },\r\n                icos: {\r\n                    '0': '<i class=\"glyphicon glyphicon-minus no\"></i>',\r\n                    '1': '<i class=\"glyphicon glyphicon-ok ok\"></i>'\r\n                }\r\n            };\r\n        var Funcs = {\r\n                date: function(v){ return formatDateStr(v.replace(/-/g, ''), 12); },\r\n                number: function(v, key, $td){ $td.addClass('t-r'); return prettyNumeric(v); },\r\n                ico: function(v, key){ return $(Meta.icos[v]).attr('title', Meta[key][v]) },\r\n                discountRate: function(v){ return v == 1 ? '不打折' : (v * 10).toFixed(1) + '折' }\r\n            };\r\n        var keys = {\r\n                cardLevelName: { title: '会员等级名' },\r\n                description: { title: '等级说明' },\r\n                isVipPrice: { title: '是否享受会员价', type: 'ico' },\r\n                discountRate: { title: '折扣率', type: 'discountRate' },\r\n                discountRange: { title: '折扣范围' },\r\n                discountDescription: { title: '折扣描述' },\r\n                pointRate: { title: '积分系数', type: 'number' },\r\n                switchLevelUpPoint: { title: '等级所需累计消费金额', type: 'number' },\r\n                isActive: { title: '是否启用', type: 'ico' },\r\n                actionTime: { title: '最后修改时间', type: 'date' }\r\n            }\r\n            \r\n        var $table = $('<table>').addClass('table table-bordered table-striped table-hover'),\r\n            $headTR = $('<thead><tr></tr></thead>').appendTo($table).find('tr'),\r\n            ths = [];\r\n        for(var key in keys)\r\n            ths.push($('<th>').addClass('t-c').text(keys[key].title));\r\n        $headTR.append(ths);\r\n        $crm.append($table);\r\n        \r\n        function renderTbody(items, keys)\r\n        {\r\n            var trs = [];\r\n            for(var i = 0, item; item = items[i++];)\r\n            {\r\n                var $tr = $('<tr>');\r\n                for(var key in keys)\r\n                {\r\n                    var val = item[key], keyInfo = keys[key], meta = Meta[key],\r\n                        type = keyInfo.type, $cell = $('<td>').addClass('t-c');\r\n                    if(meta && !type) val = meta[val];\r\n                    if(type) val = Funcs[type](val, key, $cell);\r\n                    $cell.html(val).appendTo($tr);\r\n                }\r\n                trs.push($tr);\r\n            }\r\n            $('<tbody>').html(trs).appendTo($table);\r\n        }\r\n        \r\n        G.getVipLevels({isActive: 1}, function(rsp)\r\n        {\r\n            if(rsp.resultcode != '000')\r\n            {\r\n                rsp.resultmsg && topTip({msg: rsp.resultmsg, type: 'danger'});\r\n                return;\r\n            }\r\n            renderTbody(rsp.data.records || [], keys);\r\n        });\r\n        \r\n        \r\n    };\r\n})(jQuery, window);;(function ($, window) {\r\n\tIX.ns(\"Hualala.CRM\");\r\n    var G = Hualala.Global,\r\n        U = Hualala.UI,\r\n        topTip = U.TopTip,\r\n        parseForm = Hualala.Common.parseForm;\r\n        \r\n\tHualala.CRM.initRecharge = function($crm)\r\n    {\r\n        var $alert = $('<div class=\"alert alert-warning t-c\">暂无任何会员充值套餐。</div>'),\r\n            crmRechargeSetsTpl = Handlebars.compile(Hualala.TplLib.get('tpl_crm_recharge_sets')),\r\n            editSetTpl = Handlebars.compile(Hualala.TplLib.get('tpl_crm_recharge_set_add_update')),\r\n            vipLevelTpl = Handlebars.compile(Hualala.TplLib.get('tpl_crm_recharge_set_vip_level')),\r\n            $table = null, sets = [], levels = null,\r\n            set = null, setId = null, isAdd = null, \r\n            $editSet = null, modal = null, bv = null;\r\n            \r\n        renderSets();\r\n        $crm.on('click', '.well .btn, td .btn', renderDialog);\r\n        \r\n        function renderSets()\r\n        {\r\n            G.getCrmRechargeSets({}, function(rsp)\r\n            {\r\n                if(rsp.resultcode != '000')\r\n                {\r\n                    rsp.resultmsg && topTip({msg: rsp.resultmsg, type: 'danger'});\r\n                    return;\r\n                }\r\n                \r\n                sets = rsp.data.records || [];\r\n                preProcessSets(sets);\r\n                $(crmRechargeSetsTpl({sets: sets})).appendTo($crm.empty());\r\n                $table = $crm.find('table');\r\n                if(!sets.length)\r\n                {\r\n                    $table.addClass('hidden');\r\n                    $crm.append($alert);\r\n                    return;\r\n                }\r\n                createSwitch($crm.find('table input'));\r\n            });\r\n        }\r\n        \r\n        function renderDialog(e)\r\n        {\r\n            var id = $(e.target).data('setid');\r\n            setId = id;\r\n            isAdd = id === undefined;\r\n            set = getSetById(sets, id) || {};\r\n            var dTitle = (isAdd ? '添加' : '修改') + '会员充值套餐',\r\n                levelID = set.switchCardLevelID || 0;\r\n            $editSet = $(editSetTpl(set));\r\n            modal = new U.ModalDialog({\r\n                title: dTitle,\r\n                html: $editSet\r\n            }).show();\r\n            var $select = $editSet.find('select');\r\n            \r\n            if(levels)\r\n                $select.append(vipLevelTpl({levels: levels})).val(levelID);\r\n            else\r\n            {\r\n                G.getVipLevels({}, function(rsp)\r\n                {\r\n                    if(rsp.resultcode != '000')\r\n                    {\r\n                        rsp.resultmsg && topTip({msg: rsp.resultmsg, type: 'danger'});\r\n                        return;\r\n                    }\r\n                    \r\n                    levels = filterVipLevels(rsp.data.records);\r\n                    $select.append(vipLevelTpl({levels: levels})).val(levelID);\r\n                });\r\n            }\r\n            $editSet.bootstrapValidator({\r\n                fields: {\r\n                    setName: {\r\n                        validators: {\r\n                            notEmpty: { message: '套餐名不能为空' }\r\n                        }\r\n                    },\r\n                    setSaveMoney: {\r\n                        validators: {\r\n                            notEmpty: { message: '充值金额不能为空' },\r\n                            numeric: { message: '充值金额必须是金额数字' }\r\n                        }\r\n                    },\r\n                    returnMoney: {\r\n                        validators: {\r\n                            numeric: { message: '返金额数必须是金额数字' }\r\n                        }\r\n                    },\r\n                    returnPoint: {\r\n                        validators: {\r\n                            numeric: { message: '返积分数必须是数字' }\r\n                        }\r\n                    }\r\n                }\r\n            });\r\n            bv = $editSet.data('bootstrapValidator');\r\n            modal._.footer.find('.btn-ok').on('click', submitSet);\r\n        }\r\n        \r\n        function submitSet()\r\n        {\r\n            if(!bv.validate().isValid()) return;\r\n            var data = parseForm($editSet);\r\n            if(!isAdd) data.saveMoneySetID = setId;\r\n            G[isAdd ? 'addCrmRechargeSet' : 'updateCrmRechargeSet'](data, function(rsp)\r\n            {\r\n                if(rsp.resultcode != '000')\r\n                {\r\n                    rsp.resultmsg && topTip({msg: rsp.resultmsg, type: 'danger'});\r\n                    return;\r\n                }\r\n                topTip({msg: (isAdd ? '添加' : '修改') + '成功！', type: 'success'});\r\n                renderSets();\r\n                modal.hide();\r\n            });\r\n            \r\n        }\r\n    };\r\n    \r\n    function filterVipLevels(levels)\r\n    {\r\n        var ret = [];\r\n        for(var i = 0, level; level = levels[i]; i++)\r\n            if(+level.isActive) ret.push(level);\r\n        \r\n        return ret;\r\n    }\r\n    \r\n    function getSetById(sets, id)\r\n    {\r\n        for(var i = sets.length - 1, set; set = sets[i--];)\r\n            if(set.saveMoneySetID == id) return set;\r\n    }\r\n    \r\n    function preProcessSets(sets)\r\n    {\r\n        for(var i = sets.length - 1, set; set = sets[i--];)\r\n            set.checked = +set.isActive ? 'checked' : '';\r\n    }\r\n    \r\n    function getSelectText($select)\r\n    {\r\n        return $select.find('option:selected').text();\r\n    }\r\n    \r\n    function createSwitch($checkbox)\r\n    {\r\n        $checkbox.bootstrapSwitch({\r\n            onColor : 'success',\r\n            onText : '已开启',\r\n            offText : '已禁用'\r\n        }).on('switchChange.bootstrapSwitch', function (e, state)\r\n        {\r\n            var $this = $(this), setID = $this.data('setid'),\r\n                stateText = state ? '开启' : '禁用';\r\n            G.switchCrmRechargeSetState({saveMoneySetID: setID, isActive: +state}, function (rs)\r\n            {\r\n                if(rs.resultcode != '000')\r\n                {\r\n                    $this.bootstrapSwitch('toggleState', true);\r\n                    topTip({msg: stateText + '失败' + (rs.resultmsg ? '：' + rs.resultmsg : ''), type: 'danger'});\r\n                    return;\r\n                }\r\n                topTip({msg: stateText + '成功！', type: 'success'})\r\n            });\r\n        });\r\n    }\r\n    \r\n})(jQuery, window);\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n;(function ($, window) {\r\n\tIX.ns(\"Hualala.CRM\");\r\n    var G = Hualala.Global,\r\n        C = Hualala.Common,\r\n        M = C.Math,\r\n        CrmTypeDef = Hualala.TypeDef.CRM,\r\n        dF = IX.Date,\r\n        tplLib = Hualala.TplLib,\r\n        parseForm = Hualala.Common.parseForm,\r\n        topTip = Hualala.UI.TopTip;\r\n        \r\n    var staticData = {\r\n        cardStatus: CrmTypeDef.cardStatus,\r\n        customerSex: CrmTypeDef.customerSex,\r\n        sourceWay: CrmTypeDef.sourceWay,\r\n        \r\n        crmQueryTableHeads: ['姓名', '性别', '手机号(卡号)', '生日', '等级', '入会日期', '储值余额', '积分余额', '累计储值总额', '累计消费总额', '状态', '查看'],\r\n        crmQueryTableKeys: ['customerName', 'customerSex', 'customerMobile', 'customerBirthday', 'cardLevelName', 'createTime', 'moneyBalance', 'pointBalance', 'saveMoneyTotal', 'consumptionTotal', 'cardStatus', 'cardID']\r\n    };\r\n    \r\n    var levels = null, pageSize = 15,\r\n        $tbody = null, $pager = $('<div>').addClass('pull-right'),\r\n        vipLevelTpl = Handlebars.compile(tplLib.get('tpl_crm_recharge_set_vip_level'));\r\n    \r\n\tHualala.CRM.initQuery = function($crm)\r\n    {\r\n        var params = {pageNo: 1, pageSize: pageSize}, $form = null;\r\n        \r\n        $(Handlebars.compile(tplLib.get('tpl_crm_query'))(staticData)).appendTo($crm);\r\n        $crm.append($pager);\r\n        \r\n        $crm.find('[data-type=datetimepicker]').datetimepicker({\r\n            format : 'yyyy/mm/dd',\r\n            startDate : '2010/01/01',\r\n            autoclose : true,\r\n            minView : 'month',\r\n            todayBtn : true,\r\n            todayHighlight : true,\r\n            language : 'zh-CN'\r\n        });\r\n        \r\n        $form = $crm.find('form');\r\n        $tbody = $crm.find('tbody');\r\n        $levels = $crm.find('[name=cardLevelID]');\r\n        \r\n        if(levels)\r\n            $levels.append(vipLevelTpl({levels: levels}));\r\n        else\r\n        {\r\n            G.getVipLevels({}, function(rsp)\r\n            {\r\n                if(rsp.resultcode != '000')\r\n                {\r\n                    rsp.resultmsg && topTip({msg: rsp.resultmsg, type: 'danger'});\r\n                    return;\r\n                }\r\n                \r\n                levels = filterVipLevels(rsp.data.records);\r\n                $levels.append(vipLevelTpl({levels: levels}));\r\n            });\r\n        }\r\n        \r\n        queryCrm(params);\r\n        \r\n        $crm.find('.well a').on('click', function()\r\n        {\r\n            $crm.find('.more-crm-query').slideToggle();\r\n            this.text = this.text == '收起' ? '更多查询条件' : '收起';\r\n        });\r\n        \r\n        $crm.find('.well .btn').on('click', function()\r\n        {\r\n            var args = parseForm($form);\r\n            args.createTimeStart = formatPostDate(args.createTimeStart);\r\n            args.createTimeEnd = formatPostDate(args.createTimeEnd);\r\n            $.extend(params, args);\r\n            params.pageNo = 1;\r\n            queryCrm(params);\r\n        });\r\n        \r\n        $pager.on('page', function(e, pageNo)\r\n        {\r\n            params.pageNo = pageNo;\r\n            queryCrm(params);\r\n        });\r\n    };\r\n    \r\n    function renderCrmQueryTable($tbody, items)\r\n    {\r\n        var trs = [], keys = staticData.crmQueryTableKeys,\r\n            icoOk = '<i class=\"glyphicon glyphicon-ok ok\" title=\"手机号已绑定\"></i>',\r\n            createPath = Hualala.PageRoute.createPath;\r\n        for(var i = 0, item; item = items[i++];)\r\n        {\r\n            var $tr = $('<tr>');\r\n            for(var j = 0, key; key = keys[j++];)\r\n            {\r\n                var $td = $('<td>'), val = item[key] || '';\r\n                \r\n                if(key == 'customerMobile' && item.cardNO)\r\n                {\r\n                    val += '(卡号)';\r\n                    $td.attr('title', '卡号：' + item.cardNO).attr('data-toggle', 'tooltip')\r\n                    .tooltip({ trigger: 'click | hover', container: 'body' })\r\n                }\r\n                \r\n                if(/customerSex|cardStatus/.test(key))\r\n                    val = staticData[key][val];\r\n                else if(/saveMoneyTotal|moneyBalance|giveBalance|consumptionTotal|pointBalance/.test(key))\r\n                    val = M.prettyNumeric(val);\r\n                else if(/createTime|customerBirthday/.test(key))\r\n                    val = C.formatDateStr(val.replace(/-/g, ''));\r\n                else if(key == 'customerMobile' && +item.isMobileChecked)\r\n                    val += icoOk;\r\n                else if(key == 'cardID')\r\n                    val = $('<a>查看</a>').attr('href', createPath('crmMemberDetail', [val]));\r\n                \r\n                $td.html(val).appendTo($tr);\r\n            }\r\n            trs.push($tr);\r\n        }\r\n        $tbody.empty().append(trs);\r\n    }\r\n    \r\n    function queryCrm(params, cbFn)\r\n    {\r\n        G.queryCrm(params, function(rsp)\r\n        {\r\n            if(rsp.resultcode != '000')\r\n            {\r\n                rsp.resultmsg && topTip({msg: rsp.resultmsg, type: 'danger'});\r\n                return;\r\n            }\r\n            var records = rsp.data.records || [],\r\n                page = rsp.data.page;\r\n            renderCrmQueryTable($tbody, records);\r\n            $pager.IXPager({total : page.pageCount, page: page.pageNo, maxVisible: 10, href : 'javascript:;'});\r\n        });\r\n    }\r\n    \r\n    function formatPostDate(str)\r\n    {\r\n        return /\\d{4}\\/\\d{2}\\/\\d{2}/.test(str) ? str.split('/').join('') : '';\r\n    }\r\n    \r\n    function filterVipLevels(levels)\r\n    {\r\n        var ret = [];\r\n        for(var i = 0, level; level = levels[i]; i++)\r\n            if(+level.isActive) ret.push(level);\r\n        \r\n        return ret;\r\n    }\r\n})(jQuery, window);;(function ($, window) {\r\n\tIX.ns(\"Hualala.CRM\");\r\n    \r\n\tHualala.CRM.initDetail = function($container, cardID)\r\n    {\r\n        if(!cardID) return;\r\n        \r\n        $container.addClass('crm-detail');\r\n        \r\n        var G = Hualala.Global,\r\n            C = Hualala.Common,\r\n            CrmTypeDef = Hualala.TypeDef.CRM,\r\n            formatDateStr = C.formatDateStr,\r\n            prettyNumeric = C.Math.prettyNumeric,\r\n            tplLib = Hualala.TplLib,\r\n            topTip = Hualala.UI.TopTip;\r\n            \r\n        var Meta = {\r\n            basicInfo: [\r\n                {customerName: '姓名', customerSex: '性别', customerBirthday: '生日', createTime: '入会时间', createShopName: '入会店铺'},\r\n                {customerMobile: '手机号', cardNO: '卡号', cardLevelName: '等级' , moneyBalance: '现金储值余额', giveBalance: '赠送储值余额', pointBalance: '积分余额'},\r\n                {saveMoneyTotal: '储值累计', pointGetTotal: '积分累计', consumptionTotal: '消费累计', consumptionCount: '消费次数', lastConsumptionTime: '最后消费时间'}\r\n            ],\r\n            customerSex: CrmTypeDef.customerSex,\r\n            transDetail: {\r\n                transTime: '交易时间', transShopName: '交易店铺', transType: '交易类型', consumptionAmount: '消费金额', moneyChange: '储值余额变动', pointChange:'积分余额变动', transAfterMoneyBalanceSum: '交易后储值余额', transAfterPointBalance: '交易后积分余额', transRemark: '交易备注'\r\n            },\r\n            transType: CrmTypeDef.transType,\r\n            event: {\r\n                cardLevelName: '等级', eventName: '活动主题', eventWay: '活动类型', createTime: '参与时间',\r\n                //eventNews ~= Meta.eventNews[eventWay][winFlag]\r\n                eventNews: '活动动态'\r\n            },\r\n            eventWay: CrmTypeDef.eventWay,\r\n            gift: {\r\n                giftName: '名称', createTime: '获得时间', getWay: '获得方式', giftStatus: '状态', usingShopName: '使用店铺', usingTime: '使用时间', validUntilDate: '使用截止日期'\r\n            },\r\n            getWay: CrmTypeDef.getWay,\r\n            giftStatus: CrmTypeDef.giftStatus,\r\n            cardLog: {\r\n                createTime: '时间', shopName: '店铺', logType: '类型', operator: '经办人', remark: '备注'\r\n            },\r\n            logType: CrmTypeDef.logType\r\n        };\r\n        \r\n        var imgHost = G.IMAGE_RESOURCE_DOMAIN + '/',\r\n            defaultAvatar = G.IMAGE_ROOT + '/dino80.png';\r\n        \r\n        var params = {cardID: cardID},\r\n            $tpl = $(tplLib.get('tpl_crm_detail')).appendTo($container),\r\n            $basicInfo = $tpl.filter('.basic-info'),\r\n            $trans = $tpl.find('#transDetail'),\r\n            $events = $tpl.find('#activities'),\r\n            $gifts = $tpl.find('#vouchers'),\r\n            $logs = $tpl.find('#cardLog');\r\n        \r\n        $tpl.find('.tab-pane').addClass('table-responsive');\r\n        getData(params, 'getCrmDetail', renderCrmDetail);\r\n        getData(params, 'getCrmTransDetail', renderCrmTransDetail);\r\n        getData(params, 'getCrmUserEvents', renderCrmUserEvents);\r\n        getData(params, 'getCrmUserGifts', renderCrmUserGifts);\r\n        getData(params, 'getCrmCardLogs', renderCrmCardLogs);\r\n        \r\n        function renderCrmDetail(data)\r\n        {\r\n            $('<img alt=\"会员头像\" width=\"100\" height=\"100\">').attr('src', data.photoImage ? imgHost + data.photoImage : defaultAvatar).appendTo($basicInfo);\r\n            \r\n            var $div = $('<div>'),\r\n                icoOk = '<i class=\"glyphicon glyphicon-ok ok\" title=\"已验证\"></i>';\r\n            for(var i = 0, item; item = Meta.basicInfo[i++];)\r\n            {\r\n                var $ul = $('<ul>');\r\n                for(var key in item)\r\n                {\r\n                    var val = data[key] || '';\r\n                    if(val)\r\n                    {\r\n                        if(/createTime|customerBirthday|lastConsumptionTime/.test(key))\r\n                            val = formatDateStr(val.replace(/-/g, ''), 12);\r\n                        else if(/moneyBalance|shopChargeGiftSum|pointBalance|saveMoneyTotal|pointGetTotal|consumptionTotal/.test(key)) \r\n                            val = prettyNumeric(val);\r\n                        else if(key == 'customerMobile' && +data.isMobileChecked)\r\n                            val += icoOk;\r\n                        else if(key == 'customerSex') \r\n                            val = Meta[key][val];\r\n                        \r\n                        $ul.append($('<li>').append($('<label>').text(item[key])).append($('<span>').html(val)));\r\n                    }\r\n                }\r\n                $div.append($ul);\r\n            }\r\n            $basicInfo.append($div);\r\n        }\r\n        \r\n        function renderCrmTransDetail(records)\r\n        {\r\n            var $theadTR = $trans.find('thead tr'), ths = [],\r\n                $tbody = $trans.find('tbody'), trs = [],\r\n                transDetail = Meta.transDetail, transType = Meta.transType;\r\n                \r\n            for(var key in transDetail)\r\n                ths.push($('<th>').text(transDetail[key]));\r\n            $theadTR.append(ths);\r\n            \r\n            for(var i = 0, item; item = records[i++];)\r\n            {\r\n                var $tr = $('<tr>');\r\n                for(var key in transDetail)\r\n                {\r\n                    var val = item[key] || '';\r\n                    if(key == 'transTime') \r\n                        val = formatDateStr(val, 12);\r\n                    else if(/consumptionAmount|moneyChange|transAfterMoneyBalanceSum/.test(key))\r\n                        val = prettyNumeric(val);\r\n                    else if(key == 'transType')\r\n                        val = transType[val];\r\n                    \r\n                    $('<td>').text(val).appendTo($tr);\r\n                }\r\n                trs.push($tr);\r\n            }\r\n            $tbody.append(trs);\r\n        }\r\n        \r\n        function renderCrmUserEvents(records)\r\n        {\r\n            var $theadTR = $events.find('thead tr'), ths = [],\r\n                $tbody = $events.find('tbody'), trs = [],\r\n                event = Meta.event, eventWay = Meta.eventWay;\r\n                \r\n            for(var key in event)\r\n                ths.push($('<th>').text(event[key]));\r\n            $theadTR.append(ths);\r\n            \r\n            for(var i = 0, item; item = records[i++];)\r\n            {\r\n                var $tr = $('<tr>');\r\n                for(var key in event)\r\n                {\r\n                    var val = item[key];\r\n                    if(key == 'createTime') \r\n                        val = formatDateStr(val, 12);\r\n                    else if(key == 'eventNews')\r\n                        val = getEventNews(item.eventWay, item.winFlag);\r\n                    \r\n                    $('<td>').text(val).appendTo($tr);\r\n                }\r\n                trs.push($tr);\r\n            }\r\n            $tbody.append(trs);\r\n        }\r\n        \r\n        function getEventNews(way, flag)\r\n        {\r\n            var ret = '已兑换';\r\n            if(way == 20) ret = flag == 1 ? '一等奖' : flag == 2 ? '二等奖' : '三等奖';\r\n            else if(way == 21) ret = '已领取';\r\n            else if(ret == 22) ret = flag == 1 ? '已入围' : '未入围';\r\n            \r\n            return ret;\r\n        }\r\n        \r\n        function renderCrmUserGifts(records)\r\n        {\r\n            var $theadTR = $gifts.find('thead tr'), ths = [],\r\n                $tbody = $gifts.find('tbody'), trs = [],\r\n                gift = Meta.gift;\r\n                \r\n            for(var key in gift)\r\n                ths.push($('<th>').text(gift[key]));\r\n            $theadTR.append(ths);\r\n            \r\n            for(var i = 0, item; item = records[i++];)\r\n            {\r\n                var $tr = $('<tr>');\r\n                for(var key in gift)\r\n                {\r\n                    var val = item[key];\r\n                    if(/createTime|usingTime|validUntilDate/.test(key)) \r\n                        val = formatDateStr(val, 12);\r\n                    else if(/getWay|giftStatus/.test(key))\r\n                        val = Meta[key][val];\r\n                    \r\n                    $('<td>').text(val).appendTo($tr);\r\n                }\r\n                trs.push($tr);\r\n            }\r\n            $tbody.append(trs);\r\n        }\r\n        \r\n        function renderCrmCardLogs(records)\r\n        {\r\n            var $theadTR = $logs.find('thead tr'), ths = [],\r\n                $tbody = $logs.find('tbody'), trs = [],\r\n                cardLog = Meta.cardLog, logType = Meta.logType;\r\n                \r\n            for(var key in cardLog)\r\n                ths.push($('<th>').text(cardLog[key]));\r\n            $theadTR.append(ths);\r\n            \r\n            for(var i = 0, item; item = records[i++];)\r\n            {\r\n                var $tr = $('<tr>');\r\n                for(var key in cardLog)\r\n                {\r\n                    var val = item[key];\r\n                    if(key == 'createTime') \r\n                        val = formatDateStr(val, 12);\r\n                    else if(key == 'logType')\r\n                        val = logType[val];\r\n                    \r\n                    $('<td>').text(val).appendTo($tr);\r\n                }\r\n                trs.push($tr);\r\n            }\r\n            $tbody.append(trs);\r\n        }\r\n        \r\n        function getData(params, callServer, cbFn)\r\n        {\r\n            G[callServer](params, function(rsp)\r\n            {\r\n                if(rsp.resultcode != '000')\r\n                {\r\n                    rsp.resultmsg && topTip({msg: rsp.resultmsg, type: 'danger'});\r\n                    return;\r\n                }\r\n                var data = callServer == 'getCrmDetail' ? rsp.data : rsp.data.records || [];\r\n                cbFn(data);\r\n            });\r\n        }\r\n    };\r\n})(jQuery, window);;(function ($, window) {\r\n\tIX.ns(\"Hualala.CRM\");\r\n    \r\n\tHualala.CRM.initPreferential = function($crm)\r\n    {\r\n        var G = Hualala.Global,\r\n            C = Hualala.Common,\r\n            CrmTypeDef = Hualala.TypeDef.CRM,\r\n            formatDateStr = C.formatDateStr,\r\n            prettyNumeric = C.Math.prettyNumeric,\r\n            parseForm = C.parseForm,\r\n            tplLib = Hualala.TplLib,\r\n            U = Hualala.UI,\r\n            topTip = Hualala.UI.TopTip;\r\n            \r\n        var Meta = {\r\n            pref: {\r\n                shopName: '店铺名称', startDate: '开始日期', endDate: '结束日期', discountType: '折扣促销方式', discountRate: '促销折扣率', pointType: '积分促销方式', pointRate: '促销积分系数', actionTime: '修改时间', isActive: '是否启用', action: '操作'\r\n            },\r\n            discountType: { '0': '会员保底折扣率', '1': '折上折' },\r\n            pointType: { '0': '倍数', '1': '叠加' },\r\n            isActive: { '0': '未启用', '1': '已启用' },\r\n            stateIco: {\r\n                '0': '<i class=\"glyphicon glyphicon-minus no\"></i>',\r\n                '1': '<i class=\"glyphicon glyphicon-ok ok\"></i>'\r\n            }\r\n        };\r\n        \r\n        var getParams = {pageNo: 1, pageSize: 15},\r\n            $crmPref = $(tplLib.get('tpl_crm_pref')),\r\n            $table = $crmPref.filter('table'),\r\n            $headTR = $table.find('thead tr'),\r\n            $tbody = $table.find('tbody'),\r\n            $pager = $('<div>').addClass('pull-right');\r\n            \r\n        var prefs = null; pref = Meta.pref, stateIco = Meta.stateIco, ths = [];\r\n        \r\n        for(var key in pref)\r\n            ths.push($('<th>').text(pref[key]));\r\n        $headTR.append(ths);\r\n        \r\n        $crm.append($crmPref);\r\n        $crm.append($pager);\r\n        U.createSchemaChosen($('[name=shopID]'), $('[name=cityID]'));\r\n        \r\n        getCrmPreferential(getParams);\r\n        \r\n        $queryForm = $crmPref.find('form');\r\n        $crmPref.on('click', '.btn', function()\r\n        {\r\n            getParams.pageNo = 1;\r\n            $.extend(getParams, parseForm($queryForm));\r\n            getCrmPreferential(getParams);\r\n            return false;\r\n        });\r\n        \r\n        var tplForm = Handlebars.compile(tplLib.get('tpl_crm_pref_update')),\r\n            cpref = null, $ctr = null,\r\n            modal = null, $form = null, bv = null;\r\n        $table.on('click', 'a', function(e)\r\n        {\r\n            var $this = $(this), id = $(this).data('itemid');\r\n            cpref = findPref(id) || {};\r\n            var fpref = $.extend({}, cpref);\r\n            fpref.startDate = formatDateStr(fpref.startDate);\r\n            fpref.endDate = formatDateStr(fpref.endDate);\r\n            $ctr = $this.parent().parent();\r\n            $form = $(tplForm(fpref));\r\n            $form.find('[name=discountType]').eq(+fpref.discountType).prop('checked', true);\r\n            $form.find('[name=pointType]').eq(+fpref.pointType).prop('checked', true);\r\n            $form.find('[name=isActive]').val(fpref.isActive);\r\n            $form.find('[name=startDate],[name=endDate]').datetimepicker({\r\n                format : 'yyyy/mm/dd',\r\n                startDate : '2010/01/01',\r\n                autoclose : true,\r\n                minView : 'month',\r\n                todayBtn : true,\r\n                todayHighlight : true,\r\n                language : 'zh-CN'\r\n            });\r\n            modal = new U.ModalDialog({title: '会员促销参数设置', html: $form}).show();\r\n            \r\n            $form.bootstrapValidator({\r\n                fields: {\r\n                    startDate: {\r\n                        validators: {\r\n                            date: {\r\n                                format: 'YYYY/MM/DD',\r\n                                message: '开始日期格式不正确'\r\n                            }\r\n                        }\r\n                    },\r\n                    endDate: {\r\n                        validators: {\r\n                            date: {\r\n                                format: 'YYYY/MM/DD',\r\n                                message: '结束日期格式不正确'\r\n                            }\r\n                        }\r\n                    },\r\n                    discountRate: {\r\n                        validators: {\r\n                            notEmpty: { message: '促销折扣率不能为空' },\r\n                            greaterThan: {\r\n                                message: '促销折扣率大于0且小于或等于1',\r\n                                inclusive: false,\r\n                                value: 0\r\n                            },\r\n                            lessThan: {\r\n                                message: '促销折扣率必须大于0且小于或等于1',\r\n                                inclusive: true,\r\n                                value: 1\r\n                            }\r\n                        }\r\n                    },\r\n                    pointRate: {\r\n                        validators: {\r\n                            notEmpty: { message: '促销积分系数不能为空' },\r\n                            greaterThan: {\r\n                                message: '促销积分系数必须大于或等于1',\r\n                                inclusive: true,\r\n                                value: 1\r\n                            }\r\n                        }\r\n                    }\r\n                }\r\n            });\r\n            bv = $form.data('bootstrapValidator');\r\n            modal._.footer.find('.btn-ok').on('click', submitPref);\r\n        });\r\n        \r\n        function submitPref()\r\n        {\r\n            if(!bv.validate().isValid()) return;\r\n            var data = parseForm($form);\r\n            data.startDate = (data.startDate || '0').replace(/\\//g, '');\r\n            data.endDate = (data.endDate || '0').replace(/\\//g, '');\r\n            data.itemID = cpref.itemID;\r\n            G.updateCrmPreferential(data, function(rsp)\r\n            {\r\n                if(rsp.resultcode != '000')\r\n                {\r\n                    rsp.resultmsg && topTip({msg: rsp.resultmsg, type: 'danger'});\r\n                    return;\r\n                }\r\n                topTip({msg: '修改成功！', type: 'success'});\r\n                $ctr.replaceWith(createPrefTR($.extend(cpref, data)));\r\n                modal.hide();\r\n            });\r\n            \r\n        }\r\n        \r\n        function findPref(id)\r\n        {\r\n            return prefs[C.inArray(prefs, {itemID: id}, 'itemID')];\r\n        }\r\n            \r\n        $pager.on('page', function(e, pageNo)\r\n        {\r\n            getParams.pageNo = pageNo;\r\n            getCrmPreferential(getParams);\r\n        });\r\n        \r\n        function renderCrmPreferential(records)\r\n        {\r\n            var trs = [];\r\n            for(var i = 0, item; item = records[i++];)\r\n                trs.push(createPrefTR(item));\r\n            $tbody.html(trs);\r\n        }\r\n        \r\n        function createPrefTR(item)\r\n        {\r\n            var $tr = $('<tr>');\r\n            for(var key in pref)\r\n            {\r\n                var val = item[key];\r\n                if(/startDate|endDate|actionTime/.test(key)) \r\n                {\r\n                    val = formatDateStr(val, 12);\r\n                    if(/startDate|endDate/.test(key) && !val)\r\n                        val = '不限';\r\n                }\r\n                else if(key == 'action')\r\n                    val = $('<a href=\"javascript:;\">修改</a>').data('itemid', item.itemID);\r\n                else if(/discountType|pointType/.test(key))\r\n                    val = Meta[key][val];\r\n                else if(key == 'isActive')\r\n                    val = $(stateIco[val]).attr('title', Meta[key][val]);\r\n                \r\n                $('<td>').html(val).appendTo($tr);\r\n            }\r\n            return $tr;\r\n        }\r\n        \r\n        function getCrmPreferential(getParams)\r\n        {\r\n            G.getCrmPreferential(getParams, function(rsp)\r\n            {\r\n                if(rsp.resultcode != '000')\r\n                {\r\n                    rsp.resultmsg && topTip({msg: rsp.resultmsg, type: 'danger'});\r\n                    return;\r\n                }\r\n                \r\n                var records = rsp.data.records || [],\r\n                    page = rsp.data.page;\r\n                prefs = records;\r\n                renderCrmPreferential(records);\r\n                $pager.IXPager({total : page.pageCount, page: page.pageNo, maxVisible: 10, href : 'javascript:;'});\r\n            });\r\n        }\r\n    };\r\n})(jQuery, window);;(function ($, window) {\r\n\tIX.ns(\"Hualala.CRM\");\r\n    \r\n    var G = Hualala.Global,\r\n        C = Hualala.Common,\r\n        CrmTypeDef = Hualala.TypeDef.CRM,\r\n        formatDateStr = C.formatDateStr,\r\n        prettyNumeric = C.Math.prettyNumeric,\r\n        parseForm = C.parseForm,\r\n        tplLib = Hualala.TplLib,\r\n        U = Hualala.UI,\r\n        topTip = Hualala.UI.TopTip;\r\n    \r\n    var sumWay = { '1': '线上合计', '0': '线下合计', '-1': '总计' };\r\n    var sumSets = {\r\n            TransSum: 'summerizingGroupByTransWayDs',\r\n            TransDetail: 'detailGroupByTransWayDs',\r\n            CardSum: 'cardCreateSumarizeGroupByTransWayDs',\r\n            RechargeSum: 'summerizingGroupByTransWayDs'\r\n        };\r\n    var Funcs = {\r\n        date: function(v){ return formatDateStr(v.replace(/-/g, ''), 12); },\r\n        number: function(v, item, keyInfo, $td){ $td.addClass('t-r'); return prettyNumeric(v); },\r\n        mobile: function(v, item, keyInfo, $td)\r\n        {\r\n            if(item.cardNO)\r\n            {\r\n                v += '(卡号)';\r\n                $td.attr('title', '卡号：' + item.cardNO).attr('data-toggle', 'tooltip')\r\n                .tooltip({ trigger: 'click | hover', container: 'body' });\r\n            }\r\n            \r\n            return v; \r\n        },\r\n        transType: function(v, item) { return CrmTypeDef.transType[v]; },\r\n        viewDetail: function(v, item) { return $('<a href=\"javascript:;\">详情</a>').data('transid', item.transID) },\r\n        sum: function(v, item, keyInfo) { return sumWay[item[keyInfo['sumWay']]] + (keyInfo.count ? ('(共' + v + '笔)') : '') },\r\n        shopName: function(v, item, keyInfo ,c, i) { return (keyInfo.count ? i + '. ' : '') + (+item[keyInfo['shopID']] ? v : '网上储值') }\r\n    };\r\n    \r\n    var keys, fkeys, module, params, transRecords,\r\n        today = IX.Date.getDateByFormat(IX.Date.formatDate(new Date), 'yyyy/MM/dd'),\r\n        tplWell = Handlebars.compile(tplLib.get('tpl_crm_query_panel'))({today: today}),\r\n        tplTable = tplLib.get('tpl_report_table'),\r\n        $mbody, $well, $form, $thead, $tbody, $pager;\r\n    \r\n    function renderThead($thead, keys)\r\n    {\r\n        var $tr = $('<tr>');\r\n        for(var key in keys)\r\n        {\r\n            var keyInfo = keys[key], title = keyInfo.title, $th = $('<th>');\r\n            if(keyInfo.newRow)\r\n            {\r\n                $thead.append($tr);\r\n                $tr = $('<tr>');\r\n            }\r\n            if(keyInfo.rowspan) $th.attr('rowspan', keyInfo.rowspan);\r\n            if(keyInfo.colspan) $th.attr('colspan', keyInfo.colspan);\r\n            if(keyInfo.sort)\r\n            {\r\n                title = '<span></span>' + title;\r\n                $th.addClass('sort').data('key', key);\r\n            }\r\n            \r\n            $tr.append($th.html(title));\r\n        }\r\n        $thead.append($tr);\r\n    }\r\n    \r\n    function renderData($container, items, keys)\r\n    {\r\n        var trs = [];\r\n        for(var i = 0, item; item = items[i++];)\r\n        {\r\n            var $tr = $('<tr>');\r\n            for(var key in keys)\r\n            {\r\n                var val = item[key] || '', keyInfo = keys[key], \r\n                    type = keyInfo.type, $cell = $(type == 'sum' ? '<th>' : '<td>');\r\n                if(keyInfo.ignore) continue;\r\n                if(type) val = Funcs[type](val, item, keyInfo, $cell, i);\r\n                if(keyInfo.colspan) $cell.attr('colspan', keyInfo.colspan);\r\n                $cell.html(val).appendTo($tr);\r\n            }\r\n            trs.push($tr);\r\n        }\r\n        $container.html(trs);\r\n    }\r\n    \r\n    function getData(module, params)\r\n    {\r\n        if(module != 'CardSum')\r\n        {\r\n            params.queryStartTime = params.queryStartTime.replace(/\\//g, '');\r\n            params.queryEndTime = params.queryEndTime.replace(/\\//g, '');\r\n        }\r\n        G['getCrm' + module](params, function(rsp)\r\n        {\r\n            if(rsp.resultcode != '000')\r\n            {\r\n                rsp.resultmsg && topTip({msg: rsp.resultmsg, type: 'danger'});\r\n                return;\r\n            }\r\n            var records = rsp.data.records || [],\r\n                sumRecords = rsp.data.datasets[sumSets[module]].data.records || [],\r\n                page = rsp.data.page;\r\n            renderData($tbody, records, keys);\r\n            renderData($tfoot, sumRecords, fkeys);\r\n            if(module == 'TransDetail') transRecords = records;\r\n            $pager.IXPager({total : page.pageCount, page: page.pageNo, maxVisible: 10, href : 'javascript:;'});\r\n        });\r\n    }\r\n    \r\n\tfunction initModule(module, $mbody)\r\n    {\r\n        module = module;\r\n        $mbody = $mbody.addClass(module);\r\n        params = {pageNo: 1, pageSize: 15};\r\n        \r\n        if(module != 'TransDetail')\r\n        {\r\n            fkeys = $.extend({}, keys);\r\n            for(var k in fkeys)\r\n            {\r\n                fkeys[k] = { sumWay: 'transWay', type: 'sum' };\r\n                if(module == 'CardSum') fkeys[k].sumWay = 'sourceWay';\r\n                break;\r\n            }\r\n        }\r\n        \r\n        if(module != 'CardSum')\r\n        {\r\n            params = {pageNo: 1, pageSize: 15, queryStartTime: today, queryEndTime: today};\r\n            $well = $(tplWell).appendTo($mbody);\r\n            $form = $well.find('form');\r\n            U.createSchemaChosen($('[name=transShopID]'), $('[name=cityID]'));\r\n            $form.find('[name=queryStartTime], [name=queryEndTime]').datetimepicker({\r\n                format : 'yyyy/mm/dd',\r\n                startDate : '2010/10/10',\r\n                autoclose : true,\r\n                minView : 'month',\r\n                todayBtn : true,\r\n                todayHighlight : true,\r\n                language : 'zh-CN'\r\n            });\r\n            \r\n            $well.on('click', '.btn', function()\r\n            {\r\n                params.pageNo = 1;\r\n                $.extend(params, parseForm($form));\r\n                getData(module, params);\r\n            });\r\n        }\r\n        \r\n        var $table = $(tplTable).appendTo($mbody);\r\n        $thead = $table.find('thead');\r\n        $tbody = $table.find('tbody');\r\n        $tfoot = $table.find('tfoot');\r\n        $pager = $('<div>').addClass('pull-right').appendTo($mbody);\r\n        \r\n        renderThead($thead, keys);\r\n        var $sort = $thead.find('.sort');\r\n        $thead.on('click', '.sort', function()\r\n        {\r\n            var $this = $(this), sortClass = '';\r\n            $sort.not(this).removeClass('asc desc');\r\n            if($this.hasClass('asc'))\r\n                $this.removeClass('asc').addClass(sortClass = 'desc');\r\n            else if($this.hasClass('desc'))\r\n                $this.removeClass('desc').addClass(sortClass = '');\r\n            else\r\n                $this.addClass(sortClass = 'asc');\r\n            params.orderBy = sortClass ? $this.data('key') + ' ' + sortClass : '';\r\n            getData(module, params);\r\n        });\r\n        \r\n        getData(module, params);\r\n        \r\n        $pager.on('page', function(e, pageNo)\r\n        {\r\n            params.pageNo = pageNo;\r\n            getData(module, params);\r\n        });\r\n    }\r\n    \r\n    Hualala.CRM.initTransSum = function($mbody)\r\n    {\r\n        keys = {\r\n            transShopName: { title: '店铺', type: 'shopName', shopID: 'transShopID', count: 1, rowspan: 2 },\r\n            \r\n            shopCharge: { title: '储值业务', ignore: 1, colspan: 4 },\r\n            shopConsumption: { title: '消费业务', ignore: 1, colspan: 5 },\r\n            //储值业务\r\n            shopChargeCount: { title: '笔数', type: 'number', sort: 1, newRow: 1 },\r\n            shopChargeSum: { title: '现金金额', type: 'number', sort: 1 },\r\n            shopChargeGiftSum: { title: '赠送金额', type: 'number', sort: 1 },\r\n            shopChargeReturnPointSum: { title: '返积分数', type: 'number', sort: 1 },\r\n            //消费业务\r\n            shopConsumptionCount: { title: '笔数', type: 'number', sort: 1 },\r\n            shopconsumptionAmountSum: { title: '消费金额', type: 'number', sort: 1 },\r\n            shopMinusMoneySum: { title: '余额支付', type: 'number', sort: 1 },\r\n            shopConsumeDeductPointSum: { title: '积分抵扣', type: 'number', sort: 1 },\r\n            shopConsumptionReturnPointSum: { title: '返积分', type: 'number', sort: 1 }\r\n        };\r\n        initModule('TransSum', $mbody);\r\n    }\r\n    \r\n    Hualala.CRM.initTransDetail = function($mbody)\r\n    {\r\n        keys = {\r\n            transTime: { title: '交易时间', type: 'date', sort: 1 },\r\n            transShopName: { title: '交易店铺', type: 'shopName', shopID: 'transShopID' },\r\n            customerName: { title: '会员姓名' },\r\n            customerMobile: { title: '手机号(卡号)', type: 'mobile' },\r\n            transType: { title: '交易类型', type: 'transType' },\r\n            consumptionAmount: { title: '消费金额', type: 'number', sort: 1 },\r\n            moneyChange: { title: '储值余额变动', type: 'number', sort: 1 },\r\n            pointChange: { title: '积分余额变动', type: 'number', sort: 1 },\r\n            transRemark: { title: '交易备注' },\r\n            action: { title: '操作', type: 'viewDetail' }\r\n        };\r\n        \r\n        fkeys = {\r\n            transCount: { sumWay: 'transWay', type: 'sum', count: 1, colspan: 5 },\r\n            shopconsumptionAmountSum: { type: 'number' },\r\n            moneyChangeSum: { type: 'number' },\r\n            pointChangeSum: { type: 'number' },\r\n            empty: { colspan: 3 }\r\n        };\r\n        \r\n        initModule('TransDetail', $mbody);\r\n        \r\n        $form.prepend('<span>关键字<input type=\"text\" name=\"keyword\" placeholder=\"手机号/卡号\" class=\"form-control\"></span>');\r\n        U.fillSelect($('<span>类型<select name=\"transType\" class=\"form-control\"></span>').appendTo($form).find('select'), CrmTypeDef.transType).prepend('<option value=\"\">不限</option>').val('');\r\n        \r\n        $tbody.on('click', 'a', function()\r\n        {\r\n            var transReceiptsTxt = transRecords[C.inArray(transRecords, {transID: $(this).data('transid')}, 'transID')].transReceiptsTxt.replace(/\\n/g, '<br>'),\r\n                modal = new U.ModalDialog({clz: 'modal-trans-detail', title: '会员交易账单详情', html: transReceiptsTxt}).show();\r\n            modal._.footer.find('.btn-close').remove();\r\n            modal._.footer.find('.btn-ok').text('确定').attr('data-dismiss', 'modal');\r\n        });\r\n    }\r\n    \r\n    Hualala.CRM.initCardSum = function($mbody)\r\n    {\r\n        keys = {\r\n            createShopName: { title: '店铺', type: 'shopName', shopID: 'createShopID' }\r\n        };\r\n        var curMonth = (new Date().getMonth()) + 1;\r\n        for(var i = 5; i > 0; i--)\r\n        {\r\n            var month = curMonth - i;\r\n            month = month < 1 ? month + 12 : month;\r\n            keys['sub' + i + 'MonthCardCount'] = { title: month + '月新增', type: 'number', sort: 1 };\r\n        }\r\n        keys.curMonthCardCount = { title: '本月新增', type: 'number', sort: 1 };\r\n        keys.cardCount = { title: '当前会员总数', type: 'number', sort: 1 };\r\n        keys.useableCardCount = { title: '有效会员总数', type: 'number', sort: 1 };\r\n        \r\n        initModule('CardSum', $mbody);\r\n    }\r\n    \r\n    Hualala.CRM.initRechargeSum = function($mbody)\r\n    {\r\n        keys = {\r\n            transShopName: { title: '店铺', type: 'shopName', shopID: 'transShopID', rowspan: '2' },\r\n            saveMoneyCount: { title: '笔数', type: 'number', rowspan: '2'  },\r\n            saveMoneyAmountSum: { title: '现金储值金额', type: 'number', rowspan: '2' },\r\n            saveReturnMoneyAmountSum: { title: '赠送储值金额', type: 'number', rowspan: '2' },\r\n            rechargeWay: { title: '收款方式', ignore: 1, colspan: 5 },\r\n            saveMoneyCashSum: { title: '现金', type: 'number', newRow: 1 },\r\n            saveMoneyCardSum: { title: '银行卡', type: 'number' },\r\n            saveMoneyCheckSum: { title: '支票', type: 'number' },\r\n            saveMoneyOtherSum: { title: '其他', type: 'number' },\r\n            saveMoneyOnlineChargeSum: { title: '哗啦啦付款', type: 'number' }\r\n        };\r\n        initModule('RechargeSum', $mbody);\r\n    }\r\n    \r\n})(jQuery, window);;(function ($, window) {\r\n\tIX.ns(\"Hualala.CRM\");\r\n\t/*会员管理模块子页面整体页面布局*/\r\n\tfunction initCRMPageLayout (subNavCfg) {\r\n\t\tvar ctx = Hualala.PageRoute.getPageContextByPath(),\r\n\t\t\t$body = $('#ix_wrapper > .ix-body > .container');\r\n\t\tvar navTpl = Handlebars.compile(Hualala.TplLib.get('tpl_order_subnav'));\r\n\t\tHandlebars.registerPartial(\"toggle\", Hualala.TplLib.get('tpl_site_navbarToggle'));\r\n\t\t$body.empty();\r\n\t\t$body.html('<div class=\"crm-subnav clearfix\" /><div class=\"crm-body\" ><div class=\"crm-query-box\"></div><div class=\"crm-result-box\"></div></div>');\r\n\t\tvar mapNavRenderData = function () {\r\n\t\t\tvar navs = _.map(subNavCfg, function (v) {\r\n\t\t\t\tvar params = _.map($XP(v, 'pkeys', []), function (v) {\r\n\t\t\t\t\treturn '';\r\n\t\t\t\t});\r\n\t\t\t\treturn {\r\n\t\t\t\t\tactive : $XP(ctx, 'name') == v.name ? 'active' : '',\r\n\t\t\t\t\tdisabled : '',\r\n\t\t\t\t\tpath : Hualala.PageRoute.createPath(v.name, params) || '#',\r\n\t\t\t\t\tname : v.name || '',\r\n\t\t\t\t\tlabel : v.label || ''\r\n\t\t\t\t};\r\n\t\t\t});\r\n\t\t\treturn {\r\n\t\t\t\ttoggle : {\r\n\t\t\t\t\ttarget : '#order_navbar'\r\n\t\t\t\t},\r\n\t\t\t\titems : navs\r\n\t\t\t};\r\n\t\t};\r\n\t\tvar $navbar = $body.find('.crm-subnav'),\r\n\t\t\t$pageBody = $body.find('.crm-body').addClass('table-responsive');\r\n\t\t$navbar.html(navTpl(mapNavRenderData()));\r\n\t};\r\n\r\n\t/*CRM首页*/\r\n\tfunction initCRMHomePage () {\r\n\t\tvar ctx = Hualala.PageRoute.getPageContextByPath();\r\n\t\tvar $body = $('#ix_wrapper > .ix-body > .container');\r\n\t\tinitCRMPageLayout(Hualala.TypeDef.CRMMemberSubNavType);\r\n\t\t// Note: 暂时屏蔽概览页面，第二版将开启\r\n\t\tvar curDateStamp = IX.Date.getDateByFormat(new Hualala.Date((new Date()).getTime() / 1000).toText(), 'yyyyMMdd');\r\n\t\tvar pageCfg = _.find(Hualala.TypeDef.CRMMemberSubNavType, function (el) {return el.name == 'crmMemberSchema'}),\r\n\t\t\tpkeys = $XP(pageCfg, 'pkeys', []);\r\n\t\tpkeys = _.map(pkeys, function (v) {\r\n\t\t\tif (v == 'startDate' || v == 'endDate') {\r\n\t\t\t\treturn curDateStamp;\r\n\t\t\t}\r\n\t\t\treturn '';\r\n\t\t});\r\n\t\tdocument.location.href = Hualala.PageRoute.createPath('crmMemberSchema', pkeys);\r\n\t};\r\n\r\n\t/*会员概览页面*/\r\n\tfunction initMemberSchema () {\r\n\t\tvar ctx = Hualala.PageRoute.getPageContextByPath(),\r\n\t\t\t$body = $('#ix_wrapper > .ix-body > .container');\r\n\t\tinitCRMPageLayout(Hualala.TypeDef.CRMMemberSubNavType);\r\n\t\tvar $pageBody = $body.find('.crm-body'),\r\n\t\t\tqueryKeys = $XP(_.findWhere(Hualala.TypeDef.CRMMemberSubNavType, {name : $XP(ctx, 'name')}), 'pkeys');\r\n\t\t// $pageBody.html('<h1>会员概览页面</h1>');\r\n\t\tvar controller = new Hualala.CRM.MemberSchemaController({\r\n\t\t\tcontainer : $pageBody,\r\n\t\t\tview : new Hualala.CRM.MemberSchemaView(),\r\n\t\t\tmodel : new Hualala.CRM.MemberSchemaModel()\r\n\t\t});\r\n\t};\r\n\r\n\t/*会员查询页面*/\r\n\tfunction initQueryMember () {\r\n\t\tvar ctx = Hualala.PageRoute.getPageContextByPath(),\r\n\t\t\t$body = $('#ix_wrapper > .ix-body > .container');\r\n\t\tinitCRMPageLayout(Hualala.TypeDef.CRMMemberSubNavType);\r\n\t\tvar $pageBody = $body.find('.crm-body'),\r\n\t\t\tqueryKeys = $XP(_.findWhere(Hualala.TypeDef.CRMMemberSubNavType, {name : $XP(ctx, 'name')}), 'pkeys');\r\n\t\t//$pageBody.html('<h1>会员查询页面</h1>');\r\n        Hualala.CRM.initQuery($pageBody);\r\n\t};\r\n\r\n\t/*会员详情*/\r\n\tfunction initMemberDetail () {\r\n\t\tvar ctx = Hualala.PageRoute.getPageContextByPath(),\r\n\t\t\t$body = $('#ix_wrapper > .ix-body > .container');\r\n        Hualala.UI.BreadCrumb({\r\n            container: $body,\r\n            hideRoot: true,\r\n            nodes: Hualala.PageRoute.getParentNamesByPath()\r\n        });\r\n        Hualala.CRM.initDetail($body, ctx.params[0]);\r\n\t};\r\n\r\n\r\n\r\n\t/*会员办卡统计*/\r\n\tfunction initCardStatistic () {\r\n\t\tvar ctx = Hualala.PageRoute.getPageContextByPath(),\r\n\t\t\t$body = $('#ix_wrapper > .ix-body > .container');\r\n\t\tinitCRMPageLayout(Hualala.TypeDef.CRMMemberSubNavType);\r\n\t\tvar $pageBody = $body.find('.crm-body'),\r\n\t\t\tqueryKeys = $XP(_.findWhere(Hualala.TypeDef.CRMMemberSubNavType, {name : $XP(ctx, 'name')}), 'pkeys');\r\n\t\t//$pageBody.html('<h1>会员办卡统计</h1>');\r\n        Hualala.CRM.initCardSum($pageBody);\r\n\t};\r\n\r\n\t/*交易汇总*/\r\n\tfunction initDealSummary () {\r\n\t\tvar ctx = Hualala.PageRoute.getPageContextByPath(),\r\n\t\t\t$body = $('#ix_wrapper > .ix-body > .container');\r\n\t\tinitCRMPageLayout(Hualala.TypeDef.CRMDealSubNavType);\r\n\t\tvar $pageBody = $body.find('.crm-body'),\r\n        queryKeys = $XP(_.findWhere(Hualala.TypeDef.CRMDealSubNavType, {name : $XP(ctx, 'name')}), 'pkeys');\r\n\t\t//$pageBody.html('<h1>交易汇总</h1>');\r\n        Hualala.CRM.initTransSum($pageBody);\r\n\t};\r\n\r\n\t/*交易详情*/\r\n\tfunction initDealDetail () {\r\n\t\tvar ctx = Hualala.PageRoute.getPageContextByPath(),\r\n\t\t\t$body = $('#ix_wrapper > .ix-body > .container');\r\n\t\tinitCRMPageLayout(Hualala.TypeDef.CRMDealSubNavType);\r\n\t\tvar $pageBody = $body.find('.crm-body'),\r\n\t\t\tqueryKeys = $XP(_.findWhere(Hualala.TypeDef.CRMDealSubNavType, {name : $XP(ctx, 'name')}), 'pkeys');\r\n\t\t//$pageBody.html('<h1>交易详情</h1>');\r\n        Hualala.CRM.initTransDetail($pageBody);\r\n\t};\r\n\r\n\t/*充值对账*/\r\n\tfunction initRechargeReconciliation () {\r\n\t\tvar ctx = Hualala.PageRoute.getPageContextByPath(),\r\n\t\t\t$body = $('#ix_wrapper > .ix-body > .container');\r\n\t\tinitCRMPageLayout(Hualala.TypeDef.CRMDealSubNavType);\r\n\t\tvar $pageBody = $body.find('.crm-body'),\r\n\t\t\tqueryKeys = $XP(_.findWhere(Hualala.TypeDef.CRMDealSubNavType, {name : $XP(ctx, 'name')}), 'pkeys');\r\n\t\t//$pageBody.html('<h1>充值对账</h1>');\r\n        Hualala.CRM.initRechargeSum($pageBody);\r\n\t};\r\n\r\n\t/*会员系统参数设置*/\r\n\tfunction initCRMSettingsParams () {\r\n\t\tvar ctx = Hualala.PageRoute.getPageContextByPath(),\r\n\t\t\t$body = $('#ix_wrapper > .ix-body > .container');\r\n\t\tinitCRMPageLayout(Hualala.TypeDef.CRMParamsSubNavType);\r\n\t\tvar $pageBody = $body.find('.crm-body'),\r\n\t\t\tqueryKeys = $XP(_.findWhere(Hualala.TypeDef.CRMParamsSubNavType, {name : $XP(ctx, 'name')}), 'pkeys');\r\n\t\t//$pageBody.html('<h1>会员系统参数设置</h1>');\r\n        Hualala.CRM.initParams($pageBody);\r\n\t};\r\n    \r\n    /*会员等级*/\r\n\tfunction initCRMSettingsLevels () {\r\n\t\tvar ctx = Hualala.PageRoute.getPageContextByPath(),\r\n\t\t\t$body = $('#ix_wrapper > .ix-body > .container');\r\n\t\tinitCRMPageLayout(Hualala.TypeDef.CRMParamsSubNavType);\r\n\t\tvar $pageBody = $body.find('.crm-body'),\r\n\t\t\tqueryKeys = $XP(_.findWhere(Hualala.TypeDef.CRMParamsSubNavType, {name : $XP(ctx, 'name')}), 'pkeys');\r\n\t\t//$pageBody.html('<h1>会员系等级</h1>');\r\n        Hualala.CRM.initVipLevels($pageBody);\r\n\t};\r\n\r\n\t/*充值套餐*/\r\n\tfunction initRechargePackageBusiness () {\r\n\t\tvar ctx = Hualala.PageRoute.getPageContextByPath(),\r\n\t\t\t$body = $('#ix_wrapper > .ix-body > .container');\r\n\t\tinitCRMPageLayout(Hualala.TypeDef.CRMParamsSubNavType);\r\n\t\tvar $pageBody = $body.find('.crm-body'),\r\n\t\t\tqueryKeys = $XP(_.findWhere(Hualala.TypeDef.CRMParamsSubNavType, {name : $XP(ctx, 'name')}), 'pkeys');\r\n\t\t//$pageBody.html('<h1>充值套餐</h1>');\r\n        Hualala.CRM.initRecharge($pageBody);\r\n\t};\r\n\r\n\t/*店铺特惠*/\r\n\tfunction initShopSpecialPrice () {\r\n\t\tvar ctx = Hualala.PageRoute.getPageContextByPath(),\r\n\t\t\t$body = $('#ix_wrapper > .ix-body > .container');\r\n\t\tinitCRMPageLayout(Hualala.TypeDef.CRMParamsSubNavType);\r\n\t\tvar $pageBody = $body.find('.crm-body'),\r\n\t\t\tqueryKeys = $XP(_.findWhere(Hualala.TypeDef.CRMParamsSubNavType, {name : $XP(ctx, 'name')}), 'pkeys');\r\n        Hualala.CRM.initPreferential($pageBody);\r\n\t};\r\n\r\n\tHualala.CRM.CRMPageLayoutInit = initCRMPageLayout;\r\n\tHualala.CRM.CRMHomePageInit = initCRMHomePage;\r\n\tHualala.CRM.MemberSchemaInit = initMemberSchema;\r\n\tHualala.CRM.QueryMemberInit = initQueryMember;\r\n\tHualala.CRM.MemberDetailInit = initMemberDetail;\r\n\tHualala.CRM.CardStatisticInit = initCardStatistic;\r\n\tHualala.CRM.DealSummaryInit = initDealSummary;\r\n\tHualala.CRM.DealDetailInit = initDealDetail;\r\n\tHualala.CRM.RechargeReconciliationInit = initRechargeReconciliation;\r\n\tHualala.CRM.CRMSettingsParamsInit = initCRMSettingsParams;\r\n    Hualala.CRM.CRMSettingsLevelsInit = initCRMSettingsLevels;\r\n\tHualala.CRM.RechargePackageBusinessInit = initRechargePackageBusiness;\r\n\tHualala.CRM.ShopSpecialPriceInit = initShopSpecialPrice;\r\n\r\n})(jQuery, window);\r\n;(function ($, window) {\r\n\tIX.ns(\"Hualala.Weixin\");\r\n    \r\n    Hualala.Weixin.initReply = function($pageBody, mpID)\r\n    {\r\n        var W = Hualala.Weixin,\r\n            G = Hualala.Global,\r\n            C = Hualala.Common,\r\n            parseForm = C.parseForm,\r\n            tplLib = Hualala.TplLib,\r\n            U = Hualala.UI,\r\n            topTip = Hualala.UI.TopTip;\r\n            \r\n        if(!mpID) return;\r\n        \r\n        var $queryReply = $(tplLib.get('tpl_wx_reply_query')).appendTo($pageBody),\r\n            $queryForm = $queryReply.find('form'),\r\n            $tbody = $queryReply.find('tbody'),\r\n            $pager = $('<div>').addClass('pull-right').appendTo($pageBody),\r\n            emptyAlert = U.EmptyPlaceholder({msg: '无相关结果!', container: $pageBody}),\r\n            tplTr = Handlebars.compile(tplLib.get('tpl_wx_reply_query_item')),\r\n            tplReplyForm = Handlebars.compile(tplLib.get('tpl_wx_reply_add_update'));\r\n            \r\n        var queryParams = { mpID: mpID, pageNo: 1, pageSize: 15 },\r\n            replies, resources = [];\r\n        \r\n        getReplies();\r\n        \r\n        $queryReply.on('click', '.btn-warning', function()\r\n        {\r\n            $.extend(queryParams, parseForm($queryForm));\r\n            queryParams.pageNo = 1;\r\n            getReplies();\r\n        });\r\n        \r\n        $pager.on('page', function(e, pageNo)\r\n        {\r\n            queryParams.pageNo = pageNo;\r\n            getReplies();\r\n        });\r\n        \r\n        $tbody.on('click', '.delete-reply', function()\r\n        {\r\n            var itemID = $(this).data('itemid');\r\n            U.Confirm({msg: '确定删除？', okFn: function(){ deleteReply(itemID) }});\r\n        });\r\n        \r\n        function deleteReply(itemID)\r\n        {\r\n            G.deleteWeixinAutoReplyRole({itemID: itemID}, function(rsp)\r\n            {\r\n                if(rsp.resultcode != '000')\r\n                {\r\n                    rsp.resultmsg && topTip({msg: rsp.resultmsg, type: 'danger'});\r\n                    return;\r\n                }\r\n                topTip({msg: '删除成功！', type: 'success'});\r\n                replies.splice(findReply(itemID, true), 1);\r\n                if(replies.length) renderReplies();\r\n                else getReplies();\r\n                \r\n            });\r\n        }\r\n        \r\n        $queryReply.on('click', '.update-reply, .btn-success', function()\r\n        {\r\n            var itemID = $(this).data('itemid'),\r\n                reply = itemID ? findReply(itemID) : {},\r\n                $replyForm = $(tplReplyForm(reply)),\r\n                $select = $replyForm.find('select'),\r\n                $resView = $replyForm.find('.form-control-static');\r\n                \r\n            $replyForm.find('[name=pushContentType]').eq(reply.pushContentType || 0).prop('checked', true);\r\n            \r\n            W.createResourceChosen($select, $resView, resources, reply.resourceID || '')\r\n            .done(function(res)\r\n            {\r\n                resources = res;\r\n                var modal = new U.ModalDialog({\r\n                        title: (itemID ? '修改' : '添加') + '微信自动回复规则', \r\n                        html: $replyForm\r\n                    }).show();\r\n                \r\n                modal._.footer.find('.btn-ok').on('click', function()\r\n                {\r\n                    submitReply(itemID, reply, $replyForm, $select, modal);\r\n                });\r\n            });\r\n        });\r\n        \r\n        function submitReply(itemID, reply, $replyForm, $select, modal)\r\n        {\r\n            var resourceID = $select.val(),\r\n                res = _.findWhere(resources, {itemID: resourceID});\r\n            $.extend(reply, parseForm($replyForm));\r\n            reply.replyContent = res.resTitle;\r\n            reply.mpID = mpID;\r\n            reply.itemID = reply.itemID || '';\r\n            reply.pushMsgType = 'text';\r\n            reply.replyMsgType = res.resType == '2' ? 'text' : 'news';\r\n            reply.resourceVaule = 1;\r\n            \r\n            var pReply = _.pick(reply, 'itemID', 'mpID', 'pushContentType', 'replyContent', 'resourceID', 'resourceVaule', 'replyMsgType', 'pushMsgType', 'pushContent');\r\n            \r\n            G[itemID ? 'updateWeixinAutoReplyRole' : 'addWeixinAutoReplyRole'](pReply, function(rsp)\r\n            {\r\n                if(rsp.resultcode != '000')\r\n                {\r\n                    rsp.resultmsg && topTip({msg: rsp.resultmsg, type: 'danger'});\r\n                    return;\r\n                }\r\n                /*reply.pushMsg = reply.pushContentType == 0 ?\r\n                '消息为“<b>' + reply.pushContent + '</b>”' :\r\n                '消息中含“<b>' + reply.pushContent + '</b>”';*/\r\n                topTip({msg: (itemID ? '修改' : '添加') + '成功！', type: 'success'});\r\n                queryParams = { mpID: mpID, pageNo: 1, pageSize: 15 };\r\n                getReplies();\r\n                modal.hide();\r\n            });\r\n        }\r\n        \r\n        function getReplies()\r\n        {\r\n            G.getWeixinAutoReplyList(queryParams, function(rsp)\r\n            {\r\n                if(rsp.resultcode != '000')\r\n                {\r\n                    rsp.resultmsg && topTip({msg: rsp.resultmsg, type: 'danger'});\r\n                    return;\r\n                }\r\n                var records = rsp.data.records || [],\r\n                    page = rsp.data.page;\r\n                replies = records;\r\n                _.each(replies, function(reply)\r\n                {\r\n                    reply.pushMsg = reply.pushContentType == 0 ?\r\n                    '消息为“<b>' + reply.pushContent + '</b>”' :\r\n                    '消息中含“<b>' + reply.pushContent + '</b>”';\r\n                });\r\n                renderReplies();\r\n                $pager.IXPager({total : page.pageCount, page: page.pageNo, maxVisible: 10, href : 'javascript:;'});\r\n            });\r\n        }\r\n        \r\n        function renderReplies()\r\n        {\r\n            emptyAlert[replies.length ? 'hide' : 'show']();\r\n            var trs = [];\r\n            for(var i = 0, reply; reply = replies[i++];)\r\n                trs.push(tplTr(reply));\r\n            \r\n            $tbody.html(trs.join(''));\r\n        }\r\n        \r\n        function findReply(itemID, flag)\r\n        {\r\n            for(var i = 0, reply; reply = replies[i++];)\r\n                if(reply.itemID == itemID) return flag ? i - 1 : reply;\r\n                \r\n            return flag ? -1 : null;\r\n        }\r\n        \r\n    }\r\n    \r\n    \r\n})(jQuery, window);\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n;(function ($, window) {\r\n\tIX.ns(\"Hualala.Weixin\");\r\n    \r\n    Hualala.Weixin.initSubscribe = function($pageBody, mpID)\r\n    {\r\n        var W = Hualala.Weixin,\r\n            G = Hualala.Global,\r\n            C = Hualala.Common,\r\n            tplLib = Hualala.TplLib,\r\n            U = Hualala.UI,\r\n            topTip = Hualala.UI.TopTip;\r\n            \r\n        if(!mpID) return;\r\n        \r\n        var $subscribe = $(tplLib.get('tpl_wx_subscribe')).appendTo($pageBody),\r\n            $select = $subscribe.find('select'),\r\n            $resView = $subscribe.find('.form-control-static'),\r\n            $save = $subscribe.find('#saveBtn');\r\n            \r\n        var subscribe = { mpID: mpID, pushMsgType: 'event', pushEvent: 'subscribe' },\r\n            resources = [];\r\n        \r\n        G.getWeixinSubscribe({mpID: mpID, pushEvent: '(\\\"subscribe\\\")'}, function(rsp)\r\n        {\r\n            $save.prop('disabled', false);\r\n            if(rsp.resultcode != '000')\r\n            {\r\n                rsp.resultmsg && topTip({msg: rsp.resultmsg, type: 'danger'});\r\n                return;\r\n            }\r\n            var records = rsp.data.records || [],\r\n                subsc = records[0];\r\n            subscribe = subsc || subscribe;\r\n            W.createResourceChosen($select, $resView, resources, subscribe.resourceID)\r\n            .done(function(res){ resources = res; });\r\n        });\r\n        \r\n        $save.on('click', function()\r\n        {\r\n            var resourceID = $select.val(),\r\n                res = _.findWhere(resources, {itemID: resourceID});\r\n            subscribe.resourceID = resourceID;\r\n            subscribe.resourceVaule = 1;\r\n            subscribe.replyContent = res.resTitle;\r\n            subscribe.replyMsgType = res.resType == '2' ? 'text' : 'news';\r\n            \r\n            G[subscribe.itemID ? 'updateWeixinSubscribe' : 'addWeixinSubscribe'](subscribe, function(rsp)\r\n            {\r\n                if(rsp.resultcode != '000')\r\n                {\r\n                    rsp.resultmsg && topTip({msg: rsp.resultmsg, type: 'danger'});\r\n                    return;\r\n                }\r\n                topTip({msg: '保存成功！', type: 'success'});\r\n                if(!subscribe.itemID)\r\n                    subscribe.itemID = rsp.data.records[0].itemID;\r\n            });\r\n        });\r\n        \r\n    }\r\n    \r\n    \r\n})(jQuery, window);\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n;(function ($, window) {\r\n\tIX.ns(\"Hualala.Weixin\");\r\n    \r\n    Hualala.Weixin.initMenu = function($pageBody, mpID)\r\n    {\r\n        if(!mpID) return;\r\n        var W = Hualala.Weixin,\r\n            G = Hualala.Global,\r\n            C = Hualala.Common,\r\n            U = Hualala.UI,\r\n            tplLib = Hualala.TplLib,\r\n            loadData = C.loadData,\r\n            topTip = U.TopTip;\r\n        \r\n        var $pageCont = $(tplLib.get('tpl_wx_menu')).appendTo($pageBody),\r\n            $buttons = $pageBody.find('#menuPanel button')\r\n            $menuWrap = $pageBody.find('#menuWrap'),\r\n            dt = Handlebars.compile('<dt id=\"{{id}}\"><i class=\"caret\"></i><b>{{name}}</b></dt>'),\r\n            dd = Handlebars.compile('<dd id=\"{{id}}\"><b>{{name}}</b></dd>'),\r\n            editMenuTpl = Handlebars.compile(tplLib.get('tpl_wx_menu_edit')),\r\n            $menuClick = $(tplLib.get('tpl_wx_menu_ops')),\r\n            $menuHover = $menuClick.clone(),\r\n            $noMenuTip = $pageBody.find('#noMenuTip'),\r\n            $actions = $pageBody.find('#actionPanel > div'),\r\n            $showTip = $pageBody.find('#showTip'),\r\n            \r\n            resSelect = '<select class=\"link-select\"></select>',\r\n            $resWrap = $actions.find('.res-wrap'),\r\n            $resView = $actions.find('.res-preview'),\r\n            \r\n            $selectWrap = $actions.find('.link-select-wrap'),\r\n            $contentWrap = $actions.find('.link-content-wrap'),\r\n            \r\n            $save = $pageBody.find('#saveBtn');\r\n            \r\n        var menus = [], selectedMenu = null,\r\n            resources = [], dataHolder = {};\r\n            \r\n        var methods = {\r\n                addMenu: addMenu,\r\n                importMenu: importMenu,\r\n                saveMenu: saveMenu,\r\n                publishMenu: publishMenu,\r\n                toAction: toAction,\r\n                showTip: showTip,\r\n                chooseAction: chooseAction,\r\n                sendMsg: sendMsg,\r\n                saveMsg: saveMsg,\r\n                toPage: toPage,\r\n                saveLink: saveLink,\r\n                scanCode: scanCode,\r\n                addSubMenu: addSubMenu,\r\n                editMenu: editMenu,\r\n                deleteMenu: deleteMenu,\r\n                moveMenuUp: moveMenuUp,\r\n                moveMenuDown: moveMenuDown\r\n            };\r\n        \r\n        //通过Hulala.Global.getWeixinAccounts这个接口来获取菜单数据\r\n        loadData('getWeixinAccounts', {mpID: mpID}).done(getMenus);\r\n        \r\n        function getMenus(rsp)\r\n        {\r\n            var records = rsp || [],\r\n                record = records[0] || {},\r\n                menuJson = $.parseJSON(record.menuJson || '{}'),\r\n                menuObj = menuJson.menu || {};\r\n                \r\n            menus = menuObj.button || [];\r\n            renderMenu();\r\n        }\r\n        \r\n        function renderMenu()\r\n        {\r\n            var dls = [];\r\n            for(var i = 0, menu; menu = menus[i]; i++)\r\n            {\r\n                menu.id = '' + i;\r\n                if(menu.url)\r\n                {\r\n                    menu.softType = '22';\r\n                    menu.softWenChoose = menu.url;\r\n                    delete menu.url;\r\n                }\r\n                var $dl = $('<dl>').append(dt(menu)),\r\n                    subMenus = menu.sub_button || [];\r\n                for(var j = 0, sm; sm = subMenus[j]; j++)\r\n                {\r\n                    sm.id = i + '' + j;\r\n                    if(sm.url)\r\n                    {\r\n                        sm.softType = '22';\r\n                        sm.softWenChoose = sm.url;\r\n                        delete sm.url;\r\n                    }\r\n                    $dl.append(dd(sm));\r\n                }\r\n                \r\n                dls.push($dl);\r\n            }\r\n            $menuWrap.html(dls);\r\n            $noMenuTip.toggleClass('hidden', !!menus.length);\r\n            \r\n            var $menu = selectedMenu ? $menuWrap.find('#' + selectedMenu.id) : null;\r\n            if($menu && $menu[0])\r\n                 resovleMenuClick.call($menu, {target: $menu});\r\n            else\r\n                toAction(null, 'showTip', '请选择某个菜单项，然后在此选择或者设置相关动作。');\r\n        }\r\n        \r\n        $menuWrap.on('mouseenter', 'dt, dd', function()\r\n        {\r\n            var $this = $(this);\r\n            if(!$this.is('.selected')) $this.append($menuHover);\r\n        })\r\n        .on('mouseleave', 'dt, dd', function(){ $menuHover.remove(); })\r\n        .on('click', 'dt, dd', resovleMenuClick);\r\n        \r\n        $pageCont.on('click', function(e)\r\n        {\r\n            var $target = $(e.target),\r\n                methodName = $target.data('action');\r\n            if(!$target.is('dt, dd, .glyphicon') \r\n            && methodName && methods[methodName])\r\n                methods[methodName]($target);\r\n        });\r\n        \r\n        function addMenu()\r\n        {\r\n            var menuCount = menus.length;\r\n            if(menuCount >= 3){\r\n                U.Alert({msg: '微信一级菜单最多只能创建3个！'});\r\n                return;\r\n            }\r\n            \r\n            var $form = $(editMenuTpl({menuType: '一', max: 5})),\r\n                $input = $form.find('input'),\r\n                modal = new U.ModalDialog({title: '添加一级菜单', html: $form}).show();\r\n            modal._.footer.find('.btn-ok').text('确定').on('click', function()\r\n            {\r\n                var val = $.trim($input.val());\r\n                if(!val) { topTip({msg: '请输入菜单名称！'}); return; }\r\n                var menu = selectedMenu = { name: val};\r\n                menus.push(menu);\r\n                renderMenu();\r\n                modal.hide();\r\n            });\r\n        }\r\n        \r\n        function importMenu($target)\r\n        {\r\n            $target.button('importing');\r\n            $buttons.attr('disabled', 'disabled');\r\n            loadData('importWinxinMenu', {mpID: mpID})\r\n            .done(function(rsp)\r\n            {\r\n                selectedMenu = null, menus = [];\r\n                topTip({msg: '导入成功！', type: 'success'});\r\n                getMenus(rsp);\r\n            })\r\n            .always(function(){ resetButtons($target) });\r\n        }\r\n        \r\n        function saveMenu($target)\r\n        {\r\n            var params = procPostMenuData();\r\n            if(!params) return;\r\n            if($target)\r\n            {\r\n                $target.button('saving');\r\n                $buttons.attr('disabled', 'disabled');\r\n            }\r\n            loadData('saveWinxinMenu', params, null, false)\r\n            .done(function()\r\n            {\r\n                topTip({msg: '保存成功！', type: 'success'}); \r\n            })\r\n            .always(function(){ resetButtons($target) });\r\n        }\r\n        \r\n        function publishMenu($target)\r\n        {\r\n            var params = procPostMenuData();\r\n            if(!params) return;\r\n            //saveMenu(null, params);\r\n            $target.button('publishing');\r\n            $buttons.attr('disabled', 'disabled');\r\n            loadData('publishWinxinMenu', params, null, false)\r\n            .done(function()\r\n            {\r\n                topTip({msg: '发布成功！', type: 'success'}); \r\n            })\r\n            .always(function(){ resetButtons($target) });\r\n        }\r\n        \r\n        function resetButtons($target)\r\n        {\r\n            if(!$target) return;\r\n            setTimeout(function()\r\n            {\r\n                $target.button('reset');\r\n                $buttons.removeAttr('disabled');\r\n            }, 300)\r\n        }\r\n        \r\n        function procPostMenuData()\r\n        {\r\n            var _menus = JSON.parse(JSON.stringify(menus));\r\n            for(var i = 0, menu; menu = _menus[i]; i++)\r\n            {\r\n                menu.sub_button = menu.sub_button || [];\r\n                var subMenus = menu.sub_button;\r\n                if(!menu.type && !subMenus.length)\r\n                {\r\n                    topTip({msg: '一级菜单“' + menu.name + '”没有设置动作，也没有添加二级菜单！', type: 'warning'});\r\n                    return false;\r\n                }\r\n                delete menu.id;\r\n                for(var j = 0, sm; sm = subMenus[j]; j++)\r\n                {\r\n                    if(!sm.type)\r\n                    {\r\n                        topTip({msg: '二级菜单“' + sm.name + '”没有设置动作！', type: 'warning'});\r\n                        return false;\r\n                    }\r\n                    sm.sub_button = [];\r\n                    delete sm.id;\r\n                }\r\n            }\r\n            \r\n            return {\r\n                mpID: mpID, \r\n                menuJson: JSON.stringify({menu: { button: _menus}})\r\n            };\r\n        }\r\n        \r\n        function resovleMenuClick(e)\r\n        {\r\n            var $this = $(this),\r\n                id = $this.attr('id'),\r\n                $target = $(e.target),\r\n                menuInfo = getMenuInfo(id),\r\n                menu = menuInfo.menu,\r\n                methodName = $target.data('action');\r\n            \r\n            if($target.is('span i') && methodName && methods[methodName]) \r\n                methods[methodName]($this, menuInfo);\r\n            \r\n            if($this.is('.selected') || $target.is('span i')) return;\r\n            \r\n            selectedMenu = menu;\r\n            $menuHover.remove();\r\n            $menuWrap.find('.selected').removeClass('selected');\r\n            $this.addClass('selected').append($menuClick);\r\n            \r\n            var type = menu.type, subMenus = menu.sub_button || [];\r\n            if(!type && !subMenus.length) \r\n                toAction(null, 'chooseAction');\r\n            else if(!type && subMenus.length) \r\n                toAction(null, 'showTip', '已有子菜单，无法设置动作！');\r\n            else if(type == 'click')\r\n                toAction(null, 'sendMsg');\r\n            else if(type == 'view')\r\n                toAction(null, 'toPage');\r\n            else if(type == 'scancode_push')\r\n                toAction(null, 'scanCode');\r\n        }\r\n        \r\n        function getMenuInfo(id)\r\n        {\r\n            for(var i = 0, menu; menu = menus[i]; i++)\r\n            {\r\n                if(id == menu.id)\r\n                    return {menu: menu, menus: menus, index: i};\r\n                var subMenus = menu.sub_button || [];\r\n                for(var j = 0, sm; sm = subMenus[j]; j++)\r\n                    if(id == sm.id)\r\n                        return {menu: sm, menus: subMenus, index: j};\r\n            }\r\n        }\r\n        \r\n        function toAction(from, to, msg)\r\n        {\r\n            var actionName = to || from.data('target'),\r\n                method = methods[actionName];\r\n            $actions.hide().filter('#' + actionName).fadeIn();\r\n            if(method) method(msg);\r\n        }\r\n        \r\n        function showTip(msg) { $showTip.text(msg); }\r\n        \r\n        function chooseAction() \r\n        {\r\n            for(p in selectedMenu)\r\n                if(!/name|id/.test(p)) delete selectedMenu[p];\r\n        }\r\n        \r\n        function sendMsg()\r\n        {\r\n            var key = selectedMenu.key || '',\r\n                match = key.match(/\\d+/),\r\n                resID = (match && match[0]) || '',\r\n                $select = $resWrap.html(resSelect).find('select');\r\n            \r\n            W.createResourceChosen($select, $resView, resources, resID)\r\n            .done(function(res){ resources = res; });\r\n        }\r\n        \r\n        function saveMsg()\r\n        {\r\n            var val = $resWrap.find('select').val();\r\n            if(!val)\r\n            {\r\n                topTip({msg: '未选择任何事件回复内容！'});\r\n                return;\r\n            }\r\n            \r\n            var res = _.find(resources, {itemID: val}),\r\n                pres = _.pick(res, 'mpID', 'resTitle');\r\n            pres.resourceID = val;\r\n            pres.resType = res.resType == 2 ? 'text' : 'news';\r\n            pres.pushEvent = \"('CLICK')\";\r\n            loadData('WeixinMenuClick', pres, null, false)\r\n            .done(function()\r\n            {\r\n                selectedMenu.type = 'click';\r\n                selectedMenu.key = 'Resources:' + val;\r\n                topTip({msg: '菜单设置成功！（保存菜单后生效）', type: 'success'});\r\n            });\r\n        }\r\n        \r\n        function toPage()\r\n        {\r\n            W.createLinkSelector($selectWrap, $contentWrap, dataHolder, selectedMenu.softType, selectedMenu.softWenChoose);\r\n        }\r\n        \r\n        function saveLink()\r\n        {\r\n            var val = $selectWrap.find('select').val();\r\n            if(!val)\r\n            {\r\n                topTip({msg: '未选择任何链接类型！', type: 'warning'});\r\n                return;\r\n            }\r\n            var $cont = $contentWrap.find('select, input'),\r\n                cont = $cont.val();\r\n            if($cont[0] && !cont)\r\n            {\r\n                topTip({msg: '未选择或填写任何链接内容！', type: 'warning'});\r\n                return;\r\n            }\r\n                \r\n            selectedMenu.type = 'view';\r\n            selectedMenu.softType = val;\r\n            selectedMenu.softWenChoose = cont || '';\r\n            topTip({msg: '菜单设置成功！（保存菜单后生效）', type: 'success'});\r\n        }\r\n        \r\n        function scanCode()\r\n        {\r\n            selectedMenu.type = 'scancode_push';\r\n            selectedMenu.key = 'scanMenu';\r\n            //topTip({msg: '菜单设置成功！（保存菜单后生效）', type: 'success'});\r\n        }\r\n        \r\n        function addSubMenu($menu, menuInfo)\r\n        {\r\n            var menu = menuInfo.menu,\r\n                id = menu.id,\r\n                subMenus = menu.sub_button || [],\r\n                subMenuCount = subMenus.length;\r\n            if(menu.type) {\r\n                U.Alert({msg: '该菜单已有动作，要添加子菜单，请先取消此菜单的动作!'});\r\n                return;\r\n            }\r\n            else if(subMenuCount >= 5){\r\n                U.Alert({msg: '微信二级菜单最多只能创建5个！'});\r\n                return;\r\n            }\r\n            \r\n            var $form = $(editMenuTpl({menuType: '二', max: 13})),\r\n                $input = $form.find('input'),\r\n                modal = new U.ModalDialog({title: '添加二级菜单', html: $form}).show();\r\n            modal._.footer.find('.btn-ok').text('确定').on('click', function()\r\n            {\r\n                var val = $.trim($input.val());\r\n                if(!val) { topTip({msg: '请输入菜单名称！'}); return; }\r\n                var subMenu = selectedMenu = { name: val };\r\n                subMenus.push(subMenu);\r\n                menu.sub_button = subMenus;\r\n                renderMenu();\r\n                modal.hide();\r\n            });\r\n        }\r\n        \r\n        function editMenu($menu, menuInfo)\r\n        {\r\n            var menu = menuInfo.menu,\r\n                menuType = menu.id.length == 1 ? '一' : '二',\r\n                max = menu.id.length == 1 ? '5' : '13',\r\n                $form = $(editMenuTpl({name: menu.name, menuType: menuType, max: max})),\r\n                $input = $form.find('input'),\r\n                modal = new U.ModalDialog({title: '编辑菜单名称', html: $form}).show();\r\n            modal._.footer.find('.btn-ok').text('确定').on('click', function()\r\n            {\r\n                var val = $.trim($input.val());\r\n                if(!val) { topTip({msg: '请输入菜单名称！'}); return; }\r\n                menu.name = val;\r\n                $menu.find('b').text(val);\r\n                modal.hide();\r\n            });\r\n        }\r\n        \r\n        function deleteMenu($menu, menuInfo)\r\n        {\r\n            U.Confirm({msg: '确定删除？', okFn: function()\r\n            { \r\n                menuInfo.menus.splice(menuInfo.index, 1);\r\n                if(selectedMenu && !getMenuInfo(selectedMenu.id)) selectedMenu = null;\r\n                \r\n                renderMenu();\r\n            }});\r\n        }\r\n        \r\n        function moveMenuUp($menu, menuInfo)\r\n        {\r\n            if(menuInfo.index == 0) return;\r\n            var index = menuInfo.index,\r\n                menu = menuInfo.menu,\r\n                menus = menuInfo.menus,\r\n                temp = menus[index - 1];\r\n            menus[index - 1] = menu;\r\n            menus[index] = temp;\r\n            \r\n            renderMenu();\r\n        }\r\n        \r\n        function moveMenuDown($menu, menuInfo)\r\n        {\r\n            var index = menuInfo.index,\r\n                menu = menuInfo.menu,\r\n                menus = menuInfo.menus,\r\n                maxIndex = menus.length - 1;\r\n            if(index == maxIndex) return;\r\n            var temp = menus[index + 1];\r\n            menus[index + 1] = menu;\r\n            menus[index] = temp;\r\n            \r\n            renderMenu();\r\n        }\r\n        \r\n    }\r\n    \r\n    \r\n})(jQuery, window);\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n;;(function ($, window) {\r\n\tIX.ns(\"Hualala.Weixin\");\r\n    \r\n    Hualala.Weixin.initAdvertorial = function($pageBody, mpID)\r\n    {\r\n        var W = Hualala.Weixin,\r\n            C = Hualala.Common,\r\n            tplLib = Hualala.TplLib,\r\n            U = Hualala.UI,\r\n            topTip = Hualala.UI.TopTip;\r\n        \r\n        var $pageCont = $(tplLib.get('tpl_wx_advertorial')).appendTo($pageBody),\r\n            $ul = $pageBody.find('#adList ul'),\r\n            $loading = $pageBody.find('.ad-loading'),\r\n            $pager = $pageBody.find('.ad-pager'),\r\n            $alert = $pageBody.find('#adList .alert'),\r\n            $adCont = $pageBody.find('#adCont'),\r\n            $headBtn = $adCont.find('.panel-head .btn'),\r\n            $article = $adCont.find('article'),\r\n            $adTitle = $adCont.find('.ad-title'),\r\n            $input = $adCont.find('.ad-title-input'),\r\n            $adSubTitle = $adCont.find('.ad-sub-title'),\r\n            $adPreview = $adCont.find('.ad-preview');\r\n        \r\n        UM.delEditor('adEditor');\r\n        var emotions = W.getEmotions(); dataHolder = {},\r\n            toolbar = W.extendUM(emotions, dataHolder),\r\n            adEditor = UM.getEditor('adEditor', { toolbar: ['source | undo redo | bold italic underline strikethrough | superscript subscript | forecolor backcolor | removeformat |',\r\n            'insertorderedlist insertunorderedlist | selectall cleardoc paragraph | fontfamily fontsize' ,\r\n            '| justifyleft justifycenter justifyright justifyjustify |',\r\n            'wxlink unlink | image video | map',\r\n            '| horizontal print preview', 'drafts'] });\r\n        \r\n        var adTpl = Handlebars.compile([\r\n        '{{#each records}}',\r\n        '<li data-id=\"{{itemID}}\">',\r\n            '<h3>{{title}}</h3>',\r\n            '<h6>{{time}}  {{groupName}}</h6>',\r\n        '</li>',\r\n        '{{/each}}'].join(''));\r\n        \r\n        var params = { pageNo: 1, pageSize: 10 }, \r\n            ads = [], ad, sGroupName = Hualala.getSessionSite().groupName;\r\n        \r\n        var methods = {\r\n                addAd: addAd,\r\n                editAd: editAd,\r\n                delAd: delAd,\r\n                saveAd: saveAd,\r\n                concelEdit: concelEdit\r\n            };\r\n        \r\n        $ul.on('click', 'li', function()\r\n        {\r\n            if($adCont.is('.editing'))\r\n            {\r\n                topTip({msg: '请先保存或者取消当前正在编辑的软文！', type: 'warning'});\r\n                return;\r\n            }\r\n            var $this = $(this);\r\n            $ul.find('li').removeClass('current');\r\n            $this.addClass('current');\r\n            ad = _.findWhere(ads, {itemID: $this.data('id')+''});\r\n            $adTitle.text(ad.title);\r\n            $input.val(ad.title);\r\n            $adSubTitle.text(ad.time + '  ' + ad.groupName);\r\n            $adPreview.html(ad.body);\r\n            adEditor.setContent(ad.body);\r\n            $article.removeClass('dn');\r\n            $headBtn.removeClass('dn');\r\n            $(window).scrollTop(0);\r\n        });\r\n        \r\n        $pageCont.on('click', '.btn', function()\r\n        {\r\n            var $this = $(this),\r\n                methodName = $this.data('action');\r\n            if(methodName && methods[methodName])\r\n                methods[methodName]($this);\r\n        });\r\n        \r\n        $pager.on('page', function(e, pageNo)\r\n        {\r\n            params.pageNo = pageNo;\r\n            getAds();\r\n        });\r\n        \r\n        getAds();\r\n        function getAds()\r\n        {\r\n            ads = [];\r\n            $ul.hide();\r\n            $headBtn.addClass('dn');\r\n            $article.addClass('dn');\r\n            $loading.show();\r\n            C.loadData('getAdvertorials', params, null, 'data')\r\n            .done(function(data)\r\n            {\r\n                data.records = data.records || [];\r\n                _.each(data.records, function(record){ record.time = C.formatDateStr(record.actionTime, 8); });\r\n                ads = data.records;\r\n                renderAds(data);\r\n            })\r\n            .always(function(){ $loading.hide(); });\r\n        }\r\n        \r\n        function renderAds(data)\r\n        {\r\n            $ul.show().html(adTpl(data));\r\n            var page = data.page;\r\n            $pager.IXPager({total : page.pageCount, page: page.pageNo, maxVisible: 10, href : 'javascript:;'});\r\n            $headBtn.toggleClass('dn', !ads.length);\r\n            $article.toggleClass('dn', !ads.length);\r\n            $alert.toggleClass('dn', !!ads.length);\r\n            if(ads.length) $ul.find('li').eq(0).click();\r\n            \r\n        }\r\n        \r\n        function addAd()\r\n        {\r\n            if($adCont.is('.editing'))\r\n            {\r\n                topTip({msg: '请先保存当前正在编辑的软文！', type: 'warning'});\r\n                return;\r\n            }\r\n            $ul.find('.current').removeClass('current');\r\n            ad = null;\r\n            $input.val('');\r\n            $adSubTitle.text(sGroupName);\r\n            adEditor.setContent('');\r\n            $adCont.addClass('editing');\r\n            $article.removeClass('dn');\r\n            $headBtn.addClass('dn');\r\n        }\r\n        \r\n        function editAd()\r\n        {\r\n            $adCont.addClass('editing');\r\n            $headBtn.attr('disabled', 'disabled');\r\n        }\r\n        \r\n        function delAd($btn)\r\n        {\r\n            U.Confirm({msg: '确定删除？', okFn: function()\r\n            { \r\n                disBtn($btn, 'deleting');\r\n                C.loadData('deleteAdvertorial', {itemID: ad.itemID}, null, false)\r\n                .done(function()\r\n                {\r\n                    var i = C.inArray(ads, ad, 'itemID');\r\n                    $ul.find('[data-id='+ ad.itemID + ']').remove();\r\n                    ads.splice(i, 1);\r\n                    ad = null;\r\n                    $ul.find('li').eq(0).click();\r\n                    if(!ads.length)\r\n                    {\r\n                        params.pageNo = 1;\r\n                        getAds();\r\n                    }\r\n                    topTip({msg: '删除成功!', type: 'success'});\r\n                })\r\n                .always(function(){ resetBtn($btn) });\r\n            }});\r\n        }\r\n        \r\n        function saveAd($btn)\r\n        {\r\n            var title = $.trim($input.val());\r\n            if(!title)\r\n            {\r\n                topTip({msg: '请输入软文标题！', type: 'warning'});\r\n                $input.focus();\r\n                return;\r\n            }\r\n            disBtn($btn, 'saving');\r\n            var body = adEditor.getContent(),\r\n                groupName = ad ? ad.groupName : groupName,\r\n                saveAction = ad ? updateAd : createAd;\r\n            saveAction($btn, {title: title, body: body, groupName: sGroupName});\r\n        }\r\n        \r\n        function updateAd($btn, _ad)\r\n        {\r\n            _ad.itemID = ad.itemID;\r\n            C.loadData('updateAdvertorial', _ad, null, false)\r\n            .done(function()\r\n            {\r\n                /*ad.title = _ad.title;\r\n                ad.body = _ad.body;\r\n                $(window).scrollTop(0);\r\n                $ul.find('.current h3').text(ad.title);\r\n                $adTitle.text(ad.title);\r\n                $adPreview.html(ad.body);*/\r\n                params.pageNo = 1;\r\n                getAds();\r\n                $adCont.removeClass('editing');\r\n                $headBtn.removeAttr('disabled', 'disabled');\r\n                topTip({msg: '保存成功!', type: 'success'});\r\n            })\r\n            .always(function(){ resetBtn($btn) });\r\n        }\r\n        \r\n        function createAd($btn, _ad)\r\n        {\r\n            C.loadData('createAdvertorial', _ad)\r\n            .done(function(records)\r\n            {\r\n                ad = records[0];\r\n                ad.time = C.formatDateStr(ad.actionTime, 8);\r\n                ads.unshift(ad);\r\n                $adCont.removeClass('editing');\r\n                $alert.addClass('dn');\r\n                $(adTpl({records: records})).prependTo($ul.show()).click();\r\n                topTip({msg: '保存成功!', type: 'success'});\r\n            })\r\n            .always(function(){ resetBtn($btn) });\r\n        }\r\n        \r\n        function concelEdit()\r\n        {\r\n            $adCont.removeClass('editing');\r\n            if(!ads.length)\r\n            {\r\n                $headBtn.addClass('dn');\r\n                $article.addClass('dn');\r\n                $alert.removeClass('dn');\r\n                return;\r\n            }\r\n            if(!ad)\r\n            {\r\n                $ul.find('li').eq(0).click();\r\n                return;\r\n            }\r\n            $headBtn.removeAttr('disabled');\r\n            $input.val(ad.title);\r\n            adEditor.setContent(ad.body);\r\n            $(window).scrollTop(0);\r\n        }\r\n        \r\n        function disBtn($btn, state)\r\n        {\r\n            if(!$btn) return;\r\n            $btn.button(state);\r\n            $btn.attr('disabled', 'disabled');\r\n        }\r\n        \r\n        function resetBtn($btn)\r\n        {\r\n            if(!$btn) return;\r\n            setTimeout(function()\r\n            {\r\n                $btn.button('reset').removeAttr('disabled');\r\n            }, 300)\r\n        }\r\n        \r\n    }\r\n    \r\n})(jQuery, window);\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n;(function ($, window) {\r\n\tIX.ns(\"Hualala.Weixin\");\r\n    \r\n    Hualala.Weixin.initContent = function($pageBody, mpID)\r\n    {\r\n        var W = Hualala.Weixin,\r\n            G = Hualala.Global,\r\n            C = Hualala.Common,\r\n            tplLib = Hualala.TplLib,\r\n            U = Hualala.UI,\r\n            topTip = Hualala.UI.TopTip;\r\n        \r\n        $pageBody.html(tplLib.get('tpl_wx_content'));\r\n        \r\n        var resActionTpl = tplLib.get('tpl_wx_res_action'),\r\n            resEditTpl = Handlebars.compile(tplLib.get('tpl_wx_res_edit')),\r\n            imgHost = G.IMAGE_RESOURCE_DOMAIN + '/';\r\n        \r\n        var cols = {\r\n                '1': $('<div></div>').addClass('col-xs-12'),\r\n                '2': $('<div></div><div></div>').addClass('col-xs-6'),\r\n                '3': $('<div></div><div></div><div></div>').addClass('col-xs-4'),\r\n                '4': $('<div></div><div></div><div></div><div></div>').addClass('col-xs-3')\r\n            };\r\n            \r\n        var $win = $(window), $cols, $fall = $pageBody.find('.fall'),\r\n            $noCont = $pageBody.find('.no-cont'),\r\n            $loading = $pageBody.find('.loading-tip');\r\n        \r\n        var params = { pageNo: 0, pageSize: 50 }, \r\n            allConts = [], index = 0, size = 20,\r\n            isLoading, isLoaded, maxMutilContSize = 8;\r\n        \r\n        layout();\r\n        loadConts(renderConts);\r\n        \r\n        $win.off('.wxCont')\r\n        .on('resize.wxCont', _.throttle(layout, 200))\r\n        .on('scroll.wxCont', _.throttle(scrollConts, 200));\r\n        \r\n        $fall.on('click', '.res-view', function(e)\r\n        {\r\n            var $me = $(this);\r\n            if($me.is('.animating')) return;\r\n            var cont = _.findWhere(allConts, {itemID: $me.attr('resid')}),\r\n                $target = $(e.target);\r\n            if($target.is('.del-res')) deleteCont(cont);\r\n            else if($target.is('.edit-res')) editCont(cont);\r\n        });\r\n        \r\n        $pageBody.on('click', '#addContOne', function()\r\n        {\r\n            var cont = { resTitle: '标题1', resType: '0' },\r\n                resources = [{resTitle: '标题1', resTypeContent: {}}],\r\n                resContent = { isMul: '0', resources: resources };\r\n            \r\n            cont.resContent = JSON.stringify(resContent);\r\n            editCont(cont);\r\n        });\r\n        \r\n        $pageBody.on('click', '#addContMulti', function()\r\n        {\r\n            var cont = { resTitle: '标题1', resType: '1' },\r\n                resources = [{resTitle: '标题1', resTypeContent: {}}];\r\n            resources.push({resTitle: '标题2', resTypeContent: {}});\r\n            var resContent = { isMul: '1', resources: resources };\r\n            cont.resContent = JSON.stringify(resContent);\r\n            editCont(cont);\r\n        });\r\n        \r\n        var dataHolder = {},\r\n            resSubTpl = tplLib.get('tpl_wx_res_sub');\r\n        function checkResItem(resItem, type, $contentWrap)\r\n        {\r\n            var $linkCont = $contentWrap.find('select, input'),\r\n                noLinkCont = !$contentWrap.is('.hidden') && $linkCont[0] && !$linkCont.val();\r\n            var ret = !resItem.resTitle \r\n                || !resItem.imgPath \r\n                || (type == 0 && !resItem.digest)\r\n                || !resItem.resType\r\n                || noLinkCont ? false : true;\r\n            var msg = !resItem.resTitle ? '请输入当前图文的标题！' \r\n                : !resItem.imgPath ? '请上传当前图文的图片！' \r\n                : type == 0 && !resItem.digest ? '请输入图文摘要！'\r\n                : !resItem.resType ? '请选择当前图文的链接类型！'\r\n                : noLinkCont ? '请选择或输入当前图文的链接内容！' : '';\r\n            \r\n            if(!ret) topTip({msg: msg});\r\n            \r\n            return ret;\r\n        }\r\n        function editCont(cont)\r\n        {\r\n            var itemID = cont.itemID,\r\n                resType = cont.resType,\r\n                resArr = $.parseJSON(cont.resContent).resources,\r\n                activeRes = resArr[0],\r\n                $resEdit = $(resEditTpl(activeRes)),\r\n                $resWrap = $resEdit.filter('.res-wrap'),\r\n                $resForm = $resEdit.filter('.res-form'),\r\n                $resTitle = $resForm.find('.res-title'),\r\n                $resDigest = $resForm.find('.res-digest'),\r\n                $selectWrap = $resForm.find('.link-select-wrap'),\r\n                $contentWrap = $resForm.find('.link-content-wrap'),\r\n                title = (itemID ? '修改' : '添加') +\r\n                        (resType == 1 ? '多' : '单') + '图文消息',\r\n                modal = new U.ModalDialog({title: title, html: $resEdit, sizeCls: 'modal-lg'}).show();\r\n                \r\n            modal._.body.addClass('clearfix');\r\n            W.createResourceView(cont, null, true).appendTo($resWrap);\r\n            \r\n            var $activeRes = $resWrap.find('.res-single, .active');\r\n            $resTitle.on('change', function()\r\n            {\r\n                activeRes.resTitle = this.value;\r\n                $activeRes.find('h4, h6').text(this.value); \r\n            });\r\n            $resDigest.on('change', function()\r\n            {\r\n                activeRes.digest = this.value;\r\n                $activeRes.find('p').text(this.value); \r\n            });\r\n            $selectWrap.on('change', 'select', function()\r\n            {\r\n                activeRes.resType = this.value;\r\n                activeRes.resTypeContent.resType = this.value;\r\n                if($contentWrap.is('.hidden')) \r\n                    delete activeRes.resTypeContent.urlOrCity;\r\n            });\r\n            $contentWrap.on('change', 'select, input', function()\r\n            {\r\n                activeRes.resTypeContent.urlOrCity = this.value;\r\n            });\r\n            \r\n            W.createLinkSelector($selectWrap, $contentWrap, dataHolder, \r\n                activeRes.resType, activeRes.resTypeContent.urlOrCity);\r\n            \r\n            U.imgUpload($resForm.find('.btn'), function(rsp)\r\n            {\r\n                activeRes.imgPath = rsp.url;\r\n                var i = $activeRes.index(),\r\n                    hwp = parseFloat((+rsp.imgHWP).toFixed(2)),\r\n                    replaceStr = (hwp ? '=' + (i == 0 ? Math.round(160 / hwp) + 'x' + 160 : '75x75' ) : '') + '$&',\r\n                    imgUrl = imgHost + rsp.url.replace(/\\.\\w+$/, replaceStr) + '?quality=70';\r\n                $activeRes.find('img, .img').replaceWith($('<img>').attr('src', imgUrl));\r\n            });\r\n            \r\n            modal._.footer.find('.btn-ok').on('click', function()\r\n            {\r\n                if(!checkResItem(activeRes, resType, $contentWrap)) return;\r\n                if(!itemID && resType == 1 && activeRes != resArr[1])\r\n                {\r\n                    $resWrap.find('.res-mask').eq(1).click();\r\n                    if(!checkResItem(activeRes, resType, $contentWrap)) return;\r\n                }\r\n                var submitFunc = itemID ? updateCont : createCont,\r\n                    _cont = $.extend({}, cont),\r\n                    resContent = { isMul: cont.resType, resources: resArr };\r\n                \r\n                _cont.resTitle = resArr[0].resTitle;\r\n                _cont.resContent = JSON.stringify(resContent);\r\n                _cont = _.pick(_cont, 'itemID', 'resTitle', 'resType', 'resContent');\r\n                submitFunc(_cont, cont, modal);\r\n                \r\n            });\r\n            \r\n            if(resType != 1) return;\r\n            $resForm.find('.digest-wrap').hide();\r\n            var $icoDel = $('<i class=\"glyphicon glyphicon-remove\" title=\"删除\"></i>');\r\n            \r\n            if(resArr.length > 2)\r\n                $resWrap.find('.res-mask').last().append($icoDel);\r\n            var $addSubRes = $resWrap.find('.add-sub-res');\r\n            if(resArr.length >= maxMutilContSize)\r\n                $addSubRes.addClass('disabled');\r\n            $resWrap.on('click', '.res-mask', function(e)\r\n            {\r\n                var $res = $(this).parent(), i = $res.index(), $target = $(e.target);\r\n                if($target.is('.glyphicon-remove'))\r\n                {\r\n                    $res.remove();\r\n                    resArr.pop();\r\n                    var $lastMask = $resWrap.find('.res-mask').eq(i - 1);\r\n                    if(resArr.length > 2) $lastMask.append($icoDel);\r\n                    if($res.is('.active'))\r\n                    {\r\n                        activeRes = resArr[i - 1];\r\n                        $lastMask.click();\r\n                    }\r\n                    if(resArr.length < maxMutilContSize)\r\n                        $addSubRes.removeClass('disabled');\r\n                    return;\r\n                }\r\n                if($res.is('.active') || !checkResItem(activeRes, resType, $contentWrap)) return;\r\n                activeRes = resArr[i];\r\n                $resWrap.find('.active').removeClass('active');\r\n                $res.addClass('active');\r\n                $activeRes = $res;\r\n                $resTitle.val(activeRes.resTitle);\r\n                W.createLinkSelector($selectWrap, $contentWrap, dataHolder, \r\n                    activeRes.resType, activeRes.resTypeContent.urlOrCity);\r\n                \r\n            });\r\n            $resWrap.on('click', '.add-sub-res', function(e)\r\n            {\r\n                if(!checkResItem(activeRes, resType, $contentWrap)) return;\r\n                if($addSubRes.is('.disabled'))\r\n                {\r\n                    topTip({msg: '多图文最多只能添加8项！'});\r\n                    return;\r\n                }\r\n                var res = { resType: 1, resTypeContent: {} };\r\n                res.resTitle = '标题' + ($resWrap.find('.res-mask').length + 1);\r\n                resArr.push(res);\r\n                $res = $(resSubTpl);\r\n                $res.find('h6').text(res.resTitle);\r\n                \r\n                $(this).before($res);\r\n                var $mask = $res.find('.res-mask').click();\r\n                if(resArr.length > 2) \r\n                    $mask.append($icoDel);\r\n                if(resArr.length >= maxMutilContSize)\r\n                    $addSubRes.addClass('disabled');\r\n            })\r\n        }\r\n        \r\n        function updateCont(_cont, cont, modal)\r\n        {\r\n            C.loadData('updateWeixinContent', _cont, null, false)\r\n            .done(function()\r\n            {\r\n                resetConts();\r\n                modal.hide();\r\n                topTip({msg: '修改成功!', type: 'success'});\r\n            });\r\n        }\r\n        \r\n        function createCont(_cont, cont, modal)\r\n        {\r\n            C.loadData('createWeixinContent', _cont)\r\n            .done(function(records)\r\n            {\r\n                topTip({msg: '添加成功!', type: 'success'});\r\n                modal.hide();\r\n                if(!isLoaded) return resetConts();\r\n                \r\n                allConts.unshift(records[0]);\r\n                $cols.empty();\r\n                renderConts();\r\n                $noCont.hide();\r\n            });\r\n        }\r\n        \r\n        function deleteCont(cont, $me)\r\n        {\r\n            U.Confirm({msg: '确定删除？', okFn: function()\r\n            { \r\n                C.loadData('deleteWeixinContent', {itemID: cont.itemID}, null, false)\r\n                .done(function()\r\n                {\r\n                    topTip({msg: '删除成功!', type: 'success'});\r\n                    if(!isLoaded) return resetConts();\r\n                    \r\n                    var i = C.inArray(allConts, cont, 'itemID');\r\n                    allConts.splice(i, 1);\r\n                    $cols.empty();\r\n                    renderConts();\r\n                    if(!allConts.length)\r\n                    {\r\n                        $loading.hide();\r\n                        $noCont.show();\r\n                    }\r\n                });\r\n            }});\r\n        }\r\n        \r\n        function scrollConts()\r\n        {\r\n            if(!isLoaded && !isLoading && allConts.length - index < 50)\r\n                loadConts();\r\n            \r\n            var limitBottom = $win.scrollTop() + $win.height(),\r\n                fallBottom = $fall.offset().top + $fall.height(),\r\n                isAnimated = $fall.find('.res-view:last-child').css('opacity') == 1;\r\n        \r\n            if(fallBottom < limitBottom && index < allConts.length && isAnimated)\r\n            {\r\n                renderConts(allConts.slice(index, index + size));\r\n            }\r\n        }\r\n        \r\n        function renderConts(conts)\r\n        {\r\n            var _conts = conts || allConts.slice(0, index);\r\n            if(!_conts.length) return;\r\n            \r\n            var n = $cols.length, colArr = [];\r\n            for(var i = 0; i < n; i++) colArr.push([]);\r\n            \r\n            for(var i = 0, cont; cont = _conts[i]; i++)\r\n            {\r\n                var $cont = W.createResourceView(cont).append(resActionTpl),\r\n                    mod = i % n;\r\n                if(conts) $cont.addClass('animating').css('opacity', 0);\r\n                colArr[mod].push($cont);\r\n            }\r\n            for(var i = 0, col; col = colArr[i]; i++)\r\n            {\r\n                $cols.eq(i).append(col);\r\n                if(conts) queueAnimation(col);\r\n            }\r\n            \r\n            if(conts) index += size;\r\n        }\r\n        \r\n        function queueAnimation(elems)\r\n        {\r\n            if(!elems.length)\r\n            {\r\n                $win.scroll();\r\n                $loading.hide();\r\n                if(index >= allConts.length && isLoaded)\r\n                    $loading.show().text('全部加载完毕！');\r\n                return;\r\n            }\r\n            $loading.show();\r\n            elems.shift().animate({opacity: 1}, 400, 'linear' , \r\n            function()\r\n            {\r\n                $(this).removeClass('animating');\r\n                queueAnimation(elems);\r\n            });\r\n        }\r\n        \r\n        function loadConts(callback)\r\n        {\r\n            isLoading = true;\r\n            $loading.show();\r\n            params.pageNo++;\r\n            C.loadData('getWeixinContents', params, null, 'data')\r\n            .done(function(data)\r\n            {\r\n                var records = data.records || [],\r\n                    page = data.page || {};\r\n                allConts.push.apply(allConts, records);\r\n                if(page.pageNo >= page.pageCount) isLoaded = true;\r\n                if(!records.length)\r\n                {\r\n                    $noCont.show();\r\n                    return;\r\n                }\r\n                callback && callback(allConts.slice(index, index + size));\r\n            })\r\n            .always(function()\r\n            {\r\n                isLoading = false;\r\n                $loading.hide();\r\n            });\r\n        }\r\n        \r\n        function layout()\r\n        {\r\n            var $_cols = getCols();\r\n            if($cols == $_cols) return;\r\n            $cols = $_cols;\r\n            $fall.html($cols.empty());\r\n            if(!allConts.length) return;\r\n            renderConts();\r\n        }\r\n        \r\n        function getCols()\r\n        {\r\n            var w = $(window).width() , n;\r\n            if(w > 960) n = 4;\r\n            else if(w > 720 && w <= 960) n = 3;\r\n            else if(w > 480 && w <= 720) n = 2;\r\n            else n = 1;\r\n            \r\n            return cols[n];\r\n        }\r\n        \r\n        function resetConts()\r\n        {\r\n            params.pageNo = 0;\r\n            allConts = [];\r\n            index = 0;\r\n            $cols.empty();\r\n            loadConts(renderConts);\r\n        }\r\n    }\r\n    \r\n})(jQuery, window);\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n;(function ($, window) {\r\n\tIX.ns(\"Hualala.Weixin\");\r\n    \r\n    Hualala.Weixin.initText = function($pageBody)\r\n    {\r\n        var W = Hualala.Weixin,\r\n            G = Hualala.Global,\r\n            C = Hualala.Common,\r\n            tplLib = Hualala.TplLib,\r\n            U = Hualala.UI,\r\n            topTip = Hualala.UI.TopTip;\r\n        \r\n        $pageBody.html(tplLib.get('tpl_wx_text'));\r\n        \r\n        var $viewing = $pageBody.find('#viewing'),\r\n            $txts = $viewing.find('#txts'),\r\n            $loading = $viewing.find('#loading'),\r\n            $pager = $viewing.find('.txt-pager'),\r\n            $alert = $viewing.find('.alert-warning'),\r\n            $editing = $pageBody.find('#editing'),\r\n            $editNavTitle = $editing.find('.pt'),\r\n            $txtTitle = $editing.find('#txtTitle');\r\n        \r\n        var txtsTpl = Handlebars.compile(tplLib.get('tpl_wx_txts'));\r\n        var txts = [], params = { pageNo: 1, pageSize: 10 }, current,\r\n            emotions = W.getEmotions(), isAllLoaded, dataHolder = {};\r\n        \r\n        UM.delEditor('txtEditor');\r\n        W.extendUM(emotions, dataHolder);\r\n        var txtEditor = UM.getEditor('txtEditor', {toolbar: ['qqemotion wxlink unlink | undo redo | selectall cleardoc'] });\r\n        txtEditor.execCommand('cleardoc');\r\n        var actions = {\r\n                editTxt: editTxt,\r\n                delTxt: delTxt,\r\n                addTxt: addTxt,\r\n                saveTxt: saveTxt,\r\n                concelEdit: concelEdit\r\n            }\r\n        \r\n        getTxts();\r\n        $pager.on('page', function(e, pageNo)\r\n        {\r\n            params.pageNo = pageNo;\r\n            getTxts();\r\n        });\r\n        \r\n        $pageBody.on('click', '.btn, #txts > li', function(e)\r\n        {\r\n            var $me = $(this), $tar = $(e.target),\r\n                actionName = $me.data('action') || $tar.data('action'),\r\n                action = actions[actionName];\r\n            if(actionName && action) action($me);\r\n        })\r\n        \r\n        function getTxts()\r\n        {\r\n            $loading.show();\r\n            $txts.empty();\r\n            txts = [];\r\n            C.loadData('getWeixinTexts', params, null, 'data')\r\n            .done(function(data)\r\n            {\r\n                var page = data.page;\r\n                $pager.IXPager({total : page.pageCount, page: page.pageNo, maxVisible: 10, href : 'javascript:;'});\r\n                isAllLoaded = page.pageNo >= page.pageCount;\r\n                txts = data.records || [];\r\n                $alert.toggleClass('dn', !!txts.length);\r\n                if(!txts.length) return;\r\n                _.each(txts, function(txt){ txt.txtCont = W.parseEmotions(txt.resContent, emotions); });\r\n                $txts.html(txtsTpl(txts));\r\n            })\r\n            .always(function(){ $loading.hide(); });\r\n        }\r\n        \r\n        function editTxt($txt)\r\n        {\r\n            var itemID = $txt ? $txt.attr('itemid') : '',\r\n                txt = $txt ? _.findWhere(txts, {itemID: itemID}) : { resType: '2' };\r\n            current = { txt: txt, $txt: $txt };\r\n            $txtTitle.val(txt.resTitle);\r\n            txtEditor.setContent(txt.txtCont || '');\r\n            $editNavTitle.text(($txt ? '修改' : '添加') + '文本消息');\r\n            $viewing.hide();\r\n            $editing.show();\r\n        }\r\n        \r\n        function delTxt($txt)\r\n        {\r\n            U.Confirm({msg: '确定删除？', okFn: function()\r\n            {\r\n                var itemID = $txt.attr('itemid');\r\n                C.loadData('deleteWeixinText', {itemID: itemID}, null, false)\r\n                .done(function()\r\n                {\r\n                    topTip({msg: '删除成功!', type: 'success'});\r\n                    var txt = _.findWhere(txts, {itemID: itemID});\r\n                    var i = C.inArray(txts, txt, 'itemID');\r\n                    \r\n                    txts.splice(i, 1);\r\n                    if(!txts.length && !isAllLoaded)\r\n                    {\r\n                        params.pageNo = 1;\r\n                        getTxts();\r\n                        return;\r\n                    }\r\n                    $txt.remove();\r\n                    $alert.toggleClass('dn', !!txts.length);\r\n                });\r\n            }});\r\n        }\r\n        \r\n        function addTxt()\r\n        {\r\n            editTxt();\r\n        }\r\n        \r\n        function saveTxt($btn)\r\n        {\r\n            if(!current) return;\r\n            var resTitle = $.trim($txtTitle.val()),\r\n                resContent = $.trim(filterTxt(txtEditor.getContent())),\r\n                msg = !resTitle ? '请输入标题' :\r\n                      !resContent ? '请输入内容！' : '';\r\n            if(msg)\r\n            {\r\n                topTip({msg: msg, type: 'warning'});\r\n                return;\r\n            }\r\n            $btn.attr('disabled', 'disabled').button('saving');\r\n            var txt = current.txt, $txt = current.$txt,\r\n                _txt = $.extend({}, txt, { resTitle: resTitle, resContent: resContent }),\r\n                submitFunc = $txt ? updateTxt : createTxt;\r\n            submitFunc(_.pick(_txt, 'itemID', 'resTitle', 'resType', 'resContent'), $btn, txt, $txt);\r\n        }\r\n        \r\n        function updateTxt(_txt, $btn, txt, $txt)\r\n        {\r\n            C.loadData('updateWeixinContent', _txt, null, false)\r\n            .done(function()\r\n            {\r\n                /*txt.resTitle = _txt.resTitle;\r\n                txt.resContent = _txt.resContent;\r\n                txt.txtCont = W.parseEmotions(txt.resContent, emotions);\r\n                $txt.find('.t-txt').text(txt.resTitle);\r\n                $txt.find('.txt-cont').html(txt.txtCont);*/\r\n                params.pageNo = 1;\r\n                getTxts();\r\n                setTimeout(function()\r\n                {\r\n                    topTip({msg: '修改成功!', type: 'success'});\r\n                    concelEdit();\r\n                }, 1000);\r\n            })\r\n            .always(function(){ resetBtn($btn); });\r\n        }\r\n        \r\n        function createTxt(_txt, $btn)\r\n        {\r\n            C.loadData('createWeixinContent', _txt)\r\n            .done(function(records)\r\n            {\r\n                var txt = records[0];\r\n                txt.txtCont = W.parseEmotions(txt.resContent, emotions);\r\n                txts.unshift(txt);\r\n                $alert.hide();\r\n                $(txtsTpl([txt])).prependTo($txts);\r\n                setTimeout(function()\r\n                {\r\n                    topTip({msg: '修改成功!', type: 'success'});\r\n                    concelEdit();\r\n                }, 1000);\r\n            })\r\n            .always(function(){ resetBtn($btn); });\r\n        }\r\n        \r\n        function concelEdit()\r\n        {\r\n            current = null;\r\n            $viewing.show();\r\n            $editing.hide();\r\n        }\r\n        \r\n        function filterTxt(txt)\r\n        {\r\n            var conts = $('<div>').html(txt).contents(),\r\n                ret = '';\r\n            for(var i = 0, cont; cont = conts[i++];)\r\n            {\r\n                if(cont.nodeType == 3)\r\n                    ret += cont.nodeValue;\r\n                else if(cont.nodeName.toLowerCase() == 'img')\r\n                    ret += '/' + cont.alt;\r\n                else if(cont.nodeName.toLowerCase() == 'a')\r\n                    ret += '<a href=\"' + cont.href + '\">' + filterTxt(cont.innerHTML) + '</a>';\r\n                else\r\n                    ret += filterTxt(cont.innerHTML);\r\n            }\r\n            return ret;\r\n        }\r\n        \r\n        function resetBtn($btn)\r\n        {\r\n            setTimeout(function()\r\n            {\r\n                $btn.button('reset').removeAttr('disabled');\r\n            }, 1000);\r\n        }\r\n    }\r\n    \r\n    \r\n})(jQuery, window);\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n;(function ($, window) {\r\n\tIX.ns('Hualala.Weixin');\r\n    \r\n    Hualala.Weixin.getEmotions = getEmotions;\r\n    Hualala.Weixin.getLinkTypes = getLinkTypes;\r\n    \r\n    function getEmotions()\r\n    {\r\n        return [\r\n            { url : 'CD/wKgCIVNWKH6hmHQGAAAHEjWPAZs514.gif', title : '微笑'},\r\n            { url : 'CD/wKgCH1NWKH6XWC2eAAAGLnAf7-c591.gif', title : '撇嘴'},\r\n            { url : 'CD/wKgCH1NWKH6MDGgnAAAHDLr8VAc015.gif', title : '色'},\r\n            { url : 'CD/wKgCIVNWKH6n-9spAAAHPEQTyEQ985.gif', title : '发呆'},\r\n            { url : 'CD/wKgCIVNWKH77iHinAAAHuTE4C2A482.gif', title : '得意'},\r\n            { url : 'CD/wKgCH1NWKH7Zf7edAAAHSgtCCG8416.gif', title : '流泪'},\r\n            { url : 'CD/wKgCH1NWKH6xyGFAAAAN5AitwJQ082.gif', title : '害羞'},\r\n            { url : 'CD/wKgCIVNWKH6YRAi2AAAPWXBFl_s040.gif', title : '闭嘴'},\r\n            { url : 'CD/wKgCIVNWKH7U4BSWAAASR42ZkF8934.gif', title : '睡'},\r\n            { url : 'CD/wKgCH1NWKH6fU-ScAAAM4kuzwSw947.gif', title : '大哭'},\r\n            { url : 'CD/wKgCH1NWKH6kRnZ4AAAOhNr-C2A640.gif', title : '尴尬'},\r\n            { url : 'CD/wKgCIVNWKH-5Hxl0AAAfYSRbMUk617.gif', title : '发怒'},\r\n            { url : 'CD/wKgCIVNWKH-Cy2QiAAAIxwh7gJ8587.gif', title : '调皮'},\r\n            { url : 'CD/wKgCH1NWKH_DZSQYAAAGyAJA_uI043.gif', title : '呲牙'},\r\n            { url : 'CD/wKgCH1NWKH--YrfCAAAPpiODsBY933.gif', title : '惊讶'},\r\n            { url : 'CD/wKgCIVNWKH_RQooVAAAGGnFweWw274.gif', title : '难过'},\r\n            { url : 'CD/wKgCIVNWKH_PlZg3AAAFhd405eU255.gif', title : '酷'},\r\n            { url : 'CD/wKgCH1NWKH-rvyFaAAANJobRVnA139.gif', title : '冷汗'},\r\n            { url : 'CD/wKgCH1NWKH_zy_40AAAfyfLjzW0528.gif', title : '抓狂'},\r\n            { url : 'CD/wKgCIVNWKIDmLODOAAAfx7thOIU847.gif', title : '吐'},\r\n            { url : 'CD/wKgCIVNWKID4WKyxAAAHEBEwsog704.gif', title : '偷笑'},\r\n            { url : 'CD/wKgCH1NWKICsFM_3AAAHSNA129k556.gif', title : '可爱'},\r\n            { url : 'CD/wKgCH1NWKIDtm2xhAAALwnkTd8E528.gif', title : '白眼'},\r\n            { url : 'CD/wKgCIVNWKIChwcKbAAAHntrRtOU292.gif', title : '傲慢'},\r\n            { url : 'CD/wKgCIVNWKIDoIMNzAAAI0YNpmX8518.gif', title : '饥饿'},\r\n            { url : 'CD/wKgCH1NWKICzMaRiAAAJjqlzh0s106.gif', title : '困'},\r\n            { url : 'CD/wKgCH1NWKIClntTjAAAPrv0u1iE580.gif', title : '惊恐'},\r\n            { url : 'CD/wKgCIVNWKIDTeBDAAAALTUiZH1E231.gif', title : '流汗'},\r\n            { url : 'CD/wKgCIVNWKICY8xuSAAAMvksAY_c342.gif', title : '憨笑'},\r\n            { url : 'CD/wKgCH1NWKIGa3CXNAAAW5RugBIc941.gif', title : '大兵'},\r\n            { url : 'CD/wKgCH1NWKIHTKKpZAAAG9OMVt48363.gif', title : '奋斗'},\r\n            { url : 'CD/wKgCIVNWKIGw3p30AAAUNliA67o282.gif', title : '咒骂'},\r\n            { url : 'CD/wKgCIVNWKIHS-AKHAAAcFXdc82Q472.gif', title : '疑问'},\r\n            { url : 'CD/wKgCH1NWKIG5_BNwAAAQ3fqvFkA245.gif', title : '嘘'},\r\n            { url : 'CD/wKgCH1NWKIGigs9mAAAIXKFk83E124.gif', title : '晕'},\r\n            { url : 'CD/wKgCIVNWKIGptYlqAAA0UDIQLFg977.gif', title : '折磨'},\r\n            { url : 'CD/wKgCIVNWKIGYPIIjAAAFiWXFty8768.gif', title : '衰'},\r\n            { url : 'CD/wKgCH1NWKIGtyC8hAAAEq48_kyg648.gif', title : '骷髅'},\r\n            { url : 'CD/wKgCH1NWKIGOfYHZAAAGisisHhw165.gif', title : '敲打'},\r\n            { url : 'CD/wKgCIVNWKIKjx8PKAAAHBpwa4CY851.gif', title : '再见'},\r\n            { url : 'CD/wKgCIVNWKIL_MnpUAAAnbBIu5y0245.gif', title : '擦汗'},\r\n            { url : 'CD/wKgCH1NWKILZEx53AAANKIT20WQ983.gif', title : '抠鼻'},\r\n            { url : 'CD/wKgCH1NWKIKV60t7AAA0N2DE7bc169.gif', title : '鼓掌'},\r\n            { url : 'CD/wKgCIVNWKIL59hU5AAAQ54o41Kk036.gif', title : '糗大了'},\r\n            { url : 'CD/wKgCIVNWKILEbQCZAAAGI_0O4X8576.gif', title : '坏笑'},\r\n            { url : 'CD/wKgCH1NWKIL4kuL3AAASVA6Ifk4545.gif', title : '左哼哼'},\r\n            { url : 'CD/wKgCH1NWKILHWREjAAAUKj4EcvQ524.gif', title : '右哼哼'},\r\n            { url : 'CD/wKgCIVNWKILQMPcYAAAOZSkc7Jw649.gif', title : '哈欠'},\r\n            { url : 'CD/wKgCIVNWKIPuGPqAAAAG25fNuM8445.gif', title : '鄙视'},\r\n            { url : 'CD/wKgCH1NWKIKMa-JLAAAY2TnURuo416.gif', title : '委屈'},\r\n            { url : 'CD/wKgCH1NWKIPMPmP1AAAMAaVr23I453.gif', title : '快哭了'},\r\n            { url : 'CD/wKgCIVNWKIOOgnj1AAAOkx4Bh_Q822.gif', title : '阴险'},\r\n            { url : 'CD/wKgCIVNWKIOeUKLLAAAF_GTXs6Q904.gif', title : '亲亲'},\r\n            { url : 'CD/wKgCH1NWKIO1xGMuAAAICHoJBFw359.gif', title : '吓'},\r\n            { url : 'CD/wKgCH1NWKIPN2fzNAAAJOoITboY253.gif', title : '可怜'},\r\n            { url : 'CD/wKgCIVNWKIO0xK32AAAGLs6b_Ro551.gif', title : '菜刀'},\r\n            { url : 'CD/wKgCIVNWKIPqGwCbAAAEkqSp4Sw833.gif', title : '西瓜'},\r\n            { url : 'CD/wKgCH1NWKIObPGkbAAAT0DNHWAo512.gif', title : '啤酒'},\r\n            { url : 'CD/wKgCH1NWKIPa_VUOAAAKJHslunM338.gif', title : '篮球'},\r\n            { url : 'CD/wKgCIVNWKIPZZ5N8AAAF_WKxMqw106.gif', title : '乒乓'},\r\n            { url : 'CD/wKgCIVNWKISwryuSAAAKa9RcamE946.gif', title : '咖啡'},\r\n            { url : 'CD/wKgCH1NWKISyfwdlAAAEcPmAmvc991.gif', title : '饭'},\r\n            { url : 'CD/wKgCH1NWKISLlrJrAAAE9SamlGU206.gif', title : '猪头'},\r\n            { url : 'CD/wKgCIVNWKISAOssoAAADy2tCJ7o039.gif', title : '玫瑰'},\r\n            { url : 'CD/wKgCIVNWKISr6e_dAAAD3L7K5vE917.gif', title : '凋谢'},\r\n            { url : 'CD/wKgCH1NWKIT4_u6FAAAUpYIuysE035.gif', title : '示爱'},\r\n            { url : 'CD/wKgCH1NWKITgj9d5AAAEh2XzeLs214.gif', title : '爱心'},\r\n            { url : 'CD/wKgCIVNWKITxvLsxAAAKujCDjJU510.gif', title : '心碎'},\r\n            { url : 'CD/wKgCIVNWKITkdjGzAAAQNAagCHU699.gif', title : '蛋糕'},\r\n            { url : 'CD/wKgCH1NWKISIFHmqAAAD91kg-JE423.gif', title : '闪电'},\r\n            { url : 'CD/wKgCH1NWKITiVZFvAAAEiniNOl4497.gif', title : '炸弹'},\r\n            { url : 'CD/wKgCIVNWKITI_Kz4AAADOMg7F1U036.gif', title : '刀'},\r\n            { url : 'CD/wKgCIVNWKIX0UCPGAAAOXyFMKrE161.gif', title : '足球'},\r\n            { url : 'CD/wKgCH1NWKITMNY5JAAAIk5fThiw184.gif', title : '瓢虫'},\r\n            { url : 'CD/wKgCH1NWKIWI9sApAAAJllKthhY471.gif', title : '便便'},\r\n            { url : 'CD/wKgCIVNWKIX4NcPwAAAExrdFHOM457.gif', title : '月亮'},\r\n            { url : 'CD/wKgCIVNWKIXj--DBAAAEu_hcC4k274.gif', title : '太阳'},\r\n            { url : 'CD/wKgCH1NWKIXq0Gx-AAAEfxCtQPg896.gif', title : '礼物'},\r\n            { url : 'CD/wKgCH1NWKIXgdKPvAAAGHeYffaA847.gif', title : '拥抱'},\r\n            { url : 'CD/wKgCIVNWKIWyKM5FAAAF7ovU57E277.gif', title : '强'},\r\n            { url : 'CD/wKgCIVNWKIWPKrOXAAAGATpp04Q875.gif', title : '弱'},\r\n            { url : 'CD/wKgCH1NWKIW7CKJJAAAGN4PjHgk736.gif', title : '握手'},\r\n            { url : 'CE/wKgCH1NWKIWII8xPAAAGC-ylE0I030.gif', title : '胜利'},\r\n            { url : 'CD/wKgCIVNWKIX9Fcn-AAAGN720qlg404.gif', title : '抱拳'},\r\n            { url : 'CD/wKgCIVNWKIWhnWQNAAANYEzopPo145.gif', title : '勾引'},\r\n            { url : 'CE/wKgCH1NWKIWRtwPHAAAGLccwr7c365.gif', title : '拳头'},\r\n            { url : 'CE/wKgCH1NWKIWyVvLpAAAF73AN-Og539.gif', title : '差劲'},\r\n            { url : 'CD/wKgCIVNWKIblO0ySAAAGFsLpii0260.gif', title : '爱你'},\r\n            { url : 'CD/wKgCIVNWKIb3ntxnAAAIVqQUcy4531.gif', title : 'NO'},\r\n            { url : 'CE/wKgCH1NWKIac15IHAAAEw64jKVA529.gif', title : 'OK'},\r\n            { url : 'CE/wKgCH1NWKIbSXxzGAAAKtzujC9w203.gif', title : '爱情'},\r\n            { url : 'CD/wKgCIVNWKIbgjhDrAAACjgWZXP4623.gif', title : '飞吻'},\r\n            { url : 'CD/wKgCIVNWKIb9abFsAAAFYZ2yllA765.gif', title : '跳跳'},\r\n            { url : 'CE/wKgCH1NWKIaHBEHzAAAEX99eGAg355.gif', title : '发抖'},\r\n            { url : 'CE/wKgCH1NWKIepcK-tAAANYvdRETc255.gif', title : '怄火'},\r\n            { url : 'CE/wKgCIVNWKIfwhBJGAAALwyRDuF8811.gif', title : '转圈'},\r\n            { url : 'CE/wKgCIVNWKIfJFeNwAAAHBGnVicw191.gif', title : '磕头'},\r\n            { url : 'CE/wKgCH1NWKIfoDJwQAAAUtOcKYmU453.gif', title : '回头'},\r\n            { url : 'CE/wKgCH1NWKIe5FEqLAAAGXUlhmqw064.gif', title : '跳绳'},\r\n            { url : 'CE/wKgCIVNWKIeb6F2UAAAI1QqtQ7Y764.gif', title : '挥手'},\r\n            { url : 'CE/wKgCIVNWKIe8INuBAAAG9HJo2zM848.gif', title : '激动'},\r\n            { url : 'CE/wKgCH1NWKIfndJHDAAAJi-oVE34806.gif', title : '街舞'},\r\n            { url : 'CE/wKgCH1NWKIedbP9SAAAFps_xS8w196.gif', title : '献吻'},\r\n            { url : 'CE/wKgCIVNWKIizikDBAAAIdrn1ytM011.gif', title : '左太极'},\r\n            { url : 'CE/wKgCIVNWKIjSNEstAAAIeX2ucII889.gif', title : '右太极'}\r\n        ];\r\n    }\r\n    \r\n    function getLinkTypes()\r\n    {\r\n        return [\r\n            { value: '1', title: '软文', type: 'select', subTitle: '软文', api: 'getAdvertorials', params: {}, keys: ['itemID', 'title'],\r\n            urlTpl: 'share/{{arg1}}' },\r\n            { value: '2', title: '集团首页',\r\n            urlTpl: 'index.htm?sc=wechat&mpid=${mpID}&g={{g}}' },\r\n            { value: '3', title: '店铺预定搜索网页', type: 'select', subTitle: '城市', api: 'getCities', params: { isActive: 1 }, keys: ['cityID', 'cityName'], firstItem: {cityID: '0', cityName: '附近' },\r\n            urlTpl: 'shop/common.htm?{{arg2}}&sc=wechat&mpid=${mpID}&g={{g}}' },\r\n            { value: '4', title: '订座点菜具体店铺', type: 'select', subTitle: '店铺', api: 'queryShop', params: {}, keys: ['shopID', 'shopName'],\r\n            urlTpl: 'shop/shop.htm?t=0&i={{arg1}}&sc=wechat&mpid=${mpID}&g={{g}}' },\r\n            { value: '5', title: '店铺外卖搜索网页' , type: 'select', subTitle: '城市', api: 'getCities', params: { isActive: 1 }, keys: ['cityID', 'cityName'], firstItem: {cityID: '0', cityName: '附近' },\r\n            urlTpl: 'shop/takeaway.htm?{{arg2}}&sc=wechat&mpid=${mpID}&g={{g}}&' },\r\n            { value: '6', title: '外卖自提具体店铺', type: 'select', subTitle: '店铺', api: 'queryShop', params: {}, keys: ['shopID', 'shopName'],\r\n            urlTpl: 'shop/shop.htm?t=1&i={{arg1}}&sc=wechat&mpid=${mpID}&g={{g}}' },\r\n            { value: '7', title: '附近店铺',\r\n            urlTpl: 'shop/near.htm' },\r\n            { value: '8', title: '(新)成为会员',\r\n            urlTpl: 'crm/vip_details.htm?sc=wechat&mpid=${mpID}&g={{g}}' },\r\n            { value: '9', title: '(新)我的会员卡',\r\n            urlTpl: 'crm/vip_details.htm?sc=wechat&mpid=${mpID}&g={{g}}' },\r\n            { value: '10', title: '成为会员',\r\n            urlTpl: 'vip/register.htm?sc=wechat&mpid=${mpID}&g={{g}}' },\r\n            { value: '11', title: '我的会员卡',\r\n            urlTpl: 'vip/main.htm?sc=wechat&mpid=${mpID}&g={{g}}' },\r\n            { value: '12', title: '我的代金券',\r\n            urlTpl: 'user/event.htm?sc=wechat&mpid=${mpID}' },\r\n            { value: '13', title: '我的订单页',\r\n            urlTpl: 'user/order.htm?sc=wechat&mpid=${mpID}' },\r\n            { value: '14', title: '我的账户',\r\n            urlTpl: 'user/user.htm?sc=wechat&mpid=${mpID}&g={{g}}' },\r\n            { value: '15', title: '会员活动列表',\r\n            urlTpl: 'vip/intro.htm?sc=wechat&mpid=${mpID}&g={{g}}' },\r\n            { value: '16', title: '会员具体活动', type: 'select', subTitle: '会员活动', api: 'getCrmEvents', params: {}, keys: ['eventIdWay', 'eventName'],\r\n            urlTpl: 'vip/event{{arg3}}.htm?e={{arg1}}&sc=wechat&mpid=${mpID}&g={{g}}' },\r\n            { value: '17', title: '用户活动', type: 'select', subTitle: '用户活动', api: 'getUserEvents', params: { eventStatus: 1 }, keys: ['eventItemID', 'eventSubjects'],\r\n            urlTpl: 'events/event.htm?i={{arg1}}&sc=wechat&mpid=${mpID}&g={{g}}' },\r\n            { value: '18', title: '用户反馈',\r\n            urlTpl: 'user/feedback.htm?sc=wechat&mpid=${mpID}&g={{g}}' },\r\n            { value: '19', title: '代金券交易', type: 'select', subTitle: '城市', api: 'getCities', params: { isActive: 1 }, keys: ['cityID', 'cityName'], firstItem: {cityID: '0', cityName: '附近' },\r\n            urlTpl: 'voucher/list.htm?sc=wechat&mpid=${mpID}&g={{g}}&c={{arg1}}' },\r\n            { value: '20', title: '排队取号搜索',\r\n            urlTpl: 'table/near.htm?sc=wechat&mpid=${mpID}&g={{g}}' },\r\n            { value: '21', title: '报名活动', type: 'select', subTitle: '用户活动', api: 'getUserEvents', params: { eventStatus: 1, gameWay: 20 }, keys: ['eventItemID', 'eventSubjects'],\r\n            urlTpl: 'events/apply.htm?i={{arg1}}&sc=wechat&mpid=${mpID}&g={{g}}' },\r\n            { value: '22', title: '自定义链接', type: 'input', subTitle: '内容',\r\n            urlTpl: '{{arg1}}' }\r\n        ];\r\n    }\r\n    \r\n})(jQuery, window);\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n;(function ($, window) {\r\n\tIX.ns(\"Hualala.Weixin\");\r\n    var WX = Hualala.Weixin;\r\n    \r\n\t/*微信管理模块子页面整体页面布局*/\r\n\tfunction initWeixinPageLayout (pageName, $body, subNavCfg) {\r\n\t\tvar navTpl = Handlebars.compile(Hualala.TplLib.get('tpl_order_subnav'));\r\n\t\tHandlebars.registerPartial(\"toggle\", Hualala.TplLib.get('tpl_site_navbarToggle'));\r\n\t\t$body.empty();\r\n\t\t$body.html('<div class=\"page-subnav clearfix\" /><div class=\"page-body clearfix\"></div>');\r\n\t\tvar mapNavRenderData = function () {\r\n\t\t\tvar navs = _.map(subNavCfg, function (v) {\r\n\t\t\t\tvar params = _.map($XP(v, 'pkeys', []), function (v) {\r\n\t\t\t\t\treturn '';\r\n\t\t\t\t});\r\n\t\t\t\treturn {\r\n\t\t\t\t\tactive : pageName == v.name ? 'active' : '',\r\n\t\t\t\t\tdisabled : '',\r\n\t\t\t\t\tpath : Hualala.PageRoute.createPath(v.name, params) || '#',\r\n\t\t\t\t\tname : v.name || '',\r\n\t\t\t\t\tlabel : v.label || ''\r\n\t\t\t\t};\r\n\t\t\t});\r\n\t\t\treturn {\r\n\t\t\t\ttoggle : {\r\n\t\t\t\t\ttarget : '#order_navbar'\r\n\t\t\t\t},\r\n\t\t\t\titems : navs\r\n\t\t\t};\r\n\t\t};\r\n\t\tvar $navbar = $body.find('.page-subnav');\r\n\t\t$navbar.html(navTpl(mapNavRenderData()));\r\n\t}\r\n    \r\n    var groupID, mpID, accounts;\r\n    function renderWxAcountInfo($container, callback)\r\n    {\r\n        var sessionGroupID = Hualala.getSessionSite().groupID,\r\n            U = Hualala.UI,\r\n            $pageBody = $container.find('.page-body');\r\n        if(groupID == sessionGroupID)\r\n        {\r\n            renderData(); return;\r\n        }\r\n\r\n        Hualala.Global.getWeixinAccounts({}, function(rsp)\r\n        {\r\n            if(rsp.resultcode != '000')\r\n            {\r\n                rsp.resultmsg && U.TopTip({msg: rsp.resultmsg, type: 'danger'});\r\n                return;\r\n            }\r\n            \r\n            accounts = _.map(rsp.data.records || [], function(record) {\r\n                return { mpID: record.mpID, mpName: record.mpName };\r\n            });\r\n            groupID = sessionGroupID;\r\n            if(accounts.length) mpID = accounts[0].mpID;\r\n            \r\n            renderData();\r\n        });\r\n        \r\n        function renderData()\r\n        {\r\n            var $select = $('<div class=\"bs-callout weixin-brand\"><select class=\"form-control\" />微信公共账号</div>').insertAfter('.page-subnav').find('select');\r\n            U.fillSelect($select, accounts, 'mpID', 'mpName', false).val(mpID).on('change', function()\r\n            { \r\n                mpID = $(this).val();\r\n                mpID && callback && callback($pageBody.empty(), mpID);\r\n            });\r\n            \r\n            mpID && callback && callback($pageBody.empty(), mpID);\r\n        }\r\n    }\r\n    \r\n    function createResourceChosen($select, $resView, resources, cv, width)\r\n    {\r\n        var U = Hualala.UI, R = Hualala.PageRoute, \r\n            emotions = WX.getEmotions(),\r\n            cfg = {width: '100%', matchField: 'resTitle'}, df = $.Deferred();\r\n        \r\n        function fn()\r\n        {\r\n            U.createChosen($select, resources, 'itemID', 'resName', cfg, false, cv || '')\r\n            .on('change', function()\r\n            {\r\n                $resView.html(WX.createResourceView(_.findWhere(resources, { itemID: this.value }), emotions));\r\n            }).change();\r\n            df.resolve(resources);\r\n        }\r\n        \r\n        if(width) cfg.width = width;\r\n        if(resources && resources.length) fn();\r\n        else Hualala.Global.getWeixinResources({isActive: 1, resType: '(0,1,2)'}, function(rsp)\r\n        {\r\n            if(rsp.resultcode != '000')\r\n            {\r\n                rsp.resultmsg && U.TopTip({msg: rsp.resultmsg, type: 'danger'});\r\n                return;\r\n            }\r\n            resources = rsp.data.records || [];\r\n            _.each(resources, function(item){ item.resName = (item.resType == '2' ? '(文本)' : '(图文)') + item.resTitle });\r\n            if(!resources.length)\r\n            {\r\n                var $msg = $('<div>尚无可用素材资源，无法进行此操作！您可以先在<a href=\"\" data-page=\"wxContent\" />或者<a href=\"\" data-page=\"wxText\" />下添加一些素材资源。</div>');\r\n                    $a = $msg.find('a').each(function()\r\n                    {\r\n                        var $this = $(this),\r\n                            path = R.createPath($this.data('page')),\r\n                            label = R.getPageContextByPath(path).label;\r\n                        $this.attr('href', path).text(label);\r\n                    }),\r\n                    modal = U.Alert({msg: $msg});\r\n                $a.on('click', function(){ modal.hide() });\r\n                return;\r\n            }\r\n            fn();\r\n        });\r\n        return df.promise();\r\n    }\r\n    \r\n    function parseEmotions(text, emotions)\r\n    {\r\n        var emotions = emotions || WX.getEmotions(),\r\n            imgHost = Hualala.Global.IMAGE_RESOURCE_DOMAIN + '/group1/M00/00/',\r\n            imgTpl = Handlebars.compile('<img src=\"{{url}}\" alt=\"{{title}}\" />');\r\n        \r\n        return text.replace(/\\/[\\u4E00-\\u9FA5]+/g, function(match)\r\n        {\r\n            var eTitle = match.slice(1);\r\n            for(var i = 0, em; em = emotions[i++];)\r\n            {\r\n                if(eTitle.indexOf(em.title) == 0) \r\n                    return eTitle.replace(em.title, imgTpl({url: imgHost + em.url, title: em.title}));\r\n            }\r\n                \r\n            return match;\r\n        });\r\n    }\r\n    \r\n    function createResourceView(res, emotions, editing)\r\n    {\r\n        var resType = res.resType;\r\n        if(resType == 2)\r\n        {\r\n            emotions = emotions || WX.getEmotions();\r\n            return parseEmotions(res.resContent, emotions)\r\n        };\r\n        \r\n        var itemID = res.itemID,\r\n            resContent = $.parseJSON(res.resContent),\r\n            $resWiew = $('<div>').attr('resid', itemID).addClass('res-view ' + (resType == 1 ? 'multi' : '')),\r\n            resArr = resContent.resources || [],\r\n            imgHost = Hualala.Global.IMAGE_RESOURCE_DOMAIN + '/';\r\n        \r\n        for(var i = 0, r; r = resArr[i]; i++)\r\n        {\r\n            var $resItem = $('<div>'),\r\n                imgUrl = imgHost + r.imgPath + '?quality=70';\r\n            if(resType == 0)\r\n            {\r\n                $resItem.addClass('res-single')\r\n                .append($('<h4>').text(r.resTitle))\r\n                .append(itemID ? $('<img>').attr('src', imgUrl) : '<div class=\"img\">封面图片</div>')\r\n                .append($('<p>').text(r.digest));\r\n            }\r\n            else if(i == 0)\r\n            {\r\n                $resItem.addClass('res-cover')\r\n                .append(itemID ? $('<img>').attr('src', imgUrl) : '<div class=\"img\">封面图片</div>')\r\n                .append($('<h4>').text(r.resTitle));\r\n                if(editing)\r\n                    $resItem.addClass('active').append('<div class=\"res-mask\"><i class=\"glyphicon glyphicon-pencil\"></i></div>');\r\n            }\r\n            else\r\n            {\r\n                $resItem.addClass('res-sub')\r\n                .append(itemID ? $('<img>').attr('src', imgUrl) : '<div class=\"img\">缩略图</div>')\r\n                .append($('<h6>').text(r.resTitle));\r\n                if(editing)\r\n                    $resItem.append('<div class=\"res-mask\"><i class=\"glyphicon glyphicon-pencil\" title=\"编辑\"></i></div>');\r\n            }\r\n            $resWiew.append($resItem);\r\n        }\r\n        if(resType == 1 && editing)\r\n            $resWiew.append('<div class=\"add-sub-res\"><div><i class=\"glyphicon glyphicon-plus\"></i></div></div>');\r\n            \r\n        return $resWiew;\r\n    }\r\n    \r\n    function createLinkSelector($selectWrap, $contentWrap, dataHolder, linkID, linkCont)\r\n    {\r\n        var that = createLinkSelector,\r\n            linkTypes = that.linkTypes || WX.getLinkTypes();\r\n            \r\n        dataHolder = dataHolder || {};\r\n        that.linkTypes = linkTypes;\r\n        linkID = linkID || 1;\r\n        linkCont = linkCont || '';\r\n        \r\n        that.renderLinkContent = that.renderLinkContent ||\r\n        function(linkInfo, $contentWrap, dataHolder, linkCont)\r\n        {\r\n            var U = Hualala.UI,\r\n                $linkName = $contentWrap.find('.link-name'),\r\n                $linkContent = $contentWrap.find('.link-content'),\r\n                subTitle = linkInfo.subTitle,\r\n                type = linkInfo.type;\r\n                \r\n            $contentWrap.toggleClass('hidden', !type);\r\n            $linkName.text('链接' + subTitle);\r\n            $linkContent.html(type ? type == 'select' ? \r\n            '<select class=\"form-control\">' \r\n            : '<input class=\"form-control\" placeholder=\"完整URL，如：http://m.hualala.com\">'\r\n            : '');\r\n            \r\n            if(type == 'input') $linkContent.find('input').val(linkCont);\r\n            if(type != 'select') return;\r\n            \r\n            var api = linkInfo.api, data = dataHolder[api]\r\n                keys = linkInfo.keys;\r\n            Hualala.Common.loadData(api, linkInfo.params, data)\r\n            .done(function(records)\r\n            {\r\n                records = records || [];\r\n                if(!records.length)\r\n                {\r\n                    U.TopTip({msg: '获取' + subTitle + '信息为空！', type: 'warning'});\r\n                    return;\r\n                }\r\n                if(!dataHolder[api])\r\n                {\r\n                    dataHolder[api] = _.map(records, function(record)\r\n                    {\r\n                        return api == 'getCrmEvents' ? {\r\n                            eventIdWay: record.eventID + '-' + record.eventWay,\r\n                            eventName: record.eventName,\r\n                            py: record.py\r\n                        } : _.pick(record, keys.concat(['py']));\r\n                    });\r\n                }\r\n                \r\n                var firstItem = linkInfo.firstItem || false;\r\n                U.createChosen($linkContent.find('select'), \r\n                dataHolder[api], keys[0], keys[1], { width: '100%' }, firstItem, linkCont)\r\n                .change();\r\n                \r\n            });\r\n        }\r\n        \r\n        Hualala.UI.fillSelect($selectWrap.html('<select class=\"form-control\"></select>').find('select'), \r\n        linkTypes, 'value', 'title', false).val(linkID)\r\n        .on('change', function()\r\n        {\r\n            that.renderLinkContent(linkTypes[this.value - 1], $contentWrap, dataHolder, linkCont);\r\n            linkCont = '';\r\n        }).change();\r\n    }\r\n    \r\n    function createQQEmotionPanel(emotions)\r\n    {\r\n        emotions = emotions || WX.getEmotions();\r\n        var $ret = $('<ul></ul><div></div>'),\r\n            $ul = $ret.filter('ul');\r\n        for(var i = 0, em; em = emotions[i]; i++)\r\n        {\r\n            $('<li>').attr('title', em.title).data('url', em.url)\r\n            .append($('<i>').css('background-position', -i * 24 +'px 0'))\r\n            .appendTo($ul);\r\n        }\r\n        \r\n        return $ret;\r\n    }\r\n    \r\n    function createWeixinUrl(linkType, param)\r\n    {\r\n        var groupID = Hualala.getSessionSite().groupID,\r\n            chref = location.href,\r\n            env = chref.indexOf('mu.dianpu') > -1 ? 'mu.' :\r\n                  chref.indexOf('dohko.dianpu') > -1 ? 'dohko.' : '',\r\n            urlHost = 'http://' + env + 'm.hualala.com/',\r\n            linkTypes = createLinkSelector.linkTypes || WX.getLinkTypes(),\r\n            urlTpl = Handlebars.compile(linkTypes[linkType - 1].urlTpl),\r\n            args = { arg1: param, g: groupID };\r\n            \r\n        if(linkType == 3 || linkType == 5) \r\n            args.arg2 = param == 0 ? 't=near' : 'c=' + param;\r\n        else if(linkType == 16) \r\n        {\r\n            var _args = param.split('-'),\r\n                eventID = _args[0],\r\n                eventWay = _args[1];\r\n            args.arg1 = eventID;\r\n            args.arg3 = eventWay == 20 ? '_turntable' : '';\r\n        }\r\n        \r\n        var urlPart = urlTpl(args);\r\n        \r\n        return linkType == 22 ? urlPart : urlHost + urlPart;\r\n    }\r\n    \r\n    function extendUM(emotions, dataHolder)\r\n    {\r\n        emotions && UM.registerUI( 'qqemotion', function(name)\r\n        {\r\n            var me = this;\r\n            var $btn = $.eduibutton({ icon: 'emotion', title: '表情' });\r\n            var edui = $.eduipopup().css('zIndex',me.options.zIndex + 1)\r\n                .addClass('edui-popup-' + name).edui();\r\n            var $popupBody = edui.getBodyContainer()\r\n                    .html(createQQEmotionPanel(emotions))\r\n                    .on('click', function(){ return false; }),\r\n                $preview = $popupBody.find('div'),\r\n                imgHost = Hualala.Global.IMAGE_RESOURCE_DOMAIN + '/group1/M00/00/';\r\n            $popupBody.on('mouseenter', 'li', function()\r\n            {\r\n                var $li = $(this), url = $li.data('url');\r\n                $preview.show().html($('<img>').attr('src', imgHost + url));\r\n            })\r\n            $popupBody.on('mouseleave', 'li', function()\r\n            {\r\n                $preview.hide();\r\n            })\r\n            .on('click', 'li', function()\r\n            {\r\n                var $li = $(this), url = $li.data('url'), title = $li.attr('title');\r\n                //me.execCommand( 'insertimage', { src: imgHost + url, alt: title, 'class': 'qqemotion' });\r\n                me.execCommand( 'inserthtml', '<img src=\"' + imgHost + url + '\" alt=\"' + title + '\" style=\"width: 24px; height: 24px\" />');\r\n                edui.hide();\r\n            });\r\n            \r\n            edui.on('beforeshow',function()\r\n            {\r\n                var $root = this.root();\r\n                if(!$root.parent().length)\r\n                    me.$container.find('.edui-dialog-container').append($root);\r\n                    \r\n                $preview.empty();\r\n                UM.setTopEditor(me);\r\n            })\r\n            .attachTo($btn, {offsetTop: -5, offsetLeft: 10, caretLeft: 11, caretTop: -8});\r\n            \r\n            me.addListener('selectionchange', function ()\r\n            {\r\n                var state = this.queryCommandState(name);\r\n                $btn.edui().disabled(state == -1).active(state == 1);\r\n            });\r\n            \r\n            return $btn;\r\n        });\r\n        \r\n        dataHolder && UM.registerUI( 'wxlink', function(name)\r\n        {\r\n            var me = this;\r\n                $btn = $.eduibutton({ icon: 'link', title: '链接' });\r\n            var U = Hualala.UI,\r\n                linkTpl = Hualala.TplLib.get('tpl_wx_txt_link');\r\n            $btn.on('click', function()\r\n            {\r\n                var $link = $(linkTpl),\r\n                    $selectWrap = $link.find('.link-select-wrap'),\r\n                    $contentWrap = $link.find('.link-content-wrap'),\r\n                    modal = new U.ModalDialog({title: '添加链接', html: $link}).show();\r\n                \r\n                createLinkSelector($selectWrap, $contentWrap, dataHolder);\r\n                modal._.footer.find('.btn-ok').text('确定').on('click', function()\r\n                {\r\n                    var linkType = $selectWrap.find('select').val(),\r\n                        linkCont = $contentWrap.find('select, input').val();\r\n                    if(!linkType)\r\n                    {\r\n                        U.TopTip({msg: '请选择链接类型！', type: 'warning'});\r\n                        return;\r\n                    }\r\n                    if(linkCont !== undefined && !linkCont)\r\n                    {\r\n                        U.TopTip({msg: '请选择或输入链接！', type: 'warning'});\r\n                        return;\r\n                    }\r\n                    var url = createWeixinUrl(linkType, linkCont).replace(/^\\s+|\\s+$/g, '');\r\n                    if(url) me.execCommand('link', {'href': url, '_href': url});\r\n                    modal.hide();\r\n                });\r\n            });\r\n            \r\n            me.addListener('selectionchange', function ()\r\n            {\r\n                var state = this.queryCommandState(name);\r\n                $btn.edui().disabled(state == -1).active(state == 1);\r\n            });\r\n            \r\n            return $btn;\r\n        });\r\n        \r\n        return ['source | undo redo | bold italic underline strikethrough | superscript subscript | forecolor backcolor | removeformat |',\r\n            'insertorderedlist insertunorderedlist | selectall cleardoc paragraph | fontfamily fontsize' ,\r\n            '| justifyleft justifycenter justifyright justifyjustify |',\r\n            'wxlink unlink | qqemotion image video  | map',\r\n            '| horizontal print preview', 'drafts']; \r\n    }\r\n    \r\n    $.extend(WX, {\r\n        createResourceChosen: createResourceChosen,\r\n        parseEmotions: parseEmotions,\r\n        createResourceView: createResourceView,\r\n        createLinkSelector: createLinkSelector,\r\n        extendUM: extendUM,\r\n        //微信首页\r\n        homeInit: function() { location.href = Hualala.PageRoute.createPath('wxReply')},\r\n        //自动回复页面\r\n        replyInit: function()\r\n        {\r\n            var pageName = Hualala.PageRoute.getPageContextByPath().name;\r\n            var $body = $('#ix_wrapper > .ix-body > .container');\r\n            initWeixinPageLayout(pageName, $body, Hualala.TypeDef.WeixinAdminSubNavType);\r\n            renderWxAcountInfo($body, WX.initReply);\r\n        },\r\n        //订阅消息页面\r\n        subscribeInit: function()\r\n        {\r\n            var pageName = Hualala.PageRoute.getPageContextByPath().name;\r\n            var $body = $('#ix_wrapper > .ix-body > .container');\r\n            initWeixinPageLayout(pageName, $body, Hualala.TypeDef.WeixinAdminSubNavType);\r\n            renderWxAcountInfo($body, WX.initSubscribe);\r\n        },\r\n        //自定义微信菜单页面\r\n        menuInit: function()\r\n        {\r\n            var pageName = Hualala.PageRoute.getPageContextByPath().name;\r\n            var $body = $('#ix_wrapper > .ix-body > .container');\r\n            initWeixinPageLayout(pageName, $body, Hualala.TypeDef.WeixinAdminSubNavType);\r\n            renderWxAcountInfo($body, WX.initMenu);\r\n        },\r\n        //软文管理\r\n        advertorialInit: function()\r\n        {\r\n            var pageName = Hualala.PageRoute.getPageContextByPath().name;\r\n            var $container = $('#ix_wrapper > .ix-body > .container');\r\n            initWeixinPageLayout(pageName, $container, Hualala.TypeDef.WeixinMaterialSubNavType);\r\n            WX.initAdvertorial($container.find('.page-body'));\r\n        },\r\n        //软文管理\r\n        contentInit: function()\r\n        {\r\n            var pageName = Hualala.PageRoute.getPageContextByPath().name;\r\n            var $container = $('#ix_wrapper > .ix-body > .container');\r\n            initWeixinPageLayout(pageName, $container, Hualala.TypeDef.WeixinMaterialSubNavType);\r\n            WX.initContent($container.find('.page-body'));\r\n        },\r\n        //文本管理\r\n        textInit: function()\r\n        {\r\n            var pageName = Hualala.PageRoute.getPageContextByPath().name;\r\n            var $container = $('#ix_wrapper > .ix-body > .container');\r\n            initWeixinPageLayout(pageName, $container, Hualala.TypeDef.WeixinMaterialSubNavType);\r\n            WX.initText($container.find('.page-body'));\r\n        }\r\n        \r\n    });\r\n\r\n\t\r\n\r\n})(jQuery, window);\r\n\r\n\r\n\r\n\r\n\r\n\r\n;(function ($, window) {\r\n\tIX.ns(\"Hualala.MCM\");\r\n\tvar HMCM = Hualala.MCM;\r\n\r\n\tvar GiftMgrResultModel = Stapes.subclass({\r\n\t\t/**\r\n\t\t * 构造礼品查询结果的数据模型\r\n\t\t * @param  {object} cfg 配置信息\r\n\t\t *          @param {Function} callServer 获取数据接口\r\n\t\t *          @param {Array} queryKeys 搜索条件字段序列\r\n\t\t *          @param {Boolean} hasPager 是否支持分页true：支持；false：不支持。default true\r\n\t\t *          @param {String} gridType 结果数据表类型\r\n\t\t *          \r\n\t\t *          \r\n\t\t * @return {[type]}     [description]\r\n\t\t */\r\n\t\tconstructor : function (cfg) {\r\n\t\t\tthis.callServer = $XP(cfg, 'callServer', null);\r\n\t\t\tif (!this.callServer) {\r\n\t\t\t\tthrow(\"callServer is empty!\");\r\n\t\t\t}\r\n\t\t\tthis.queryKeys = $XP(cfg, 'queryKeys', []);\r\n\t\t\tthis.pagerKeys = 'pageCount,totalSize,pageNo,pageSize'.split(',');\r\n\t\t\tthis.queryParamsKeys = null;\r\n\t\t\tthis.hasPager = $XP(cfg, 'hasPager', true);\r\n\t\t\tthis.recordModel = $XP(cfg, 'recordModel', BaseGiftModel);\r\n\t\t\tthis.gridType = $XP(cfg, 'gridType', '');\r\n\t\t}\r\n\t});\r\n\r\n\tGiftMgrResultModel.proto({\r\n\t\tinit : function (params) {\r\n\t\t\tthis.set(IX.inherit({\r\n\t\t\t\tds_record : new IX.IListManager(),\r\n\t\t\t\tds_items : new IX.IListManager(),\r\n\t\t\t\tds_page : new IX.IListManager()\r\n\t\t\t}, this.hasPager ? {\r\n\t\t\t\tpageCount : 0,\r\n\t\t\t\ttotalSize : 0,\r\n\t\t\t\tpageNo : $XP(params, 'pageNo', 1),\r\n\t\t\t\tpageSize : $XP(params, 'pageSize', 15)\r\n\t\t\t} : {}));\r\n\t\t\tthis.queryParamsKeys = !this.hasPager ? this.queryKeys : this.queryKeys.concat(this.pagerKeys);\r\n\t\t},\r\n\t\tupdatePagerParams : function (params) {\r\n\t\t\tvar self = this;\r\n\t\t\tvar queryParamsKeys = self.queryParamsKeys.join(',');\r\n\t\t\t_.each(params, function (v, k, l) {\r\n\t\t\t\tif (queryParamsKeys.indexOf(k) > -1) {\r\n\t\t\t\t\tself.set(k, v);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t},\r\n\t\tgetPagerParams : function () {\r\n\t\t\tvar self = this;\r\n\t\t\tvar ret = {};\r\n\t\t\t_.each(self.queryParamsKeys, function (k) {\r\n\t\t\t\tret[k] = self.get(k);\r\n\t\t\t});\r\n\t\t\treturn ret;\r\n\t\t},\r\n\t\tupdateDataStore : function (data, pageNo) {\r\n\t\t\tvar self = this,\r\n\t\t\t\trecordHT = self.get('ds_record'),\r\n\t\t\t\tpageHT = self.get('ds_page');\r\n\t\t\tpageNo = self.hasPager ? pageNo : 1;\r\n\t\t\tvar recordIDs = _.map(data, function (r, i, l) {\r\n\t\t\t\tvar id = pageNo + '_' + IX.id(),\r\n\t\t\t\t\tmRecord = new self.recordModel(IX.inherit(r, {\r\n\t\t\t\t\t\t'__id__' : id,\r\n\t\t\t\t\t\t'__gridtype__' : self.gridType\r\n\t\t\t\t\t}));\r\n\t\t\t\trecordHT.register(id, mRecord);\r\n\t\t\t\treturn id;\r\n\t\t\t});\r\n\t\t\tpageHT.register(pageNo, recordIDs);\r\n\t\t},\r\n\t\tload : function (params, cbFn) {\r\n\t\t\tvar self = this;\r\n\t\t\tself.updatePagerParams(params);\r\n\t\t\tself.callServer(self.getPagerParams(), function (res) {\r\n\t\t\t\tif (res.resultcode == '000') {\r\n\t\t\t\t\tself.updateDataStore($XP(res, 'data.records', []), $XP(res, 'data.pageNo'));\r\n\t\t\t\t\tself.updatePagerParams($XP(res, 'data', {}));\r\n\t\t\t\t\t// self.updateItemDataStore($XP(res, 'data', {}));\r\n\t\t\t\t} else {\r\n\t\t\t\t\ttoptip({\r\n\t\t\t\t\t\tmsg : $XP(res, 'resultmsg', ''),\r\n\t\t\t\t\t\ttype : 'danger'\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t\tcbFn(self);\r\n\t\t\t});\r\n\t\t},\r\n\t\tgetRecordsByPageNo : function (pageNo) {\r\n\t\t\tvar self = this,\r\n\t\t\t\trecordHT = self.get('ds_record'),\r\n\t\t\t\tpageHT = self.get('ds_page');\r\n\t\t\tpageNo = !self.hasPager ? 1 : pageNo;\r\n\t\t\tvar ret = _.map(recordHT.getByKeys(pageHT.get(pageNo)), function (mRecord, i, l) {\r\n\t\t\t\treturn mRecord.getAll();\r\n\t\t\t});\r\n\t\t\tIX.Debug.info(\"DEBUG: Query Result Model PageData\");\r\n\t\t\tIX.Debug.info(ret);\r\n\t\t\treturn ret;\r\n\t\t},\r\n\t\tgetRecordModelByID : function (id) {\r\n\t\t\tvar self = this,\r\n\t\t\t\trecordHT = self.get('ds_record');\r\n\t\t\treturn recordHT.get(id);\r\n\t\t}\r\n\r\n\t});\r\n\r\n\tHMCM.GiftMgrResultModel = GiftMgrResultModel;\r\n\r\n\t/**\r\n\t * 礼品模型\r\n\t * \r\n\t * \r\n\t */\r\n\tvar BaseGiftModel = Stapes.subclass({\r\n\t\tconstructor : function (gift) {\r\n\t\t\tthis.set(gift);\r\n\t\t\tthis.bindEvent();\r\n\t\t}\r\n\t});\r\n\tBaseGiftModel.proto({\r\n\t\tbindEvent : function () {\r\n\t\t\tvar self = this;\r\n\t\t\tself.on({\r\n\t\t\t\tdelete : function (params) {\r\n\t\t\t\t\tvar giftItemID = $XP(params, 'itemID');\r\n\t\t\t\t\tvar successFn = $XF(params, 'successFn'),\r\n\t\t\t\t\t\tfaildFn = $XF(params, 'faildFn');\r\n\t\t\t\t\tHualala.Global.deleteMCMGift({\r\n\t\t\t\t\t\tgiftItemID : giftItemID\r\n\t\t\t\t\t}, function (res) {\r\n\t\t\t\t\t\tif ($XP(res, 'resultcode') == '000') {\r\n\t\t\t\t\t\t\tsuccessFn(res);\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tfaildFn(res);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t},\r\n\t\t\t\tcreateGift : function (params) {\r\n\t\t\t\t\tvar post = $XP(params, 'params', {}),\r\n\t\t\t\t\t\tsuccessFn = $XF(params, 'successFn'),\r\n\t\t\t\t\t\tfailFn = $XF(params, 'failFn');\r\n\t\t\t\t\t// save tmp data in model\r\n\t\t\t\t\tself.set(post);\r\n\t\t\t\t\t// Post Model Data Set to Server\r\n\t\t\t\t\tIX.Debug.info(\"DEBUG: Gift Wizard Form Post Params:\");\r\n\t\t\t\t\tIX.Debug.info(self.getAll());\r\n\t\t\t\t\tHualala.Global.createMCMGift(self.getAll(), function (res) {\r\n\t\t\t\t\t\tif ($XP(res, 'resultcode') == '000') {\r\n\t\t\t\t\t\t\tsuccessFn(res);\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tfailFn(res);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t},\r\n\t\t\t\teditGift : function (params) {\r\n\t\t\t\t\tvar post = $XP(params, 'params', {}),\r\n\t\t\t\t\t\tsuccessFn = $XF(params, 'successFn'),\r\n\t\t\t\t\t\tfailFn = $XF(params, 'failFn');\r\n\t\t\t\t\t// save tmp data in model\r\n\t\t\t\t\tself.set(post);\r\n\t\t\t\t\t// Post Model Data Set to Server\r\n\t\t\t\t\tIX.Debug.info(\"DEBUG: Gift Wizard Form Post Params:\");\r\n\t\t\t\t\tIX.Debug.info(self.getAll());\r\n\t\t\t\t\tHualala.Global.editMCMGift(self.getAll(), function (res) {\r\n\t\t\t\t\t\tif ($XP(res, 'resultcode') == '000') {\r\n\t\t\t\t\t\t\tsuccessFn(res);\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tfailFn(res);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t},\r\n\t\t\t\tsaveCache : function (params) {\r\n\t\t\t\t\tvar post = $XP(params, 'params', {}),\r\n\t\t\t\t\t\tsuccessFn = $XF(params, 'successFn'),\r\n\t\t\t\t\t\tfailFn = $XF(params, 'failFn');\r\n\t\t\t\t\tself.set(post);\r\n\t\t\t\t\tsuccessFn(self);\r\n\t\t\t\t},\r\n\t\t\t\tbindShops : function (params) {\r\n\t\t\t\t\tvar cities = $XP(params, 'cities', []),\r\n\t\t\t\t\t\tshops = $XP(params, 'shops', []);\r\n\t\t\t\t\tvar shopIDs = _.pluck(shops, 'shopID'),\r\n\t\t\t\t\t\tshopNames = _.pluck(shops, 'shopName'),\r\n\t\t\t\t\t\tusingCityIDs = _.pluck(cities, 'cityID');\r\n\t\t\t\t\tthis.set({\r\n\t\t\t\t\t\tshopIDs : shopIDs.join(';'),\r\n\t\t\t\t\t\tshopNames : shopNames.join(';'),\r\n\t\t\t\t\t\tusingCityIDs : usingCityIDs.join(';')\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t}, this);\r\n\t\t}\r\n\t});\r\n\tHMCM.BaseGiftModel = BaseGiftModel;\r\n\r\n\t/**\r\n\t * 活动模型\r\n\t * \r\n\t * \r\n\t */\r\n\tvar BaseEventModel = Stapes.subclass({\r\n\t\tconstructor : function (evt) {\r\n\t\t\tself.CardLevelIDSet = null;\r\n\t\t\tthis.set(evt);\r\n\t\t\tthis.bindEvent();\r\n\t\t}\r\n\t});\r\n\tBaseEventModel.proto({\r\n\t\tgetEventCardSet : function () {\r\n\t\t\tvar self = this;\r\n\t\t\tvar eventTypes = Hualala.TypeDef.MCMDataSet.EventTypes;\r\n\t\t\tvar eventCardSet = _.find(eventTypes, function (el) {\r\n\t\t\t\treturn $XP(el, 'value') == self.get('eventWay');\r\n\t\t\t});\r\n\t\t\treturn eventCardSet;\r\n\t\t},\r\n\t\tgetEventCardClz : function () {\r\n\t\t\tvar self = this;\r\n\t\t\tvar eventTypes = Hualala.TypeDef.MCMDataSet.EventTypes;\r\n\t\t\tvar eventTypeSet = _.find(eventTypes, function (el) {\r\n\t\t\t\treturn $XP(el, 'value') == self.get('eventWay');\r\n\t\t\t});\r\n\t\t\treturn $XP(eventTypeSet, 'type', '');\r\n\t\t},\r\n\t\tbindEvent : function () {\r\n\t\t\tvar self = this;\r\n\t\t\tself.on({\r\n\t\t\t\tdelete : function (params) {\r\n\t\t\t\t\tvar eventID = $XP(params, 'itemID');\r\n\t\t\t\t\tvar successFn = $XF(params, 'successFn'),\r\n\t\t\t\t\t\tfaildFn = $XF(params, 'faildFn');\r\n\t\t\t\t\tHualala.Global.deleteMCMEvent({\r\n\t\t\t\t\t\teventID : eventID\r\n\t\t\t\t\t}, function (res) {\r\n\t\t\t\t\t\tif ($XP(res, 'resultcode') == '000') {\r\n\t\t\t\t\t\t\tsuccessFn(res);\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tfaildFn(res);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t},\r\n\t\t\t\tswitchEvent : function (params) {\r\n\t\t\t\t\tvar post = $XP(params, 'post', {}),\r\n\t\t\t\t\t\tsuccessFn = $XF(params, 'successFn'),\r\n\t\t\t\t\t\tfaildFn = $XF(params, 'faildFn');\r\n\t\t\t\t\tHualala.Global.switchMCMEvent(post, function (res) {\r\n\t\t\t\t\t\tif ($XP(res, 'resultcode') == '000') {\r\n\t\t\t\t\t\t\tsuccessFn(res);\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tfaildFn(res);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t},\r\n\t\t\t\tupdate : function (params) {\r\n\t\t\t\t\tvar successFn = $XF(params, 'successFn'),\r\n\t\t\t\t\t\tfaildFn = $XF(params, 'faildFn');\r\n\t\t\t\t\tHualala.Global.getMCMEventByID({\r\n\t\t\t\t\t\teventID : self.get('eventID')\r\n\t\t\t\t\t}, function (res) {\r\n\t\t\t\t\t\tif ($XP(res, 'resultcode') == '000') {\r\n\t\t\t\t\t\t\tvar d = $XP(res, 'data.records')[0];\r\n\t\t\t\t\t\t\tself.set(d);\r\n\t\t\t\t\t\t\tsuccessFn(res);\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tfaildFn(res);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t},\r\n\t\t\t\tsaveCache : function (params) {\r\n\t\t\t\t\tvar post = $XP(params, 'params', {}),\r\n\t\t\t\t\t\tsuccessFn = $XF(params, 'successFn'),\r\n\t\t\t\t\t\tfailFn = $XF(params, 'failFn');\r\n\t\t\t\t\tself.set(post);\r\n\t\t\t\t\tsuccessFn(self);\r\n\t\t\t\t},\r\n\t\t\t\tloadCardLevelIDs : function (params) {\r\n\t\t\t\t\tvar successFn = $XF(params, 'successFn'),\r\n\t\t\t\t\t\tfaildFn = $XF(params, 'faildFn');\r\n\t\t\t\t\tHualala.Global.getVipLevels({}, function (res) {\r\n\t\t\t\t\t\tif ($XP(res, 'resultcode') == '000') {\r\n\t\t\t\t\t\t\tself.CardLevelIDSet = $XP(res, 'data.records', []);\r\n\t\t\t\t\t\t\tsuccessFn(res);\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tself.CardLevelIDSet = null;\r\n\t\t\t\t\t\t\tfaildFn(res);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t},\r\n\t\t\t\tcreateEvent : function (params) {\r\n\t\t\t\t\tvar successFn = $XF(params, 'successFn'),\r\n\t\t\t\t\t\tfaildFn = $XF(params, 'faildFn');\r\n\t\t\t\t\tHualala.Global.createEvent($XP(params, 'params'), function (res) {\r\n\t\t\t\t\t\tif ($XP(res, 'resultcode') == '000') {\r\n\t\t\t\t\t\t\tvar d = $XP(res, 'data');\r\n\t\t\t\t\t\t\tself.set(d);\r\n\t\t\t\t\t\t\tsuccessFn(res);\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tfaildFn(res);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t},\r\n\t\t\t\teditEvent : function (params) {\r\n\t\t\t\t\tvar successFn = $XF(params, 'successFn'),\r\n\t\t\t\t\t\tfaildFn = $XF(params, 'faildFn');\r\n\t\t\t\t\tvar setData = self.getAll();\r\n\t\t\t\t\tHualala.Global.editEvent(IX.inherit(setData, $XP(params, 'params')), function (res) {\r\n\t\t\t\t\t\tif ($XP(res, 'resultcode') == '000') {\r\n\t\t\t\t\t\t\tvar d = $XP(res, 'data');\r\n\t\t\t\t\t\t\tself.set(d);\r\n\t\t\t\t\t\t\tsuccessFn(res);\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tfaildFn(res);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t}, this);\r\n\t\t}\r\n\t});\r\n\tHMCM.BaseEventModel = BaseEventModel;\r\n})(jQuery, window);\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n;(function ($, window) {\r\n\tIX.ns(\"Hualala.MCM\");\r\n\tvar HMCM = Hualala.MCM;\r\n\tvar popoverMsg = Hualala.UI.PopoverMsgTip,\r\n\t\ttoptip = Hualala.UI.TopTip;\r\n\r\n\tvar MCMGiftListHeaderCfg = [\r\n\t\t{key : \"giftType\", clz : \"\", label : \"礼品类型\"},\r\n\t\t{key : \"giftName\", clz : \"text\", label : \"礼品名称\"},\r\n\t\t{key : \"createTime\", clz : \"date\", label : \"创建时间\"},\r\n\t\t{key : \"createBy\", clz : \"text\", label : \"创建人\"},\r\n\t\t{key : \"rowControl\", clz : \"\", label : \"操作\"}\r\n\t];\r\n\r\n\tvar MCMEventListHeaderCfg = [\r\n\t\t// 活动类型|活动名称|人气|活动日期|创建人|活动开关|操作\r\n\t\t{key : \"eventWay\", clz : \"eventWay\", label : \"活动类型\"},\r\n\t\t{key : \"eventName\", clz : \"text\", label : \"活动名称\"},\r\n\t\t{key : \"userCount\", clz : \"num\", label : \"人气\"},\r\n\t\t{key : \"eventStartDate\", clz : \"date\", label : \"活动日期\"},\r\n\t\t{key : \"operator\", clz : \"text\", label : \"创建人\"},\r\n\t\t{key : \"isActive\", clz : \"\", label : \"活动开关\"},\r\n\t\t{key : \"rowControl\", clz : \"ctrlrow\", label : \"操作\"}\r\n\t];\r\n\r\n\tvar mapColItemRenderData = function (row, rowIdx, colKey) {\r\n\t\tvar self = this;\r\n\t\tvar ctx = Hualala.PageRoute.getPageContextByPath(), pageName = $XP(ctx, 'name'),\r\n\t\t\tqueryKeys = self.model.queryKeys;\r\n\t\tvar r = {value : \"\", text : \"\"}, v = $XP(row, colKey, '');\r\n\t\tvar formatDateTimeValue = Hualala.Common.formatDateTimeValue;\r\n\t\tswitch(colKey) {\r\n\t\t\t// 礼品列表各列参数\r\n\t\t\tcase \"giftType\":\r\n\t\t\t\tvar giftCardTpl = self.get('giftCardTpl'),\r\n\t\t\t\t\tgiftValue = $XP(row, 'giftValue', 0),\r\n\t\t\t\t\tgiftTypes = Hualala.TypeDef.MCMDataSet.GiftTypes,\r\n\t\t\t\t\tgiftType = _.find(giftTypes, function (el) {return $XP(el, 'value') == v;});\r\n\t\t\t\t// if (pageName == 'mcmGiftsMgr') {\r\n\t\t\t\t\tvar card = giftCardTpl({\r\n\t\t\t\t\t\tclz : $XP(giftType, 'type', ''),\r\n\t\t\t\t\t\tlabel : giftValue,\r\n\t\t\t\t\t\tunit : $XP(giftType, 'unit', '')\r\n\t\t\t\t\t});\r\n\t\t\t\t\tr.value = v;\r\n\t\t\t\t\tr.text = card;\r\n\t\t\t\t\tr.colspan = 1;\r\n\t\t\t\t\tr.rowspan = 2;\r\n\t\t\t\t// }\r\n\t\t\t\t\r\n\r\n\t\t\t\tbreak;\r\n\t\t\t// case \"giftName\":\r\n\t\t\t// \tr.value = v;\r\n\t\t\t// \tr.text = v;\r\n\t\t\t// \tbreak;\r\n\t\t\tcase \"createTime\":\r\n\t\t\t\tr.value = v;\r\n\t\t\t\tr.text = IX.Date.getDateByFormat(formatDateTimeValue(v), 'yyyy/MM/dd HH:mm');\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"createBy\":\r\n\t\t\t\tvar userInfo = !IX.isEmpty(v) && IX.isString(v) ? JSON.parse(v) : {};\r\n\t\t\t\tr.value = $XP(userInfo, 'userID', '');\r\n\t\t\t\tr.text = $XP(userInfo, 'userName', '') + '<br/>' + $XP(userInfo, 'userMobile', '');\r\n\t\t\t\tbreak;\r\n\t\t\t// 活动列表各列参数\r\n\t\t\tcase \"eventWay\":\r\n\t\t\t\tvar eventCardTpl = self.get('eventCardTpl'),\r\n\t\t\t\t\teventTypes = Hualala.TypeDef.MCMDataSet.EventTypes,\r\n\t\t\t\t\teventType = _.find(eventTypes, function (el) {return $XP(el, 'value') == v;}),\r\n\t\t\t\t\tlabel = $XP(eventType, 'label', '');\r\n\t\t\t\tif (pageName == 'mcmEventMgr') {\r\n\t\t\t\t\tvar card = eventCardTpl({\r\n\t\t\t\t\t\tclz : $XP(row, 'isActive') != 0 ? $XP(eventType, 'type', '') : 'disable',\r\n\t\t\t\t\t\tlabel : label\r\n\t\t\t\t\t});\r\n\t\t\t\t\tr.value = v;\r\n\t\t\t\t\tr.text = card;\r\n\t\t\t\t\tr.colspan = 1;\r\n\t\t\t\t\tr.rowspan = 1;\r\n\t\t\t\t}\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"eventStartDate\":\r\n\t\t\t\tr.value = v;\r\n\t\t\t\tvar start = v, end = $XP(row, 'eventEndDate', '');\r\n\t\t\t\tr.text = IX.Date.getDateByFormat(formatDateTimeValue(start), 'yyyy/MM/dd')\r\n\t\t\t\t\t+ '至'\r\n\t\t\t\t\t+ IX.Date.getDateByFormat(formatDateTimeValue(end), 'yyyy/MM/dd');\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"operator\":\r\n\t\t\t\tvar userInfo = !IX.isEmpty(v) && IX.isString(v) ? JSON.parse(v) : {};\r\n\t\t\t\tr.value = $XP(userInfo, 'userID', '');\r\n\t\t\t\tr.text = $XP(userInfo, 'userName', '') + '<br/>' + $XP(userInfo, 'userMobile', '');\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"isActive\":\r\n\t\t\t\tvar eventID = $XP(row, 'isActive', 0);\r\n\t\t\t\tr.value = v;\r\n\t\t\t\tr.text = '<input type=\"checkbox\" name=\"switch_event\" data-event-id=\"' + eventID + '\" ' \r\n\t\t\t\t\t+ (v != 0 ? 'checked ' : '') + ' data-key=\"' + $XP(row, '__id__', '') + '\" ' + ' />';\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"rowControl\":\r\n\t\t\t\tif (pageName == 'mcmGiftsMgr') {\r\n\t\t\t\t\tr = {\r\n\t\t\t\t\t\ttype : 'button',\r\n\t\t\t\t\t\trowspan : 2,\r\n\t\t\t\t\t\tcolspan : 1,\r\n\t\t\t\t\t\tbtns : [\r\n\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\tlabel : '修改',\r\n\t\t\t\t\t\t\t\tlink : 'javascript:void(0);',\r\n\t\t\t\t\t\t\t\tclz : 'btn-block btn-link edit-gift',\r\n\t\t\t\t\t\t\t\tid : $XP(row, 'giftItemID', ''),\r\n\t\t\t\t\t\t\t\tkey : $XP(row, '__id__', ''),\r\n\t\t\t\t\t\t\t\ttype : 'edit'\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\tlabel : '删除',\r\n\t\t\t\t\t\t\t\tlink : 'javascript:void(0);',\r\n\t\t\t\t\t\t\t\tclz : 'btn-block btn-link delete-gift',\r\n\t\t\t\t\t\t\t\tid : $XP(row, 'giftItemID', ''),\r\n\t\t\t\t\t\t\t\tkey : $XP(row, '__id__'),\r\n\t\t\t\t\t\t\t\ttype : 'delete'\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\tlabel : '使用详情',\r\n\t\t\t\t\t\t\t\tlink : 'javascript:void(0);',\r\n\t\t\t\t\t\t\t\tclz : 'btn-block btn-link detail-gift',\r\n\t\t\t\t\t\t\t\tid : $XP(row, 'giftItemID', ''),\r\n\t\t\t\t\t\t\t\tkey : $XP(row, '__id__'),\r\n\t\t\t\t\t\t\t\ttype : 'detail'\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t]\r\n\t\t\t\t\t};\r\n\t\t\t\t}\r\n\t\t\t\tif (pageName == 'mcmEventMgr') {\r\n\t\t\t\t\tvar isActive = $XP(row, 'isActive', 0);\r\n\t\t\t\t\tr = {\r\n\t\t\t\t\t\ttype : 'button',\r\n\t\t\t\t\t\trowspan : 1,\r\n\t\t\t\t\t\tcolspan : 1,\r\n\t\t\t\t\t\tbtns : [\r\n\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\tlabel : '修改',\r\n\t\t\t\t\t\t\t\tlink : 'javascript:void(0);',\r\n\t\t\t\t\t\t\t\tclz : 'btn-block btn-link edit-event ' + (isActive != 0 ? 'hidden' : ''),\r\n\t\t\t\t\t\t\t\tid : $XP(row, 'eventID', ''),\r\n\t\t\t\t\t\t\t\tkey : $XP(row, '__id__', ''),\r\n\t\t\t\t\t\t\t\ttype : 'edit'\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\tlabel : '删除',\r\n\t\t\t\t\t\t\t\tlink : 'javascript:void(0);',\r\n\t\t\t\t\t\t\t\tclz : 'btn-block btn-link delete-event ' + (isActive != 0 ? 'hidden' : ''),\r\n\t\t\t\t\t\t\t\tid : $XP(row, 'eventID', ''),\r\n\t\t\t\t\t\t\t\tkey : $XP(row, '__id__'),\r\n\t\t\t\t\t\t\t\ttype : 'delete'\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\tlabel : '查看',\r\n\t\t\t\t\t\t\t\tlink : 'javascript:void(0);',\r\n\t\t\t\t\t\t\t\tclz : 'btn-block btn-link detail-event',\r\n\t\t\t\t\t\t\t\tid : $XP(row, 'eventID', ''),\r\n\t\t\t\t\t\t\t\tkey : $XP(row, '__id__'),\r\n\t\t\t\t\t\t\t\ttype : 'detail'\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\tlabel : '活动跟踪',\r\n\t\t\t\t\t\t\t\tlink : 'javascript:void(0);',\r\n\t\t\t\t\t\t\t\tclz : 'btn-block btn-link track-event ' + (isActive != 0 ? '' : 'hidden'),\r\n\t\t\t\t\t\t\t\tid : $XP(row, 'eventID', ''),\r\n\t\t\t\t\t\t\t\tkey : $XP(row, '__id__'),\r\n\t\t\t\t\t\t\t\ttype : 'track'\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t]\r\n\t\t\t\t\t};\r\n\t\t\t\t}\r\n\t\t\t\tbreak; \r\n\t\t\tdefault :\r\n\t\t\t\tr.value = r.text = $XP(row, colKey, '');\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\t\treturn r;\r\n\t};\r\n\r\n\t/**\r\n\t * 格式化礼品列表渲染结果数据\r\n\t * @param  {[Array|Object]} records 搜索结果数据\r\n\t * @return {[Array|Object]}         格式化后的渲染数据\r\n\t */\r\n\tHMCM.mapGiftsQueryResultRenderData = function (records) {\r\n\t\tvar self = this;\r\n\t\tvar ctx = Hualala.PageRoute.getPageContextByPath(), pageName = $XP(ctx, 'name');\r\n\t\tvar clz = \"col-md-12\",\r\n\t\t\ttblClz = \"  table-hover mcm-grid\",\r\n\t\t\ttblHeaders = MCMGiftListHeaderCfg;\r\n\t\tvar mapColsRenderData = function (row, idx) {\r\n\t\t\tvar colKeys = _.map(tblHeaders, function (el) {\r\n\t\t\t\treturn {key : $XP(el, 'key', ''), clz : $XP(el, 'clz', '')};\r\n\t\t\t});\r\n\t\t\tvar col = {clz : '', type : 'text'};\r\n\t\t\tvar cols = _.map(colKeys, function (k, i) {\r\n\t\t\t\tvar r = mapColItemRenderData.apply(self, [row, idx, $XP(k, 'key', '')]);\r\n\t\t\t\treturn IX.inherit(col, r, {clz : $XP(k, 'clz', '')});\r\n\t\t\t});\r\n\t\t\treturn cols;\r\n\t\t};\r\n\t\tvar rows = _.map(records, function (row, idx) {\r\n\t\t\tvar rowSet = {\r\n\t\t\t\tclz : '',\r\n\t\t\t\tcols : mapColsRenderData(row, idx)\r\n\t\t\t};\r\n\t\t\tif (pageName == 'mcmGiftsMgr') {\r\n\t\t\t\tvar giftRule = {\r\n\t\t\t\t\tsubRows : [{\r\n\t\t\t\t\t\tclz : 'gift-rule',\r\n\t\t\t\t\t\tcols : [{\r\n\t\t\t\t\t\t\tclz : '',\r\n\t\t\t\t\t\t\tcolspan : 3,\r\n\t\t\t\t\t\t\trowspan : 1,\r\n\t\t\t\t\t\t\thtml : '礼品规则：'\r\n\t\t\t\t\t\t}]\r\n\t\t\t\t\t}]\r\n\t\t\t\t};\r\n\t\t\t\trowSet = IX.inherit(rowSet, giftRule);\r\n\t\t\t}\r\n\t\t\treturn rowSet;\r\n\t\t});\r\n\t\tvar tfoot = [{\r\n\t\t\tclz : 'hidden',\r\n\t\t\tcols : []\r\n\t\t}];\r\n\t\treturn {\r\n\t\t\tclz : clz,\r\n\t\t\ttblClz : tblClz,\r\n\t\t\tisEmpty : !records || records.length == 0 ? true : false,\r\n\t\t\tcolCount : tblHeaders.length,\r\n\t\t\tthead : tblHeaders,\r\n\t\t\trows : rows,\r\n\t\t\ttfoot : tfoot\r\n\t\t};\r\n\t};\r\n\r\n\t/**\r\n\t * 格式化活动列表渲染结果数据\r\n\t * @param  {[type]} records [description]\r\n\t * @return {[type]}         [description]\r\n\t */\r\n\tHMCM.mapEventsQueryResultRenderData = function (records) {\r\n\t\tvar self = this;\r\n\t\tvar ctx = Hualala.PageRoute.getPageContextByPath(), pageName = $XP(ctx, 'name');\r\n\t\tvar clz = \"col-md-12\",\r\n\t\t\ttblClz = \"  table-hover mcm-grid\",\r\n\t\t\ttblHeaders = MCMEventListHeaderCfg;\r\n\t\tvar mapColsRenderData = function (row, idx) {\r\n\t\t\tvar colKeys = _.map(tblHeaders, function (el) {\r\n\t\t\t\treturn {key : $XP(el, 'key', ''), clz : $XP(el, 'clz', '')};\r\n\t\t\t});\r\n\t\t\tvar col = {clz : '', type : 'text'};\r\n\t\t\tvar cols = _.map(colKeys, function (k, i) {\r\n\t\t\t\tvar r = mapColItemRenderData.apply(self, [row, idx, $XP(k, 'key', '')]);\r\n\t\t\t\treturn IX.inherit(col, r, {clz : $XP(k, 'clz', '')});\r\n\t\t\t});\r\n\t\t\treturn cols;\r\n\t\t};\r\n\t\tvar rows = _.map(records, function (row, idx) {\r\n\t\t\tvar rowSet = {\r\n\t\t\t\tclz : '',\r\n\t\t\t\tcols : mapColsRenderData(row, idx)\r\n\t\t\t};\r\n\t\t\treturn rowSet;\r\n\t\t});\r\n\t\tvar tfoot = [{\r\n\t\t\tclz : 'hidden',\r\n\t\t\tcols : []\r\n\t\t}];\r\n\t\treturn {\r\n\t\t\tclz : clz,\r\n\t\t\ttblClz : tblClz,\r\n\t\t\tisEmpty : !records || records.length == 0 ? true : false,\r\n\t\t\tcolCount : tblHeaders.length,\r\n\t\t\tthead : tblHeaders,\r\n\t\t\trows : rows,\r\n\t\t\ttfoot : tfoot\r\n\t\t};\r\n\t};\r\n\r\n\t/**\r\n\t * 为礼品列表搜索结果数据表绑定事件\r\n\t * @return {[type]} [description]\r\n\t */\r\n\tHMCM.bundleGiftsQueryResultEvent = function () {\r\n\t\tvar self = this;\r\n\t\tself.$result.on('click', '.btn-link', function (e) {\r\n\t\t\tvar $btn = $(this),\r\n\t\t\t\tact = $btn.attr('data-type'),\r\n\t\t\t\tgiftItemID = $btn.attr('data-id'),\r\n\t\t\t\tid = $btn.attr('data-key');\r\n\t\t\tvar giftModel = self.model.getRecordModelByID(id);\r\n\t\t\tswitch (act) {\r\n\t\t\t\tcase 'edit':\r\n\t\t\t\t// TODO edit gift set\r\n\t\t\t\t\tvar wizardPanel = new Hualala.MCM.MCMWizardModal({\r\n\t\t\t\t\t\tparentView : self,\r\n\t\t\t\t\t\tmode : 'edit',\r\n\t\t\t\t\t\tsuccessFn : function () {\r\n\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\tfailFn : function () {\r\n\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\tmodel : giftModel,\r\n\t\t\t\t\t\tmodalClz : 'mcm-gift-modal',\r\n\t\t\t\t\t\twizardClz : 'mcm-gift-wizard',\r\n\t\t\t\t\t\tmodalTitle : '编辑礼品',\r\n\t\t\t\t\t\tonWizardInit : function ($cnt, cntID, wizardMode) {\r\n\t\t\t\t\t\t\tHMCM.initGiftBaseInfoStep.call(this, $cnt, cntID, wizardMode);\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\tonStepCommit : function (curID) {\r\n\t\t\t\t\t\t\tHualala.MCM.onGiftWizardStepCommit.call(this, curID);\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\tonStepChange : function ($curNav, $navBar, cIdx, nIdx) {\r\n\t\t\t\t\t\t\tHualala.MCM.onGiftWizardStepChange.call(this, $curNav, $navBar, cIdx, nIdx);\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\tbundleWizardEvent : function () {\r\n\t\t\t\t\t\t\tHualala.MCM.bundleGiftWizardEvent.call(this);\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\twizardStepsCfg : Hualala.MCM.GiftWizardCfg,\r\n\t\t\t\t\t\twizardCtrls : Hualala.MCM.WizardCtrls\r\n\r\n\t\t\t\t\t});\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'delete':\r\n\t\t\t\t// TODO delete gift set\r\n\t\t\t\t\tself.emit('deleteItem', {\r\n\t\t\t\t\t\tid : id,\r\n\t\t\t\t\t\tkey : giftItemID,\r\n\t\t\t\t\t\tsuccessFn : function (res) {\r\n\t\t\t\t\t\t\ttoptip({\r\n\t\t\t\t\t\t\t\tmsg : '删除成功',\r\n\t\t\t\t\t\t\t\ttype : 'success'\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\tvar $tr = $btn.parents('tr'),\r\n\t\t\t\t\t\t\t\t$ruleRow = $tr.next('.gift-rule');\r\n\t\t\t\t\t\t\t$tr.remove();\r\n\t\t\t\t\t\t\t$ruleRow.remove();\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\tfaildFn : function (res) {\r\n\t\t\t\t\t\t\ttoptip({\r\n\t\t\t\t\t\t\t\tmsg : $XP(res, 'resultmsg', ''),\r\n\t\t\t\t\t\t\t\ttype : 'danger'\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'detail':\r\n\t\t\t\t// TODO preview gift detail\r\n\t\t\t\t\tvar path = Hualala.PageRoute.createPath('mcmGiftDetail', [giftItemID]);\r\n\t\t\t\t\tHualala.PageRoute.jumpPage(path);\r\n\t\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t});\r\n\t\tself.$result.on('mouseover', 'tr.gift-rule', function (e) {\r\n\t\t\tvar $row = $(this);\r\n\t\t\t$row.prev('tr').addClass('hover');\r\n\t\t}).on('mouseout', 'tr.gift-rule', function (e) {\r\n\t\t\tvar $row = $(this);\r\n\t\t\t$row.prev('tr').removeClass('hover');\r\n\t\t});\r\n\t};\r\n\r\n\t/**\r\n\t * 为活动列表搜索结果数据表绑定事件\r\n\t * @return {[type]} [description]\r\n\t */\r\n\tHMCM.bundleEventsQueryResultEvent = function () {\r\n\t\tvar self = this;\r\n\t\tself.$result.on('click', '.btn-link', function (e) {\r\n\t\t\tvar $btn = $(this),\r\n\t\t\t\tact = $btn.attr('data-type'),\r\n\t\t\t\teventID = $btn.attr('data-id'),\r\n\t\t\t\tid = $btn.attr('data-key');\r\n\t\t\tvar eventModel = self.model.getRecordModelByID(id);\r\n\t\t\tswitch(act) {\r\n\t\t\t\tcase 'edit' :\r\n\t\t\t\t// TODO edit event config set\r\n\t\t\t\t\tvar wizardPanel = new Hualala.MCM.MCMWizardModal({\r\n\t\t\t\t\t\tparentView : self,\r\n\t\t\t\t\t\tmode : 'edit',\r\n\t\t\t\t\t\tsuccessFn : function () {\r\n\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\tfailFn : function () {\r\n\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\tmodel : eventModel,\r\n\t\t\t\t\t\tmodalClz : 'mcm-event-modal',\r\n\t\t\t\t\t\twizardClz : 'mcm-event-wizard',\r\n\t\t\t\t\t\tmodalTitle : '创建活动',\r\n\t\t\t\t\t\tonWizardInit : function ($cnt, cntID, wizardMode) {\r\n\t\t\t\t\t\t\tHualala.MCM.initEventBaseInfoStep.call(this, $cnt, cntID, wizardMode);\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\tonStepCommit : function (curID) {\r\n\t\t\t\t\t\t\tHualala.MCM.onEventWizardStepCommit.call(this, curID);\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\tonStepChange : function ($curNav, $navBar, cIdx, nIdx) {\r\n\t\t\t\t\t\t\tHualala.MCM.onEventWizardStepChange.call(this, $curNav, $navBar, cIdx, nIdx);\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\tbundleWizardEvent : function () {\r\n\t\t\t\t\t\t\tHualala.MCM.bundleEventWizardEvent.call(this);\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\twizardStepsCfg : Hualala.MCM.EventWizardCfg,\r\n\t\t\t\t\t\twizardCtrls : Hualala.MCM.WizardCtrls\r\n\r\n\t\t\t\t\t});\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'delete' :\r\n\t\t\t\t// delete event\r\n\t\t\t\t\tself.emit('deleteItem', {\r\n\t\t\t\t\t\tid : id,\r\n\t\t\t\t\t\tkey : eventID,\r\n\t\t\t\t\t\tsuccessFn : function (res) {\r\n\t\t\t\t\t\t\ttoptip({\r\n\t\t\t\t\t\t\t\tmsg : '删除成功',\r\n\t\t\t\t\t\t\t\ttype : 'success'\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\tvar $tr = $btn.parents('tr');\r\n\t\t\t\t\t\t\t$tr.remove();\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\tfaildFn : function (res) {\r\n\t\t\t\t\t\t\ttoptip({\r\n\t\t\t\t\t\t\t\tmsg : $XP(res, 'resultmsg', ''),\r\n\t\t\t\t\t\t\t\ttype : 'danger'\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'detail' :\r\n\t\t\t\t// TODO show event detail \r\n\t\t\t\t\tinitEventDetailModal.call(self, $btn);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'track':\r\n\t\t\t\t// TODO track event info\r\n\t\t\t\t\tvar path = Hualala.PageRoute.createPath('mcmEventTrack', [eventID]);\r\n\t\t\t\t\tHualala.PageRoute.jumpPage(path);\r\n\t\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t});\r\n\t};\r\n\r\n\r\n\t/**\r\n\t * 渲染搜索结果方法\r\n\t * @param  {[type]} data [description]\r\n\t * @return {[type]}      [description]\r\n\t */\r\n\tHMCM.renderQueryResult = function (data) {\r\n\t\tvar self = this;\r\n\t\tvar ctx = Hualala.PageRoute.getPageContextByPath(), pageName = $XP(ctx, 'name');\r\n\t\tself.$result.empty();\r\n\t\tself.$result.html(self.get('resultTpl')(data));\r\n\t\tif (pageName == 'mcmEventMgr') {\r\n\t\t\tvar $checkbox = self.$result.find(':checkbox[name=switch_event]');\r\n\t\t\tinitEventSwitcher.call(self, $checkbox);\r\n\t\t\t\r\n\t\t}\r\n\t};\r\n\r\n\t/**\r\n\t * 切换活动卡片状态\r\n\t * @param  {[jQueryObj]}  $chkbox  开关\r\n\t * @param  {Boolean} isActive 开关状态\r\n\t * @return {[type]}           [description]\r\n\t */\r\n\tvar switchEventCardLayout = function ($chkbox, isActive) {\r\n\t\tvar self = this;\r\n\t\tvar key = $chkbox.attr('data-key');\r\n\t\tvar itemModel = self.model.getRecordModelByID(key);\r\n\t\tvar clz = itemModel.getEventCardClz();\r\n\t\tvar $tr = $chkbox.parents('tr'),\r\n\t\t\t$col = $tr.find('.eventWay');\r\n\t\t$col.find('.event-card').removeClass(isActive != 0 ? 'disable' : clz).addClass(isActive != 0 ? clz : 'disable');\r\n\t};\r\n\r\n\t/**\r\n\t * 切换活动列表控制按钮列状态\r\n\t * @param  {[jQueryOBj]}  $chkbox  开关\r\n\t * @param  {Boolean} isActive 开关状态\r\n\t * @return {[type]}           [description]\r\n\t */\r\n\tvar switchEventCtrlRow = function ($chkbox, isActive) {\r\n\t\tvar self = this;\r\n\t\tvar $tr = $chkbox.parents('tr'),\r\n\t\t\t$col = $tr.find('.ctrlrow');\r\n\t\t$col.find('.edit-event, .delete-event').addClass('hidden');\r\n\t\t$col.find('.track-event').removeClass('hidden');\r\n\t};\r\n\r\n\t/**\r\n\t * 组装活动详渲染数据\r\n\t * @return {[type]} [description]\r\n\t */\r\n\tvar mapEventDetailRenderData = function (model) {\r\n\t\tvar self = this;\r\n\t\t\r\n\t\tvar mapCardData = function () {\r\n\t\t\tvar eventCardSet = model.getEventCardSet();\r\n\t\t\treturn {\r\n\t\t\t\tcard : {\r\n\t\t\t\t\tclz : $XP(eventCardSet, 'type', ''),\r\n\t\t\t\t\tlabel : $XP(eventCardSet, 'label', '')\r\n\t\t\t\t}\r\n\t\t\t};\r\n\t\t};\r\n\t\tvar mapBaseInfoData = function () {\r\n\t\t\tvar keys = 'eventName,cardLevelLabel,eventRemark,deductPoints,sendPoints,eventRules'.split(',');\r\n\t\t\tvar ret = {};\r\n\t\t\t_.each(keys, function (k) {\r\n\t\t\t\tswitch (k) {\r\n\t\t\t\t\tcase 'cardLevelLabel':\r\n\t\t\t\t\t\tret[k] = model.get('cardLevelID');\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 'deductPoints':\r\n\t\t\t\t\tcase 'sendPoints':\r\n\t\t\t\t\t\tret[k] = parseInt(model.get(k));\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tdefault :\r\n\t\t\t\t\t\tret[k] = model.get(k);\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\treturn IX.inherit(ret, {\r\n\t\t\t\tinfoLabelClz : 'col-sm-3'\r\n\t\t\t});\r\n\t\t};\r\n\t\tvar mapGiftsData = function () {\r\n\t\t\tvar giftKeys = 'EGiftID,EGiftName,EGiftOdds,EgiftSendCount,EGiftSingleCount,EGiftTotalCount,EGiftEffectTimeHours,EGiftValidUnitDayCount'.split(',');\r\n\t\t\tvar mainKey = 'EGiftID';\r\n\t\t\tvar giftLevelCount = 0;\r\n\t\t\tvar data = model.getAll();\r\n\t\t\tvar gifts = [];\r\n\t\t\t_.each(data, function (v, k) {\r\n\t\t\t\tif (k.indexOf(mainKey) == 0) {\r\n\t\t\t\t\tgiftLevelCount++;\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\tfor (var i = 1; i <= giftLevelCount; i++) {\r\n\t\t\t\tvar gift = {};\r\n\t\t\t\tvar vals = _.map(giftKeys, function (_k) {\r\n\t\t\t\t\treturn model.get(_k + '_' + i);\r\n\t\t\t\t});\r\n\t\t\t\tvar r = _.object(giftKeys, vals);\r\n\t\t\t\tr = IX.inherit(r, {\r\n\t\t\t\t\tlevel : i + '等奖',\r\n\t\t\t\t\tsurplusCount : parseInt($XP(r, 'EGiftTotalCount', 0)) - parseInt(r, 'EgiftSendCount', 0)\r\n\t\t\t\t});\r\n\t\t\t\tgifts.push(r);\r\n\t\t\t}\r\n\t\t\tgifts = _.reject(gifts, function (el) {return $XP(el, mainKey) != 0;})\r\n\t\t\treturn {\r\n\t\t\t\tcolCount : giftKeys.length,\r\n\t\t\t\tgiftItems : gifts,\r\n\t\t\t\thasGifts : gifts.length > 0 ? true : false\r\n\t\t\t};\r\n\t\t};\r\n\t\treturn IX.inherit(mapBaseInfoData(), mapCardData(), mapGiftsData());\r\n\t};\r\n\r\n\tHMCM.mapEventDetailRenderData = mapEventDetailRenderData;\r\n\r\n\t/**\r\n\t * 查看活动详情窗口\r\n\t * @param  {[type]} $btn [description]\r\n\t * @return {[type]}      [description]\r\n\t */\r\n\tvar initEventDetailModal = function ($btn) {\r\n\t\tvar self = this;\r\n\t\tvar eventID = $btn.attr('data-id'),\r\n\t\t\tkey = $btn.attr('data-key');\r\n\t\tvar itemModel = self.model.getRecordModelByID(key);\r\n\t\tvar layoutTpl = Handlebars.compile(Hualala.TplLib.get('tpl_event_detail')),\r\n\t\t\tbtnTpl = Handlebars.compile(Hualala.TplLib.get('tpl_shop_modal_btns'));\r\n\t\tHandlebars.registerPartial(\"card\", Hualala.TplLib.get('tpl_event_card'));\r\n\t\tvar modal = new Hualala.UI.ModalDialog({\r\n\t\t\tid : 'event_detail',\r\n\t\t\tclz : 'evtdetail-modal',\r\n\t\t\ttitle : '活动详情',\r\n\t\t\tafterRemove : function () {\r\n\r\n\t\t\t}\r\n\t\t});\r\n\t\tmodal._.footer.html(btnTpl({\r\n\t\t\tbtns : [\r\n\t\t\t\t{clz : 'btn-default', name : 'cancel', label : '关闭'}\r\n\t\t\t]\r\n\t\t}));\r\n\t\tmodal._.footer.find('.btn-default').attr('data-dismiss', 'modal');\r\n\r\n\t\titemModel.emit('update', {\r\n\t\t\tsuccessFn : function (res) {\r\n\t\t\t\tvar renderData = mapEventDetailRenderData.call(self, itemModel);\r\n\t\t\t\tvar $detail = $(layoutTpl(renderData));\r\n\t\t\t\tmodal._.body.append($detail);\r\n\t\t\t\tmodal.show();\r\n\t\t\t},\r\n\t\t\tfaildFn : function (res) {\r\n\t\t\t\ttoptip({\r\n\t\t\t\t\tmsg : $XP(res, 'resultmsg', ''),\r\n\t\t\t\t\ttype : 'danger'\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t});\r\n\t};\r\n\r\n\tvar initEventSwitcher = function ($checkbox) {\r\n\t\tvar self = this;\r\n\t\t$checkbox.each(function () {\r\n\t\t\tvar $el = $(this),\r\n\t\t\t\tonLabel = '已启用',\r\n\t\t\t\toffLabel = '未启用';\r\n\t\t\t$el.bootstrapSwitch({\r\n\t\t\t\tsize : 'normal',\r\n\t\t\t\tonColor : 'primary',\r\n\t\t\t\toffColor : 'default',\r\n\t\t\t\tonText : onLabel,\r\n\t\t\t\toffText : offLabel\r\n\t\t\t}).on('switchChange.bootstrapSwitch', function (e, state) {\r\n\t\t\t\tvar $el = $(this);\r\n\t\t\t\tvar eventID = $el.attr('data-event-id'),\r\n\t\t\t\t\tkey = $el.attr('data-key');\r\n\t\t\t\tself.emit('switchEvent', {\r\n\t\t\t\t\teventID : eventID,\r\n\t\t\t\t\tisActive : +state,\r\n\t\t\t\t\tkey : key,\r\n\t\t\t\t\tsuccessFn : function (res) {\r\n\t\t\t\t\t\ttoptip({\r\n\t\t\t\t\t\t\tmsg : (!+state ? '关闭' : '开启') + '活动成功',\r\n\t\t\t\t\t\t\ttype : 'success'\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t\tswitchEventCardLayout.call(self, $el, +state);\r\n\t\t\t\t\t\tswitchEventCtrlRow.call(self, $el, +state);\r\n\t\t\t\t\t},\r\n\t\t\t\t\tfaildFn : function (res) {\r\n\t\t\t\t\t\t$el.bootstrapSwitch('toggleState', true);\r\n\t\t\t\t\t\ttoptip({\r\n\t\t\t\t\t\t\tmsg : $XP(res, 'resultmsg', ''),\r\n\t\t\t\t\t\t\ttype : 'danger'\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t});\r\n\t\t});\r\n\t};\r\n\r\n\tvar QueryResultView = Stapes.subclass({\r\n\t\t/**\r\n\t\t * 构造礼品管理列表View层\r\n\t\t * \r\n\t\t * \r\n\t\t * @param  {[Object]} cfg \r\n\t\t *         @param {Function} mapResultRenderData 格式化渲染数据\r\n\t\t *         @param {Function} renderResult 渲染方法\r\n\t\t * @return {Object}\r\n\t\t */\r\n\t\tconstructor : function (cfg) {\r\n\t\t\tthis.$container = null;\r\n\t\t\tthis.$resultBox = null;\r\n\t\t\tthis.$result = null;\r\n\t\t\tthis.$pager = null;\r\n\t\t\tthis.set('mapResultRenderData', $XF(cfg, 'mapResultRenderData'));\r\n\t\t\tthis.set('renderResult', $XF(cfg, 'renderResult'));\r\n\t\t\tthis.set('bundleEvent', $XF(cfg, 'bundleEvent'));\r\n\t\t\tthis.loadTemplate();\r\n\t\t}\r\n\t});\r\n\r\n\tQueryResultView.proto({\r\n\t\tinit : function (cfg) {\r\n\t\t\tthis.$container = $XP(cfg, 'container', null);\r\n\t\t\tthis.model = $XP(cfg, 'model', null);\r\n\t\t\tif (!this.$container || !this.model) {\r\n\t\t\t\tthrow(\"Query Result View Init Faild!\");\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tthis.initLayout();\r\n\t\t},\r\n\t\tloadTemplate : function () {\r\n\t\t\tvar layoutTpl = Handlebars.compile(Hualala.TplLib.get('tpl_shop_list_layout')),\r\n\t\t\t\tresultTpl = Handlebars.compile(Hualala.TplLib.get('tpl_base_datagrid')),\r\n\t\t\t\tgiftCardTpl = Handlebars.compile(Hualala.TplLib.get('tpl_gift_card')),\r\n\t\t\t\teventCardTpl = Handlebars.compile(Hualala.TplLib.get('tpl_event_card'));\r\n\t\t\tHandlebars.registerPartial(\"colBtns\", Hualala.TplLib.get('tpl_base_grid_colbtns'));\r\n\t\t\tHandlebars.registerHelper('chkColType', function (conditional, options) {\r\n\t\t\t\treturn (conditional == options.hash.type) ? options.fn(this) : options.inverse(this);\r\n\t\t\t});\r\n\t\t\tthis.set({\r\n\t\t\t\tlayoutTpl : layoutTpl,\r\n\t\t\t\tresultTpl : resultTpl,\r\n\t\t\t\tgiftCardTpl : giftCardTpl,\r\n\t\t\t\teventCardTpl : eventCardTpl\r\n\t\t\t});\r\n\t\t},\r\n\t\tinitLayout : function () {\r\n\t\t\tvar layoutTpl = this.get('layoutTpl');\r\n\t\t\tvar htm = layoutTpl();\r\n\t\t\tthis.$container.append(htm);\r\n\t\t\tthis.$resultBox = this.$container.find('.shop-list');\r\n\t\t\tthis.$result = this.$container.find('.shop-list-body');\r\n\t\t\tthis.$pager = this.$container.find('.page-selection');\r\n\t\t\tthis.initPager();\r\n\t\t\tthis.bindEvent();\r\n\t\t},\r\n\t\tinitPager : function (params) {\r\n\t\t\tvar self = this;\r\n\t\t\tif (!self.model.hasPager) return;\r\n\t\t\tvar baseCfg = {total : 0, page : 1, maxVisible : 10, leaps : true};\r\n\t\t\tthis.$pager.IXPager(IX.inherit(baseCfg, params));\r\n\t\t},\r\n\t\tmapRenderData : function (records) {\r\n\t\t\tvar mapFn = this.get('mapResultRenderData');\r\n\t\t\tvar ret = IX.isFn(mapFn) ? mapFn.apply(this, arguments) : null;\r\n\t\t\treturn ret;\r\n\t\t},\r\n\t\trenderRecords : function (data) {\r\n\t\t\tvar renderFn = this.get('renderResult');\r\n\t\t\tIX.isFn(renderFn) && renderFn.apply(this, arguments);\r\n\t\t},\r\n\t\trender : function () {\r\n\t\t\tvar self = this,\r\n\t\t\t\tmodel = self.model,\r\n\t\t\t\thasPager = model.hasPager,\r\n\t\t\t\tpagerParams = model.getPagerParams(),\r\n\t\t\t\tpageNo = $XP(pagerParams, 'pageNo', 1);\r\n\t\t\tvar records = model.getRecordsByPageNo(pageNo);\r\n\t\t\tvar renderData = self.mapRenderData(records);\r\n\t\t\tself.renderRecords(renderData);\r\n\t\t\thasPager && self.initPager({\r\n\t\t\t\ttotal : model.get('pageCount'),\r\n\t\t\t\tpage : model.get('pageNo'),\r\n\t\t\t\thref : 'javascript:void(0);'\r\n\t\t\t});\r\n\t\t},\r\n\t\tbindEvent : function () {\r\n\t\t\tvar self = this;\r\n\t\t\tvar bundleEvent = this.get('bundleEvent');\r\n\t\t\tIX.isFn(bundleEvent) && bundleEvent.apply(this, arguments);\r\n\t\t\tself.model.hasPager && self.$pager.on('page', function (e, pageNo) {\r\n\t\t\t\tvar params = self.model.getPagerParams();\r\n\t\t\t\tparams['pageNo'] = pageNo;\r\n\t\t\t\tself.model.emit('load', IX.inherit(params, {\r\n\t\t\t\t\tpageNo : $XP(params, 'pageNo', 1),\r\n\t\t\t\t\tpageSize : $XP(params, 'pageSize', 15)\r\n\t\t\t\t}));\r\n\t\t\t});\r\n\t\t}\r\n\t});\r\n\r\n\tHMCM.QueryResultView = QueryResultView;\r\n})(jQuery, window);;(function ($, window) {\r\n\tIX.ns(\"Hualala.MCM\");\r\n\tvar LoadingModal = Hualala.UI.LoadingModal;\r\n\tvar HMCM = Hualala.MCM;\r\n\tvar QueryResultControler = Stapes.subclass({\r\n\t\t/**\r\n\t\t * 构造礼品搜索结果控制器\r\n\t\t * @param  {Object} cfg \r\n\t\t *         @param {Object} view View层实例\r\n\t\t *         @param {Object} model Model层实例\r\n\t\t *         @param {jQuery Obj} container 容器\r\n\t\t * @return {[type]}     [description]\r\n\t\t */\r\n\t\tconstructor : function (cfg) {\r\n\t\t\tthis.set({\r\n\t\t\t\tsessionData : Hualala.getSessionData()\r\n\t\t\t});\r\n\t\t\tthis.container = $XP(cfg, 'container', null);\r\n\t\t\tthis.view = $XP(cfg, 'view', null);\r\n\t\t\tthis.model = $XP(cfg, 'model', null);\r\n\t\t\tif (!this.view || !this.model || !this.container) {\r\n\t\t\t\tthrow(\"Query Result init faild!\");\r\n\t\t\t}\r\n\t\t\tthis.isReady = false;\r\n\t\t\tthis.bindEvent();\r\n\t\t\tthis.bindModelEvent();\r\n\t\t\tthis.bindViewEvent();\r\n\t\t}\r\n\t});\r\n\r\n\tQueryResultControler.proto({\r\n\t\tinit : function (params) {\r\n\t\t\tthis.model.init(params);\r\n\t\t\tthis.view.init({\r\n\t\t\t\tmodel : this.model,\r\n\t\t\t\tcontainer : this.container\r\n\t\t\t});\r\n\t\t\tthis.loadingModal = new LoadingModal({\r\n\t\t\t\tstart : 100\r\n\t\t\t});\r\n\t\t\tthis.isReady = true;\r\n\t\t},\r\n\t\thasReady : function () {return this.isReady;},\r\n\t\tbindEvent : function () {\r\n\t\t\tthis.on({\r\n\t\t\t\tload : function (params) {\r\n\t\t\t\t\tvar self = this;\r\n\t\t\t\t\tif (!self.hasReady()) {\r\n\t\t\t\t\t\tself.init(params);\r\n\t\t\t\t\t}\r\n\t\t\t\t\t// self.model.emit('load', $XP(params, 'params', {}));\r\n\t\t\t\t\tself.model.emit('load', params);\r\n\t\t\t\t}\r\n\t\t\t}, this);\r\n\t\t\t\r\n\t\t\t\r\n\t\t},\r\n\t\tbindModelEvent : function () {\r\n\t\t\tthis.model.on({\r\n\t\t\t\tload : function (params) {\r\n\t\t\t\t\tvar self = this;\r\n\t\t\t\t\tvar cbFn = function () {\r\n\t\t\t\t\t\tself.view.emit('render');\r\n\t\t\t\t\t\tself.loadingModal.hide();\r\n\t\t\t\t\t};\r\n\t\t\t\t\tself.loadingModal.show();\r\n\t\t\t\t\tself.model.load(params, cbFn);\r\n\t\t\t\t}\r\n\t\t\t}, this);\r\n\t\t},\r\n\t\tbindViewEvent : function () {\r\n\t\t\tthis.view.on({\r\n\t\t\t\trender : function () {\r\n\t\t\t\t\tvar self = this;\r\n\t\t\t\t\tself.view.render();\r\n\t\t\t\t},\r\n\t\t\t\tdeleteItem : function (params) {\r\n\t\t\t\t\tvar self = this;\r\n\t\t\t\t\tvar id = $XP(params, 'id'),\r\n\t\t\t\t\t\tkey = $XP(params, 'key'),\r\n\t\t\t\t\t\tsuccessFn = $XF(params, 'successFn'),\r\n\t\t\t\t\t\tfaildFn = $XF(params, 'faildFn');\r\n\t\t\t\t\tvar itemModel = self.model.getRecordModelByID(id);\r\n\t\t\t\t\titemModel.emit('delete', {\r\n\t\t\t\t\t\titemID : key,\r\n\t\t\t\t\t\tsuccessFn : function (res) {\r\n\t\t\t\t\t\t\tsuccessFn(res);\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\tfaildFn : function (res) {\r\n\t\t\t\t\t\t\tfaildFn(res);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t},\r\n\t\t\t\tswitchEvent : function (params) {\r\n\t\t\t\t\tvar self = this;\r\n\t\t\t\t\tvar post = _.pick(params, 'eventID', 'isActive');\r\n\t\t\t\t\tvar key = $XP(params, 'key');\r\n\t\t\t\t\tvar itemModel = self.model.getRecordModelByID(key);\r\n\t\t\t\t\titemModel.emit('switchEvent', {\r\n\t\t\t\t\t\tpost : post,\r\n\t\t\t\t\t\tsuccessFn : $XF(params, 'successFn'),\r\n\t\t\t\t\t\tfaildFn : $XF(params, 'faildFn')\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t}, this);\r\n\t\t}\r\n\r\n\t});\r\n\r\n\tHMCM.QueryResultControler = QueryResultControler;\r\n})(jQuery, window);;(function ($, window) {\r\n\tIX.ns(\"Hualala.MCM\");\r\n\tvar popoverMsg = Hualala.UI.PopoverMsgTip,\r\n\t\ttoptip = Hualala.UI.TopTip; \r\n\r\n\tvar QueryModel = Hualala.Shop.QueryModel.subclass({\r\n\t\tconstructor : function (cfg) {\r\n\t\t\t// 原始数据\r\n\t\t\tthis.origCities = [];\r\n\t\t\tthis.origAreas = [];\r\n\t\t\tthis.origShops = [];\r\n\t\t\tthis.queryKeys = $XP(cfg, 'queryKeys', []);\r\n\t\t\t// 数据是否已经加载完毕\r\n\t\t\tthis.isReady = false;\r\n\t\t\tthis.callServer = Hualala.Global.getShopQuerySchema;\r\n\t\t}\r\n\t});\r\n\tQueryModel.proto({\r\n\t\tgetQueryParams : function () {\r\n\t\t\tvar self = this;\r\n\t\t\tvar vals = _.map(self.queryKeys, function (k) {\r\n\t\t\t\treturn self.get(k);\r\n\t\t\t});\r\n\t\t\tvar params = _.object(self.queryKeys, vals);\r\n\t\t\tIX.Debug.info(\"DEBUG: Order Query Model Query Params:\");\r\n\t\t\tIX.Debug.info(params);\r\n\t\t\treturn params;\r\n\t\t}\r\n\t});\r\n\tHualala.MCM.QueryModel = QueryModel;\r\n})(jQuery, window);;(function ($, window) {\r\n\tIX.ns(\"Hualala.MCM\");\r\n\tvar popoverMsg = Hualala.UI.PopoverMsgTip,\r\n\t\ttoptip = Hualala.UI.TopTip;\r\n\r\n\t/**\r\n\t * MCM搜索标点参数\r\n\t * \r\n\t * @type {Object}\r\n\t */\r\n\tHualala.MCM.QueryFormKeys = {\r\n\t\tGiftMgrQueryKeys : ['giftName', 'giftType'],\r\n\t\tGiftSendStatisticQueryKeys : ['startTime', 'endTime', 'getWay', 'giftStatus', 'giftItemID'],\r\n\t\tGiftUsedStatisticQueryKeys : ['startTime', 'endTime', 'usingShopID', 'giftItemID'],\r\n\t\tEventMgrQueryKeys : ['eventName', 'eventWay', 'isActive', 'eventStartDate', 'eventEndDate'],\r\n\t\tEventTrackBaseQueryKeys : ['eventID', 'keyword', 'cardLevelID']\r\n\t};\r\n\r\n\t/**\r\n\t * 查询条件表单元素配置\r\n\t */\r\n\tHualala.MCM.QueryFormElsCfg = {\r\n\t\t// 礼品列表搜索栏\r\n\t\tgiftName : {\r\n\t\t\ttype : 'text',\r\n\t\t\tlabel : '礼品名称',\r\n\t\t\tdefaultVal : '',\r\n\t\t\tvalidCfg : {\r\n\t\t\t\tvalidators : {}\r\n\t\t\t}\r\n\t\t},\r\n\t\tgiftType : {\r\n\t\t\ttype : 'combo',\r\n\t\t\tlabel : '礼品类型',\r\n\t\t\tdefaultVal : '',\r\n\t\t\tvalidCfg : {\r\n\t\t\t\tvalidators : {}\r\n\t\t\t}\r\n\t\t},\r\n\t\tsearch : {\r\n\t\t\ttype : 'button',\r\n\t\t\tclz : 'btn btn-warning',\r\n\t\t\tlabel : '查询'\r\n\t\t},\r\n\t\taddGift : {\r\n\t\t\ttype : 'button',\r\n\t\t\tclz : 'btn btn-warning',\r\n\t\t\tlabel : '添加礼品'\r\n\t\t},\r\n\r\n\t\t// 礼品详情->发送数统计\r\n\t\tgiftItemID : {\r\n\t\t\ttype : 'hidden',\r\n\t\t\tdefaultVal : '',\r\n\t\t\tvalidCfg : {\r\n\t\t\t\tvalidators : {}\r\n\t\t\t}\r\n\t\t},\r\n\t\ttimeRange : {\r\n\t\t\ttype : 'section',\r\n\t\t\tlabel : '发出时间',\r\n\t\t\tmin : {\r\n\t\t\t\ttype : 'datetimepicker',\r\n\t\t\t\tdefaultVal : '',\r\n\t\t\t\tvalidCfg : {\r\n\t\t\t\t\tgroup : '.min-input',\r\n\t\t\t\t\tvalidators : {}\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tmax : {\r\n\t\t\t\ttype : 'datetimepicker',\r\n\t\t\t\tdefaultVal : '',\r\n\t\t\t\tvalidCfg : {\r\n\t\t\t\t\tgroup : '.max-input',\r\n\t\t\t\t\tvalidators : {}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\tgetWay : {\r\n\t\t\ttype : 'combo',\r\n\t\t\tlabel : '发出方式',\r\n\t\t\tdefaultVal : '',\r\n\t\t\tvalidCfg : {\r\n\t\t\t\tvalidators : {}\r\n\t\t\t}\r\n\t\t},\r\n\t\tgiftStatus : {\r\n\t\t\ttype : 'combo',\r\n\t\t\tlabel : '状态',\r\n\t\t\tdefaultVal : '',\r\n\t\t\tvalidCfg : {\r\n\t\t\t\tvalidators : {}\r\n\t\t\t}\r\n\t\t},\r\n\t\tusingShopID : {\r\n\t\t\ttype : 'combo',\r\n\t\t\tlabel : '适用店铺',\r\n\t\t\tdefaultVal : '',\r\n\t\t\tvalidCfg : {\r\n\t\t\t\tvalidators : {}\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\t// 活动列表搜索栏\r\n\t\teventName : {\r\n\t\t\ttype : 'text',\r\n\t\t\tlabel : '活动名称',\r\n\t\t\tdefaultVal : '',\r\n\t\t\tvalidCfg : {\r\n\t\t\t\tvalidators : {}\r\n\t\t\t}\r\n\t\t},\r\n\t\teventWay : {\r\n\t\t\ttype : 'combo',\r\n\t\t\tlabel : '活动类型',\r\n\t\t\tdefaultVal : '',\r\n\t\t\tvalidCfg : {\r\n\t\t\t\tvalidators : {}\r\n\t\t\t}\r\n\t\t},\r\n\t\tisActive : {\r\n\t\t\ttype : 'combo',\r\n\t\t\tlabel : '活动状态',\r\n\t\t\tdefaultVal : '',\r\n\t\t\tvalidCfg : {\r\n\t\t\t\tvalidators : {}\r\n\t\t\t}\r\n\t\t},\r\n\t\teventTime : {\r\n\t\t\ttype : 'section',\r\n\t\t\tlabel : '起止日期',\r\n\t\t\tmin : {\r\n\t\t\t\ttype : 'datetimepicker',\r\n\t\t\t\tdefaultVal : '',\r\n\t\t\t\tvalidCfg : {\r\n\t\t\t\t\tgroup : '.min-input',\r\n\t\t\t\t\tvalidators : {}\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tmax : {\r\n\t\t\t\ttype : 'datetimepicker',\r\n\t\t\t\tdefaultVal : '',\r\n\t\t\t\tvalidCfg : {\r\n\t\t\t\t\tgroup : '.max-input',\r\n\t\t\t\t\tvalidators : {}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\taddEvent : {\r\n\t\t\ttype : 'button',\r\n\t\t\tclz : 'btn btn-warning',\r\n\t\t\tlabel : '添加活动'\r\n\t\t},\r\n\t\twinFlag : {\r\n\t\t\ttype : 'combo',\r\n\t\t\tlabel : \"中奖情况\",\r\n\t\t\tdefaultVal : \"\",\r\n\t\t\tvalidCfg : {\r\n\t\t\t\tvalidators : {}\r\n\t\t\t}\r\n\t\t},\r\n\t\teventID : {\r\n\t\t\ttype : 'hidden',\r\n\t\t\tdefaultVal : '',\r\n\t\t\tvalidCfg : {\r\n\t\t\t\tvalidators : {}\r\n\t\t\t}\r\n\t\t},\r\n\t\tkeyword : {\r\n\t\t\ttype : 'text',\r\n\t\t\tlabel : '关键字',\r\n\t\t\tdefaultVal : \"\",\r\n\t\t\tvalidCfg : {\r\n\t\t\t\tvalidators : {}\r\n\t\t\t}\r\n\t\t},\r\n\t\tcardLevelID : {\r\n\t\t\ttype : 'combo',\r\n\t\t\tlabel : '会员等级',\r\n\t\t\tdefaultVal : \"-1\",\r\n\t\t\tvalidCfg : {\r\n\t\t\t\tvalidators : {}\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n\tvar QueryFormElsHT = new IX.IListManager();\r\n\t_.each(Hualala.MCM.QueryFormElsCfg, function (el, k) {\r\n\t\tvar type = $XP(el, 'type');\r\n\t\tvar labelClz = 'col-xs-2 col-sm-2 col-md-4 control-label';\r\n\t\tif (type == 'section') {\r\n\t\t\tvar id = minID = k + '_min_' + IX.id(), maxID = k + '_max_' + IX.id(),\r\n\t\t\t\tminName = k == 'eventTime' ? 'eventStartDate' : 'startTime',\r\n\t\t\t\tmaxName = k == 'eventTime' ? 'eventEndDate' : 'endTime',\r\n\t\t\t\tmin = IX.inherit($XP(el, 'min', {}), {\r\n\t\t\t\t\tid : minID, name : minName, clz : 'col-xs-5 col-sm-5 col-md-4'\r\n\t\t\t\t}),\r\n\t\t\t\tmax = IX.inherit($XP(el, 'max', {}), {\r\n\t\t\t\t\tid : maxID, name : maxName, clz : 'col-xs-5 col-sm-5 col-md-4'\r\n\t\t\t\t});\r\n\t\t\tQueryFormElsHT.register(k, IX.inherit(el, {\r\n\t\t\t\tid : id,\r\n\t\t\t\tlabelClz : 'col-xs-2 col-sm-2 col-md-2 control-label',\r\n\t\t\t\tmin : min,\r\n\t\t\t\tmax : max\r\n\t\t\t}));\r\n\t\t} else {\r\n\t\t\tQueryFormElsHT.register(k, IX.inherit(el, {\r\n\t\t\t\tid : k + '_' + IX.id(),\r\n\t\t\t\tname : k,\r\n\t\t\t\tlabelClz : labelClz\r\n\t\t\t}, $XP(el, 'type') != 'button' ? {clz : 'col-xs-8 col-sm-8 col-md-8'} : null));\r\n\t\t}\r\n\t});\r\n\r\n\tHualala.MCM.bundleGiftsQueryEvent = function () {\r\n\t\tvar self = this;\r\n\t\tself.$queryBox.on('click', '.btn', function (e) {\r\n\t\t\tvar act = $(this).attr('name');\r\n\t\t\tif (act == 'addGift') {\r\n\t\t\t\t// TODO Add Gift\r\n\t\t\t\tvar wizardPanel = new Hualala.MCM.MCMWizardModal({\r\n\t\t\t\t\tparentView : self,\r\n\t\t\t\t\tmode : 'create',\r\n\t\t\t\t\tsuccessFn : function () {\r\n\r\n\t\t\t\t\t},\r\n\t\t\t\t\tfailFn : function () {\r\n\r\n\t\t\t\t\t},\r\n\t\t\t\t\tmodel : new Hualala.MCM.BaseGiftModel(),\r\n\t\t\t\t\tmodalClz : 'mcm-gift-modal',\r\n\t\t\t\t\twizardClz : 'mcm-gift-wizard',\r\n\t\t\t\t\tmodalTitle : '创建礼品',\r\n\t\t\t\t\tonWizardInit : function ($cnt, cntID, wizardMode) {\r\n\t\t\t\t\t\tHualala.MCM.initGiftBaseInfoStep.call(this, $cnt, cntID, wizardMode);\r\n\t\t\t\t\t},\r\n\t\t\t\t\tonStepCommit : function (curID) {\r\n\t\t\t\t\t\tHualala.MCM.onGiftWizardStepCommit.call(this, curID);\r\n\t\t\t\t\t},\r\n\t\t\t\t\tonStepChange : function ($curNav, $navBar, cIdx, nIdx) {\r\n\t\t\t\t\t\tHualala.MCM.onGiftWizardStepChange.call(this, $curNav, $navBar, cIdx, nIdx);\r\n\t\t\t\t\t},\r\n\t\t\t\t\tbundleWizardEvent : function () {\r\n\t\t\t\t\t\tHualala.MCM.bundleGiftWizardEvent.call(this);\r\n\t\t\t\t\t},\r\n\t\t\t\t\twizardStepsCfg : Hualala.MCM.GiftWizardCfg,\r\n\t\t\t\t\twizardCtrls : Hualala.MCM.WizardCtrls\r\n\r\n\t\t\t\t});\r\n\t\t\t} else if (act == 'search') {\r\n\t\t\t\tself.emit('query', self.getQueryParams());\r\n\t\t\t}\r\n\t\t});\r\n\t};\r\n\r\n\tHualala.MCM.bundleEventsQueryEvent = function () {\r\n\t\tvar self = this;\r\n\t\tself.$queryBox.on('click', '.btn', function (e) {\r\n\t\t\tvar act = $(this).attr('name');\r\n\t\t\tif (act == 'addEvent') {\r\n\t\t\t\t// TODO Add Event\r\n\t\t\t\tvar wizardPanel = new Hualala.MCM.MCMWizardModal({\r\n\t\t\t\t\tparentView : self,\r\n\t\t\t\t\tmode : 'create',\r\n\t\t\t\t\tsuccessFn : function () {\r\n\r\n\t\t\t\t\t},\r\n\t\t\t\t\tfailFn : function () {\r\n\r\n\t\t\t\t\t},\r\n\t\t\t\t\tmodel : new Hualala.MCM.BaseEventModel(),\r\n\t\t\t\t\tmodalClz : 'mcm-event-modal',\r\n\t\t\t\t\twizardClz : 'mcm-event-wizard',\r\n\t\t\t\t\tmodalTitle : '创建活动',\r\n\t\t\t\t\tonWizardInit : function ($cnt, cntID, wizardMode) {\r\n\t\t\t\t\t\tHualala.MCM.initEventBaseInfoStep.call(this, $cnt, cntID, wizardMode);\r\n\t\t\t\t\t},\r\n\t\t\t\t\tonStepCommit : function (curID) {\r\n\t\t\t\t\t\tHualala.MCM.onEventWizardStepCommit.call(this, curID);\r\n\t\t\t\t\t},\r\n\t\t\t\t\tonStepChange : function ($curNav, $navBar, cIdx, nIdx) {\r\n\t\t\t\t\t\tHualala.MCM.onEventWizardStepChange.call(this, $curNav, $navBar, cIdx, nIdx);\r\n\t\t\t\t\t},\r\n\t\t\t\t\tbundleWizardEvent : function () {\r\n\t\t\t\t\t\tHualala.MCM.bundleEventWizardEvent.call(this);\r\n\t\t\t\t\t},\r\n\t\t\t\t\twizardStepsCfg : Hualala.MCM.EventWizardCfg,\r\n\t\t\t\t\twizardCtrls : Hualala.MCM.WizardCtrls\r\n\r\n\t\t\t\t});\r\n\r\n\t\t\t} else if (act == 'search') {\r\n\t\t\t\tself.emit('query', self.getQueryParams());\r\n\t\t\t}\r\n\t\t});\r\n\t};\r\n\t/**\r\n\t * 格式化礼品管理页,搜索栏表单元素\r\n\t * @return {Object} 渲染表单的数据\r\n\t */\r\n\tHualala.MCM.mapGiftQueryFormRenderData = function () {\r\n\t\tvar self = this;\r\n\t\tvar queryKeys = self.model.queryKeys;\r\n\t\tvar query = {\r\n\t\t\tcols : [\r\n\t\t\t\t{\r\n\t\t\t\t\tcolClz : 'col-md-4',\r\n\t\t\t\t\titems : QueryFormElsHT.getByKeys(['giftName'])\r\n\t\t\t\t},\r\n\t\t\t\t{\r\n\t\t\t\t\tcolClz : 'col-md-4',\r\n\t\t\t\t\titems : QueryFormElsHT.getByKeys(['giftType'])\r\n\t\t\t\t},\r\n\t\t\t\t{\r\n\t\t\t\t\tcolClz : 'col-md-2',\r\n\t\t\t\t\titems : QueryFormElsHT.getByKeys(['search'])\r\n\t\t\t\t},\r\n\t\t\t\t{\r\n\t\t\t\t\tcolClz : 'col-md-2 ' + (self.hasAddBtn ? '' : 'hidden'),\r\n\t\t\t\t\titems : QueryFormElsHT.getByKeys(['addGift'])\r\n\t\t\t\t}\r\n\t\t\t]\r\n\t\t};\r\n\t\treturn {\r\n\t\t\tquery : query\r\n\t\t};\r\n\t};\r\n\r\n\tHualala.MCM.mapEventQueryFormRenderData = function () {\r\n\t\tvar self = this;\r\n\t\tvar queryKeys = self.model.queryKeys;\r\n\t\tvar query = {\r\n\t\t\tcols : [\r\n\t\t\t\t{\r\n\t\t\t\t\tcolClz : 'col-md-3',\r\n\t\t\t\t\titems : QueryFormElsHT.getByKeys(['eventName'])\r\n\t\t\t\t},\r\n\t\t\t\t{\r\n\t\t\t\t\tcolClz : 'col-md-3',\r\n\t\t\t\t\titems : QueryFormElsHT.getByKeys(['eventWay'])\r\n\t\t\t\t},\r\n\t\t\t\t{\r\n\t\t\t\t\tcolClz : 'col-md-3',\r\n\t\t\t\t\titems : QueryFormElsHT.getByKeys(['isActive'])\r\n\t\t\t\t},\r\n\t\t\t\t{\r\n\t\t\t\t\tcolClz : 'col-md-6',\r\n\t\t\t\t\titems : QueryFormElsHT.getByKeys(['eventTime'])\r\n\t\t\t\t},\r\n\t\t\t\t{\r\n\t\t\t\t\tcolClz : 'col-md-offset-2 col-md-2',\r\n\t\t\t\t\titems : QueryFormElsHT.getByKeys(['search'])\r\n\t\t\t\t},\r\n\t\t\t\t{\r\n\t\t\t\t\tcolClz : 'col-md-2',\r\n\t\t\t\t\titems : QueryFormElsHT.getByKeys(['addEvent'])\r\n\t\t\t\t},\r\n\t\t\t\t\r\n\t\t\t\t\r\n\t\t\t\t\r\n\t\t\t\t\r\n\t\t\t]\r\n\t\t};\r\n\t\treturn {\r\n\t\t\tquery : query\r\n\t\t};\r\n\t};\r\n\r\n\tHualala.MCM.mapGiftDetailGetWayQueryFormRenderData = function () {\r\n\t\tvar self = this;\r\n\t\tvar queryKeys = self.model.queryKeys;\r\n\t\tvar query = {\r\n\t\t\tcols : [\r\n\t\t\t\t{\r\n\t\t\t\t\tcolClz : 'col-md-4',\r\n\t\t\t\t\titems : QueryFormElsHT.getByKeys(['timeRange'])\r\n\t\t\t\t},\r\n\t\t\t\t{\r\n\t\t\t\t\tcolClz : 'col-md-3',\r\n\t\t\t\t\titems : QueryFormElsHT.getByKeys(['getWay'])\r\n\t\t\t\t},\r\n\t\t\t\t{\r\n\t\t\t\t\tcolClz : 'col-md-3',\r\n\t\t\t\t\titems : QueryFormElsHT.getByKeys(['giftStatus'])\r\n\t\t\t\t},\r\n\t\t\t\t{\r\n\t\t\t\t\tcolClz : 'col-md-2',\r\n\t\t\t\t\titems : QueryFormElsHT.getByKeys(['search', 'giftItemID'])\r\n\t\t\t\t}\r\n\t\t\t]\r\n\t\t};\r\n\t\treturn {\r\n\t\t\tquery : query\r\n\t\t};\r\n\t};\r\n\r\n\tHualala.MCM.mapGiftDetailUsedQueryFormRenderData = function () {\r\n\t\tvar self = this;\r\n\t\tvar queryKeys = self.model.queryKeys;\r\n\t\tvar query = {\r\n\t\t\tcols : [\r\n\t\t\t\t{\r\n\t\t\t\t\tcolClz : 'col-md-4',\r\n\t\t\t\t\titems : QueryFormElsHT.getByKeys(['timeRange'])\r\n\t\t\t\t},\r\n\t\t\t\t{\r\n\t\t\t\t\tcolClz : 'col-md-3',\r\n\t\t\t\t\titems : QueryFormElsHT.getByKeys(['usingShopID'])\r\n\t\t\t\t},\r\n\t\t\t\t{\r\n\t\t\t\t\tcolClz : 'col-md-offset-1 col-md-2',\r\n\t\t\t\t\titems : QueryFormElsHT.getByKeys(['search', 'giftItemID'])\r\n\t\t\t\t}\r\n\t\t\t]\r\n\t\t};\r\n\t\treturn {\r\n\t\t\tquery : query\r\n\t\t};\r\n\t};\r\n\r\n\tHualala.MCM.mapEventTrackQueryFormRenderData = function () {\r\n\t\tvar self = this;\r\n\t\tvar queryKeys = self.model.queryKeys;\r\n\t\tvar eventDetail = self.$container.data('eventDetail'),\r\n\t\t\teventWay = $XP(eventDetail, 'eventWay');\r\n\t\tvar query = {\r\n\t\t\tcols : [\r\n\t\t\t\t{\r\n\t\t\t\t\tcolClz : 'col-md-4',\r\n\t\t\t\t\titems : QueryFormElsHT.getByKeys(['keyword'])\r\n\t\t\t\t},\r\n\t\t\t\t{\r\n\t\t\t\t\tcolClz : 'col-md-3',\r\n\t\t\t\t\titems : QueryFormElsHT.getByKeys(['cardLevelID'])\r\n\t\t\t\t},\r\n\t\t\t\t{\r\n\t\t\t\t\tcolClz : 'col-md-2',\r\n\t\t\t\t\titems : QueryFormElsHT.getByKeys(['search', 'eventID'])\r\n\t\t\t\t}\r\n\t\t\t]\r\n\t\t};\r\n\t\tif (eventWay == '20' || eventWay == '22') {\r\n\t\t\tquery = {\r\n\t\t\t\tcols : [\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tcolClz : 'col-md-4',\r\n\t\t\t\t\t\titems : QueryFormElsHT.getByKeys(['keyword'])\r\n\t\t\t\t\t},\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tcolClz : 'col-md-3',\r\n\t\t\t\t\t\titems : QueryFormElsHT.getByKeys(['cardLevelID'])\r\n\t\t\t\t\t},\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tcolClz : 'col-md-3',\r\n\t\t\t\t\t\titems : QueryFormElsHT.getByKeys(['winFlag'])\r\n\t\t\t\t\t},\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tcolClz : 'col-md-2',\r\n\t\t\t\t\t\titems : QueryFormElsHT.getByKeys(['search', 'eventID'])\r\n\t\t\t\t\t}\r\n\t\t\t\t]\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn {\r\n\t\t\tquery : query\r\n\t\t};\r\n\t};\r\n\r\n\tvar QueryView = Hualala.Order.QueryView.subclass({\r\n\t\t/**\r\n\t\t * 搜索栏View层构造函数\r\n\t\t * \r\n\t\t * @param  {Obj} cfg \r\n\t\t *         @param {Function} mapRenderDataFn 渲染搜索栏表单的方法\r\n\t\t *         @param {Function} bundleQueryEvent 为搜索栏绑定事件\r\n\t\t * @return {Object}\r\n\t\t */\r\n\t\tconstructor : function (cfg) {\r\n\t\t\tthis.isReady = false;\r\n\t\t\tthis.$container = null;\r\n\t\t\tthis.$queryBox = null;\r\n\t\t\tthis.loadTemplates();\r\n\t\t\tthis.hasAddBtn = $XP(cfg, 'hasAddBtn', true);\r\n\t\t\tthis.set('mapRenderDataFn', $XF(cfg, 'mapRenderDataFn'));\r\n\t\t\tthis.set('bundleQueryEvent', $XF(cfg, 'bundleQueryEvent'));\r\n\t\t\tthis.set('initQueryFormEls', $XP(cfg, 'initQueryFormEls', null));\r\n\t\t}\r\n\t});\r\n\r\n\tQueryView.proto({\r\n\t\trenderLayout : function () {\r\n\t\t\tvar self = this,\r\n\t\t\t\tlayoutTpl = self.get('layoutTpl'),\r\n\t\t\t\tmodel = self.model;\r\n\t\t\tvar renderData = self.mapRenderLayoutData();\r\n\t\t\tvar html = layoutTpl(renderData);\r\n\t\t\tself.$queryBox = $(html);\r\n\t\t\tself.$container.html(self.$queryBox);\r\n\t\t\tif (!self.get('initQueryFormEls')) {\r\n\t\t\t\tself.initQueryFormEls();\t\r\n\t\t\t} else {\r\n\t\t\t\tIX.isFn(self.get('initQueryFormEls')) && self.get('initQueryFormEls').call(self);\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\t// self.initQueryEls();\r\n\t\t},\r\n\t\tbindEvent : function () {\r\n\t\t\tvar self = this;\r\n\t\t\tvar bundleQueryEvent = self.get('bundleQueryEvent');\r\n\t\t\t// self.$queryBox.on('click', '.btn', function (e) {\r\n\t\t\t// \tvar act = $(this).attr('name');\r\n\t\t\t// \tif (act == 'addGift') {\r\n\t\t\t// \t\t// TODO Add Gift\r\n\t\t\t// \t} else if (act == 'search') {\r\n\t\t\t// \t\tself.emit('query', self.getQueryParams());\r\n\t\t\t// \t}\r\n\t\t\t// });\r\n\t\t\tbundleQueryEvent.call(self);\r\n\t\t},\r\n\t\tgetQueryParams : function () {\r\n\t\t\tvar self = this,\r\n\t\t\t\tkeys = self.model.queryKeys,\r\n\t\t\t\t$form = self.$queryBox.find('form'),\r\n\t\t\t\tels = $form.serializeArray();\r\n\t\t\tels = _.map(els, function (el) {\r\n\t\t\t\tvar n = $XP(el, 'name'), v = $XP(el, 'value', '');\r\n\t\t\t\tif (n == 'startDate' || n == 'endDate') {\r\n\t\t\t\t\tv = IX.isEmpty(v) ? '' : IX.Date.getDateByFormat(v, 'yyyyMMdd');\r\n\t\t\t\t\treturn {\r\n\t\t\t\t\t\tname : n,\r\n\t\t\t\t\t\tvalue : v\r\n\t\t\t\t\t};\r\n\t\t\t\t}\r\n\t\t\t\treturn el;\r\n\t\t\t});\r\n\t\t\tels = _.object(_.pluck(els, 'name'), _.pluck(els, 'value'));\r\n\t\t\tself.model.set(els);\r\n\t\t\tIX.Debug.info(\"DEBUG: Order Query Model Query Params:\");\r\n\t\t\tIX.Debug.info(els);\r\n\t\t\treturn els;\r\n\t\t},\r\n\t\tinitQueryFormEls : function () {\r\n\t\t\tvar self = this,\r\n\t\t\t\tels = self.model.getQueryParams();\r\n\t\t\tvar ctx = Hualala.PageRoute.getPageContextByPath(), pageName = $XP(ctx, 'name');\r\n\t\t\tif (pageName == 'mcmEventMgr') {\r\n\t\t\t\tself.initEventTypeComboOpts($XP(els, 'eventWay', ''));\r\n\t\t\t\tself.initEventIsActiveComboOpts($XP(els, 'isActive', ''));\r\n\t\t\t\tself.initEventTimePicker($XP(els, 'eventStartDate', ''), $XP(els, 'eventEndDate'));\r\n\t\t\t}\r\n\t\t\tif (pageName == 'mcmGiftsMgr') {\r\n\t\t\t\tself.initGiftTypeComboOpts($XP(els, 'giftType', ''));\r\n\t\t\t}\r\n\t\t\tif (pageName == 'mcmGiftDetail') {\r\n\t\t\t\tvar tabCntID = self.$container.attr('id');\r\n\t\t\t\tvar ctx = Hualala.PageRoute.getPageContextByPath(), pageName = $XP(ctx, 'name');\r\n\t\t\t\tself.initEventTimePicker($XP(els, 'startTime', ''), $XP(els, 'endTime', ''));\r\n\t\t\t\tself.$queryBox.find(':hidden[name=giftItemID]').val($XP(ctx, 'params', [])[0]);\r\n\t\t\t\tconsole.info(self.container);\r\n\t\t\t\tif (tabCntID == 'tab_send') {\r\n\t\t\t\t\tself.initGiftDetailGetWayComboOpts($XP(els, 'getWay', ''));\r\n\t\t\t\t\tself.initGiftDetailGiftStatusComboOpts($XP(els, 'giftStatus', ''));\r\n\t\t\t\t} else {\r\n\t\t\t\t\tself.initShopChosenPanel($XP(els, 'usingShopID', ''));\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif (pageName == 'mcmEventTrack') {\r\n\t\t\t\tself.initCardLevelComboOpts();\r\n\t\t\t\tself.initWinTypeComboOpts();\r\n\t\t\t}\r\n\t\t\t// _.each(els, function (v, k) {\r\n\t\t\t// \tif (k == 'giftType') {\r\n\t\t\t// \t\tself.initGiftTypeComboOpts(v);\r\n\t\t\t// \t}\r\n\t\t\t// });\r\n\t\t},\r\n\t\t// 加载礼品发出方式下拉列表选项\r\n\t\tinitGiftDetailGetWayComboOpts : function (curGetWay) {\r\n\t\t\tvar self = this,\r\n\t\t\t\tgetWayTypes = Hualala.TypeDef.MCMDataSet.GiftDistributeTypes;\r\n\t\t\tif (IX.isEmpty(getWayTypes)) return;\r\n\t\t\tgetWayTypes = _.map(getWayTypes, function (item) {\r\n\t\t\t\tvar value = $XP(item, 'value'), label = $XP(item, 'label');\r\n\t\t\t\treturn {\r\n\t\t\t\t\tvalue : value,\r\n\t\t\t\t\tlabel : label,\r\n\t\t\t\t\tselected : value == curGetWay ? 'selected' : ''\r\n\t\t\t\t};\r\n\t\t\t});\r\n\t\t\tvar optTpl = self.get('comboOptsTpl'),\r\n\t\t\t\thtm = optTpl({\r\n\t\t\t\t\topts : getWayTypes\r\n\t\t\t\t}),\r\n\t\t\t\t$combo = self.$queryBox.find('select[name=getWay]');\r\n\t\t\t$combo.html(htm);\r\n\t\t},\r\n\t\t// 加载礼品状态下拉列表选项\r\n\t\tinitGiftDetailGiftStatusComboOpts : function (curVal) {\r\n\t\t\tvar self = this,\r\n\t\t\t\toptions = Hualala.TypeDef.MCMDataSet.GiftStatus;\r\n\t\t\tif (IX.isEmpty(options)) return;\r\n\t\t\toptions = _.map(options, function (item) {\r\n\t\t\t\tvar value = $XP(item, 'value'), label = $XP(item, 'label');\r\n\t\t\t\treturn {\r\n\t\t\t\t\tvalue : value,\r\n\t\t\t\t\tlabel : label,\r\n\t\t\t\t\tselected : value == curVal ? 'selected' : ''\r\n\t\t\t\t};\r\n\t\t\t});\r\n\t\t\tvar optTpl = self.get('comboOptsTpl'),\r\n\t\t\t\thtm = optTpl({\r\n\t\t\t\t\topts : options\r\n\t\t\t\t}),\r\n\t\t\t\t$combo = self.$queryBox.find('select[name=giftStatus]');\r\n\t\t\t$combo.html(htm);\r\n\t\t},\r\n\t\t// 加载礼品类型下拉列表选项\r\n\t\tinitGiftTypeComboOpts : function (curGiftType) {\r\n\t\t\tvar self = this,\r\n\t\t\t\tgiftTypes = Hualala.TypeDef.MCMDataSet.GiftTypes;\r\n\t\t\tif (IX.isEmpty(giftTypes)) return;\r\n\t\t\tgiftTypes = _.map(giftTypes, function (item) {\r\n\t\t\t\tvar value = $XP(item, 'value'), label = $XP(item, 'label');\r\n\t\t\t\treturn {\r\n\t\t\t\t\tvalue : value,\r\n\t\t\t\t\tlabel : label,\r\n\t\t\t\t\tselected : value == curGiftType ? 'selected' : ''\r\n\t\t\t\t};\r\n\t\t\t});\r\n\t\t\tvar optTpl = self.get('comboOptsTpl'),\r\n\t\t\t\thtm = optTpl({\r\n\t\t\t\t\topts : giftTypes\r\n\t\t\t\t}),\r\n\t\t\t\t$combo = self.$queryBox.find('select[name=giftType]');\r\n\t\t\t$combo.html(htm);\r\n\t\t},\r\n\t\t// 加载活动类型下拉列表选项\r\n\t\tinitEventTypeComboOpts : function (curEventType) {\r\n\t\t\tvar self = this,\r\n\t\t\t\teventTypes = Hualala.TypeDef.MCMDataSet.EventTypes;\r\n\t\t\tif (IX.isEmpty(eventTypes)) return;\r\n\t\t\teventTypes = _.map(eventTypes, function (item) {\r\n\t\t\t\tvar value = $XP(item, 'value'), label = $XP(item, 'label');\r\n\t\t\t\treturn {\r\n\t\t\t\t\tvalue : value,\r\n\t\t\t\t\tlabel : label,\r\n\t\t\t\t\tselected : value == curEventType ? 'selected' : ''\r\n\t\t\t\t};\r\n\t\t\t});\r\n\t\t\tvar optTpl = self.get('comboOptsTpl'),\r\n\t\t\t\thtm = optTpl({\r\n\t\t\t\t\topts : eventTypes\r\n\t\t\t\t}),\r\n\t\t\t\t$combo = self.$queryBox.find('select[name=eventWay]');\r\n\t\t\t$combo.html(htm);\r\n\t\t},\r\n\t\t// 加载活动状态下拉列表数据 \r\n\t\tinitEventIsActiveComboOpts : function (curIsActive) {\r\n\t\t\tvar self = this,\r\n\t\t\t\teventStatus = Hualala.TypeDef.MCMDataSet.EventIsActive;\r\n\t\t\tif (IX.isEmpty(eventStatus)) return ;\r\n\t\t\teventStatus = _.map(eventStatus, function (item) {\r\n\t\t\t\tvar value = $XP(item, 'value'), label = $XP(item, 'label');\r\n\t\t\t\treturn {\r\n\t\t\t\t\tvalue : value,\r\n\t\t\t\t\tlabel : label,\r\n\t\t\t\t\tselected : value == curIsActive ? 'selected' : ''\r\n\t\t\t\t};\r\n\t\t\t});\r\n\t\t\tvar optTpl = self.get('comboOptsTpl'),\r\n\t\t\t\thtm = optTpl({\r\n\t\t\t\t\topts : eventStatus\r\n\t\t\t\t}),\r\n\t\t\t\t$combo = self.$queryBox.find('select[name=isActive]');\r\n\t\t\t$combo.html(htm);\r\n\t\t},\r\n\t\t// 加载时间选择控件\r\n\t\tinitEventTimePicker : function (start, end) {\r\n\t\t\tvar self = this;\r\n\t\t\tself.$queryBox.find('[data-type=datetimepicker]').datetimepicker({\r\n\t\t\t\tformat : 'yyyy/mm/dd',\r\n\t\t\t\tstartDate : '2010/01/01',\r\n\t\t\t\tautoclose : true,\r\n\t\t\t\tminView : 'month',\r\n\t\t\t\ttodayBtn : true,\r\n\t\t\t\ttodayHighlight : true,\r\n\t\t\t\tlanguage : 'zh-CN'\r\n\t\t\t});\r\n\t\t},\r\n\t\trenderShopChosenRenderOptions : function (sections) {\r\n\t\t\tvar self = this;\r\n\t\t\tvar optTpl = Handlebars.compile(Hualala.TplLib.get('tpl_shop_optgroup'));\r\n\t\t\tvar shops = _.groupBy(sections, function (el) {\r\n\t\t\t\treturn $XP(el, 'cityID');\r\n\t\t\t});\r\n\t\t\tvar renderData = [];\r\n\t\t\t_.each(shops, function (els, cityID) {\r\n\t\t\t\tvar cityName = $XP(els[0], 'cityName', '');\r\n\t\t\t\tvar options = _.map(els, function (el) {\r\n\t\t\t\t\treturn IX.inherit(el, {\r\n\t\t\t\t\t\tclz : ''\r\n\t\t\t\t\t});\r\n\t\t\t\t});\r\n\t\t\t\trenderData.push({\r\n\t\t\t\t\tcityName : cityName,\r\n\t\t\t\t\tcityID : cityID,\r\n\t\t\t\t\toptions : options\r\n\t\t\t\t})\r\n\t\t\t});\r\n\t\t\t\r\n\t\t\tself.$queryBox.find('select[name=usingShopID]').html(optTpl({\r\n\t\t\t\titems : renderData\r\n\t\t\t}));\r\n\t\t\tself.$queryBox.find('select[name=usingShopID]').prepend('<option value=\"\" selected></option>');\r\n\t\t},\r\n\t\t// 加载选择店铺控件\r\n\t\tinitShopChosenPanel : function (curUsingShopID) {\r\n\t\t\tvar self = this;\r\n\t\t\tvar matcher = (new Pymatch([]));\r\n\t\t\tvar sections = [];\r\n\t\t\tHualala.Global.getShopQuerySchema({}, function (res) {\r\n\t\t\t\tif ($XP(res, 'resultcode') == '000') {\r\n\t\t\t\t\tsections = $XP(res, 'data.shops', []);\r\n\t\t\t\t\tself.renderShopChosenRenderOptions(sections);\r\n\t\t\t\t\tvar getMatchedFn = function (searchText) {\r\n\t\t\t\t\t\tmatcher.setNames(_.map(sections, function(el) {\r\n\t\t\t\t\t\t\treturn IX.inherit(el, {\r\n\t\t\t\t\t\t\t\tname : $XP(el, 'shopName'),\r\n\t\t\t\t\t\t\t\tvalue : $XP(el, 'shopID')\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t}));\r\n\t\t\t\t\t\tvar matchedSections = matcher.match(searchText);\r\n\t\t\t\t\t\tvar matchedOptions = {};\r\n\t\t\t\t\t\t_.each(matchedSections, function (el, i) {\r\n\t\t\t\t\t\t\tmatchedOptions[el[0].shopID] = true;\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t\treturn matchedOptions;\r\n\t\t\t\t\t};\r\n\r\n\t\t\t\t\tself.$queryBox.find('select[name=usingShopID]').chosen({\r\n\t\t\t\t\t\twidth : '200px',\r\n\t\t\t\t\t\tplaceholder_text : \"请选择店铺\",\r\n\t\t\t\t\t\tno_results_text : \"抱歉，没有找到！\",\r\n\t\t\t\t\t\tallow_single_deselect : false,\r\n\t\t\t\t\t\tgetMatchedFn : getMatchedFn\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t},\r\n\t\t// 加载会员等级选择控件\r\n\t\tinitCardLevelComboOpts : function () {\r\n\t\t\tvar self = this,\r\n\t\t\t\tcardLevels = Hualala.TypeDef.MCMDataSet.EventCardLevels;\r\n\t\t\tvar renderCombo = function () {\r\n\t\t\t\tvar optTpl = self.get('comboOptsTpl'),\r\n\t\t\t\t\thtm = optTpl({\r\n\t\t\t\t\t\topts : cardLevels\r\n\t\t\t\t\t}),\r\n\t\t\t\t\t$combo = self.$queryBox.find('select[name=cardLevelID]');\r\n\t\t\t\t$combo.html(htm);\r\n\t\t\t};\r\n\t\t\tHualala.Global.getVipLevels({}, function (res) {\r\n\t\t\t\tif ($XP(res, 'resultcode') == '000') {\r\n\t\t\t\t\tvar _cardLevels = _.filter($XP(res, 'data.records', []), function (el) {\r\n\t\t\t\t\t\treturn $XP(el, 'isActive') == 1;\r\n\t\t\t\t\t});\r\n\t\t\t\t\tcardLevels = cardLevels.concat(_.map(_cardLevels, function (el) {\r\n\t\t\t\t\t\treturn {\r\n\t\t\t\t\t\t\tvalue : $XP(el, 'cardLevelID'),\r\n\t\t\t\t\t\t\tlabel : $XP(el, 'cardLevelName')\r\n\t\t\t\t\t\t};\r\n\t\t\t\t\t}));\r\n\t\t\t\t\trenderCombo();\r\n\t\t\t\t} else {\r\n\t\t\t\t\trenderCombo();\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t},\r\n\t\t// 加载中奖情况选择控件\r\n\t\tinitWinTypeComboOpts : function () {\r\n\t\t\tvar self = this,\r\n\t\t\t\twinTypes = null,\r\n\t\t\t\tlabel = '';\r\n\t\t\tvar eventDetail = self.$container.data('eventDetail');\r\n\t\t\tvar eventWay = $XP(eventDetail, 'eventWay');\r\n\t\t\tif (eventWay == '20') {\r\n\t\t\t\twinTypes = Hualala.TypeDef.MCMDataSet.WinTypes;\r\n\t\t\t\tlabel = \"中奖情况\";\r\n\t\t\t} else if (eventWay == '22') {\r\n\t\t\t\twinTypes = Hualala.TypeDef.MCMDataSet.JoinTypes;\r\n\t\t\t\tlabel = \"参与状态\";\r\n\t\t\t}\r\n\t\t\tif (IX.isEmpty(winTypes)) return;\r\n\t\t\twinTypes = _.map(winTypes, function (item) {\r\n\t\t\t\tvar value = $XP(item, 'value'), label = $XP(item, 'label');\r\n\t\t\t\treturn {\r\n\t\t\t\t\tvalue : value,\r\n\t\t\t\t\tlabel : label\r\n\t\t\t\t};\r\n\t\t\t});\r\n\t\t\tvar optTpl = self.get('comboOptsTpl'),\r\n\t\t\t\thtm = optTpl({\r\n\t\t\t\t\topts : winTypes\r\n\t\t\t\t}),\r\n\t\t\t\t$combo = self.$queryBox.find('select[name=winFlag]');\r\n\t\t\t$combo.html(htm);\r\n\t\t\t$combo.parents('.form-group').find('label').html(label);\r\n\t\t}\r\n\r\n\t});\r\n\r\n\r\n\tHualala.MCM.QueryView = QueryView;\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n})(jQuery, window);;(function ($, window) {\r\n\tIX.ns(\"Hualala.MCM\");\r\n\tvar popoverMsg = Hualala.UI.PopoverMsgTip,\r\n\t\ttoptip = Hualala.UI.TopTip;\r\n\r\n\tvar QueryController = Hualala.Shop.QueryController.subclass({\r\n\t\tconstructor : function (cfg) {\r\n\t\t\tthis.set({\r\n\t\t\t\tsessionData : Hualala.getSessionData()\r\n\t\t\t});\r\n\t\t\tthis.container = $XP(cfg, 'container', null);\r\n\t\t\tthis.resultController = $XP(cfg, 'resultController', null);\r\n\t\t\tthis.model = $XP(cfg, 'model', null);\r\n\t\t\tthis.view = $XP(cfg, 'view', null);\r\n\t\t\tif (!this.container || !this.model || !this.view || !this.resultController) {\r\n\t\t\t\tthrow(\"QueryController init faild!\");\r\n\t\t\t}\r\n\t\t\tthis.init();\r\n\t\t}\r\n\t});\r\n\r\n\tQueryController.proto({\r\n\t\t\r\n\t});\r\n\r\n\tHualala.MCM.QueryController = QueryController;\r\n\r\n})(jQuery, window);;(function ($, window) {\r\n\tIX.ns(\"Hualala.MCM\");\r\n\tvar HMCM = Hualala.MCM;\r\n\tvar popoverMsg = Hualala.UI.PopoverMsgTip,\r\n\t\ttoptip = Hualala.UI.TopTip,\r\n\t\tLoadingModal = Hualala.UI.LoadingModal;\r\n\r\n\t/**\r\n\t * 创建礼品向导步骤设置\r\n\t * @type {Array}\r\n\t */\r\n\tHMCM.GiftWizardCfg = [\r\n\t\t{id : \"gift_base_info\", label : \"基本信息\"},\r\n\t\t{id : \"gift_rule\", label : \"使用规则\"}\r\n\t];\r\n\r\n\t/**\r\n\t * 创建活动向导步骤设置\r\n\t * @type {Array}\r\n\t */\r\n\tHMCM.EventWizardCfg = [\r\n\t\t{id : \"event_base_info\", label : \"基本信息\"},\r\n\t\t{id : \"event_rule\", label : \"活动规则\"},\r\n\t\t{id : \"event_gift\", label : \"设置礼品、奖品\"},\r\n\t\t{id : \"event_on\", label : \"预览并启用\"}\r\n\t];\r\n\r\n\t/**\r\n\t * 向导步骤按钮设置\r\n\t * @type {Array}\r\n\t */\r\n\tHMCM.WizardCtrls = [\r\n\t\t{clz : 'btn-default btn-prev', name : 'prev', label : '上一步', loadingText : '请稍候...'},\r\n\t\t{clz : 'btn-default btn-cancel', name : 'cancel', label : '取消', loadingText : '取消'},\r\n\t\t{clz : 'btn-default btn-next', name : 'next', label : '下一步', loadingText : '请稍候...'},\r\n\t\t{clz : 'btn-default btn-finish', name : 'finish', label : '启用', loadingText : '提交中...'}\r\n\t];\r\n\r\n\tvar MCMWizardModal = Stapes.subclass({\r\n\t\t/**\r\n\t\t * 构造向导\r\n\t\t * @param  {Object} cfg 配置信息\r\n\t\t *         @param {obj} parentView 父级View层\r\n\t\t *         @param {String} mode 新建(create)|编辑(edit)模式\r\n\t\t *         @param {Function} successFn 成功回调 \r\n\t\t *         @param {Function} failFn 失败回调\r\n\t\t *         @param {Object} model 数据模型\r\n\t\t *         @param {String} modalClz 窗口样式类\r\n\t\t *         @param {String} wizardClz 向导控件样式类\r\n\t\t *         @param {String} modalTitle 窗口标题\r\n\t\t *         \r\n\t\t *         @param {Array} wizardStepsCfg 向导各个步骤的配置\r\n\t\t *         @param {Array} wizardCtrls 向导控制按钮配置\r\n\t\t *\r\n\t\t *         \r\n\t\t *         @param {Function} onWizardInit 当wizard init时，触发的事件\r\n\t\t *         @param {Function} onStepCommit 当wizard 步骤切换到下一步时，触发的事件\r\n\t\t *         @param {Function} onStepChange 当wizard 步骤变换时，触发的事件\r\n\t\t *         @param {Function} bundleWizardEvent 为向导绑定事件\r\n\t\t * @return {[type]}     [description]\r\n\t\t */\r\n\t\tconstructor : function (cfg) {\r\n\t\t\tthis.parentView = $XP(cfg, 'parentView');\r\n\t\t\tthis.mode = $XP(cfg, 'mode', 'create');\r\n\t\t\tthis.successFn = $XF(cfg, 'successFn');\r\n\t\t\tthis.faildFn = $XF(cfg, 'faildFn');\r\n\t\t\tthis.modal = null;\r\n\t\t\tthis.$body = null;\r\n\t\t\tthis.$wizard = null;\r\n\t\t\tthis.wizardID = \"mcm_wizard\";\r\n\t\t\tthis.wizardClz = $XP(cfg, 'wizardClz', '');\r\n\t\t\tthis.wizardStepsCfg = $XP(cfg, 'wizardStepsCfg', []);\r\n\t\t\tthis.wizardCtrls = $XP(cfg, 'wizardCtrls', []);\r\n\t\t\tthis.model = $XP(cfg, 'model', null);\r\n\t\t\tthis.modalClz = $XP(cfg, 'modalClz', '');\r\n\t\t\tthis.modalTitle = $XP(cfg, 'modalTitle', '');\r\n\t\t\tthis.stepViewHT = new IX.IListManager();\r\n\r\n\t\t\tthis.onWizardInit = $XF(cfg, 'onWizardInit');\r\n\t\t\tthis.onStepCommit = $XF(cfg, 'onStepCommit');\r\n\t\t\tthis.onStepChange = $XF(cfg, 'onStepChange');\r\n\r\n\t\t\tthis.bundleWizardEvent = $XF(cfg, 'bundleWizardEvent');\r\n\r\n\t\t\tthis.loadTemplates();\r\n\t\t\tthis.initModal();\r\n\t\t\tthis.renderWizardLayout();\r\n\t\t\tthis.initWizard();\r\n\t\t\tthis.enableGoToNextStep = false;\r\n\r\n\t\t\tthis.bundleWizardEvent.call(this);\r\n\r\n\t\t}\r\n\t});\r\n\r\n\tMCMWizardModal.proto({\r\n\t\tloadTemplates : function () {\r\n\t\t\tvar layoutTpl = Handlebars.compile(Hualala.TplLib.get('tpl_wizard_layout')),\r\n\t\t\t\tbtnTpl = Handlebars.compile(Hualala.TplLib.get('tpl_shop_modal_btns'));\r\n\t\t\tHandlebars.registerPartial(\"stepAction\", Hualala.TplLib.get('tpl_shop_modal_btns'));\r\n\t\t\t\r\n\t\t\tthis.set({\r\n\t\t\t\tlayoutTpl : layoutTpl,\r\n\t\t\t\tbtnTpl : btnTpl\r\n\t\t\t});\r\n\t\t},\r\n\t\tinitModal : function () {\r\n\t\t\tvar self = this;\r\n\t\t\tself.modal = new Hualala.UI.ModalDialog({\r\n\t\t\t\tid : \"mcm_wizard_modal\",\r\n\t\t\t\tclz : self.modalClz,\r\n\t\t\t\ttitle : self.modalTitle,\r\n\t\t\t\thideCloseBtn : true,\r\n\t\t\t\tbackdrop : 'static',\r\n\t\t\t\tshowFooter : false,\r\n\t\t\t\tafterHide : function () {\r\n\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\tself.$body = self.modal._.body;\r\n\t\t\tself.modal.show();\r\n\t\t},\r\n\t\tmapWizardLayoutData : function () {\r\n\t\t\tvar self = this,\r\n\t\t\t\tstepNavs = [],\r\n\t\t\t\tsteps = [];\r\n\t\t\tstepNavs = _.map(self.wizardStepsCfg, function (step, i) {\r\n\t\t\t\tsteps.push({\r\n\t\t\t\t\tid : $XP(step, 'id')\r\n\t\t\t\t});\r\n\t\t\t\treturn IX.inherit(step, {\r\n\t\t\t\t\tidx : (i + 1)\r\n\t\t\t\t});\r\n\t\t\t});\r\n\t\t\treturn {\r\n\t\t\t\tid : self.wizardID,\r\n\t\t\t\tclz : self.wizardClz,\r\n\t\t\t\tstepNavs : stepNavs,\r\n\t\t\t\tsteps : steps,\r\n\t\t\t\tbtns : self.wizardCtrls\r\n\t\t\t}\r\n\t\t},\r\n\t\trenderWizardLayout : function () {\r\n\t\t\tvar self = this;\r\n\t\t\tvar renderData = self.mapWizardLayoutData(),\r\n\t\t\t\tlayoutTpl = self.get('layoutTpl'),\r\n\t\t\t\thtm = layoutTpl(renderData);\r\n\t\t\tself.$body.html(htm);\r\n\t\t\tself.modal.show();\r\n\t\t},\r\n\t\tinitWizard : function () {\r\n\t\t\tvar self = this;\r\n\t\t\tself.$wizard = self.$body.find('#' + self.wizardID);\r\n\t\t\tself.$wizard.bsWizard({\r\n\t\t\t\ttabClass : 'tabClass',\r\n\t\t\t\tnextSelector : '.btn[name=next]',\r\n\t\t\t\tpreviousSelector : '.btn[name=prev]',\r\n\t\t\t\tfinishSelector : '.btn[name=finish]',\r\n\t\t\t\tonTabClick : function () {return false;},\r\n\t\t\t\tonInit : function ($wizard, $navBar, nIdx) {\r\n\t\t\t\t\t// 加载向导第一步的View层\r\n\t\t\t\t\tvar $tab = $('li:eq(' + nIdx + ')', self.$wizard),\r\n\t\t\t\t\t\tcntID = self.getTabContentIDByIndex($navBar, nIdx),\r\n\t\t\t\t\t\t$cnt = $('#' + cntID, self.$wizard);\r\n\t\t\t\t\tself.onWizardInit.call(self, $cnt, cntID, self.mode);\r\n\t\t\t\t},\r\n\t\t\t\t/**\r\n\t\t\t\t * fired next step button is clicked\r\n\t\t\t\t * @param  {jQueryObj} $curNav 当前步骤的导航标签\r\n\t\t\t\t * @param  {jQueryObj} $navBar 导航栏\r\n\t\t\t\t * @param  {Number} nIdx    下一步的索引值\r\n\t\t\t\t * @return {Boolean} false:不移动到下一步，true:移动到下一步\r\n\t\t\t\t *         \r\n\t\t\t\t */\r\n\t\t\t\tonNext : function ($curNav, $navBar, nIdx) {\r\n\t\t\t\t\tvar $curTab = $($curNav.find('a[data-toggle]').attr('href')),\r\n\t\t\t\t\t\tcurID = $curTab.attr('id');\r\n\t\t\t\t\tif (self.enableGoToNextStep == false) {\r\n\t\t\t\t\t\tself.onStepCommit.call(self, curID);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tvar ret = self.enableGoToNextStep;\r\n\t\t\t\t\tself.enableGoToNextStep = false;\r\n\t\t\t\t\treturn ret;\r\n\t\t\t\t},\r\n\t\t\t\t/**\r\n\t\t\t\t * fired previous step button is clicked\r\n\t\t\t\t * @param  {jQueryObj} $curNav 当前步骤的导航标签\r\n\t\t\t\t * @param  {jQueryObj} $navBar 导航栏\r\n\t\t\t\t * @param  {Number} nIdx    下一步的索引值\r\n\t\t\t\t * @return {Boolean}         false:不移动到下一步，true:移动到下一步\r\n\t\t\t\t */\r\n\t\t\t\tonPrevious : function ($curNav, $navBar, nIdx) {\r\n\t\t\t\t\tvar $curTab = $($curNav.find('a[data-toggle]').attr('href')),\r\n\t\t\t\t\t\tcurID = $curTab.attr('id');\r\n\t\t\t\t\treturn true;\r\n\t\t\t\t},\r\n\t\t\t\t/**\r\n\t\t\t\t * fired when a tab is changed\r\n\t\t\t\t * @param  {jQueryObj} $curNav 当前步骤的导航标签\r\n\t\t\t\t * @param  {jQueryObj} $navBar 导航栏\r\n\t\t\t\t * @param  {Number} nIdx    下一步的索引值\r\n\t\t\t\t * @param {Number} cIdx 当前步骤的索引\r\n\t\t\t\t * @return {Boolean} false:不移动到下一步，true:移动到下一步\r\n\t\t\t\t */\r\n\t\t\t\tonTabChange : function ($curNav, $navBar, cIdx, nIdx) {\r\n\t\t\t\t\tself.onStepChange.apply(self, arguments);\r\n\t\t\t\t},\r\n\t\t\t\t/**\r\n\t\t\t\t * fired when a tab is shown\r\n\t\t\t\t * @param  {jQueryObj} $curNav 当前步骤的导航标签\r\n\t\t\t\t * @param  {jQueryObj} $navBar 导航栏\r\n\t\t\t\t * @param {Number} cIdx 当前步骤的索引\r\n\t\t\t\t * @return {Boolean} false:不移动到下一步，true:移动到下一步\r\n\t\t\t\t */\r\n\t\t\t\tonTabShow : function ($curNav, $navBar, cIdx) {\r\n\r\n\t\t\t\t},\r\n\t\t\t\t/**\r\n\t\t\t\t * fired when finish button is clicked\r\n\t\t\t\t * @param  {jQueryObj} $curNav 当前步骤的导航标签\r\n\t\t\t\t * @param  {jQueryObj} $navBar 导航栏\r\n\t\t\t\t * @param {Number} cIdx 当前步骤的索引\r\n\t\t\t\t * @return {Boolean} false:不移动到下一步，true:移动到下一步\r\n\t\t\t\t */\r\n\t\t\t\tonFinish : function ($curNav, $navBar, cIdx) {\r\n\t\t\t\t\t// console.info('onFinish');\r\n\t\t\t\t\tvar $curTab = $($curNav.find('a[data-toggle]').attr('href')),\r\n\t\t\t\t\t\tcurID = $curTab.attr('id');\r\n\t\t\t\t\tself.onStepCommit.call(self, curID);\r\n\t\t\t\t}\r\n\r\n\t\t\t});\r\n\t\t},\r\n\t\tswitchWizardCtrlStatus : function (status) {\r\n\t\t\tvar self = this;\r\n\t\t\tself.$wizard.find('.wizard-ctrl .btn').button(status);\r\n\t\t},\r\n\t\tgetNextStep : function () {\r\n\t\t\tvar self = this;\r\n\t\t\tself.enableGoToNextStep = true;\r\n\t\t\tself.$wizard.bsWizard('next');\r\n\t\t},\r\n\t\tgetPrevieousStep : function () {\r\n\t\t\tvar self = this;\r\n\t\t\tself.enableGoToNextStep = true;\r\n\t\t\tself.$wizard.bsWizard('previeous');\r\n\t\t},\r\n\t\tgetTabContentIDByIndex : function ($navBar, idx) {\r\n\t\t\tvar $tab = $('li:eq(' + idx + ')', $navBar),\r\n\t\t\t\tid = $tab.find('a[data-toggle]').attr('href').replace('#', '');\r\n\t\t\treturn id;\r\n\t\t},\r\n\t\tregisterStepView : function (cntID, stepView) {\r\n\t\t\tvar self = this;\r\n\t\t\tself.stepViewHT.register(cntID, stepView);\r\n\t\t},\r\n\t\tgetStepView : function (cntID) {\r\n\t\t\treturn this.stepViewHT.get(cntID);\r\n\t\t},\r\n\t\tswitchViewMode : function (mode) {\r\n\t\t\tthis.mode = mode;\r\n\t\t}\r\n\t});\r\n\r\n\tHMCM.MCMWizardModal = MCMWizardModal;\r\n\t\r\n\r\n})(jQuery, window);;(function ($, window) {\r\n\tIX.ns(\"Hualala.MCM\");\r\n\tvar HMCM = Hualala.MCM;\r\n\tvar popoverMsg = Hualala.UI.PopoverMsgTip,\r\n\t\ttoptip = Hualala.UI.TopTip;\r\n\r\n\tvar giftEffectTimeHours = Hualala.Common.getMinuteIntervalOptions({\r\n\t\tstartLabel : '立即生效',\r\n\t\tend : Hualala.Constants.SecondsOfDay / 60\r\n\t});\r\n\r\n\tvar GiftSetFormElsCfg = {\r\n\t\tgiftItemID : {\r\n\t\t\ttype : \"hidden\",\r\n\t\t\tdefaultVal : \"\"\r\n\t\t},\r\n\t\tgiftType : {\r\n\t\t\ttype : \"combo\",\r\n\t\t\tlabel : \"礼品类型\",\r\n\t\t\tdefaultVal : \"10\",\r\n\t\t\toptions : _.reject(Hualala.TypeDef.MCMDataSet.GiftTypes, function (el) {\r\n\t\t\t\treturn IX.isEmpty($XP(el, 'value'));\r\n\t\t\t}),\r\n\t\t\tvalidCfg : {\r\n\t\t\t\tvalidators : {\r\n\t\t\t\t\tnotEmpty : {\r\n\t\t\t\t\t\tmessage : \"请选择礼品类型\"\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\tgiftValue : {\r\n\t\t\ttype : \"text\",\r\n\t\t\tlabel : \"礼品价值\",\r\n\t\t\tdefaultVal : \"\",\r\n\t\t\tprefix : '￥',\r\n\t\t\tsurfix : '元',\r\n\t\t\tvalidCfg : {\r\n\t\t\t\tvalidators : {\r\n\t\t\t\t\tnotEmpty : {\r\n\t\t\t\t\t\tmessage : \"请输入礼品价值\"\r\n\t\t\t\t\t},\r\n\t\t\t\t\tnumeric : {\r\n\t\t\t\t\t\tmessage : \"礼品价值必须为数字\"\r\n\t\t\t\t\t},\r\n\t\t\t\t\tgreaterThan : {\r\n\t\t\t\t\t\tinclusive : false,\r\n\t\t\t\t\t\tvalue : 0,\r\n\t\t\t\t\t\tmessage : \"礼品价值必须大于0\"\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\tgiftName : {\r\n\t\t\ttype : \"text\",\r\n\t\t\tlabel : \"礼品名称\",\r\n\t\t\tdefaultVal : \"\",\r\n\t\t\tvalidCfg : {\r\n\t\t\t\tvalidators : {\r\n\t\t\t\t\tnotEmpty : {\r\n\t\t\t\t\t\tmessage : \"礼品名称不能为空\"\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\tgiftRemark : {\r\n\t\t\ttype : \"textarea\",\r\n\t\t\tlabel : \"礼品描述\",\r\n\t\t\tdefaultVal : \"\",\r\n\t\t\tvalidCfg : {\r\n\t\t\t\tvalidators : {\r\n\t\t\t\t\tnotEmpty : {\r\n\t\t\t\t\t\tmessage : \"礼品描述不能为空\"\r\n\t\t\t\t\t}\t\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\tvalidityDays : {\r\n\t\t\ttype : \"text\",\r\n\t\t\tlabel : \"有效天数\",\r\n\t\t\tdefaultVal : \"30\",\r\n\t\t\tsurfix : '天',\r\n\t\t\tvalidCfg : {\r\n\t\t\t\tvalidators : {\r\n\t\t\t\t\tnotEmpty : {\r\n\t\t\t\t\t\tmessage : \"请输入有效天数\"\r\n\t\t\t\t\t},\r\n\t\t\t\t\tnumeric : {\r\n\t\t\t\t\t\tmessage : \"有效天数必须为数字\"\r\n\t\t\t\t\t},\r\n\t\t\t\t\tinteger : {\r\n\t\t\t\t\t\tmessage : \"有效天数必须是整数\"\r\n\t\t\t\t\t},\r\n\t\t\t\t\tbetween : {\r\n\t\t\t\t\t\tinclusive : false,\r\n\t\t\t\t\t\tmin : 0,\r\n\t\t\t\t\t\tmax : 10000,\r\n\t\t\t\t\t\tmessage : \"礼品价值必须在0到10000天之间\"\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\tegiftEffectTimeHours : {\r\n\t\t\ttype : \"combo\",\r\n\t\t\tlabel : \"生效时间\",\r\n\t\t\tdefaultVal : \"0\",\r\n\t\t\toptions : _.reduce(giftEffectTimeHours, function (memo, el, i) {\r\n\t\t\t\tif (i == 1) {\r\n\t\t\t\t\tmemo = [memo];\r\n\t\t\t\t}\r\n\t\t\t\treturn el.value >= 180 ? memo.concat(el) : memo;\r\n\t\t\t}),\r\n\t\t\tvalidCfg : {\r\n\t\t\t\tvalidators : {}\r\n\t\t\t}\r\n\t\t},\r\n\t\tisHolidaysUsing : {\r\n\t\t\ttype : \"radiogrp\",\r\n\t\t\tlabel : \"节假日是否可用\",\r\n\t\t\tdefaultVal : \"0\",\r\n\t\t\toptions : Hualala.TypeDef.MCMDataSet.GiftIsHolidayUsing,\r\n\t\t\tvalidCfg : {\r\n\t\t\t\tvalidators : {}\r\n\t\t\t}\r\n\t\t},\r\n\t\tusingTimeType : {\r\n\t\t\ttype : \"checkboxgrp\",\r\n\t\t\tlabel : \"使用时段\",\r\n\t\t\tdefaultVal : \"1,2,3,4,5\",\r\n\t\t\toptions : Hualala.TypeDef.MCMDataSet.GiftUsingTimeTypes,\r\n\t\t\tvalidCfg : {\r\n\t\t\t\tvalidators : {\r\n\t\t\t\t\tnotEmpty : {\r\n\t\t\t\t\t\tmessage : \"请选择使用时段\"\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\tfoodScope : {\r\n\t\t\ttype : \"radiogrp\",\r\n\t\t\tlabel : \"菜谱范围\",\r\n\t\t\tdefaultVal : \"0\",\r\n\t\t\toptions : Hualala.TypeDef.MCMDataSet.GiftFoodScope,\r\n\t\t\tvalidCfg : {\r\n\t\t\t}\r\n\r\n\t\t},\r\n\t\tsupportOrderType : {\r\n\t\t\ttype : \"combo\",\r\n\t\t\tlabel : \"业务支持\",\r\n\t\t\tdefaultVal : \"2\",\r\n\t\t\toptions : Hualala.TypeDef.MCMDataSet.GiftSupportOrderTypes,\r\n\t\t\tvalidCfg : {\r\n\t\t\t\tvalidators : {}\r\n\t\t\t}\r\n\t\t},\r\n\t\tisOfflineCanUsing : {\r\n\t\t\ttype : \"radiogrp\",\r\n\t\t\tlabel : \"到店使用\",\r\n\t\t\tdefaultVal : \"0\",\r\n\t\t\toptions : Hualala.TypeDef.MCMDataSet.GiftIsOfflineUsing,\r\n\t\t\tvalidCfg : {\r\n\t\t\t\tvalidators : {}\r\n\t\t\t}\r\n\t\t},\r\n\t\tmoneyLimitType : {\r\n\t\t\ttype : \"combo\",\r\n\t\t\tlabel : \"金额限制\",\r\n\t\t\tdefaultVal : \"0\",\r\n\t\t\toptions : Hualala.TypeDef.MCMDataSet.GiftMonetaryLimitTypes,\r\n\t\t\tvalidCfg : {\r\n\t\t\t\tvalidators : {}\r\n\t\t\t}\r\n\t\t},\r\n\t\tmoenyLimitValue : {\r\n\t\t\ttype : \"text\",\r\n\t\t\tlabel : \"\",\r\n\t\t\tdefaultVal : \"100\",\r\n\t\t\tprefix : '￥',\r\n\t\t\tsurfix : '元，使用一张',\r\n\t\t\tvalidCfg : {\r\n\t\t\t\tvalidators : {\r\n\t\t\t\t\tnotEmpty : {\r\n\t\t\t\t\t\tmessage : \"请输入限制金额\"\r\n\t\t\t\t\t},\r\n\t\t\t\t\tnumeric : {\r\n\t\t\t\t\t\tmessage : \"限制金额必须为数字\"\r\n\t\t\t\t\t},\r\n\t\t\t\t\tgreaterThan : {\r\n\t\t\t\t\t\tinclusive : false,\r\n\t\t\t\t\t\tvalue : 0,\r\n\t\t\t\t\t\tmessage : \"现值金额必须大于0\"\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\tshopNames : {\r\n\t\t\ttype : \"selectShops\",\r\n\t\t\tlabel : \"可使用店铺\",\r\n\t\t\tdefaultVal : \"所有店铺适用\"\r\n\t\t}\r\n\r\n\t};\r\n\tvar GiftSetFormElsHT = new IX.IListManager();\r\n\t_.each(GiftSetFormElsCfg, function (el, k) {\r\n\t\tvar type = $XP(el, 'type');\r\n\t\tvar labelClz = 'col-sm-offset-1 col-sm-3 control-label';\r\n\t\tif (type == 'radiogrp' || type == 'checkboxgrp') {\r\n\t\t\tvar ops = _.map($XP(el, 'options'), function (op) {\r\n\t\t\t\treturn IX.inherit(op, {\r\n\t\t\t\t\tid : k + '_' + IX.id(),\r\n\t\t\t\t\tname : k,\r\n\t\t\t\t\tclz : (type == 'radiogrp' ? ' radio-inline' : ' checkbox-inline')\r\n\t\t\t\t});\r\n\t\t\t});\r\n\t\t\tGiftSetFormElsHT.register(k, IX.inherit(el, {\r\n\t\t\t\tid : k + '_' + IX.id(),\r\n\t\t\t\toptions : ops,\r\n\t\t\t\tlabelClz : labelClz,\r\n\t\t\t\tclz : 'col-sm-7'\r\n\t\t\t}));\r\n\t\t} else if (type == 'selectShops') {\r\n\t\t\tGiftSetFormElsHT.register(k, IX.inherit(el, {\r\n\t\t\t\tid : k + '_' + IX.id(),\r\n\t\t\t\tname : k,\r\n\t\t\t\tlabelClz : labelClz,\r\n\t\t\t\tclz : 'col-sm-7'\r\n\t\t\t}));\r\n\t\t} else {\r\n\t\t\tGiftSetFormElsHT.register(k, IX.inherit(el, {\r\n\t\t\t\tid : k + '_' + IX.id(),\r\n\t\t\t\tname : k,\r\n\t\t\t\tlabelClz : labelClz,\r\n\t\t\t\tclz : 'col-sm-5'\r\n\t\t\t}));\r\n\t\t}\r\n\t});\r\n\r\n\tHMCM.GiftSetFormElsHT = GiftSetFormElsHT;\r\n\r\n\tvar getGiftTypeSet = function (giftType) {\r\n\t\tvar giftTypes = Hualala.TypeDef.MCMDataSet.GiftTypes;\r\n\t\treturn _.find(giftTypes, function (el) {\r\n\t\t\treturn $XP(el, 'value') == giftType;\r\n\t\t});\r\n\t};\r\n\tHMCM.getGiftTypeSet = getGiftTypeSet;\r\n\r\n\t/**\r\n\t * 整理礼品基本信息表单渲染数据\r\n\t * @return {[type]} [description]\r\n\t */\r\n\tvar mapGiftBaseInfoFormElsData = function () {\r\n\t\tvar self = this,\r\n\t\t\tformKeys = self.formKeys;\r\n\t\tvar ret = _.map(formKeys, function (key) {\r\n\t\t\tvar elCfg = GiftSetFormElsHT.get(key),\r\n\t\t\t\ttype = $XP(elCfg, 'type');\r\n\t\t\tif (type == 'combo') {\r\n\t\t\t\tvar v = self.model.get(key) || $XP(elCfg, 'dafaultVal'),\r\n\t\t\t\t\toptions = _.map($XP(elCfg, 'options'), function (op) {\r\n\t\t\t\t\t\treturn IX.inherit(op, {\r\n\t\t\t\t\t\t\tselected : $XP(op, 'value') == v ? 'selected' : ''\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t});\r\n\t\t\t\treturn IX.inherit(elCfg, {\r\n\t\t\t\t\tdisabled : (self.mode == 'edit' && key == 'giftType') ? 'disabled' : '',\r\n\t\t\t\t\tvalue : v,\r\n\t\t\t\t\toptions : options\r\n\t\t\t\t});\r\n\t\t\t} if (type == 'text' && key == 'giftName') {\r\n\t\t\t\tvar groupName = $XP(Hualala.getSessionSite(), 'groupName', ''),\r\n\t\t\t\t\tgiftType = self.model.get('giftType') || $XP(GiftSetFormElsHT.get('giftType'), 'defaultVal'),\r\n\t\t\t\t\tgiftLabel = $XP(getGiftTypeSet(giftType), 'label');\r\n\t\t\t\treturn IX.inherit(elCfg, {\r\n\t\t\t\t\tvalue : groupName + giftLabel,\r\n\t\t\t\t\tdisabled : 'disabled'\r\n\t\t\t\t});\r\n\t\t\t} if (type == 'text' && key == 'giftValue') {\r\n\t\t\t\treturn IX.inherit(elCfg, {\r\n\t\t\t\t\tvalue : self.model.get(key) || $XP(elCfg, 'dafaultVal'),\r\n\t\t\t\t\tdisabled : (self.mode == 'edit') ? 'disabled' : ''\r\n\t\t\t\t});\r\n\t\t\t} else {\r\n\t\t\t\treturn IX.inherit(elCfg, {\r\n\t\t\t\t\tvalue : self.model.get(key) || $XP(elCfg, 'dafaultVal')\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t});\r\n\t\treturn ret;\r\n\t};\r\n\r\n\tvar GiftBaseInfoFormKeys = 'giftItemID,giftType,giftValue,giftName,giftRemark'.split(',');\r\n\r\n\tvar GiftBaseInfoStepView = Stapes.subclass({\r\n\t\tconstructor : function (cfg) {\r\n\t\t\tthis.mode = $XP(cfg, 'mode', '');\r\n\t\t\tthis.container = $XP(cfg, 'container', '');\r\n\t\t\tthis.parentView = $XP(cfg, 'parentView');\r\n\t\t\tthis.model = $XP(cfg, 'model');\r\n\t\t\tthis.successFn = $XF(cfg, 'successFn');\r\n\t\t\tthis.failFn = $XF(cfg, 'failFn');\r\n\r\n\t\t\tthis.mapFormElsData = $XF(cfg, 'mapFormElsData');\r\n\t\t\tif (!this.model || !this.parentView) {\r\n\t\t\t\tthrow(\"Gift Base Info View init faild!\");\r\n\t\t\t}\r\n\r\n\t\t\tthis.loadTemplates();\r\n\t\t\tthis.initBaseCfg();\r\n\t\t\tthis.formParams = this.model.getAll();\r\n\t\t\tthis.renderForm();\r\n\t\t\tthis.initUIComponents();\r\n\t\t\tthis.bindEvent();\r\n\t\t}\r\n\t});\r\n\tGiftBaseInfoStepView.proto({\r\n\t\tloadTemplates : function () {\r\n\t\t\tvar layoutTpl = Handlebars.compile(Hualala.TplLib.get('tpl_mcm_base_form')),\r\n\t\t\t\tbtnTpl = Handlebars.compile(Hualala.TplLib.get('tpl_shop_modal_btns'));\r\n\t\t\tHandlebars.registerHelper('checkFormElementType', function (conditional, options) {\r\n\t\t\t\treturn (conditional == options.hash.type) ? options.fn(this) : options.inverse(this);\r\n\t\t\t});\r\n\t\t\tHandlebars.registerHelper('isInputGroup', function (prefix, surfix, options) {\r\n\t\t\t\treturn (!prefix && !surfix) ? options.inverse(this) : options.fn(this);\r\n\t\t\t});\r\n\t\t\tthis.set({\r\n\t\t\t\tlayoutTpl : layoutTpl,\r\n\t\t\t\tbtnTpl : btnTpl\r\n\t\t\t});\r\n\t\t},\r\n\t\tinitBaseCfg : function () {\r\n\t\t\tthis.formKeys = GiftBaseInfoFormKeys;\r\n\t\t},\r\n\t\trenderForm : function () {\r\n\t\t\tvar self = this,\r\n\t\t\t\trenderData = self.mapFormElsData.call(self),\r\n\t\t\t\ttpl = self.get('layoutTpl'),\r\n\t\t\t\tbtnTpl = self.get('btnTpl'),\r\n\t\t\t\thtm = tpl({\r\n\t\t\t\t\tformClz : 'wizard-step-form form-feedback-out',\r\n\t\t\t\t\titems : renderData\r\n\t\t\t\t});\r\n\t\t\tself.container.html(htm);\r\n\t\t},\r\n\t\tinitUIComponents : function () {\r\n\r\n\t\t},\r\n\t\tbindEvent : function () {\r\n\t\t\tvar self = this,\r\n\t\t\t\tfvOpts = self.initValidFieldOpts();\r\n\t\t\tself.container.find('form').bootstrapValidator({\r\n\t\t\t\ttrigger : 'blur',\r\n\t\t\t\tfields : fvOpts\r\n\t\t\t}).on('error.field.bv', function (e, data) {\r\n\t\t\t\tvar $form = $(e.target),\r\n\t\t\t\t\tbv = $form.data('bootstrapValidator');\r\n\t\t\t\tself.failFn(self.model);\r\n\t\t\t}).on('success.form.bv', function (e, data) {\r\n\t\t\t\te.preventDefault();\r\n\t\t\t\tvar $form = $(e.target),\r\n\t\t\t\t\tbv = $form.data('bootstrapValidator');\r\n\t\t\t\tvar act = self.mode + 'Gift';\r\n\t\t\t\tvar formParams = self.serializeForm();\r\n\t\t\t\tIX.Debug.info(\"DEBUG: Gift Wizard Form Params:\");\r\n\t\t\t\tIX.Debug.info(formParams);\r\n\t\t\t\t// self.model.emit(act, {\r\n\t\t\t\t// \tparams : formParams,\r\n\t\t\t\t// \tfailFn : function () {\r\n\t\t\t\t// \t\tself.failFn.call(self);\r\n\t\t\t\t// \t},\r\n\t\t\t\t// \tsuccessFn : function () {\r\n\t\t\t\t// \t\tself.successFn.call(self);\r\n\r\n\t\t\t\t// \t}\r\n\t\t\t\t// });\r\n\t\t\t\tself.model.emit('saveCache', {\r\n\t\t\t\t\tparams : formParams,\r\n\t\t\t\t\tfailFn : function () {\r\n\t\t\t\t\t\tself.failFn.call(self);\r\n\t\t\t\t\t},\r\n\t\t\t\t\tsuccessFn : function () {\r\n\t\t\t\t\t\tself.successFn.call(self);\r\n\r\n\t\t\t\t\t}\r\n\t\t\t\t})\r\n\t\t\t});\r\n\r\n\t\t\tself.container.on('change', 'select[name=giftType]', function (e) {\r\n\t\t\t\tvar $select = $(this),\r\n\t\t\t\t\tgiftType = $select.val();\r\n\t\t\t\tvar $giftValue = $(':text[name=giftValue]', self.container);\r\n\t\t\t\tvar $giftValueLabel = $giftValue.parents('.form-group').find('> label');\r\n\t\t\t\t$giftValueLabel.text(giftType == 42 ? '积分点数' : '礼品价值');\r\n\t\t\t\t\r\n\t\t\t\tself.container.find(':text[name=giftName]').trigger('change');\r\n\r\n\t\t\t});\r\n\t\t\tself.container.on('change', ':text[name=giftValue]', function (e) {\r\n\t\t\t\tvar $txt = $(this),\r\n\t\t\t\t\tval = $txt.val();\r\n\t\t\t\t// if (isNaN(val)) $txt.val('');\r\n\t\t\t\t\r\n\t\t\t\t!isNaN(val) && self.container.find(':text[name=giftName]').trigger('change');\t\t\t\t\r\n\t\t\t});\r\n\t\t\tself.container.on('change', ':text[name=giftName]', function (e) {\r\n\t\t\t\tvar $txt = $(this),\r\n\t\t\t\t\tgiftValue = $(':text[name=giftValue]', self.container).val(),\r\n\t\t\t\t\tgiftType = $('select[name=giftType]', self.container).val(),\r\n\t\t\t\t\tgiftTypeSet = getGiftTypeSet(giftType);\r\n\t\t\t\t\tgroupName = $XP(Hualala.getSessionSite(), 'groupName', ''),\r\n\t\t\t\t\tval = groupName + giftValue \r\n\t\t\t\t\t\t+ (IX.isEmpty(giftValue) ? '' : $XP(giftTypeSet, 'unit'))\r\n\t\t\t\t\t\t+ $XP(giftTypeSet, 'label', '');\r\n\t\t\t\t$txt.val(val);\r\n\t\t\t});\r\n\t\t},\r\n\t\tinitValidFieldOpts : function () {\r\n\t\t\tvar self = this,\r\n\t\t\t\tformKeys = _.reject(self.formKeys, function (k) {return k == 'giftItemID'}),\r\n\t\t\t\tret = {};\r\n\t\t\t_.each(formKeys, function (key) {\r\n\t\t\t\tvar elCfg = GiftSetFormElsHT.get(key),\r\n\t\t\t\t\ttype = $XP(elCfg, 'type');\r\n\t\t\t\tret[key] = $XP(elCfg, 'validCfg', {});\r\n\t\t\t});\r\n\t\t\treturn ret;\r\n\t\t},\r\n\t\tserializeForm : function () {\r\n\t\t\tvar self = this,\r\n\t\t\t\tformKeys = self.formKeys,\r\n\t\t\t\tret = {},\r\n\t\t\t\tformEls = _.map(formKeys, function (key) {\r\n\t\t\t\t\tvar elCfg = GiftSetFormElsHT.get(key),\r\n\t\t\t\t\t\ttype = $XP(elCfg, 'type');\r\n\t\t\t\t\tret[key] = $('[name=' + key + ']', self.container).val();\r\n\t\t\t\t});\r\n\t\t\treturn ret;\r\n\t\t}\r\n\t});\r\n\r\n\tHMCM.GiftBaseInfoStepView = GiftBaseInfoStepView;\r\n\r\n\t/**\r\n\t * 创建向导中礼品基本信息步骤\r\n\t * @param  {[type]} $cnt       [description]\r\n\t * @param  {[type]} cntID      [description]\r\n\t * @param  {[type]} wizardMode [description]\r\n\t * @return {[type]}            [description]\r\n\t */\r\n\tHMCM.initGiftBaseInfoStep = function ($cnt, cntID, wizardMode) {\r\n\t\tvar wizardModalView = this,\r\n\t\t\tstepView = new HMCM.GiftBaseInfoStepView({\r\n\t\t\t\tmode : wizardMode,\r\n\t\t\t\tcontainer : $cnt,\r\n\t\t\t\tparentView : wizardModalView,\r\n\t\t\t\tmodel : wizardModalView.model,\r\n\t\t\t\tsuccessFn : function () {\r\n\t\t\t\t\tvar self = this;\r\n\t\t\t\t\tself.parentView.switchWizardCtrlStatus('reset');\r\n\t\t\t\t\tself.parentView.getNextStep();\r\n\t\t\t\t},\r\n\t\t\t\tfailFn : function () {\r\n\t\t\t\t\tvar self = this;\r\n\t\t\t\t\tself.parentView.switchWizardCtrlStatus('reset');\r\n\t\t\t\t},\r\n\t\t\t\tmapFormElsData : mapGiftBaseInfoFormElsData\r\n\t\t\t});\r\n\t\twizardModalView.registerStepView(cntID, stepView);\r\n\t};\r\n\r\n\t/**\r\n\t * 当礼品向导步骤变化时触发的事件\r\n\t * @param  {[type]} $curNav [description]\r\n\t * @param  {[type]} $navBar [description]\r\n\t * @param  {[type]} cIdx    [description]\r\n\t * @param  {[type]} nIdx    [description]\r\n\t * @return {[type]}         [description]\r\n\t */\r\n\tHMCM.onGiftWizardStepChange = function ($curNav, $navBar, cIdx, nIdx) {\r\n\t\tvar wizardModalView = this;\r\n\t\tvar curID = wizardModalView.getTabContentIDByIndex($navBar, cIdx),\r\n\t\t\tnextID = wizardModalView.getTabContentIDByIndex($navBar, nIdx),\r\n\t\t\t$nextCnt = $('#' + nextID, wizardModalView.$wizard),\r\n\t\t\tnextView = wizardModalView.getStepView(nextID);\r\n\t\tif (cIdx == -1 && nIdx == 0) return true;\r\n\t\tif (!nextView) {\r\n\t\t\tnIdx == 1 && HMCM.initGiftRuleStep.call(wizardModalView, $nextCnt, nextID, wizardModalView.mode);\r\n\t\t\tnIdx == 0 && HMCM.initGiftBaseInfoStep.call(wizardModalView, $nextCnt, nextID, wizardModalView.mode);\r\n\t\t}\r\n\t\treturn true;\r\n\t};\r\n\r\n\t/**\r\n\t * 当礼品向导步骤提交时触发的事件\r\n\t * @param  {[type]} curID [description]\r\n\t * @return {[type]}       [description]\r\n\t */\r\n\tHMCM.onGiftWizardStepCommit = function (curID) {\r\n\t\tvar wizardModalView = this,\r\n\t\t\tstepView = wizardModalView.getStepView(curID),\r\n\t\t\t$cnt = stepView.container,\r\n\t\t\t$form = $cnt.find('form'),\r\n\t\t\tbv = $form.data('bootstrapValidator');\r\n\t\twizardModalView.switchWizardCtrlStatus('loading');\r\n\t\tbv.validate();\r\n\t};\r\n\r\n\t/**\r\n\t * 绑定礼品向导的事件\r\n\t * @return {[type]} [description]\r\n\t */\r\n\tHMCM.bundleGiftWizardEvent = function () {\r\n\t\tvar wizardModalView = this;\r\n\t\twizardModalView.$wizard.find('.wizard-ctrl .btn-cancel').on('click', function (e) {\r\n\t\t\tvar $btn = $(this);\r\n\t\t\tvar curIdx = wizardModalView.$wizard.bsWizard('currentIndex'), \r\n\t\t\t\tcntID = wizardModalView.getTabContentIDByIndex(wizardModalView.$wizard.find('.wizard-nav'), curIdx),\r\n\t\t\t\tstepView = wizardModalView.stepViewHT.get(cntID);\r\n\t\t\tvar accountID = wizardModalView.model.get('accountID');\r\n\t\t\tif (!accountID && curIdx == 0) {\r\n\t\t\t\twizardModalView.modal.hide();\r\n\t\t\t} else {\r\n\t\t\t\tHualala.UI.Confirm({\r\n\t\t\t\t\ttitle : '取消创建礼品',\r\n\t\t\t\t\tmsg : '是否取消创建礼品的操作？<br/>之前的操作将不生效！',\r\n\t\t\t\t\tokLabel : '确定',\r\n\t\t\t\t\tokFn : function () {\r\n\t\t\t\t\t\twizardModalView.modal.hide();\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t});\r\n\t};\r\n})(jQuery, window);;(function ($, window) {\r\n\tIX.ns(\"Hualala.MCM\");\r\n\tvar HMCM = Hualala.MCM;\r\n\tvar popoverMsg = Hualala.UI.PopoverMsgTip,\r\n\t\ttoptip = Hualala.UI.TopTip;\r\n\tvar GiftSetFormElsHT = HMCM.GiftSetFormElsHT;\r\n\r\n\tvar GiftRuleFormKeys = 'giftItemID,validityDays,egiftEffectTimeHours,isHolidaysUsing,usingTimeType,foodScope,supportOrderType,isOfflineCanUsing,moneyLimitType,moenyLimitValue,shopNames'.split(',');\r\n\r\n\t/**\r\n\t * 整理礼品规则表单渲染数据\r\n\t * @return {[type]} [description]\r\n\t */\r\n\tvar mapGiftRuleFormElsData = function () {\r\n\t\tvar self = this,\r\n\t\t\tformKeys = self.formKeys;\r\n\t\tvar ret = _.map(formKeys, function (key) {\r\n\t\t\tvar elCfg = GiftSetFormElsHT.get(key),\r\n\t\t\t\ttype = $XP(elCfg, 'type');\r\n\t\t\tif (type == 'combo') {\r\n\t\t\t\tvar v = self.model.get(key) || $XP(elCfg, 'defaultVal'),\r\n\t\t\t\t\toptions = _.map($XP(elCfg, 'options'), function (op) {\r\n\t\t\t\t\t\treturn IX.inherit(op, {\r\n\t\t\t\t\t\t\tselected : $XP(op, 'value') == v ? 'selected' : ''\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t});\r\n\t\t\t\treturn IX.inherit(elCfg, {\r\n\t\t\t\t\tdisabled : (self.mode == 'edit' && key == 'giftType') ? 'disabled' : '',\r\n\t\t\t\t\tvalue : v,\r\n\t\t\t\t\toptions : options\r\n\t\t\t\t});\r\n\t\t\t} else if (type == 'radiogrp' || type == 'checkboxgrp') {\r\n\t\t\t\tvar v = self.model.get(key) || $XP(elCfg, 'defaultVal');\r\n\t\t\t\tif (type == 'checkboxgrp') {\r\n\t\t\t\t\tv = v.split(',');\r\n\t\t\t\t}\r\n\t\t\t\tvar options = _.map($XP(elCfg, 'options'), function (op) {\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tvar checked = type == 'checkboxgrp' ? (_.contains(v, $XP(op, 'value') + '') ? true : false) : ($XP(op, 'value') == v);\r\n\t\t\t\t\t\treturn IX.inherit(op, {\r\n\t\t\t\t\t\t\tchecked : checked ? 'checked' : ''\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t});\r\n\t\t\t\treturn IX.inherit(elCfg, {\r\n\t\t\t\t\toptions : options\r\n\t\t\t\t});\r\n\t\t\t} else {\r\n\t\t\t\treturn IX.inherit(elCfg, {\r\n\t\t\t\t\tvalue : self.model.get(key) || $XP(elCfg, 'defaultVal')\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t});\r\n\t\treturn ret;\r\n\t};\r\n\r\n\tvar GiftRuleStepView = HMCM.GiftBaseInfoStepView.subclass({\r\n\t\tconstructor : HMCM.GiftBaseInfoStepView.prototype.constructor\r\n\t});\r\n\tGiftRuleStepView.proto({\r\n\t\tinitBaseCfg : function () {\r\n\t\t\tif (this.model.get('giftType') == 10) {\r\n\t\t\t\tthis.formKeys = GiftRuleFormKeys;\r\n\t\t\t} else {\r\n\t\t\t\tthis.formKeys = [];\r\n\t\t\t}\r\n\t\t\t\r\n\t\t},\r\n\t\tinitUIComponents : function () {\r\n\t\t\tvar self = this,\r\n\t\t\t\tmoneyLimitType = self.model.get('moneyLimitType') || 0,\r\n\t\t\t\t$moenyLimitValue = $(':text[name=moenyLimitValue]'),\r\n\t\t\t\t$inputGrp = $moenyLimitValue.parents('.form-group');\r\n\t\t\tvar shopNames = self.model.get('shopNames') || '',\r\n\t\t\t\tshopIDs = self.model.get('shopIDs') || '';\r\n\t\t\t$inputGrp[moneyLimitType == 0 ? 'addClass' : 'removeClass']('hidden');\r\n\t\t\tself.chooseShop = new HMCM.ChooseShopModal({\r\n\t\t\t\tparentView : self,\r\n\t\t\t\ttrigger : self.container.find('div[name=shopNames]'),\r\n\t\t\t\tmodalTitle : \"选择店铺\",\r\n\t\t\t\tmodalClz : \"choose-shop-modal\",\r\n\t\t\t\tchosenShopNames : shopNames || '不限店铺',\r\n\t\t\t\tchosenShopIDs : IX.isEmpty(shopIDs) ? null : shopIDs.split(';')\r\n\t\t\t});\r\n\t\t},\r\n\t\trenderForm : function () {\r\n\t\t\tvar self = this,\r\n\t\t\t\tgiftType = self.model.get('giftType'),\r\n\t\t\t\trenderData = self.mapFormElsData.call(self),\r\n\t\t\t\ttpl = self.get('layoutTpl'),\r\n\t\t\t\tbtnTpl = self.get('btnTpl'),\r\n\t\t\t\thtm = tpl({\r\n\t\t\t\t\tformClz : 'wizard-step-form form-feedback-out',\r\n\t\t\t\t\titems : renderData\r\n\t\t\t\t});\r\n\t\t\tself.container.html(htm);\r\n\t\t\tif (giftType == 40) {\r\n\t\t\t\tself.container.append('<p>顾客在获取会员充值类礼品后，将直接充入其会员储值余额账户中！');\r\n\t\t\t} else if (giftType == 42) {\r\n\t\t\t\tself.container.append('<p>顾客在获取会员积分类礼品后，将直接充入其会员积分余额账户中！');\r\n\t\t\t}\r\n\t\t\t\r\n\t\t},\r\n\t\tbindEvent : function () {\r\n\t\t\tvar self = this,\r\n\t\t\t\tfvOpts = self.initValidFieldOpts();\r\n\t\t\tself.container.find('form').bootstrapValidator({\r\n\t\t\t\ttrigger : 'blur',\r\n\t\t\t\tfields : fvOpts\r\n\t\t\t}).on('error.field.bv', function (e, data) {\r\n\t\t\t\tvar $form = $(e.target),\r\n\t\t\t\t\tbv = $form.data('bootstrapValidator');\r\n\t\t\t\tself.failFn(self.model);\r\n\t\t\t}).on('success.form.bv', function (e, data) {\r\n\t\t\t\te.preventDefault();\r\n\t\t\t\tvar $form = $(e.target),\r\n\t\t\t\t\tbv = $form.data('bootstrapValidator');\r\n\t\t\t\tvar act = self.mode + 'Gift';\r\n\t\t\t\tvar formParams = self.serializeForm();\r\n\t\t\t\tIX.Debug.info(\"DEBUG: Gift Wizard Form Params:\");\r\n\t\t\t\tIX.Debug.info(formParams);\r\n\t\t\t\tself.model.emit(act, {\r\n\t\t\t\t\tparams : formParams,\r\n\t\t\t\t\tfailFn : function () {\r\n\t\t\t\t\t\tself.failFn.call(self);\r\n\t\t\t\t\t},\r\n\t\t\t\t\tsuccessFn : function () {\r\n\t\t\t\t\t\tself.successFn.call(self);\r\n\t\t\t\t\t\tself.parentView.modal.hide();\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t});\r\n\t\t\tself.container.on('change', 'select[name=moneyLimitType]', function (e) {\r\n\t\t\t\tvar $select = $(this),\r\n\t\t\t\t\tval = $select.val(),\r\n\t\t\t\t\t$moenyLimitValue = $(':text[name=moenyLimitValue]'),\r\n\t\t\t\t\t$inputGrp = $moenyLimitValue.parents('.form-group');\r\n\t\t\t\t$inputGrp[val == 0 ? 'addClass' : 'removeClass']('hidden');\r\n\r\n\t\t\t});\r\n\t\t},\r\n\t\tgetCheckboxVal : function (name) {\r\n\t\t\tvar self = this;\r\n\t\t\tvar checkbox = $(':checkbox[name=' + name + ']:checked');\r\n\t\t\tvar ret = [];\r\n\t\t\tcheckbox.each(function (el) {\r\n\t\t\t\tvar $this = $(this);\r\n\t\t\t\tret.push($this.val());\r\n\t\t\t});\r\n\t\t\treturn ret.join(',');\r\n\t\t},\r\n\t\tgetRadiboxVal : function (name) {\r\n\t\t\tvar self = this;\r\n\t\t\tvar radiobox = $(':radio[name=' + name + ']:checked');\r\n\t\t\treturn radiobox.val();\r\n\t\t},\r\n\t\tserializeForm : function () {\r\n\t\t\tvar self = this,\r\n\t\t\t\tformKeys = self.formKeys,\r\n\t\t\t\tret = {},\r\n\t\t\t\tformEls = _.map(formKeys, function (key) {\r\n\t\t\t\t\tvar elCfg = GiftSetFormElsHT.get(key),\r\n\t\t\t\t\t\ttype = $XP(elCfg, 'type');\r\n\t\t\t\t\tif (type == 'checkboxgrp') {\r\n\t\t\t\t\t\tret[key] = self.getCheckboxVal(key);\r\n\t\t\t\t\t} else if (type == 'radiogrp') {\r\n\t\t\t\t\t\tret[key] = self.getRadiboxVal(key);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tret[key] = $('[name=' + key + ']', self.container).val() || '';\t\r\n\t\t\t\t\t}\r\n\t\t\t\t\t\r\n\t\t\t\t});\r\n\t\t\treturn ret;\r\n\t\t}\r\n\t});\r\n\r\n\tHMCM.GiftRuleStepView = GiftRuleStepView;\r\n\r\n\t/**\r\n\t * 创建向导中礼品规则步骤\r\n\t * @param  {[type]} $cnt       [description]\r\n\t * @param  {[type]} cntID      [description]\r\n\t * @param  {[type]} wizardMode [description]\r\n\t * @return {[type]}            [description]\r\n\t */\r\n\tHMCM.initGiftRuleStep = function ($cnt, cntID, wizardMode) {\r\n\t\tvar wizardModalView = this,\r\n\t\t\tstepView = new HMCM.GiftRuleStepView({\r\n\t\t\t\tmode : wizardMode,\r\n\t\t\t\tcontainer : $cnt,\r\n\t\t\t\tparentView : wizardModalView,\r\n\t\t\t\tmodel : wizardModalView.model,\r\n\t\t\t\tsuccessFn : function () {\r\n\t\t\t\t\tvar self = this;\r\n\t\t\t\t\tself.parentView.switchWizardCtrlStatus('reset');\r\n\t\t\t\t\tself.parentView.getNextStep();\r\n\t\t\t\t},\r\n\t\t\t\tfailFn : function () {\r\n\t\t\t\t\tvar self = this;\r\n\t\t\t\t\tself.parentView.switchWizardCtrlStatus('reset');\r\n\t\t\t\t},\r\n\t\t\t\tmapFormElsData : mapGiftRuleFormElsData\r\n\t\t\t});\r\n\t\twizardModalView.registerStepView(cntID, stepView);\r\n\t};\r\n})(jQuery, window);;(function ($, window) {\r\n\tIX.ns(\"Hualala.MCM\");\r\n\tvar HMCM = Hualala.MCM;\r\n\tvar ShopQueryModel = new Hualala.Shop.QueryModel();\r\n\tShopQueryModel.extend({\r\n\t\tchosenShops : [],\r\n\t\tchosenCitys : [],\r\n\t\tinitChosenData : function (shopIDs) {\r\n\t\t\tvar self = this;\r\n\t\t\tif (IX.isEmpty(shopIDs) || shopIDs.length == 0) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tvar shops = self.getShops(shopIDs);\r\n\t\t\tvar cities = _.map(shops, function (el) {return $XP(el, 'cityID')});\r\n\t\t\tcities = self.getCities(_.uniq(cities));\r\n\t\t\tself.chosenShops = shops;\r\n\t\t\tself.chosenCitys = cities;\r\n\t\t},\r\n\t\tclearChosenData : function () {\r\n\t\t\tthis.chosenShops = [];\r\n\t\t\tthis.chosenCitys = [];\r\n\t\t},\r\n\t\tgetChosenData : function () {\r\n\t\t\treturn {\r\n\t\t\t\tcities : this.chosenCitys,\r\n\t\t\t\tshops : this.chosenShops\r\n\t\t\t};\r\n\t\t},\r\n\t\tmapComboOptions : function () {\r\n\t\t\tvar self = this,\r\n\t\t\t\tchosenShops = self.chosenShops,\r\n\t\t\t\tshops = self.getShops();\r\n\t\t\tshops = _.reject(shops, function (el) {\r\n\t\t\t\tvar shopID = $XP(el, 'shopID');\r\n\t\t\t\tvar matched = _.find(chosenShops, function (_shop) {return $XP(_shop, 'shopID') == shopID});\r\n\t\t\t\treturn shopID == $XP(matched, 'shopID');\r\n\t\t\t});\r\n\t\t\t\r\n\t\t\tshops = _.groupBy(shops, 'cityID');\r\n\t\t\tvar ret = [];\r\n\t\t\t_.each(shops, function (_shops, cityID) {\r\n\t\t\t\tvar city = self.getCities(cityID)[0];\r\n\t\t\t\tret.push({\r\n\t\t\t\t\tcityID : cityID,\r\n\t\t\t\t\tcityName : $XP(city, 'cityName'),\r\n\t\t\t\t\toptions : _shops\r\n\t\t\t\t});\r\n\t\t\t});\r\n\t\t\tIX.Debug.info('DEBUG: Combo Shop Options:');\r\n\t\t\tIX.Debug.info(ret);\r\n\t\t\treturn ret;\r\n\t\t},\r\n\t\tmapChosenDataOptions : function () {\r\n\t\t\tvar self = this,\r\n\t\t\t\tchosenShops = self.chosenShops;\r\n\t\t\tvar _chosneShops = _.groupBy(chosenShops, 'cityID');\r\n\t\t\tvar ret = [];\r\n\t\t\t_.each(_chosneShops, function (_shops, cityID) {\r\n\t\t\t\tvar city = self.getCities(cityID)[0];\r\n\t\t\t\tret.push({\r\n\t\t\t\t\tcityID : cityID,\r\n\t\t\t\t\tcityName : $XP(city, 'cityName'),\r\n\t\t\t\t\toptions : _shops\r\n\t\t\t\t})\r\n\t\t\t});\r\n\t\t\tIX.Debug.info('DEBUG: Combo Chosen Shop Options:');\r\n\t\t\tIX.Debug.info(ret);\r\n\t\t\treturn ret;\r\n\t\t}\r\n\t});\r\n\r\n\tHMCM.ShopQueryModel = ShopQueryModel;\r\n\r\n\tvar ChooseShopModal = Stapes.subclass({\r\n\t\tconstructor : function (cfg) {\r\n\t\t\tthis.parentView = $XP(cfg, 'parentView');\r\n\t\t\tthis.trigger = $XP(cfg, 'trigger');\r\n\t\t\tthis.modal = null;\r\n\t\t\tthis.$body = null;\r\n\t\t\tthis.model = ShopQueryModel;\r\n\t\t\tthis.modalTitle = $XP(cfg, 'modalTitle', '');\r\n\t\t\tthis.modalClz = $XP(cfg, 'modalClz', '');\r\n\t\t\tthis.chosenShopIDs = $XP(cfg, 'chosenShopIDs', []);\r\n\t\t\tthis.chosenShopNames = $XP(cfg, 'chosenShopNames', []);\r\n\r\n\t\t\tthis.loadTemplates();\r\n\t\t\tthis.initInput();\r\n\t\t\tthis.initModal();\r\n\t\t\t// this.renderLayout();\r\n\t\t}\r\n\t});\r\n\r\n\tChooseShopModal.proto({\r\n\t\tloadTemplates : function () {\r\n\t\t\tvar layoutTpl = Handlebars.compile(Hualala.TplLib.get('tpl_mcm_queryshops')),\r\n\t\t\t\tbtnTpl = Handlebars.compile(Hualala.TplLib.get('tpl_shop_modal_btns')),\r\n\t\t\t\toptGrpTpl = Handlebars.compile(Hualala.TplLib.get('tpl_shop_optgroup')),\r\n\t\t\t\tinputTpl = Handlebars.compile(Hualala.TplLib.get('tpl_shop_choose'));\r\n\t\t\tHandlebars.registerPartial(\"ctrlbtns\", Hualala.TplLib.get('tpl_shop_modal_btns'));\r\n\t\t\tHandlebars.registerPartial(\"optgroup\", Hualala.TplLib.get('tpl_shop_optgroup'));\r\n\t\t\t\r\n\t\t\tthis.set({\r\n\t\t\t\tlayoutTpl : layoutTpl,\r\n\t\t\t\tbtnTpl : btnTpl,\r\n\t\t\t\toptGrpTpl : optGrpTpl,\r\n\t\t\t\tinputTpl : inputTpl\r\n\t\t\t});\r\n\t\t},\r\n\t\tinitInput : function () {\r\n\t\t\tvar self = this,\r\n\t\t\t\tinputTpl = self.get('inputTpl');\r\n\t\t\tself.trigger.html(inputTpl({\r\n\t\t\t\tshopNames : self.chosenShopNames\r\n\t\t\t}));\r\n\t\t\tself.trigger.on('click', '.btn-choose', function (e) {\r\n\t\t\t\tself.modal.show();\r\n\t\t\t\tself.renderLayout();\r\n\t\t\t\treturn false;\r\n\t\t\t});\r\n\t\t},\r\n\t\tinitModal : function () {\r\n\t\t\tvar self = this;\r\n\t\t\tself.modal = new Hualala.UI.ModalDialog({\r\n\t\t\t\tid : \"mcm_choose_shop_modal\",\r\n\t\t\t\tclz : self.modalClz,\r\n\t\t\t\ttitle : self.modalTitle,\r\n\t\t\t\thideCloseBtn : true,\r\n\t\t\t\tbackdrop : 'static',\r\n\t\t\t\tshowFooter : true,\r\n\t\t\t\tafterHide : function () {\r\n\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\tself.$body = self.modal._.body;\r\n\t\t\tself.$footer = self.modal._.footer;\r\n\t\t\t// self.modal.show();\r\n\t\t},\r\n\t\trenderLayout : function () {\r\n\t\t\tvar self = this;\r\n\t\t\tself.model.init({}, function () {\r\n\t\t\t\tself.model.initChosenData(self.chosenShopIDs);\r\n\t\t\t\tvar chooseShopOptions = self.model.mapComboOptions(),\r\n\t\t\t\t\tchosenShopOptions = self.model.mapChosenDataOptions();\r\n\t\t\t\tvar layoutTpl = self.get('layoutTpl');\r\n\t\t\t\tvar renderData = {\r\n\t\t\t\t\tchooseShopOpts : {\r\n\t\t\t\t\t\tcomboName : 'choose_shops',\r\n\t\t\t\t\t\titems : chooseShopOptions\r\n\t\t\t\t\t},\r\n\t\t\t\t\tchosenShopOpts : {\r\n\t\t\t\t\t\tcomboName : 'chosen_shops',\r\n\t\t\t\t\t\titems : chosenShopOptions\t\r\n\t\t\t\t\t},\r\n\t\t\t\t\tbtns : [\r\n\t\t\t\t\t\t{clz : 'btn-warning btn-block', name : 'add_all', label : '全部添加>>'},\r\n\t\t\t\t\t\t{clz : 'btn-warning btn-block', name : 'add_items', label : '添加>'},\r\n\t\t\t\t\t\t{clz : 'btn-warning btn-block', name : 'delete_items', label : '<删除'},\r\n\t\t\t\t\t\t{clz : 'btn-warning btn-block', name : 'delete_all', label : '<<全部删除>'}\r\n\t\t\t\t\t]\r\n\t\t\t\t};\r\n\t\t\t\tvar htm = layoutTpl(renderData);\r\n\t\t\t\tself.$body.html(htm);\r\n\t\t\t\tself.bindEvent();\r\n\t\t\t});\r\n\t\t},\r\n\t\trefreshCombo : function () {\r\n\t\t\tvar self = this;\r\n\t\t\tvar chooseShopOptions = self.model.mapComboOptions(),\r\n\t\t\t\tchosenShopOptions = self.model.mapChosenDataOptions();\r\n\t\t\tvar optGrpTpl = self.get('optGrpTpl');\r\n\t\t\tvar comboLeftOpts = optGrpTpl({\r\n\t\t\t\t\titems : chooseShopOptions\r\n\t\t\t\t}),\r\n\t\t\t\tcomboRightOpts = optGrpTpl({\r\n\t\t\t\t\titems : chosenShopOptions\r\n\t\t\t\t});\r\n\t\t\t$('select[name=choose_shops]').html(comboLeftOpts);\r\n\t\t\t$('select[name=chosen_shops]').html(comboRightOpts);\r\n\t\t},\r\n\t\tbindEvent : function () {\r\n\t\t\tvar self = this;\r\n\t\t\tself.$body.on('mouseup', 'select.form-control > optgroup', function (e) {\r\n\t\t\t\tvar $grp = $(this);\r\n\t\t\t\tif ($grp.hasClass('open')) {\r\n\t\t\t\t\t$grp.removeClass('open').find('> option').hide();\r\n\t\t\t\t} else {\r\n\t\t\t\t\t$grp.addClass('open').find('> option').show();\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\tself.$body.on('mouseup', 'select.form-control option', function (e) {\r\n\t\t\t\te.stopPropagation();\r\n\t\t\t});\r\n\t\t\tself.$body.on('click', '.select-center .btn', function (e) {\r\n\t\t\t\tvar $btn = $(this), act = $btn.attr('name');\r\n\t\t\t\tvar $comboLeft = $('select[name=choose_shops]', self.$body),\r\n\t\t\t\t\t$comboRight = $('select[name=chosen_shops]', self.$body);\r\n\t\t\t\tvar shopIDs = [];\r\n\t\t\t\tswitch(act) {\r\n\t\t\t\t\tcase 'add_all':\r\n\t\t\t\t\t\tshopIDs = self.model.getShops();\r\n\t\t\t\t\t\tshopIDs = _.map(shopIDs, function (el) {return $XP(el, 'shopID')});\r\n\t\t\t\t\t\tself.model.clearChosenData();\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 'add_items':\r\n\t\t\t\t\t\t$comboLeft.find('option:selected').each(function (i, el) {\r\n\t\t\t\t\t\t\tshopIDs.push($(el).attr('value'));\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t\t$comboRight.find('option').each(function (i, el) {\r\n\t\t\t\t\t\t\tshopIDs.push($(el).attr('value'));\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 'delete_all':\r\n\t\t\t\t\t\tself.model.clearChosenData();\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 'delete_items':\r\n\t\t\t\t\t\t$comboRight.find('option:not(:selected)').each(function (i, el) {\r\n\t\t\t\t\t\t\tshopIDs.push($(el).attr('value'));\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t\tself.model.initChosenData(shopIDs);\r\n\t\t\t\tself.refreshCombo();\r\n\t\t\t});\r\n\t\t\tself.$footer.on('click', '.btn-ok', function (e) {\r\n\t\t\t\tvar $btn = $(this);\r\n\t\t\t\tvar chosenData = self.model.getChosenData();\r\n\t\t\t\tvar shopNames = _.pluck($XP(chosenData, 'shops'), 'shopName');\r\n\t\t\t\tself.parentView.model.emit('bindShops', chosenData);\r\n\t\t\t\tself.trigger.find('.choose-shop-val').html(shopNames.length == 0 ? '不限店铺' : shopNames.join(';'));\r\n\t\t\t\tself.modal.hide();\r\n\t\t\t});\r\n\t\t}\r\n\t});\r\n\r\n\tHMCM.ChooseShopModal = ChooseShopModal;\r\n})(jQuery, window);;(function ($, window) {\r\n\tIX.ns(\"Hualala.MCM\");\r\n\tvar HMCM = Hualala.MCM;\r\n\tvar popoverMsg = Hualala.UI.PopoverMsgTip,\r\n\t\ttoptip = Hualala.UI.TopTip;\r\n\r\n\r\n\tvar EventSetFormElsCfg = {\r\n\t\teventID : {\r\n\t\t\ttype : \"hidden\",\r\n\t\t\tdefaultVal : \"\"\r\n\t\t},\r\n\t\teventName : {\r\n\t\t\ttype : 'text',\r\n\t\t\tlabel : \"活动主题\",\r\n\t\t\tdefaultVal : \"\",\r\n\t\t\tvalidCfg : {\r\n\t\t\t\tvalidators : {\r\n\t\t\t\t\tnotEmpty : {\r\n\t\t\t\t\t\tmessage : \"活动主题不能为空\"\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\tcardLevelID : {\r\n\t\t\ttype : 'combo',\r\n\t\t\tlabel : \"顾客范围\",\r\n\t\t\tdefaultVal : \"-1\",\r\n\t\t\toptions : Hualala.TypeDef.MCMDataSet.EventCardLevels,\r\n\t\t\tvalidCfg : {\r\n\t\t\t\tvalidators : {\r\n\t\t\t\t\tnotEmpty : {\r\n\t\t\t\t\t\tmessage : \"顾客范围不能为空\"\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\teventWay : {\r\n\t\t\ttype : 'combo',\r\n\t\t\tlabel : \"活动类型\",\r\n\t\t\tdefaultVal : \"20\",\r\n\t\t\toptions : _.reject(Hualala.TypeDef.MCMDataSet.EventTypes, function (el) {\r\n\t\t\t\treturn IX.isEmpty($XP(el, 'value'));\r\n\t\t\t}),\r\n\t\t\tvalidCfg : {\r\n\t\t\t\tvalidators : {\r\n\t\t\t\t\tnotEmpty : {\r\n\t\t\t\t\t\tmessage : \"活动类型不能为空\"\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\teventRemark : {\r\n\t\t\ttype : 'textarea',\r\n\t\t\tlabel : \"描述\",\r\n\t\t\tdefaultVal : \"\",\r\n\t\t\tvalidCfg : {\r\n\t\t\t\tvalidators : {\r\n\t\t\t\t\tnotEmpty : {\r\n\t\t\t\t\t\tmessage : \"活动说明不能为空\"\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\tdateRange : {\r\n\t\t\ttype : 'section',\r\n\t\t\tlabel : '起止日期',\r\n\t\t\tmin : {\r\n\t\t\t\ttype : 'datetimepicker',\r\n\t\t\t\t// surfix : '<span class=\"glyphicon glyphicon-calendar\"></span>',\r\n\t\t\t\tdefaultVal : '',\r\n\t\t\t\tvalidCfg : {\r\n\t\t\t\t\tgroup : '.min-input',\r\n\t\t\t\t\tvalidators : {\r\n\t\t\t\t\t\tnotEmpty : {\r\n\t\t\t\t\t\t\tmessage : \"请输入起始时间\"\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tmax : {\r\n\t\t\t\ttype : 'datetimepicker',\r\n\t\t\t\t// surfix : '<span class=\"glyphicon glyphicon-calendar\"></span>',\r\n\t\t\t\tdefaultVal : '',\r\n\t\t\t\tvalidCfg : {\r\n\t\t\t\t\tgroup : '.max-input',\r\n\t\t\t\t\tvalidators : {\r\n\t\t\t\t\t\tnotEmpty : {\r\n\t\t\t\t\t\t\tmessage : \"请输入结束时间\"\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\tchkDeductPoints : {\r\n\t\t\ttype : \"checkboxgrp\",\r\n\t\t\tlabel : \"\",\r\n\t\t\tdefaultVal : \"\",\r\n\t\t\toptions : [{\r\n\t\t\t\tvalue : 1, label : '参与活动扣减积分'\r\n\t\t\t}],\r\n\t\t\tvalidCfg : {\r\n\t\t\t\tvalidators : {}\r\n\t\t\t}\r\n\t\t},\r\n\t\tdeductPoints : {\r\n\t\t\ttype : \"text\",\r\n\t\t\tlabel : \"扣减积分\",\r\n\t\t\tdefaultVal : \"0\",\r\n\t\t\t// prefix : '￥',\r\n\t\t\t// surfix : '元',\r\n\t\t\tvalidCfg : {\r\n\t\t\t\tvalidators : {\r\n\t\t\t\t\tnotEmpty : {\r\n\t\t\t\t\t\tmessage : \"请输入扣减积分值\"\r\n\t\t\t\t\t},\r\n\t\t\t\t\tnumeric : {\r\n\t\t\t\t\t\tmessage : \"扣减积分必须为数字\"\r\n\t\t\t\t\t},\r\n\t\t\t\t\tgreaterThan : {\r\n\t\t\t\t\t\tinclusive : true,\r\n\t\t\t\t\t\tvalue : 0,\r\n\t\t\t\t\t\tmessage : \"扣减积分必须大于或等于0\"\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\tchkSendPoints : {\r\n\t\t\ttype : \"checkboxgrp\",\r\n\t\t\tlabel : \"\",\r\n\t\t\tdefaultVal : \"\",\r\n\t\t\toptions : [{\r\n\t\t\t\tvalue : 1, label : '参与活动赠送积分'\r\n\t\t\t}],\r\n\t\t\tvalidCfg : {\r\n\t\t\t\tvalidators : {}\r\n\t\t\t}\r\n\t\t},\r\n\t\tsendPoints : {\r\n\t\t\ttype : \"text\",\r\n\t\t\tlabel : \"赠送积分\",\r\n\t\t\tdefaultVal : \"0\",\r\n\t\t\tvalidCfg : {\r\n\t\t\t\tvalidators : {\r\n\t\t\t\t\tnotEmpty : {\r\n\t\t\t\t\t\tmessage : \"请输入赠送积分值\"\r\n\t\t\t\t\t},\r\n\t\t\t\t\tnumeric : {\r\n\t\t\t\t\t\tmessage : \"赠送积分必须为数字\"\r\n\t\t\t\t\t},\r\n\t\t\t\t\tgreaterThan : {\r\n\t\t\t\t\t\tinclusive : true,\r\n\t\t\t\t\t\tvalue : 0,\r\n\t\t\t\t\t\tmessage : \"赠送积分必须大于或等于0\"\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\tradioCountCycleDays : {\r\n\t\t\ttype : \"radiogrp\",\r\n\t\t\tlabel : \"会员参与次数\",\r\n\t\t\tdefaultVal : \"0\",\r\n\t\t\toptions : Hualala.TypeDef.MCMDataSet.EventCountCycleDays,\r\n\t\t\tvalidCfg : {}\r\n\t\t},\r\n\t\tpartInTimes : {\r\n\t\t\ttype : \"inputCountCycleDays\",\r\n\t\t\tlabel : \"\",\r\n\t\t\tdefaultVal : '1',\r\n\t\t\toptions : _.map([1,2,3,4,5,6,7,15,30,60,90], function (d) {\r\n\t\t\t\treturn {\r\n\t\t\t\t\tvalue : d,\r\n\t\t\t\t\tlabel : d + '天'\r\n\t\t\t\t};\r\n\t\t\t}),\r\n\t\t\tpartInTimes : {\r\n\t\t\t\tvalidCfg : {\r\n\t\t\t\t\tvalidators : {\r\n\t\t\t\t\t\tnotEmpty : {\r\n\t\t\t\t\t\t\tmessage : \"请输入参与次数\"\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\tnumeric : {\r\n\t\t\t\t\t\t\tmessage : \"参与次数必须为数字\"\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\tgreaterThan : {\r\n\t\t\t\t\t\t\tinclusive : false,\r\n\t\t\t\t\t\t\tvalue : 0,\r\n\t\t\t\t\t\t\tmessage : \"参与次数必须大于0\"\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\tisVipBirthdayMonth : {\r\n\t\t\ttype : \"radiogrp\",\r\n\t\t\tlabel : \"仅本月会员生日可参与\",\r\n\t\t\tdefaultVal : '0',\r\n\t\t\toptions : Hualala.TypeDef.MCMDataSet.IsVIPBirthdayMonth,\r\n\t\t\tvalidCfg : {}\r\n\t\t},\r\n\t\tmaxPartInPerson : {\r\n\t\t\ttype : \"text\",\r\n\t\t\tlabel : \"最大报名人数\",\r\n\t\t\tdefaultVal : '0',\r\n\t\t\tvalidCfg : {\r\n\t\t\t\tvalidators : {\r\n\t\t\t\t\tnotEmpty : {\r\n\t\t\t\t\t\tmessage : \"请输入最大报名人数\"\r\n\t\t\t\t\t},\r\n\t\t\t\t\tnumeric : {\r\n\t\t\t\t\t\tmessage : \"最大报名人数必须为数字\"\r\n\t\t\t\t\t},\r\n\t\t\t\t\tgreaterThan : {\r\n\t\t\t\t\t\tinclusive : true,\r\n\t\t\t\t\t\tvalue : 0,\r\n\t\t\t\t\t\tmessage : \"最大报名人数必须大于或等于0\"\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n\r\n\tvar EventSetFormElsHT = new IX.IListManager();\r\n\t_.each(EventSetFormElsCfg, function (el, k) {\r\n\t\tvar type = $XP(el, 'type');\r\n\t\tvar labelClz = 'col-sm-offset-1 col-sm-3 control-label';\r\n\t\tif (type == 'section') {\r\n\t\t\tvar id = minID = k + '_min_' + IX.id(), maxID = k + '_max_' + IX.id(),\r\n\t\t\t\tminName = 'eventStartDate',\r\n\t\t\t\tmaxName = 'eventEndDate',\r\n\t\t\t\tmin = IX.inherit($XP(el, 'min', {}), {\r\n\t\t\t\t\tid : minID, name : minName, clz : 'col-xs-3 col-sm-3 col-md-3',\r\n\t\t\t\t}), max = IX.inherit($XP(el, 'max', {}), {\r\n\t\t\t\t\tid : maxID, name : maxName, clz : 'col-xs-3 col-sm-3 col-md-3',\r\n\t\t\t\t});\r\n\t\t\tEventSetFormElsHT.register(k, IX.inherit(el, {\r\n\t\t\t\tid : id,\r\n\t\t\t\tlabelClz : labelClz,\r\n\t\t\t\tmin : min,\r\n\t\t\t\tmax : max\r\n\t\t\t}));\r\n\t\t} else if (type == 'inputCountCycleDays') {\r\n\t\t\tvar options = $XP(el, 'options');\r\n\t\t\tvar countCycleDays = {\r\n\t\t\t\t\tid : 'countCycleDays' + '_' + IX.id(),\r\n\t\t\t\t\tname : 'countCycleDays',\r\n\t\t\t\t\toptions : options\r\n\t\t\t\t},\r\n\t\t\t\tpartInTimes = {\r\n\t\t\t\t\tid : 'partInTimes_' + IX.id(),\r\n\t\t\t\t\tname : 'partInTimes',\r\n\t\t\t\t\tvalidCfg : $XP(el, 'partInTimes.validCfg', {})\r\n\t\t\t\t};\r\n\r\n\t\t\tEventSetFormElsHT.register(k, IX.inherit(el, {\r\n\t\t\t\tlabelClz : labelClz,\r\n\t\t\t\tclz : 'col-sm-8',\r\n\t\t\t\tcountCycleDays : countCycleDays,\r\n\t\t\t\tpartInTimes : partInTimes\r\n\t\t\t}));\r\n\r\n\t\t} else if (type == 'radiogrp' || type == 'checkboxgrp') {\r\n\t\t\tvar ops = _.map($XP(el, 'options'), function (op) {\r\n\t\t\t\treturn IX.inherit(op, {\r\n\t\t\t\t\tid : k + '_' + IX.id(),\r\n\t\t\t\t\tname : k,\r\n\t\t\t\t\tclz : (type == 'radiogrp' ? ' radio-inline' : ' checkbox-inline')\r\n\t\t\t\t});\r\n\t\t\t});\r\n\t\t\tEventSetFormElsHT.register(k, IX.inherit(el, {\r\n\t\t\t\tid : k + '_' + IX.id(),\r\n\t\t\t\toptions : ops,\r\n\t\t\t\tlabelClz : labelClz,\r\n\t\t\t\tclz : 'col-sm-7'\r\n\t\t\t}));\r\n\t\t} else if (type == 'selectShops') {\r\n\t\t\tEventSetFormElsHT.register(k, IX.inherit(el, {\r\n\t\t\t\tid : k + '_' + IX.id(),\r\n\t\t\t\tname : k,\r\n\t\t\t\tlabelClz : labelClz,\r\n\t\t\t\tclz : 'col-sm-7'\r\n\t\t\t}));\r\n\t\t} else {\r\n\t\t\tEventSetFormElsHT.register(k, IX.inherit(el, {\r\n\t\t\t\tid : k + '_' + IX.id(),\r\n\t\t\t\tname : k,\r\n\t\t\t\tlabelClz : labelClz,\r\n\t\t\t\tclz : 'col-sm-5'\r\n\t\t\t}));\r\n\t\t}\r\n\t});\r\n\r\n\tHMCM.EventSetFormElsHT = EventSetFormElsHT;\r\n\r\n\tvar EventBaseInfoFormKeys = 'eventID,eventName,cardLevelID,eventWay,eventRemark'.split(',');\r\n\r\n\r\n\r\n\t/**\r\n\t * 整理礼品基本信息表单渲染数据\r\n\t * @return {[type]} [description]\r\n\t */\r\n\tvar mapEventBaseInfoFormElsData = function () {\r\n\t\tvar self = this,\r\n\t\t\tformKeys = self.formKeys;\r\n\t\tvar ret = _.map(formKeys, function (key) {\r\n\t\t\tvar elCfg = EventSetFormElsHT.get(key),\r\n\t\t\t\ttype = $XP(elCfg, 'type');\r\n\t\t\tif (type == 'combo' && key == 'cardLevelID') {\r\n\t\t\t\tvar v = self.model.get(key) || $XP(elCfg, 'dafaultVal'),\r\n\t\t\t\t\tlevels = _.map(self.model.CardLevelIDSet, function (el) {\r\n\t\t\t\t\t\treturn {\r\n\t\t\t\t\t\t\tvalue : $XP(el, 'cardLevelID'),\r\n\t\t\t\t\t\t\tlabel : $XP(el, 'cardLevelName'),\r\n\t\t\t\t\t\t\tisActive : $XP(el, 'isActive')\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\tlevels = _.filter(levels, function (el) {return $XP(el, 'isActive') == '1';});\r\n\t\t\t\tvar options = $XP(elCfg, 'options', []).concat(levels);\r\n\t\t\t\toptions = _.map(options, function (op) {\r\n\t\t\t\t\treturn IX.inherit(op, {\r\n\t\t\t\t\t\tselected : $XP(op, 'value') == v ? 'selected' : ''\r\n\t\t\t\t\t});\r\n\t\t\t\t});\r\n\t\t\t\treturn IX.inherit(elCfg, {\r\n\t\t\t\t\tvalue : v,\r\n\t\t\t\t\toptions : options\r\n\t\t\t\t});\r\n\t\t\t} else if (type == 'combo') {\r\n\t\t\t\tvar v = self.model.get(key) || $XP(elCfg, 'dafaultVal'),\r\n\t\t\t\t\toptions = _.map($XP(elCfg, 'options'), function (op) {\r\n\t\t\t\t\t\treturn IX.inherit(op, {\r\n\t\t\t\t\t\t\tselected : $XP(op, 'value') == v ? 'selected' : ''\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t});\r\n\t\t\t\treturn IX.inherit(elCfg, {\r\n\t\t\t\t\tdisabled : (self.mode == 'edit' && key == 'eventWay') ? 'disabled' : '',\r\n\t\t\t\t\tvalue : v,\r\n\t\t\t\t\toptions : options\r\n\t\t\t\t});\r\n\t\t\t} else {\r\n\t\t\t\treturn IX.inherit(elCfg, {\r\n\t\t\t\t\tvalue : self.model.get(key) || $XP(elCfg, 'dafaultVal')\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t});\r\n\t\treturn ret;\r\n\t};\r\n\r\n\tvar EventBaseInfoStepView = HMCM.GiftBaseInfoStepView.subclass({\r\n\t\tconstructor : function (cfg) {\r\n\t\t\tvar self = this;\r\n\t\t\tthis.mode = $XP(cfg, 'mode', '');\r\n\t\t\tthis.container = $XP(cfg, 'container', '');\r\n\t\t\tthis.parentView = $XP(cfg, 'parentView');\r\n\t\t\tthis.model = $XP(cfg, 'model');\r\n\t\t\tthis.successFn = $XF(cfg, 'successFn');\r\n\t\t\tthis.failFn = $XF(cfg, 'failFn');\r\n\r\n\t\t\tthis.mapFormElsData = $XF(cfg, 'mapFormElsData');\r\n\t\t\tif (!this.model || !this.parentView) {\r\n\t\t\t\tthrow(\"Event Base Info View init faild!\");\r\n\t\t\t}\r\n\r\n\t\t\tthis.loadTemplates();\r\n\t\t\tthis.initBaseCfg();\r\n\t\t\tthis.formParams = this.model.getAll();\r\n\t\t\tthis.renderForm(function () {\r\n\t\t\t\tself.initUIComponents();\r\n\t\t\t\tself.bindEvent();\r\n\t\t\t});\r\n\t\t}\r\n\t});\r\n\tEventBaseInfoStepView.proto({\r\n\t\tinitBaseCfg : function () {\r\n\t\t\tthis.formKeys = EventBaseInfoFormKeys;\r\n\t\t},\r\n\t\trenderForm : function (cbFn) {\r\n\t\t\tvar self = this;\r\n\t\t\tvar renderFn = function () {\r\n\t\t\t\tvar renderData = self.mapFormElsData.call(self),\r\n\t\t\t\t\ttpl = self.get('layoutTpl'),\r\n\t\t\t\t\tbtnTpl = self.get('btnTpl'),\r\n\t\t\t\t\thtm = tpl({\r\n\t\t\t\t\t\tformClz : 'wizard-step-form form-feedback-out',\r\n\t\t\t\t\t\titems : renderData\r\n\t\t\t\t\t});\r\n\t\t\t\tself.container.html(htm);\r\n\t\t\t\tcbFn();\r\n\t\t\t};\r\n\t\t\tself.model.emit(\"loadCardLevelIDs\", {\r\n\t\t\t\tsuccessFn : function () {\r\n\t\t\t\t\trenderFn();\r\n\t\t\t\t},\r\n\t\t\t\tfailFn : function () {\r\n\t\t\t\t\trenderFn();\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\t\t\r\n\t\t\t\r\n\t\t},\r\n\t\tinitUIComponents : function () {\r\n\r\n\t\t},\r\n\t\tbindEvent : function () {\r\n\t\t\tvar self = this,\r\n\t\t\t\tfvOpts = self.initValidFieldOpts();\r\n\t\t\tself.container.find('form').bootstrapValidator({\r\n\t\t\t\ttrigger : 'blur',\r\n\t\t\t\tfields : fvOpts\r\n\t\t\t}).on('error.field.bv', function (e, data) {\r\n\t\t\t\tvar $form = $(e.target),\r\n\t\t\t\t\tbv = $form.data('bootstrapValidator');\r\n\t\t\t\tself.failFn(self.model);\r\n\t\t\t}).on('success.form.bv', function (e, data) {\r\n\t\t\t\te.preventDefault();\r\n\t\t\t\tvar $form = $(e.target),\r\n\t\t\t\t\tbv = $form.data('bootstrapValidator');\r\n\t\t\t\tvar act = self.mode + 'Event';\r\n\t\t\t\tvar formParams = self.serializeForm();\r\n\t\t\t\tIX.Debug.info(\"DEBUG: Event Wizard Form Params:\");\r\n\t\t\t\tIX.Debug.info(formParams);\r\n\t\t\t\t\r\n\t\t\t\tself.model.emit('saveCache', {\r\n\t\t\t\t\tparams : formParams,\r\n\t\t\t\t\tfailFn : function () {\r\n\t\t\t\t\t\tself.failFn.call(self);\r\n\t\t\t\t\t},\r\n\t\t\t\t\tsuccessFn : function () {\r\n\t\t\t\t\t\tself.successFn.call(self);\r\n\r\n\t\t\t\t\t}\r\n\t\t\t\t})\r\n\t\t\t});\r\n\t\t},\r\n\t\tinitValidFieldOpts : function () {\r\n\t\t\tvar self = this,\r\n\t\t\t\tformKeys = _.reject(self.formKeys, function (k) {return k == 'eventID'}),\r\n\t\t\t\tret = {};\r\n\t\t\t_.each(formKeys, function (key) {\r\n\t\t\t\tvar elCfg = EventSetFormElsHT.get(key),\r\n\t\t\t\t\ttype = $XP(elCfg, 'type');\r\n\t\t\t\tret[key] = $XP(elCfg, 'validCfg', {});\r\n\t\t\t});\r\n\t\t\treturn ret;\r\n\t\t},\r\n\t\tserializeForm : function () {\r\n\t\t\tvar self = this,\r\n\t\t\t\tformKeys = self.formKeys,\r\n\t\t\t\tret = {},\r\n\t\t\t\tformEls = _.map(formKeys, function (key) {\r\n\t\t\t\t\tvar elCfg = EventSetFormElsHT.get(key),\r\n\t\t\t\t\t\ttype = $XP(elCfg, 'type');\r\n\t\t\t\t\tret[key] = $('[name=' + key + ']', self.container).val();\r\n\t\t\t\t});\r\n\t\t\treturn ret;\r\n\t\t},\r\n\t\tswitchViewMode : function (mode) {\r\n\t\t\tthis.mode = mode;\r\n\t\t\tthis.parentView.switchViewMode(mode);\r\n\t\t}\r\n\t});\r\n\tHMCM.EventBaseInfoStepView = EventBaseInfoStepView;\r\n\r\n\t/**\r\n\t * 创建向导中活动基本信息步骤\r\n\t * @param  {[type]} $cnt       [description]\r\n\t * @param  {[type]} cntID      [description]\r\n\t * @param  {[type]} wizardMode [description]\r\n\t * @return {[type]}            [description]\r\n\t */\r\n\tvar initEventBaseInfoStep = function ($cnt, cntID, wizardMode) {\r\n\t\tvar wizardModalView = this,\r\n\t\t\tstepView = new HMCM.EventBaseInfoStepView({\r\n\t\t\t\tmode : wizardMode,\r\n\t\t\t\tcontainer : $cnt,\r\n\t\t\t\tparentView : wizardModalView,\r\n\t\t\t\tmodel : wizardModalView.model,\r\n\t\t\t\tsuccessFn : function () {\r\n\t\t\t\t\tvar self = this;\r\n\t\t\t\t\tself.parentView.switchWizardCtrlStatus('reset');\r\n\t\t\t\t\tself.parentView.getNextStep();\r\n\t\t\t\t},\r\n\t\t\t\tfailFn : function () {\r\n\t\t\t\t\tvar self = this;\r\n\t\t\t\t\tself.parentView.switchWizardCtrlStatus('reset');\r\n\t\t\t\t},\r\n\t\t\t\tmapFormElsData : mapEventBaseInfoFormElsData\r\n\t\t\t});\r\n\t\twizardModalView.registerStepView(cntID, stepView);\r\n\t};\r\n\r\n\tHMCM.initEventBaseInfoStep = initEventBaseInfoStep;\r\n\r\n\t/**\r\n\t * 当活动向导步骤变化时触发的事件\r\n\t * @param  {[type]} $curNav [description]\r\n\t * @param  {[type]} $navBar [description]\r\n\t * @param  {[type]} cIdx    [description]\r\n\t * @param  {[type]} nIdx    [description]\r\n\t * @return {[type]}         [description]\r\n\t */\r\n\tvar onEventWizardStepChange = function ($curNav, $navBar, cIdx, nIdx) {\r\n\t\tvar wizardModalView = this;\r\n\t\tvar curID = wizardModalView.getTabContentIDByIndex($navBar, cIdx),\r\n\t\t\tnextID = wizardModalView.getTabContentIDByIndex($navBar, nIdx),\r\n\t\t\t$nextCnt = $('#' + nextID, wizardModalView.$wizard),\r\n\t\t\tnextView = wizardModalView.getStepView(nextID);\r\n\t\tvar stepFns = [\r\n\t\t\t'initEventBaseInfoStep',\r\n\t\t\t'initEventRuleStep',\r\n\t\t\t'initEventGiftSetStep',\r\n\t\t\t'initEventOpenStep'\r\n\t\t];\r\n\t\tif (cIdx == -1 && nIdx == 0) return true;\r\n\t\tif (!nextView) {\r\n\t\t\tHMCM[stepFns[nIdx]].call(wizardModalView, $nextCnt, nextID, wizardModalView.mode);\r\n\t\t\t// nIdx == 1 && HMCM.initEventRuleStep.call(wizardModalView, $nextCnt, nextID, wizardModalView.mode);\r\n\t\t\t// nIdx == 0 && HMCM.initEventBaseInfoStep.call(wizardModalView, $nextCnt, nextID, wizardModalView.mode);\r\n\t\t\t// nIdx == 2 && HMCM.initEventGiftSetStep.call(wizardModalView, $nextCnt, nextID, wizardModalView.mode);\r\n\t\t} else {\r\n\t\t\tnIdx == 1 && nextView.refresh();\r\n\t\t}\r\n\t\treturn true;\r\n\t};\r\n\r\n\tHMCM.onEventWizardStepChange = onEventWizardStepChange;\r\n\r\n\t/**\r\n\t * 当活动向导步骤提交时触发的事件\r\n\t * @param  {[type]} curID [description]\r\n\t * @return {[type]}       [description]\r\n\t */\r\n\tHMCM.onEventWizardStepCommit = function (curID) {\r\n\t\tvar wizardModalView = this,\r\n\t\t\tstepView = wizardModalView.getStepView(curID),\r\n\t\t\t$cnt = stepView.container,\r\n\t\t\t$form = $cnt.find('form'),\r\n\t\t\tbv = $form.data('bootstrapValidator');\r\n\t\twizardModalView.switchWizardCtrlStatus('loading');\r\n\t\tif (curID == 'event_on') {\r\n\t\t\tstepView.submit();\r\n\t\t} else {\r\n\t\t\tbv.validate();\r\n\t\t}\r\n\t\t\r\n\t};\r\n\r\n\t/**\r\n\t * 绑定礼活动向导的事件\r\n\t * @return {[type]} [description]\r\n\t */\r\n\tHMCM.bundleEventWizardEvent = function () {\r\n\t\tvar wizardModalView = this;\r\n\t\twizardModalView.$wizard.find('.wizard-ctrl .btn-cancel').on('click', function (e) {\r\n\t\t\tvar $btn = $(this);\r\n\t\t\tvar curIdx = wizardModalView.$wizard.bsWizard('currentIndex'), \r\n\t\t\t\tcntID = wizardModalView.getTabContentIDByIndex(wizardModalView.$wizard.find('.wizard-nav'), curIdx),\r\n\t\t\t\tstepView = wizardModalView.stepViewHT.get(cntID);\r\n\t\t\tvar accountID = wizardModalView.model.get('accountID');\r\n\t\t\tif (!accountID && curIdx == 0) {\r\n\t\t\t\twizardModalView.modal.hide();\r\n\t\t\t} else {\r\n\t\t\t\tHualala.UI.Confirm({\r\n\t\t\t\t\ttitle : '取消创建活动',\r\n\t\t\t\t\tmsg : '是否取消创建活动的操作？<br/>之前的操作将不生效！',\r\n\t\t\t\t\tokLabel : '确定',\r\n\t\t\t\t\tokFn : function () {\r\n\t\t\t\t\t\twizardModalView.modal.hide();\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\r\n})(jQuery, window);;(function ($, window) {\r\n\tIX.ns(\"Hualala.MCM\");\r\n\tvar HMCM = Hualala.MCM;\r\n\tvar popoverMsg = Hualala.UI.PopoverMsgTip,\r\n\t\ttoptip = Hualala.UI.TopTip;\r\n\tvar EventSetFormElsHT = HMCM.EventSetFormElsHT;\r\n\r\n\tvar EventRuleFormKeys = 'dateRange,chkDeductPoints,deductPoints,chkSendPoints,sendPoints,radioCountCycleDays,partInTimes,isVipBirthdayMonth,maxPartInPerson'.split(',');\r\n\r\n\t/**\r\n\t * 整理活动规则表单渲染数据\r\n\t * @return {[type]} [description]\r\n\t */\r\n\tvar mapEventRuleFormElsData = function () {\r\n\t\tvar self = this,\r\n\t\t\tformKeys = self.formKeys;\r\n\t\tvar ret = _.map(formKeys, function (key) {\r\n\t\t\tvar elCfg = EventSetFormElsHT.get(key),\r\n\t\t\t\ttype = $XP(elCfg, 'type');\r\n\t\t\tif (type == 'section') {\r\n\t\t\t\tvar eventStartDate = self.model.get('eventStartDate') || '',\r\n\t\t\t\t\teventEndDate = self.model.get('eventEndDate') || '';\r\n\t\t\t\treturn IX.inherit(elCfg, {\r\n\t\t\t\t\tmin : IX.inherit($XP(elCfg, 'min'), {\r\n\t\t\t\t\t\tvalue : IX.Date.getDateByFormat(Hualala.Common.formatDateTimeValue(eventStartDate), 'yyyy/MM/dd')\r\n\t\t\t\t\t}),\r\n\t\t\t\t\tmax : IX.inherit($XP(elCfg, 'max'), {\r\n\t\t\t\t\t\tvalue : IX.Date.getDateByFormat(Hualala.Common.formatDateTimeValue(eventEndDate), 'yyyy/MM/dd')\r\n\t\t\t\t\t})\r\n\t\t\t\t});\r\n\t\t\t} else if (type == 'checkboxgrp' && key == 'chkDeductPoints') {\r\n\t\t\t\tvar v = self.model.get('deductPoints') || 0,\r\n\t\t\t\t\toptions = _.map($XP(elCfg, 'options'), function (op) {\r\n\t\t\t\t\t\treturn IX.inherit(op, {\r\n\t\t\t\t\t\t\tchecked : v > 0 ? 'checked' : ''\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t});\r\n\t\t\t\treturn IX.inherit(elCfg, {\r\n\t\t\t\t\toptions : options\r\n\t\t\t\t});\r\n\t\t\t} else if (type == 'checkboxgrp' && key == 'chkSendPoints') {\r\n\t\t\t\tvar v = self.model.get('sendPoints') || 0,\r\n\t\t\t\t\toptions = _.map($XP(elCfg, 'options'), function (op) {\r\n\t\t\t\t\t\treturn IX.inherit(op, {\r\n\t\t\t\t\t\t\tchecked : v > 0 ? 'checked' : ''\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t});\r\n\t\t\t\treturn IX.inherit(elCfg, {\r\n\t\t\t\t\toptions : options\r\n\t\t\t\t});\r\n\t\t\t} else if (type == 'radiogrp' && key == 'radioCountCycleDays') {\r\n\t\t\t\tvar countCycleDays = self.model.get('countCycleDays') || 0,\r\n\t\t\t\t\tpartInTimes = self.model.get('partInTimes') || 0,\r\n\t\t\t\t\tv = 0;\r\n\t\t\t\tif (countCycleDays == 0 && partInTimes == 0) {\r\n\t\t\t\t\tv = 0;\r\n\t\t\t\t} else if (countCycleDays !== 0 && partInTimes != 0) {\r\n\t\t\t\t\tv = 2;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tv = 1;\r\n\t\t\t\t}\r\n\t\t\t\tvar options = _.map($XP(elCfg, 'options'), function (op) {\r\n\t\t\t\t\treturn IX.inherit(op, {\r\n\t\t\t\t\t\tchecked : v == $XP(op, 'value') ? 'checked' : ''\r\n\t\t\t\t\t});\r\n\t\t\t\t});\r\n\t\t\t\treturn IX.inherit(elCfg, {\r\n\t\t\t\t\toptions : options\r\n\t\t\t\t});\r\n\t\t\t} else if (type == 'inputCountCycleDays') {\r\n\t\t\t\tvar countCycleDays = self.model.get('countCycleDays') || 0,\r\n\t\t\t\t\tpartInTimes = self.model.get('partInTimes') || 0;\r\n\t\t\t\treturn IX.inherit(elCfg, {\r\n\t\t\t\t\tcountCycleDays : IX.inherit($XP(elCfg, 'countCycleDays'), {\r\n\t\t\t\t\t\toptions : _.map($XP(elCfg, 'countCycleDays.options'), function (el) {\r\n\t\t\t\t\t\t\treturn IX.inherit(el, {\r\n\t\t\t\t\t\t\t\tselected : $XP(el, 'value') == countCycleDays ? 'selected' : ''\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t}),\r\n\t\t\t\t\tpartInTimes : IX.inherit($XP(elCfg, 'partInTimes'), {\r\n\t\t\t\t\t\tvalue : partInTimes\r\n\t\t\t\t\t})\r\n\t\t\t\t});\r\n\t\t\t} else if (type == 'combo') {\r\n\t\t\t\tvar v = self.model.get(key) || $XP(elCfg, 'defaultVal'),\r\n\t\t\t\t\toptions = _.map($XP(elCfg, 'options'), function (op) {\r\n\t\t\t\t\t\treturn IX.inherit(op, {\r\n\t\t\t\t\t\t\tselected : $XP(op, 'value') == v ? 'selected' : ''\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t});\r\n\t\t\t\treturn IX.inherit(elCfg, {\r\n\t\t\t\t\tdisabled : (self.mode == 'edit' && key == 'giftType') ? 'disabled' : '',\r\n\t\t\t\t\tvalue : v,\r\n\t\t\t\t\toptions : options\r\n\t\t\t\t});\r\n\t\t\t} else if (type == 'radiogrp' || type == 'checkboxgrp') {\r\n\t\t\t\tvar v = self.model.get(key) || $XP(elCfg, 'defaultVal');\r\n\t\t\t\tif (type == 'checkboxgrp') {\r\n\t\t\t\t\tv = v.split(',');\r\n\t\t\t\t}\r\n\t\t\t\tvar options = _.map($XP(elCfg, 'options'), function (op) {\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tvar checked = type == 'checkboxgrp' ? (_.contains(v, $XP(op, 'value') + '') ? true : false) : ($XP(op, 'value') == v);\r\n\t\t\t\t\t\treturn IX.inherit(op, {\r\n\t\t\t\t\t\t\tchecked : checked ? 'checked' : ''\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t});\r\n\t\t\t\treturn IX.inherit(elCfg, {\r\n\t\t\t\t\toptions : options\r\n\t\t\t\t});\r\n\t\t\t} else {\r\n\t\t\t\treturn IX.inherit(elCfg, {\r\n\t\t\t\t\tvalue : self.model.get(key) || $XP(elCfg, 'defaultVal')\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t});\r\n\t\treturn ret;\r\n\t};\r\n\r\n\tvar EventRuleStepView = HMCM.EventBaseInfoStepView.subclass({\r\n\t\tconstructor : HMCM.EventBaseInfoStepView.prototype.constructor\r\n\t});\r\n\tEventRuleStepView.proto({\r\n\t\tinitBaseCfg : function () {\r\n\t\t\tthis.formKeys = EventRuleFormKeys;\r\n\t\t},\r\n\t\tinitUIComponents : function () {\r\n\t\t\tvar self = this;\r\n\t\t\tvar eventWay = self.model.get('eventWay');\r\n\t\t\tself.initDatePicker();\r\n\t\t\tself.setSwitcherLayout(self.container.find(':checkbox[name=chkDeductPoints]'));\r\n\t\t\tself.setSwitcherLayout(self.container.find(':checkbox[name=chkSendPoints]'));\r\n\t\t\tself.setRadioCountCycleDaysLayout(self.container.find(':radio[name=radioCountCycleDays]'));\r\n\t\t\tif (eventWay != 22) {\r\n\t\t\t\tself.container.find(':text[name=maxPartInPerson]').parents('.form-group').hide();\r\n\t\t\t} else {\r\n\t\t\t\tself.container.find(':text[name=maxPartInPerson]').parents('.form-group').show();\r\n\t\t\t}\r\n\t\t\tif (eventWay == 40 || eventWay == 41) {\r\n\t\t\t\tself.container.find(':checkbox[name=chkDeductPoints],:text[name=deductPoints]').parents('.form-group').hide();\r\n\t\t\t\t// self.container.find(':text[name=deductPoints]').parents('.form-group').hide();\r\n\t\t\t\tvar $el = self.container.find(':checkbox[name=chkSendPoints]').clone(true),\r\n\t\t\t\t\t$box = self.container.find(':checkbox[name=chkSendPoints]').parent();\r\n\t\t\t\t$box.empty().append($el).append('分享人获得积分');\r\n\t\t\t} else {\r\n\t\t\t\tself.container.find(':checkbox[name=chkDeductPoints],:text[name=deductPoints]').parents('.form-group').show();\r\n\t\t\t\tvar $el = self.container.find(':checkbox[name=chkSendPoints]').clone(true),\r\n\t\t\t\t\t$box = self.container.find(':checkbox[name=chkSendPoints]').parent();\r\n\t\t\t\t$box.empty().append($el).append('参与活动赠送积分');\r\n\t\t\t}\r\n\t\t},\r\n\t\tinitDatePicker : function () {\r\n\t\t\tvar self = this;\r\n\t\t\tself.container.find('[data-type=datetimepicker]').datetimepicker({\r\n\t\t\t\tformat : 'yyyy/mm/dd',\r\n\t\t\t\tstartDate : '2010/01/01',\r\n\t\t\t\tautoclose : true,\r\n\t\t\t\tminView : 'month',\r\n\t\t\t\ttodayBtn : true,\r\n\t\t\t\ttodayHighlight : true,\r\n\t\t\t\tlanguage : 'zh-CN'\r\n\t\t\t});\r\n\t\t},\r\n\t\tbindEvent : function () {\r\n\t\t\tvar self = this,\r\n\t\t\t\tfvOpts = self.initValidFieldOpts();\r\n\t\t\tself.container.find('form').bootstrapValidator({\r\n\t\t\t\ttrigger : 'blur',\r\n\t\t\t\tfields : fvOpts\r\n\t\t\t}).on('error.field.bv', function (e, data) {\r\n\t\t\t\tvar $form = $(e.target),\r\n\t\t\t\t\tbv = $form.data('bootstrapValidator');\r\n\t\t\t\tself.failFn(self.model);\r\n\t\t\t}).on('success.form.bv', function (e, data) {\r\n\t\t\t\te.preventDefault();\r\n\t\t\t\tvar $form = $(e.target),\r\n\t\t\t\t\tbv = $form.data('bootstrapValidator');\r\n\t\t\t\tvar act = self.mode + 'Event';\r\n\t\t\t\tvar formParams = self.serializeForm();\r\n\t\t\t\tIX.Debug.info(\"DEBUG: Event Wizard Form Params:\");\r\n\t\t\t\tIX.Debug.info(formParams);\r\n\t\t\t\tself.model.emit(act, {\r\n\t\t\t\t\tparams : formParams,\r\n\t\t\t\t\tfailFn : function () {\r\n\t\t\t\t\t\tself.failFn.call(self);\r\n\t\t\t\t\t},\r\n\t\t\t\t\tsuccessFn : function () {\r\n\t\t\t\t\t\tself.successFn.call(self);\r\n\t\t\t\t\t\tself.switchViewMode('edit');\r\n\t\t\t\t\t\t// self.parentView.modal.hide();\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t});\r\n\t\t\tself.container.find(':checkbox[name=chkDeductPoints]').on('change', function (e) {\r\n\t\t\t\tself.setSwitcherLayout($(this));\r\n\t\t\t\t\r\n\t\t\t});\r\n\t\t\tself.container.find(':checkbox[name=chkSendPoints]').on('change', function (e) {\r\n\t\t\t\tself.setSwitcherLayout($(this));\r\n\t\t\t});\r\n\t\t\tself.container.find(':radio[name=radioCountCycleDays]').on('change', function (e) {\r\n\t\t\t\tself.setRadioCountCycleDaysLayout($(this));\r\n\t\t\t});\r\n\t\t\tself.container.find('form [data-type=datetimepicker]').on('change', function (e) {\r\n\t\t\t\tvar $this = $(this),\r\n\t\t\t\t\tname = $this.attr('name');\r\n\t\t\t\tself.container.find('form').bootstrapValidator('revalidateField', name);\r\n\t\t\t});\r\n\t\t},\r\n\t\tsetSwitcherLayout : function ($chk) {\r\n\t\t\tvar checked = $chk.is(':checked');\r\n\t\t\tvar $nextFormGroup = $chk.parents('.form-group').next('.form-group');\r\n\t\t\t$nextFormGroup[checked ? 'removeClass' : 'addClass']('hidden');\r\n\t\t\t$nextFormGroup.find(':text').attr('disabled', checked ? false : true);\r\n\t\t},\r\n\t\tsetRadioCountCycleDaysLayout : function ($radio) {\r\n\t\t\tvar self = this;\r\n\t\t\tvar val = self.getRadiboxVal($radio.attr('name'));\r\n\t\t\tvar $nextFormGroup = $radio.parents('.form-group').next('.form-group'),\r\n\t\t\t\t$els = $nextFormGroup.find('.cycle-label, select[name=countCycleDays]'),\r\n\t\t\t\t$text = $nextFormGroup.find(':text[name=partInTimes]');\r\n\t\t\tif (val == 0) {\r\n\t\t\t\t$nextFormGroup.hide();\r\n\t\t\t\t$text.attr('disabled', true);\r\n\t\t\t} else if (val == 1) {\r\n\t\t\t\t$nextFormGroup.show();\r\n\t\t\t\t$els.addClass('hidden');\r\n\t\t\t\t$text.attr('disabled', false);\r\n\t\t\t} else {\r\n\t\t\t\t$nextFormGroup.show();\r\n\t\t\t\t$els.removeClass('hidden');\r\n\t\t\t\t$text.attr('disabled', false);\r\n\t\t\t}\r\n\t\t},\r\n\t\tgetCheckboxVal : function (name) {\r\n\t\t\tvar self = this;\r\n\t\t\tvar checkbox = $(':checkbox[name=' + name + ']:checked');\r\n\t\t\tvar ret = [];\r\n\t\t\tcheckbox.each(function (el) {\r\n\t\t\t\tvar $this = $(this);\r\n\t\t\t\tret.push($this.val());\r\n\t\t\t});\r\n\t\t\treturn ret.join(',');\r\n\t\t},\r\n\t\tgetRadiboxVal : function (name) {\r\n\t\t\tvar self = this;\r\n\t\t\tvar radiobox = $(':radio[name=' + name + ']:checked');\r\n\t\t\treturn radiobox.val();\r\n\t\t},\r\n\t\tinitValidFieldOpts : function () {\r\n\t\t\tvar self = this,\r\n\t\t\t\tformKeys = _.reject(self.formKeys, function (k) {return k == 'eventID'}),\r\n\t\t\t\tret = {};\r\n\t\t\t_.each(formKeys, function (key) {\r\n\t\t\t\tvar elCfg = EventSetFormElsHT.get(key),\r\n\t\t\t\t\ttype = $XP(elCfg, 'type');\r\n\t\t\t\tif (key == 'dateRange') {\r\n\t\t\t\t\tret['eventStartDate'] = $XP(elCfg, 'min.validCfg', {});\r\n\t\t\t\t\tret['eventEndDate'] = $XP(elCfg, 'max.validCfg', {});\r\n\t\t\t\t} else if (key == 'partInTimes') {\r\n\t\t\t\t\tret['partInTimes'] = $XP(elCfg, 'partInTimes.validCfg', {});\r\n\t\t\t\t} else {\r\n\t\t\t\t\tret[key] = $XP(elCfg, 'validCfg', {});\t\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t});\r\n\t\t\treturn ret;\r\n\t\t},\r\n\t\tserializeForm : function () {\r\n\t\t\t// \tvar EventRuleFormKeys = 'dateRange,chkDeductPoints,deductPoints,chkSendPoints,sendPoints,radioCountCycleDays,partInTimes,isVipBirthdayMonth,maxPartInPerson'.split(',');\r\n\t\t\tvar self = this,\r\n\t\t\t\tformKeys = self.formKeys,\r\n\t\t\t\tret = {};\r\n\r\n\t\t\tvar getDateRange = function () {\r\n\t\t\t\tvar start = IX.Date.getDateByFormat($(':text[name=eventStartDate]', self.container).val(), 'yyyyMMdd'),\r\n\t\t\t\t\tend = IX.Date.getDateByFormat($(':text[name=eventEndDate]', self.container).val(), 'yyyyMMdd');\r\n\t\t\t\treturn {eventStartDate : start, eventEndDate : end};\r\n\t\t\t};\r\n\t\t\tvar getDeductPoints = function () {\r\n\t\t\t\tvar eventWay = self.model.get('eventWay');\r\n\t\t\t\tif (eventWay == 40 || eventWay == 41) {\r\n\t\t\t\t\treturn 0;\r\n\t\t\t\t} else if (!$(':checkbox[name=chkDeductPoints]', self.container).is(':checked')) {\r\n\t\t\t\t\treturn 0;\r\n\t\t\t\t} else {\r\n\t\t\t\t\treturn $(':text[name=deductPoints]', self.container).val();\r\n\t\t\t\t}\r\n\t\t\t};\r\n\t\t\tvar getSendPoints = function () {\r\n\t\t\t\tvar eventWay = self.model.get('eventWay');\r\n\t\t\t\tif (!$(':checkbox[name=chkSendPoints]', self.container).is(':checked')) {\r\n\t\t\t\t\treturn 0;\r\n\t\t\t\t} else {\r\n\t\t\t\t\treturn $(':text[name=sendPoints]', self.container).val();\r\n\t\t\t\t}\r\n\t\t\t};\r\n\t\t\tvar getPartinTimesSet = function () {\r\n\t\t\t\tvar radioVal = self.getRadiboxVal('radioCountCycleDays');\r\n\t\t\t\tvar countCycleDays = 0, partInTimes = 0;\r\n\t\t\t\tcountCycleDays = radioVal < 2 ? 0 : $('[name=countCycleDays]', self.container).val();\r\n\t\t\t\tpartInTimes = radioVal == 0 ? 0 : $(':text[name=partInTimes]', self.container).val();\r\n\t\t\t\treturn {\r\n\t\t\t\t\tcountCycleDays : countCycleDays,\r\n\t\t\t\t\tpartInTimes : partInTimes\r\n\t\t\t\t};\r\n\t\t\t};\r\n\r\n\t\t\tvar formEls = _.map(formKeys, function (key) {\r\n\t\t\t\tvar elCfg = EventSetFormElsHT.get(key),\r\n\t\t\t\t\ttype = $XP(elCfg, 'type');\r\n\t\t\t\tvar v = null;\r\n\t\t\t\tswitch (key) {\r\n\t\t\t\t\tcase 'dateRange':\r\n\t\t\t\t\t\t\tv = getDateRange();\r\n\t\t\t\t\t\t\tret = IX.inherit(ret, v);\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 'chkDeductPoints':\r\n\t\t\t\t\tcase 'chkSendPoints':\r\n\t\t\t\t\tcase 'radioCountCycleDays':\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 'deductPoints':\r\n\t\t\t\t\t\tv = getDeductPoints();\r\n\t\t\t\t\t\tret['deductPoints'] = v;\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 'sendPoints':\r\n\t\t\t\t\t\tv = getSendPoints();\r\n\t\t\t\t\t\tret['sendPoints'] = v;\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 'partInTimes':\r\n\t\t\t\t\t\tv = getPartinTimesSet();\r\n\t\t\t\t\t\tret = IX.inherit(ret, v);\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 'isVipBirthdayMonth':\r\n\t\t\t\t\t\tv = self.getRadiboxVal(key);\r\n\t\t\t\t\t\tret[key] = v;\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 'maxPartInPerson':\r\n\t\t\t\t\t\tv = self.model.get('eventWay') == 22 ? $(':text[name=maxPartInPerson]', self.container).val() : 0;\r\n\t\t\t\t\t\tret[key] = v;\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t\treturn key;\r\n\t\t\t});\r\n\t\t\treturn ret;\r\n\t\t},\r\n\t\trefresh : function () {\r\n\t\t\tvar self = this;\r\n\t\t\tthis.formParams = this.model.getAll();\r\n\t\t\tself.initUIComponents();\r\n\t\t}\r\n\t});\r\n\r\n\tHMCM.EventRuleStepView = EventRuleStepView;\r\n\r\n\t/**\r\n\t * 创建向导中活动规则步骤\r\n\t * @param  {[type]} $cnt       [description]\r\n\t * @param  {[type]} cntID      [description]\r\n\t * @param  {[type]} wizardMode [description]\r\n\t * @return {[type]}            [description]\r\n\t */\r\n\tHMCM.initEventRuleStep = function ($cnt, cntID, wizardMode) {\r\n\t\tvar wizardModalView = this,\r\n\t\t\tstepView = new HMCM.EventRuleStepView({\r\n\t\t\t\tmode : wizardMode,\r\n\t\t\t\tcontainer : $cnt,\r\n\t\t\t\tparentView : wizardModalView,\r\n\t\t\t\tmodel : wizardModalView.model,\r\n\t\t\t\tsuccessFn : function () {\r\n\t\t\t\t\tvar self = this;\r\n\t\t\t\t\tself.parentView.switchWizardCtrlStatus('reset');\r\n\t\t\t\t\tself.parentView.getNextStep();\r\n\t\t\t\t},\r\n\t\t\t\tfailFn : function () {\r\n\t\t\t\t\tvar self = this;\r\n\t\t\t\t\tself.parentView.switchWizardCtrlStatus('reset');\r\n\t\t\t\t},\r\n\t\t\t\tmapFormElsData : mapEventRuleFormElsData\r\n\t\t\t});\r\n\t\twizardModalView.registerStepView(cntID, stepView);\r\n\t};\r\n})(jQuery, window);;(function ($, window) {\r\n\tIX.ns(\"Hualala.MCM\");\r\n\tvar HMCM = Hualala.MCM;\r\n\tvar popoverMsg = Hualala.UI.PopoverMsgTip,\r\n\t\ttoptip = Hualala.UI.TopTip;\r\n\r\n\tvar giftEffectTimeHours = Hualala.Common.getMinuteIntervalOptions({\r\n\t\tstartLabel : '立即生效',\r\n\t\tend : Hualala.Constants.SecondsOfDay / 60\r\n\t});\r\n\r\n\tvar EventGiftsSetHT = new IX.IListManager();\r\n\tvar EventGiftSetFormKeys = \"EGiftID,EGiftName,EGiftTotalCount,EGiftValidUntilDayCount,EGiftOdds,EGiftEffectTimeHours\".split(',');\r\n\tvar EventGiftLevelCount = 3;\r\n\tvar GiftLevelNames = [\"\", \"一等奖\",\"二等奖\",\"三等奖\"];\r\n\tvar EventGiftSetFormElsCfg = {\r\n\t\tEGiftID : {\r\n\t\t\ttype : 'hidden',\r\n\t\t\tdefaultVal : ''\r\n\t\t},\r\n\t\tEGiftName : {\r\n\t\t\ttype : 'pickgift',\r\n\t\t\tdefaultVal : '',\r\n\t\t\tlabel : '奖品名称',\r\n\t\t\tvalidCfg : {\r\n\t\t\t\tvalidators : {\r\n\t\t\t\t\tnotEmpty : {\r\n\t\t\t\t\t\tmessage : \"请选择奖品\"\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\tEGiftTotalCount : {\r\n\t\t\ttype : \"text\",\r\n\t\t\tlabel : \"奖品总数\",\r\n\t\t\tdefaultVal : \"0\",\r\n\t\t\t// prefix : '￥',\r\n\t\t\tsurfix : '个',\r\n\t\t\tvalidCfg : {\r\n\t\t\t\tvalidators : {\r\n\t\t\t\t\tnotEmpty : {\r\n\t\t\t\t\t\tmessage : \"请输入奖品总数\"\r\n\t\t\t\t\t},\r\n\t\t\t\t\tnumeric : {\r\n\t\t\t\t\t\tmessage : \"奖品总数必须为数字\"\r\n\t\t\t\t\t},\r\n\t\t\t\t\tgreaterThan : {\r\n\t\t\t\t\t\tinclusive : true,\r\n\t\t\t\t\t\tvalue : 0,\r\n\t\t\t\t\t\tmessage : \"奖品总数必须大于或等于0\"\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\tEGiftValidUntilDayCount : {\r\n\t\t\ttype : \"text\",\r\n\t\t\tlabel : \"有效天数\",\r\n\t\t\tdefaultVal : \"30\",\r\n\t\t\t// prefix : '￥',\r\n\t\t\tsurfix : '天',\r\n\t\t\tvalidCfg : {\r\n\t\t\t\tvalidators : {\r\n\t\t\t\t\tnotEmpty : {\r\n\t\t\t\t\t\tmessage : \"请输入有效天数\"\r\n\t\t\t\t\t},\r\n\t\t\t\t\tnumeric : {\r\n\t\t\t\t\t\tmessage : \"有效天数必须为数字\"\r\n\t\t\t\t\t},\r\n\t\t\t\t\tgreaterThan : {\r\n\t\t\t\t\t\tinclusive : true,\r\n\t\t\t\t\t\tvalue : 0,\r\n\t\t\t\t\t\tmessage : \"有效天数必须大于或等于0\"\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\tEGiftOdds : {\r\n\t\t\ttype : \"text\",\r\n\t\t\tlabel : \"中奖概率百分比\",\r\n\t\t\tdefaultVal : \"0\",\r\n\t\t\tsurfix : '%',\r\n\t\t\thelp : \"输入值在0.0001~100之间。如：0.01%表示万分之一的几率。\",\r\n\t\t\tvalidCfg : {\r\n\t\t\t\tvalidators : {\r\n\t\t\t\t\tnotEmpty : {\r\n\t\t\t\t\t\tmessage : \"请输入中奖概率\"\r\n\t\t\t\t\t},\r\n\t\t\t\t\tbetween : {\r\n\t\t\t\t\t\tmin : 0.0001,\r\n\t\t\t\t\t\tmax : 100,\r\n\t\t\t\t\t\tmessage : \"中奖概率百分比值在0.0001~100之间\"\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\tEGiftEffectTimeHours : {\r\n\t\t\ttype : \"combo\",\r\n\t\t\tlabel : \"生效时间\",\r\n\t\t\tdefaultVal : \"0\",\r\n\t\t\toptions : _.reduce(giftEffectTimeHours, function (memo, el, i) {\r\n\t\t\t\tif (i == 1) {\r\n\t\t\t\t\tmemo = [memo];\r\n\t\t\t\t}\r\n\t\t\t\treturn el.value >= 180 ? memo.concat(el) : memo;\r\n\t\t\t}),\r\n\t\t\tvalidCfg : {\r\n\t\t\t\tvalidators : {}\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n\r\n\tfor (var i = 1; i <= EventGiftLevelCount; i++) {\r\n\t\tvar labelClz = 'col-sm-offset-1 col-sm-3 control-label';\r\n\t\t_.each(EventGiftSetFormElsCfg, function (el, k) {\r\n\t\t\tvar key = k + '_' + i,\r\n\t\t\t\ttype = $XP(el, 'type');\r\n\r\n\t\t\tEventGiftsSetHT.register(key, IX.inherit(el, {\r\n\t\t\t\tid : key + '_' + IX.id(),\r\n\t\t\t\tname : key,\r\n\t\t\t\tlabelClz : labelClz,\r\n\t\t\t\tclz : 'col-sm-6'\r\n\t\t\t}));\r\n\t\t});\r\n\t}\r\n\r\n\t/**\r\n\t * 整理活动奖品表单渲染数据\r\n\t * @return {[type]} [description]\r\n\t */\r\n\tvar mapEventGiftFormElsData = function () {\r\n\t\tvar self = this,\r\n\t\t\tformKeys = self.formKeys;\r\n\t\tvar eventWay = self.model.get('eventWay');\r\n\t\tvar ret = [];\r\n\t\tfor (var i = 1; i <= EventGiftLevelCount; i++) {\r\n\t\t\tvar giftLevelName = GiftLevelNames[i],\r\n\t\t\t\tpanelClz = 'mcm-evtgift-panel ';\r\n\t\t\tvar EGiftID = self.model.get('EGiftID_' + i);\r\n\t\t\tif ((EGiftID != 0 && !IX.isEmpty(EGiftID)) || i == 1) {\r\n\t\t\t\tpanelClz += ' isActive ';\r\n\t\t\t}\r\n\t\t\tif (eventWay == 21 || eventWay == 30) {\r\n\t\t\t\tpanelClz += ' singlegift ';\r\n\t\t\t}\r\n\t\t\tvar addbtn = {clz : 'btn-warning btn-add', name : 'addGift', label : '添加中奖等级'},\r\n\t\t\t\tdelbtn = {clz : 'btn-default btn-del', name : 'deleteGift', label : '删除' + giftLevelName};\r\n\t\t\tvar giftSet = {\r\n\t\t\t\tgiftLevelName : giftLevelName,\r\n\t\t\t\tclz : panelClz,\r\n\t\t\t\tbtns : i == 1 ? [addbtn] : (i == EventGiftLevelCount ? [delbtn] : [delbtn,addbtn])\r\n\t\t\t};\r\n\t\t\tvar form = _.map(formKeys, function (k) {\r\n\t\t\t\tvar key = k + '_' + i,\r\n\t\t\t\t\telCfg = EventGiftsSetHT.get(key),\r\n\t\t\t\t\ttype = $XP(elCfg, 'type');\r\n\t\t\t\tvar v = null;\r\n\t\t\t\tif (type == 'combo') {\r\n\t\t\t\t\tvar v = self.model.get(key) || $XP(elCfg, 'defaultVal'),\r\n\t\t\t\t\t\toptions = _.map($XP(elCfg, 'options'), function (op) {\r\n\t\t\t\t\t\t\treturn IX.inherit(op, {\r\n\t\t\t\t\t\t\t\tselected : $XP(op, 'value') == v ? 'selected' : ''\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\treturn IX.inherit(elCfg, {\r\n\t\t\t\t\t\tvalue : v,\r\n\t\t\t\t\t\toptions : options\r\n\t\t\t\t\t});\r\n\t\t\t\t} else {\r\n\t\t\t\t\treturn IX.inherit(elCfg, {\r\n\t\t\t\t\t\tvalue : self.model.get(key) || $XP(elCfg, 'defaultVal')\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\tret.push(IX.inherit(giftSet, {\r\n\t\t\t\tisDivForm : true,\r\n\t\t\t\tformClz : 'mcm-evtgift-form',\r\n\t\t\t\titems : form\r\n\t\t\t\t// form : {\r\n\t\t\t\t// \tformClz : 'mcm-evtgift-form',\r\n\t\t\t\t// \titems : form\r\n\t\t\t\t// }\r\n\t\t\t}));\r\n\t\t}\r\n\t\treturn ret;\r\n\t};\r\n\r\n\r\n\tvar EventGiftSetStepView = Stapes.subclass({\r\n\t\tconstructor : function (cfg) {\r\n\t\t\tthis.mode = $XP(cfg, 'mode', '');\r\n\t\t\tthis.container = $XP(cfg, 'container', '');\r\n\t\t\tthis.parentView = $XP(cfg, 'parentView');\r\n\t\t\tthis.model = $XP(cfg, 'model');\r\n\t\t\tthis.successFn = $XF(cfg, 'successFn');\r\n\t\t\tthis.failFn = $XF(cfg, 'failFn');\r\n\r\n\t\t\tthis.mapFormElsData = $XF(cfg, 'mapFormElsData');\r\n\t\t\tif (!this.model || !this.parentView) {\r\n\t\t\t\tthrow(\"Event Gift Set View init faild!\");\r\n\t\t\t}\r\n\r\n\t\t\tthis.loadTemplates();\r\n\t\t\tthis.initBaseCfg();\r\n\t\t\t// this.formParams = this.model.getAll();\r\n\t\t\tthis.renderForm();\r\n\t\t\tthis.initUIComponents();\r\n\t\t\tthis.bindEvent();\r\n\t\t\t\r\n\t\t}\r\n\t});\r\n\tEventGiftSetStepView.proto({\r\n\t\tloadTemplates : function () {\r\n\t\t\tvar layoutTpl = Handlebars.compile(Hualala.TplLib.get('tpl_mcm_event_giftset')),\r\n\t\t\t\tformTpl = Handlebars.compile(Hualala.TplLib.get('tpl_mcm_base_form')),\r\n\t\t\t\tbtnTpl = Handlebars.compile(Hualala.TplLib.get('tpl_shop_modal_btns'));\r\n\t\t\tHandlebars.registerPartial(\"baseform\", Hualala.TplLib.get('tpl_mcm_base_form'));\r\n\t\t\tHandlebars.registerPartial(\"ctrlbtns\", Hualala.TplLib.get('tpl_shop_modal_btns'));\r\n\r\n\t\t\tHandlebars.registerHelper('checkFormElementType', function (conditional, options) {\r\n\t\t\t\treturn (conditional == options.hash.type) ? options.fn(this) : options.inverse(this);\r\n\t\t\t});\r\n\t\t\tHandlebars.registerHelper('isInputGroup', function (prefix, surfix, options) {\r\n\t\t\t\treturn (!prefix && !surfix) ? options.inverse(this) : options.fn(this);\r\n\t\t\t});\r\n\t\t\tthis.set({\r\n\t\t\t\tlayoutTpl : layoutTpl,\r\n\t\t\t\tformTpl : formTpl,\r\n\t\t\t\tbtnTpl : btnTpl\r\n\t\t\t});\r\n\t\t},\r\n\t\tinitBaseCfg : function () {\r\n\t\t\tthis.formKeys = EventGiftSetFormKeys;\r\n\t\t},\r\n\t\tinitUIComponents : function () {\r\n\t\t\tvar self = this;\r\n\t\t\tself.container.find('.isActive:last').addClass('isCurrent');\r\n\t\t},\r\n\t\tbindEvent : function () {\r\n\t\t\tvar self = this,\r\n\t\t\t\tfvOpts = self.initValidFieldOpts();\r\n\t\t\tself.container.on('click', '.panel-footer .btn', function (e) {\r\n\t\t\t\tvar $btn = $(this), act = $btn.attr('name');\r\n\t\t\t\tself.container.find('.mcm-evtgift-panel').removeClass('isCurrent');\r\n\t\t\t\tif (act == 'addGift') {\r\n\t\t\t\t\t$btn.parents('.mcm-evtgift-panel').next('.mcm-evtgift-panel').addClass('isActive isCurrent');\r\n\t\t\t\t} else {\r\n\t\t\t\t\t$btn.parents('.mcm-evtgift-panel').removeClass('isActive');\r\n\t\t\t\t\t$btn.parents('.mcm-evtgift-panel').prev('.mcm-evtgift-panel').addClass('isActive isCurrent');\r\n\t\t\t\t\tself.resetGiftSet($btn.parents('.mcm-evtgift-panel'));\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\tself.container.find('form').bootstrapValidator({\r\n\t\t\t\ttrigger : 'blur',\r\n\t\t\t\tfields : fvOpts\r\n\t\t\t}).on('error.field.bv', function (e, data) {\r\n\t\t\t\tvar $form = $(e.target),\r\n\t\t\t\t\tbv = $form.data('bootstrapValidator');\r\n\t\t\t\tself.failFn(self.model);\r\n\t\t\t}).on('success.form.bv', function (e, data) {\r\n\t\t\t\te.preventDefault();\r\n\t\t\t\tvar $form = $(e.target),\r\n\t\t\t\t\tbv = $form.data('bootstrapValidator');\r\n\t\t\t\tvar act = self.mode + 'Event';\r\n\t\t\t\tvar formParams = self.serializeForm();\r\n\t\t\t\tIX.Debug.info(\"DEBUG: Event Wizard Form Params:\");\r\n\t\t\t\tIX.Debug.info(formParams);\r\n\t\t\t\t\r\n\t\t\t\tself.model.emit('editEvent', {\r\n\t\t\t\t\tparams : formParams,\r\n\t\t\t\t\tfailFn : function () {\r\n\t\t\t\t\t\tself.failFn.call(self);\r\n\t\t\t\t\t},\r\n\t\t\t\t\tsuccessFn : function () {\r\n\t\t\t\t\t\tself.successFn.call(self);\r\n\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t});\r\n\r\n\t\t\tself.container.on('click', '.btn[name=pickgift]', function (e) {\r\n\t\t\t\tvar $btn = $(this);\r\n\t\t\t\tvar modal = new HMCM.PickGiftModal({\r\n\t\t\t\t\ttrigger : $btn,\r\n\t\t\t\t\tselectedFn : function (gift, $triggerEl) {\r\n\t\t\t\t\t\tvar giftID = $XP(gift, 'giftItemID', ''),\r\n\t\t\t\t\t\t\tgiftName = $XP(gift, 'giftName', '');\r\n\t\t\t\t\t\tvar panel = $triggerEl.parents('.mcm-evtgift-panel'),\r\n\t\t\t\t\t\t\tidx = parseInt(panel.attr('data-index')) + 1;\r\n\t\t\t\t\t\t$('[name=EGiftID_' + idx + ']', panel).val(giftID);\r\n\t\t\t\t\t\t$('[name=EGiftName_' + idx + ']', panel).val(giftName);\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t});\r\n\t\t},\r\n\t\tresetGiftSet : function ($panel) {\r\n\t\t\tvar self = this;\r\n\t\t\tvar idx = parseInt($panel.attr('data-index')) + 1;\r\n\t\t\tvar formKeys = self.formKeys;\r\n\t\t\t_.each(formKeys, function (k) {\r\n\t\t\t\tvar key = k + '_' + idx,\r\n\t\t\t\t\t$el = $('[name=' + key + ']', $panel);\r\n\t\t\t\tswitch (k) {\r\n\t\t\t\t\tcase \"EGiftID\":\r\n\t\t\t\t\tcase \"EGiftName\":\r\n\t\t\t\t\t\t$el.val('');\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase \"EGiftEffectTimeHours\":\r\n\t\t\t\t\tcase \"EGiftTotalCount\":\r\n\t\t\t\t\tcase \"EGiftOdds\":\r\n\t\t\t\t\t\t$el.val(0);\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase \"EGiftValidUntilDayCount\":\r\n\t\t\t\t\t\t$el.val(30);\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t},\r\n\t\trenderForm : function () {\r\n\t\t\tvar self = this,\r\n\t\t\t\trenderData = self.mapFormElsData.call(self),\r\n\t\t\t\ttpl = self.get('layoutTpl'),\r\n\t\t\t\thtm = tpl({\r\n\t\t\t\t\tgifts : renderData\r\n\t\t\t\t});\r\n\t\t\tself.container.html(htm);\r\n\t\t},\r\n\t\tinitValidFieldOpts : function () {\r\n\t\t\tvar self = this,\r\n\t\t\t\tformKeys = _.reject(self.formKeys, function (k) {return k == 'EGiftID'}),\r\n\t\t\t\tret = {};\r\n\t\t\tfor (var i = 1; i <= EventGiftLevelCount; i++) {\r\n\t\t\t\t_.each(formKeys, function (k) {\r\n\t\t\t\t\tvar key = k + '_' + i,\r\n\t\t\t\t\t\telCfg = EventGiftsSetHT.get(key),\r\n\t\t\t\t\t\ttype = $XP(elCfg, 'type');\r\n\t\t\t\t\tret[key] = $XP(elCfg, 'validCfg', {});\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t\treturn ret;\r\n\t\t\t\r\n\t\t},\r\n\t\tserializeForm : function () {\r\n\t\t\tvar self = this,\r\n\t\t\t\tformKeys = self.formKeys,\r\n\t\t\t\tret = {};\r\n\t\t\tfor (var i = 1; i <= EventGiftLevelCount; i++) {\r\n\t\t\t\t_.each(formKeys, function (k) {\r\n\t\t\t\t\tvar key = k + '_' + i;\r\n\t\t\t\t\tret[key] = $('[name=' + key + ']', self.container).val();\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t\treturn ret;\r\n\t\t}\r\n\t});\r\n\r\n\tHMCM.EventGiftSetStepView = EventGiftSetStepView;\r\n\r\n\r\n\t/**\r\n\t * 创建向导中活动奖品步骤\r\n\t * @param  {[type]} $cnt       [description]\r\n\t * @param  {[type]} cntID      [description]\r\n\t * @param  {[type]} wizardMode [description]\r\n\t * @return {[type]}            [description]\r\n\t */\r\n\tHMCM.initEventGiftSetStep = function ($cnt, cntID, wizardMode) {\r\n\t\tvar wizardModalView = this,\r\n\t\t\tstepView = new HMCM.EventGiftSetStepView({\r\n\t\t\t\tmode : wizardMode,\r\n\t\t\t\tcontainer : $cnt,\r\n\t\t\t\tparentView : wizardModalView,\r\n\t\t\t\tmodel : wizardModalView.model,\r\n\t\t\t\tsuccessFn : function () {\r\n\t\t\t\t\tvar self = this;\r\n\t\t\t\t\tself.parentView.switchWizardCtrlStatus('reset');\r\n\t\t\t\t\tself.parentView.getNextStep();\r\n\t\t\t\t},\r\n\t\t\t\tfailFn : function () {\r\n\t\t\t\t\tvar self = this;\r\n\t\t\t\t\tself.parentView.switchWizardCtrlStatus('reset');\r\n\t\t\t\t},\r\n\t\t\t\tmapFormElsData : mapEventGiftFormElsData\r\n\t\t\t});\r\n\t\twizardModalView.registerStepView(cntID, stepView);\r\n\t};\r\n\r\n\r\n})(jQuery, window);;(function ($, window) {\r\n\tIX.ns(\"Hualala.MCM\");\r\n\tvar HMCM = Hualala.MCM;\r\n\tvar popoverMsg = Hualala.UI.PopoverMsgTip,\r\n\t\ttoptip = Hualala.UI.TopTip;\r\n\r\n\tvar MCMGiftListHeaderCfg = [\r\n\t\t{key : \"giftType\", clz : \"\", label : \"礼品类型\"},\r\n\t\t{key : \"giftName\", clz : \"text\", label : \"礼品名称\"}\r\n\t];\r\n\r\n\tvar mapColItemRenderData = function (row, rowIdx, colKey) {\r\n\t\tvar self = this;\r\n\t\tvar ctx = Hualala.PageRoute.getPageContextByPath(), pageName = $XP(ctx, 'name'),\r\n\t\t\tqueryKeys = self.model.queryKeys;\r\n\t\tvar r = {value : \"\", text : \"\"}, v = $XP(row, colKey, '');\r\n\t\tvar formatDateTimeValue = Hualala.Common.formatDateTimeValue;\r\n\t\tswitch(colKey) {\r\n\t\t\t// 礼品列表各列参数\r\n\t\t\tcase \"giftType\":\r\n\t\t\t\tvar giftCardTpl = self.get('giftCardTpl'),\r\n\t\t\t\t\tgiftValue = $XP(row, 'giftValue', 0),\r\n\t\t\t\t\tgiftTypes = Hualala.TypeDef.MCMDataSet.GiftTypes,\r\n\t\t\t\t\tgiftType = _.find(giftTypes, function (el) {return $XP(el, 'value') == v;});\r\n\r\n\t\t\t\tr.value = v;\r\n\t\t\t\tr.text = $XP(giftType, 'label', '');\r\n\t\t\t\tbreak;\r\n\t\t\tdefault :\r\n\t\t\t\tr.value = r.text = $XP(row, colKey, '');\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\t\treturn r;\r\n\t};\r\n\r\n\tvar mapGiftsQueryResultRenderData = function (records) {\r\n\t\tvar self = this;\r\n\t\tvar ctx = Hualala.PageRoute.getPageContextByPath(), pageName = $XP(ctx, 'name');\r\n\t\tvar clz = \"col-md-12\",\r\n\t\t\ttblClz = \"  table-hover mcm-grid\",\r\n\t\t\ttblHeaders = MCMGiftListHeaderCfg;\r\n\t\tvar mapColsRenderData = function (row, idx) {\r\n\t\t\tvar colKeys = _.map(tblHeaders, function (el) {\r\n\t\t\t\treturn {key : $XP(el, 'key', ''), clz : $XP(el, 'clz', '')};\r\n\t\t\t});\r\n\t\t\tvar col = {clz : '', type : 'text'};\r\n\t\t\tvar cols = _.map(colKeys, function (k, i) {\r\n\t\t\t\tvar r = mapColItemRenderData.apply(self, [row, idx, $XP(k, 'key', '')]);\r\n\t\t\t\treturn IX.inherit(col, r, {clz : $XP(k, 'clz', '')});\r\n\t\t\t});\r\n\t\t\treturn cols;\r\n\t\t};\r\n\t\tvar rows = _.map(records, function (row, idx) {\r\n\t\t\tvar rowSet = {\r\n\t\t\t\tclz : '',\r\n\t\t\t\tcols : mapColsRenderData(row, idx)\r\n\t\t\t};\r\n\t\t\treturn rowSet;\r\n\t\t});\r\n\t\tvar tfoot = [{\r\n\t\t\tclz : 'hidden',\r\n\t\t\tcols : []\r\n\t\t}];\r\n\t\treturn {\r\n\t\t\tclz : clz,\r\n\t\t\ttblClz : tblClz,\r\n\t\t\tisEmpty : !records || records.length == 0 ? true : false,\r\n\t\t\tcolCount : tblHeaders.length,\r\n\t\t\tthead : tblHeaders,\r\n\t\t\trows : rows,\r\n\t\t\ttfoot : tfoot\r\n\t\t};\r\n\t};\r\n\r\n\t/**\r\n\t * 渲染搜索结果方法\r\n\t * @param  {[type]} data [description]\r\n\t * @return {[type]}      [description]\r\n\t */\r\n\tvar renderPickGiftQueryResult = function (data) {\r\n\t\tvar self = this;\r\n\t\tvar ctx = Hualala.PageRoute.getPageContextByPath(), pageName = $XP(ctx, 'name');\r\n\t\tself.$result.empty();\r\n\t\tself.$result.html(self.get('resultTpl')(data));\r\n\t};\r\n\r\n\tvar initQueryFormEls = function () {\r\n\t\tvar self = this,\r\n\t\t\tels = self.model.getQueryParams();\r\n\t\tself.initGiftTypeComboOpts($XP(els, 'giftType', ''));\r\n\t};\r\n\r\n\t/**\r\n\t * 绑定事件\r\n\t * @return {[type]} [description]\r\n\t */\r\n\tvar bundleGiftsQueryResultEvent = function () {\r\n\t\tvar self = this;\r\n\t\tself.$result.on('dblclick', '.mcm-grid > tbody > tr', function (e) {\r\n\t\t\tvar $tr = $(this);\r\n\t\t\tvar $p = $tr.find('p[data-value]');\r\n\t\t\t$tr.addClass('selected');\r\n\t\t});\r\n\t};\r\n\r\n\tvar PickGiftModal = Stapes.subclass({\r\n\t\tconstructor : function (cfg) {\r\n\t\t\tthis.trigger = $XP(cfg, 'trigger');\r\n\t\t\tthis.selectedFn = $XF(cfg, 'selectedFn');\r\n\t\t\tthis.modal = null;\r\n\t\t\tthis.$body = null;\r\n\t\t\tthis.panel = null;\r\n\t\t\tthis.initModal();\r\n\t\t\tthis.initPanel();\r\n\t\t\tthis.bindEvent();\r\n\t\t}\r\n\t});\r\n\tPickGiftModal.proto({\r\n\t\tinitModal : function () {\r\n\t\t\tvar self = this;\r\n\t\t\tself.modal = new Hualala.UI.ModalDialog({\r\n\t\t\t\tid : \"mcm_pickgift_modal\",\r\n\t\t\t\tclz : \"mcm-pickgift-modal\",\r\n\t\t\t\ttitle : \"选择礼品、奖品\",\r\n\t\t\t\thideCloseBtn : false,\r\n\t\t\t\tbackdrop : 'static',\r\n\t\t\t\tshowFooter : false,\r\n\t\t\t\tafterHide : function () {\r\n\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\tself.$body = self.modal._.body;\r\n\t\t\tself.modal.show();\r\n\t\t},\r\n\t\tinitPanel : function () {\r\n\t\t\tvar self = this;\r\n\t\t\tthis.panel = new HMCM.QueryController({\r\n\t\t\t\tcontainer : self.$body,\r\n\t\t\t\tresultController : new HMCM.QueryResultControler({\r\n\t\t\t\t\tcontainer : self.$body,\r\n\t\t\t\t\tmodel : new HMCM.GiftMgrResultModel({\r\n\t\t\t\t\t\tcallServer : Hualala.Global.getMCMGifts,\r\n\t\t\t\t\t\tqueryKeys : Hualala.MCM.QueryFormKeys.GiftMgrQueryKeys,\r\n\t\t\t\t\t\tgridType : 'giftlist',\r\n\t\t\t\t\t\trecordModel : HMCM.BaseGiftModel\r\n\t\t\t\t\t}),\r\n\t\t\t\t\tview : new HMCM.QueryResultView({\r\n\t\t\t\t\t\tmapResultRenderData : mapGiftsQueryResultRenderData,\r\n\t\t\t\t\t\trenderResult : renderPickGiftQueryResult,\r\n\t\t\t\t\t\tbundleEvent : bundleGiftsQueryResultEvent\r\n\t\t\t\t\t})\r\n\t\t\t\t}),\r\n\t\t\t\tmodel : new HMCM.QueryModel({\r\n\t\t\t\t\tqueryKeys : Hualala.MCM.QueryFormKeys.GiftMgrQueryKeys\r\n\t\t\t\t}),\r\n\t\t\t\tview : new HMCM.QueryView({\r\n\t\t\t\t\thasAddBtn : false,\r\n\t\t\t\t\tmapRenderDataFn : HMCM.mapGiftQueryFormRenderData,\r\n\t\t\t\t\tbundleQueryEvent : HMCM.bundleGiftsQueryEvent,\r\n\t\t\t\t\tinitQueryFormEls : initQueryFormEls\r\n\t\t\t\t})\r\n\r\n\t\t\t});\r\n\t\t},\r\n\t\tbindEvent : function () {\r\n\t\t\tvar self = this;\r\n\t\t\tself.$body.on('dblclick', '.mcm-grid > tbody > tr', function (e){\r\n\t\t\t\tvar $tr = $(this);\r\n\t\t\t\tvar $p = $tr.find('p[data-value]');\r\n\t\t\t\tself.selectedFn({\r\n\t\t\t\t\tgiftItemID : $p.eq(0).attr('data-value'),\r\n\t\t\t\t\tgiftName : $p.eq(1).attr('data-value')\r\n\t\t\t\t}, self.trigger);\r\n\t\t\t\tself.modal.hide();\r\n\t\t\t});\r\n\t\t}\r\n\t});\r\n\tHMCM.PickGiftModal = PickGiftModal;\r\n})(jQuery, window);;(function ($, window) {\r\n\tIX.ns(\"Hualala.MCM\");\r\n\tvar HMCM = Hualala.MCM;\r\n\tvar popoverMsg = Hualala.UI.PopoverMsgTip,\r\n\t\ttoptip = Hualala.UI.TopTip;\r\n\r\n\t/**\r\n\t * 整理活动配置渲染数据\r\n\t * @return {[type]} [description]\r\n\t */\r\n\tvar mapEventDetailData = function () {\r\n\t\tvar self = this,\r\n\t\t\tmodel = self.model;\r\n\t\tvar mapFn = HMCM.mapEventDetailRenderData;\r\n\t\tvar ret = mapFn.call(self, model);\r\n\r\n\t\treturn ret;\r\n\t};\r\n\r\n\tvar EventOpenStepView = Stapes.subclass({\r\n\t\tconstructor : function (cfg) {\r\n\t\t\tvar self = this;\r\n\t\t\tthis.mode = $XP(cfg, 'mode', '');\r\n\t\t\tthis.container = $XP(cfg, 'container', '');\r\n\t\t\tthis.parentView = $XP(cfg, 'parentView');\r\n\t\t\tthis.model = $XP(cfg, 'model');\r\n\t\t\tthis.successFn = $XF(cfg, 'successFn');\r\n\t\t\tthis.failFn = $XF(cfg, 'failFn');\r\n\r\n\t\t\tthis.mapFormElsData = $XF(cfg, 'mapFormElsData');\r\n\t\t\tif (!this.model || !this.parentView) {\r\n\t\t\t\tthrow(\"Event Base Info View init faild!\");\r\n\t\t\t}\r\n\r\n\t\t\tthis.loadTemplates();\r\n\t\t\tthis.renderForm();\r\n\t\t\tthis.initUIComponents();\r\n\t\t\tthis.bindEvent();\r\n\t\t}\r\n\t});\r\n\tEventOpenStepView.proto({\r\n\t\tloadTemplates : function () {\r\n\t\t\tvar layoutTpl = Handlebars.compile(Hualala.TplLib.get('tpl_event_openstep')),\r\n\t\t\t\tbtnTpl = Handlebars.compile(Hualala.TplLib.get('tpl_shop_modal_btns'));\r\n\t\t\tHandlebars.registerPartial('evtdetail', Hualala.TplLib.get('tpl_event_detail'));\r\n\t\t\tHandlebars.registerPartial(\"card\", Hualala.TplLib.get('tpl_event_card'));\r\n\t\t\tthis.set({\r\n\t\t\t\tlayoutTpl : layoutTpl,\r\n\t\t\t\tbtnTpl : btnTpl\r\n\t\t\t});\r\n\t\t},\r\n\t\trenderForm : function () {\r\n\t\t\tvar self = this;\r\n\t\t\tvar renderData = self.mapFormElsData.call(self),\r\n\t\t\t\ttpl = self.get('layoutTpl'),\r\n\t\t\t\thtm = tpl(renderData);\r\n\t\t\tself.container.html(htm);\r\n\t\t},\r\n\t\tinitUIComponents : function () {\r\n\r\n\t\t},\r\n\t\tbindEvent : function () {\r\n\r\n\t\t},\r\n\t\tsubmit : function () {\r\n\t\t\tvar self = this;\r\n\t\t\tvar eventID = self.model.get('eventID');\r\n\t\t\tself.model.emit('switchEvent', {\r\n\t\t\t\tparams : {\r\n\t\t\t\t\teventID : eventID,\r\n\t\t\t\t\tisActive : 1\r\n\t\t\t\t},\r\n\t\t\t\tfailFn : function () {\r\n\t\t\t\t\tself.failFn.call(self);\r\n\t\t\t\t},\r\n\t\t\t\tsuccessFn : function () {\r\n\t\t\t\t\tself.successFn.call(self);\r\n\t\t\t\t\tself.parentView.modal.hide();\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\t});\r\n\r\n\tHMCM.EventOpenStepView = EventOpenStepView;\r\n\r\n\t/**\r\n\t * 创建向导中活动开启步骤\r\n\t * @param  {[type]} $cnt       [description]\r\n\t * @param  {[type]} cntID      [description]\r\n\t * @param  {[type]} wizardMode [description]\r\n\t * @return {[type]}            [description]\r\n\t */\r\n\tHMCM.initEventOpenStep = function ($cnt, cntID, wizardMode) {\r\n\t\tvar wizardModalView = this,\r\n\t\t\tstepView = new HMCM.EventOpenStepView({\r\n\t\t\t\tmode : wizardMode,\r\n\t\t\t\tcontainer : $cnt,\r\n\t\t\t\tparentView : wizardModalView,\r\n\t\t\t\tmodel : wizardModalView.model,\r\n\t\t\t\tsuccessFn : function () {\r\n\t\t\t\t\tvar self = this;\r\n\t\t\t\t\tself.parentView.switchWizardCtrlStatus('reset');\r\n\t\t\t\t\tself.parentView.getNextStep();\r\n\t\t\t\t},\r\n\t\t\t\tfailFn : function () {\r\n\t\t\t\t\tvar self = this;\r\n\t\t\t\t\tself.parentView.switchWizardCtrlStatus('reset');\r\n\t\t\t\t},\r\n\t\t\t\tmapFormElsData : mapEventDetailData\r\n\t\t\t});\r\n\t\twizardModalView.registerStepView(cntID, stepView);\r\n\t};\r\n\t\r\n})(jQuery, window);;(function ($, window) {\r\n\tIX.ns(\"Hualala.MCM\");\r\n\tvar HMCM = Hualala.MCM;\r\n\tvar popoverMsg = Hualala.UI.PopoverMsgTip,\r\n\t\ttoptip = Hualala.UI.TopTip;\r\n\tvar BaseGiftSendModel = Stapes.subclass({\r\n\t\tconstructor : function (data) {\r\n\t\t\tthis.set(data);\r\n\t\t\tthis.bindEvent();\r\n\t\t}\r\n\t});\r\n\r\n\tBaseGiftSendModel.proto({\r\n\t\tbindEvent : function () {\r\n\t\t\tvar self = this;\r\n\t\t\tself.on({\r\n\r\n\t\t\t}, self);\r\n\t\t}\r\n\t});\r\n\r\n\tHMCM.BaseGiftSendModel = BaseGiftSendModel;\r\n\r\n\t/**\r\n\t * 获取礼品发出方式配置信息\r\n\t * @param  {[type]} val [description]\r\n\t * @return {[type]}     [description]\r\n\t */\r\n\tvar getGiftGetWayTypeSet = function (val) {\r\n\t\tvar items = Hualala.TypeDef.MCMDataSet.GiftDistributeTypes;\r\n\t\treturn _.find(items, function (el) {\r\n\t\t\treturn $XP(el, 'value') == val;\r\n\t\t});\r\n\t};\r\n\tHMCM.getGiftGetWayTypeSet = getGiftGetWayTypeSet;\r\n\r\n\t/**\r\n\t * 获取礼品状态配置信息\r\n\t * @param  {[type]} val [description]\r\n\t * @return {[type]}     [description]\r\n\t */\r\n\tvar getGiftStatusTypeSet = function (val) {\r\n\t\tvar items =  Hualala.TypeDef.MCMDataSet.GiftStatus;\r\n\t\treturn _.find(items, function (el) {\r\n\t\t\treturn $XP(el, 'value') == val;\r\n\t\t});\r\n\t};\r\n\tHMCM.getGiftStatusTypeSet = getGiftStatusTypeSet;\r\n\r\n\tvar MCMQueryGiftSendHeaderCfg = [\r\n\t\t{key : \"getWay\", clz : \"text\", label : \"发出方式\"},\r\n\t\t{key : \"createTime\", clz : \"date\", label : \"发出时间\"},\r\n\t\t{key : \"validUntilDate\", clz : \"date\", label : \"有效日期\"},\r\n\t\t{key : \"giftStatus\", clz : \"text\", label : \"状态\"},\r\n\t\t{key : \"userName\", clz : \"text\", label : \"姓名\"},\r\n\t\t{key : \"userSex\", clz : \"text\", label : \"性别\"},\r\n\t\t{key : \"userMobile\", clz : \"text\", label : \"手机号\"}\r\n\t];\r\n\r\n\tvar mapColItemRenderData = function (row, rowIdx, colKey) {\r\n\t\tvar self = this;\r\n\t\tvar r = {value : '', text : ''}, v = $XP(row, colKey, '');\r\n\t\tvar userInfo = $XP(row, 'userInfo', {});\r\n\t\tvar formatDateTimeValue = Hualala.Common.formatDateTimeValue;\r\n\t\tswitch(colKey) {\r\n\t\t\tcase \"getWay\":\r\n\t\t\t\tv = getGiftGetWayTypeSet(v);\r\n\t\t\t\tr.value = $XP(v, 'value', '');\r\n\t\t\t\tr.text = $XP(v, 'label', '');\r\n\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"createTime\":\r\n\t\t\t\tr.value = v;\r\n\t\t\t\tr.text = IX.Date.getDateByFormat(formatDateTimeValue(v), 'yyyy/MM/dd HH:mm');\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"validUntilDate\":\r\n\t\t\t\tr.value = v;\r\n\t\t\t\tr.text = IX.Date.getDateByFormat(formatDateTimeValue(v), 'yyyy/MM/dd');\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"giftStatus\":\r\n\t\t\t\tv = getGiftStatusTypeSet(v);\r\n\t\t\t\tr.value = $XP(v, 'value', '');\r\n\t\t\t\tr.text = $XP(v, 'label', '');\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"userName\":\r\n\t\t\t\tr.value = r.text = $XP(userInfo, 'userName', '');\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"userSex\":\r\n\t\t\t\tv = _.find(Hualala.TypeDef.GENDER, function (el) {\r\n\t\t\t\t\treturn $XP(el, 'value') == $XP(userInfo, 'userSex', '');\r\n\t\t\t\t});\r\n\t\t\t\tr.value = $XP(v, 'value', '');\r\n\t\t\t\tr.text = $XP(v, 'label', '');\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"userMobile\":\r\n\t\t\t\tr.value = r.text = $XP(userInfo, 'userMobile', '');\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\t\treturn r;\r\n\t};\r\n\r\n\t/**\r\n\t * 格式化礼品发送统计列表数据\r\n\t * @param  {[type]} records [description]\r\n\t * @return {[type]}         [description]\r\n\t */\r\n\tHMCM.mapGiftDetailQuerySendRenderData = function (records) {\r\n\t\tvar self = this;\r\n\t\tvar clz = 'col-md-12',\r\n\t\t\ttblClz = ' table-hover mcm-grid',\r\n\t\t\ttblHeaders = MCMQueryGiftSendHeaderCfg;\r\n\t\tvar mapColsRenderData = function (row, idx) {\r\n\t\t\tvar colKeys = _.map(tblHeaders, function (el) {\r\n\t\t\t\treturn {key : $XP(el, 'key', ''), clz : $XP(el, 'clz', '')};\r\n\t\t\t});\r\n\t\t\tvar col = {clz : '', type : 'text'};\r\n\t\t\tvar cols = _.map(colKeys, function (k, i) {\r\n\t\t\t\tvar r = mapColItemRenderData.apply(self, [row, idx, $XP(k, 'key', '')]);\r\n\t\t\t\treturn IX.inherit(col, r, {clz : $XP(k, 'clz', '')});\r\n\t\t\t});\r\n\t\t\treturn cols;\r\n\t\t};\r\n\t\tvar rows = _.map(records, function (row, idx) {\r\n\t\t\tvar rowSet = {\r\n\t\t\t\tclz : '',\r\n\t\t\t\tcols : mapColsRenderData(row, idx)\r\n\t\t\t};\r\n\t\t\treturn rowSet;\r\n\t\t});\r\n\t\tvar tfoot = [{\r\n\t\t\tclz : 'hidden',\r\n\t\t\tcols : []\r\n\t\t}];\r\n\t\treturn {\r\n\t\t\tclz : clz,\r\n\t\t\ttblClz : tblClz,\r\n\t\t\tisEmpty : !records || records.length == 0 ? true : false,\r\n\t\t\tcolCount : tblHeaders.length,\r\n\t\t\tthead : tblHeaders,\r\n\t\t\trows : rows,\r\n\t\t\ttfoot : tfoot\r\n\t\t};\r\n\t};\r\n\r\n})(jQuery, window);;(function ($, window) {\r\n\tIX.ns(\"Hualala.MCM\");\r\n\tvar HMCM = Hualala.MCM;\r\n\tvar popoverMsg = Hualala.UI.PopoverMsgTip,\r\n\t\ttoptip = Hualala.UI.TopTip;\r\n\tvar BaseGiftUsedModel = Stapes.subclass({\r\n\t\tconstructor : function (data) {\r\n\t\t\tthis.set(data);\r\n\t\t\tthis.bindEvent();\r\n\t\t}\r\n\t});\r\n\r\n\tBaseGiftUsedModel.proto({\r\n\t\tbindEvent : function () {\r\n\t\t\tvar self = this;\r\n\t\t\tself.on({\r\n\r\n\t\t\t}, self);\r\n\t\t}\r\n\t});\r\n\r\n\tHMCM.BaseGiftUsedModel = BaseGiftUsedModel;\r\n\r\n\tvar MCMQueryGiftUsedHeaderCfg = [\r\n\t\t{key : \"getWay\", clz : \"text\", label : \"获得方式\"},\r\n\t\t{key : \"createTime\", clz : \"date\", label : \"获得时间\"},\r\n\t\t{key : \"validUntilDate\", clz : \"date\", label : \"使用时间\"},\r\n\t\t{key : \"giftStatus\", clz : \"text\", label : \"使用店铺\"},\r\n\t\t{key : \"userName\", clz : \"text\", label : \"姓名\"},\r\n\t\t{key : \"userSex\", clz : \"text\", label : \"性别\"},\r\n\t\t{key : \"userMobile\", clz : \"text\", label : \"手机号\"}\r\n\t];\r\n\r\n\tvar mapColItemRenderData = function (row, rowIdx, colKey) {\r\n\t\tvar self = this;\r\n\t\tvar r = {value : '', text : ''}, v = $XP(row, colKey, '');\r\n\t\tvar userInfo = $XP(row, 'userInfo', {});\r\n\t\tvar formatDateTimeValue = Hualala.Common.formatDateTimeValue;\r\n\t\tswitch(colKey) {\r\n\t\t\tcase \"getWay\":\r\n\t\t\t\tv = HMCM.getGiftGetWayTypeSet(v);\r\n\t\t\t\tr.value = $XP(v, 'value', '');\r\n\t\t\t\tr.text = $XP(v, 'label', '');\r\n\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"createTime\":\r\n\t\t\t\tr.value = v;\r\n\t\t\t\tr.text = IX.Date.getDateByFormat(formatDateTimeValue(v), 'yyyy/MM/dd HH:mm');\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"validUntilDate\":\r\n\t\t\t\tr.value = v;\r\n\t\t\t\tr.text = IX.Date.getDateByFormat(formatDateTimeValue(v), 'yyyy/MM/dd');\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"giftStatus\":\r\n\t\t\t\tv = HMCM.getGiftStatusTypeSet(v);\r\n\t\t\t\tr.value = $XP(v, 'value', '');\r\n\t\t\t\tr.text = $XP(v, 'label', '');\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"userName\":\r\n\t\t\t\tr.value = r.text = $XP(userInfo, 'userName', '');\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"userSex\":\r\n\t\t\t\tv = _.find(Hualala.TypeDef.GENDER, function (el) {\r\n\t\t\t\t\treturn $XP(el, 'value') == $XP(userInfo, 'userSex', '');\r\n\t\t\t\t});\r\n\t\t\t\tr.value = $XP(v, 'value', '');\r\n\t\t\t\tr.text = $XP(v, 'label', '');\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"userMobile\":\r\n\t\t\t\tr.value = r.text = $XP(userInfo, 'userMobile', '');\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\t\treturn r;\r\n\t};\r\n\r\n\t/**\r\n\t * 格式化礼品发送统计列表数据\r\n\t * @param  {[type]} records [description]\r\n\t * @return {[type]}         [description]\r\n\t */\r\n\tHMCM.mapGiftDetailQueryUsedRenderData = function (records) {\r\n\t\tvar self = this;\r\n\t\tvar clz = 'col-md-12',\r\n\t\t\ttblClz = ' table-hover mcm-grid',\r\n\t\t\ttblHeaders = MCMQueryGiftUsedHeaderCfg;\r\n\t\tvar mapColsRenderData = function (row, idx) {\r\n\t\t\tvar colKeys = _.map(tblHeaders, function (el) {\r\n\t\t\t\treturn {key : $XP(el, 'key', ''), clz : $XP(el, 'clz', '')};\r\n\t\t\t});\r\n\t\t\tvar col = {clz : '', type : 'text'};\r\n\t\t\tvar cols = _.map(colKeys, function (k, i) {\r\n\t\t\t\tvar r = mapColItemRenderData.apply(self, [row, idx, $XP(k, 'key', '')]);\r\n\t\t\t\treturn IX.inherit(col, r, {clz : $XP(k, 'clz', '')});\r\n\t\t\t});\r\n\t\t\treturn cols;\r\n\t\t};\r\n\t\tvar rows = _.map(records, function (row, idx) {\r\n\t\t\tvar rowSet = {\r\n\t\t\t\tclz : '',\r\n\t\t\t\tcols : mapColsRenderData(row, idx)\r\n\t\t\t};\r\n\t\t\treturn rowSet;\r\n\t\t});\r\n\t\tvar tfoot = [{\r\n\t\t\tclz : 'hidden',\r\n\t\t\tcols : []\r\n\t\t}];\r\n\t\treturn {\r\n\t\t\tclz : clz,\r\n\t\t\ttblClz : tblClz,\r\n\t\t\tisEmpty : !records || records.length == 0 ? true : false,\r\n\t\t\tcolCount : tblHeaders.length,\r\n\t\t\tthead : tblHeaders,\r\n\t\t\trows : rows,\r\n\t\t\ttfoot : tfoot\r\n\t\t};\r\n\t};\r\n\r\n})(jQuery, window);;(function ($, window) {\r\n\tIX.ns(\"Hualala.MCM\");\r\n\tvar HMCM = Hualala.MCM;\r\n\tvar popoverMsg = Hualala.UI.PopoverMsgTip,\r\n\t\ttoptip = Hualala.UI.TopTip;\r\n\r\n\tHMCM.GiftDetailDonateGiftCtrlFormKeys = 'giftItemID,regMobile,giftCount,chkSendSms,smsContent'.split(',');\r\n\tHMCM.GiftDetailPayGiftCtrlFormKeys = 'giftItemID,regMobile,giftCount,validUntilDate,recirculable,getRemark,chkSendSms,smsContent'.split(',');\r\n\tHMCM.GiftDetailPayGiftOnlineCtrlFormKeys = 'giftItemID,voucherName,voucherValue,voucherTotalCount,voucherPrice,settleUnitID,settleUnitName,transTime,sponsorMobile,sponsorType'.split(',');\r\n\r\n\tvar FormElsCfg = {\r\n\t\tgiftItemID : {\r\n\t\t\ttype : 'hidden',\r\n\t\t\tdefaultVal : ''\r\n\t\t},\r\n\t\tregMobile : {\r\n\t\t\ttype : 'text',\r\n\t\t\tlabel : \"用户手机号码\",\r\n\t\t\tdefaultVal : \"\",\r\n\t\t\tvalidCfg : {\r\n\t\t\t\tvalidators : {\r\n\t\t\t\t\tnotEmpty : {\r\n\t\t\t\t\t\tmessage : \"请输入用户手机号\"\r\n\t\t\t\t\t},\r\n\t\t\t\t\tmobile : {\r\n\t\t\t\t\t\tmessage : \"请输入正确的手机号\"\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\tgiftCount : {\r\n\t\t\ttype : 'text',\r\n\t\t\tlabel : \"赠送张数\",\r\n\t\t\tdefaultVal : \"1\",\r\n\t\t\tvalidCfg : {\r\n\t\t\t\tvalidators : {\r\n\t\t\t\t\tnotEmpty : {\r\n\t\t\t\t\t\tmessage : \"请输入赠送张数\"\r\n\t\t\t\t\t},\r\n\t\t\t\t\tinteger : {\r\n\t\t\t\t\t\tmessage : \"请输入正确的赠送张数\"\r\n\t\t\t\t\t},\r\n\t\t\t\t\tbetween : {\r\n\t\t\t\t\t\tinclusive : true,\r\n\t\t\t\t\t\tmin : 1,\r\n\t\t\t\t\t\tmax : 100000,\r\n\t\t\t\t\t\tmessage : \"请输入大于1到100000之间的整数\"\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\tchkSendSms : {\r\n\t\t\ttype : 'switcher',\r\n\t\t\tlabel : '发送短信',\r\n\t\t\tdefaultVal : 1,\r\n\t\t\tonLabel : '发送',\r\n\t\t\toffLabel : '不发送',\r\n\t\t\tvalidCfg : {\r\n\t\t\t\tvalidators : {\r\n\t\t\t\t\t\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\tsmsContent : {\r\n\t\t\ttype : 'textarea',\r\n\t\t\tlabel : \"短信内容\",\r\n\t\t\tdefaultVal : \"\",\r\n\t\t\tvalidCfg : {\r\n\t\t\t\tvalidators : {\r\n\t\t\t\t\tnotEmpty : {\r\n\t\t\t\t\t\tmessage : \"请输入短信内容\"\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\tvalidUntilDate : {\r\n\t\t\ttype : 'text',\r\n\t\t\tlabel : \"券到期日\",\r\n\t\t\tdefaultVal : \"\",\r\n\t\t\t// readonly : \"readonly\",\r\n\t\t\tvalidCfg : {\r\n\t\t\t\tvalidators : {\r\n\t\t\t\t\tnotEmpty : {\r\n\t\t\t\t\t\tmessage : \"请选择券到期日\"\r\n\t\t\t\t\t},\r\n\t\t\t\t\tdate : {\r\n\t\t\t\t\t\tformat : \"YYYY/MM/DD\",\r\n\t\t\t\t\t\tmessage : \"请选择正确的日期\"\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\trecirculable : {\r\n\t\t\ttype : 'switcher',\r\n\t\t\tlabel : '转售',\r\n\t\t\tdefaultVal : 1,\r\n\t\t\tonLabel : '可以',\r\n\t\t\toffLabel : '不可以',\r\n\t\t\tvalidCfg : {\r\n\t\t\t\tvalidators : {\r\n\t\t\t\t\t\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\tgetRemark : {\r\n\t\t\ttype : \"textarea\",\r\n\t\t\tlabel : \"备注\",\r\n\t\t\tdefaultVal : \"\",\r\n\t\t\tvalidCfg : {\r\n\t\t\t\tvalidators : {\r\n\t\t\t\t\tnotEmpty : {\r\n\t\t\t\t\t\tmessage : \"请输入备注信息\"\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t},\r\n\t\tvoucherName : {\r\n\t\t\ttype : 'hidden',\r\n\t\t\tdefaultVal : ''\r\n\t\t},\r\n\t\tvoucherValue : {\r\n\t\t\ttype : 'hidden',\r\n\t\t\tdefaultVal : ''\r\n\t\t},\r\n\t\tvoucherTotalCount : {\r\n\t\t\ttype : 'text',\r\n\t\t\tlabel : \"数量\",\r\n\t\t\tdefaultVal : \"1\",\r\n\t\t\tvalidCfg : {\r\n\t\t\t\tvalidators : {\r\n\t\t\t\t\tnotEmpty : {\r\n\t\t\t\t\t\tmessage : \"请输入出售数量\"\r\n\t\t\t\t\t},\r\n\t\t\t\t\tinteger : {\r\n\t\t\t\t\t\tmessage : \"请输入正确的出售数量\"\r\n\t\t\t\t\t},\r\n\t\t\t\t\tbetween : {\r\n\t\t\t\t\t\tinclusive : true,\r\n\t\t\t\t\t\tmin : 1,\r\n\t\t\t\t\t\tmax : 100000,\r\n\t\t\t\t\t\tmessage : \"请输入大于1到100000之间的整数\"\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\tvoucherPrice : {\r\n\t\t\ttype : 'text',\r\n\t\t\tlabel : \"单价\",\r\n\t\t\tdefaultVal : \"\",\r\n\t\t\tvalidCfg : {\r\n\t\t\t\tvalidators : {\r\n\t\t\t\t\tnotEmpty : {\r\n\t\t\t\t\t\tmessage : \"请输入券单价\"\r\n\t\t\t\t\t},\r\n\t\t\t\t\tnumeric : {\r\n\t\t\t\t\t\tmessage : \"请输数字\"\r\n\t\t\t\t\t},\r\n\t\t\t\t\tcallback : {\r\n\t\t\t\t\t\tmessage : \"请输入正确格式的单价\",\r\n\t\t\t\t\t\tcallback : function (val, validator, $field) {\r\n\t\t\t\t\t\t\tvar s = val.toString().movePoint(2).split('.'),\r\n\t\t\t\t\t\t\t\tf = s[1];\r\n\t\t\t\t\t\t\tif (!f) {\r\n\t\t\t\t\t\t\t\treturn true;\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\tsettleUnitID : {\r\n\t\t\ttype : 'hidden',\r\n\t\t\tdefaultVal : ''\r\n\t\t},\r\n\t\tsettleUnitName : {\r\n\t\t\ttype : 'pickaccount',\r\n\t\t\tlabel : \"结算主体\",\r\n\t\t\tdisabled : 'disabled',\r\n\t\t\tvalidCfg : {\r\n\t\t\t\tvalidators : {\r\n\t\t\t\t\tnotEmpty : {\r\n\t\t\t\t\t\tmessage : \"选择结算主体\"\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\ttransTime : {\r\n\t\t\ttype : 'section',\r\n\t\t\tlabel : '出售日期',\r\n\t\t\tmin : {\r\n\t\t\t\ttype : 'datetimepicker',\r\n\t\t\t\t// surfix : '<span class=\"glyphicon glyphicon-calendar\"></span>',\r\n\t\t\t\tdefaultVal : '',\r\n\t\t\t\treadonly : 'readonly',\r\n\t\t\t\tvalidCfg : {\r\n\t\t\t\t\tgroup : '.min-input',\r\n\t\t\t\t\tvalidators : {\r\n\t\t\t\t\t\t// notEmpty : {\r\n\t\t\t\t\t\t// \tmessage : \"请输入起始时间\"\r\n\t\t\t\t\t\t// }\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tmax : {\r\n\t\t\t\ttype : 'datetimepicker',\r\n\t\t\t\t// surfix : '<span class=\"glyphicon glyphicon-calendar\"></span>',\r\n\t\t\t\tdefaultVal : '',\r\n\t\t\t\treadonly : 'readonly',\r\n\t\t\t\tvalidCfg : {\r\n\t\t\t\t\tgroup : '.max-input',\r\n\t\t\t\t\tvalidators : {\r\n\t\t\t\t\t\t// notEmpty : {\r\n\t\t\t\t\t\t// \tmessage : \"请输入结束时间\"\r\n\t\t\t\t\t\t// }\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\tsponsorMobile : {\r\n\t\t\ttype : 'text',\r\n\t\t\tlabel : \"联系电话\",\r\n\t\t\tdefaultVal : \"\",\r\n\t\t\tvalidCfg : {\r\n\t\t\t\tvalidators : {\r\n\t\t\t\t\tnotEmpty : {\r\n\t\t\t\t\t\tmessage : \"请输入联系电话\"\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t};\r\n\r\n\tvar FormElsHT = new IX.IListManager();\r\n\t_.each(FormElsCfg, function (el, k) {\r\n\t\tvar type = $XP(el, 'type');\r\n\t\tvar labelClz = 'col-sm-offset-1 col-sm-3 control-label';\r\n\t\tif (type == 'section') {\r\n\t\t\tvar id = minID = k + '_min_' + IX.id(), maxID = k + '_max_' + IX.id(),\r\n\t\t\t\tminName = 'transStartTime',\r\n\t\t\t\tmaxName = 'transEndTime',\r\n\t\t\t\tmin = IX.inherit($XP(el, 'min', {}), {\r\n\t\t\t\t\tid : minID, name : minName, clz : 'col-xs-3 col-sm-3 col-md-3',\r\n\t\t\t\t}), max = IX.inherit($XP(el, 'max', {}), {\r\n\t\t\t\t\tid : maxID, name : maxName, clz : 'col-xs-3 col-sm-3 col-md-3',\r\n\t\t\t\t});\r\n\t\t\tFormElsHT.register(k, IX.inherit(el, {\r\n\t\t\t\tid : id,\r\n\t\t\t\tlabelClz : labelClz,\r\n\t\t\t\tmin : min,\r\n\t\t\t\tmax : max\r\n\t\t\t}));\r\n\t\t} else {\r\n\t\t\tFormElsHT.register(k, IX.inherit(el, {\r\n\t\t\t\tid : k + '_' + IX.id(),\r\n\t\t\t\tname : k,\r\n\t\t\t\tlabelClz : labelClz,\r\n\t\t\t\tclz : 'col-sm-5'\r\n\t\t\t}));\r\n\t\t}\r\n\t});\r\n\r\n\t/**\r\n\t * 整理赠送礼品表单元素渲染数据\r\n\t * @return {[type]} [description]\r\n\t */\r\n\tHMCM.mapDonateGiftFormRenderData = function () {\r\n\t\tvar self = this,\r\n\t\t\tformKeys = self.formKeys,\r\n\t\t\tparentView = self.parentView;\r\n\t\tvar ret = _.map(formKeys, function (key) {\r\n\t\t\tvar elCfg = FormElsHT.get(key),\r\n\t\t\t\ttype = $XP(elCfg, 'type');\r\n\t\t\t\r\n\t\t\treturn IX.inherit(elCfg, {\r\n\t\t\t\tid : $XP(elCfg, 'id', '') + '_' + IX.id().replaceAll('ix', ''),\r\n\t\t\t\tvalue : key == 'giftItemID' ? $XP(parentView, 'giftItemID', '') : $XP(elCfg, 'defaultVal', '')\r\n\t\t\t});\r\n\t\t});\r\n\t\treturn ret;\r\n\t};\r\n\r\n\t/**\r\n\t * 整理支付礼品表单元素渲染数据\r\n\t * @return {[type]} [description]\r\n\t */\r\n\tHMCM.mapPayGiftFormRenderData = function () {\r\n\t\tvar self = this,\r\n\t\t\tformKeys = self.formKeys,\r\n\t\t\tparentView = self.parentView;\r\n\t\tvar ret = _.map(formKeys, function (key) {\r\n\t\t\tvar elCfg = FormElsHT.get(key),\r\n\t\t\t\ttype = $XP(elCfg, 'type');\r\n\t\t\treturn IX.inherit(elCfg, {\r\n\t\t\t\tid : $XP(elCfg, 'id', '') + '_' + IX.id().replaceAll('ix', ''),\r\n\t\t\t\tvalue : key == 'giftItemID' ? $XP(parentView, 'giftItemID', '') : $XP(elCfg, 'defaultVal', ''),\r\n\t\t\t\tlabel : key == 'giftCount' ? '支付张数' : $XP(elCfg, 'label', '')\r\n\t\t\t});\r\n\t\t});\r\n\t\treturn ret;\r\n\t};\r\n\r\n\t/**\r\n\t * 整理网上出售表单元素渲染数据\r\n\t * @return {[type]} [description]\r\n\t */\r\n\tHMCM.mapPayGiftOnlineFormRenderData = function () {\r\n\t\tvar self = this,\r\n\t\t\tformKeys = self.formKeys,\r\n\t\t\tparentView = self.parentView;\r\n\t\tvar ret = _.map(formKeys, function (key) {\r\n\t\t\tvar elCfg = FormElsHT.get(key),\r\n\t\t\t\ttype = $XP(elCfg, 'type');\r\n\t\t\treturn IX.inherit(elCfg, {\r\n\t\t\t\tid : $XP(elCfg, 'id', '') + '_' + IX.id().replaceAll('ix', ''),\r\n\t\t\t\tvalue : key == 'giftItemID' ? $XP(parentView, 'giftItemID', '') : $XP(elCfg, 'defaultVal', '')\r\n\t\t\t});\r\n\t\t});\r\n\t\treturn ret;\r\n\t};\t\r\n\r\n\t/**\r\n\t * 创建赠送礼品表单的UI控件\r\n\t * \r\n\t * @return {[type]} [description]\r\n\t */\r\n\tHMCM.initDonateGiftFormUIComponent = function () {\r\n\t\tvar self = this;\r\n\t\tvar btnTpl = self.get('btnTpl');\r\n\t\tself.$form.find('textarea[name=smsContent]').parents('.form-group').hide();\r\n\t\tself.$form.find(':checkbox[name=chkSendSms]').each(function () {\r\n\t\t\tvar $el = $(this),\r\n\t\t\t\tonLabel = $el.attr('data-onLabel'),\r\n\t\t\t\toffLabel = $el.attr('data-offLabel');\r\n\t\t\t$el.bootstrapSwitch({\r\n\t\t\t\tsize : 'normal',\r\n\t\t\t\tonColor : 'primary',\r\n\t\t\t\toffColor : 'default',\r\n\t\t\t\tonText : onLabel,\r\n\t\t\t\toffText : offLabel\r\n\t\t\t});\r\n\t\t});\r\n\t\tself.$panelFooter.html(btnTpl({\r\n\t\t\tbtns : [\r\n\t\t\t\t{clz : 'btn-warning pull-right', name : 'submit', label : '确认赠送'}\r\n\t\t\t]\r\n\t\t}));\r\n\r\n\t};\r\n\r\n\t/**\r\n\t * 创建支付礼品表单UI控件\r\n\t * @return {[type]} [description]\r\n\t */\r\n\tHMCM.initPayGiftFormUIComponent = function () {\r\n\t\tvar self = this;\r\n\t\tvar btnTpl = self.get('btnTpl');\r\n\t\tself.$form.find('textarea[name=smsContent]').parents('.form-group').hide();\r\n\t\tself.$form.find(':checkbox[name=chkSendSms], :checkbox[name=recirculable]').each(function () {\r\n\t\t\tvar $el = $(this),\r\n\t\t\t\tonLabel = $el.attr('data-onLabel'),\r\n\t\t\t\toffLabel = $el.attr('data-offLabel');\r\n\t\t\t$el.bootstrapSwitch({\r\n\t\t\t\tsize : 'normal',\r\n\t\t\t\tonColor : 'primary',\r\n\t\t\t\toffColor : 'default',\r\n\t\t\t\tonText : onLabel,\r\n\t\t\t\toffText : offLabel\r\n\t\t\t});\r\n\t\t});\r\n\t\tself.$form.find(':text[name=validUntilDate]').datetimepicker({\r\n\t\t\tformat : 'yyyy/mm/dd',\r\n\t\t\tstartDate : '2010/01/01',\r\n            autoclose : true,\r\n            minView : 'month',\r\n            todayBtn : true,\r\n            todayHighlight : true,\r\n            language : 'zh-CN'\r\n\t\t});\r\n\t\tself.$panelFooter.html(btnTpl({\r\n\t\t\tbtns : [\r\n\t\t\t\t{clz : 'btn-warning pull-right', name : 'submit', label : '确认支付'}\r\n\t\t\t]\r\n\t\t}));\r\n\t};\r\n\r\n\r\n\t/**\r\n\t * 创建网上出售礼品表单UI控件\r\n\t * \r\n\t * @return {[type]} [description]\r\n\t */\r\n\tHMCM.initPayGiftOnlineFormUIComponent = function () {\r\n\t\tvar self = this;\r\n\t\tvar btnTpl = self.get('btnTpl');\r\n\t\tself.$form.find('[data-type=datetimepicker]').datetimepicker({\r\n\t\t\tformat : 'yyyy/mm/dd',\r\n\t\t\tstartDate : '2010/01/01',\r\n            autoclose : true,\r\n            minView : 'month',\r\n            todayBtn : true,\r\n            todayHighlight : true,\r\n            language : 'zh-CN'\r\n\t\t});\r\n\t\tself.$panelFooter.html(btnTpl({\r\n\t\t\tbtns : [\r\n\t\t\t\t{clz : 'btn-warning pull-right', name : 'submit', label : '申请出售'}\r\n\t\t\t]\r\n\t\t}));\r\n\t\tinitAccountChosenPanel.call(self);\r\n\t};\r\n\r\n\tHMCM.bundleDonateGiftFormEvent = function () {\r\n\t\tvar self = this;\r\n\t\tvar parentView = self.parentView,\r\n\t\t\tmGiftDetail = parentView.mGiftDetail;\r\n\t\tvar $smsContent = self.$form.find('textarea[name=smsContent]');\r\n\t\tvar fvOpts = initDonateGiftValidFieldOpts.call(self);\r\n\t\tself.$form.find(':checkbox[name=chkSendSms]').on('switchChange.bootstrapSwitch', function (e, state) {\r\n\t\t\tvar $el = $(this);\r\n\t\t\tif (state == 1) {\r\n\t\t\t\t$smsContent.val(genSMSMessage.call(self));\r\n\t\t\t\t$smsContent.parents('.form-group').show();\r\n\t\t\t} else {\r\n\t\t\t\tself.$form.find('textarea[name=smsContent]').parents('.form-group').hide();\r\n\t\t\t}\r\n\t\t});\r\n\t\tself.$form.on('keyup', ':text[name=giftCount]', function (e) {\r\n\t\t\tvar $input = $(this);\r\n\t\t\tvar msg = genSMSMessage.call(self);\r\n\t\t\tself.$form.find('textarea[name=smsContent]').val(msg);\r\n\t\t});\r\n\t\tself.$form.bootstrapValidator({\r\n\t\t\ttrigger : 'blur',\r\n\t\t\tfields : fvOpts\r\n\t\t}).on('error.field.bv', function (e, data) {\r\n\t\t\tvar $form = $(e.target),\r\n\t\t\t\tbv = $form.data('bootstrapValidator');\r\n\t\t\t// self.failFn(self.model);\r\n\t\t}).on('success.form.bv', function (e, data) {\r\n\t\t\te.preventDefault();\r\n\t\t\tvar $form = $(e.target),\r\n\t\t\t\tbv = $form.data('bootstrapValidator');\r\n\t\t\tvar formParams = serializeDonateGiftForm.call(self);\r\n\t\t\tIX.Debug.info(\"DEBUG: Donate Gift Form Params:\");\r\n\t\t\tIX.Debug.info(formParams);\r\n\t\t\tHualala.Global.giftDetailDonateGift(formParams, function (res) {\r\n\t\t\t\tif ($XP(res, 'resultcode', '000')) {\r\n\t\t\t\t\ttoptip({\r\n\t\t\t\t\t\tmsg : \"提交成功\",\r\n\t\t\t\t\t\ttype : 'success'\r\n\t\t\t\t\t});\r\n\t\t\t\t\tself.initFormPanel();\r\n\t\t\t\t} else {\r\n\t\t\t\t\ttoptip({\r\n\t\t\t\t\t\tmsg : $XP(res, 'resultmsg', ''),\r\n\t\t\t\t\t\ttype : 'danger'\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t});\r\n\t\tself.$panelFooter.find('.btn[name=submit]').on('click', function (e) {\r\n\t\t\tvar bv = self.$form.data('bootstrapValidator');\r\n\t\t\tbv.validate();\r\n\t\t});\r\n\t};\r\n\r\n\tHMCM.bundlePayGiftFormEvent = function () {\r\n\t\tvar self = this;\r\n\t\tvar parentView = self.parentView,\r\n\t\t\tmGiftDetail = parentView.mGiftDetail;\r\n\t\tvar $smsContent = self.$form.find('textarea[name=smsContent]');\r\n\t\tvar fvOpts = initPayGiftValidFieldOpts.call(self);\r\n\t\tself.$form.find(':checkbox[name=chkSendSms]').on('switchChange.bootstrapSwitch', function (e, state) {\r\n\t\t\tvar $el = $(this);\r\n\t\t\tif (state == 1) {\r\n\t\t\t\t$smsContent.val(genSMSMessage.call(self));\r\n\t\t\t\t$smsContent.parents('.form-group').show();\r\n\t\t\t} else {\r\n\t\t\t\tself.$form.find('textarea[name=smsContent]').parents('.form-group').hide();\r\n\t\t\t}\r\n\t\t});\r\n\t\tself.$form.on('keyup', ':text[name=giftCount]', function (e) {\r\n\t\t\tvar $input = $(this);\r\n\t\t\tvar msg = genSMSMessage.call(self);\r\n\t\t\tself.$form.find('textarea[name=smsContent]').val(msg);\r\n\t\t});\r\n\t\tself.$form.bootstrapValidator({\r\n\t\t\ttrigger : 'blur',\r\n\t\t\tfields : fvOpts\r\n\t\t}).on('error.field.bv', function (e, data) {\r\n\t\t\tvar $form = $(e.target),\r\n\t\t\t\tbv = $form.data('bootstrapValidator');\r\n\t\t\t// self.failFn(self.model);\r\n\t\t}).on('success.form.bv', function (e, data) {\r\n\t\t\te.preventDefault();\r\n\t\t\tvar $form = $(e.target),\r\n\t\t\t\tbv = $form.data('bootstrapValidator');\r\n\t\t\tvar formParams = serializePayGiftForm.call(self);\r\n\t\t\t\r\n\t\t\tIX.Debug.info(\"DEBUG: Pay Gift Form Params:\");\r\n\t\t\tIX.Debug.info(formParams);\r\n\t\t\tHualala.Global.giftDetailDonateGift(formParams, function (res) {\r\n\t\t\t\tif ($XP(res, 'resultcode', '000')) {\r\n\t\t\t\t\ttoptip({\r\n\t\t\t\t\t\tmsg : \"提交成功\",\r\n\t\t\t\t\t\ttype : 'success'\r\n\t\t\t\t\t});\r\n\t\t\t\t\tself.initFormPanel();\r\n\t\t\t\t} else {\r\n\t\t\t\t\ttoptip({\r\n\t\t\t\t\t\tmsg : $XP(res, 'resultmsg', ''),\r\n\t\t\t\t\t\ttype : 'danger'\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\t\r\n\t\t});\r\n\t\tself.$panelFooter.find('.btn[name=submit]').on('click', function (e) {\r\n\t\t\tvar bv = self.$form.data('bootstrapValidator');\r\n\t\t\tbv.validate();\r\n\t\t});\r\n\t\tself.$form.find(':text[name=validUntilDate]').on('change', function (e) {\r\n\t\t\tself.$form.bootstrapValidator('revalidateField', 'validUntilDate');\r\n\t\t});\r\n\t};\r\n\r\n\tHMCM.bundlePayGiftOnlineFormEvent = function () {\r\n\t\tvar self = this;\r\n\t\tvar parentView = self.parentView,\r\n\t\t\tmGiftDetail = parentView.mGiftDetail;\r\n\t\tvar fvOpts = initPayGiftOnlineValidFieldOpts.call(self);\r\n\t\tself.$form.bootstrapValidator({\r\n\t\t\ttrigger : 'blur',\r\n\t\t\tfields : fvOpts\r\n\t\t}).on('error.field.bv', function (e, data) {\r\n\t\t\tvar $form = $(e.target),\r\n\t\t\t\tbv = $form.data('bootstrapValidator');\r\n\t\t\t// self.failFn(self.model);\r\n\t\t}).on('success.form.bv', function (e, data) {\r\n\t\t\te.preventDefault();\r\n\t\t\tvar $form = $(e.target),\r\n\t\t\t\tbv = $form.data('bootstrapValidator');\r\n\t\t\tvar formParams = serializePayGiftOnlineForm.call(self);\r\n\t\t\t\r\n\t\t\tIX.Debug.info(\"DEBUG: Pay Gift Online Form Params:\");\r\n\t\t\tIX.Debug.info(formParams);\r\n\t\t\tHualala.Global.giftDetailPayGiftOnline(formParams, function (res) {\r\n\t\t\t\tif ($XP(res, 'resultcode', '000')) {\r\n\t\t\t\t\ttoptip({\r\n\t\t\t\t\t\tmsg : \"提交成功\",\r\n\t\t\t\t\t\ttype : 'success'\r\n\t\t\t\t\t});\r\n\t\t\t\t\tself.initFormPanel();\r\n\t\t\t\t} else {\r\n\t\t\t\t\ttoptip({\r\n\t\t\t\t\t\tmsg : $XP(res, 'resultmsg', ''),\r\n\t\t\t\t\t\ttype : 'danger'\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\t\r\n\t\t});\r\n\t\tself.$panelFooter.find('.btn[name=submit]').on('click', function (e) {\r\n\t\t\tvar bv = self.$form.data('bootstrapValidator');\r\n\t\t\tbv.validate();\r\n\t\t});\r\n\t};\r\n\r\n\r\n\t/**\r\n\t * 生成短信模板\r\n\t * @return {[type]} [description]\r\n\t */\r\n\tvar genSMSMessage = function () {\r\n\t\tvar self = this,\r\n\t\t\tparentView = self.parentView,\r\n\t\t\tmGiftDetail = parentView.mGiftDetail,\r\n\t\t\tgiftInfo = mGiftDetail.get('records')[0];\r\n\t\tvar siteInfo = Hualala.getSessionSite();\r\n\t\tvar groupName = $XP(siteInfo, 'groupName', '');\r\n\t\tvar giftCount = self.$form.find(':text[name=\"giftCount\"]').val();\r\n\t\tvar tpl = Handlebars.compile(Hualala.TplLib.get('tpl_gift_sms'));\r\n\t\tvar msg = tpl({\r\n\t\t\tgroupName : groupName,\r\n\t\t\tgiftCount : giftCount,\r\n\t\t\tgiftName : $XP(giftInfo, 'giftName', ''),\r\n\t\t\tsite : Hualala.Global.HualalaWebSite\r\n\t\t});\r\n\t\treturn msg;\r\n\t};\r\n\r\n\tvar renderChosenPanelOptions = function (sections) {\r\n\t\tvar self = this;\r\n\t\tvar optTpl = Handlebars.compile(Hualala.TplLib.get('tpl_account_opt'));\r\n\t\tvar renderData = _.map(sections, function (el) {\r\n\t\t\treturn IX.inherit(el, {\r\n\t\t\t\tname : el.settleUnitName,\r\n\t\t\t\tvalue : el.settleUnitID\r\n\t\t\t});\r\n\t\t});\r\n\t\trenderData.unshift({\r\n\t\t\tname : '',\r\n\t\t\tvalue : ''\r\n\t\t});\r\n\t\tself.$form.find('select[name=settleUnitName]').html(optTpl({\r\n\t\t\titems : renderData\r\n\t\t}));\r\n\r\n\t};\r\n\r\n\tvar initAccountChosenPanel = function () {\r\n\t\tvar self = this;\r\n\t\tvar matcher = (new Pymatch([]));\r\n\t\tvar sections = [];\r\n\t\tHualala.Global.queryAccount({}, function (res) {\r\n\t\t\tif ($XP(res, 'resultcode') == '000') {\r\n\t\t\t\tsections = $XP(res, 'data.records', []);\r\n\t\t\t\trenderChosenPanelOptions.call(self, sections);\r\n\r\n\t\t\t\tvar getMatchedFn = function (searchText) {\r\n\t\t\t\t\tmatcher.setNames(_.map(sections, function (el) {\r\n\t\t\t\t\t\treturn IX.inherit(el, {\r\n\t\t\t\t\t\t\tname : el.settleUnitName,\r\n\t\t\t\t\t\t\tvalue : el.settleUnitID\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}));\r\n\t\t\t\t\tvar matchedSections = matcher.match(searchText);\r\n\t\t\t\t\tvar matchedOptions = {};\r\n\t\t\t\t\t_.each(matchedSections, function (el, i) {\r\n\t\t\t\t\t\tmatchedOptions[el[0].settleUnitID] = true;\r\n\t\t\t\t\t});\r\n\t\t\t\t\treturn matchedOptions;\r\n\t\t\t\t};\r\n\t\t\t\tself.$form.find('select[name=settleUnitName]').chosen({\r\n\t\t\t\t\twidth : '200px',\r\n\t\t\t\t\tplaceholder_text : \"请选择结算主体\",\r\n\t\t\t\t\tno_results_text : \"抱歉，没有找到！\",\r\n\t\t\t\t\tallow_single_deselect : false,\r\n\t\t\t\t\tgetMatchedFn : getMatchedFn\r\n\t\t\t\t}).change(function (e) {\r\n\t\t\t\t\tvar $this = $(this);\r\n\t\t\t\t\tself.$form.find(':hidden[name=settleUnitID]').val($this.val());\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t});\r\n\t};\r\n\r\n\tvar initDonateGiftValidFieldOpts = function () {\r\n\t\tvar self = this,\r\n\t\t\tformKeys = _.reject(self.formKeys, function (k) {return k == 'giftItemID'}),\r\n\t\t\tret = {};\r\n\t\t_.each(formKeys, function (key) {\r\n\t\t\tvar elCfg = FormElsHT.get(key),\r\n\t\t\t\ttype = $XP(elCfg, 'type');\r\n\t\t\tret[key] = $XP(elCfg, 'validCfg', {});\r\n\t\t});\r\n\t\treturn ret;\r\n\t};\r\n\r\n\tvar initPayGiftValidFieldOpts = function () {\r\n\t\tvar self = this,\r\n\t\t\tformKeys = _.reject(self.formKeys, function (k) {return k == 'giftItemID'}),\r\n\t\t\tret = {};\r\n\t\t_.each(formKeys, function (key) {\r\n\t\t\tvar elCfg = FormElsHT.get(key),\r\n\t\t\t\ttype = $XP(elCfg, 'type');\r\n\t\t\tret[key] = $XP(elCfg, 'validCfg', {});\r\n\t\t});\r\n\t\treturn ret;\r\n\t};\r\n\r\n\tvar initPayGiftOnlineValidFieldOpts = function () {\r\n\t\tvar self = this,\r\n\t\t\tformKeys = _.reject(self.formKeys, function (k) {return k == 'giftItemID' || k == 'voucherName' || k == 'voucherValue' || k == 'settleUnitID';}),\r\n\t\t\tret = {};\r\n\t\t_.each(formKeys, function (key) {\r\n\t\t\tvar elCfg = FormElsHT.get(key),\r\n\t\t\t\ttype = $XP(elCfg, 'type');\r\n\t\t\tif (type == 'section') {\r\n\t\t\t\tvar min = 'transStartTime', max = 'transStartTime';\r\n\t\t\t\t\tret[min] = $XP(elCfg, 'min.validCfg', {});\r\n\t\t\t\t\tret[max] = $XP(elCfg, 'max.validCfg', {});\r\n\t\t\t} else {\r\n\t\t\t\tret[key] = $XP(elCfg, 'validCfg', {});\r\n\t\t\t}\r\n\t\t\t\r\n\t\t});\r\n\t\treturn ret;\r\n\r\n\t};\r\n\r\n\tvar serializeDonateGiftForm = function () {\r\n\t\tvar self = this,\r\n\t\t\tformKeys = self.formKeys,\r\n\t\t\tret = {},\r\n\t\t\tformEls = _.map(formKeys, function (key) {\r\n\t\t\t\tvar elCfg = FormElsHT.get(key),\r\n\t\t\t\t\ttype = $XP(elCfg, 'type');\r\n\t\t\t\tret[key] = $('[name=' + key + ']', self.$form).val();\r\n\t\t\t});\r\n\t\treturn ret;\r\n\t};\r\n\r\n\tvar serializePayGiftForm = function () {\r\n\t\tvar self = this,\r\n\t\t\tformKeys = self.formKeys,\r\n\t\t\tret = {},\r\n\t\t\tformEls = _.map(formKeys, function (key) {\r\n\t\t\t\tvar elCfg = FormElsHT.get(key),\r\n\t\t\t\t\ttype = $XP(elCfg, 'type');\r\n\t\t\t\tret[key] = $('[name=' + key + ']', self.$form).val();\r\n\t\t\t});\r\n\t\treturn ret;\r\n\t};\r\n\r\n\tvar serializePayGiftOnlineForm = function () {\r\n\t\tvar self = this,\r\n\t\t\tformKeys = self.formKeys,\r\n\t\t\tret = {},\r\n\t\t\tformEls = _.map(formKeys, function (key) {\r\n\t\t\t\tvar elCfg = FormElsHT.get(key),\r\n\t\t\t\t\ttype = $XP(elCfg, 'type');\r\n\t\t\t\tret[key] = $('[name=' + key + ']', self.$form).val();\r\n\t\t\t});\r\n\t\treturn ret;\r\n\t};\r\n\r\n\r\n\r\n\r\n\r\n\r\n\tvar MCMGiftDetailFormPanel = Stapes.subclass({\r\n\t\tconstructor : function (cfg) {\r\n\t\t\tthis.container = $XP(cfg, 'container');\r\n\t\t\tthis.parentView = $XP(cfg, 'parentView');\r\n\t\t\tthis.formKeys = $XP(cfg, 'formKeys');\r\n\t\t\tthis.callServer = $XF(cfg, 'callServer');\r\n\t\t\tthis.panelTitle = $XP(cfg, 'panelTitle', '');\r\n\t\t\tthis.$panelBody = null;\r\n\t\t\tthis.$panelFooter = null;\r\n\t\t\tthis.$form = null;\r\n\r\n\t\t\tthis.mapFormElsData = $XF(cfg, 'mapFormElsData');\r\n\t\t\tthis.initUIComponents = $XF(cfg, 'initUIComponents');\r\n\t\t\tthis.bundleFormEvent = $XF(cfg, 'bundleFormEvent');\r\n\t\t\t\r\n\r\n\t\t\tthis.loadTemplates();\r\n\t\t\tthis.initLayout();\r\n\t\t\tthis.initFormPanel();\r\n\t\t}\r\n\t});\r\n\r\n\tMCMGiftDetailFormPanel.proto({\r\n\t\tloadTemplates : function () {\r\n\t\t\tvar layoutTpl = Handlebars.compile(Hualala.TplLib.get('tpl_giftdetail_formpanel')),\r\n\t\t\t\tbtnTpl = Handlebars.compile(Hualala.TplLib.get('tpl_shop_modal_btns')),\r\n\t\t\t\tgridTpl = Handlebars.compile(Hualala.TplLib.get('tpl_base_datagrid')),\r\n\t\t\t\tformTpl = Handlebars.compile(Hualala.TplLib.get('tpl_mcm_base_form'));\r\n\t\t\tHandlebars.registerHelper('checkFormElementType', function (conditional, options) {\r\n\t\t\t\treturn (conditional == options.hash.type) ? options.fn(this) : options.inverse(this);\r\n\t\t\t});\r\n\t\t\tHandlebars.registerHelper('isInputGroup', function (prefix, surfix, options) {\r\n\t\t\t\treturn (!prefix && !surfix) ? options.inverse(this) : options.fn(this);\r\n\t\t\t});\r\n\t\t\t// Handlebars.registerPartial(\"baseform\", Hualala.TplLib.get('tpl_mcm_base_form'));\r\n\t\t\tthis.set({\r\n\t\t\t\tlayoutTpl : layoutTpl,\r\n\t\t\t\tbtnTpl : btnTpl,\r\n\t\t\t\tformTpl : formTpl\r\n\t\t\t});\r\n\t\t},\r\n\t\tinitLayout : function () {\r\n\t\t\tvar self = this;\r\n\t\t\tvar layoutTpl = self.get('layoutTpl');\r\n\t\t\tvar htm = layoutTpl({\r\n\t\t\t\tpanelTitle : self.panelTitle\r\n\t\t\t});\r\n\t\t\tself.container.html(htm);\r\n\t\t\tself.$panelBody = self.container.find('.panel-body');\r\n\t\t\tself.$panelFooter = self.container.find('.panel-footer');\r\n\t\t},\r\n\t\tinitFormPanel : function () {\r\n\t\t\tvar self = this,\r\n\t\t\t\tformTpl = self.get('formTpl'),\r\n\t\t\t\trenderData = self.mapFormElsData.call(self),\r\n\t\t\t\thtm = formTpl({\r\n\t\t\t\t\tformClz : 'form-feedback-out',\r\n\t\t\t\t\titems : renderData\r\n\t\t\t\t});\r\n\t\t\tself.$panelBody.html(htm);\r\n\t\t\tself.$form = self.$panelBody.find('form');\r\n\t\t\tself.initUIComponents.call(self);\r\n\t\t\tself.bundleFormEvent.call(self);\r\n\t\t}\r\n\t});\r\n\r\n\tHMCM.MCMGiftDetailFormPanel = MCMGiftDetailFormPanel;\r\n\r\n})(jQuery, window);;(function ($, window) {\r\n\tIX.ns(\"Hualala.MCM\");\r\n\tvar HMCM = Hualala.MCM;\r\n\tvar popoverMsg = Hualala.UI.PopoverMsgTip,\r\n\t\ttoptip = Hualala.UI.TopTip;\r\n\r\n\tvar getGiftTypeSet = HMCM.getGiftTypeSet;\r\n\r\n\tvar GiftDetailPage = Stapes.subclass({\r\n\t\tconstructor : function (cfg) {\r\n\t\t\tthis.container = $XP(cfg, 'container');\r\n\t\t\tthis.callServer = Hualala.Global.getMCMGiftDetail;\r\n\t\t\tthis.pageCtx = Hualala.PageRoute.getPageContextByPath();\r\n\t\t\tthis.giftItemID = $XP(this.pageCtx, 'params')[0];\r\n\t\t\tthis.tabViewHT = new IX.IListManager();\r\n\t\t\tthis.$nav = null;\r\n\t\t\tthis.$tabs = null;\r\n\t\t\tthis.mGiftDetail = null;\r\n\t\t\tthis.breadCrumbs = null;\r\n\t\t\tthis.loadTemplates();\r\n\t\t\tthis.bindEvent();\r\n\t\t\tthis.renderLayout();\r\n\t\t}\r\n\t});\r\n\tGiftDetailPage.proto({\r\n\t\tloadTemplates : function () {\r\n\t\t\tvar layoutTpl = Handlebars.compile(Hualala.TplLib.get('tpl_giftdetail_layout')),\r\n\t\t\t\tbtnTpl = Handlebars.compile(Hualala.TplLib.get('tpl_shop_modal_btns')),\r\n\t\t\t\tgridTpl = Handlebars.compile(Hualala.TplLib.get('tpl_base_datagrid'));\r\n\t\t\tHandlebars.registerPartial(\"baseinfo\", Hualala.TplLib.get('tpl_gift_detail'));\r\n\t\t\tHandlebars.registerPartial(\"card\", Hualala.TplLib.get('tpl_gift_card'));\r\n\t\t\tHandlebars.registerPartial(\"grid\", Hualala.TplLib.get('tpl_base_datagrid'));\r\n\t\t\tHandlebars.registerHelper('chkColType', function (conditional, options) {\r\n\t\t\t\treturn (conditional == options.hash.type) ? options.fn(this) : options.inverse(this);\r\n\t\t\t});\r\n\t\t\t\r\n\t\t\tthis.set({\r\n\t\t\t\tlayoutTpl : layoutTpl,\r\n\t\t\t\tbtnTpl : btnTpl,\r\n\t\t\t\tgridTpl : gridTpl\r\n\t\t\t});\r\n\t\t},\r\n\t\tbindEvent : function () {\r\n\t\t\tthis.on({\r\n\t\t\t\tgetDetail : function (params) {\r\n\t\t\t\t\tvar self = this;\r\n\t\t\t\t\tvar post = $XP(params, 'post', {}),\r\n\t\t\t\t\t\tsuccessFn = $XF(params, 'successFn'),\r\n\t\t\t\t\t\tfaildFn = $XF(params, 'faildFn');\r\n\t\t\t\t\tself.callServer(post, function (res) {\r\n\t\t\t\t\t\tif ($XP(res, 'resultcode') == '000') {\r\n\t\t\t\t\t\t\tsuccessFn.call(self, res);\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tfaildFn.call(self, res);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t}, this);\r\n\t\t},\r\n\t\tinitBreadCrumb : function () {\r\n\t\t\tvar self = this,\r\n\t\t\t\t$nav = self.$nav,\r\n\t\t\t\tparentNames = Hualala.PageRoute.getParentNamesByPath();\r\n\t\t\tself.breadCrumbs = new Hualala.UI.BreadCrumb({\r\n\t\t\t\tcontainer : $nav,\r\n\t\t\t\thideRoot : true,\r\n\t\t\t\tnodes : parentNames,\r\n\t\t\t\tclz : 'mcm-crumbs',\r\n\t\t\t\tclickFn : function () {\r\n\t\t\t\t\tvar $this = $(this);\r\n\t\t\t\t\tdocument.location.href = $this.attr('data-href');\r\n\t\t\t\t},\r\n\t\t\t\tmapRenderData : function (data, hideRoot, clz) {\r\n\t\t\t\t\tvar list = _.map(data, function (el, idx, l) {\r\n\t\t\t\t\t\tvar label = $XP(el, 'label', ''),\r\n\t\t\t\t\t\t\tname = $XP(el, 'name', ''),\r\n\t\t\t\t\t\t\tpath = Hualala.PageRoute.createPath(name, null);\r\n\t\t\t\t\t\treturn {\r\n\t\t\t\t\t\t\tclz : 'crumb',\r\n\t\t\t\t\t\t\tlabel : label,\r\n\t\t\t\t\t\t\tpath : path,\r\n\t\t\t\t\t\t\tname : name,\r\n\t\t\t\t\t\t\tisLastNode : (data.length - 1 == idx) ? true : false\r\n\t\t\t\t\t\t};\r\n\t\t\t\t\t});\r\n\t\t\t\t\thideRoot === true && list.shift();\r\n\t\t\t\t\tlist.shift();\r\n\t\t\t\t\treturn {\r\n\t\t\t\t\t\tclz : clz,\r\n\t\t\t\t\t\titems : list\r\n\t\t\t\t\t};\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t},\r\n\t\tmapTabNavData : function (navs) {\r\n\t\t\tvar self = this;\r\n\t\t\treturn _.map(navs, function (nav) {\r\n\t\t\t\treturn IX.inherit(nav, {\r\n\t\t\t\t\tclz : 'mcm-detail-tab',\r\n\t\t\t\t\tid : $XP(nav, 'value') + '_' + IX.id()\r\n\t\t\t\t});\r\n\t\t\t});\r\n\t\t},\r\n\t\tmapGiftStatisticGridData : function (data) {\r\n\t\t\tvar self = this;\r\n\t\t\tvar tblClz = 'table-striped table-hover table-condensed';\r\n\t\t\tvar records = $XP(data, 'records', []),\r\n\t\t\t\ttotal = $XP(data, 'total', {});\r\n\t\t\tvar getways = _.reject(Hualala.TypeDef.MCMDataSet.GiftDistributeTypes, function (el) {\r\n\t\t\t\treturn IX.isEmpty(el.value) || !el.include;\r\n\t\t\t});\r\n\t\t\tvar giftStatus = _.reject(Hualala.TypeDef.MCMDataSet.GiftStatus, function (el) {\r\n\t\t\t\treturn IX.isEmpty(el.value);\r\n\t\t\t});\r\n\t\t\tvar genGridHeader = function () {\r\n\t\t\t\tvar thead = _.map(getways, function (el) {\r\n\t\t\t\t\treturn {\r\n\t\t\t\t\t\tclz : '',\r\n\t\t\t\t\t\tlabel : $XP(el, 'label', '')\r\n\t\t\t\t\t};\r\n\t\t\t\t});\r\n\t\t\t\tthead.push({\r\n\t\t\t\t\tclz : '',\r\n\t\t\t\t\tlabel : '总计'\r\n\t\t\t\t});\r\n\t\t\t\tthead.unshift({\r\n\t\t\t\t\tclz : '',\r\n\t\t\t\t\tlabel : '状态'\r\n\t\t\t\t});\r\n\t\t\t\treturn {\r\n\t\t\t\t\tthead : thead\r\n\t\t\t\t};\r\n\t\t\t};\r\n\t\t\tvar genRowData = function (rowData) {\r\n\t\t\t\tvar rows = _.map(rowData, function (row) {\r\n\t\t\t\t\t// var giftStatus = $XP(row, 'giftstatus');\r\n\t\t\t\t\tvar rowHeader = _.find(giftStatus, function (gs) {\r\n\t\t\t\t\t\treturn $XP(gs, 'value') == $XP(row, 'giftstatus');\r\n\t\t\t\t\t});\r\n\t\t\t\t\tvar colkeys = _.map(getways, function (el) {\r\n\t\t\t\t\t\treturn $XP(el, 'value');\r\n\t\t\t\t\t});\r\n\t\t\t\t\tvar cols = _.map(colkeys, function (k) {\r\n\t\t\t\t\t\tvar key = 'sum_' + k;\r\n\t\t\t\t\t\tvar val = $XP(row, key, 0);\r\n\t\t\t\t\t\treturn {\r\n\t\t\t\t\t\t\tclz : '',\r\n\t\t\t\t\t\t\ttype : 'text',\r\n\t\t\t\t\t\t\tvalue : val,\r\n\t\t\t\t\t\t\ttext : val\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t\tcols.unshift({\r\n\t\t\t\t\t\tclz : '',\r\n\t\t\t\t\t\ttype : 'text',\r\n\t\t\t\t\t\tvalue : $XP(row, 'giftstatus'),\r\n\t\t\t\t\t\ttext : $XP(rowHeader, 'label')\r\n\t\t\t\t\t});\r\n\t\t\t\t\tcols.push({\r\n\t\t\t\t\t\tclz : '',\r\n\t\t\t\t\t\ttype : 'text',\r\n\t\t\t\t\t\tvalue : $XP(row, 'totalCount', 0),\r\n\t\t\t\t\t\ttext : $XP(row, 'totalCount', 0)\r\n\t\t\t\t\t});\r\n\t\t\t\t\treturn {\r\n\t\t\t\t\t\tclz : '',\r\n\t\t\t\t\t\tcols : cols\r\n\t\t\t\t\t};\r\n\r\n\t\t\t\t});\r\n\t\t\t\treturn {\r\n\t\t\t\t\trows : rows\r\n\t\t\t\t};\r\n\t\t\t};\r\n\t\t\tvar genGridFooter = function (total) {\r\n\t\t\t\tvar cols = _.map(getways, function (getway) {\r\n\t\t\t\t\tvar k = $XP(getway, 'value'),\r\n\t\t\t\t\t\tkey = 'count_' + k;\r\n\t\t\t\t\treturn {\r\n\t\t\t\t\t\tclz : '',\r\n\t\t\t\t\t\tvalue : $XP(total, key, 0),\r\n\t\t\t\t\t\ttext : $XP(total, key, 0)\r\n\t\t\t\t\t};\r\n\t\t\t\t});\r\n\t\t\t\tcols.unshift({\r\n\t\t\t\t\tclz : '',\r\n\t\t\t\t\tvalue : '',\r\n\t\t\t\t\ttext : '总计'\r\n\t\t\t\t});\r\n\t\t\t\tcols.push({\r\n\t\t\t\t\tclz : '',\r\n\t\t\t\t\tvalue : $XP(total, 'totalCount', 0),\r\n\t\t\t\t\ttext : $XP(total, 'totalCount', 0)\r\n\t\t\t\t});\r\n\t\t\t\treturn {\r\n\t\t\t\t\ttfoot : [\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\tclz : '',\r\n\t\t\t\t\t\t\tcols : cols\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t]\r\n\t\t\t\t};\r\n\t\t\t};\r\n\t\t\treturn IX.inherit({\r\n\t\t\t\tclz : '',\r\n\t\t\t\ttblClz : tblClz\r\n\t\t\t}, genGridHeader(), genRowData(records), genGridFooter(total));\r\n\r\n\t\t},\r\n\t\tmapLayoutRenderData : function (data) {\r\n\t\t\tvar self = this;\r\n\t\t\tvar giftData = $XP(data, 'records', [])[0];\r\n\t\t\tvar giftTypeSet = getGiftTypeSet($XP(giftData, 'giftType')),\r\n\t\t\t\tnavs = $XP(giftTypeSet, 'navs', []);\r\n\t\t\tvar ret = {};\r\n\t\t\tvar card = {\r\n\t\t\t\tclz : $XP(giftTypeSet, 'type', ''),\r\n\t\t\t\tlabel : $XP(giftData, 'giftValue', ''),\r\n\t\t\t\tunit : $XP(giftTypeSet, 'unit', '')\r\n\t\t\t};\r\n\t\t\tret = IX.inherit(giftData, {\r\n\t\t\t\tcard : card,\r\n\t\t\t\tgiftTypeLabel : $XP(giftTypeSet, 'label', ''),\r\n\t\t\t\tgiftTypeUnit : $XP(giftTypeSet, 'unit', ''),\r\n\t\t\t\tinfoLabelClz : 'col-sm-2',\r\n\t\t\t\tnavs : self.mapTabNavData(navs),\r\n\t\t\t\tgrid : self.mapGiftStatisticGridData($XP(data, 'myGiftDataset.data', {}))\r\n\t\t\t});\r\n\t\t\treturn ret;\r\n\t\t},\r\n\t\trenderLayout : function () {\r\n\t\t\tvar self = this;\r\n\t\t\tvar giftItemID = self.giftItemID;\r\n\t\t\tvar renderFn = function (data) {\r\n\t\t\t\tvar layoutTpl = self.get('layoutTpl'),\r\n\t\t\t\t\trenderData = self.mapLayoutRenderData(data);\r\n\t\t\t\tvar htm = layoutTpl(renderData);\r\n\t\t\t\tself.container.html(htm);\r\n\t\t\t\tself.$nav = self.container.find('.detail-layout > .nav-bar');\r\n\t\t\t\tself.$tabs = self.container.find('.detail-tabs');\r\n\t\t\t\tself.initBreadCrumb();\r\n\t\t\t\tself.bindPageEvent();\r\n\t\t\t\tself.$tabs.find('.nav-tabs a:first').tab('show');\r\n\t\t\t};\r\n\t\t\tself.emit('getDetail', {\r\n\t\t\t\tpost : {giftItemID : giftItemID},\r\n\t\t\t\tsuccessFn : function (res) {\r\n\t\t\t\t\tself.mGiftDetail = new HMCM.BaseGiftModel($XP(res, 'data', {}));\r\n\t\t\t\t\trenderFn($XP(res, 'data', {}));\r\n\t\t\t\t},\r\n\t\t\t\tfaildFn : function (res) {\r\n\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t},\r\n\t\tbindPageEvent : function () {\r\n\t\t\tvar self = this;\r\n\t\t\tself.$tabs.find('.nav-tabs a[data-toggle=tab]').on('shown.bs.tab', function (e) {\r\n\t\t\t\tvar $tab = $(e.target),\r\n\t\t\t\t\t$tabCnt = $($tab.attr('href')),\r\n\t\t\t\t\ttabCntID = $tabCnt.attr('id');\r\n\t\t\t\tvar activedTabView = self.getTabView(tabCntID);\r\n\t\t\t\tif (!activedTabView) {\r\n\t\t\t\t\tswitch (tabCntID) {\r\n\t\t\t\t\t\tcase 'tab_send':\r\n\t\t\t\t\t\t\tself.initTabSend($tabCnt);\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\tcase 'tab_used':\r\n\t\t\t\t\t\t\tself.initTabUsed($tabCnt);\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\tcase 'tab_give':\r\n\t\t\t\t\t\t\tself.initTabGive($tabCnt);\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\tcase 'tab_pay':\r\n\t\t\t\t\t\t\tself.initTabPay($tabCnt);\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\tcase 'tab_onlinesale':\r\n\t\t\t\t\t\t\tself.initTabOnlineSale($tabCnt);\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t},\r\n\t\tgetTabView : function (id) {\r\n\t\t\tvar self = this,\r\n\t\t\t\ttabViewHT = self.tabViewHT;\r\n\t\t\treturn tabViewHT.get(id);\r\n\t\t},\r\n\t\tinitTabSend : function ($tabCnt) {\r\n\t\t\tvar self = this,\r\n\t\t\t\ttabViewHT = self.tabViewHT;\r\n\t\t\tvar queryKeys = Hualala.MCM.QueryFormKeys.GiftSendStatisticQueryKeys;\r\n\t\t\tvar panel = new HMCM.QueryController({\r\n\t\t\t\tcontainer : $tabCnt,\r\n\t\t\t\tresultController : new HMCM.QueryResultControler({\r\n\t\t\t\t\tcontainer : $tabCnt,\r\n\t\t\t\t\tmodel : new HMCM.GiftMgrResultModel({\r\n\t\t\t\t\t\tcallServer : Hualala.Global.queryMCMGiftDetailGetWayInfo,\r\n\t\t\t\t\t\tqueryKeys : queryKeys,\r\n\t\t\t\t\t\tgridType : 'giftsend',\r\n\t\t\t\t\t\trecordModel : HMCM.BaseGiftSendModel\r\n\t\t\t\t\t}),\r\n\t\t\t\t\tview : new HMCM.QueryResultView({\r\n\t\t\t\t\t\t// mapResultRenderData : HMCM.mapGiftsQueryResultRenderData,\r\n\t\t\t\t\t\tmapResultRenderData : HMCM.mapGiftDetailQuerySendRenderData,\r\n\t\t\t\t\t\trenderResult : HMCM.renderQueryResult,\r\n\t\t\t\t\t\tbundleEvent : HMCM.bundleGiftsQueryResultEvent\r\n\t\t\t\t\t})\r\n\t\t\t\t}),\r\n\t\t\t\tmodel : new HMCM.QueryModel({\r\n\t\t\t\t\tqueryKeys : queryKeys\r\n\t\t\t\t}),\r\n\t\t\t\tview : new HMCM.QueryView({\r\n\t\t\t\t\tmapRenderDataFn : HMCM.mapGiftDetailGetWayQueryFormRenderData,\r\n\t\t\t\t\tbundleQueryEvent : HMCM.bundleGiftsQueryEvent\r\n\t\t\t\t})\r\n\r\n\t\t\t});\r\n\t\t\ttabViewHT.register($tabCnt.attr('id'), panel);\r\n\t\t},\r\n\t\tinitTabUsed : function ($tabCnt) {\r\n\t\t\tvar self = this,\r\n\t\t\t\ttabViewHT = self.tabViewHT;\r\n\t\t\tvar queryKeys = Hualala.MCM.QueryFormKeys.GiftUsedStatisticQueryKeys;\r\n\t\t\tvar panel = new HMCM.QueryController({\r\n\t\t\t\tcontainer : $tabCnt,\r\n\t\t\t\tresultController : new HMCM.QueryResultControler({\r\n\t\t\t\t\tcontainer : $tabCnt,\r\n\t\t\t\t\tmodel : new HMCM.GiftMgrResultModel({\r\n\t\t\t\t\t\tcallServer : Hualala.Global.queryMCMGiftDetailUsedInfo,\r\n\t\t\t\t\t\tqueryKeys : queryKeys,\r\n\t\t\t\t\t\tgridType : 'giftsend',\r\n\t\t\t\t\t\trecordModel : HMCM.BaseGiftUsedModel\r\n\t\t\t\t\t}),\r\n\t\t\t\t\tview : new HMCM.QueryResultView({\r\n\t\t\t\t\t\t// mapResultRenderData : HMCM.mapGiftsQueryResultRenderData,\r\n\t\t\t\t\t\tmapResultRenderData : HMCM.mapGiftDetailQueryUsedRenderData,\r\n\t\t\t\t\t\trenderResult : HMCM.renderQueryResult,\r\n\t\t\t\t\t\tbundleEvent : HMCM.bundleGiftsQueryResultEvent\r\n\t\t\t\t\t})\r\n\t\t\t\t}),\r\n\t\t\t\tmodel : new HMCM.QueryModel({\r\n\t\t\t\t\tqueryKeys : queryKeys\r\n\t\t\t\t}),\r\n\t\t\t\tview : new HMCM.QueryView({\r\n\t\t\t\t\tmapRenderDataFn : HMCM.mapGiftDetailUsedQueryFormRenderData,\r\n\t\t\t\t\tbundleQueryEvent : HMCM.bundleGiftsQueryEvent\r\n\t\t\t\t})\r\n\r\n\t\t\t});\r\n\t\t\ttabViewHT.register($tabCnt.attr('id'), panel);\r\n\t\t},\r\n\t\tinitTabGive : function ($tabCnt) {\r\n\t\t\tvar self = this,\r\n\t\t\t\ttabViewHT = self.tabViewHT;\r\n\t\t\tvar panel = new HMCM.MCMGiftDetailFormPanel({\r\n\t\t\t\tcontainer : $tabCnt,\r\n\t\t\t\tparentView : self,\r\n\t\t\t\tformKeys : HMCM.GiftDetailDonateGiftCtrlFormKeys,\r\n\t\t\t\tcallServer : Hualala.Global.giftDetailDonateGift,\r\n\t\t\t\tpanelTitle : \"赠送\",\r\n\t\t\t\tmapFormElsData : HMCM.mapDonateGiftFormRenderData,\r\n\t\t\t\tinitUIComponents : HMCM.initDonateGiftFormUIComponent,\r\n\t\t\t\tbundleFormEvent : HMCM.bundleDonateGiftFormEvent\r\n\t\t\t});\r\n\t\t\ttabViewHT.register($tabCnt.attr('id'), panel);\r\n\t\t},\r\n\t\tinitTabPay : function ($tabCnt) {\r\n\t\t\tvar self = this,\r\n\t\t\t\ttabViewHT = self.tabViewHT;\r\n\t\t\tvar panel = new HMCM.MCMGiftDetailFormPanel({\r\n\t\t\t\tcontainer : $tabCnt,\r\n\t\t\t\tparentView : self,\r\n\t\t\t\tformKeys : HMCM.GiftDetailPayGiftCtrlFormKeys,\r\n\t\t\t\tcallServer : Hualala.Global.giftDetailDonateGift,\r\n\t\t\t\tpanelTitle : \"支付\",\r\n\t\t\t\tmapFormElsData : HMCM.mapPayGiftFormRenderData,\r\n\t\t\t\tinitUIComponents : HMCM.initPayGiftFormUIComponent,\r\n\t\t\t\tbundleFormEvent : HMCM.bundlePayGiftFormEvent\r\n\t\t\t});\r\n\t\t\ttabViewHT.register($tabCnt.attr('id'), panel);\r\n\t\t},\r\n\t\tinitTabOnlineSale : function ($tabCnt) {\r\n\t\t\tvar self = this,\r\n\t\t\t\ttabViewHT = self.tabViewHT;\r\n\t\t\tvar panel = new HMCM.MCMGiftDetailFormPanel({\r\n\t\t\t\tcontainer : $tabCnt,\r\n\t\t\t\tparentView : self,\r\n\t\t\t\tformKeys : HMCM.GiftDetailPayGiftOnlineCtrlFormKeys,\r\n\t\t\t\tcallServer : Hualala.Global.giftDetailPayGiftOnline,\r\n\t\t\t\tpanelTitle : \"网上出售\",\r\n\t\t\t\tmapFormElsData : HMCM.mapPayGiftOnlineFormRenderData,\r\n\t\t\t\tinitUIComponents : HMCM.initPayGiftOnlineFormUIComponent,\r\n\t\t\t\tbundleFormEvent : HMCM.bundlePayGiftOnlineFormEvent\r\n\t\t\t});\r\n\t\t\ttabViewHT.register($tabCnt.attr('id'), panel);\r\n\t\t}\r\n\t});\r\n\r\n\tHMCM.GiftDetailPage = GiftDetailPage;\r\n})(jQuery, window);;(function ($, window) {\r\n\tIX.ns(\"Hualala.MCM\");\r\n\tvar HMCM = Hualala.MCM;\r\n\tvar popoverMsg = Hualala.UI.PopoverMsgTip,\r\n\t\ttoptip = Hualala.UI.TopTip;\r\n\r\n\tvar BaseEventTrackModel = Stapes.subclass({\r\n\t\tconstructor : function (data) {\r\n\t\t\tthis.set(data);\r\n\t\t\tthis.bindEvent();\r\n\t\t}\r\n\t});\r\n\tBaseEventTrackModel.proto({\r\n\t\tbindEvent : function () {\r\n\t\t\tvar self = this;\r\n\t\t\tself.on({\r\n\r\n\t\t\t}, self);\r\n\t\t}\r\n\t});\r\n\r\n\tHMCM.BaseEventTrackModel = BaseEventTrackModel;\r\n\r\n\tvar MCMQueryEventTrackBaseHeaderCfg = [\r\n\t\t{key : \"customerName\", clz : \"text\", label : \"姓名\"},\r\n\t\t{key : \"customerSex\", clz : \"text\", label : \"性别\"},\r\n\t\t{key : \"cardNO\", clz : \"text\", label : \"卡号\"},\r\n\t\t{key : \"customerMobile\", clz : \"text\", label : \"手机号\"},\r\n\t\t{key : \"cardLevelName\", clz : \"text\", label : \"等级\"},\r\n\t\t{key : \"consumptionTotal\", clz : \"text\", label : \"消费累计\"},\r\n\t\t{key : \"consumptionCount\", clz : \"text\", label : \"消费次数\"},\r\n\t\t{key : \"createTime\", clz : \"text\", label : \"参与时间\"}\r\n\t];\r\n\r\n\tvar mapColItemRenderData = function (row, rowIdx, colKey, eventWay) {\r\n\t\tvar self = this;\r\n\t\tvar r = {value : '', text : ''}, v = $XP(row, colKey, '');\r\n\t\tvar formatDateTimeValue = Hualala.Common.formatDateTimeValue;\r\n\t\tswitch(colKey) {\r\n\t\t\tcase \"createTime\":\r\n\t\t\t\tr.value = v;\r\n\t\t\t\tr.text = IX.Date.getDateByFormat(formatDateTimeValue(v), 'yyyy/MM/dd HH:mm');\r\n\t\t\t\tbreak;\r\n\t\t\tdefault:\r\n\t\t\t\tr.value = r.text = v;\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\t\treturn r;\r\n\t};\r\n\r\n\tHMCM.mapEventTrackQueryResultRenderData = function (records) {\r\n\t\tvar self = this;\r\n\t\tvar clz = 'col-md-12',\r\n\t\t\ttblClz = ' table-hover mcm-grid',\r\n\t\t\ttblHeaders = _.clone(MCMQueryEventTrackBaseHeaderCfg);\r\n\t\tvar eventDetail = self.$container.data('eventDetail'),\r\n\t\t\teventWay = $XP(eventDetail, 'eventWay');\r\n\t\tif (eventWay == 20) {\r\n\t\t\ttblHeaders.push({\r\n\t\t\t\tkey : \"winFlag\", clz : \"text\", label : \"中奖情况\"\r\n\t\t\t});\r\n\t\t} else if (eventWay == 22) {\r\n\t\t\ttblHeaders.push({\r\n\t\t\t\tkey : \"winFlag\", clz : \"text\", label : \"是否入围\"\r\n\t\t\t});\r\n\t\t}\r\n\t\tvar mapColsRenderData = function (row, idx) {\r\n\t\t\tvar colKeys = _.map(tblHeaders, function (el) {\r\n\t\t\t\treturn {key : $XP(el, 'key', ''), clz : $XP(el, 'clz', '')};\r\n\t\t\t});\r\n\t\t\tvar col = {clz : '', type : 'text'};\r\n\t\t\tvar cols = _.map(colKeys, function (k, i) {\r\n\t\t\t\tvar r = mapColItemRenderData.apply(self, [row, idx, $XP(k, 'key', ''), eventWay]);\r\n\t\t\t\treturn IX.inherit(col, r, {clz : $XP(k, 'clz', '')});\r\n\t\t\t});\r\n\t\t\treturn cols;\r\n\t\t};\r\n\t\tvar rows = _.map(records, function (row, idx) {\r\n\t\t\tvar rowSet = {\r\n\t\t\t\tclz : '',\r\n\t\t\t\tcols : mapColsRenderData(row, idx)\r\n\t\t\t};\r\n\t\t\treturn rowSet;\r\n\t\t});\r\n\t\tvar tfoot = [{\r\n\t\t\tclz : 'hidden',\r\n\t\t\tcols : []\r\n\t\t}];\r\n\t\treturn {\r\n\t\t\tclz : clz,\r\n\t\t\ttblClz : tblClz,\r\n\t\t\tisEmpty : !records || records.length == 0 ? true : false,\r\n\t\t\tcolCount : tblHeaders.length,\r\n\t\t\tthead : tblHeaders,\r\n\t\t\trows : rows,\r\n\t\t\ttfoot : tfoot\r\n\t\t};\r\n\r\n\t};\r\n\r\n\tHMCM.bundleEventTrackQueryResultEvent = function () {\r\n\r\n\t};\r\n\r\n\tvar getEventTypeSet = function (eventID) {\r\n\t\tvar eventTypes = Hualala.TypeDef.MCMDataSet.EventTypes;\r\n\t\treturn _.find(eventTypes, function (el) {\r\n\t\t\treturn $XP(el, 'eventID') == eventID;\r\n\t\t});\r\n\t};\r\n\tHMCM.getEventTypeSet = getEventTypeSet;\r\n\r\n\tvar EventTrackPage = Stapes.subclass({\r\n\t\tconstructor : function (cfg) {\r\n\t\t\tthis.container = $XP(cfg, 'container');\r\n\t\t\tthis.callServer = Hualala.Global.getMCMEventByID;\r\n\t\t\tthis.pageCtx = Hualala.PageRoute.getPageContextByPath();\r\n\t\t\tthis.$nav = null;\r\n\t\t\tthis.breadCrumbs = null;\r\n\t\t\tthis.loadTemplates();\r\n\t\t\tthis.bindEvent();\r\n\t\t\tthis.renderLayout();\r\n\t\t}\r\n\t});\r\n\r\n\tEventTrackPage.proto({\r\n\t\tloadTemplates : function () {\r\n\t\t\tvar layoutTpl = Handlebars.compile(Hualala.TplLib.get('tpl_eventtrack_layout')),\r\n\t\t\t\tbtnTpl = Handlebars.compile(Hualala.TplLib.get('tpl_shop_modal_btns')),\r\n\t\t\t\tgridTpl = Handlebars.compile(Hualala.TplLib.get('tpl_base_datagrid'));\r\n\t\t\tHandlebars.registerPartial(\"baseinfo\", Hualala.TplLib.get('tpl_event_detail'));\r\n\t\t\tHandlebars.registerPartial(\"card\", Hualala.TplLib.get('tpl_event_card'));\r\n\t\t\tHandlebars.registerPartial(\"grid\", Hualala.TplLib.get('tpl_base_datagrid'));\r\n\t\t\t\r\n\t\t\tthis.set({\r\n\t\t\t\tlayoutTpl : layoutTpl,\r\n\t\t\t\tbtnTpl : btnTpl,\r\n\t\t\t\tgridTpl : gridTpl\r\n\t\t\t});\r\n\t\t},\r\n\t\tbindEvent : function () {\r\n\t\t\tthis.on({\r\n\t\t\t\tgetDetail : function (params) {\r\n\t\t\t\t\tvar self = this;\r\n\t\t\t\t\tvar post = $XP(params, 'post', {}),\r\n\t\t\t\t\t\tsuccessFn = $XF(params, 'successFn'),\r\n\t\t\t\t\t\tfaildFn = $XF(params, 'faildFn');\r\n\t\t\t\t\tself.callServer(post, function (res) {\r\n\t\t\t\t\t\tif ($XP(res, 'resultcode') == '000') {\r\n\t\t\t\t\t\t\tsuccessFn.call(self, res);\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tfaildFn.call(self, res);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t}, this);\r\n\t\t},\r\n\t\tinitBreadCrumb : function () {\r\n\t\t\tvar self = this,\r\n\t\t\t\t$nav = self.$nav,\r\n\t\t\t\tparentNames = Hualala.PageRoute.getParentNamesByPath();\r\n\t\t\tself.breadCrumbs = new Hualala.UI.BreadCrumb({\r\n\t\t\t\tcontainer : $nav,\r\n\t\t\t\thideRoot : true,\r\n\t\t\t\tnodes : parentNames,\r\n\t\t\t\tclz : 'mcm-crumbs',\r\n\t\t\t\tclickFn : function () {\r\n\t\t\t\t\tvar $this = $(this);\r\n\t\t\t\t\tdocument.location.href = $this.attr('data-href');\r\n\t\t\t\t},\r\n\t\t\t\tmapRenderData : function (data, hideRoot, clz) {\r\n\t\t\t\t\tvar list = _.map(data, function (el, idx, l) {\r\n\t\t\t\t\t\tvar label = $XP(el, 'label', ''),\r\n\t\t\t\t\t\t\tname = $XP(el, 'name', ''),\r\n\t\t\t\t\t\t\tpath = Hualala.PageRoute.createPath(name, null);\r\n\t\t\t\t\t\treturn {\r\n\t\t\t\t\t\t\tclz : 'crumb',\r\n\t\t\t\t\t\t\tlabel : label,\r\n\t\t\t\t\t\t\tpath : path,\r\n\t\t\t\t\t\t\tname : name,\r\n\t\t\t\t\t\t\tisLastNode : (data.length - 1 == idx) ? true : false\r\n\t\t\t\t\t\t};\r\n\t\t\t\t\t});\r\n\t\t\t\t\thideRoot === true && list.shift();\r\n\t\t\t\t\tlist.shift();\r\n\t\t\t\t\treturn {\r\n\t\t\t\t\t\tclz : clz,\r\n\t\t\t\t\t\titems : list\r\n\t\t\t\t\t};\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t},\r\n\t\tmapLayoutRenderData : function (data) {\r\n\t\t\tvar self = this;\r\n\t\t\tvar model = new HMCM.BaseEventModel(data);\r\n\t\t\treturn HMCM.mapEventDetailRenderData(model);\r\n\t\t},\r\n\t\trenderLayout : function () {\r\n\t\t\tvar self = this;\r\n\t\t\tvar eventID = $XP(self.pageCtx, 'params')[0];\r\n\t\t\tvar renderFn = function (res) {\r\n\t\t\t\tvar layoutTpl = self.get('layoutTpl'),\r\n\t\t\t\t\trenderData = self.mapLayoutRenderData(res);\r\n\t\t\t\tvar htm = layoutTpl(renderData);\r\n\t\t\t\tself.container.html(htm);\r\n\t\t\t\tself.$nav = self.container.find('.detail-layout > .nav-bar');\r\n\t\t\t\tself.$eventTrack = self.container.find('.event-track');\r\n\t\t\t\tself.$eventTrack.data('eventDetail', res);\r\n\t\t\t\tself.initBreadCrumb();\r\n\t\t\t\tself.initEventTrackData();\r\n\t\t\t};\r\n\t\t\tself.emit('getDetail', {\r\n\t\t\t\tpost : {eventID : eventID},\r\n\t\t\t\tsuccessFn : function (res) {\r\n\t\t\t\t\trenderFn($XP(res, 'data.records', [])[0]);\r\n\t\t\t\t},\r\n\t\t\t\tfaildFn : function (res) {\r\n\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t},\r\n\t\tinitEventTrackData : function () {\r\n\t\t\tvar self = this;\r\n\t\t\tvar queryKeys = Hualala.MCM.QueryFormKeys.EventTrackBaseQueryKeys;\r\n\t\t\tvar panel = new HMCM.QueryController({\r\n\t\t\t\tcontainer : self.$eventTrack,\r\n\t\t\t\tresultController : new HMCM.QueryResultControler({\r\n\t\t\t\t\tcontainer : self.$eventTrack,\r\n\t\t\t\t\tmodel : new HMCM.GiftMgrResultModel({\r\n\t\t\t\t\t\tcallServer : Hualala.Global.getMCMEventTrack,\r\n\t\t\t\t\t\tqueryKeys : queryKeys,\r\n\t\t\t\t\t\tgridType : 'eventtrack',\r\n\t\t\t\t\t\trecordModel : HMCM.BaseEventTrackModel\r\n\t\t\t\t\t}),\r\n\t\t\t\t\tview : new HMCM.QueryResultView({\r\n\t\t\t\t\t\tmapResultRenderData : HMCM.mapEventTrackQueryResultRenderData,\r\n\t\t\t\t\t\trenderResult : HMCM.renderQueryResult,\r\n\t\t\t\t\t\tbundleEvent : HMCM.bundleEventTrackQueryResultEvent\r\n\t\t\t\t\t})\r\n\t\t\t\t}),\r\n\t\t\t\tmodel : new HMCM.QueryModel({\r\n\t\t\t\t\tqueryKeys : queryKeys\r\n\t\t\t\t}),\r\n\t\t\t\tview : new HMCM.QueryView({\r\n\t\t\t\t\t// mapRenderDataFn : HMCM.mapGiftDetailGetWayQueryFormRenderData,\r\n\t\t\t\t\tmapRenderDataFn : HMCM.mapEventTrackQueryFormRenderData,\r\n\t\t\t\t\tbundleQueryEvent : HMCM.bundleGiftsQueryEvent\r\n\t\t\t\t})\r\n\r\n\t\t\t});\r\n\t\t}\r\n\t});\r\n\r\n\tHMCM.EventTrackPage = EventTrackPage;\r\n})(jQuery, window);;(function ($, window) {\r\n\tIX.ns(\"Hualala.MCM\");\r\n\tvar HMCM = Hualala.MCM;\r\n\r\n\tvar MCMHomePageInit = function () {\r\n\t\tHualala.PageRoute.jumpPage(Hualala.PageRoute.createPath('mcmGiftsMgr'));\r\n\t};\r\n\r\n\tvar MCMGiftsMgrInit = function () {\r\n\t\tvar ctx = Hualala.PageRoute.getPageContextByPath(),\r\n\t\t\t$body = $('#ix_wrapper > .ix-body > .container');\r\n\t\tvar queryKeys = Hualala.MCM.QueryFormKeys.GiftMgrQueryKeys;\r\n\t\t$body.html('<h1>礼品管理页</h1>');\r\n\t\tvar panel = new HMCM.QueryController({\r\n\t\t\tcontainer : $body,\r\n\t\t\tresultController : new HMCM.QueryResultControler({\r\n\t\t\t\tcontainer : $body,\r\n\t\t\t\tmodel : new HMCM.GiftMgrResultModel({\r\n\t\t\t\t\tcallServer : Hualala.Global.getMCMGifts,\r\n\t\t\t\t\tqueryKeys : queryKeys,\r\n\t\t\t\t\tgridType : 'giftlist',\r\n\t\t\t\t\trecordModel : HMCM.BaseGiftModel\r\n\t\t\t\t}),\r\n\t\t\t\tview : new HMCM.QueryResultView({\r\n\t\t\t\t\tmapResultRenderData : HMCM.mapGiftsQueryResultRenderData,\r\n\t\t\t\t\trenderResult : HMCM.renderQueryResult,\r\n\t\t\t\t\tbundleEvent : HMCM.bundleGiftsQueryResultEvent\r\n\t\t\t\t})\r\n\t\t\t}),\r\n\t\t\tmodel : new HMCM.QueryModel({\r\n\t\t\t\tqueryKeys : queryKeys\r\n\t\t\t}),\r\n\t\t\tview : new HMCM.QueryView({\r\n\t\t\t\tmapRenderDataFn : HMCM.mapGiftQueryFormRenderData,\r\n\t\t\t\tbundleQueryEvent : HMCM.bundleGiftsQueryEvent\r\n\t\t\t})\r\n\r\n\t\t});\r\n\t\t\r\n\t};\r\n\r\n\tvar MCMGiftDetailInit = function () {\r\n\t\tvar ctx = Hualala.PageRoute.getPageContextByPath(),\r\n\t\t\t$body = $('#ix_wrapper > .ix-body > .container');\r\n\t\t$body.html('<h1>礼品详情页</h1>');\r\n\t\tvar panel = new HMCM.GiftDetailPage({\r\n\t\t\tcontainer : $body\r\n\t\t});\r\n\r\n\t};\r\n\r\n\tvar MCMEventMgrInit = function () {\r\n\t\tvar ctx = Hualala.PageRoute.getPageContextByPath(),\r\n\t\t\t$body = $('#ix_wrapper > .ix-body > .container');\r\n\t\tvar queryKeys = Hualala.MCM.QueryFormKeys.EventMgrQueryKeys;\r\n\t\t$body.html('<h1>活动管理页</h1>');\r\n\t\tvar panel = new HMCM.QueryController({\r\n\t\t\tcontainer : $body,\r\n\t\t\tresultController : new HMCM.QueryResultControler({\r\n\t\t\t\tcontainer : $body,\r\n\t\t\t\tmodel : new HMCM.GiftMgrResultModel({\r\n\t\t\t\t\tcallServer : Hualala.Global.getMCMEvents,\r\n\t\t\t\t\tqueryKeys : queryKeys,\r\n\t\t\t\t\tgridType : 'eventlsit',\r\n\t\t\t\t\trecordModel : HMCM.BaseEventModel\r\n\t\t\t\t}),\r\n\t\t\t\tview : new HMCM.QueryResultView({\r\n\t\t\t\t\tmapResultRenderData : HMCM.mapEventsQueryResultRenderData,\r\n\t\t\t\t\trenderResult : HMCM.renderQueryResult,\r\n\t\t\t\t\tbundleEvent : HMCM.bundleEventsQueryResultEvent\r\n\t\t\t\t}),\r\n\t\t\t\t// view : new HMCM.QueryResultView({\r\n\t\t\t\t// \tmapResultRenderData : HMCM.mapGiftsQueryResultRenderData,\r\n\t\t\t\t// \trenderResult : HMCM.renderQueryResult,\r\n\t\t\t\t// \tbundleEvent : HMCM.bundleGiftsQueryResultEvent\r\n\t\t\t\t// })\r\n\t\t\t}),\r\n\t\t\tmodel : new HMCM.QueryModel({\r\n\t\t\t\tqueryKeys : queryKeys\r\n\t\t\t}),\r\n\t\t\tview : new HMCM.QueryView({\r\n\t\t\t\tmapRenderDataFn : HMCM.mapEventQueryFormRenderData,\r\n\t\t\t\tbundleQueryEvent : HMCM.bundleEventsQueryEvent\r\n\t\t\t})\r\n\t\t});\r\n\t};\r\n\r\n\tvar MCMEventTrackInit = function () {\r\n\t\tvar ctx = Hualala.PageRoute.getPageContextByPath(),\r\n\t\t\t$body = $('#ix_wrapper > .ix-body > .container');\r\n\t\t$body.html('<h1>活动跟踪页</h1>');\r\n\t\tvar panel = new HMCM.EventTrackPage({\r\n\t\t\tcontainer : $body\r\n\t\t});\r\n\t};\r\n\r\n\tHMCM.MCMHomePageInit = MCMHomePageInit;\r\n\tHMCM.MCMGiftsMgrInit = MCMGiftsMgrInit;\r\n\tHMCM.MCMGiftDetailInit = MCMGiftDetailInit;\r\n\tHMCM.MCMEventMgrInit = MCMEventMgrInit;\r\n\tHMCM.MCMEventTrackInit = MCMEventTrackInit;\r\n})(jQuery, window);;(function ($, window) {\r\n\tIX.ns(\"Hualala.Common\");\r\n\tvar pageBrickConfigs = [\r\n\t\t{name : 'setting', title : '业务', label : '开通业务•业务参数', brickClz : 'home-brick-md-1', itemClz : 'brick-item', icon : 'icon-setting'},\r\n\t\t{name : 'account', title : '结算', label : '账户设置•提现•结算报表', brickClz : 'home-brick-md-2', itemClz : 'brick-item', icon : 'icon-pay'},\r\n\t\t{name : 'order', title : '订单', label : '查询•报表•菜品排行', brickClz : 'home-brick-md-2', itemClz : 'brick-item', icon : 'icon-order'},\r\n\t\t{name : 'shop', title : '店铺', label : '开店•信息•菜谱', brickClz : 'home-brick-md-1', itemClz : 'brick-item', icon : 'icon-home'},\r\n\r\n\t\t{name : 'pcclient', title : '下载', label : '哗啦啦代理程序', brickClz : 'home-brick-md-1', itemClz : 'brick-item', icon : 'icon-download'},\r\n\t\t{name : 'user', title : '权限', label : '用户•权限', brickClz : 'home-brick-md-1', itemClz : 'brick-item', icon : 'icon-lock'},\r\n        {name : 'weixin', title : '微信', label : '网络餐厅•营销', brickClz : 'home-brick-md-1', itemClz : 'brick-item', icon : 'icon-weixin'},\r\n\t\t{name : 'crm', title : '会员', label : '概览•报表•参数•营销', brickClz : 'home-brick-md-1', itemClz : 'brick-item', icon : 'icon-crm'},\r\n\t\t{name : 'mcm', title : '营销', label : '礼品•营销活动', brickClz : 'home-brick-md-2', itemClz : 'brick-item', icon : 'icon-crm'}\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t];\r\n\tfunction isSupportedBrowser () {\r\n\t\tvar bd = Hualala.Common.Browser;\r\n\t\tvar isIE = !$XP(bd, 'ie', null) ? false : true,\r\n\t\t\tversion = parseInt($XP(bd, 'ie', 0));\r\n\t\tvar allowOldVersion = IX.Cookie.get('allowOldVersion') == 1 ? true : false;\r\n\t\tif (!isIE || allowOldVersion) return true;\r\n\t\tif (version > 8) return true;\r\n\t\tvar msg = version == 8 ? \r\n\t\t\t'您使用的IE浏览器版本过于陈旧，可能无法获得我们为您提供的良好的用户体验。<br/>我们建议您使用以下的浏览器或插件进行访问！' : \r\n\t\t\t'您使用的IE浏览器版本过于陈旧，无法使用我们为您提供的管理功能。<br/>请您使用以下提供的浏览器进行访问！';\r\n\t\tvar browserLib = [\r\n\t\t\t{\r\n\t\t\t\thref : 'http://www.microsoft.com/zh-cn/download/internet-explorer-9-details.aspx',\r\n\t\t\t\ticon : 'icon-ie9',\r\n\t\t\t\tname : 'IE9',\r\n\t\t\t\tdesc : 'IE9浏览器是微软公司在2009年推出的新一代浏览器，比IE8界面更简洁，采用硬件加速功能，使访问页面更稳定，部分支持HTML5，CSS3特性。'\r\n\t\t\t},\r\n\t\t\t{\r\n\t\t\t\thref : 'http://www.microsoft.com/zh-cn/download/internet-explorer-10-details.aspx',\r\n\t\t\t\ticon : 'icon-ie10',\r\n\t\t\t\tname : 'IE10',\r\n\t\t\t\tdesc : 'IE10浏览器是微软公司在2011年推出的IE9的下一代浏览器，在IE9的基础上增强了CSS3解析及硬件加速功能，并支持了HTML5。'\r\n\t\t\t},\r\n\t\t\t{\r\n\t\t\t\thref : 'http://www.google.cn/intl/zh-CN/chrome/',\r\n\t\t\t\ticon : 'icon-chrome',\r\n\t\t\t\tname : 'Chrome',\r\n\t\t\t\tdesc : 'Chrome浏览器是由著名的搜索引擎巨头--谷歌(google)公司推出的现代浏览器，访问网页速度更快，稳定性更强，更具安全性，使用界面更加简洁有效，并完全支持HTML5，CSS3标准的特性。'\r\n\t\t\t},\r\n\t\t\t{\r\n\t\t\t\thref : 'http://www.firefox.com.cn/download/',\r\n\t\t\t\ticon : 'icon-firefox',\r\n\t\t\t\tname : 'Firefox',\r\n\t\t\t\tdesc : 'FireFox是Mozilla推出的现代浏览器，全面支持HTML5，CSS3标准的特性。访问页面速度更快，更具安全性。'\r\n\t\t\t},\r\n\t\t\t{\r\n\t\t\t\thref : 'http://ie.sogou.com/',\r\n\t\t\t\ticon : 'icon-sogou',\r\n\t\t\t\tname : '搜狗浏览器',\r\n\t\t\t\tdesc : '搜狗浏览器是搜狐公司推出的双核告诉浏览器--可以切换为全球最快的Webkit内核(Chrome浏览器)同时也可以切换为使用最普遍的IE内核(IE浏览器)，保证良好的兼容性的同时极大的提升网页的浏览速度。'\r\n\t\t\t}\r\n\t\t];\r\n\t\tvar tpl = Handlebars.compile(Hualala.TplLib.get('tpl_site_browserSupport'));\r\n\t\tvar $jumbotron = $(tpl({msg : msg, items : browserLib}));\r\n\t\t$('body > #ix_wrapper').remove();\r\n\t\t$jumbotron.appendTo($('body'));\r\n\t\t$jumbotron.find('.btn').click(function (e) {\r\n\t\t\tIX.Cookie.set('allowOldVersion', 1);\r\n\t\t\tHualala.Router.check();\r\n\t\t});\r\n\t\treturn false;\r\n\t}\r\n\tfunction initPageLayout (pageCfg, pageType) {\r\n\t\tvar session = Hualala.getSessionData(),\r\n\t\t\tlayoutTpl = Handlebars.compile(Hualala.TplLib.get('tpl_site_layout'));\r\n\t\tvar isLogin = !$XP(Hualala.getSessionUser(), 'loginName', null) ? false : true,\r\n\t\t\tloginName = $XP(session, 'user.loginName', ''),\r\n\t\t\tisSuperAdmin = false,\r\n\t\t\tgroupName = $XP(session, 'site.groupName', '');\r\n\t\tvar bindMobileWizard = IX.Cookie.get('bindMobileWizard') == 1 ? false : true;\r\n\t\tif ($XP(session, 'user.loginName') == 'admin' && _.find($XP(session, 'user.role', []), function (r) {return r == 'admin'})) {\r\n\t\t\tisSuperAdmin = true;\r\n\t\t}\r\n\t\tvar mapRanderData = function () {\r\n\t\t\tvar header = {\r\n\t\t\t\tpcClientPath : Hualala.PageRoute.createPath('pcclient'),\r\n\t\t\t\thualalaUrl : Hualala.Global.HualalaWebSite,\r\n\t\t\t\tloginName : loginName,\r\n\t\t\t\tmerchantRoot : Hualala.PageRoute.createPath('main'),\r\n\t\t\t\tgroupName : groupName,\r\n\t\t\t\t// isLogin : !isLogin ? 'hidden' : '',\r\n\t\t\t\tisLogin : isLogin,\r\n\t\t\t\tlogoutPath : Hualala.Global.getLogoutJumpToUrl(),\r\n\t\t\t\tlogo : Hualala.Global.getDefaultImage('logo'),\r\n\t\t\t\tisSuperAdmin : isSuperAdmin\r\n\t\t\t},\r\n\t\t\tfooter = {\r\n\t\t\t\taboutPath : Hualala.PageRoute.createPath(\"about\") || '#',\r\n\t\t\t\tcontactPath : Hualala.PageRoute.createPath(\"contact\") || '#',\r\n\t\t\t\t// aboutPath : Hualala.Global.getAboutUsUrl() || '#',\r\n\t\t\t\t// contactPath : Hualala.Global.getContactUsUrl() || '#',\r\n\t\t\t\tgozapLogo : Hualala.Global.getDefaultImage('gozap')\r\n\t\t\t};\r\n\t\t\treturn {\r\n\t\t\t\theader : header,\r\n\t\t\t\tfooter : footer\r\n\t\t\t};\r\n\t\t};\r\n\t\tvar $wrapper = $(layoutTpl(mapRanderData()));\r\n\t\tvar userMgr = null;\r\n\t\t$('body > #ix_wrapper').remove();\r\n\t\tif (isSupportedBrowser()) {\r\n\t\t\t$wrapper.appendTo($('body'));\r\n            if(/main|pcclient|about|contact|login/.test(pageType))\r\n                $wrapper.addClass('no-nav');\r\n\t\t\tif (isLogin) {\r\n\t\t\t\tuserMgr = new Hualala.User.UserMgrModal({\r\n\t\t\t\t\t$btnGrp : $wrapper.find('.user-mgr')\r\n\t\t\t\t});\r\n\t\t\t\tif (bindMobileWizard && $XP(session, 'user.mobileBinded') == 0 && $XP(session, 'user.loginCount') == 1) {\r\n\t\t\t\t\t$wrapper.find('.user-mgr .btn[data-target=bind_mobile]').trigger('click');\r\n\t\t\t\t\tIX.Cookie.set('bindMobileWizard', 1);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tvar footerAnimation = function (expand) {\r\n\t\t\t\tvar $footer = $('#ix_wrapper .ix-footer');\r\n\t\t\t\tvar $cnt = $footer.find('.footer-cnt');\r\n\t\t\t\tif ($footer.hasClass('in') == expand) return;\r\n\t\t\t\t$cnt.animate({\r\n\t\t\t\t\theight : !expand ? '0px' : '100px'\r\n\t\t\t\t}, 400, function () {\r\n\t\t\t\t\t$footer[!expand ? 'removeClass' : 'addClass']('in');\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t\t// @NOTE: For 1.1 hidden site footer (#4105)\r\n\t\t\t// $('#ix_wrapper .ix-footer').on('mouseleave', function (e) {\r\n\t\t\t// \tfooterAnimation(false);\r\n\t\t\t// });\r\n\t\t\t// $('#ix_wrapper .btn-toggle').on('mouseenter', function (e) {\r\n\t\t\t// \tfooterAnimation(true);\r\n\t\t\t// });\r\n\t\t\t// footerAnimation(false);\r\n\t\t}\r\n\t\tif ($.fn.bootstrapValidator) {\r\n\t\t\t$.fn.bootstrapValidator.DEFAULT_OPTIONS = $.extend({}, $.fn.bootstrapValidator.DEFAULT_OPTIONS, {\r\n\t\t\t\tmessage: '您输入的数据有误，请核对后再次输入',\r\n                trigger: 'blur',\r\n\t\t\t\tfeedbackIcons : {\r\n\t\t\t\t\tvalid : 'glyphicon glyphicon-ok',\r\n\t\t\t\t\tinvalid : 'glyphicon glyphicon-remove',\r\n\t\t\t\t\tvalidating : 'glyphicon glyphicon-refresh'\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\t$.fn.bootstrapValidator.validators.accuracy = {\r\n\t\t\t\tvalidate : function (validator, $field, options) {\r\n\t\t\t\t\tvar accuracy = $XP(options, 'accuracy', null),\r\n\t\t\t\t\t\tmessage = $XP(options, 'message', '');\r\n\t\t\t\t\taccuracy = isNaN(accuracy) ? null : accuracy;\r\n\t\t\t\t\tvar value = $field.val();\r\n\t\t\t\t\tvar regxStr = (IX.isEmpty(accuracy) || accuracy == 0) ? \"^\\\\d+$\" : \"^\\\\d+(\\\\.\\\\d{1,\" + accuracy + \"})?$\",\r\n\t\t\t\t\t\tregX = null;\r\n\t\t\t\t\tregX = new RegExp(regxStr);\r\n\t\t\t\t\tif (isNaN(value)) {\r\n\t\t\t\t\t\treturn {\r\n\t\t\t\t\t\t\tvalid : false,\r\n\t\t\t\t\t\t\tmessage : \"只能是数字\"\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (!regX.test(value)) {\r\n\t\t\t\t\t\treturn {\r\n\t\t\t\t\t\t\tvalid : false,\r\n\t\t\t\t\t\t\tmessage : message\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn true;\r\n\t\t\t\t}\r\n\t\t\t};\r\n\t\t}\r\n\t}\r\n\r\n\tfunction initSiteNavBar (pageType) {\r\n\t\tvar session = Hualala.getSessionData(),\r\n\t\t\tnavTpl = Handlebars.compile(Hualala.TplLib.get('tpl_site_navbar')),\r\n\t\t\tnavToggleTpl = Handlebars.compile(Hualala.TplLib.get('tpl_site_navbarToggle')),\r\n\t\t\trights = Hualala.getSessionUserRight();\r\n\t\tvar mapRanderData = function () {\r\n\t\t\tvar rightHT = new IX.IListManager();\r\n\t\t\tIX.iterate(rights, function (el) {\r\n\t\t\t\trightHT.register(el.name, el);\r\n\t\t\t});\r\n\t\t\t// var navs = _.map(Hualala.TypeDef.SiteNavType, function (v, i, list) {\r\n\t\t\t// \tvar hasRight = !rightHT.get(v.name) ? false : true;\r\n\t\t\t// \treturn {\r\n\t\t\t// \t\tactive : !Hualala.Global.isCurrentPage(v.name) ? '' : 'active',\r\n\t\t\t// \t\tdisabled : !hasRight ? 'disabled' : '',\r\n\t\t\t// \t\tnoPath : !hasRight ? true : false,\r\n\t\t\t// \t\tpath : Hualala.PageRoute.createPath(v.name) || '#',\r\n\t\t\t// \t\tname : v.name,\r\n\t\t\t// \t\tlabel : v.label,\r\n\t\t\t// \t};\r\n\t\t\t// });\r\n\t\t\tvar navs = _.map(Hualala.TypeDef.SiteNavType, function (v, i, list) {\r\n\t\t\t\tvar hasRight = !rightHT.get(v.name) ? false : true;\r\n\t\t\t\tvar subnavs = $XP(v, 'subnavs', []);\r\n\t\t\t\tsubnavs = _.map(subnavs, function (s) {\r\n\t\t\t\t\treturn {\r\n\t\t\t\t\t\tpath : Hualala.PageRoute.createPath(s.name) || '#',\r\n\t\t\t\t\t\tname : s.name,\r\n\t\t\t\t\t\tlabel : s.label\r\n\t\t\t\t\t};\r\n\t\t\t\t});\r\n\t\t\t\tvar list = {\r\n\t\t\t\t\tactive : !Hualala.Global.isCurrentPage(v.name) ? '' : 'active',\r\n\t\t\t\t\tdisabled : !hasRight ? 'disabled' : '',\r\n\t\t\t\t\tnoPath : !hasRight ? true : false,\r\n\t\t\t\t\tpath : Hualala.PageRoute.createPath(v.name) || '#',\r\n\t\t\t\t\tname : v.name,\r\n\t\t\t\t\tlabel : v.label,\r\n\t\t\t\t\tisSubNav : v.type == 'subnav' ? true : false,\r\n\t\t\t\t\tsubnavs : subnavs\r\n\t\t\t\t};\r\n\t\t\t\treturn list;\r\n\t\t\t});\r\n\t\t\treturn {items : navs};\r\n\t\t};\r\n\t\tvar $navbar = $(navTpl(mapRanderData())),\r\n\t\t\t$navToggle = $(navToggleTpl({target : '#site_navbar'})),\r\n\t\t\t$header = $('#ix_wrapper .ix-header');\r\n\t\t$header.find('> .container .navbar-collapse').remove();\r\n\t\t$header.find('> .container').append($navbar);\r\n\t\t$header.find('> .container > .navbar-header .navbar-toggle').remove();\r\n\t\t$header.find('> .container > .navbar-header').prepend($navToggle);\r\n\r\n\t}\r\n\r\n\tfunction initHomePage (pageType, params) {\r\n\t\tvar site = Hualala.getSessionSite(),\r\n\t\t\tuser = Hualala.getSessionUser(),\r\n\t\t\troles = Hualala.getSessionRoles(),\r\n\t\t\tpcclient = Hualala.getSessionPCClient(),\r\n\t\t\trights = Hualala.getSessionUserRight();\r\n\t\tvar $body = $('#ix_wrapper > .ix-body > .container');\r\n\t\tvar mapRanderData = function () {\r\n\t\t\tvar ht = new IX.IListManager();\r\n\t\t\tvar ret = null;\r\n\t\t\tIX.iterate(rights, function (el) {\r\n\t\t\t\tht.register(el.name, el);\r\n\t\t\t});\r\n\t\t\tret = _.map(pageBrickConfigs, function (el, i, l) {\r\n\t\t\t\tvar name = $XP(el, 'name');\r\n\t\t\t\tvar hasRight = !ht.get(name) ? false : true;\r\n\t\t\t\treturn IX.inherit(el, {\r\n\t\t\t\t\titemClz : ($XP(el, 'itemClz', '') + ' ' + (!hasRight ? 'disabled' : ''))\r\n\t\t\t\t});\r\n\t\t\t});\r\n\t\t\treturn ret;\r\n\t\t};\r\n\t\t// Home Page \r\n\t\tvar tpl = Handlebars.compile(Hualala.TplLib.get('tpl_site_homepage'));\r\n\t\tvar $bricks = $(tpl({bricks : mapRanderData()}));\r\n\t\t$body.html($bricks);\r\n\t\t$bricks.on('mouseenter mouseleave click', '.brick-item', function (e) {\r\n\t\t\tvar $this = $(this), pageName = $this.attr('data-pagename'),\r\n\t\t\t\teType = e.type;\r\n\t\t\tif ($this.hasClass('disabled')) return false;\r\n\t\t\tif (eType == 'click') {\r\n\t\t\t\t// console.info($this.attr('data-pagename'));\r\n\t\t\t\tdocument.location.href = Hualala.PageRoute.createPath(pageName);\r\n\t\t\t} else {\r\n\t\t\t\t$this.toggleClass('hover');\r\n\t\t\t}\r\n\t\t\t\r\n\t\t});\r\n\t}\r\n\r\n\tfunction initLoginPage (pageType, params) {\r\n\t\tvar tpl = Handlebars.compile(Hualala.TplLib.get('tpl_site_login'));\r\n\t\tvar $loginBox = $(tpl({\r\n\t\t\tbannerImg : Hualala.Global.getDefaultImage('loginBanner')\r\n\t\t}));\r\n\t\tvar $body = $('#ix_wrapper > .ix-body > .container');\r\n\t\t$body.html($loginBox);\r\n\t\tvar loginPanel = new Hualala.Entry.initLogin({\r\n\t\t\t$container : $loginBox\r\n\t\t});\r\n\t}\r\n\r\n\tfunction initAboutPage (pageType, params) {\r\n\t\tvar $body = $('#ix_wrapper > .ix-body');\r\n\t\tvar tpl = Handlebars.compile(Hualala.TplLib.get('tpl_site_about'));\r\n\t\tvar $page = $(tpl());\r\n\t\t$page.replaceAll($body);\r\n\t}\r\n\r\n\tfunction initContactPage (pageType, params) {\r\n\t\tvar $body = $('#ix_wrapper > .ix-body');\r\n\t\tvar tpl = Handlebars.compile(Hualala.TplLib.get('tpl_site_contact'));\r\n\t\tvar $page = $(tpl());\r\n\t\t$page.replaceAll($body);\r\n\t}\r\n\r\n\tfunction initPCClientDownloadPage () {\r\n\t\tvar $body = $('#ix_wrapper > .ix-body');\r\n\t\tvar tpl = Handlebars.compile(Hualala.TplLib.get('tpl_client_download'));\r\n\t\tvar sessionData = Hualala.getSessionData();\r\n\r\n\t\tvar $page = $(tpl({\r\n\t\t\thref : $XP(sessionData, 'pcClient.downloadClientAddress', '#'),\r\n\t\t\ttitle : $XP(sessionData, 'pcClient.version', ''),\r\n\t\t}));\r\n\t\t$page.replaceAll($body);\r\n\t}\r\n\r\n\r\n\tHualala.Common.LoginInit = initLoginPage;\r\n\tHualala.Common.initPageLayout = initPageLayout;\r\n\tHualala.Common.initSiteNavBar = initSiteNavBar;\r\n\tHualala.Common.HomePageInit = initHomePage;\r\n\tHualala.Common.AboutInit = initAboutPage;\r\n\tHualala.Common.ContactInit = initContactPage;\r\n\tHualala.Common.PCClientDownloadInit = initPCClientDownloadPage;\r\n\t\r\n\r\n\tHualala.Common.IndexInit = function () {\r\n\t\tdocument.location.href = Hualala.PageRoute.createPath(\"main\");\r\n\t}\r\n\t\r\n})(jQuery, window);;(function ($, window) {\r\n\tIX.ns(\"Hualala\");\r\n\tvar sessionData = null;\r\n\t// 获取SessionData\r\n\tHualala.getSessionData = function () {return sessionData;};\r\n\tHualala.getSessionSite = function () {return $XP(sessionData, 'site', null); };\r\n\tHualala.getSessionUser = function () {return $XP(sessionData, 'user', null); };\r\n\tHualala.getSessionRoles = function () {return $XP(sessionData, 'roles', []); };\r\n\tHualala.getSessionPCClient = function () {return $XP(sessionData, 'pcClient', null); };\r\n\tHualala.getSessionUserRight = function () {return $XP(sessionData, 'userRight', [])};\r\n\t// 判断指定用户是否为当前登录用户\r\n\tHualala.isSessionUser = function (groupLoginName, loginName) {\r\n\t\tvar _name = $XP(sessionData, 'user.groupLoginName') + $XP(sessionData, 'user.loginName');\r\n\t\treturn sessionData && _name == (groupLoginName + loginName);\r\n\t};\r\n\r\n\tfunction loadSession(appData, cbFn) {\r\n\t\tif (!$XP(appData, 'user', null)) {\r\n\t\t\tthrow(\"Permission Deny!!\");\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tsessionData = appData;\r\n\t\tcbFn();\r\n\t}\r\n\r\n\tfunction initMainPage(cbFn) {\r\n\t\tvar tick = IX.getTimeInMS();\r\n\t\tlog(\"Merchant Sys INIT : \" + tick);\r\n\t\tHualala.Global.loadAppData({}, function (appData) {\r\n\t\t\tlog(\"Load Merchant APP Data in (ms): \" + (IX.getTimeInMS() - tick));\r\n\t\t\tif ($XP(appData, 'resultcode') != 0) {\r\n\t\t\t\tsessionData = null;\r\n\t\t\t\tdocument.location.href = Hualala.PageRoute.createPath('login');\r\n\t\t\t\tthrow(\"Session Data Load Faild!! resultcode = \" + $XP(appData, 'resultcode', '') + \"; resultMsg = \" + $XP(appData, 'resultmsg', ''));\r\n\t\t\t\treturn;\t\r\n\t\t\t}\r\n\t\t\tloadSession($XP(appData, 'data', {}), function () {\r\n\t\t\t\tlog(\"Merchant Sys INIT DONE in (ms): \" + (IX.getTimeInMS() - tick));\r\n\t\t\t\tcbFn();\r\n\t\t\t});\r\n\t\t}, function () {\r\n\t\t\tdocument.location.href = Hualala.PageRoute.createPath('login');\r\n\t\t\treturn ;\r\n\t\t});\r\n\t}\r\n\r\n\tfunction initRouteEngine () {\r\n\t\tif (!IX.nsExisted(\"Hualala.ajaxEngine.init\")) return;\r\n\t\t$.ajaxSetup({\r\n\t\t\tbeforeSend : function (xhr) {\r\n\t\t\t\txhr.setRequestHeader('X-CSRF-Token', $('meta[name=\"csrf-token\"]').attr('content'));\r\n\t\t\t}\r\n\t\t});\r\n\t\tHualala.ajaxEngine.init({\r\n\t\t\tajaxFn : jQuery.ajax,\r\n\t\t\tbaseUrl : Hualala.Global.HOME,\r\n\t\t\tcommonUrl : Hualala.Global.CommonSite,\r\n\t\t\timgUrl : Hualala.Global.IMAGE_ROOT\r\n\t\t});\r\n\t\t// Hualala.urlEngine would be initialized as ajaxEngine was initialized! ignore urlEngine's initializing.\r\n\t};\r\n\r\n\t\r\n\t/**\r\n\t * 商户系统整体加载\r\n\t * @param  {Object} cfg {config:{}, type : \"页面类型login|main|shop|setting|account|user...\"}\r\n\t * @return {NULL}     \r\n\t */\r\n\tvar APPInitialized = false, currentType;\r\n\t\r\n\tHualala.init = function () {\r\n\t\tif (!APPInitialized) {\r\n\t\t\tinitRouteEngine();\r\n\t\t\t\r\n\t\t\t// initMainPage(function () {\r\n\t\t\t// \tHualala.PageRoute.start(function (pageName) {\r\n\t\t\t// \t\tvar hasNoNavPages = 'main,pcclient,about,contact';\r\n\t\t\t// \t\tHualala.Common.initPageLayout({}, pageName);\r\n\t\t\t// \t\tif (hasNoNavPages.indexOf(pageName) < 0) {\r\n\t\t\t// \t\t\tHualala.Common.initSiteNavBar(pageName);\r\n\t\t\t// \t\t}\r\n\t\t\t// \t});\r\n\t\t\t// });\r\n\r\n\t\t\tHualala.PageRoute.start(function (pageName, pageParams, pageInitFn) {\r\n\t\t\t\tvar hasNoNavPages = 'main,pcclient,about,contact,login';\r\n\t\t\t\tvar commonPages = _.filter(hasNoNavPages.split(','), function (v) {return v != 'main'}).join(',');\r\n\t\t\t\tif (commonPages.indexOf(pageName) >= 0) {\r\n\t\t\t\t\tHualala.Common.initPageLayout({}, pageName);\r\n\t\t\t\t\tif (hasNoNavPages.indexOf(pageName) < 0) {\r\n\t\t\t\t\t\tHualala.Common.initSiteNavBar(pageName);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tpageInitFn && pageInitFn.apply(null, [pageName, pageParams]);\r\n\t\t\t\t\treturn ;\r\n\t\t\t\t}\r\n\t\t\t\tinitMainPage(function () {\r\n\t\t\t\t\tHualala.Common.initPageLayout({}, pageName);\r\n\t\t\t\t\tif (hasNoNavPages.indexOf(pageName) < 0) {\r\n\t\t\t\t\t\tHualala.Common.initSiteNavBar(pageName);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tpageInitFn && pageInitFn.apply(null, [pageName, pageParams]);\r\n\t\t\t\t});\r\n\t\t\t});\r\n\t\t\t\r\n\t\t\tAPPInitialized = true;\r\n\t\t}\r\n\t};\r\n\r\n})(jQuery, window);;(function ($, window) {\r\n\tIX.ns(\"Hualala.PageRoute\");\r\n\tvar Router = Hualala.Router,\r\n\t\troutes = Hualala.Global.Route;\r\n\tvar isInitialized = false,\r\n\t\tPageConfigurations = {},\r\n\t\tPath2NameMapping = {};\r\n\r\n\tfunction mappingRoute (_path, _name, _reg) {\r\n\t\tvar match = _path.match(_reg);\r\n\t\tif (!match) return;\r\n\t\tvar s = match.shift(),\r\n\t\t\tarr = s.split('/');\r\n\t\tarr = _.map(arr, function (v, i, l) {\r\n\t\t\tvar bingo = _.indexOf(s, v);\r\n\t\t\tif (bingo > -1) {\r\n\t\t\t\treturn '_';\r\n\t\t\t}\r\n\t\t\treturn v;\r\n\t\t});\r\n\t\tarr.push(\"\"); arr.unshift(\"\");\r\n\t\tvar _pattern = arr.join(\"_\");\r\n\t\tPath2NameMapping[_pattern] = _name;\r\n\t}\r\n\r\n\tvar detectPageInitializor = (function () {\r\n\t\tvar ht = new IX.I1ToNManager();\r\n\t\tvar fnames = [];\r\n\t\tfunction _checkItem(fname) {\r\n\t\t\tif (!IX.isFn(IX.getNS(fname)))\r\n\t\t\t\treturn false;\r\n\t\t\tvar _list = ht.get(fname),\r\n\t\t\t\t_fn = IX.getNS(fname);\r\n\t\t\tfor (var j = 0; j < _list.length; j++)\r\n\t\t\t\tPageConfigurations[_list[j]].init = _fn;\r\n\t\t\tht.remove(fname);\r\n\t\t\treturn true;\r\n\t\t}\r\n\r\n\t\tfunction _checking() {\r\n\t\t\tfnames = IX.loop(fnames, [], function (acc, fname) {\r\n\t\t\t\tif (!_checkItem(fname))\r\n\t\t\t\t\tacc.push(fname);\r\n\t\t\t\treturn acc;\r\n\t\t\t});\r\n\t\t\treturn fnames.length == 0;\r\n\t\t}\r\n\r\n\t\tfunction _check () {\r\n\t\t\tfnames = IX.Array.toSet(fnames);\r\n\t\t\tIX.checkReady(_checking, IX.emptyFn, 40, {\r\n\t\t\t\tmaxAge : 15000,\r\n\t\t\t\texpire : function () {\r\n\t\t\t\t\t//alert(\"Can't find page inializor : \\n\" + fnames.join(\"\\n\"));\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\t\t\r\n\t\tfunction _detect(name, fname) {\r\n\t\t\tvar _fn = null;\r\n\t\t\tif (IX.isFn(fname)) {\r\n\t\t\t\t_fn = fname;\r\n\t\t\t} else if (!IX.isString(fname)) {\r\n\t\t\t\tthrow(\"Configuration failed : Invalid Page Initialized for \" + name);\r\n\t\t\t\treturn false;\r\n\t\t\t} else if (IX.nsExisted(fname)) {\r\n\t\t\t\t_fn = IX.getNS(fname);\r\n\t\t\t}\r\n\t\t\tif (IX.isFn(_fn)) {\r\n\t\t\t\treturn PageConfigurations[name].init = _fn;\r\n\t\t\t}\r\n\t\t\tht.put(fname, name);\r\n\t\t\tfnames.push(fname);\r\n\t\t}\r\n\t\treturn {\r\n\t\t\tstart : function () {setTimeout(_check, 1);},\r\n\t\t\tdetect : _detect\r\n\t\t}\r\n\t})();\r\n\r\n\t/**\r\n\t * 获取路由路径\r\n\t * @param  {String} name   路由配置的名称\r\n\t * @param  {Array|NULL} params 组装路由需要的参数，按照路由规则按顺序给出参数\r\n\t * @return {String}        返回生成的路由\r\n\t */\r\n\tfunction getPathByName (name, params) {\r\n\t\tvar cfg = PageConfigurations[name];\r\n\t\tif (!cfg) \r\n\t\t\treturn console.err(\"Can't find route : \" + name);\r\n\t\tvar path = $XP(cfg, 'path'), reg = $XP(cfg, 'reg'),\r\n\t\t\tmatch = path.match(reg);\r\n\t\tvar genPath = function (p) {\r\n\t\t\treturn Hualala.Global.HOME + p;\r\n\t\t};\r\n\t\tif (!match || match.length < 1) {\r\n\t\t\treturn console.err(\"The Path of Route (\" + name + \") is wrong!!\");\r\n\t\t} else if (match.length == 1) {\r\n\t\t\treturn genPath(path);\r\n\t\t} else if (match.length > 1 && IX.isArray(params) && (match.length - 1) == params.length) {\r\n\t\t\tmatch.shift();\r\n\t\t\t_.each(match, function (v, i, m) {\r\n\t\t\t\tpath = path.replace(v, params[i]);\r\n\t\t\t});\r\n\t\t\treturn genPath(path);\r\n\t\t}\r\n\t}\r\n\t/**\r\n\t * pageConfig : {\r\n\t * \t\tname : \"\",\r\n\t * \t\tpath : \"\",\r\n\t * \t\treg : RegExp,\r\n\t * \t\tbodyClz : \"\", default \"\"\r\n\t * \t\tPageInitiator : \"Hualala.User.init\" or function (cfg) {}\r\n\t * }\r\n\t * @param  {[type]} cbFn [description]\r\n\t * @return {[type]}      [description]\r\n\t */\r\n\tvar pageConfigs = [\r\n\t\t// home page 主页\r\n\t\t// 登录\r\n\t\t{\r\n\t\t\tname : \"login\", path : \"/#login\", reg : /login$/, bodyClz : \"\",\r\n\t\t\tPageInitiator : \"Hualala.Common.LoginInit\", label : \"登录\"\r\n\t\t},\r\n\t\t// home page主页\r\n\t\t{\r\n\t\t\tname : \"main\", path : \"/#home\", reg : /home$/, bodyClz : \"home\",\r\n\t\t\tPageInitiator : \"Hualala.Common.HomePageInit\", label : \"首页\"\r\n\t\t},\r\n\r\n\t\t// 店铺管理主页\t\t\r\n\t\t{\r\n\t\t\tname : \"shop\", path : \"/#shop\", reg : /shop$/, bodyClz : \"\",\r\n\t\t\tPageInitiator : \"Hualala.Shop.HomePageInit\", parentName : \"main\", label : \"店铺管理\"\r\n\t\t},\r\n\t\t// 创建店铺\r\n\t\t{\r\n\t\t\tname : \"shopCreate\", path : \"/#shop/create\", reg : /shop\\/create$/, bodyClz : \"\",\r\n\t\t\tPageInitiator : \"Hualala.Shop.CreateShopInit\", parentName : \"shop\", label : \"创建店铺\"\r\n\t\t},\r\n\t\t// 店铺信息管理\r\n\t\t{\r\n\t\t\tname : \"shopInfo\", path : \"/#shop/{id}/info\", reg : /shop\\/(.*)\\/info$/, bodyClz : \"\",\r\n\t\t\tPageInitiator : \"Hualala.Shop.BaseInfoMgrInit\", parentName : \"shop\", label : \"店铺信息\"\r\n\t\t},\r\n\t\t// 店铺菜单管理\r\n\t\t{\r\n\t\t\tname : \"shopMenu\", path : \"/#shop/{id}/menu\", reg : /shop\\/(.*)\\/menu$/, bodyClz : \"\",\r\n\t\t\tPageInitiator : \"Hualala.Shop.FoodMenuMgrInit\", parentName : \"shop\", label : \"菜单管理\"\r\n\t\t},\r\n\r\n\t\t// 店铺功能设置页面\r\n\t\t{\r\n\t\t\tname : \"setting\", path : \"/#setting\", reg : /setting$/, bodyClz : \"\",\r\n\t\t\tPageInitiator : \"Hualala.Setting.ShopMgrInit\", parentName : \"main\", label : \"业务设置\"\r\n\t\t},\r\n\r\n\t\t// 结算账户页面\r\n\t\t{\r\n\t\t\tname : \"account\", path : \"/#account\", reg : /account$/, bodyClz : \"\",\r\n\t\t\tPageInitiator : \"Hualala.Account.AccountListInit\", parentName : \"main\", label : \"资金结算\"\r\n\t\t},\r\n\t\t// 结算账户详情设置页面\r\n\t\t{\r\n\t\t\tname : \"accountDetail\", path : \"/#account/{id}/detail\", reg : /account\\/(.*)\\/detail$/, bodyClz : \"\",\r\n\t\t\tPageInitiator : \"Hualala.Account.AccountMgrInit\", parentName : \"account\", label : \"账户明细\"\r\n\t\t},\r\n\r\n\t\t// 用户管理页面\r\n\t\t{\r\n\t\t\tname : \"user\", path : \"/#user\", reg : /user$/, bodyClz : \"\",\r\n\t\t\tPageInitiator : \"Hualala.User.UserListInit\", parentName : \"main\", label : \"用户管理\"\r\n\t\t},\r\n\r\n\t\t// 订单报表页面\r\n\t\t{\r\n\t\t\tname : \"order\", path : \"/#order\", reg : /order$/, bodyClz : \"\",\r\n\t\t\tPageInitiator : \"Hualala.Order.OrderChartInit\", parentName : \"main\", label : \"订单报表\"\r\n\t\t},\r\n\r\n\t\t// 订单查询页面\r\n\t\t/*\r\n\t\t\tb : begin date(SecondTick)\r\n\t\t\te : end date(SecondTick)\r\n\t\t\tc : city ID\r\n\t\t\ts : order status ID\r\n\t\t\tn : shop ID\r\n\t\t\tm : mobile number\r\n\t\t\to : order key\r\n\t\t\ti : min amount\r\n\t\t\ta : max amount\r\n\r\n\t\t */\r\n\t\t{\r\n\t\t\tname : \"orderQuery\", path : \"/#order/query/b{begin}/e{end}/c{cityID}/n{shopID}/s{status}/m{mobile}/o{orderKey}/i{minAmount}/a{maxAmount}\", \r\n\t\t\treg : /order\\/query\\/b(.*)\\/e(.*)\\/c(.*)\\/n(.*)\\/s(.*)\\/m(.*)\\/o(.*)\\/i(.*)\\/a(.*)$/,\r\n\t\t\tbodyClz : \"\", PageInitiator : \"Hualala.Order.QueryOrderInit\", parentName : \"main\", label : \"订单查询\"\r\n\t\t},\r\n\r\n\t\t// 订单日汇总页面\r\n\t\t/*\r\n\t\t\tb : begin date(SecondTick)\r\n\t\t\te : end date(SecondTick)\r\n\t\t\tc : city ID\r\n\t\t\ts : order status ID\r\n\t\t\tn : shop ID\r\n\t\t */\r\n\t\t{\r\n\t\t\tname : \"orderQueryDay\", path : \"/#order/query/day/b{begin}/e{end}/c{cityID}/n{shopID}/s{status}\",\r\n\t\t\treg : /order\\/query\\/day\\/b(.*)\\/e(.*)\\/c(.*)\\/n(.*)\\/s(.*)/, bodyClz : \"\",\r\n\t\t\tPageInitiator : \"Hualala.Order.QueryOrderByDayDetailInit\", parentName : \"main\", label : \"订单日汇总\"\r\n\t\t},\r\n\r\n\t\t// 订单期间汇总页面\r\n\t\t/*\r\n\t\t\tb : begin date(SecondTick)\r\n\t\t\te : end date(SecondTick)\r\n\t\t\tc : city ID\r\n\t\t\ts : order status ID\r\n\t\t\tn : shop ID\r\n\t\t */\r\n\t\t{\r\n\t\t\tname : \"orderQueryDuring\", path : \"/#order/query/during/b{begin}/e{end}/c{cityID}/n{shopID}/s{status}\",\r\n\t\t\treg : /order\\/query\\/during\\/b(.*)\\/e(.*)\\/c(.*)\\/n(.*)\\/s(.*)/, bodyClz : \"\", \r\n\t\t\tPageInitiator : \"Hualala.Order.QueryOrderByDuringDetailInit\", parentName : \"main\", label : \"订单期间汇总\"\r\n\t\t},\r\n\r\n\t\t// 菜品销售排行页面\r\n\t\t/*\r\n\t\t\tb : begin date(SecondTick)\r\n\t\t\te : end date(SecondTick)\r\n\t\t\tc : city ID\r\n\t\t\tn : shopID\r\n\t\t\ts : foodCategoryName\r\n\t\t */\r\n\t\t{\r\n\t\t\tname : \"orderDishesHot\", path : \"/#order/dishes/hot/b{begin}/e{end}/c{cityID}/n{shopID}/s{foodCategoryName}\",\r\n\t\t\treg : /order\\/dishes\\/hot\\/b(.*)\\/e(.*)\\/c(.*)\\/n(.*)\\/s(.*)/, bodyClz : \"\",\r\n\t\t\tPageInitiator : \"Hualala.Order.QueryOrderDishesHotInit\", parentName : \"main\", label : \"菜品销量排行\"\r\n\t\t},\r\n\r\n\t\t// 订餐客户查询页面\r\n\t\t/*\r\n\t\t\tb : begin date(SecondTick)\r\n\t\t\te : end date(SecondTick)\r\n\t\t\tc : city ID\r\n\t\t\tn : shopID\r\n\t\t\tu : customerName\r\n\t\t\tm : mobile\r\n\t\t */\r\n\t\t{\r\n\t\t\tname : \"orderQueryCustomer\", path : \"/#order/customer/b{begin}/e{end}/c{cityID}/n{shopID}/m{mobile}/u{customerName}\",\r\n\t\t\treg : /order\\/customer\\/b(.*)\\/e(.*)\\/c(.*)\\/n(.*)\\/m(.*)\\/u(.*)/, bodyClz : \"\",\r\n\t\t\tPageInitiator : \"Hualala.Order.QueryOrderCustomerInit\", parentName : \"main\", label : \"顾客统计\"\r\n\t\t},\r\n\r\n\t\t// 营销活动管理模块(MCM)\r\n\t\t{\r\n\t\t\tname : \"mcm\", path : \"/#mcm\",\r\n\t\t\treg : /mcm$/, bodyClz : \"\",\r\n\t\t\tPageInitiator : \"Hualala.MCM.MCMHomePageInit\", parentName : \"main\", label : \"营销\"\r\n\t\t},\r\n\t\t{\r\n\t\t\tname : \"mcmGiftsMgr\", path : \"/#mcm/gifts\",\r\n\t\t\treg : /mcm\\/gifts$/, bodyClz : \"\",\r\n\t\t\tPageInitiator : \"Hualala.MCM.MCMGiftsMgrInit\", parentName : \"mcm\", label : \"礼品管理\"\r\n\t\t},\r\n\t\t{\r\n\t\t\tname : \"mcmGiftDetail\", path : \"/#mcm/gift/{giftItemID}/detail\",\r\n\t\t\treg : /mcm\\/gift\\/(.*)\\/detail$/, bodyClz : \"\",\r\n\t\t\tPageInitiator : \"Hualala.MCM.MCMGiftDetailInit\", parentName : \"mcmGiftsMgr\", label : \"礼品使用详情\"\r\n\t\t},\r\n\t\t{\r\n\t\t\tname : \"mcmEventMgr\", path : \"/#mcm/evts\",\r\n\t\t\treg : /mcm\\/evts$/, bodyClz : \"\",\r\n\t\t\tPageInitiator : \"Hualala.MCM.MCMEventMgrInit\", parentName : \"mcm\", label : \"营销活动管理\"\r\n\t\t},\r\n\t\t{\r\n\t\t\tname : \"mcmEventTrack\", path : \"/#mcm/evt/{eventID}/track\",\r\n\t\t\treg : /mcm\\/evt\\/(.*)\\/track$/, bodyClz : \"\",\r\n\t\t\tPageInitiator : \"Hualala.MCM.MCMEventTrackInit\", parentName : \"mcmEventMgr\", label : \"活动跟踪\"\r\n\t\t},\r\n\r\n\t\t// 会员系统管理\r\n\t\t/*\r\n\t\t\t\r\n\t\t */\r\n\t\t{\r\n\t\t\tname : \"crm\", path : \"/#crm\",\r\n\t\t\treg : /crm$/, bodyClz : \"\",\r\n\t\t\tPageInitiator : \"Hualala.CRM.CRMHomePageInit\", parentName : \"main\", label : \"会员管理\"\r\n\t\t},\r\n\t\t{\r\n\t\t\tname : \"crmMemberSchema\", path : \"/#crm/member/schema\",\r\n\t\t\treg : /crm\\/member\\/schema$/, bodyClz : \"\",\r\n\t\t\tPageInitiator : \"Hualala.CRM.MemberSchemaInit\", parentName : \"crm\", label : \"会员概览\"\r\n\t\t},\r\n\t\t{\r\n\t\t\tname : \"crmQueryMember\", path : \"/#crm/member/query\",\r\n\t\t\treg : /crm\\/member\\/query/, bodyClz : \"\",\r\n\t\t\tPageInitiator : \"Hualala.CRM.QueryMemberInit\", parentName : \"crm\", label : \"会员查询\"\r\n\t\t},\r\n\t\t{\r\n\t\t\tname : \"crmMemberDetail\", path : \"/#crm/member/{id}/detail\",\r\n\t\t\treg : /crm\\/member\\/(.*)\\/detail$/, bodyClz : \"\",\r\n\t\t\tPageInitiator : \"Hualala.CRM.MemberDetailInit\", parentName : \"crmQueryMember\", label : \"会员详情\"\r\n\t\t},\r\n\t\t{\r\n\t\t\tname : \"crmCardStats\", path : \"/#crm/member/cardstat\",\r\n\t\t\treg : /crm\\/member\\/cardstat$/, bodyClz : \"\",\r\n\t\t\tPageInitiator : \"Hualala.CRM.CardStatisticInit\", parentName : \"crm\", label : \"入会统计\"\r\n\t\t},\r\n\t\t{\r\n\t\t\tname : \"crmDealSummary\", path : \"/#crm/deal/sum\",\r\n\t\t\treg : /crm\\/deal\\/sum/, bodyClz : \"\",\r\n\t\t\tPageInitiator : \"Hualala.CRM.DealSummaryInit\", parentName : \"crm\", label : \"储值消费汇总\"\r\n\t\t},\r\n\t\t{\r\n\t\t\tname : \"crmDealDetail\", path : \"/#crm/deal/detail\",\r\n\t\t\treg : /crm\\/deal\\/detail/, bodyClz : \"\",\r\n\t\t\tPageInitiator : \"Hualala.CRM.DealDetailInit\", parentName : \"crm\", label : \"交易明细\"\r\n\t\t},\r\n\t\t{\r\n\t\t\tname : \"crmRechargeReconciliation\", path : \"/#crm/deal/recharge\",\r\n\t\t\treg : /crm\\/deal\\/recharge/, bodyClz : \"\",\r\n\t\t\tPageInitiator : \"Hualala.CRM.RechargeReconciliationInit\", parentName : \"crm\", label : \"储值对账\"\r\n\t\t},\r\n\t\t{\r\n\t\t\tname : \"crmParameter\", path : \"/#crm/settings/params\",\r\n\t\t\treg : /crm\\/settings\\/params$/, bodyClz : \"\",\r\n\t\t\tPageInitiator : \"Hualala.CRM.CRMSettingsParamsInit\", parentName : \"crm\", label : \"会员系统参数\"\r\n\t\t},\r\n        {\r\n\t\t\tname : \"crmCardLevels\", path : \"/#crm/settings/levels\",\r\n\t\t\treg : /crm\\/settings\\/levels$/, bodyClz : \"\",\r\n\t\t\tPageInitiator : \"Hualala.CRM.CRMSettingsLevelsInit\", parentName : \"crm\", label : \"会员等级\"\r\n\t\t},\r\n\t\t{\r\n\t\t\tname : \"crmRechargePackageBusiness\", path : \"/#crm/settings/recharge\",\r\n\t\t\treg : /crm\\/settings\\/recharge$/, bodyClz : \"\",\r\n\t\t\tPageInitiator : \"Hualala.CRM.RechargePackageBusinessInit\", parentName : \"crm\", label : \"充值套餐\"\r\n\t\t},\r\n\t\t{\r\n\t\t\tname : \"crmShopSpecialPrice\", path : \"/#crm/settings/ssp\",\r\n\t\t\treg : /crm\\/settings\\/ssp/, bodyClz : \"\",\r\n\t\t\tPageInitiator : \"Hualala.CRM.ShopSpecialPriceInit\", parentName : \"crm\", label : \"店铺特惠\"\r\n\t\t},\r\n        \r\n        // 微信系统管理\r\n\t\t{\r\n\t\t\tname : \"weixin\", path : \"/#weixin\",\r\n\t\t\treg : /weixin$/, bodyClz : \"\",\r\n\t\t\tPageInitiator : \"Hualala.Weixin.homeInit\", parentName : \"main\", label : \"微信管理\"\r\n\t\t},\r\n\t\t{\r\n\t\t\tname : \"wxReply\", path : \"/#weixin/admin/reply\",\r\n\t\t\treg : /weixin\\/admin\\/reply$/, bodyClz : \"wx-reply\",\r\n\t\t\tPageInitiator : \"Hualala.Weixin.replyInit\", parentName : \"weixin\", label : \"自动回复\"\r\n\t\t},\r\n\t\t{\r\n\t\t\tname : \"wxSubscribe\", path : \"/#weixin/admin/subscribe\",\r\n\t\t\treg : /weixin\\/admin\\/subscribe$/, bodyClz : \"wx-subscribe\",\r\n\t\t\tPageInitiator : \"Hualala.Weixin.subscribeInit\", parentName : \"weixin\", label : \"关注自动回复\"\r\n\t\t},\r\n\t\t{\r\n\t\t\tname : \"wxMenu\", path : \"/#weixin/admin/menu\",\r\n\t\t\treg : /weixin\\/admin\\/menu$/, bodyClz : \"wx-menu\",\r\n\t\t\tPageInitiator : \"Hualala.Weixin.menuInit\", parentName : \"weixin\", label : \"自定义菜单\"\r\n\t\t},\r\n        {\r\n\t\t\tname : \"wxQrCode\", path : \"/#weixin/admin/qrcode\",\r\n\t\t\treg : /weixin\\/admin\\/qrcode$/, bodyClz : \"wx-qrcode\",\r\n\t\t\tPageInitiator : \"Hualala.Weixin.qrCodeInit\", parentName : \"weixin\", label : \"二维码维护\"\r\n\t\t},\r\n\t\t{\r\n\t\t\tname : \"wxAdvertorial\", path : \"/#weixin/material/advertorial\",\r\n\t\t\treg : /weixin\\/material\\/advertorial$/, bodyClz : \"wx-advertorial\",\r\n\t\t\tPageInitiator : \"Hualala.Weixin.advertorialInit\", parentName : \"weixin\", label : \"软文管理\"\r\n\t\t},\r\n        {\r\n\t\t\tname : \"wxContent\", path : \"/#weixin/material/content\",\r\n\t\t\treg : /weixin\\/material\\/content$/, bodyClz : \"wx-content\",\r\n\t\t\tPageInitiator : \"Hualala.Weixin.contentInit\", parentName : \"weixin\", label : \"图文管理\"\r\n\t\t},\r\n        {\r\n\t\t\tname : \"wxText\", path : \"/#weixin/material/text\",\r\n\t\t\treg : /weixin\\/material\\/text$/, bodyClz : \"wx-text\",\r\n\t\t\tPageInitiator : \"Hualala.Weixin.textInit\", parentName : \"weixin\", label : \"文本管理\"\r\n\t\t},\r\n\r\n\t\t// PC客户端下载页面\r\n\t\t{\r\n\t\t\tname : \"pcclient\", path : \"/#download\", reg : /download$/, bodyClz : \"\",\r\n\t\t\tPageInitiator : \"Hualala.Common.PCClientDownloadInit\", parentName : \"main\", label : \"客户端下载\"\r\n\t\t},\r\n\r\n\t\t// 关于商户中心\r\n\t\t{\r\n\t\t\tname : \"about\", path : \"/#about\", reg : /about$/, bodyClz : \"\",\r\n\t\t\tPageInitiator : \"Hualala.Common.AboutInit\", parentName : \"main\", label : \"关于\"\r\n\t\t},\r\n\r\n\t\t// 联系我们\r\n\t\t{\r\n\t\t\tname : \"contact\", path : \"/#contact\", reg : /contact$/, bodyClz : \"\",\r\n\t\t\tPageInitiator : \"Hualala.Common.ContactInit\", parentName : \"main\", label : \"联系我们\"\r\n\t\t},\r\n\t\t// 上面的path都匹配不到，需要自动跳转home\r\n\t\t{\r\n\t\t\tname : \"index\", path : \"\", reg : /(.*)$/, bodyClz : \"\",\r\n\t\t\tPageInitiator : \"Hualala.Common.IndexInit\"\r\n\t\t}\r\n\t];\r\n\tIX.iterate(pageConfigs, function (cfg) {\r\n\t\tvar _cfg = IX.inherit({\r\n\t\t\tbodyClz : \"ix-minor\",\r\n\t\t\tpath : \"\"\r\n\t\t}, cfg);\r\n\t\tvar _name = $XP(cfg, 'name'), _path = $XP(cfg, 'path'), _reg = $XP(cfg, 'reg');\r\n\t\tmappingRoute(_path, _name, _reg);\r\n\t\tPageConfigurations[_name] = {\r\n\t\t\tname : _name, bodyClz : $XP(_cfg, 'bodyClz', ''), path : _path, reg : $XP(_cfg, 'reg', null),\r\n\t\t\tparentName : $XP(cfg, 'parentName', null), label : $XP(cfg, 'label', '')\r\n\t\t};\r\n\t\tvar _pageInit = \"PageInitiator\" in _cfg ? _cfg.PageInitiator : null;\r\n\t\tif (!IX.isString(_pageInit) && !IX.isFn(_pageInit))\r\n\t\t\t_pageInit = IX.emptyFn;\r\n\t\tdetectPageInitializor.detect(_name, _pageInit);\r\n\t});\r\n\tdetectPageInitializor.start();\r\n\r\n    var $body = $('body');\r\n\tHualala.PageRoute.start = function (cbFn) {\r\n\t\tisInitialized = true;\r\n\t\tRouter.flush().config({mode : 'history', root : Hualala.Global.HOME});\r\n\t\t// Router.flush().config({mode : 'history'});\r\n\t\t// IE Browser can not support this method ??\r\n\t\t_.each(PageConfigurations, function (route, name, l) {\r\n\t\t\tvar re = $XP(route, 'reg'), initFn = $XF(route, 'init'), handler = null;\r\n\t\t\t\r\n\t\t\thandler = function (params) {\r\n\t\t\t\tIX.Debug.info(\"INFO: Init Page : [\" + name + \"]\");\r\n\t\t\t\tIX.Debug.info(\"INFO: Page Arguments : [\" + params + \"]\");\r\n                $body.removeClass().addClass(route.bodyClz);\r\n\t\t\t\tIX.isFn(cbFn) && cbFn(name, params, initFn);\r\n\t\t\t\t\r\n\t\t\t\t// initFn && initFn.apply(null, [name, params]);\r\n\t\t\t};\r\n\t\t\t\r\n\t\t\tRouter.add(re, handler);\r\n\t\t});\r\n\t\tRouter.listen().check();\r\n\t};\r\n\r\n\tHualala.PageRoute.createPath = getPathByName;\r\n\r\n\tHualala.PageRoute.getCurrentPath = function () {\r\n\t\treturn location.hash;\r\n\t};\r\n\r\n\tHualala.PageRoute.getPageContextByPath = function (path) {\r\n\t\tvar fragment = path || Hualala.Router.getFragment();\r\n\t\tvar match = _.filter(PageConfigurations, function (el, k, l) {\r\n\t\t\treturn !!fragment.match(el.reg);\r\n\t\t});\r\n\t\tvar params = null;\r\n\t\tif (match.length == 0) return null;\r\n\t\tif (match.length == 1) {\r\n\t\t\tparams = fragment.match(match[0]['reg']);\r\n\t\t\tparams.shift();\r\n\t\t\treturn IX.inherit({params : params}, match[0]);\r\n\t\t}\r\n\t\tmatch = _.filter(match, function (el, k, l) {\r\n\t\t\treturn el.name != 'index';\r\n\t\t});\r\n\t\tparams = fragment.match(match[match.length - 1]['reg']);\r\n\t\tparams.shift();\r\n\t\treturn IX.inherit({params : params}, match[match.length - 1]);\r\n\t};\r\n\r\n\tHualala.PageRoute.getParentNamesByPath = function (path) {\r\n\t\tvar curContext = Hualala.PageRoute.getPageContextByPath(path);\r\n\t\tvar curName = $XP(curContext, 'name', null);\r\n\t\tvar ret = [];\r\n\t\twhile(!IX.isEmpty(curName)) {\r\n\t\t\tret.unshift({\r\n\t\t\t\tname : curName,\r\n\t\t\t\tlabel : $XP(curContext, 'label', ''),\r\n                path: Hualala.PageRoute.createPath(curName, curContext.params)\r\n\t\t\t});\r\n\t\t\tvar parentName = $XP(curContext, 'parentName', null);\r\n\t\t\tcurContext = IX.isEmpty(parentName) ? null : $XP(PageConfigurations, parentName, null);\r\n\t\t\tcurName = $XP(curContext, 'name', null);\r\n\t\t}\r\n        ret[ret.length - 1].isLastNode = true;\r\n\t\treturn ret;\r\n\t};\r\n    \r\n    Hualala.PageRoute.getPageLabelByName = function (name) {\r\n        if(!name) return null;\r\n        var cfg = PageConfigurations[name];\r\n        if(!cfg) return null;\r\n        return cfg.label;\r\n    };\r\n    \r\n    Hualala.PageRoute.jumpPage = function (path) {\r\n    \tdocument.location.href = path;\r\n    };\r\n\r\n})(jQuery, window);"]}