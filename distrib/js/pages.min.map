{"version":3,"file":"pages.min.js","sources":["pages.js"],"names":["$","IX","ns","formFields","name","type","palceholder","clz","key","field","validators","notEmpty","message","callback","val","min","max","length","valid","AuthCode","cfg","container","$XP","$img","find","$progress","callServer","Hualala","Global","genAuthCode","toggleProgress","isShow","getAuthCode","cbFn","res","code","UI","TopTip","msg","setAuthCode","attr","setTimeout","bindEvent","delegate","e","target","init","genCode","Entry","initLogin","$container","console","err","loginCallServer","fvOpts","$subBtn","parent","$authCode","initValidFieldOpts","ret","_","each","f","getFormData","params","initLoginForm","bootstrapValidator","trigger","fields","on","$form","data","preventDefault","info","resultcode","document","location","href","PageRoute","createPath","bv","validate","jQuery","window","toptip","PopoverMsgTip","QueryModel","Stapes","subclass","constructor","this","origCities","origAreas","origShops","isReady","getShopQuerySchema","proto","self","initDataModel","cityHT","IListManager","areaHT","shopHT","c","cid","shopLst","filter","s","areaLst","a","pluck","register","inherit","aid","sid","set","ds_city","ds_area","ds_shop","hasReady","getCities","ids","isEmpty","isString","ds","get","getShops","getAreas","destroy","Shop","QueryView","needShopCreate","$queryBox","$filter","$query","loadTemplates","model","renderLayout","emit","getFilterParams","queryTpl","Handlebars","compile","TplLib","filterTpl","registerPartial","mapChosenShopData","cities","city","cityName","shops","push","items","map","shop","mapRenderLayoutData","filterCities","mapFilterData","focus","queryChosenShops","shopCity","toggle","optGrp","renderData","html","prepend","count","btn_all","focusClz","o","parseInt","unshift","renderAreaFilter","remove","append","$btn","cityID","removeClass","addClass","focusedBtn","areaID","keywordLst","getQueryParams","QueryController","sessionData","getSessionData","resultController","view","reload","distory","query","pageNo","pageSize","load","CardListModel","pageCount","totalSize","ds_page","updatePagerParams","pagerParamkeys","v","k","indexOf","getPagerParams","updateDataStore","pageHT","shopIDs","shopID","mShop","BaseShopModel","resetDataStore","clear","getByKeys","getAll","getShopModelByShopID","updateShopStatus","status","failFn","updateShopBusinessStatus","id","switchShopStatusCallServer","switchShopStatus","switchShopBusinessStatusCallServer","switchShopServiceFeatureStatus","switchShopBusinessStatus","$XF","setServiceFeature","sName","serviceFeatures","split","el","join","serviceFeature","operation","switchBusinessStatus","setServiceParams","serviceID","successFn","strType","newData","CardListView","$resultBox","$list","$pager","initLayout","layoutTpl","htm","initPager","baseCfg","total","page","maxVisible","leaps","IXPager","tooltip","selector","path","listTpl","itemTpl","tagTpl","mapRenderData","getTags","tags","t","tag","address","byteLen","Common","strByteLength","slugAddr","substrByte","img","getSourceImage","width","height","quality","tel","infoHref","menuHref","checked","shopCard","list","initSwitcher","bootstrapSwitch","size","onColor","offColor","onText","offText","state","$chkbox","_shopID","render","pagerParams","empty","ShopListView","businessName","businessID","initBusinessModal","getShopBusiness","business","TypeDef","ShopBusiness","businessHT","businessCfg","item","switcherStatus","mapBusinessRenderData","icon","switcherName","open","label","desc","chkHasAccountRole","loginUsr","getSessionUser","usrRoles","roles","getSessionRoles","role","roleType","matchedID","shopName","hideAccount","settleName","shopOpen","shopItem","Setting","editServiceView","triggerEl","serviceName","ShopListController","ShopListModel","reloadPager","initCuisines","$cuisine1","$cuisine2","G","getCuisines","rsp","resultmsg","topTip","fillSelectBox","records","initAreas","$selectBox","initCities","isActive","value","initialValue","optionsHtml","i","getSelectText","$select","text","replace","U","initCreate","$wizard","bootstrapWizard","bsWizard","$step1","$step2","$step3","$city","$area","timepicker","minuteStep","showMeridian","disableFocus","showInputs","stringLength","telOrMobile","PCCL","numeric","operationMode","openingHoursStart","time","openingHoursEnd","startTimeField","cuisineID1","$uploadImg","imagePath","uploadImg","onSuccess","imgPath","$dlg","src","IMAGE_RESOURCE_DOMAIN","modal","dataStep1","$searchBox","$shopSettingLink","$curStep","activePane","is","isValid","parseForm","areaName","cuisineName1","cuisineName2","cuisineID2","openingHours","keywords","updateShopBaseInfo","createShop","next","isSearchMap","searchBox","lng","mapPoint","lat","mapInfo","mapLongitudeValue","mapLatitudeValue","mapLongitudeValueBaiDu","mapLatitudeValueBaiDu","setShopMap","updateReadMode","not","$this","$p","siblings","shopInfo","S","initMap","initInfo","pageType","$shopFuncNav","createShopFuncNav","imgHost","getShopInfo","createShopInfoHead","$shopInfoHead","before","openTime","operationModeName","tpl","appendTo","$target","isValidField","coords","formData","shopData","initShopMenu","ShopMap","options","extend","defaults","sContent","$mapResult","mapResult","searchArea","keyword","area","mapCanvasId","serach","prototype","mapParams","BMap","Map","addControl","NavigationControl","enableScrollWheelZoom","$keyword","$searchBtn","searchParams","searchMap","loadMap","centerAndZoom","Point","marker","Marker","enableMassClear","raiseOnDrag","enableDragging","addOverlay","openInfoWindow","InfoWindow","addEventListener","setResult","point","local","LocalSearch","renderOptions","pageCapacity","onInfoHtmlSet","poi","onMarkersSet","search","setSearchCompleteCallback","getStatus","BMAP_STATUS_SUCCESS","setMarkersSetCallback","pois","pos","getPosition","fn","tplData","shopUrl","getShopUrl","shopListLink","resetPwdTpl","$resetPwdForm","ModalDialog","title","sizeCls","hideCloseBtn","show","$feedback","$feedbackIcon","$errMsg","$pwd","l","trim","toggleClass","change","footer","setShopClientPwd","hLLAgentLoginPWD","hide","isPlainObject","currentPageName","shopFuncs","R","$ul","shopFunc","getPageLabelByName","initShopList","$body","queryShop","HomePageInit","initShopBaseInfoMgr","BreadCrumb","hideRoot","nodes","getParentNamesByPath","BaseInfoMgrInit","initFoodMenuMgr","FoodMenuMgrInit","initCreateShop","$shopCreateWizard","pcClientPath","CreateShopInit","ServiceFormElsCfg","advanceTime","defaultVal","prefix","surfix","MinuteIntervalOptions","validCfg","noticeTime","minAmount","greaterThan","inclusive","serviceAmount","freeServiceAmount","holidayFlag","HolidayFlagOptions","openDays","digits","servicePeriods","group","reserveTableTime","reserveTableDesc","takeawayDeliveryAgent","takeawayDeliveryTime","takeawayScope","takeawayScopeDesc","submitSMSTemplateID","checkSMSTemplateID","payMethod","PayMethodOptions","needInputTableName","onLabel","offLabel","supportInvoice","supportCommitToSoftware","payMethodAtShop","PayMethodAtShopOptions","payBeforeCommit","fetchFoodMode","FetchFoodModeOptions","ServiceFormElsHT","labelClz","minID","maxID","minName","maxName","$trigger","serviceList","serviceInfo","getServiceInfo","isFn","nsExisted","getNS","formParams","initModal","renderForm","btnTpl","registerHelper","conditional","hash","inverse","getModalTitle","afterRemove","body","$el","initTimePicker","showSeconds","servData","formKeys","dialog","act","button","serializeForm","decodeTimeStr","substr","encodeTimeStr","mapServiceFormElsData","formEls","elCfg","op","selected","formClz","btns","initShopMgr","ShopMgrInit","AccountListModel","transCreateBeginTime","transCreateEndTime","settleUnitID","transStatus","transType","groupID","minTransAmount","maxTransAmount","ds_account","accountHT","accountIDs","account","mAccount","BaseAccountModel","getAccounts","getAccountModelByID","accountID","Account","queryAccount","getSessionSite","withdrawCash","transAmount","settleBalance","newSettleBalance","Math","sub","delete","deleteAccount","edit","editAccount","add","addAccount","AccountTransListModel","queryAccountTransDetail","ds_trans","transHT","transIDs","trans","transID","mTrans","BaseTransactionModel","getDataByPageNo","getModelByID","AccountQueryShopModel","getAccountQueryShop","AccountQueryShopResultModel","origData","dataStore","initDataStore","start","end","_shop","ceil","idx","AccountListView","bindCardEvent","settleAccountID","parents","WithdrawCashView","parentView","AccountEditView","mode","updateSettleBalance","hasDefault","bankInfo","mapBankInfo","bankAccountStr","codeMask","settleUnitName","parseFloat","bankIcon","bankComName","shopCount","accountCard","accounts","refresh","mapFormElsData","accountInfoKeys","accountInfo","lessThan","accuracy","QueryTransFormElsCfg","transCreateTime","FSMTransStatus","FSMTransType","QueryTransFormElsHT","TransResultCols","AccountTransListView","$queryForm","tableTpl","result","tblClz","tblHeaders","cols","colClz","thead","rows","initQueryEls","bindQueryEvent","datetimepicker","format","startDate","autoclose","minView","todayBtn","todayHighlight","language","$picker","prev","orderKey","orderID","AccountTransDetailModal","getQueryFormParams","serializeArray","Date","getDateByFormat","mapTimeData","r","s1","mapTransStatus","m","mapTransType","types","mapCashData","prettyNumeric","mapTransChanged","transSalesCommission","transPoundage","transChanged","mapColsRenderData","row","colKeys","col","hideBtnTransType","btnClz","SUATransItemID","results","AccountQueryShopView","AccountQueryShopResultView","shopTable","AccountListController","AccountQueryShopController","resultContainer","AccountQueryShopResultController","AccountMgrController","transaDetailCtrl","TransactionDetailController","AccountActs","AccountMgrView","$nav","breadCrumbs","$schema","$detail","initBreadCrumbs","parentNames","clickFn","isLastNode","shift","schemaTpl","withDrawTpl","withdraw","queryShops","AccountQueryShopModal","Confirm","okLabel","okFn","acts","acts1","clone","isDetail","isFirst","AccountEditFormElsCfg","receiverType","AccountReceiverTypes","receiverName","bankAccount","bankCode","BankOptions","bankName","remark","defaultAccount","receiverLinkman","receiverMobile","receiverEmail","AccountEditFormElsHT","ops","queryCtrl","initQueryBox","PersonUnit","Constants","CashUnit","getOrderSubTypeLabel","orderSubType","getGenderLabel","GENDER","mapUserFields","fieldType","userSex","_fields","fieldLabelCfg","OrderPayFieldLabelLib","unit","mapOrderFields","orderSubTypeLabel","formatDateTimeValue","isAlreadyPaid","orderStatus","mapPayFields","mapFoodsFields","dishes","categories","groupBy","dish","cate","foodCategoryName","foodCategorySum","_dishes","_dish","foodCategoryID","userName","userLoginMobile","orderCheckPWD","person","timeName","tableName","shopOrderKey","orderTime","orderCreateTime","statusName","takeoutAddress","consumptionTypeName","promotionDesc","orderRemark","foodAmount","paidAmount","promotionTotalAmount","discountAmount","freeAmount","giftAmount","presentInfo","cardDiscountAmount","pointBalance","moneyBalance","takeoutPackagingAmount","orderTotal","orderRefundAmount","shopTel","foodPrice","OrderPayDetailElsCfg","userFields","mapFn","orderFields","payFields","foodsFields","transTypes","transTypeHT","initTransTypeLib","tplName","callServerName","queryKeys","mapQueryParams","toString","mapOrderPayDetail","fieldsets","fieldCfg","pick","printDetail","content","mapFsmCustomerDetail","settleUnitDetail","customerCard","transTypeLabel","acc","cashKeys","prettyPrice","last","_k","initAccountListPage","accountListPanel","initAccountMgrPage","ctx","getPageContextByPath","accountModel","mgrView","AccountMgrInit","AccountListInit","isSupportedBrowser","bd","Browser","isIE","version","allowOldVersion","Cookie","browserLib","$jumbotron","click","Router","check","initPageLayout","session","isLogin","loginName","groupName","mapRanderData","header","hualalaUrl","HualalaWebSite","merchantRoot","logoutPath","getLogoutJumpToUrl","logo","getDefaultImage","aboutPath","contactPath","gozapLogo","$wrapper","DEFAULT_OPTIONS","feedbackIcons","invalid","validating","validator","$field","isNaN","regxStr","regX","RegExp","test","initSiteNavBar","navTpl","navToggleTpl","navs","SiteNavType","active","isCurrentPage","disabled","$navbar","$navToggle","$header","initHomePage","rights","getSessionPCClient","getSessionUserRight","ht","iterate","pageBrickConfigs","hasRight","itemClz","$bricks","bricks","pageName","eType","hasClass","initLoginPage","$loginBox","bannerImg","brickClz","LoginInit","IndexInit","loadSession","appData","initMainPage","tick","getTimeInMS","log","loadAppData","initRouteEngine","ajaxSetup","beforeSend","xhr","setRequestHeader","ajaxEngine","ajaxFn","ajax","baseUrl","HOME","commonUrl","CommonSite","imgUrl","IMAGE_ROOT","isSessionUser","groupLoginName","_name","APPInitialized","pageParams","pageInitFn","hasNoNavPages","commonPages","apply","mappingRoute","_path","_reg","match","arr","bingo","_pattern","Path2NameMapping","getPathByName","PageConfigurations","reg","genPath","p","isArray","isInitialized","Route","detectPageInitializor","_checkItem","fname","_list","_fn","j","_checking","fnames","loop","_check","Array","toSet","checkReady","emptyFn","maxAge","expire","alert","_detect","put","I1ToNManager","detect","pageConfigs","bodyClz","PageInitiator","parentName","_cfg","_pageInit","flush","config","root","route","re","initFn","handler","listen","getCurrentPath","fragment","getFragment","curContext","curName"],"mappings":"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","sourcesContent":["/** \r\n * -------------------------------------------------\r\n * Copyright (c) 2014, All rights reserved. \r\n * Hualala-Merchant-Management\r\n * \r\n * @version : 0.1.0\r\n * @author : HuHao\r\n * @description : Hualala Merchant Management System.  \r\n * -------------------------------------------------\r\n */ \r\n\r\n(function ($, window) {\r\n\tIX.ns('Hualala.Entry');\r\n\tvar formFields = [\r\n\t\t{\r\n\t\t\tname : 'group_name', type : 'text', palceholder : '请输入集团主账号', clz : 'form-control input-md',\r\n\t\t\tkey : 'groupName',\r\n\t\t\tfield : {\r\n\t\t\t\tvalidators : {\r\n\t\t\t\t\tnotEmpty : {\r\n\t\t\t\t\t\tmessage : \"集团主账号不能为空\"\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\t{\r\n\t\t\tname : 'group_subname', type : 'text', palceholder : '请输入集团子账号', clz : 'form-control input-md',\r\n\t\t\tkey : 'childName',\r\n\t\t\tfield : {\r\n\t\t\t\tvalidators : {\r\n\t\t\t\t\t// notEmpty : {\r\n\t\t\t\t\t// \tmessage : \"集团子账号不能为空\"\r\n\t\t\t\t\t// }\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\t{\r\n\t\t\tname : 'login_pwd', type : 'passowrd', palceholder : '请输入登陆密码', clz : 'form-control input-md',\r\n\t\t\tkey : 'password',\r\n\t\t\tfield : {\r\n\t\t\t\tvalidators : {\r\n\t\t\t\t\tnotEmpty : {\r\n\t\t\t\t\t\tmessage : \"密码不能为空\"\r\n\t\t\t\t\t},\r\n\t\t\t\t\tcallback : {\r\n\t\t\t\t\t\tcallback : function (val, validator, $field) {\r\n\t\t\t\t\t\t\tvar min = 6, max = 32;\r\n\t\t\t\t\t\t\tif (val.length < 6 || val.length > 32) {\r\n\t\t\t\t\t\t\t\treturn {\r\n\t\t\t\t\t\t\t\t\tvalid : false,\r\n\t\t\t\t\t\t\t\t\tmessage : '密码长度必须在' + min + '位到' + max + '位之间'\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\treturn {\r\n\t\t\t\t\t\t\t\tvalid : true\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\t{\r\n\t\t\tname : 'login_auth', type : 'text', palceholder : '请输入验证码', clz : 'form-control input-md',\r\n\t\t\tkey : 'authCode',\r\n\t\t\tfield : {\r\n\t\t\t\tvalidators : {\r\n\t\t\t\t\tnotEmpty : {\r\n\t\t\t\t\t\tmessage : \"验证码不能为空\"\r\n\t\t\t\t\t}/*,\r\n\t\t\t\t\tcallback : function (val, validator, $field) {\r\n\t\t\t\t\t\tif (val != $('[name=auth_code]').val()) {\r\n\t\t\t\t\t\t\treturn {\r\n\t\t\t\t\t\t\t\tvalid : false,\r\n\t\t\t\t\t\t\t\tmessage : '验证码错误'\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\treturn {valid : true};\r\n\t\t\t\t\t}*/\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t];\r\n\r\n\t/**\r\n\t * 生成AuthCode实例\r\n\t * @param {Object} cfg {container}\r\n\t */\r\n\tvar AuthCode = function (cfg) {\r\n\t\tvar container = $($XP(cfg, 'container')),\r\n\t\t\t$img = container.find('.auth-img'),\r\n\t\t\t$progress = container.find('.progress');\r\n\t\tvar callServer = Hualala.Global.genAuthCode;\r\n\t\tvar toggleProgress = function (isShow) {\r\n\t\t\t$progress[isShow ? 'removeClass' : 'addClass']('hidden');\r\n\t\t\t$img[isShow ? 'addClass' : 'removeClass']('hidden');\r\n\t\t};\r\n\t\tvar getAuthCode = function (cbFn) {\r\n\t\t\ttoggleProgress(true);\r\n\t\t\tcallServer({}, function (res) {\r\n\t\t\t\tvar code = null;\r\n\t\t\t\tif ($XP(res, 'resultcode') == \"000\") {\r\n\t\t\t\t\tcode = $XP(res, 'data.code', null);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tHualala.UI.TopTip({\r\n\t\t\t\t\t\ttype : 'warning',\r\n\t\t\t\t\t\tmsg : \"获取验证码失败\"\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t\ttoggleProgress();\r\n\t\t\t\t}\r\n\t\t\t\tcbFn(code);\r\n\t\t\t});\r\n\t\t};\r\n\t\tvar setAuthCode = function (code) {\r\n\t\t\tif (!code) {\r\n\t\t\t\tsetTimeout(function () {\r\n\t\t\t\t\tgetAuthCode(setAuthCode);\r\n\t\t\t\t}, 1000);\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\t$img.attr('src', code);\r\n\t\t\t// FOR TEST\r\n\t\t\tsetTimeout(function () {\r\n\t\t\t\ttoggleProgress();\r\n\t\t\t}, 500);\r\n\t\t};\r\n\t\tvar bindEvent = function () {\r\n\t\t\tcontainer.delegate('.auth-img', 'click', function (e) {\r\n\t\t\t\t$img = $(e.target);\r\n\t\t\t\tgetAuthCode(setAuthCode);\r\n\t\t\t});\r\n\t\t};\r\n\t\tvar init = function () {\r\n\t\t\tgetAuthCode(setAuthCode);\r\n\t\t\tbindEvent();\r\n\t\t};\r\n\t\tinit();\r\n\t\treturn {\r\n\t\t\tgenCode : function () {\r\n\t\t\t\tgetAuthCode(setAuthCode);\r\n\t\t\t}\r\n\t\t};\r\n\t};\r\n\r\n\tHualala.Entry.initLogin = function ($container) {\r\n\t\tif (!$container || $container.length == 0) {\r\n\t\t\tconsole.err(\"Login Form init failed!\");\r\n\t\t\treturn ;\r\n\t\t}\r\n\t\tvar callServer = Hualala.Global.loginCallServer;\r\n\t\tvar fvOpts = {},\r\n\t\t\t$subBtn = $container.find('#login_sub'),\r\n\t\t\t$progress = $subBtn.parent().find('.progress'),\r\n\t\t\t$authCode = $container.find('.ix-authcode'),\r\n\t\t\tauthCode = new AuthCode({\r\n\t\t\t\tcontainer : $authCode\r\n\t\t\t});\r\n\t\tvar toggleProgress = function (isShow) {\r\n\t\t\t$progress[isShow ? 'removeClass' : 'addClass']('hidden');\r\n\t\t\t$subBtn[isShow ? 'addClass' : 'removeClass']('hidden');\r\n\t\t};\r\n\t\tvar initValidFieldOpts = function () {\r\n\t\t\tvar ret = {};\r\n\t\t\t_.each(formFields, function (f, i, l) {\r\n\t\t\t\tvar key = $XP(f, 'name'), field = $XP(f, 'field');\r\n\t\t\t\tret[key] = field;\r\n\t\t\t});\r\n\t\t\treturn ret;\r\n\t\t};\r\n\t\tvar getFormData = function () {\r\n\t\t\tvar params = {};\r\n\t\t\t_.each(formFields, function (f, i, l) {\r\n\t\t\t\tvar name = $XP(f, 'name'), key = $XP(f, 'key'), \r\n\t\t\t\t\tval = $('[name=' + name + ']', $container).val();\r\n\t\t\t\tparams[key] = val;\r\n\t\t\t});\r\n\t\t\treturn params;\r\n\t\t};\r\n\t\tvar initLoginForm = function () {\r\n\t\t\tfvOpts = initValidFieldOpts();\r\n\t\t\t$container.bootstrapValidator({\r\n\t\t\t\ttrigger : 'blur',\r\n\t\t\t\tfields : fvOpts\r\n\t\t\t}).on('error.field.bv', function (e, data) {\r\n\t\t\t\tvar $form = $(e.target),\r\n\t\t\t\t\tbv = $form.data('bootstrapValidator');\r\n\t\t\t\ttoggleProgress();\r\n\t\t\t}).on('success.form.bv', function (e, data) {\r\n\t\t\t\te.preventDefault();\r\n\t\t\t\tvar $form = $(e.target),\r\n\t\t\t\t\tbv = $form.data('bootstrapValidator'),\r\n\t\t\t\t\tparams = getFormData();\r\n\t\t\t\t// TODO AJAX Submit Login Form\r\n\t\t\t\tconsole.info('login params : ');\r\n\t\t\t\tconsole.info(params);\r\n\t\t\t\t\r\n\t\t\t\tcallServer(params, function (res) {\r\n\t\t\t\t\tif (res.resultcode == 000) {\r\n\t\t\t\t\t\tdocument.location.href = Hualala.PageRoute.createPath('main'); \r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tHualala.UI.TopTip({\r\n\t\t\t\t\t\t\ttype : 'danger',\r\n\t\t\t\t\t\t\tmsg : $XP(res, 'resultmsg')\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\t\t\t\t\ttoggleProgress();\r\n\t\t\t\t});\r\n\t\t\t});\r\n\t\t\t$container.delegate('#login_sub', 'click', function (e) {\r\n\t\t\t\ttoggleProgress(true);\r\n\t\t\t\tvar bv = $container.data('bootstrapValidator');\r\n\t\t\t\tbv.validate();\r\n\t\t\t});\r\n\t\t};\r\n\r\n\t\tinitLoginForm();\r\n\t};\r\n})(jQuery, window);;(function ($, window) {\r\n\tIX.ns(\"Hualala.Shop\");\r\n\tvar popoverMsg = Hualala.UI.PopoverMsgTip;\r\n\tvar toptip = Hualala.UI.TopTip;\r\n\tvar QueryModel = Stapes.subclass({\r\n\t\tconstructor : function () {\r\n\t\t\t// 原始数据\r\n\t\t\tthis.origCities = [];\r\n\t\t\tthis.origAreas = [];\r\n\t\t\tthis.origShops = [];\r\n\t\t\t// 数据是否已经加载完毕\r\n\t\t\tthis.isReady = false;\r\n\t\t\tthis.callServer = Hualala.Global.getShopQuerySchema;\r\n\t\t}\r\n\t});\r\n\tQueryModel.proto({\r\n\t\t// 数据模型初始化，获取查询条件的数据\r\n\t\tinit : function (params, cbFn) {\r\n\t\t\tvar self = this;\r\n\t\t\tself.isReady = false;\r\n\t\t\tself.callServer(params, function (res) {\r\n\t\t\t\tif (res.resultcode == '000') {\r\n\t\t\t\t\t// 装填原始数据\r\n\t\t\t\t\tself.origCities = $XP(res, 'data.cities', []);\r\n\t\t\t\t\tself.origAreas = $XP(res, 'data.areas', []);\r\n\t\t\t\t\tself.origShops = $XP(res, 'data.shops', []);\r\n\t\t\t\t\tself.initDataModel();\r\n\t\t\t\t\tself.isReady = true;\r\n\t\t\t\t} else {\r\n\t\t\t\t\ttoptip({\r\n\t\t\t\t\t\tmsg : $XP(res, 'resultmsg', ''),\r\n\t\t\t\t\t\ttype : 'danger'\r\n\t\t\t\t\t});\r\n\t\t\t\t\tself.isReady = false;\r\n\t\t\t\t}\r\n\t\t\t\tcbFn(self);\r\n\t\t\t});\r\n\t\t},\r\n\t\t// 初始化整体数据模型\r\n\t\t// ds_city, ds_area, ds_shop\r\n\t\tinitDataModel : function () {\r\n\t\t\tvar self = this;\r\n\t\t\tvar cityHT = new IX.IListManager(),\r\n\t\t\t\tareaHT = new IX.IListManager(),\r\n\t\t\t\tshopHT = new IX.IListManager();\r\n\t\t\t_.each(this.origCities, function (c, i, l) {\r\n\t\t\t\tvar cid = $XP(c, 'cityID'), \r\n\t\t\t\t\tshopLst = _.filter(self.origShops, function (s) {\r\n\t\t\t\t\t\treturn $XP(s, 'cityID') == cid;\r\n\t\t\t\t\t}),\r\n\t\t\t\t\tareaLst = _.filter(self.origAreas, function (a) {\r\n\t\t\t\t\t\treturn $XP(a, 'cityID') == cid;\r\n\t\t\t\t\t});\r\n\t\t\t\tshopLst = _.pluck(shopLst, 'shopID');\r\n\t\t\t\tareaLst = _.pluck(areaLst, 'areaID');\r\n\t\t\t\tcityHT.register(cid, IX.inherit(c, {\r\n\t\t\t\t\tshopLst : shopLst,\r\n\t\t\t\t\tareaLst : areaLst\r\n\t\t\t\t}));\r\n\t\t\t});\r\n\t\t\t_.each(this.origAreas, function (a, i, l) {\r\n\t\t\t\tvar aid = $XP(a, 'areaID'),\r\n\t\t\t\t\tshopLst = _.filter(self.origShops, function (s) {\r\n\t\t\t\t\t\treturn $XP(s, 'areaID') == aid;\r\n\t\t\t\t\t});\r\n\t\t\t\tshopLst = _.pluck(shopLst, 'areaID');\r\n\t\t\t\tareaHT.register(aid, IX.inherit(a, {\r\n\t\t\t\t\tshopLst : shopLst\r\n\t\t\t\t}));\r\n\t\t\t});\r\n\t\t\t_.each(this.origShops, function (s, i, l) {\r\n\t\t\t\tvar sid = $XP(s, 'shopID');\r\n\t\t\t\tshopHT.register(sid, s);\r\n\t\t\t});\r\n\t\t\tself.set({\r\n\t\t\t\tds_city : cityHT,\r\n\t\t\t\tds_area : areaHT,\r\n\t\t\t\tds_shop : shopHT\r\n\t\t\t});\r\n\t\t},\r\n\t\t// 数据是否准备完成\r\n\t\thasReady : function () {return this.isReady;},\r\n\t\t/**\r\n\t\t * 通过cityIDs获取城市数据\r\n\t\t * @param  {String|Array|NULL} ids cityID，如果参数是一个城市的cityID，获取一个城市的数据；如果参数是cityID的数组，获取多个城市数据；如果不传参数，获取全部城市数据\r\n\t\t * @return {Array|NULL}\t如果没有找到匹配的城市数据返回null，否则返回城市数据的数组数据     \r\n\t\t */\r\n\t\tgetCities : function (ids) {\r\n\t\t\tids = IX.isEmpty(ids) ? null : (IX.isString(ids) ? [ids] : ids);\r\n\t\t\tvar ds = this.get('ds_city');\r\n\t\t\tvar ret = null;\r\n\t\t\tret = ds[!ids ? 'getAll' : 'getByKeys'](ids);\r\n\t\t\treturn ret;\r\n\t\t},\r\n\t\t/**\r\n\t\t * 通过shopIDs获取店铺数据\r\n\t\t * @param  {String|Array|NULL} ids shopID，如果参数是一个店铺的shopID，获取一个店铺的数据；如果参数是shopID的数组，获取多个店铺数据；如果不传参数，获取全部店铺数据\r\n\t\t * @return {Array|NULL}\t如果没有找到匹配的店铺数据返回null，否则返回店铺数据的数组数据     \r\n\t\t */\r\n\t\tgetShops : function (ids) {\r\n\t\t\tids = IX.isEmpty(ids) ? null : (IX.isString(ids) ? [ids] : ids);\r\n\t\t\tvar ds = this.get('ds_shop');\r\n\t\t\tvar ret = null;\r\n\t\t\tret = ds[!ids ? 'getAll' : 'getByKeys'](ids);\r\n\t\t\treturn ret;\r\n\t\t},\r\n\t\t/**\r\n\t\t * 通过areaIDs获取区域数据\r\n\t\t * @param  {String|Array|NULL} ids areaID，如果参数是一个区域的areaID，获取一个区域的数据；如果参数是areaID的数组，获取多个区域数据；如果不传参数，获取全部区域数据\r\n\t\t * @return {Array|NULL}\t如果没有找到匹配的区域数据返回null，否则返回区域数据的数组数据     \r\n\t\t */\r\n\t\tgetAreas : function (ids) {\r\n\t\t\tids = IX.isEmpty(ids) ? null : (IX.isString(ids) ? [ids] : ids);\r\n\t\t\tvar ds = this.get('ds_area');\r\n\t\t\tvar ret = null;\r\n\t\t\tret = ds[!ids ? 'getAll' : 'getByKeys'](ids);\r\n\t\t\treturn ret;\r\n\t\t},\r\n\t\tdestroy : function () {\r\n\t\t\tthis.origCities = [];\r\n\t\t\tthis.origAreas = [];\r\n\t\t\tthis.origShops = [];\r\n\t\t\tthis.isReady = false;\r\n\t\t}\r\n\t});\r\n\tHualala.Shop.QueryModel = QueryModel;\r\n})(jQuery, window);;(function ($, window) {\r\n\tIX.ns(\"Hualala.Shop\");\r\n\tvar popoverMsg = Hualala.UI.PopoverMsgTip;\r\n\tvar toptip = Hualala.UI.TopTip;\r\n\tvar QueryView = Stapes.subclass({\r\n\t\tconstructor : function () {\r\n\t\t\t// View层是否初始化完毕\r\n\t\t\tthis.isReady = false;\r\n\t\t\t// 是否开放创建店铺功能\r\n\t\t\tthis.needShopCreate = false;\r\n\t\t\t// View层容器\r\n\t\t\tthis.$container = null;\r\n\t\t\tthis.$queryBox = null;\r\n\t\t\t// 过滤部分容器\r\n\t\t\tthis.$filter = null;\r\n\t\t\t// 搜索部分容器\r\n\t\t\tthis.$query = null;\r\n\t\t\tthis.loadTemplates();\r\n\t\t}\r\n\t});\r\n\tQueryView.proto({\r\n\t\t// 初始化View层\r\n\t\tinit : function (cfg) {\r\n\t\t\tthis.model = $XP(cfg, 'model', null);\r\n\t\t\tthis.needShopCreate = $XP(cfg, 'needShopCreate', false);\r\n\t\t\tthis.$container = $XP(cfg, 'container', null);\r\n\t\t\tif (!this.model || !this.$container || this.$container.length == 0) {\r\n\t\t\t\tthrow(\"Init Query View Failed!!\");\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tthis.renderLayout();\r\n\t\t\tthis.bindEvent();\r\n\t\t\tthis.isReady = true;\r\n\t\t\tthis.emit('filter', this.getFilterParams());\r\n\r\n\t\t},\r\n\t\t// 判断是否View初始化完毕\r\n\t\thasReady : function () {return this.isReady;},\r\n\t\t// 加载View层需要的模板\r\n\t\tloadTemplates : function () {\r\n\t\t\tvar queryTpl = Handlebars.compile(Hualala.TplLib.get('tpl_shop_query')),\r\n\t\t\t\tfilterTpl = Handlebars.compile(Hualala.TplLib.get('tpl_shop_filter'));\r\n\t\t\t// 注册子模板\r\n\t\t\tHandlebars.registerPartial(\"shopCity\", Hualala.TplLib.get('tpl_shop_filter'));\r\n\t\t\tHandlebars.registerPartial(\"toggle\", Hualala.TplLib.get('tpl_site_navbarToggle'));\r\n\t\t\t// Handlebars.registerPartial(\"shopArea\", Hualala.TplLib.get('tpl_shop_filter'));\r\n\t\t\tthis.set({\r\n\t\t\t\tqueryTpl : queryTpl,\r\n\t\t\t\tfilterTpl : filterTpl\r\n\t\t\t});\r\n\t\t},\r\n\t\t// 生成搜索栏店铺选择框组件的渲染数据\r\n\t\tmapChosenShopData : function () {\r\n\t\t\tvar self = this;\r\n\t\t\tvar cities = this.model.getCities();\r\n\t\t\tvar ret = [];\r\n\t\t\t_.each(cities, function (city, i, l) {\r\n\t\t\t\tvar cityName = $XP(city, 'cityName', ''),\r\n\t\t\t\t\tcityID = $XP(city, 'cityID', ''),\r\n\t\t\t\t\tshopLst = $XP(city, 'shopLst');\r\n\t\t\t\tvar shops = self.model.getShops(shopLst);\r\n\t\t\t\tret.push({\r\n\t\t\t\t\tname : cityName,\r\n\t\t\t\t\titems : _.map(shops, function (shop, j, l) {\r\n\t\t\t\t\t\treturn {\r\n\t\t\t\t\t\t\tcode : $XP(shop, 'shopID'),\r\n\t\t\t\t\t\t\tname : $XP(shop, 'shopName')\r\n\t\t\t\t\t\t};\r\n\t\t\t\t\t})\r\n\t\t\t\t});\r\n\t\t\t});\r\n\t\t\treturn ret;\r\n\t\t},\r\n\t\t// 生成渲染数据\r\n\t\tmapRenderLayoutData : function () {\r\n\t\t\tvar cities = this.model.getCities(),\r\n\t\t\t\tshops = this.model.getShops();\r\n\t\t\tvar filterCities = this.mapFilterData({\r\n\t\t\t\t\ttype : 'city',\r\n\t\t\t\t\tname : '城市：',\r\n\t\t\t\t\tfocus : 0,\r\n\t\t\t\t\tdata : cities\r\n\t\t\t\t}),\r\n\t\t\t\tqueryChosenShops = this.mapChosenShopData();\r\n\t\t\treturn {\r\n\t\t\t\tclz : '',\r\n\t\t\t\tshopCity : filterCities,\r\n\t\t\t\ttoggle : {target : '#shop_query'},\r\n\t\t\t\tneedShopCreate : this.needShopCreate,\r\n\t\t\t\toptGrp : queryChosenShops\r\n\t\t\t};\r\n\t\t},\r\n\t\t// 渲染整体query 框架\r\n\t\trenderLayout : function () {\r\n\t\t\tvar self = this,\r\n\t\t\t\tqueryTpl = self.get('queryTpl'),\r\n\t\t\t\tmodel = self.model;\r\n\t\t\tvar renderData = self.mapRenderLayoutData();\r\n\t\t\tvar html = queryTpl(renderData);\r\n\t\t\tthis.$queryBox = $(html);\r\n\t\t\tthis.$container.prepend(this.$queryBox);\r\n\t\t\tthis.$filter = this.$queryBox.find('.filter');\r\n\t\t\tthis.$query = this.$queryBox.find('.query');\r\n\r\n\t\t},\r\n\t\t// 生成渲染地区的渲染数据\r\n\t\tmapFilterData : function (cfg) {\r\n\t\t\tvar data = $XP(cfg, 'data', []),\r\n\t\t\t\ttype = $XP(cfg, 'type'),\r\n\t\t\t\tname = $XP(cfg, 'name'),\r\n\t\t\t\tfocus = $XP(cfg, 'focus', 0),\r\n\t\t\t\tret = {\r\n\t\t\t\t\ttype : type,\r\n\t\t\t\t\tname : name,\r\n\t\t\t\t\titems : []\r\n\t\t\t\t},\r\n\t\t\t\tcount = 0;\r\n\t\t\tvar btn_all = {\r\n\t\t\t\tfocusClz : '',\r\n\t\t\t\ttype : type,\r\n\t\t\t\tcode : -1,\r\n\t\t\t\tname : '全部',\r\n\t\t\t\tcount : 0\r\n\t\t\t};\r\n\t\t\tret.items = _.map(data, function (o, i, l) {\r\n\t\t\t\tvar key = type + 'Count';\r\n\t\t\t\tvar c = parseInt($XP(o, key, 0));\r\n\t\t\t\tcount += c;\r\n\t\t\t\treturn {\r\n\t\t\t\t\tfocusClz : '',\r\n\t\t\t\t\ttype : type,\r\n\t\t\t\t\tcode : $XP(o, (type + 'ID'), ''),\r\n\t\t\t\t\tname : $XP(o, (type + 'Name'), ''),\r\n\t\t\t\t\tcount : c\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\tbtn_all = IX.inherit(btn_all, {\r\n\t\t\t\tcount : count,\r\n\t\t\t\tfocusClz : ''\r\n\t\t\t});\r\n\t\t\tret.items.unshift(btn_all);\r\n\t\t\tret.items[focus]['focusClz'] = 'disabled';\r\n\t\t\treturn ret;\r\n\t\t},\r\n\t\t// 渲染filter\r\n\t\trenderAreaFilter : function (data) {\r\n\t\t\tvar self = this,\r\n\t\t\t\tfilterTpl = self.get('filterTpl'),\r\n\t\t\t\tmodel = self.model;\r\n\t\t\tvar renderData = self.mapFilterData({\r\n\t\t\t\ttype : 'area',\r\n\t\t\t\tname : '区域：',\r\n\t\t\t\tfocus : 0,\r\n\t\t\t\tdata : data\r\n\t\t\t});\r\n\t\t\tvar html = filterTpl(renderData);\r\n\t\t\tthis.$filter.find('.area').remove();\r\n\t\t\tthis.$filter.append(html);\r\n\t\t},\r\n\t\t// 绑定View层操作\r\n\t\tbindEvent : function () {\r\n\t\t\tvar self = this;\r\n\t\t\tthis.$filter.on('click', '.btn-link[data-city]', function (e) {\r\n\t\t\t\tvar $btn = $(this);\r\n\t\t\t\tvar cityID = $btn.attr('data-city');\r\n\t\t\t\tvar data = null;\r\n\t\t\t\tif (cityID != -1) {\r\n\t\t\t\t\tdata = self.model.getCities(cityID);\r\n\t\t\t\t\tdata = $XP(data[0], 'areaLst', null);\r\n\t\t\t\t\tdata = self.model.getAreas(data);\r\n\t\t\t\t\tself.renderAreaFilter(data);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tself.$filter.find('.area').remove();\r\n\t\t\t\t}\r\n\t\t\t\tself.$filter.find('.btn-link[data-city]').removeClass('disabled');\r\n\t\t\t\t$btn.addClass('disabled');\r\n\t\t\t\tself.emit('filter', self.getFilterParams());\r\n\t\t\t});\r\n\t\t\tthis.$filter.on('click', '.btn-link[data-area]', function (e) {\r\n\t\t\t\tvar $btn = $(this);\r\n\t\t\t\tvar areaID = $btn.attr('data-area');\r\n\t\t\t\tself.$filter.find('.btn-link[data-area]').removeClass('disabled');\r\n\t\t\t\t$btn.addClass('disabled');\r\n\t\t\t\tself.emit('filter', self.getFilterParams());\r\n\t\t\t});\r\n\t\t\tthis.$query.on('click', '.create-shop', function (e) {\r\n\t\t\t\tvar $btn = $(this);\r\n\t\t\t\tdocument.location.href = Hualala.PageRoute.createPath('shopCreate');\r\n\t\t\t});\r\n\t\t},\r\n\t\tdestroy : function () {\r\n\t\t\tthis.isReady = false;\r\n\t\t\tthis.needShopCreate = false;\r\n\t\t\tthis.$container.find('.shop-query').remove();\r\n\t\t\tthis.$queryBox = null;\r\n\t\t\tthis.$filter = null;\r\n\t\t\tthis.$query = null;\r\n\t\t},\r\n\t\t// 获取过滤参数\r\n\t\tgetFilterParams : function () {\r\n\t\t\t// TODO\r\n\t\t\tvar self = this;\r\n\t\t\tvar focusedBtn = self.$filter.find('.btn-link.disabled');\r\n\t\t\tvar cityID = focusedBtn.filter('[data-city]').attr('data-city'),\r\n\t\t\t\tareaID = focusedBtn.filter('[data-area]').attr('data-area');\r\n\t\t\tcityID = (!cityID || cityID == -1) ? '' : cityID;\r\n\t\t\tareaID = (!areaID || areaID == -1) ? '' : areaID;\r\n\t\t\treturn {\r\n\t\t\t\tcityID : cityID,\r\n\t\t\t\tareaID : areaID,\r\n\t\t\t\tkeywordLst : ''\r\n\t\t\t};\r\n\t\t},\r\n\t\t// 获取搜索参数\r\n\t\tgetQueryParams : function () {\r\n\t\t\t// TODO\r\n\t\t\treturn {}\r\n\t\t}\r\n\r\n\t});\r\n\tHualala.Shop.QueryView = QueryView;\r\n})(jQuery, window);;(function ($, window) {\r\n\tIX.ns(\"Hualala.Shop\");\r\n\tvar popoverMsg = Hualala.UI.PopoverMsgTip;\r\n\tvar toptip = Hualala.UI.TopTip;\r\n\tvar QueryModel = Hualala.Shop.QueryModel;\r\n\tvar QueryView = Hualala.Shop.QueryView;\r\n\tvar QueryController = Stapes.subclass({\r\n\t\t/**\r\n\t\t * 店铺查询控制器\r\n\t\t * @param  {Object} cfg 配置数据\r\n\t\t *            @param {Boolean} cfg.needShopCreate 是否开启创建店铺功能\r\n\t\t *            @param {JQueryObj} container 容器\r\n\t\t *            @param {Object} resultController 结果输出控制器\r\n\t\t * @return {Object}     \r\n\t\t */\r\n\t\tconstructor : function (cfg) {\r\n\t\t\tthis.set({\r\n\t\t\t\tsessionData : Hualala.getSessionData()\r\n\t\t\t});\r\n\t\t\tthis.container = $XP(cfg, 'container', null);\r\n\t\t\tthis.needShopCreate = $XP(cfg, 'needShopCreate', false);\r\n\t\t\tthis.resultController = $XP(cfg, 'resultController', null);\r\n\t\t\tthis.model = new QueryModel();\r\n\t\t\tthis.view = new QueryView();\r\n\t\t\tthis.init();\r\n\t\t}\r\n\t});\r\n\tQueryController.proto({\r\n\t\t// 初始化控制器\r\n\t\tinit : function () {\r\n\t\t\tvar self = this;\r\n\t\t\tself.bindEvent();\r\n\t\t\tself.model.emit('load', function () {\r\n\t\t\t\tif (!self.model.hasReady()) {\r\n\t\t\t\t\tthrow(\"Shop Query Init Failed!!\");\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\t// 加载View层\r\n\t\t\t\tself.view.emit('init');\r\n\t\t\t});\r\n\t\t},\r\n\t\t// 绑定事件\r\n\t\tbindEvent : function () {\r\n\t\t\t// 控制器的事件绑定\r\n\t\t\tthis.on({\r\n\t\t\t\treload : function () {\r\n\t\t\t\t\tvar self = this;\r\n\t\t\t\t\tself.model.distory();\r\n\t\t\t\t\tself.view.distory();\r\n\t\t\t\t\tself.init();\r\n\t\t\t\t},\r\n\t\t\t\tquery : function (params) {\r\n\t\t\t\t\tvar self = this;\r\n\t\t\t\t\tconsole.info('query params:');\r\n\t\t\t\t\tconsole.info(params);\r\n\t\t\t\t\tself.resultController && self.resultController.emit('load', IX.inherit(params, {\r\n\t\t\t\t\t\tpageNo : 1,\r\n\t\t\t\t\t\tpageSize : 15\r\n\t\t\t\t\t}));\r\n\t\t\t\t}\r\n\t\t\t}, this);\r\n\t\t\t// 模型的事件绑定\r\n\t\t\tthis.model.on({\r\n\t\t\t\tload : function (cbFn) {\r\n\t\t\t\t\tvar self = this,\r\n\t\t\t\t\t\tparams = $XP(self.get('sessionData'), 'user', {});\r\n\t\t\t\t\tself.model.init(params, cbFn);\r\n\t\t\t\t}\r\n\t\t\t}, this);\r\n\t\t\t// 视图事件绑定\r\n\t\t\tthis.view.on({\r\n\t\t\t\tinit : function () {\r\n\t\t\t\t\tvar self = this;\r\n\t\t\t\t\tself.view.init({\r\n\t\t\t\t\t\tmodel : self.model,\r\n\t\t\t\t\t\tneedShopCreate : self.needShopCreate,\r\n\t\t\t\t\t\tcontainer : self.container\r\n\t\t\t\t\t});\r\n\t\t\t\t},\r\n\t\t\t\t// 过滤操作，触发显示结果\r\n\t\t\t\tfilter : function (params) {\r\n\t\t\t\t\tvar self = this;\r\n\t\t\t\t\tself.emit('query', params);\r\n\t\t\t\t\t//TODO 重置Query的chosenPanel\r\n\t\t\t\t},\r\n\t\t\t\t// 搜索操作，触发显示结果\r\n\t\t\t\tquery : function (params) {\r\n\t\t\t\t\tvar self = this;\r\n\t\t\t\t\tself.emit('query', params);\r\n\t\t\t\t}\r\n\t\t\t}, this);\r\n\t\t}\r\n\t});\r\n\tHualala.Shop.QueryController = QueryController;\r\n})(jQuery, window);;(function ($, window) {\r\n\tIX.ns(\"Hualala.Shop\");\r\n\tvar popoverMsg = Hualala.UI.PopoverMsgTip;\r\n\tvar toptip = Hualala.UI.TopTip;\r\n\tvar CardListModel = Stapes.subclass({\r\n\t\t/**\r\n\t\t * 构造卡片店铺列表的数据模型\r\n\t\t * @param  {Object} cfg 配置信息\r\n\t\t *           @param {Function} callServer 获取数据接口\r\n\t\t * @return {Object}     \r\n\t\t */\r\n\t\tconstructor : function (cfg) {\r\n\t\t\tthis.callServer = $XP(cfg, 'callServer', null);\r\n\t\t\tif (!this.callServer) {\r\n\t\t\t\tthrow(\"callServer is empty!\");\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t}\r\n\t});\r\n\tCardListModel.proto({\r\n\t\tinit : function (params) {\r\n\t\t\tthis.set({\r\n\t\t\t\tpageCount : 0,\r\n\t\t\t\ttotalSize : 0,\r\n\t\t\t\tpageNo : $XP(params, 'pageNo', 1),\r\n\t\t\t\tpageSize : $XP(params, 'pageSize', 15),\r\n\t\t\t\tcityID : $XP(params, 'cityID', ''),\r\n\t\t\t\tareaID : $XP(params, 'areaID', ''),\r\n\t\t\t\tkeywordLst : $XP(params, 'keywordLst', ''),\r\n\t\t\t\tds_shop : new IX.IListManager(),\r\n\t\t\t\tds_page : new IX.IListManager()\r\n\t\t\t});\r\n\t\t},\r\n\t\tupdatePagerParams : function (params) {\r\n\t\t\tvar self = this;\r\n\t\t\tvar pagerParamkeys = 'pageCount,totalSize,pageNo,pageSize,cityID,areaID,keywordLst';\r\n\t\t\t// _.each(pagerParamkeys.split(','), function (k, i, l) {\r\n\t\t\t// \tswitch(k) {\r\n\t\t\t// \t\tcase 'pageCount': \r\n\t\t\t// \t\tcase 'totalSize' :\r\n\t\t\t// \t\t\tself.set(k, $XP(params, k, 0));\r\n\t\t\t// \t\t\tbreak;\r\n\t\t\t// \t\tcase 'pageNo' : \r\n\t\t\t// \t\t\tself.set(k, $XP(params, k, 1));\r\n\t\t\t// \t\t\tbreak;\r\n\t\t\t// \t\tcase 'pageSize' :\r\n\t\t\t// \t\t\tself.set(k, $XP(params, k, 15));\r\n\t\t\t// \t\t\tbreak;\r\n\t\t\t// \t\tdefault:\r\n\t\t\t// \t\t\tself.set(k, $XP(params, k, ''));\r\n\t\t\t// \t\t\tbreak;\r\n\t\t\t// \t}\r\n\t\t\t// });\r\n\t\t\t_.each(params, function (v, k, l) {\r\n\t\t\t\tif (pagerParamkeys.indexOf(k) > -1) {\r\n\t\t\t\t\tself.set(k, v);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t},\r\n\t\tgetPagerParams : function () {\r\n\t\t\t// return {\r\n\t\t\t// \tPage : {\r\n\t\t\t// \t\tpageNo : this.get('pageNo'),\r\n\t\t\t// \t\tpageSize : this.get('pageSize')\r\n\t\t\t// \t},\r\n\t\t\t// \tcityID : this.get('cityID'),\r\n\t\t\t// \tareaID : this.get('areaID'),\r\n\t\t\t// \tkeywordLst : this.get('keywordLst')\r\n\t\t\t// };\r\n\t\t\treturn {\r\n\t\t\t\tpageNo : this.get('pageNo'),\r\n\t\t\t\tpageSize : this.get('pageSize'),\r\n\t\t\t\tcityID : this.get('cityID'),\r\n\t\t\t\tareaID : this.get('areaID'),\r\n\t\t\t\tkeywordLst : this.get('keywordLst')\r\n\t\t\t};\r\n\t\t},\r\n\t\tupdateDataStore : function (data, pageNo) {\r\n\t\t\tvar self = this,\r\n\t\t\t\tshopHT = self.get('ds_shop'),\r\n\t\t\t\tpageHT = self.get('ds_page');\r\n\t\t\tvar shopIDs = _.map(data, function (shop, i, l) {\r\n\t\t\t\t// var shopID = $XP(shop, 'shopID');\r\n\t\t\t\t// shopHT.register(shopID, shop);\r\n\t\t\t\t// return shopID;\r\n\t\t\t\tvar shopID = $XP(shop, 'shopID'),\r\n\t\t\t\t\tmShop = new BaseShopModel(shop);\r\n\t\t\t\tshopHT.register(shopID, mShop);\r\n\t\t\t\treturn shopID;\r\n\t\t\t});\r\n\t\t\tpageHT.register(pageNo, shopIDs);\r\n\t\t},\r\n\t\tresetDataStore : function () {\r\n\t\t\tvar self = this,\r\n\t\t\t\tshopHT = self.get('ds_shop'),\r\n\t\t\t\tpageHT = self.get('ds_page');\r\n\t\t\tshopHT.clear();\r\n\t\t\tpageHT.clear();\r\n\t\t},\r\n\t\tload : function (params, cbFn) {\r\n\t\t\tvar self = this;\r\n\t\t\tself.updatePagerParams(params);\r\n\t\t\tself.callServer(self.getPagerParams(), function (res) {\r\n\t\t\t\tif (res.resultcode == '000') {\r\n\t\t\t\t\tself.updateDataStore($XP(res, 'data.records', []), $XP(res, 'data.page.pageNo'));\r\n\t\t\t\t\tself.updatePagerParams($XP(res, 'data.page', {}));\r\n\t\t\t\t} else {\r\n\t\t\t\t\ttoptip({\r\n\t\t\t\t\t\tmsg : $XP(res, 'resultmsg', ''),\r\n\t\t\t\t\t\ttype : 'danger'\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t\tcbFn(self);\r\n\t\t\t});\r\n\t\t},\r\n\t\tgetShops : function (pageNo) {\r\n\t\t\tvar self = this,\r\n\t\t\t\tshopHT = self.get('ds_shop'),\r\n\t\t\t\tpageHT = self.get('ds_page');\r\n\t\t\tvar ret = _.map(shopHT.getByKeys(pageHT.get(pageNo)), function (mShop, i, l) {\r\n\t\t\t\treturn mShop.getAll();\r\n\t\t\t});\r\n\t\t\tconsole.info(\"pageData:\");\r\n\t\t\tconsole.info(ret);\r\n\t\t\treturn ret;\r\n\t\t},\r\n\t\tgetShopModelByShopID : function (shopID) {\r\n\t\t\tvar self = this,\r\n\t\t\t\tshopHT = self.get('ds_shop');\r\n\t\t\treturn shopHT.get(shopID);\r\n\t\t},\r\n\t\t// 更新店铺状态\r\n\t\tupdateShopStatus : function (shopID, status, failFn) {\r\n\t\t\tvar self = this,\r\n\t\t\t\tshopHT = self.get('ds_shop');\r\n\t\t\tvar shop = shopHT.get(shopID);\r\n\t\t\t// shop = IX.inherit(shop, {\r\n\t\t\t// \tstatus : status\r\n\t\t\t// });\r\n\t\t\t// shopHT.register(shopID, shop);\r\n\t\t\t// shop.set('status', status);\r\n\t\t\tshop.emit('switchShopStatus', {\r\n\t\t\t\tstatus : status,\r\n\t\t\t\tfailFn : failFn\r\n\t\t\t});\r\n\t\t},\r\n\t\t// 更新店铺业务状态\r\n\t\tupdateShopBusinessStatus : function (params, failFn) {\r\n\t\t\tvar self = this,\r\n\t\t\t\tshopHT = self.get('ds_shop'),\r\n\t\t\t\tshopID = $XP(params, 'shopID'),\r\n\t\t\t\tshop = shopHT.get(shopID);\r\n\t\t\tshop.emit('switchBusinessStatus', {\r\n\t\t\t\tname : $XP(params, 'name'),\r\n\t\t\t\tid : $XP(params, 'id'),\r\n\t\t\t\tstatus : $XP(params, 'state'),\r\n\t\t\t\tfailFn : failFn\r\n\t\t\t});\r\n\r\n\t\t}\r\n\t});\r\n\r\n\r\n\tHualala.Shop.CardListModel = CardListModel;\r\n\r\n\tvar BaseShopModel = Stapes.subclass({\r\n\t\tconstructor : function (shop) {\r\n\t\t\tthis.switchShopStatusCallServer = Hualala.Global.switchShopStatus;\r\n\t\t\tthis.switchShopBusinessStatusCallServer = Hualala.Global.switchShopServiceFeatureStatus;\r\n\t\t\tthis.set(shop);\r\n\t\t\tthis.bindEvent();\r\n\t\t}\r\n\t});\r\n\tBaseShopModel.proto({\r\n\t\tswitchShopStatus : function (status, failFn) {\r\n\t\t\tvar self = this,\r\n\t\t\t\tshopID = self.get('shopID');\r\n\t\t\tself.set('status', status);\r\n\t\t\tconsole.info(\"Switch Shop [\" + self.get('shopID') + \"] status \" + status);\r\n\t\t\tthis.switchShopStatusCallServer({\r\n\t\t\t\tshopID : shopID,\r\n\t\t\t\tstatus : status\r\n\t\t\t}, function (res) {\r\n\t\t\t\tif (res.resultcode !== '000') {\r\n\t\t\t\t\t\r\n\t\t\t\t\ttoptip({\r\n\t\t\t\t\t\tmsg : $XP(res, 'resultmsg', ''),\r\n\t\t\t\t\t\ttype : 'danger'\r\n\t\t\t\t\t});\r\n\t\t\t\t\tself.set('status', !status ? 1 : 0);\r\n\t\t\t\t\tfailFn(shopID);\r\n\t\t\t\t\t\r\n\t\t\t\t} else {\r\n\t\t\t\t\ttoptip({\r\n\t\t\t\t\t\tmsg : '切换成功!',\r\n\t\t\t\t\t\ttype : 'success'\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t},\r\n\t\tswitchShopBusinessStatus : function (params) {\r\n\t\t\tvar self = this,\r\n\t\t\t\tshopID = self.get('shopID');\r\n\t\t\tvar failFn = $XF(params, 'failFn'),\r\n\t\t\t\tname = $XP(params, 'name'),\r\n\t\t\t\tid = $XP(params, 'id'),\r\n\t\t\t\tstatus = $XP(params, 'status');\r\n\t\t\tvar setServiceFeature = function (sName, s) {\r\n\t\t\t\tvar serviceFeatures = self.get('serviceFeatures').split(',');\r\n\t\t\t\t// 更新serviceFeature\r\n\t\t\t\tif (s == 1) {\r\n\t\t\t\t\tserviceFeatures.push(sName);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tserviceFeatures = _.filter(serviceFeatures, function (el) {\r\n\t\t\t\t\t\treturn el !== sName;\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t\tself.set('serviceFeatures', serviceFeatures.join(','));\r\n\t\t\t};\r\n\t\t\tsetServiceFeature(name, status);\r\n\t\t\tconsole.info(\"Switch Shop [\" + self.get('shopID') + \"] ServiceFeature: \" + self.get('serviceFeatures'));\r\n\t\t\tthis.switchShopBusinessStatusCallServer({\r\n\t\t\t\tshopID : shopID,\r\n\t\t\t\tserviceFeature : name,\r\n\t\t\t\toperation : status\r\n\t\t\t}, function (res) {\r\n\t\t\t\tif (res.resultcode !== '000') {\r\n\t\t\t\t\ttoptip({\r\n\t\t\t\t\t\tmsg : $XP(res, 'resultmsg', ''),\r\n\t\t\t\t\t\ttype : 'danger'\r\n\t\t\t\t\t});\r\n\t\t\t\t\tsetServiceFeature(name, !status ? 1 : 0);\r\n\t\t\t\t\tfailFn({\r\n\t\t\t\t\t\tshopID : shopID,\r\n\t\t\t\t\t\tid : id\r\n\t\t\t\t\t});\r\n\t\t\t\t} else {\r\n\t\t\t\t\ttoptip({\r\n\t\t\t\t\t\tmsg : '切换成功!',\r\n\t\t\t\t\t\ttype : 'success'\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t},\r\n\t\tbindEvent : function () {\r\n\t\t\tvar self = this;\r\n\t\t\tthis.on({\r\n\t\t\t\t\"switchShopStatus\" : function (params) {\r\n\t\t\t\t\tvar status = $XP(params, 'status'),\r\n\t\t\t\t\t\tfailFn = $XF(params, 'failFn');\r\n\t\t\t\t\tthis.switchShopStatus(status, failFn);\r\n\t\t\t\t},\r\n\t\t\t\t\"switchBusinessStatus\" : function (params) {\r\n\t\t\t\t\tthis.switchShopBusinessStatus(params);\r\n\t\t\t\t},\r\n\t\t\t\t\"setServiceParams\" : function (cfg) {\r\n\t\t\t\t\tvar callServer = $XF(cfg, 'callServer'),\r\n\t\t\t\t\t\tparams = $XP(cfg, 'params', {}),\r\n\t\t\t\t\t\tserviceID = $XP(cfg, 'serviceID'),\r\n\t\t\t\t\t\tshopID = self.get('shopID'),\r\n\t\t\t\t\t\tfailFn = $XF(cfg, 'failFn'),\r\n\t\t\t\t\t\tsuccessFn = $XF(cfg, 'successFn');\r\n\t\t\t\t\tcallServer(IX.inherit(params, {\r\n\t\t\t\t\t\tshopID : shopID,\r\n\t\t\t\t\t\tstrType : serviceID\r\n\t\t\t\t\t}), function (res) {\r\n\t\t\t\t\t\tif (res.resultcode !== '000') {\r\n\t\t\t\t\t\t\ttoptip({\r\n\t\t\t\t\t\t\t\tmsg : $XP(res, 'resultmsg', ''),\r\n\t\t\t\t\t\t\t\ttype : 'danger'\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\tfailFn();\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tvar newData = {};\r\n\t\t\t\t\t\t\tnewData[serviceID] = params;\r\n\t\t\t\t\t\t\tself.set('revParamJson', IX.inherit(self.get('revParamJson'), newData));\r\n\t\t\t\t\t\t\tsuccessFn();\r\n\t\t\t\t\t\t\ttoptip({\r\n\t\t\t\t\t\t\t\tmsg : '配置成功!',\r\n\t\t\t\t\t\t\t\ttype : 'success'\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\t});\r\n})(jQuery, window);;(function ($, window) {\r\n\tIX.ns(\"Hualala.Shop\");\r\n\tvar popoverMsg = Hualala.UI.PopoverMsgTip;\r\n\tvar toptip = Hualala.UI.TopTip;\r\n\tvar CardListView = Stapes.subclass({\r\n\t\tconstructor : function () {\r\n\t\t\t// View层容器\r\n\t\t\tthis.$container = null;\r\n\t\t\t// 结果容器\r\n\t\t\tthis.$resultBox = null;\r\n\t\t\t// 结果列表\r\n\t\t\tthis.$list = null;\r\n\t\t\t// 分页容器\r\n\t\t\tthis.$pager = null;\r\n\t\t\tthis.loadTemplates();\r\n\t\t}\r\n\t});\r\n\tCardListView.proto({\r\n\t\tinit : function (cfg) {\r\n\t\t\tthis.$container = $XP(cfg, 'container', null);\r\n\t\t\tthis.model = $XP(cfg, 'model', null);\r\n\t\t\tif (!this.$container || !this.model) {\r\n\t\t\t\tthrow(\"CardList View Init Failed!\");\r\n\t\t\t\treturn ;\r\n\t\t\t}\r\n\t\t\tthis.initLayout();\r\n\t\t},\r\n\t\tinitLayout : function () {\r\n\t\t\tvar layoutTpl = this.get('layoutTpl');\r\n\t\t\tvar htm = layoutTpl();\r\n\t\t\tthis.$container.append(htm);\r\n\t\t\tthis.$resultBox = this.$container.find('.shop-list');\r\n\t\t\tthis.$list = this.$container.find('.shop-list-body');\r\n\t\t\tthis.$pager = this.$container.find('.page-selection');\r\n\t\t\tthis.initPager();\r\n\t\t\tthis.bindEvent();\r\n\t\t},\r\n\t\tinitPager : function (params) {\r\n\t\t\tvar baseCfg = {\r\n\t\t\t\ttotal : 0,\r\n\t\t\t\tpage : 1,\r\n\t\t\t\tmaxVisible : 10,\r\n\t\t\t\tleaps : true\r\n\t\t\t};\r\n\t\t\tthis.$pager.IXPager(IX.inherit(baseCfg, params));\r\n\t\t},\r\n\t\tbindEvent : function () {\r\n\t\t\tvar self = this;\r\n\t\t\tself.$list.tooltip({\r\n\t\t\t\tselector : '[title]'\r\n\t\t\t});\r\n\t\t\tself.$list.on('click', '.btn[data-href]', function (e) {\r\n\t\t\t\tvar $btn = $(this),\r\n\t\t\t\t\tpath = $btn.attr('data-href');\r\n\t\t\t\tdocument.location.href = path;\r\n\t\t\t});\r\n\t\t\tself.$pager.on('page', function (e, pageNo) {\r\n\t\t\t\tvar params = self.model.getPagerParams();\r\n\t\t\t\tparams['pageNo'] = pageNo;\r\n\t\t\t\tself.model.emit('load', IX.inherit(params, {\r\n\t\t\t\t\tpageNo : $XP(params, 'pageNo', 1),\r\n\t\t\t\t\tpageSize : $XP(params, 'pageSize', 15)\r\n\t\t\t\t}));\r\n\t\t\t});\r\n\t\t},\r\n\t\t// 加载View层所需模板\r\n\t\tloadTemplates : function () {\r\n\t\t\tvar layoutTpl = Handlebars.compile(Hualala.TplLib.get('tpl_shop_list_layout')),\r\n\t\t\t\tlistTpl = Handlebars.compile(Hualala.TplLib.get('tpl_shop_list')),\r\n\t\t\t\titemTpl = Handlebars.compile(Hualala.TplLib.get('tpl_shop_card')),\r\n\t\t\t\ttagTpl = Handlebars.compile(Hualala.TplLib.get('tpl_shop_tags'));\r\n\t\t\t// 注册shopCard子模板\r\n\t\t\tHandlebars.registerPartial(\"shopTag\", Hualala.TplLib.get('tpl_shop_tags'));\r\n\t\t\tHandlebars.registerPartial(\"shopCard\", Hualala.TplLib.get('tpl_shop_card'));\r\n\r\n\t\t\tthis.set({\r\n\t\t\t\tlayoutTpl : layoutTpl,\r\n\t\t\t\tlistTpl : listTpl,\r\n\t\t\t\titemTpl : itemTpl,\r\n\t\t\t\ttagTpl : tagTpl\r\n\t\t\t});\r\n\t\t},\r\n\t\t// 格式化渲染数据\r\n\t\tmapRenderData : function (data) {\r\n\t\t\tvar self = this;\r\n\t\t\tvar getTags = function (tags) {\r\n\t\t\t\treturn _.map(tags, function (t, i, l) {\r\n\t\t\t\t\treturn {\r\n\t\t\t\t\t\tclz : 'label-info',\r\n\t\t\t\t\t\ttag : t\r\n\t\t\t\t\t};\r\n\t\t\t\t});\r\n\t\t\t};\r\n\t\t\tvar ret = _.map(data, function (shop, i, l) {\r\n\t\t\t\tvar address = $XP(shop, 'address', ''),\r\n\t\t\t\t\tbyteLen = Hualala.Common.strByteLength(address),\r\n\t\t\t\t\tslugAddr = '';\r\n\t\t\t\tslugAddr = byteLen < 72 ? address : (Hualala.Common.substrByte(address, 70) + '...');\r\n\t\t\t\treturn {\r\n\t\t\t\t\tclz : '',\r\n\t\t\t\t\tid : $XP(shop, 'shopID', ''),\r\n\t\t\t\t\tname : $XP(shop, 'shopName', ''),\r\n\t\t\t\t\timg : Hualala.Common.getSourceImage($XP(shop, 'imagePath', ''), {\r\n\t\t\t\t\t\twidth : 100,\r\n\t\t\t\t\t\theight : 100,\r\n\t\t\t\t\t\tquality : 50\r\n\t\t\t\t\t}),\r\n\t\t\t\t\ttags : getTags($XP(shop, 'tags', [])),\r\n\t\t\t\t\taddress : address,\r\n\t\t\t\t\tslugAddr : slugAddr,\r\n\t\t\t\t\ttel : $XP(shop, 'tel', ''),\r\n\t\t\t\t\tinfoHref : Hualala.PageRoute.createPath('shopInfo', [$XP(shop, 'shopID', '')]),\r\n\t\t\t\t\tmenuHref : Hualala.PageRoute.createPath('shopMenu', [$XP(shop, 'shopID', '')]),\r\n\t\t\t\t\tchecked : $XP(shop, 'status') == 1 ? 'checked' : ''\r\n\t\t\t\t};\r\n\t\t\t});\r\n\t\t\treturn {\r\n\t\t\t\tshopCard : {\r\n\t\t\t\t\tlist : ret\r\n\t\t\t\t}\r\n\t\t\t};\r\n\t\t},\r\n\t\t// 渲染开关\r\n\t\tinitSwitcher : function (selector) {\r\n\t\t\tvar self = this;\r\n\t\t\tself.$list.find(selector).bootstrapSwitch({\r\n\t\t\t\t// baseClass : 'ix-bs-switch',\r\n\t\t\t\t// wrapperClass : 'ix-bs-switch-wrapper',\r\n\t\t\t\tsize : 'normal',\r\n\t\t\t\tonColor : 'success',\r\n\t\t\t\toffColor : 'default',\r\n\t\t\t\tonText : '已开通',\r\n\t\t\t\toffText : '未开通'\r\n\t\t\t});\r\n\t\t\t// 绑定开关事件\r\n\t\t\tself.$list.find(selector).on('switchChange.bootstrapSwitch', function (e, state) {\r\n\t\t\t\tvar $chkbox = $(this),\r\n\t\t\t\t\tshopID = $chkbox.attr('data-shop'),\r\n\t\t\t\t\tstate = !state ? 0 : 1;\r\n\t\t\t\tself.model.updateShopStatus(shopID, state, function (_shopID) {\r\n\t\t\t\t\tself.$list.find(selector).filter('[data-shop=' + _shopID + ']').bootstrapSwitch('toggleState', true);\r\n\t\t\t\t});\r\n\t\t\t});\r\n\t\t},\r\n\t\t// 渲染view\r\n\t\trender : function () {\r\n\t\t\tvar self = this,\r\n\t\t\t\tmodel = self.model,\r\n\t\t\t\tpagerParams = model.getPagerParams(),\r\n\t\t\t\tpageNo = $XP(pagerParams, 'pageNo');\r\n\t\t\tvar shops = model.getShops(pageNo);\r\n\t\t\tvar renderData = self.mapRenderData(shops);\r\n\t\t\tvar listTpl = self.get('listTpl');\r\n\t\t\tvar html = listTpl(renderData);\r\n\t\t\tself.$list.empty();\r\n\t\t\tself.$list.html(html);\r\n\t\t\tself.initPager({\r\n\t\t\t\ttotal : model.get('pageCount'),\r\n\t\t\t\tpage : model.get('pageNo'),\r\n\t\t\t\thref : 'javascript:void(0);'\r\n\t\t\t});\r\n\t\t\t// self.$list.find(':checkbox[name*=switcher_]').bootstrapSwitch();\r\n\t\t\tself.initSwitcher(':checkbox[name=switcher]');\r\n\t\t}\r\n\t});\r\n\r\n\tHualala.Shop.CardListView = CardListView;\r\n\r\n\tvar ShopListView = CardListView.subclass({\r\n\t\tconstructor : function () {\r\n\t\t\t// View层容器\r\n\t\t\tthis.$container = null;\r\n\t\t\t// 结果容器\r\n\t\t\tthis.$resultBox = null;\r\n\t\t\t// 结果列表\r\n\t\t\tthis.$list = null;\r\n\t\t\t// 分页容器\r\n\t\t\tthis.$pager = null;\r\n\t\t\tthis.loadTemplates();\r\n\t\t}\r\n\t});\r\n\tShopListView.proto({\r\n\t\tbindEvent : function () {\r\n\t\t\tvar self = this;\r\n\t\t\tself.$list.tooltip({\r\n\t\t\t\tselector : '[title]'\r\n\t\t\t});\r\n\t\t\tself.$pager.on('page', function (e, pageNo) {\r\n\t\t\t\tvar params = self.model.getPagerParams();\r\n\t\t\t\tparams['pageNo'] = pageNo;\r\n\t\t\t\tself.model.emit('load', IX.inherit(params, {\r\n\t\t\t\t\tpageNo : $XP(params, 'pageNo', 1),\r\n\t\t\t\t\tpageSize : $XP(params, 'pageSize', 15)\r\n\t\t\t\t}));\r\n\t\t\t});\r\n\t\t\t// 弹出修改业务窗口\r\n\t\t\tself.$list.on('click', '.btn[data-business]', function (e) {\r\n\t\t\t\tvar $btn = $(this),\r\n\t\t\t\t\tshopID = $btn.attr('data-shop'),\r\n\t\t\t\t\tbusinessName = $btn.attr('data-business'),\r\n\t\t\t\t\tbusinessID = $btn.attr('data-business-id');\r\n\t\t\t\tself.initBusinessModal($btn, shopID, businessName, businessID);\r\n\t\t\t});\r\n\t\t},\r\n\t\t// 加载View层所需模板\r\n\t\tloadTemplates : function () {\r\n\t\t\tvar layoutTpl = Handlebars.compile(Hualala.TplLib.get('tpl_shop_list_layout')),\r\n\t\t\t\tlistTpl = Handlebars.compile(Hualala.TplLib.get('tpl_shop_list')),\r\n\t\t\t\titemTpl = Handlebars.compile(Hualala.TplLib.get('tpl_shop_list_item')),\r\n\t\t\t\ttagTpl = Handlebars.compile(Hualala.TplLib.get('tpl_shop_tags'));\r\n\t\t\t// 注册shopCard子模板\r\n\t\t\tHandlebars.registerPartial(\"shopTag\", Hualala.TplLib.get('tpl_shop_tags'));\r\n\t\t\tHandlebars.registerPartial(\"shopItem\", Hualala.TplLib.get('tpl_shop_list_item'));\r\n\r\n\t\t\tthis.set({\r\n\t\t\t\tlayoutTpl : layoutTpl,\r\n\t\t\t\tlistTpl : listTpl,\r\n\t\t\t\titemTpl : itemTpl,\r\n\t\t\t\ttagTpl : tagTpl\r\n\t\t\t});\r\n\t\t},\r\n\t\t// 获取店铺业务信息数据\r\n\t\tgetShopBusiness : function (shop) {\r\n\t\t\tvar business = Hualala.TypeDef.ShopBusiness,\r\n\t\t\t\tbusinessHT = new IX.IListManager(),\r\n\t\t\t\tserviceFeatures = $XP(shop, 'serviceFeatures', ''),\r\n\t\t\t\tbusinessCfg = $XP(shop, 'revParamJson', {});\r\n\t\t\tvar ret = null;\r\n\t\t\t_.each(business, function (item, i, l) {\r\n\t\t\t\tvar id = $XP(item, 'id'), name = $XP(item, 'name')\r\n\t\t\t\t\tswitcherStatus = serviceFeatures.indexOf(name) >= 0 ? 1 : 0;\r\n\t\t\t\tvar ret = IX.inherit(item, $XP(businessCfg, 'id'), {\r\n\t\t\t\t\tswitcherStatus : switcherStatus,\r\n\t\t\t\t\tshopID : $XP(shop, 'shopID')\r\n\t\t\t\t});\r\n\t\t\t\tbusinessHT.register(name, ret);\r\n\t\t\t});\r\n\t\t\tret = _.filter(businessHT.getAll(), function (el) {\r\n\t\t\t\treturn $XP(el, 'businessIsSupported', false) == true;\r\n\t\t\t});\r\n\t\t\treturn ret;\r\n\t\t},\r\n\t\t// 获取店铺业务信息渲染数据\r\n\t\tmapBusinessRenderData : function (shop) {\r\n\t\t\tvar self = this,\r\n\t\t\t\tdata = self.getShopBusiness(shop);\r\n\t\t\treturn _.map(data, function (el) {\r\n\t\t\t\tvar name = $XP(el, 'name'),\r\n\t\t\t\t\ticon = 'icon-' + name,\r\n\t\t\t\t\tswitcherName = 'switcher_business',\r\n\t\t\t\t\topen = $XP(el, 'switcherStatus') == 1 ? 'checked' : '';\r\n\t\t\t\treturn {\r\n\t\t\t\t\ticon : icon,\r\n\t\t\t\t\tlabel : $XP(el, 'label'),\r\n\t\t\t\t\tswitcherName : switcherName,\r\n\t\t\t\t\tshopID : $XP(el, 'shopID'),\r\n\t\t\t\t\ttype : name,\r\n\t\t\t\t\tid : $XP(el, 'id'),\r\n\t\t\t\t\topen : open,\r\n\t\t\t\t\tdesc : ''\r\n\t\t\t\t};\r\n\t\t\t});\r\n\t\t},\r\n\t\t// 校验是否有财务或更高权限\r\n\t\tchkHasAccountRole : function () {\r\n\t\t\tvar loginUsr = Hualala.getSessionUser(),\r\n\t\t\t\tusrRoles = $XP(loginUsr, 'role');\r\n\t\t\t\troles = Hualala.getSessionRoles();\r\n\t\t\tvar ret = _.find(roles, function (role) {\r\n\t\t\t\tvar roleType = $XP(role, 'roleType');\r\n\t\t\t\tvar matchedID = _.find(usrRoles, function (v) {\r\n\t\t\t\t\treturn $XP(role, 'id') == v;\r\n\t\t\t\t});\r\n\t\t\t\treturn !!matchedID && (roleType == 'account' || roleType == 'all');\r\n\t\t\t});\r\n\t\t\treturn !!ret;\r\n\t\t},\r\n\t\t// 格式化渲染数据\r\n\t\tmapRenderData : function (data) {\r\n\t\t\tvar self = this;\r\n\t\t\tvar ret = _.map(data, function (shop, i, l) {\r\n\t\t\t\treturn {\r\n\t\t\t\t\tclz : '',\r\n\t\t\t\t\tshopID : $XP(shop, 'shopID', ''),\r\n\t\t\t\t\tshopName : $XP(shop, 'shopName', ''),\r\n\t\t\t\t\thideAccount : !self.chkHasAccountRole() ? 'hidden' : '',\r\n\t\t\t\t\tsettleName : $XP(shop, 'settleName', ''),\r\n\t\t\t\t\tswitcherName : 'switcher_status',\r\n\t\t\t\t\tshopOpen : $XP(shop, 'status') == 1 ? 'checked' : '',\r\n\t\t\t\t\tbusiness : self.mapBusinessRenderData(shop)\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\treturn {\r\n\t\t\t\tshopItem : {\r\n\t\t\t\t\tlist : ret\r\n\t\t\t\t}\r\n\t\t\t};\r\n\t\t},\r\n\t\t// 渲染开关\r\n\t\tinitSwitcher : function (selector) {\r\n\t\t\tvar self = this;\r\n\t\t\tself.$list.find(selector).bootstrapSwitch({\r\n\t\t\t\t// baseClass : 'ix-bs-switch',\r\n\t\t\t\t// wrapperClass : 'ix-bs-switch-wrapper',\r\n\t\t\t\tsize : 'normal',\r\n\t\t\t\tonColor : selector == ':checkbox[name=switcher_business]' ? 'primary' : 'success',\r\n\t\t\t\toffColor : 'default',\r\n\t\t\t\tonText : '已开通',\r\n\t\t\t\toffText : '未开通'\r\n\t\t\t});\r\n\t\t\t// 绑定开关事件\r\n\t\t\tself.$list.find(selector).on('switchChange.bootstrapSwitch', function (e, state) {\r\n\t\t\t\tvar $chkbox = $(this),\r\n\t\t\t\t\tname = $chkbox.attr('name'),\r\n\t\t\t\t\tshopID = $chkbox.attr('data-shop'),\r\n\t\t\t\t\tstate = !state ? 0 : 1,\r\n\t\t\t\t\tbusiness = $chkbox.attr('data-business'),\r\n\t\t\t\t\tbusinessID = $chkbox.attr('data-business-id');\r\n\t\t\t\tif (name == 'switcher_status') {\r\n\t\t\t\t\tself.model.updateShopStatus(shopID, state, function (_shopID) {\r\n\t\t\t\t\t\tself.$list.find(selector).filter('[data-shop=' + _shopID + ']').bootstrapSwitch('toggleState', true);\r\n\t\t\t\t\t});\r\n\t\t\t\t} else {\r\n\t\t\t\t\tself.model.updateShopBusinessStatus({\r\n\t\t\t\t\t\tshopID : shopID,\r\n\t\t\t\t\t\tname : business,\r\n\t\t\t\t\t\tid : businessID,\r\n\t\t\t\t\t\tstatus : state\r\n\t\t\t\t\t}, function (params) {\r\n\t\t\t\t\t\tself.$list.find(selector).filter('[data-shop=' + $XP(params, 'shopID') + '][data-business-id=' + $XP(params, 'id') + ']')\r\n\t\t\t\t\t\t\t.bootstrapSwitch('toggleState', true);\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t});\r\n\t\t},\r\n\t\t// 渲染view\r\n\t\trender : function () {\r\n\t\t\tvar self = this,\r\n\t\t\t\tmodel = self.model,\r\n\t\t\t\tpagerParams = model.getPagerParams(),\r\n\t\t\t\tpageNo = $XP(pagerParams, 'pageNo');\r\n\t\t\tvar shops = model.getShops(pageNo);\r\n\t\t\tvar renderData = self.mapRenderData(shops);\r\n\t\t\tvar listTpl = self.get('listTpl');\r\n\t\t\tvar html = listTpl(renderData);\r\n\t\t\tself.$list.empty();\r\n\t\t\tself.$list.html(html);\r\n\t\t\tself.initPager({\r\n\t\t\t\ttotal : model.get('pageCount'),\r\n\t\t\t\tpage : model.get('pageNo'),\r\n\t\t\t\thref : 'javascript:void(0);'\r\n\t\t\t});\r\n\t\t\t// self.$list.find(':checkbox[name*=switcher_]').bootstrapSwitch();\r\n\t\t\tself.initSwitcher(':checkbox[name=switcher_business]');\r\n\t\t\tself.initSwitcher(':checkbox[name=switcher_status]');\r\n\t\t},\r\n\t\t// 生成业务编辑窗口\r\n\t\tinitBusinessModal : function (trigger, shopID, name, id) {\r\n\t\t\tvar self = this;\r\n\t\t\tvar editView = new Hualala.Setting.editServiceView({\r\n\t\t\t\ttriggerEl : trigger,\r\n\t\t\t\tserviceID : id,\r\n\t\t\t\tserviceName : name,\r\n\t\t\t\tmodel : self.model.getShopModelByShopID(shopID)\r\n\t\t\t});\r\n\t\t}\r\n\t});\r\n\tHualala.Shop.ShopListView = ShopListView;\r\n})(jQuery, window);;(function ($, window) {\r\n\tIX.ns(\"Hualala.Shop\");\r\n\tvar popoverMsg = Hualala.UI.PopoverMsgTip;\r\n\tvar toptip = Hualala.UI.TopTip;\r\n\tvar ShopListModel = Hualala.Shop.ShopListModel;\r\n\tvar ShopListView = Hualala.Shop.ShopListView;\r\n\tvar ShopListController = Stapes.subclass({\r\n\t\t/**\r\n\t\t * 店铺结果列表控制器\r\n\t\t * @param  {Object} cfg 配置参数\r\n\t\t *          @param {JQueryObj} container 容器\r\n\t\t *          @param {Object} view  店铺结果的View模块实例\r\n\t\t *          @param {Object} model 店铺结果的数据模块实例\r\n\t\t * @return {Object}     \r\n\t\t */\r\n\t\tconstructor : function (cfg) {\r\n\t\t\tthis.set({\r\n\t\t\t\tsessionData : Hualala.getSessionData()\r\n\t\t\t});\r\n\t\t\tthis.container = $XP(cfg, 'container', null);\r\n\t\t\tthis.view = $XP(cfg, 'view', null),\r\n\t\t\tthis.model = $XP(cfg, 'model', null);\r\n\t\t\tif (!this.view || !this.model || !this.container) {\r\n\t\t\t\tthrow(\"Shop List init faild!!\");\r\n\t\t\t}\r\n\t\t\tthis.isReady = false;\r\n\t\t\tthis.bindEvent();\r\n\t\t}\r\n\t});\r\n\tShopListController.proto({\r\n\t\tinit : function (params) {\r\n\t\t\tthis.model.init(params);\r\n\t\t\tthis.view.init({\r\n\t\t\t\tmodel : this.model,\r\n\t\t\t\tcontainer : this.container\r\n\t\t\t});\r\n\t\t\tthis.isReady = true;\r\n\t\t},\r\n\t\thasReady : function () {return this.isReady;},\r\n\t\tbindEvent : function () {\r\n\t\t\tthis.on({\r\n\t\t\t\tload : function (params) {\r\n\t\t\t\t\tvar self = this;\r\n\t\t\t\t\tif (!self.hasReady()) {\r\n\t\t\t\t\t\tself.init(params);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tself.model.emit('load', params);\r\n\t\t\t\t}\r\n\t\t\t}, this);\r\n\t\t\tthis.model.on({\r\n\t\t\t\tload : function (params) {\r\n\t\t\t\t\tvar self = this;\r\n\t\t\t\t\tvar cbFn = function () {\r\n\t\t\t\t\t\tself.view.emit('render');\r\n\t\t\t\t\t};\r\n\t\t\t\t\tself.model.load(params, cbFn);\r\n\t\t\t\t},\r\n\t\t\t\t// \"update:totalSize\" : function (v) {\r\n\t\t\t\t// \tvar self = this;\r\n\t\t\t\t// \tself.view.initPager({\r\n\t\t\t\t// \t\ttotal : self.get('totalSize'),\r\n\t\t\t\t// \t\tpage : self.get('pageNo')\r\n\t\t\t\t// \t});\r\n\t\t\t\t// }\r\n\t\t\t}, this);\r\n\t\t\tthis.view.on({\r\n\t\t\t\trender : function () {\r\n\t\t\t\t\tvar self = this;\r\n\t\t\t\t\tself.view.render();\r\n\t\t\t\t},\r\n\t\t\t\treloadPager : function (params) {\r\n\t\t\t\t\tvar self = this;\r\n\t\t\t\t\tself.view.initPager(params);\r\n\t\t\t\t}\r\n\t\t\t}, this);\r\n\t\t}\r\n\t});\r\n\tHualala.Shop.ShopListController = ShopListController;\r\n})(jQuery, window);;(function ($, window) {\r\nIX.ns('Hualala.Shop');\r\nvar G = Hualala.Global,\r\n    U = Hualala.UI,\r\n    topTip = U.TopTip; \r\n// 初始化创建店铺页面\r\nHualala.Shop.initCreate = function ($wizard)\r\n{\r\n    //初始化向导控件\r\n    $wizard.bootstrapWizard();\r\n    var bsWizard = $wizard.data('bootstrapWizard'),\r\n        $step1 = $wizard.find('#tab1'),\r\n        $step2 = $wizard.find('#tab2'),\r\n        $step3 = $wizard.find('#tab3'),\r\n        $city = $step1.find('#cityID'),\r\n        $area = $step1.find('#areaID'),\r\n        $cuisine1 = $step1.find('#cuisineID1'),\r\n        $cuisine2 = $step1.find('#cuisineID2');\r\n    // 初始化城市列表下拉框\r\n    initCities($city);\r\n    // 根据所选择的城市设置地标、菜系下拉列表\r\n    $city.on('change', function ()\r\n    {\r\n        var cityID = $(this).val();\r\n        if(!cityID) return;\r\n        \r\n        initAreas($area, cityID);\r\n        initCuisines($cuisine1, $cuisine2, cityID);\r\n        \r\n    });\r\n    // 初始化timepicker\r\n    $step1.find('#openingHoursStart, #openingHoursEnd').timepicker({\r\n        minuteStep: 1,\r\n        showMeridian: false,\r\n        disableFocus : true,\r\n        showInputs : false\r\n    });\r\n    // 初始化表单验证\r\n    $step1.bootstrapValidator({\r\n        fields: {\r\n            shopName: {\r\n                message: '店铺名无效',\r\n                validators: {\r\n                    notEmpty: {\r\n                        message: '店铺名不能为空'\r\n                    },\r\n                    stringLength: {\r\n                        min: 2,\r\n                        max: 100,\r\n                        message: '店铺名长度必须在2到100个字符之间'\r\n                    }\r\n                }\r\n            },\r\n            cityID: {\r\n                validators: { notEmpty: { message: '请选择店铺所在城市' } }\r\n            },\r\n            tel: {\r\n                validators: {\r\n                    notEmpty: { message: '店铺电话不能为空' },\r\n                    telOrMobile: { message: '' }\r\n                }\r\n            },\r\n            address: {\r\n                validators: {\r\n                    notEmpty: { message: '店铺地址不能为空' },\r\n                    stringLength: {\r\n                        min: 6,\r\n                        max: 100,\r\n                        message: '地址长度必须在6到100个字符之间'\r\n                    }\r\n                }\r\n            },\r\n            PCCL: {\r\n                validators: {\r\n                    notEmpty: { message: '人均消费不能为空' },\r\n                    numeric: { message: '人均消费必须是金额数字' }\r\n                }\r\n            },\r\n            operationMode: {\r\n                validators: {\r\n                    notEmpty: { message: '请选择店铺运营模式' }\r\n                }\r\n            },\r\n            openingHoursStart: {\r\n                validators: {\r\n                    notEmpty: { message: '每天营业开始时间不能空' },\r\n                    time: { message: '' }\r\n                }\r\n            },\r\n            openingHoursEnd: {\r\n                validators: {\r\n                    notEmpty: { message: '每天营业结束时间不能空' },\r\n                    time: {\r\n                        message: '',\r\n                        startTimeField: 'openingHoursStart'\r\n                    }\r\n                }\r\n            },\r\n            areaID: {\r\n                validators: {\r\n                    notEmpty: { message: '请选择店铺所在地标' }\r\n                }\r\n            },\r\n            cuisineID1: {\r\n                validators: {\r\n                    notEmpty: { message: '请选择菜系1' }\r\n                }\r\n            }\r\n        }\r\n    });\r\n    \r\n    var $uploadImg = $step1.find('#uploadImg'),\r\n        imagePath = ''; // 门头图图片路径\r\n    // 上传门头图\r\n    $uploadImg.find('button, img').on('click', function()\r\n    {\r\n        U.uploadImg({\r\n            onSuccess: function (imgPath, $dlg)\r\n            {\r\n                var src = G.IMAGE_RESOURCE_DOMAIN + '/' + imgPath;\r\n                imagePath = imgPath;\r\n                $uploadImg.find('img').attr('src', src);\r\n                $dlg.modal('hide');\r\n            }\r\n        });\r\n    });\r\n    //bsWizard.show(1);\r\n    var dataStep1 = null, // 第一步店铺基本信息数据\r\n        map = null, // 地图组件实例\r\n        shopID = '',\r\n        $searchBox = $step2.find('.map-search-box'),\r\n        $shopSettingLink = $step3.find('#shopSettingLink');\r\n    // 向导组件的下一步行为控制\r\n    $wizard.find('#nextStep').on('click', function()\r\n    {\r\n        var $curStep = bsWizard.activePane();\r\n        // 第一步\r\n        if($curStep.is('#tab1'))\r\n        {\r\n            if(!$step1.data('bootstrapValidator').validate().isValid()) return;\r\n            // 数据提交前预处理\r\n            dataStep1 = Hualala.Common.parseForm($step1);\r\n            dataStep1.shopID = shopID;\r\n            dataStep1.shopName = dataStep1.shopName.replace('（', '(').replace('）', ')');\r\n            dataStep1.areaName = getSelectText($area);\r\n            dataStep1.cuisineName1 = getSelectText($cuisine1);\r\n            dataStep1.cuisineName2 = dataStep1.cuisineID2 ? getSelectText($cuisine2) : '';\r\n            dataStep1.imagePath = imagePath;\r\n            dataStep1.openingHours = dataStep1.openingHoursStart + '-' + dataStep1.openingHoursEnd;\r\n            var keywords = [dataStep1.shopName, dataStep1.address, dataStep1.cuisineName1];\r\n            dataStep1.cuisineName2 && keywords.push(dataStep1.cuisineName2);\r\n            keywords.push(dataStep1.areaName);\r\n            dataStep1.keywordLst = keywords.join(' | ');\r\n            // 根据店铺是否已经产生调用不同的服务\r\n            var callServer = shopID ? G.updateShopBaseInfo : G.createShop;\r\n            callServer(dataStep1, function(rsp)\r\n            {\r\n                if(rsp.resultcode != '000')\r\n                {\r\n                    rsp.resultmsg && topTip({msg: rsp.resultmsg, type: 'danger'});\r\n                    return;\r\n                }\r\n                shopID = shopID || rsp.data.records[0].shopID;\r\n                $shopSettingLink.attr('href', Hualala.PageRoute.createPath('setting'));\r\n                // 进入第二步标注地图\r\n                bsWizard.next();\r\n                // 地图对象必须在第二步面板显示出来后初始化\r\n                map = Hualala.Shop.map({data: {\r\n                    isSearchMap: true,\r\n                    shopName: dataStep1.shopName,\r\n                    tel: dataStep1.tel,\r\n                    address: dataStep1.address\r\n                }, searchBox: $searchBox});\r\n                \r\n            });\r\n            \r\n            return;\r\n        }\r\n        // 第二步\r\n        if($curStep.is('#tab2'))\r\n        {\r\n            var lng = map.mapPoint.lng, lat = map.mapPoint.lat,\r\n                mapInfo = {\r\n                    shopID: shopID,\r\n                    mapLongitudeValue: lng,\r\n                    mapLatitudeValue: lat,\r\n                    mapLongitudeValueBaiDu: lng,\r\n                    mapLatitudeValueBaiDu: lat\r\n                };\r\n            var callServer = G.setShopMap;\r\n            callServer(mapInfo, function(rsp)\r\n            {\r\n                if(rsp.resultcode != '000')\r\n                {\r\n                    rsp.resultmsg && topTip({msg: rsp.resultmsg, type: 'danger'});\r\n                    return;\r\n                }\r\n            });\r\n        }\r\n        bsWizard.next();\r\n    });\r\n    \r\n}\r\n// 初始化菜系下拉列表\r\nfunction initCuisines($cuisine1, $cuisine2, cityID)\r\n{\r\n    var callServer = G.getCuisines;\r\n    callServer({cityID: cityID}, function(rsp)\r\n    {\r\n        if(rsp.resultcode != '000')\r\n        {\r\n            rsp.resultmsg && topTip({msg: rsp.resultmsg, type: 'danger'});\r\n            return;\r\n        }\r\n        \r\n        fillSelectBox($cuisine1, rsp.data.records, 'cuisineID', 'cuisineName');\r\n        fillSelectBox($cuisine2, rsp.data.records, 'cuisineID', 'cuisineName', '--不限--');\r\n    });\r\n    \r\n}\r\n// 初始化地标下拉列表\r\nfunction initAreas($selectBox, cityID)\r\n{\r\n    var callServer = G.getAreas;\r\n    callServer({cityID: cityID}, function(rsp)\r\n    {\r\n        if(rsp.resultcode != '000')\r\n        {\r\n            rsp.resultmsg && topTip({msg: rsp.resultmsg, type: 'danger'});\r\n            return;\r\n        }\r\n        \r\n        fillSelectBox($selectBox, rsp.data.records, 'areaID', 'areaName');\r\n    });\r\n    \r\n}\r\n// 初始化城市下拉列表\r\nfunction initCities($selectBox)\r\n{\r\n    var callServer = G.getCities;\r\n    callServer({isActive: 1}, function(rsp)\r\n    {\r\n        if(rsp.resultcode != '000')\r\n        {\r\n            rsp.resultmsg && topTip({msg: rsp.resultmsg, type: 'danger'});\r\n            return;\r\n        }\r\n        \r\n        fillSelectBox($selectBox, rsp.data.records, 'cityID', 'cityName');\r\n    });\r\n    \r\n}\r\n// 设置下拉列表的项\r\nfunction fillSelectBox($selectBox, data, key, value, initialValue)\r\n{\r\n    var optionsHtml = '<option value=\"\">' + \r\n                      (initialValue || '--请选择--') + \r\n                      '</option>';\r\n    $.each(data, function (i, o)\r\n    {\r\n        optionsHtml += '<option value=\"' + \r\n                       o[key] + '\">' + \r\n                       o[value] + \r\n                       '</option>';\r\n    });\r\n        \r\n    $selectBox.empty().html(optionsHtml);\r\n}\r\n// 处理并获取下拉列表当前选择项的文本\r\nfunction getSelectText($select)\r\n{\r\n    return $select.find('option:selected').text().replace(/-/g, '');\r\n}\r\n\r\n})(jQuery, window);\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n;(function ($, window) {\r\nIX.ns('Hualala.Shop');\r\nvar G = Hualala.Global,\r\n    U = Hualala.UI,\r\n    S = Hualala.Shop,\r\n    topTip = U.TopTip,\r\n    parseForm = Hualala.Common.parseForm,\r\n    initMap = Hualala.Shop.map;\r\n// 初始化店铺店铺详情页面\r\nS.initInfo = function ($container, pageType, params)\r\n{\r\n    if(!params) return;\r\n    // 渲染店铺功能导航\r\n    var $shopFuncNav = S.createShopFuncNav(pageType, params, $container);\r\n    \r\n    var shopID = params, shopInfo = null,\r\n        $form = null, $city = null, $area = null, \r\n        $cuisine1 = null, $cuisine2 = null,\r\n        imagePath = '', $img = null,\r\n        imgHost = G.IMAGE_RESOURCE_DOMAIN + '/',\r\n        bv = null, map = null;\r\n    \r\n    G.getShopInfo({shopID : shopID}, function (rsp)\r\n    {\r\n        if(rsp.resultcode != '000')\r\n        {\r\n            rsp.resultmsg && topTip({msg: rsp.resultmsg, type: 'danger'});\r\n            return;\r\n        }\r\n        shopInfo = rsp.data.records[0];\r\n        \r\n        // 渲染店铺详情头部\r\n        S.createShopInfoHead(shopInfo, $container, function($shopInfoHead)\r\n        {\r\n            $shopFuncNav.before($shopInfoHead);\r\n        });\r\n        \r\n        var openTime = shopInfo.openingHours.split('-');\r\n        shopInfo.openingHoursStart = openTime[0];\r\n        shopInfo.openingHoursEnd = openTime[1];\r\n        shopInfo.operationModeName = shopInfo.operationMode == '1' ? '快餐' : '正餐';\r\n        \r\n        var tpl = Handlebars.compile(Hualala.TplLib.get('tpl_shop_info'));\r\n        $form = $(tpl(shopInfo)).appendTo($container);\r\n        $city = $form.find('#cityID'),\r\n        $area = $form.find('#areaID'),\r\n        $cuisine1 = $form.find('#cuisineID1'),\r\n        $cuisine2 = $form.find('#cuisineID2');\r\n        \r\n        // 初始化城市列表下拉框\r\n        $city.on('change', function (e, areaID, cuisineID1, cuisineID2)\r\n        {\r\n            var cityID = $(this).val();\r\n            if(!cityID) return;\r\n            \r\n            initAreas($area, cityID, areaID);\r\n            initCuisines($cuisine1, $cuisine2, cityID, cuisineID1, cuisineID2);\r\n            \r\n        });\r\n        initCities($city, shopInfo);\r\n        // 根据所选择的城市设置地标、菜系下拉列表\r\n        \r\n        // 初始化timepicker\r\n        $form.find('#openingHoursStart, #openingHoursEnd').timepicker({\r\n            minuteStep: 1,\r\n            showMeridian: false,\r\n            disableFocus : true,\r\n            showInputs : false\r\n        });\r\n        // 初始化表单验证\r\n        $form.bootstrapValidator({\r\n            fields: {\r\n                shopName: {\r\n                    message: '店铺名无效',\r\n                    validators: {\r\n                        notEmpty: {\r\n                            message: '店铺名不能为空'\r\n                        },\r\n                        stringLength: {\r\n                            min: 2,\r\n                            max: 100,\r\n                            message: '店铺名长度必须在2到100个字符之间'\r\n                        }\r\n                    }\r\n                },\r\n                cityID: {\r\n                    validators: { notEmpty: { message: '请选择店铺所在城市' } }\r\n                },\r\n                tel: {\r\n                    validators: {\r\n                        notEmpty: { message: '店铺电话不能为空' },\r\n                        telOrMobile: { message: '' }\r\n                    }\r\n                },\r\n                address: {\r\n                    validators: {\r\n                        notEmpty: { message: '店铺地址不能为空' },\r\n                        stringLength: {\r\n                            min: 6,\r\n                            max: 100,\r\n                            message: '地址长度必须在6到100个字符之间'\r\n                        }\r\n                    }\r\n                },\r\n                PCCL: {\r\n                    validators: {\r\n                        notEmpty: { message: '人均消费不能为空' },\r\n                        numeric: { message: '人均消费必须是金额数字' }\r\n                    }\r\n                },\r\n                operationMode: {\r\n                    validators: {\r\n                        notEmpty: { message: '请选择店铺运营模式' }\r\n                    }\r\n                },\r\n                openingHoursStart: {\r\n                    validators: {\r\n                        notEmpty: { message: '每天营业开始时间不能空' },\r\n                        time: { message: '' }\r\n                    }\r\n                },\r\n                openingHoursEnd: {\r\n                    validators: {\r\n                        notEmpty: { message: '每天营业结束时间不能空' },\r\n                        time: {\r\n                            message: '',\r\n                            startTimeField: 'openingHoursStart'\r\n                        }\r\n                    }\r\n                },\r\n                areaID: {\r\n                    validators: {\r\n                        notEmpty: { message: '请选择店铺所在地标' }\r\n                    }\r\n                },\r\n                cuisineID1: {\r\n                    validators: {\r\n                        notEmpty: { message: '请选择菜系1' }\r\n                    }\r\n                }\r\n            }\r\n        });\r\n        bv = $form.data('bootstrapValidator');\r\n        \r\n        var $uploadImg = $form.find('#uploadImg');\r\n        $img = $uploadImg.find('img');\r\n        imagePath = shopInfo.imagePath;\r\n        imagePath && $img.attr('src', imgHost + imagePath);\r\n        \r\n        map = initMap({data: {\r\n            isSearchMap: false,\r\n            shopName: shopInfo.shopName,\r\n            tel: shopInfo.tel,\r\n            address: shopInfo.address,\r\n            lng: shopInfo.mapLongitudeValueBaiDu,\r\n            lat: shopInfo.mapLatitudeValueBaiDu\r\n        }});\r\n        \r\n    });\r\n    // click 事件 delegate\r\n    $container.on('click', function(e)\r\n    {\r\n        var $target = $(e.target);\r\n        // 修改门头图\r\n        if($target.is('#uploadImg img, #uploadImg a'))\r\n        {\r\n            U.uploadImg({\r\n                onSuccess: function (imgPath, $dlg)\r\n                {\r\n                    imagePath = imgPath;\r\n                    $img.attr('src', imgHost + imgPath);\r\n                    $dlg.modal('hide');\r\n                }\r\n            });\r\n        }\r\n        // 重新标记地图\r\n        if($target.is('#remarkMap'))\r\n        {\r\n            if(bv.isValidField('shopName') && bv.isValidField('tel') && bv.isValidField('address'))\r\n            {\r\n                var coords = map.mapPoint,\r\n                    formData = parseForm($form);\r\n                map = initMap({data: {\r\n                    isSearchMap: false,\r\n                    shopName: formData.shopName,\r\n                    tel: formData.tel,\r\n                    address: formData.address,\r\n                    lng: coords.lng,\r\n                    lat: coords.lat\r\n                }});\r\n                \r\n                var mapInfo = {\r\n                        shopID: shopID,\r\n                        mapLongitudeValue: coords.lng,\r\n                        mapLatitudeValue: coords.lat,\r\n                        mapLongitudeValueBaiDu: coords.lng,\r\n                        mapLatitudeValueBaiDu: coords.lat\r\n                    };\r\n                // 标注店铺地图callServer调用\r\n                G.setShopMap(mapInfo, function(rsp)\r\n                {\r\n                    if(rsp.resultcode != '000')\r\n                    {\r\n                        rsp.resultmsg && topTip({msg: rsp.resultmsg, type: 'danger'});\r\n                        return;\r\n                    }\r\n                    \r\n                    topTip({msg: '重新标记地图成功！', type: 'success'});\r\n                    \r\n                });\r\n                \r\n            }\r\n            else\r\n            {\r\n                topTip({msg: '店铺相关信息填写有误！', type: 'danger'});\r\n            }\r\n            \r\n        }\r\n        // 切换为编辑模式\r\n        if($target.is('#editBtn'))\r\n        {\r\n            $form.removeClass('read-mode').addClass('edit-mode');\r\n        }\r\n        // 保存店铺基本信息修改\r\n        if($target.is('#saveBtn'))\r\n        {\r\n            if(!bv.validate().isValid()) return;\r\n            // 数据提交前预处理\r\n            var shopData = parseForm($form);\r\n            shopData.shopID = shopID;\r\n            shopData.shopName = shopData.shopName.replace('（', '(').replace('）', ')');\r\n            shopData.areaName = getSelectText($area);\r\n            shopData.cuisineName1 = getSelectText($cuisine1);\r\n            shopData.cuisineName2 = shopData.cuisineID2 ? getSelectText($cuisine2) : '';\r\n            shopData.imagePath = imagePath;\r\n            shopData.openingHours = shopData.openingHoursStart + '-' + shopData.openingHoursEnd;\r\n            var keywords = [shopData.shopName, shopData.address, shopData.cuisineName1];\r\n            shopData.cuisineName2 && keywords.push(shopData.cuisineName2);\r\n            keywords.push(shopData.areaName);\r\n            shopData.keywordLst = keywords.join(' | ');\r\n            // 保存店铺基本信息callServer调用\r\n            G.updateShopBaseInfo(shopData, function(rsp)\r\n            {\r\n                if(rsp.resultcode != '000')\r\n                {\r\n                    rsp.resultmsg && topTip({msg: rsp.resultmsg, type: 'danger'});\r\n                    return;\r\n                }\r\n                \r\n                $form.removeClass('edit-mode').addClass('read-mode');\r\n                topTip({msg: '保存成功！', type: 'success'});\r\n                updateReadMode($form, shopData);\r\n            });\r\n        }\r\n    });\r\n    \r\n}\r\n// 保存提交后更新店铺信息只读模式\r\nfunction updateReadMode($form, data)\r\n{\r\n    $form.find('input, select').not('.map-keyword, #openingHoursEnd').each(function ()\r\n    {\r\n        var $this = $(this),\r\n            $p = $this.siblings('p');\r\n        if($this.is('#openingHoursStart'))\r\n            $p.text(data.openingHours);\r\n        else if($this.is('select'))\r\n            $p.text(getSelectText($this));\r\n        else\r\n            $p.text($this.val());\r\n    });\r\n}\r\n// 初始化菜系下拉列表\r\nfunction initCuisines($cuisine1, $cuisine2, cityID, cuisineID1, cuisineID2)\r\n{\r\n    var callServer = G.getCuisines;\r\n    callServer({cityID: cityID}, function(rsp)\r\n    {\r\n        if(rsp.resultcode != '000')\r\n        {\r\n            rsp.resultmsg && topTip({msg: rsp.resultmsg, type: 'danger'});\r\n            return;\r\n        }\r\n        \r\n        fillSelectBox($cuisine1, rsp.data.records, 'cuisineID', 'cuisineName');\r\n        fillSelectBox($cuisine2, rsp.data.records, 'cuisineID', 'cuisineName', '--不限--');\r\n        cuisineID1 && $cuisine1.val(cuisineID1);\r\n        cuisineID2 && $cuisine2.val(cuisineID2);\r\n    });\r\n    \r\n}\r\n// 初始化地标下拉列表\r\nfunction initAreas($area, cityID, areaID)\r\n{\r\n    var callServer = G.getAreas;\r\n    callServer({cityID: cityID}, function(rsp)\r\n    {\r\n        if(rsp.resultcode != '000')\r\n        {\r\n            rsp.resultmsg && topTip({msg: rsp.resultmsg, type: 'danger'});\r\n            return;\r\n        }\r\n        \r\n        fillSelectBox($area, rsp.data.records, 'areaID', 'areaName');\r\n        areaID && $area.val(areaID);\r\n    });\r\n    \r\n}\r\n// 初始化城市下拉列表\r\nfunction initCities($city, shopInfo)\r\n{\r\n    var callServer = G.getCities;\r\n    callServer({isActive: 1}, function(rsp)\r\n    {\r\n        if(rsp.resultcode != '000')\r\n        {\r\n            rsp.resultmsg && topTip({msg: rsp.resultmsg, type: 'danger'});\r\n            return;\r\n        }\r\n        \r\n        fillSelectBox($city, rsp.data.records, 'cityID', 'cityName');\r\n        $city.val(shopInfo.cityID).trigger('change', [shopInfo.areaID, shopInfo.cuisineID1, shopInfo.cuisineID2]);\r\n    });\r\n    \r\n}\r\n// 设置下拉列表的项\r\nfunction fillSelectBox($selectBox, data, key, value, initialValue)\r\n{\r\n    var optionsHtml = '<option value=\"\">' + \r\n                      (initialValue || '--请选择--') + \r\n                      '</option>';\r\n    $.each(data, function (i, o)\r\n    {\r\n        optionsHtml += '<option value=\"' + \r\n                       o[key] + '\">' + \r\n                       o[value] + \r\n                       '</option>';\r\n    });\r\n        \r\n    $selectBox.empty().html(optionsHtml);\r\n}\r\n// 处理并获取下拉列表当前选择项的文本\r\nfunction getSelectText($select)\r\n{\r\n    return $select.find('option:selected').text().replace(/-/g, '');\r\n}\r\n\r\n})(jQuery, window);\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n;(function ($, window) {\r\nIX.ns('Hualala.Shop');\r\nvar G = Hualala.Global,\r\n    U = Hualala.UI,\r\n    S = Hualala.Shop,\r\n    topTip = U.TopTip,\r\n    parseForm = Hualala.Common.parseForm;\r\n// 初始化店铺店铺菜品页面\r\nS.initShopMenu = function ($container, pageType, params)\r\n{\r\n    if(!params) return;\r\n    \r\n}\r\n\r\n})(jQuery, window);\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n;\r\n;(function($) \r\n{\r\n\tvar defaults = {\r\n            data : {\r\n                isSearchMap: false,\r\n                keyword: '',\r\n                shopName: '',\r\n                tel: '',\r\n                address: '',\r\n                city: '',\r\n                area: '',\r\n                lng: '',\r\n                lat: ''\r\n            },\r\n            searchBox: '.map-search-box',\r\n            mapResult: '.map-result',\r\n            //mapContainer: '#shopMap',\r\n            mapCanvasId: 'mapCanvas',\r\n            load: function() { },\r\n            serach: function() { }\r\n        };\r\n\tfunction ShopMap(options)\r\n    {\r\n        this.cfg = $.extend({}, defaults, options);\r\n        //this.$shopMap = $(mapContainer);\r\n        this.sContent = '';\r\n        this.$searchBox = $(this.cfg.searchBox);\r\n        this.$mapResult = $(this.cfg.mapResult);\r\n        this.map = '';\r\n        this.searchArea = true;\r\n        this.mapPoint = {};\r\n        \r\n    }\r\n\tShopMap.prototype = \r\n    {\r\n        init: function()\r\n        {\r\n            var self = this,\r\n                markerTrick = false,\r\n                mapParams = self.cfg.data;\r\n            self.map = new BMap.Map(self.cfg.mapCanvasId);\r\n            //添加默认缩放平移控件\r\n            self.map.addControl(new BMap.NavigationControl());\r\n            self.map.enableScrollWheelZoom();\r\n            self.sContent = [\r\n                '<dl class=\"map-shop-info\">',\r\n                    '<dt>' + mapParams.shopName + '</dt>',\r\n                    '<dd>',\r\n                        '<p><span>电话：</span>' + mapParams.tel + '</p>',\r\n                        '<p><span>地址：</span>' + mapParams.address + '</p>',\r\n                    '</dd>',\r\n                '</dl>'\r\n            ].join('');\r\n            \r\n            self[(mapParams.isSearchMap || !mapParams.lng || !mapParams.lat ? 'search' : 'load') + 'Map'](mapParams);\r\n            \r\n            if(self.$searchBox[0])\r\n            {\r\n                var $keyword = self.$searchBox.find('.map-keyword'),\r\n                    $searchBtn = self.$searchBox.find('.map-search-btn'),\r\n                    searchParams = $.extend({}, self.cfg.data);\r\n                $searchBtn.on('click', function ()\r\n                {\r\n                    searchParams.keyword = $keyword.val();\r\n                    self.searchMap(searchParams);\r\n                });\r\n            }\r\n            \r\n            \r\n            return this;\r\n        },\r\n        loadMap: function(data)\r\n        {\r\n            var self = this;\r\n            data = data || self.self.cfg.data;\r\n            self.map.centerAndZoom(new BMap.Point(data.lng, data.lat), 14);\r\n            self.map.enableScrollWheelZoom();\r\n\r\n            var marker = new BMap.Marker(new BMap.Point(data.lng, data.lat), \r\n                {\r\n                    enableMassClear: true,\r\n                    raiseOnDrag: true\r\n                });\r\n            marker.enableDragging();\r\n            self.map.addOverlay(marker);\r\n            marker.openInfoWindow(new BMap.InfoWindow(self.sContent));\r\n           /* map.addEventListener(\"click\", function(e){\r\n                if(!(e.overlay)){\r\n                    map.clearOverlays();\r\n                    marker.show();\r\n                    map.addOverlay(marker);\r\n                    marker.setPosition(e.point);\r\n                    setResult(e.point.lng, e.point.lat);\r\n                }\r\n            });*/\r\n            marker.addEventListener(\"click\", function(e)\r\n            {\r\n                 marker.openInfoWindow(new BMap.InfoWindow(self.sContent));\r\n            });\r\n            marker.addEventListener(\"dragend\", function(e)\r\n            {\r\n                self.setResult(e.point.lng, e.point.lat);\r\n            });\r\n            self.setResult(data.lng, data.lat);\r\n        },\r\n        searchMap : function (data)\r\n        {\r\n            var self = this;\r\n            data = data || self.cfg.data;\r\n            //self.map.centerAndZoom(new BMap.Point(116.404, 39.915), 14);\r\n            //self.map.enableScrollWheelZoom();\r\n                \r\n            var local = new BMap.LocalSearch(self.map, {\r\n                renderOptions: {map: self.map},\r\n                pageCapacity: 1,\r\n                onInfoHtmlSet : function (poi) {\r\n                    poi.marker.openInfoWindow(new BMap.InfoWindow(self.sContent));\r\n                    //target.openInfoWindow(infoWindow);\r\n                },\r\n                onMarkersSet : function (poi) {\r\n                    //console.info(poi.marker.infoWindow);\r\n                }\r\n            });\r\n            local.search(data.keyword || data.address || data.area || data.city);\r\n\r\n            local.setSearchCompleteCallback(function(results)\r\n            {\r\n                if(local.getStatus() !== BMAP_STATUS_SUCCESS)\r\n                {\r\n                    if(self.searchArea)\r\n                    {\r\n                        local.search(data.area);\r\n                        self.searchArea = false;\r\n                    } else\r\n                    {\r\n                        local.search(data.city);\r\n                    }\r\n                } else \r\n                {\r\n                    //marker.hide();\r\n                }\r\n            });\r\n            local.setMarkersSetCallback(function(pois)\r\n            {\r\n                for(var i = pois.length; i--;)\r\n                {\r\n                    var marker = pois[i].marker;\r\n                    marker.enableDragging();\r\n                    self.setResult(marker.point.lng, marker.point.lat);\r\n                    //var mapParams = {\r\n                    //  width : 250,     // 信息窗口宽度\r\n                    //  height: 100,     // 信息窗口高度\r\n                    //  title : \"Hello\"  // 信息窗口标题\r\n                    //}\r\n                    //var infoWindow = new BMap.InfoWindow(\"World\", mapParams);  // 创建信息窗口对象\r\n                    //map.openInfoWindow(infoWindow,point); //开启信息窗口\r\n                    marker.openInfoWindow(new BMap.InfoWindow(self.sContent));\r\n                    marker.addEventListener(\"click\", function(e)\r\n                    {\r\n                       // markerTrick = true;\r\n                        var pos = this.getPosition();\r\n                        self.setResult(pos.lng, pos.lat);\r\n                    });\r\n                    marker.addEventListener(\"dragend\", function(e)\r\n                    {\r\n                        self.setResult(e.point.lng, e.point.lat);\r\n                    });\r\n                }\r\n            });\r\n            \r\n        },\r\n         /*\r\n         * setResult : 定义得到标注经纬度后的操作\r\n         * 请修改此函数以满足您的需求\r\n         * lng: 标注的经度\r\n         * lat: 标注的纬度\r\n         */\r\n        setResult: function (lng, lat)\r\n        {\r\n            var self = this;\r\n            self.mapPoint = { lng: lng, lat: lat };\r\n            self.$mapResult[0] && self.$mapResult.html('您店铺的经度：' + lng + '    纬度： ' + lat);\r\n        }\r\n\t}\r\n    IX.ns(\"Hualala.Shop\");\r\n    Hualala.Shop.map = function(options) \r\n    { \r\n        return new ShopMap(options).init(); \r\n    };\r\n}(jQuery));\r\n\r\n\r\n\r\n\r\n\r\n\r\n;(function ($, window) {\r\n\t\r\n})(jQuery, window);;(function ($, window) {\r\n\tIX.ns(\"Hualala.Shop\");\r\n    /**\r\n\t  * 渲染店铺详情页头部\r\n\t  * @param {Object | String} shopInfo 店铺ID或者店铺详情信息对象\r\n\t  * @param {jQuery Object} container  容器\r\n      * @param {function} callback  回调函数，参数是店铺详情头部的jQuery对象\r\n\t  * @return {NULL} \r\n\t  */\r\n    Hualala.Shop.createShopInfoHead = function(shopInfo, container, callback)\r\n    {\r\n        var $container = container || $('#ix_wrapper > .ix-body > .container'),\r\n            $shopInfoHead = $('<div class=\"bs-callout shop-info-head\"></div>');\r\n        !callback && $shopInfoHead.appendTo($container);\r\n        \r\n        var fn = function (shopInfo)\r\n        {\r\n            var tplData = {\r\n                    shopName: shopInfo.shopName,\r\n                    shopUrl: Hualala.Common.getShopUrl(shopInfo.shopID),\r\n                    shopListLink: Hualala.PageRoute.createPath('shop'),\r\n                    checked: shopInfo.status == 1 ? 'checked' : ''\r\n                };\r\n            \r\n            var tpl = Handlebars.compile(Hualala.TplLib.get('tpl_shop_info_head'));\r\n            \r\n            $shopInfoHead.append($(tpl(tplData))).find('input').bootstrapSwitch({\r\n                onColor : 'success',\r\n                onText : '已开通',\r\n                offText : '未开通'\r\n            }).on('switchChange.bootstrapSwitch', function (e, state)\r\n            {//店铺状态切换\r\n                var $chkbox = $(this);\r\n                Hualala.Global.switchShopStatus({shopID: shopInfo.shopID, status: state}, function (rsp)\r\n                {\r\n                    if(rsp.resultcode != '000')\r\n                    {\r\n                        $chkbox.bootstrapSwitch('toggleState', true);\r\n                        rsp.resultmsg && Hualala.UI.TopTip({msg: rsp.resultmsg, type: 'danger'});\r\n                        return;\r\n                    }\r\n                });\r\n\t\t\t});;\r\n            //重置客户端密码\r\n            $shopInfoHead.find('#resetPwd').on('click', function ()\r\n            {\r\n                var resetPwdTpl = Handlebars.compile(Hualala.TplLib.get('tpl_set_shop_client_pwd'));\r\n                var $resetPwdForm = $(resetPwdTpl(shopInfo));\r\n                //弹出重置客户端密码模态框\r\n                var modal = new Hualala.UI.ModalDialog({\r\n                    id: 'resetCltPwdDlg',\r\n                    title: '重置客户端密码',\r\n                    html: $resetPwdForm,\r\n                    sizeCls: 'modal-sm',\r\n                    hideCloseBtn: false\r\n                }).show();\r\n                var $feedback = $resetPwdForm.find('.has-feedback'),\r\n                    $feedbackIcon = $feedback.find('.form-control-feedback'),\r\n                    $errMsg = $feedback.find('small');\r\n                var $pwd = $resetPwdForm.find('#shopClinetPwd').data('validate', false).on('blur', function ()\r\n                {//验证密码输入\r\n                    var $this = $(this),\r\n                        l = $.trim($this.val()).length;\r\n                    $this.data('validate', false);\r\n                    if(!l)\r\n                        $errMsg.text('密码不能为空');\r\n                    else if(l < 6 || l > 16)\r\n                        $errMsg.text('密码长度必须在6到16个字符之间');\r\n                    else\r\n                    {\r\n                        $errMsg.text('');\r\n                        $this.data('validate', true);\r\n                    }\r\n                        \r\n                    var isValid = $this.data('validate');\r\n                    $feedback.toggleClass('has-success', isValid).toggleClass('has-error', !isValid);\r\n                    $feedbackIcon.toggleClass('glyphicon-ok', isValid).toggleClass('glyphicon-remove', !isValid);\r\n                });\r\n                //密码/明文切换\r\n                $resetPwdForm.find('#showPwd').change(function()\r\n                {\r\n                    $pwd.attr('type', this.checked ? 'text' : 'password');\r\n                });\r\n                //提交密码重设请求\r\n                modal._.footer.find('.btn-ok').on('click', function ()\r\n                {\r\n                    if(!$pwd.trigger('blur').data('validate')) return;\r\n                    \r\n                    Hualala.Global.setShopClientPwd({shopID: shopInfo.shopID, hLLAgentLoginPWD: $pwd.val()}, function (rsp)\r\n                    {\r\n                        if(rsp.resultcode != '000')\r\n                        {\r\n                            rsp.resultmsg && Hualala.UI.TopTip({msg: rsp.resultmsg, type: 'danger'});\r\n                            return;\r\n                        }\r\n                        modal.hide();\r\n                        Hualala.UI.TopTip({msg: '重置客户端密码成功！', type: 'success'});\r\n                    });\r\n                    \r\n                });\r\n                \r\n            });\r\n            //执行回调函数\r\n            callback && callback($shopInfoHead);\r\n        };\r\n        //如果是参数shopInfo是店铺详情对象\r\n        if($.isPlainObject(shopInfo))\r\n        {\r\n            fn(shopInfo);\r\n            return;\r\n        }\r\n        //如果参数shopInfo是shopID，发送ajax获取店铺详情信息\r\n        Hualala.Global.getShopInfo({shopID: shopInfo}, function (rsp)\r\n        {\r\n            if(rsp.resultcode != '000')\r\n            {\r\n                rsp.resultmsg && Hualala.UI.TopTip({msg: rsp.resultmsg, type: 'danger'});\r\n                return;\r\n            }\r\n            var shopInfo = rsp.data.records[0];\r\n            fn(shopInfo);\r\n        });\r\n        \r\n    };\r\n    \r\n    // 店铺详情页功能导航\r\n    Hualala.Shop.createShopFuncNav = function (currentPageName, shopID, container)\r\n    {\r\n        var shopFuncs = ['shopInfo', 'shopMenu'],\r\n            R = Hualala.PageRoute,\r\n            $ul = $('<ul class=\"nav navbar-nav\"></ul>'),\r\n            $container = container || $('#ix_wrapper > .ix-body > .container');\r\n        \r\n        for(i = 0, l = shopFuncs.length; i < l; i++)\r\n        {\r\n            var shopFunc = shopFuncs[i],\r\n                isActive = shopFunc == currentPageName,\r\n                path = isActive ? 'javascript:;' : R.createPath(shopFunc, [shopID]),\r\n                label = R.getPageLabelByName(shopFunc);\r\n            \r\n            $('<li></li>').toggleClass('active', isActive).append($('<a></a>').attr('href', path).text(label)).appendTo($ul);\r\n        }\r\n        \r\n        return $('<div class=\"navbar navbar-default shop-func-nav\"></div>').append($ul).appendTo($container);\r\n    };\r\n    \r\n\tvar initShopList = function (pageType, params) {\r\n        var $body = $('#ix_wrapper > .ix-body > .container');\r\n\t\tvar queryPanel = new Hualala.Shop.QueryController({\r\n\t\t\tneedShopCreate : true,\r\n\t\t\tcontainer : $body,\r\n\t\t\tresultController : new Hualala.Shop.ShopListController({\r\n\t\t\t\tcontainer : $body,\r\n\t\t\t\tmodel : new Hualala.Shop.CardListModel({callServer : Hualala.Global.queryShop}),\r\n\t\t\t\tview : new Hualala.Shop.CardListView()\r\n\t\t\t})\r\n\t\t});\r\n\t\t// TODO 店铺管理首页，店铺查询及列表展示页面\r\n\t};\r\n\tHualala.Shop.HomePageInit = initShopList;\r\n\r\n\tvar initShopBaseInfoMgr = function (pageType, params) {\r\n        var $body = $('#ix_wrapper > .ix-body > .container');\r\n        Hualala.UI.BreadCrumb({\r\n            container: $body,\r\n            hideRoot: true,\r\n            nodes: Hualala.PageRoute.getParentNamesByPath()\r\n        });\r\n\t\tHualala.Shop.initInfo($body, pageType, params);\r\n\t};\r\n\tHualala.Shop.BaseInfoMgrInit = initShopBaseInfoMgr;\r\n\r\n\tvar initFoodMenuMgr = function (pageType, params) {\r\n\t\tvar $body = $('#ix_wrapper > .ix-body > .container');\r\n\t\t$body.html(\r\n\t\t\t'<div class=\"jumbotron\">'+\r\n\t\t\t\t'<h1>这里是店铺菜谱管理页面</h1>' +\r\n\t\t\t\t'<p>提供查看店铺菜谱信息，编辑店铺菜谱信息</p>' +\r\n\t\t\t\t\r\n\t\t\t'</div>'\r\n\t\t\t);\r\n\t\t// TODO 查看店铺菜谱信息，编辑店铺菜谱信息\r\n\t};\r\n\tHualala.Shop.FoodMenuMgrInit = initFoodMenuMgr;\r\n\r\n\tvar initCreateShop = function (pageType, params) {\r\n\t\tvar $body = $('#ix_wrapper > .ix-body > .container');\r\n        Hualala.UI.BreadCrumb({\r\n            container: $body,\r\n            hideRoot: true,\r\n            nodes: Hualala.PageRoute.getParentNamesByPath()\r\n        });\r\n        var tpl = Handlebars.compile(Hualala.TplLib.get('tpl_shop_create')),\r\n            $shopCreateWizard = $(tpl({\r\n                pcClientPath: Hualala.PageRoute.createPath('pcclient')\r\n            }));\r\n\t\t$body.append($shopCreateWizard);\r\n        Hualala.Shop.initCreate($shopCreateWizard);\r\n\t\t\r\n\t};\r\n\tHualala.Shop.CreateShopInit = initCreateShop;\r\n\r\n\t\r\n})(jQuery, window);;(function ($, window) {\r\n\tIX.ns(\"Hualala.Setting\");\r\n\tvar popoverMsg = Hualala.UI.PopoverMsgTip;\r\n\tvar toptip = Hualala.UI.TopTip;\r\n\tvar ServiceFormElsCfg = {\r\n\t\tadvanceTime : {\r\n\t\t\ttype : 'combo',\r\n\t\t\tlabel : '用户提前预订时间',\r\n\t\t\tdefaultVal : 0,\r\n\t\t\tprefix : '$',\r\n\t\t\tsurfix : '元',\r\n\t\t\toptions : Hualala.TypeDef.MinuteIntervalOptions(),\r\n\t\t\tvalidCfg : {\r\n\t\t\t\tvalidators : {\r\n\t\t\t\t\tnotEmpty : {\r\n\t\t\t\t\t\tmessage : \"用户提前预订时间不能为空\"\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\tnoticeTime : {\r\n\t\t\ttype : 'combo',\r\n\t\t\tlabel : '订单提前通知时间',\r\n\t\t\tdefaultVal : 0,\r\n\t\t\toptions : Hualala.TypeDef.MinuteIntervalOptions(),\r\n\t\t\tvalidCfg : {\r\n\t\t\t\tvalidators : {\r\n\t\t\t\t\tnotEmpty : {\r\n\t\t\t\t\t\tmessage : \"订单提前通知时间不能为空\"\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\tminAmount : {\r\n\t\t\ttype : 'text',\r\n\t\t\tlabel : '最低消费金额',\r\n\t\t\tprefix : '￥',\r\n\t\t\tsurfix : '元',\r\n\t\t\tdefaultVal : 0,\r\n\t\t\tvalidCfg : {\r\n\t\t\t\tvalidators : {\r\n\t\t\t\t\tnotEmpty : {\r\n\t\t\t\t\t\tmessage : \"最低消费金额不能为空\"\r\n\t\t\t\t\t},\r\n\t\t\t\t\tnumeric : {\r\n\t\t\t\t\t\tmessage: \"最低消费金额必须为数字\"\r\n\t\t\t\t\t},\r\n\t\t\t\t\tgreaterThan : {\r\n\t\t\t\t\t\tinclusive : true,\r\n\t\t\t\t\t\tvalue : 0,\r\n\t\t\t\t\t\tmessage : \"最低消费金额必须大于或等于0\"\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\tserviceAmount : {\r\n\t\t\ttype : 'text',\r\n\t\t\tlabel : '服务费',\r\n\t\t\tprefix : '￥',\r\n\t\t\tsurfix : '元',\r\n\t\t\tdefaultVal : 0,\r\n\t\t\tvalidCfg : {\r\n\t\t\t\tvalidators : {\r\n\t\t\t\t\tnumeric : {\r\n\t\t\t\t\t\tmessage: \"服务费必须为数字\"\r\n\t\t\t\t\t},\r\n\t\t\t\t\tgreaterThan : {\r\n\t\t\t\t\t\tinclusive : true,\r\n\t\t\t\t\t\tvalue : 0,\r\n\t\t\t\t\t\tmessage : \"服务费必须大于或等于0\"\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\tfreeServiceAmount : {\r\n\t\t\ttype : 'text',\r\n\t\t\tlabel : '免服务费菜品金额',\r\n\t\t\tprefix : '￥',\r\n\t\t\tsurfix : '元',\r\n\t\t\tdefaultVal : 0,\r\n\t\t\tvalidCfg : {\r\n\t\t\t\tvalidators : {\r\n\t\t\t\t\tnumeric : {\r\n\t\t\t\t\t\tmessage: \"免服务费菜品金额必须为数字\"\r\n\t\t\t\t\t},\r\n\t\t\t\t\tgreaterThan : {\r\n\t\t\t\t\t\tinclusive : true,\r\n\t\t\t\t\t\tvalue : 0,\r\n\t\t\t\t\t\tmessage : \"免服务费菜品金额必须大于或等于0\"\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\tholidayFlag : {\r\n\t\t\ttype : 'combo',\r\n\t\t\tlabel : '节假日开放',\r\n\t\t\tdefaultVal : 0,\r\n\t\t\toptions : Hualala.TypeDef.HolidayFlagOptions,\r\n\t\t\tvalidCfg : {\r\n\t\t\t\tvalidators : {\r\n\t\t\t\t\tnotEmpty : {\r\n\t\t\t\t\t\tmessage : \"节假日开放不能为空\"\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\topenDays : {\r\n\t\t\ttype : 'text',\r\n\t\t\tlabel : '开放服务天数',\r\n\t\t\tsurfix : '天',\r\n\t\t\tdefaultVal : '',\r\n\t\t\tvalidCfg : {\r\n\t\t\t\tvalidators : {\r\n\t\t\t\t\tnotEmpty : {\r\n\t\t\t\t\t\tmessage : \"开放服务天数不能为空\"\r\n\t\t\t\t\t},\r\n\t\t\t\t\tdigits : {\r\n\t\t\t\t\t\tmessage: \"开放服务天数必须为数字\"\r\n\t\t\t\t\t},\r\n\t\t\t\t\tgreaterThan : {\r\n\t\t\t\t\t\tinclusive : true,\r\n\t\t\t\t\t\tvalue : 0,\r\n\t\t\t\t\t\tmessage : \"开放服务天数必须大于或等于0\"\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\tservicePeriods : {\r\n\t\t\ttype : 'section',\r\n\t\t\tlabel : '开放时段',\r\n\t\t\tmin : {\r\n\t\t\t\ttype : 'timepicker',\r\n\t\t\t\tsurfix : '<span class=\"glyphicon glyphicon-time\"></span>',\r\n\t\t\t\tdefaultVal : '',\r\n\t\t\t\tvalidCfg : {\r\n\t\t\t\t\tgroup : '.min-input',\r\n\t\t\t\t\tvalidators : {\r\n\t\t\t\t\t\tnotEmpty : {\r\n\t\t\t\t\t\t\tmessage : \"起始时间不能为空\"\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tmax : {\r\n\t\t\t\ttype : 'timepicker',\r\n\t\t\t\tsurfix : '<span class=\"glyphicon glyphicon-time\"></span>',\r\n\t\t\t\tdefaultVal : '',\r\n\t\t\t\tvalidCfg : {\r\n\t\t\t\t\tgroup : '.max-input',\r\n\t\t\t\t\tvalidators : {\r\n\t\t\t\t\t\tnotEmpty : {\r\n\t\t\t\t\t\t\tmessage : \"结束时间不能为空\"\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\treserveTableTime : {\r\n\t\t\ttype : 'combo',\r\n\t\t\tlabel : '留位时间',\r\n\t\t\tdefaultVal : 0,\r\n\t\t\toptions : Hualala.TypeDef.MinuteIntervalOptions(60),\r\n\t\t\tvalidCfg : {\r\n\t\t\t\tvalidators : {\r\n\t\t\t\t\tnotEmpty : {\r\n\t\t\t\t\t\tmessage : \"留位时间不能为空\"\r\n\t\t\t\t\t},\r\n\t\t\t\t\tnumeric : {\r\n\t\t\t\t\t\tmessage: \"留位时间必须为数字\"\r\n\t\t\t\t\t},\r\n\t\t\t\t\tgreaterThan : {\r\n\t\t\t\t\t\tinclusive : true,\r\n\t\t\t\t\t\tvalue : 0,\r\n\t\t\t\t\t\tmessage : \"留位时间必须大于或等于0\"\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\treserveTableDesc : {\r\n\t\t\ttype : 'text',\r\n\t\t\tlabel : '留位特别说明',\r\n\t\t\tdefaultVal : '',\r\n\t\t\tvalidCfg : {\r\n\t\t\t\tvalidators : {\r\n\t\t\t\t\tstringLength : {\r\n\t\t\t\t\t\tmax : 40,\r\n\t\t\t\t\t\tmessage : '留位特别说明不能超过40个字'\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\ttakeawayDeliveryAgent : {\r\n\t\t\ttype : 'text',\r\n\t\t\tlabel : '配送单位',\r\n\t\t\tdefaultVal : '自助配送',\r\n\t\t\tvalidCfg : {}\r\n\t\t},\r\n\t\ttakeawayDeliveryTime : {\r\n\t\t\ttype : 'text',\r\n\t\t\tlabel : '预计送餐所需时间',\r\n\t\t\tsurfix : '分钟',\r\n\t\t\tdefaultVal : '',\r\n\t\t\tvalidCfg : {\r\n\t\t\t\tvalidators : {\r\n\t\t\t\t\tnotEmpty : {\r\n\t\t\t\t\t\tmessage : \"预计送餐所需时间不能为空\"\r\n\t\t\t\t\t},\r\n\t\t\t\t\tnumeric : {\r\n\t\t\t\t\t\tmessage: \"预计送餐所需时间必须为数字\"\r\n\t\t\t\t\t},\r\n\t\t\t\t\tgreaterThan : {\r\n\t\t\t\t\t\tinclusive : true,\r\n\t\t\t\t\t\tvalue : 0,\r\n\t\t\t\t\t\tmessage : \"预计送餐所需时间必须大于或等于0\"\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\ttakeawayScope : {\r\n\t\t\ttype : 'text',\r\n\t\t\tlabel : '送餐范围',\r\n\t\t\tsurfix : '公里',\r\n\t\t\tdefaultVal : '',\r\n\t\t\tvalidCfg : {\r\n\t\t\t\tvalidators : {\r\n\t\t\t\t\tnotEmpty : {\r\n\t\t\t\t\t\tmessage : \"送餐范围不能为空\"\r\n\t\t\t\t\t},\r\n\t\t\t\t\tnumeric : {\r\n\t\t\t\t\t\tmessage: \"送餐范围必须为数字\"\r\n\t\t\t\t\t},\r\n\t\t\t\t\tgreaterThan : {\r\n\t\t\t\t\t\tinclusive : true,\r\n\t\t\t\t\t\tvalue : 0,\r\n\t\t\t\t\t\tmessage : \"送餐范围必须大于或等于0\"\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\ttakeawayScopeDesc : {\r\n\t\t\ttype : 'text',\r\n\t\t\tlabel : '送餐范围说明',\r\n\t\t\tdefaultVal : '',\r\n\t\t\tvalidCfg : {\r\n\t\t\t\tvalidators : {\r\n\t\t\t\t\tstringLength : {\r\n\t\t\t\t\t\tmax : 200,\r\n\t\t\t\t\t\tmessage : '送餐范围说明不能超过200个字'\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\tsubmitSMSTemplateID : {\r\n\t\t\ttype : 'hidden',\r\n\t\t\tdefaultVal : ''\r\n\t\t},\r\n\t\tcheckSMSTemplateID : {\r\n\t\t\ttype : 'hidden',\r\n\t\t\tdefaultVal : ''\r\n\t\t},\r\n\t\tpayMethod : {\r\n\t\t\ttype : 'combo',\r\n\t\t\tlabel : '可选支付方式',\r\n\t\t\tdefaultVal : 0,\r\n\t\t\toptions : Hualala.TypeDef.PayMethodOptions,\r\n\t\t\tvalidCfg : {\r\n\t\t\t\tvalidators : {\r\n\t\t\t\t\tnotEmpty : {\r\n\t\t\t\t\t\tmessage : \"可选支付方式不能为空\"\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\tneedInputTableName : {\r\n\t\t\ttype : 'switcher',\r\n\t\t\tlabel : '下单时输入桌号',\r\n\t\t\tdefaultVal : 1,\r\n\t\t\tonLabel : '需要',\r\n\t\t\toffLabel : '不需要',\r\n\t\t\tvalidCfg : {\r\n\t\t\t\tvalidators : {\r\n\t\t\t\t\t\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\tsupportInvoice : {\r\n\t\t\ttype : 'switcher',\r\n\t\t\tlabel : '提供发票',\r\n\t\t\tdefaultVal : 1,\r\n\t\t\tonLabel : '需要',\r\n\t\t\toffLabel : '不需要',\r\n\t\t\tvalidCfg : {\r\n\t\t\t\tvalidators : {\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t\r\n\t\t},\r\n\t\tsupportCommitToSoftware : {\r\n\t\t\ttype : 'switcher',\r\n\t\t\tlabel : '下单到餐饮软件',\r\n\t\t\tdefaultVal : 1,\r\n\t\t\tonLabel : '支持',\r\n\t\t\toffLabel : '不支持',\r\n\t\t\tvalidCfg : {\r\n\t\t\t\tvalidators : {\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\tpayMethodAtShop : {\r\n\t\t\ttype : 'combo',\r\n\t\t\tlabel : '店内支付方式',\r\n\t\t\tdefaultVal : 0,\r\n\t\t\toptions : Hualala.TypeDef.PayMethodAtShopOptions,\r\n\t\t\tvalidCfg : {\r\n\t\t\t\tvalidators : {\r\n\t\t\t\t\tnotEmpty : {\r\n\t\t\t\t\t\tmessage : \"店内支付方式不能为空\"\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\tpayBeforeCommit : {\r\n\t\t\ttype : 'switcher',\r\n\t\t\tlabel : '支付完成后能下单',\r\n\t\t\tdefaultVal : 1,\r\n\t\t\tonLabel : '支持',\r\n\t\t\toffLabel : '不支持',\r\n\t\t\tvalidCfg : {\r\n\t\t\t\tvalidators : {\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t\r\n\t\t},\r\n\t\tfetchFoodMode : {\r\n\t\t\ttype : 'combo',\r\n\t\t\tlabel : '取餐模式',\r\n\t\t\tdefaultVal : 0,\r\n\t\t\toptions : Hualala.TypeDef.FetchFoodModeOptions,\r\n\t\t\tvalidCfg : {\r\n\t\t\t\tvalidators : {\r\n\t\t\t\t\tnotEmpty : {\r\n\t\t\t\t\t\tmessage : \"取餐模式不能为空\"\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n\tvar ServiceFormElsHT = new IX.IListManager();\r\n\t_.each(ServiceFormElsCfg, function (el, k) {\r\n\t\tvar type = $XP(el, 'type');\r\n\t\tvar labelClz = 'col-sm-offset-1 col-sm-3 control-label';\r\n\t\tif (type == 'section') {\r\n\t\t\tvar id = minID = k + '_min_' + IX.id(), maxID = k + '_max_' + IX.id(),\r\n\t\t\t\tminName = k + '_min', maxName = k + '_max',\r\n\t\t\t\tmin = IX.inherit($XP(el, 'min', {}), {\r\n\t\t\t\t\tid : minID, name : minName, clz : 'col-sm-3',\r\n\t\t\t\t}), max = IX.inherit($XP(el, 'max', {}), {\r\n\t\t\t\t\tid : maxID, name : maxName, clz : 'col-sm-3',\r\n\t\t\t\t});\r\n\t\t\tServiceFormElsHT.register(k, IX.inherit(el, {\r\n\t\t\t\tid : id,\r\n\t\t\t\tlabelClz : labelClz,\r\n\t\t\t\tmin : min,\r\n\t\t\t\tmax : max\r\n\t\t\t}));\r\n\t\t} else {\r\n\t\t\tServiceFormElsHT.register(k, IX.inherit(el, {\r\n\t\t\t\tid : k + '_' + IX.id(),\r\n\t\t\t\tname : k,\r\n\t\t\t\tlabelClz : labelClz,\r\n\t\t\t\tclz : 'col-sm-5'\r\n\t\t\t}));\r\n\t\t}\r\n\t});\r\n\t\r\n\tvar editServiceView = Stapes.subclass({\r\n\t\t/**\r\n\t\t * 编辑业务详情\r\n\t\t * @param  {Object} cfg {triggerEl, serviceID, serviceName, model}\r\n\t\t *              @param {jQueryObj} triggerEl 触发元素 \r\n\t\t *              @param {String} serviceID 业务ID\r\n\t\t *              @param {String} serviceName 业务名称\r\n\t\t *              @param {Object} model 店铺数据模型\r\n\t\t * @return {NULL}    \r\n\t\t */\r\n\t\tconstructor : function (cfg) {\r\n\t\t\tthis.$trigger = $XP(cfg, 'triggerEl');\r\n\t\t\tthis.serviceID = $XP(cfg, 'serviceID', null);\r\n\t\t\tthis.serviceName = $XP(cfg, 'serviceName', null);\r\n\t\t\tthis.model = $XP(cfg, 'model', null);\r\n\t\t\tthis.serviceList = Hualala.TypeDef.ShopBusiness;\r\n\t\t\tthis.modal = null;\r\n\t\t\tif (!this.serviceID || !this.serviceName || !this.model) {\r\n\t\t\t\tthrow(\"Service View init failed!\");\r\n\t\t\t}\r\n\t\t\tthis.loadTemplates();\r\n\t\t\tthis.serviceInfo = this.getServiceInfo('id', this.serviceID);\r\n\t\t\tthis.callServer = $XP(this.serviceInfo, 'callServer', '');\r\n\t\t\tif (IX.isFn(this.callServer)) {\r\n\t\t\t\tthis.callServer = this.callServer;\r\n\t\t\t} else if (!IX.isString(this.callServer)) {\r\n\t\t\t\tthrow(\"Configuration failed : Invalid Page Initialized for \" + this.callServer);\r\n\t\t\t\treturn false;\r\n\t\t\t} else if (IX.nsExisted(this.callServer)) {\r\n\t\t\t\tthis.callServer = IX.getNS(this.callServer);\r\n\t\t\t}\r\n\t\t\tthis.formParams = $XP(this.model.get('revParamJson'), this.serviceID);\r\n\t\t\tthis.initModal();\r\n\t\t\tthis.renderForm();\r\n\t\t\tthis.bindEvent();\r\n\t\t\tthis.emit('show');\r\n\t\t}\r\n\t});\r\n\teditServiceView.proto({\r\n\t\tloadTemplates : function () {\r\n\t\t\tvar layoutTpl = Handlebars.compile(Hualala.TplLib.get('tpl_shop_service_form_layout')),\r\n\t\t\t\tbtnTpl = Handlebars.compile(Hualala.TplLib.get('tpl_shop_modal_btns'));\r\n\t\t\tHandlebars.registerHelper('checkFormElementType', function (conditional, options) {\r\n\t\t\t\treturn (conditional == options.hash.type) ? options.fn(this) : options.inverse(this);\r\n\t\t\t});\r\n\t\t\tHandlebars.registerHelper('isInputGroup', function (prefix, surfix, options) {\r\n\t\t\t\treturn (!prefix && !surfix) ? options.inverse(this) : options.fn(this);\r\n\t\t\t});\r\n\t\t\tthis.set({\r\n\t\t\t\tlayoutTpl : layoutTpl,\r\n\t\t\t\tbtnTpl : btnTpl\r\n\t\t\t});\r\n\t\t},\t\r\n\t\tinitModal : function () {\r\n\t\t\tvar self = this;\r\n\t\t\tself.modal = new Hualala.UI.ModalDialog({\r\n\t\t\t\tid : 'service_edit',\r\n\t\t\t\tclz : 'service-modal',\r\n\t\t\t\ttitle : self.getModalTitle(),\r\n\t\t\t\tafterRemove : function () {\r\n\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t},\r\n\t\tinitSwitcher : function (selector) {\r\n\t\t\tvar self = this;\r\n\t\t\tself.modal._.body.find(selector).each(function () {\r\n\t\t\t\tvar $el = $(this),\r\n\t\t\t\t\tonLabel = $el.attr('data-onLabel'),\r\n\t\t\t\t\toffLabel = $el.attr('data-offLabel');\r\n\t\t\t\t$el.bootstrapSwitch({\r\n\t\t\t\t\tsize : 'normal',\r\n\t\t\t\t\tonColor : 'primary',\r\n\t\t\t\t\toffColor : 'default',\r\n\t\t\t\t\tonText : onLabel,\r\n\t\t\t\t\toffText : offLabel\r\n\t\t\t\t});\r\n\t\t\t});\r\n\t\t},\r\n\t\tinitTimePicker : function (selector) {\r\n\t\t\tvar self = this;\r\n\t\t\tself.modal._.body.find(selector).timepicker({\r\n\t\t\t\tminuteStep : 30,\r\n\t\t\t\tshowSeconds : false,\r\n\t\t\t\tshowMeridian :  false,\r\n\t\t\t\tdisableFocus : true,\r\n\t\t\t\tshowInputs : false\r\n\t\t\t});\r\n\t\t},\r\n\t\tgetServiceInfo : function (key, val) {\r\n\t\t\tvar self = this;\r\n\t\t\tvar operationMode = self.model.get('operationMode');\r\n\t\t\tvar servData = IX.inherit({}, _.find(this.serviceList, function (v) {return v[key] == val}));\r\n\t\t\tif (!IX.isEmpty($XP(servData, 'operationMode'))) {\r\n\t\t\t\tservData = IX.inherit(servData, {\r\n\t\t\t\t\tformKeys : $XP(servData, 'operationMode.' + operationMode)\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t\treturn servData;\r\n\t\t},\r\n\t\tgetModalTitle : function () {\r\n\t\t\treturn $XP(this.serviceInfo, 'label') + '配置';\r\n\t\t},\r\n\t\tbindEvent : function () {\r\n\t\t\tvar self = this;\r\n\t\t\tvar fvOpts = self.initValidFieldOpts();\r\n\t\t\tthis.on({\r\n\t\t\t\tshow : function () {\r\n\t\t\t\t\tthis.modal.show();\r\n\t\t\t\t},\r\n\t\t\t\thide : function () {\r\n\t\t\t\t\tthis.modal.hide();\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\tself.modal._.dialog.find('.btn').on('click', function (e) {\r\n\t\t\t\tvar $btn = $(this),\r\n\t\t\t\t\tact = $btn.attr('name');\r\n\t\t\t\tif (act == 'cancel') {\r\n\t\t\t\t\tself.emit('hide');\r\n\t\t\t\t} else {\r\n\t\t\t\t\tvar bv = self.modal._.body.find('form').data('bootstrapValidator');\r\n\t\t\t\t\t$btn.button('提交中...');\r\n\t\t\t\t\tbv.validate();\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\tself.modal._.body.find('form').bootstrapValidator({\r\n\t\t\t\ttrigger : 'blur',\r\n\t\t\t\tfields : fvOpts\r\n\t\t\t}).on('error.field.bv', function (e, data) {\r\n\t\t\t\tvar $form = $(e.target),\r\n\t\t\t\t\tbv = $form.data('bootstrapValidator');\r\n\t\t\t}).on('success.form.bv', function (e, data) {\r\n\t\t\t\te.preventDefault();\r\n\t\t\t\tvar $form = $(e.target),\r\n\t\t\t\t\tbv = $form.data('bootstrapValidator');\r\n\t\t\t\tvar formParams = self.serializeForm();\r\n\t\t\t\tconsole.info(formParams);\r\n\t\t\t\tself.model.emit('setServiceParams', {\r\n\t\t\t\t\tcallServer : self.callServer,\r\n\t\t\t\t\tparams : formParams,\r\n\t\t\t\t\tserviceID : self.serviceID,\r\n\t\t\t\t\tfailFn : function () {\r\n\t\t\t\t\t\tself.modal._.footer.find('.btn[name=submit]').button('reset');\r\n\t\t\t\t\t},\r\n\t\t\t\t\tsuccessFn : function () {\r\n\t\t\t\t\t\tself.modal._.footer.find('.btn[name=submit]').button('reset');\r\n\t\t\t\t\t\tself.emit('hide');\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t});;\r\n\t\t},\r\n\t\tdecodeTimeStr : function (t) {\r\n\t\t\tif (t.length == 0) return '';\r\n\t\t\treturn t.substr(0,2) + ':' + t.substr(2);\r\n\t\t},\r\n\t\tencodeTimeStr : function (min, max) {\r\n\t\t\treturn (min + ',' + max).replace(/\\:/g, '');\r\n\t\t},\r\n\t\t// 获取表单元素渲染数据\r\n\t\tmapServiceFormElsData : function () {\r\n\t\t\tvar self = this,\r\n\t\t\t\tformKeys = $XP(self.serviceInfo, 'formKeys', '').split(','),\r\n\t\t\t\tformEls = _.map(formKeys, function (key) {\r\n\t\t\t\t\tvar elCfg = ServiceFormElsHT.get(key),\r\n\t\t\t\t\t\ttype = $XP(elCfg, 'type');\r\n\t\t\t\t\tif (type == 'section' && key == 'servicePeriods') {\r\n\t\t\t\t\t\tvar v = $XP(self.formParams, key, '').split(',');\r\n\t\t\t\t\t\tv = _.map(v, function (t) {\r\n\t\t\t\t\t\t\treturn self.decodeTimeStr(t);\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t\treturn IX.inherit(elCfg, {\r\n\t\t\t\t\t\t\tmin : IX.inherit($XP(elCfg, 'min'), {\r\n\t\t\t\t\t\t\t\tvalue : v[0] || $XP(elCfg, 'min.defaultVal')\r\n\t\t\t\t\t\t\t}),\r\n\t\t\t\t\t\t\tmax : IX.inherit($XP(elCfg, 'max'), {\r\n\t\t\t\t\t\t\t\tvalue : v[1] || $XP(elCfg, 'max.defaultVal')\r\n\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t} else if (type == 'combo') {\r\n\t\t\t\t\t\tvar v = $XP(self.formParams, key, $XP(elCfg, 'defaultVal')),\r\n\t\t\t\t\t\t\toptions = _.map($XP(elCfg, 'options'), function (op) {\r\n\t\t\t\t\t\t\t\treturn IX.inherit(op, {\r\n\t\t\t\t\t\t\t\t\tselected : $XP(op, 'value') == v ? 'selected' : ''\r\n\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\treturn IX.inherit(elCfg, {\r\n\t\t\t\t\t\t\tvalue : $XP(self.formParams, key, $XP(elCfg, 'defaultVal')),\r\n\t\t\t\t\t\t\toptions : options\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t} else if (type == 'switcher') {\r\n\t\t\t\t\t\treturn IX.inherit(elCfg, {\r\n\t\t\t\t\t\t\tchecked : $XP(self.formParams, key) == $XP(elCfg, 'defaultVal') ? 'checked' : ''\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\treturn IX.inherit(elCfg, {\r\n\t\t\t\t\t\t\tvalue : $XP(self.formParams, key, $XP(elCfg, 'defaultVal'))\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\tconsole.info(formEls);\r\n\t\t\treturn formEls;\r\n\t\t},\r\n\t\t// 渲染表单\r\n\t\trenderForm : function () {\r\n\t\t\tvar self = this,\r\n\t\t\t\tfvOpts = self.initValidFieldOpts(),\r\n\t\t\t\trenderData = self.mapServiceFormElsData(),\r\n\t\t\t\ttpl = self.get('layoutTpl'),\r\n\t\t\t\tbtnTpl = self.get('btnTpl'),\r\n\t\t\t\thtm = tpl({\r\n\t\t\t\t\tformClz : 'shop-service-form',\r\n\t\t\t\t\titems : renderData\r\n\t\t\t\t});\r\n\t\t\tself.modal._.body.html(htm);\r\n\t\t\tself.modal._.footer.html(btnTpl({\r\n\t\t\t\tbtns : [\r\n\t\t\t\t\t{clz : 'btn-default', name : 'cancel', label : '取消'},\r\n\t\t\t\t\t{clz : 'btn-warning', name : 'submit', label : '保存'}\r\n\t\t\t\t]\r\n\t\t\t}));\r\n\r\n\t\t\tself.initSwitcher(':checkbox[data-type=switcher]');\r\n\t\t\tself.initTimePicker('[data-type=timepicker]');\r\n\r\n\t\t},\r\n\t\t// 获取表单数据\r\n\t\tserializeForm : function () {\r\n\t\t\tvar self = this,\r\n\t\t\t\tformKeys = $XP(self.serviceInfo, 'formKeys', '').split(','),\r\n\t\t\t\tret = {},\r\n\t\t\t\tformEls = _.map(formKeys, function (key) {\r\n\t\t\t\t\tvar elCfg = ServiceFormElsHT.get(key),\r\n\t\t\t\t\t\ttype = $XP(elCfg, 'type');\r\n\t\t\t\t\tif (type == 'section' && key == 'servicePeriods') {\r\n\t\t\t\t\t\tvar min = $('[name=' + key + '_min]').val(),\r\n\t\t\t\t\t\t\tmax = $('[name=' + key + '_max]').val();\r\n\t\t\t\t\t\tret[key] = self.encodeTimeStr(min, max);\r\n\t\t\t\t\t} else if (type == 'switcher') {\r\n\t\t\t\t\t\t// ret[key] = $('[name=' + key + ']').attr('checked') ? 1 : 0;\r\n\t\t\t\t\t\tret[key] = !$('[name=' + key + ']').data('bootstrapSwitch').options.state ? 0 : 1;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tret[key] = $('[name=' + key + ']').val();\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\treturn ret;\r\n\t\t},\r\n\t\t// 获取表单验证配置\r\n\t\tinitValidFieldOpts : function () {\r\n\t\t\tvar self = this,\r\n\t\t\t\tformKeys = $XP(self.serviceInfo, 'formKeys', '').split(','),\r\n\t\t\t\tret = {};\r\n\t\t\t_.each(formKeys, function (key) {\r\n\t\t\t\tvar elCfg = ServiceFormElsHT.get(key),\r\n\t\t\t\t\ttype = $XP(elCfg, 'type');\r\n\t\t\t\tif (type == 'section') {\r\n\t\t\t\t\tvar min = key + '_min', max = key + '_max';\r\n\t\t\t\t\tret[min] = $XP(elCfg, 'min.validCfg', {});\r\n\t\t\t\t\tret[max] = $XP(elCfg, 'max.validCfg', {});\r\n\t\t\t\t} else {\r\n\t\t\t\t\tret[key] = $XP(elCfg, 'validCfg', {});\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\treturn ret;\r\n\t\t}\r\n\t});\r\n\tHualala.Setting.editServiceView = editServiceView;\r\n})(jQuery, window);;(function ($, window) {\r\n\tIX.ns(\"Hualala.Setting\");\r\n\tvar initShopMgr = function (pageType, params) {\r\n\t\tvar $body = $('#ix_wrapper > .ix-body > .container');\r\n\t\tvar queryPanel = new Hualala.Shop.QueryController({\r\n\t\t\tneedShopCreate : false,\r\n\t\t\tcontainer : $body,\r\n\t\t\tresultController : new Hualala.Shop.ShopListController({\r\n\t\t\t\tcontainer : $body,\r\n\t\t\t\tmodel : new Hualala.Shop.CardListModel({callServer : Hualala.Global.queryShop}),\r\n\t\t\t\tview : new Hualala.Shop.ShopListView()\r\n\t\t\t})\r\n\t\t});\r\n\t};\r\n\tHualala.Setting.ShopMgrInit = initShopMgr;\r\n})(jQuery, window);;(function ($, window) {\r\n\tIX.ns(\"Hualala.Account\");\r\n\tvar popoverMsg = Hualala.UI.PopoverMsgTip;\r\n\tvar toptip = Hualala.UI.TopTip;\r\n\tvar CardListModel = Hualala.Shop.CardListModel;\r\n\tvar AccountListModel = CardListModel.subclass({\r\n\t\tconstructor : CardListModel.prototype.constructor\r\n\t});\r\n\tAccountListModel.proto({\r\n\t\tinit : function (params) {\r\n\t\t\tthis.set({\r\n\t\t\t\tpageCount : 0,\r\n\t\t\t\ttotalSize : 0,\r\n\t\t\t\tpageNo : $XP(params, 'pageNo', 1),\r\n\t\t\t\tpageSize : $XP(params, 'pageSize', 15),\r\n\t\t\t\ttransCreateBeginTime : $XP(params, 'transCreateBeginTime', ''),\r\n\t\t\t\ttransCreateEndTime : $XP(params, 'transCreateEndTime', ''),\r\n\t\t\t\tsettleUnitID : $XP(params, 'settleUnitID', ''),\r\n\t\t\t\ttransStatus : $XP(params, 'transStatus', ''),\r\n\t\t\t\ttransType : $XP(params, 'transType', ''),\r\n\t\t\t\tgroupID : $XP(params, 'groupID', ''),\r\n\t\t\t\tminTransAmount : $XP(params, 'minTransAmount', ''),\r\n\t\t\t\tmaxTransAmount : $XP(params, 'maxTransAmount', ''),\r\n\t\t\t\tds_account : new IX.IListManager(),\r\n\t\t\t\tds_page : new IX.IListManager()\r\n\t\t\t});\r\n\t\t},\r\n\t\tupdatePagerParams : function (params) {\r\n\t\t\tvar self = this;\r\n\t\t\tvar pagerParamkeys = 'pageCount,totalSize,pageNo,pageSize,transCreateBeginTime,transCreateEndTime,settleUnitID,transStatus,transType,groupID,minTransAmount,maxTransAmount';\r\n\t\t\t_.each(params, function (v, k, l) {\r\n\t\t\t\tif (pagerParamkeys.indexOf(k) > -1) {\r\n\t\t\t\t\tself.set(k, v);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t},\r\n\t\tgetPagerParams : function () {\r\n\t\t\t// return {\r\n\t\t\t// \tPage : {\r\n\t\t\t// \t\tpageNo : this.get('pageNo'),\r\n\t\t\t// \t\tpageSize : this.get('pageSize')\r\n\t\t\t// \t},\r\n\t\t\t// \tsettleUnitID : this.get('settleUnitID'),\r\n\t\t\t// \ttransCreateBeginTime : this.get('transCreateBeginTime'),\r\n\t\t\t// \ttransCreateEndTime : this.get('transCreateEndTime'),\r\n\t\t\t// \ttransStatus : this.get('transStatus'),\r\n\t\t\t// \ttransType : this.get('transType'),\r\n\t\t\t// \tgroupID : this.get('groupID'),\r\n\t\t\t// \tminTransAmount : this.get('minTransAmount'),\r\n\t\t\t// \tmaxTransAmount : this.get('maxTransAmount')\r\n\t\t\t// };\r\n\t\t\treturn {\r\n\t\t\t\tpageNo : this.get('pageNo'),\r\n\t\t\t\tpageSize : this.get('pageSize'),\r\n\t\t\t\tsettleUnitID : this.get('settleUnitID'),\r\n\t\t\t\ttransCreateBeginTime : this.get('transCreateBeginTime'),\r\n\t\t\t\ttransCreateEndTime : this.get('transCreateEndTime'),\r\n\t\t\t\ttransStatus : this.get('transStatus'),\r\n\t\t\t\ttransType : this.get('transType'),\r\n\t\t\t\tgroupID : this.get('groupID'),\r\n\t\t\t\tminTransAmount : this.get('minTransAmount'),\r\n\t\t\t\tmaxTransAmount : this.get('maxTransAmount')\r\n\t\t\t};\r\n\t\t},\r\n\t\tupdateDataStore : function (data, pageNo) {\r\n\t\t\tvar self = this,\r\n\t\t\t\taccountHT = self.get('ds_account'),\r\n\t\t\t\tpageHT = self.get('ds_page');\r\n\t\t\tvar accountIDs = _.map(data, function (account, i, l) {\r\n\t\t\t\tvar settleUnitID = $XP(account, 'settleUnitID'),\r\n\t\t\t\t\tmAccount = new BaseAccountModel(account);\r\n\t\t\t\taccountHT.register(settleUnitID, mAccount);\r\n\t\t\t\treturn settleUnitID;\r\n\t\t\t});\r\n\t\t\tpageHT.register(pageNo, accountIDs);\r\n\t\t},\r\n\t\tresetDataStore : function () {\r\n\t\t\tvar self = this,\r\n\t\t\t\taccountHT = self.get('ds_account'),\r\n\t\t\t\tpageHT = self.get('ds_page');\r\n\t\t\taccountHT.clear();\r\n\t\t\tpageHT.clear();\r\n\t\t},\r\n\t\tload : function (params, cbFn) {\r\n\t\t\tvar self = this;\r\n\t\t\tself.updatePagerParams(params);\r\n\t\t\tself.callServer(self.getPagerParams(), function (res) {\r\n\t\t\t\tif (res.resultcode == '000') {\r\n\t\t\t\t\tself.updateDataStore($XP(res, 'data.records', []), $XP(res, 'data.pageNo'));\r\n\t\t\t\t\tself.updatePagerParams($XP(res, 'data.page', {}));\r\n\t\t\t\t} else {\r\n\t\t\t\t\ttoptip({\r\n\t\t\t\t\t\tmsg : $XP(res, 'resultmsg', ''),\r\n\t\t\t\t\t\ttype : 'danger'\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t\tcbFn(self);\r\n\t\t\t});\r\n\t\t},\r\n\t\tgetAccounts : function (pageNo) {\r\n\t\t\tvar self = this,\r\n\t\t\t\taccountHT = self.get('ds_account'),\r\n\t\t\t\tpageHT = self.get('ds_page');\r\n\t\t\tvar ret = _.map(accountHT.getByKeys(pageHT.get(pageNo)), function (mAccount) {\r\n\t\t\t\treturn mAccount.getAll();\r\n\t\t\t});\r\n\t\t\tconsole.info(\"pageData :\");\r\n\t\t\tconsole.info(ret);\r\n\t\t\treturn ret;\r\n\t\t},\r\n\t\tgetAccountModelByID : function (accountID) {\r\n\t\t\tvar self = this,\t\r\n\t\t\t\taccountHT = self.get('ds_account');\r\n\t\t\treturn accountHT.get(accountID);\r\n\t\t}\r\n\t});\r\n\r\n\r\n\tHualala.Account.AccountListModel = AccountListModel;\r\n\r\n\tvar BaseAccountModel = Stapes.subclass({\r\n\t\tconstructor : function (account) {\r\n\t\t\t!IX.isEmpty(account) && this.set(account);\r\n\t\t\tthis.bindEvent();\r\n\t\t}\r\n\t});\r\n\tBaseAccountModel.proto({\r\n\t\tbindEvent : function () {\r\n\t\t\tvar self = this;\r\n\t\t\tself.on({\r\n\t\t\t\t\"load\" : function (params) {\r\n\t\t\t\t\tvar settleUnitID = $XP(params, 'settleUnitID'),\r\n\t\t\t\t\t\tcbFn = $XF(params, 'cbFn');\r\n\t\t\t\t\tvar callServer = Hualala.Global.queryAccount,\r\n\t\t\t\t\t\tgroupID = $XP(Hualala.getSessionSite(), 'groupID', '');\r\n\t\t\t\t\tcallServer({\r\n\t\t\t\t\t\tsettleUnitID : settleUnitID,\r\n\t\t\t\t\t\tgroupID : groupID\r\n\t\t\t\t\t}, function (res) {\r\n\t\t\t\t\t\tvar records = $XP(res, \"data.records\", []);\r\n\t\t\t\t\t\tif (records.length == 0) {\r\n\t\t\t\t\t\t\tthrow(\"get Account Data (\" + settleUnitID + \") Failed!\");\r\n\t\t\t\t\t\t\treturn ;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tself.set(records[0]);\r\n\t\t\t\t\t\tcbFn();\r\n\t\t\t\t\t});\r\n\t\t\t\t},\r\n\t\t\t\t// 提现\r\n\t\t\t\t\"withdrawCash\" : function (cfg) {\r\n\t\t\t\t\tvar callServer = Hualala.Global.withdrawCash,\r\n\t\t\t\t\t\tparams = $XP(cfg, 'params', {}),\r\n\t\t\t\t\t\tsettleUnitID = self.get('settleUnitID'),\r\n\t\t\t\t\t\tfailFn = $XF(cfg, 'failFn'),\r\n\t\t\t\t\t\tsuccessFn = $XF(cfg, 'successFn');\r\n\t\t\t\t\tcallServer(IX.inherit(params, {\r\n\t\t\t\t\t\tsettleUnitID : settleUnitID\r\n\t\t\t\t\t}), function (res) {\r\n\t\t\t\t\t\tif (res.resultcode !== '000') {\r\n\t\t\t\t\t\t\ttoptip({\r\n\t\t\t\t\t\t\t\tmsg : $XP(res, 'resultmsg', ''),\r\n\t\t\t\t\t\t\t\ttype : 'danger'\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\tfailFn();\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tvar transAmount = $XP(params, 'transAmount', 0),\r\n\t\t\t\t\t\t\t\tsettleBalance = self.get('settleBalance') || 0,\r\n\t\t\t\t\t\t\t\tnewSettleBalance = Hualala.Common.Math.sub(settleBalance - transAmount);\r\n\t\t\t\t\t\t\tself.set('settleBalance', newSettleBalance);\r\n\t\t\t\t\t\t\t// TODO update View\r\n\t\t\t\t\t\t\tsuccessFn();\r\n\t\t\t\t\t\t\ttoptip({\r\n\t\t\t\t\t\t\t\tmsg : '提现成功!',\r\n\t\t\t\t\t\t\t\ttype : 'success'\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t},\r\n\t\t\t\t// 删除结算账户\r\n\t\t\t\t\"delete\" : function (cfg) {\r\n\t\t\t\t\tvar callServer = Hualala.Global.deleteAccount,\r\n\t\t\t\t\t\tsettleUnitID = self.get('settleUnitID'),\r\n\t\t\t\t\t\tgroupID = $XP(Hualala.getSessionSite(), 'groupID', ''),\r\n\t\t\t\t\t\tfailFn = $XF(cfg, 'failFn'),\r\n\t\t\t\t\t\tsuccessFn = $XF(cfg, 'successFn');\r\n\t\t\t\t\tcallServer({\r\n\t\t\t\t\t\tsettleUnitID : settleUnitID,\r\n\t\t\t\t\t\tgroupID : groupID\r\n\t\t\t\t\t}, function (res) {\r\n\t\t\t\t\t\tif (res.resultcode !== '000') {\r\n\t\t\t\t\t\t\ttoptip({\r\n\t\t\t\t\t\t\t\tmsg : $XP(res, 'resultmsg', ''),\r\n\t\t\t\t\t\t\t\ttype : 'danger'\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\tfailFn(settleUnitID);\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\ttoptip({\r\n\t\t\t\t\t\t\t\tmsg : '删除成功!',\r\n\t\t\t\t\t\t\t\ttype : 'success'\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t// TODO update View\r\n\t\t\t\t\t\t\tsuccessFn(settleUnitID);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t},\r\n\t\t\t\t// 编辑结算账户\r\n\t\t\t\t\"edit\" : function (cfg) {\r\n\t\t\t\t\tvar callServer = Hualala.Global.editAccount,\r\n\t\t\t\t\t\tsettleUnitID = self.get('settleUnitID'),\r\n\t\t\t\t\t\tgroupID = $XP(Hualala.getSessionSite(), 'groupID', ''),\r\n\t\t\t\t\t\tfailFn = $XF(cfg, 'failFn'),\r\n\t\t\t\t\t\tsuccessFn = $XF(cfg, 'successFn');\r\n\t\t\t\t\tcallServer(IX.inherit($XP(cfg, 'params', {}), {\r\n\t\t\t\t\t\tgroupID : groupID,\r\n\t\t\t\t\t\tsettleUnitID : settleUnitID\r\n\t\t\t\t\t}), function (res) {\r\n\t\t\t\t\t\tif (res.resultcode !== '000') {\r\n\t\t\t\t\t\t\ttoptip({\r\n\t\t\t\t\t\t\t\tmsg : $XP(res, 'resultmsg', ''),\r\n\t\t\t\t\t\t\t\ttype : 'danger'\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\tfailFn(settleUnitID);\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\ttoptip({\r\n\t\t\t\t\t\t\t\tmsg : '修改成功!',\r\n\t\t\t\t\t\t\t\ttype : 'success'\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t// TODO update View\r\n\t\t\t\t\t\t\tself.set($XP(cfg, 'params', {}));\r\n\t\t\t\t\t\t\tsuccessFn(settleUnitID);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t},\r\n\t\t\t\t// 添加结算账户\r\n\t\t\t\t\"add\" : function (cfg) {\r\n\t\t\t\t\tvar callServer = Hualala.Global.addAccount,\r\n\t\t\t\t\t\tgroupID = $XP(Hualala.getSessionSite(), 'groupID', ''),\r\n\t\t\t\t\t\tfailFn = $XF(cfg, 'failFn'),\r\n\t\t\t\t\t\tsuccessFn = $XF(cfg, 'successFn');\r\n\t\t\t\t\tcallServer(IX.inherit($XP(cfg, 'params', {}), {\r\n\t\t\t\t\t\tgroupID : groupID\r\n\t\t\t\t\t}), function (res) {\r\n\t\t\t\t\t\tif (res.resultcode !== '000') {\r\n\t\t\t\t\t\t\ttoptip({\r\n\t\t\t\t\t\t\t\tmsg : $XP(res, 'resultmsg', ''),\r\n\t\t\t\t\t\t\t\ttype : 'danger'\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\tfailFn();\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\ttoptip({\r\n\t\t\t\t\t\t\t\tmsg : '修改成功!',\r\n\t\t\t\t\t\t\t\ttype : 'success'\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t// TODO update View\r\n\t\t\t\t\t\t\tself.set($XP(cfg, 'params', {}));\r\n\t\t\t\t\t\t\tsuccessFn();\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\t});\r\n\r\n\tHualala.Account.BaseAccountModel = BaseAccountModel;\r\n\r\n\tvar AccountTransListModel = AccountListModel.subclass({\r\n\t\tconstructor : function () {\r\n\t\t\tthis.callServer = Hualala.Global.queryAccountTransDetail;\r\n\t\t}\r\n\t});\r\n\tAccountTransListModel.proto({\r\n\t\tinit : function (params) {\r\n\t\t\tthis.set({\r\n\t\t\t\tpageCount : 0,\r\n\t\t\t\ttotalSize : 0,\r\n\t\t\t\tpageNo : $XP(params, 'pageNo', 1),\r\n\t\t\t\tpageSize : $XP(params, 'pageSize', 15),\r\n\t\t\t\ttransCreateBeginTime : $XP(params, 'transCreateBeginTime', ''),\r\n\t\t\t\ttransCreateEndTime : $XP(params, 'transCreateEndTime', ''),\r\n\t\t\t\tsettleUnitID : $XP(params, 'settleUnitID', ''),\r\n\t\t\t\ttransStatus : $XP(params, 'transStatus', ''),\r\n\t\t\t\ttransType : $XP(params, 'transType', ''),\r\n\t\t\t\tgroupID : $XP(params, 'groupID', ''),\r\n\t\t\t\tminTransAmount : $XP(params, 'minTransAmount', ''),\r\n\t\t\t\tmaxTransAmount : $XP(params, 'maxTransAmount', ''),\r\n\t\t\t\tds_trans : new IX.IListManager(),\r\n\t\t\t\tds_page : new IX.IListManager()\r\n\t\t\t});\r\n\t\t},\r\n\t\tupdateDataStore : function (data, pageNo) {\r\n\t\t\tvar self = this,\r\n\t\t\t\ttransHT = self.get('ds_trans'),\r\n\t\t\t\tpageHT = self.get('ds_page');\r\n\t\t\tvar transIDs = _.map(data, function (trans, i, l) {\r\n\t\t\t\tvar transID = $XP(trans, 'SUATransItemID'),\r\n\t\t\t\t\tmTrans = new BaseTransactionModel(trans);\r\n\t\t\t\ttransHT.register(transID, mTrans);\r\n\t\t\t\treturn transID;\r\n\t\t\t});\r\n\t\t\tpageHT.register(pageNo, transIDs);\r\n\t\t},\r\n\t\tresetDataStore : function () {\r\n\t\t\tvar self = this,\r\n\t\t\t\ttransHT = self.get('ds_trans'),\r\n\t\t\t\tpageHT = self.get('ds_page');\r\n\t\t\ttransHT.clear();\r\n\t\t\tpageHT.clear();\r\n\t\t},\r\n\t\tload : function (params, cbFn) {\r\n\t\t\tvar self = this;\r\n\t\t\tself.updatePagerParams(params);\r\n\t\t\tself.callServer(self.getPagerParams(), function (res) {\r\n\t\t\t\tif (res.resultcode == '000') {\r\n\t\t\t\t\tself.updateDataStore($XP(res, 'data.records', []), $XP(res, 'data.pageNo'));\r\n\t\t\t\t\tself.updatePagerParams($XP(res, 'data', {}));\r\n\t\t\t\t} else {\r\n\t\t\t\t\ttoptip({\r\n\t\t\t\t\t\tmsg : $XP(res, 'resultmsg', ''),\r\n\t\t\t\t\t\ttype : 'danger'\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t\tcbFn(self);\r\n\t\t\t});\r\n\t\t},\r\n\t\tgetDataByPageNo : function (pageNo) {\r\n\t\t\tvar self = this,\r\n\t\t\t\ttransHT = self.get('ds_trans'),\r\n\t\t\t\tpageHT = self.get('ds_page');\r\n\t\t\tvar ret = _.map(transHT.getByKeys(pageHT.get(pageNo)), function (mTrans) {\r\n\t\t\t\treturn mTrans.getAll();\r\n\t\t\t});\r\n\t\t\tconsole.info(\"pageData :\");\r\n\t\t\tconsole.info(ret);\r\n\t\t\treturn ret;\r\n\t\t},\r\n\t\tgetModelByID : function (transID) {\r\n\t\t\tvar self = this,\t\r\n\t\t\t\ttransHT = self.get('ds_trans');\r\n\t\t\treturn transHT.get(transID);\r\n\t\t}\r\n\t});\r\n\r\n\tHualala.Account.AccountTransListModel = AccountTransListModel;\r\n\r\n\tvar BaseTransactionModel = BaseAccountModel.subclass({\r\n\t\tconstructor : BaseAccountModel.prototype.constructor\r\n\t});\r\n\tBaseTransactionModel.proto({\r\n\t\tbindEvent : function () {\r\n\t\t\tvar self = this;\r\n\t\t\t\r\n\t\t}\r\n\t});\r\n\r\n\tHualala.Account.BaseTransactionModel = BaseTransactionModel;\r\n\r\n\tvar AccountQueryShopModel = Hualala.Shop.QueryModel.subclass({\r\n\t\tconstructor : function () {\r\n\t\t\t// 原始数据\r\n\t\t\tthis.origCities = [];\r\n\t\t\tthis.origAreas = [];\r\n\t\t\tthis.origShops = [];\r\n\t\t\t// 数据是否已经加载完毕\r\n\t\t\tthis.isReady = false;\r\n\t\t\t// this.callServer = Hualala.Global.getShopQuerySchema;\r\n\t\t\tthis.callServer = Hualala.Global.getAccountQueryShop;\r\n\t\t}\r\n\t});\r\n\r\n\tHualala.Account.AccountQueryShopModel = AccountQueryShopModel;\r\n\r\n\tvar AccountQueryShopResultModel = Hualala.Shop.CardListModel.subclass({\r\n\t\tconstructor : function () {\r\n\t\t\tthis.origData = null;\r\n\t\t\t\r\n\t\t\tthis.dataStore = new IX.IListManager();\r\n\t\t}\r\n\t});\r\n\tAccountQueryShopResultModel.proto({\r\n\t\tinitDataStore : function (data) {\r\n\t\t\tvar self = this;\r\n\t\t\tself.origData = data;\r\n\t\t\t_.each(self.origData, function (shop) {\r\n\t\t\t\tself.dataStore.register($XP(shop, 'shipID'), shop);\r\n\t\t\t});\r\n\t\t},\r\n\t\tload : function (params, cbFn) {\r\n\t\t\tvar self = this;\r\n\t\t\tself.updatePagerParams(params);\r\n\t\t\tvar pageNo = self.get('pageNo'),\r\n\t\t\t\tpageSize = self.get('pageSize'),\r\n\t\t\t\tcityID = self.get('cityID'),\r\n\t\t\t\tareaID = self.get('areaID'),\r\n\t\t\t\tkeywordLst = self.get('keywordLst'),\r\n\t\t\t\ttotalSize = 0,\r\n\t\t\t\tstart = (pageNo - 1) * pageSize,\r\n\t\t\t\tend = pageSize * pageNo,\r\n\t\t\t\tpageCount = 0;\r\n\t\t\tvar shops = [];\r\n\t\t\tshops = areaID.length > 0 ? _.filter(self.origData, function (_shop) {\r\n\t\t\t\treturn $XP(_shop, 'areaID') == areaID;\r\n\t\t\t}) : self.origData;\r\n\t\t\tshops = cityID.length > 0 ? _.filter(shops, function (_shop) {\r\n\t\t\t\treturn $XP(_shop, 'cityID') == cityID;\r\n\t\t\t}) : shops;\r\n\t\t\tshops = keywordLst.length > 0 ? _.filter(shops, function (_shop) {\r\n\t\t\t\treturn $XP(_shop, 'shopName') == keywordLst;\r\n\t\t\t}) : shops;\r\n\t\t\ttotalSize = shops.length;\r\n\t\t\tpageCount = Math.ceil(totalSize / pageSize);\r\n\t\t\tshops = _.filter(shops, function (_shop, idx) {\r\n\t\t\t\treturn idx >= start && idx < end;\r\n\t\t\t});\r\n\t\t\tself.updateDataStore(shops, pageNo);\r\n\t\t\tself.updatePagerParams({\r\n\t\t\t\tpageCount : pageCount,\r\n\t\t\t\ttotalSize : totalSize,\r\n\t\t\t\tpageNo : pageNo,\r\n\t\t\t\tpageSize : pageSize\r\n\t\t\t});\r\n\t\t\tcbFn(self);\r\n\t\t}\r\n\t});\r\n\r\n\tHualala.Account.AccountQueryShopResultModel = AccountQueryShopResultModel;\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n})(jQuery, window);;(function ($, window) {\r\n\tIX.ns(\"Hualala.Account\");\r\n\tvar popoverMsg = Hualala.UI.PopoverMsgTip;\r\n\tvar toptip = Hualala.UI.TopTip;\r\n\tvar CardListView = Hualala.Shop.CardListView;\r\n\tvar AccountListView = CardListView.subclass({\r\n\t\tconstructor : CardListView.prototype.constructor\r\n\t});\r\n\tAccountListView.proto({\r\n\t\t// 重载loadTemplates\r\n\t\t// 加载View层所需要的模板\r\n\t\tloadTemplates : function () {\r\n\t\t\tvar layoutTpl = Handlebars.compile(Hualala.TplLib.get('tpl_account_list_layout')),\r\n\t\t\t\tlistTpl = Handlebars.compile(Hualala.TplLib.get('tpl_account_list')),\r\n\t\t\t\titemTpl = Handlebars.compile(Hualala.TplLib.get('tpl_account_card')),\r\n\t\t\t\taddAccountTpl = Handlebars.compile(Hualala.TplLib.get('tpl_addAccount_Card'));\r\n\t\t\t// 注册accountCard子模板\r\n\t\t\tHandlebars.registerPartial(\"accountCard\", Hualala.TplLib.get('tpl_account_card'));\r\n\t\t\tHandlebars.registerPartial(\"addAccountCard\", Hualala.TplLib.get('tpl_addAccount_Card'));\r\n\r\n\t\t\tthis.set({\r\n\t\t\t\tlayoutTpl : layoutTpl,\r\n\t\t\t\tlistTpl : listTpl,\r\n\t\t\t\titemTpl : itemTpl\r\n\t\t\t});\r\n\t\t},\r\n\t\t// 重载initLayout\r\n\t\tinitLayout : function () {\r\n\t\t\tvar layoutTpl = this.get('layoutTpl');\r\n\t\t\tvar htm = layoutTpl();\r\n\t\t\tthis.$container.append(htm);\r\n\t\t\tthis.$resultBox = this.$container.find('.account-list');\r\n\t\t\tthis.$list = this.$container.find('.account-list-body');\r\n\t\t\tthis.$pager = this.$container.find('.page-selection');\r\n\t\t\tthis.initPager();\r\n\t\t\tthis.bindEvent();\r\n\t\t\tthis.bindCardEvent();\r\n\t\t},\r\n\t\tbindCardEvent : function () {\r\n\t\t\tvar self = this;\r\n\t\t\tself.$list.on('click', '.btn.withdraw', function (e) {\r\n\t\t\t\tvar $btn = $(this);\r\n\t\t\t\tvar settleAccountID = $btn.parents('.bank-card').attr('data-id');\r\n\t\t\t\t// 提现操作\r\n\t\t\t\tvar modal = new WithdrawCashView({\r\n\t\t\t\t\ttriggerEl : $btn,\r\n\t\t\t\t\tsettleUnitID : settleAccountID,\r\n\t\t\t\t\tmodel : self.model.getAccountModelByID(settleAccountID),\r\n\t\t\t\t\tparentView : self\r\n\t\t\t\t});\r\n\t\t\t});\r\n\t\t\tself.$list.on('click', '.create-account', function (e) {\r\n\t\t\t\tvar $btn = $(this);\r\n\t\t\t\t// TODO 创建账户\r\n\t\t\t\tvar editAccount = new Hualala.Account.AccountEditView({\r\n\t\t\t\t\ttriggerEl : $btn,\r\n\t\t\t\t\tmode : 'add',\r\n\t\t\t\t\tmodel : null,\r\n\t\t\t\t\tparentView : self\r\n\t\t\t\t});\r\n\t\t\t});\r\n\t\t\tself.on({\r\n\t\t\t\t'updateSettleBalance' : function (mAccount) {\r\n\t\t\t\t\tvar settleUnitID = mAccount.get('settleUnitID'),\r\n\t\t\t\t\t\tsettleBalance = mAccount.get('settleBalance');\r\n\t\t\t\t\tself.$container.find('[data-id=' + settleUnitID + '] .cash > strong').html(settleBalance);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t},\r\n\t\t// 重载格式化渲染数据\r\n\t\tmapRenderData : function (data) {\r\n\t\t\tvar self = this;\r\n\t\t\tvar ret = _.map(data, function (account, i, l) {\r\n\t\t\t\tvar settleUnitID = $XP(account, 'settleUnitID'),\r\n\t\t\t\t\thasDefault = $XP(account, 'defaultAccount', 0) == 0 ? false : true,\r\n\t\t\t\t\tbankInfo = Hualala.Common.mapBankInfo($XP(account, 'bankCode')),\r\n\t\t\t\t\tbankAccountStr = Hualala.Common.codeMask($XP(account, 'bankAccount', ''), 0, -4);\r\n\r\n\t\t\t\treturn {\r\n\t\t\t\t\tsettleUnitID : settleUnitID,\r\n\t\t\t\t\thasDefault : hasDefault,\r\n\t\t\t\t\tsettleUnitName : $XP(account, 'settleUnitName', ''),\r\n\t\t\t\t\tsettleBalance : parseFloat($XP(account, 'settleBalance', 0)),\r\n\t\t\t\t\tbankIcon : $XP(bankInfo, 'icon_16', ''),\r\n\t\t\t\t\tbankComName : $XP(bankInfo, 'name', ''),\r\n\t\t\t\t\tbankAccountStr : $XP(bankAccountStr, 'val', '').replace(/([\\w|*]{4})/g, '$1 ').replace(/([*])/g, '<span>$1</span>'),\r\n\t\t\t\t\tshopCount : parseInt($XP(account, 'shopCount', 0)),\r\n\t\t\t\t\tpath : Hualala.PageRoute.createPath('accountDetail', [settleUnitID])\r\n\t\t\t\t};\r\n\t\t\t});\r\n\t\t\treturn {\r\n\t\t\t\taccountCard : {\r\n\t\t\t\t\tlist : ret\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\t// 重载渲染列表\r\n\t\trender : function () {\r\n\t\t\tvar self = this,\r\n\t\t\t\tmodel = self.model,\r\n\t\t\t\tpagerParams = model.getPagerParams(),\r\n\t\t\t\tpageNo = $XP(pagerParams, 'pageNo');\r\n\t\t\tvar accounts = model.getAccounts(pageNo);\r\n\t\t\tvar renderData = self.mapRenderData(accounts);\r\n\t\t\tvar listTpl = self.get('listTpl');\r\n\t\t\tvar html = listTpl(renderData);\r\n\t\t\tself.$list.empty();\r\n\t\t\tself.$list.html(html);\r\n\t\t\tself.initPager({\r\n\t\t\t\ttotal : model.get('pageCount'),\r\n\t\t\t\tpage : model.get('pageNo'),\r\n\t\t\t\thref : 'javascript:void(0);'\r\n\t\t\t});\r\n\t\t},\r\n\t\trefresh : function () {\r\n\t\t\tvar self = this;\r\n\t\t\tself.render();\r\n\t\t}\r\n\t\t\r\n\t});\r\n\r\n\tHualala.Account.AccountListView = AccountListView;\r\n\r\n\tvar WithdrawCashView = Stapes.subclass({\r\n\t\t/**\r\n\t\t * 提现窗口\r\n\t\t * @param  {Object} cfg {triggerEl, settleUnitID, model}\r\n\t\t *              @param {jQueryObj} triggerEl 触发元素\r\n\t\t *              @param {String} settleUnitID 结算账户ID\r\n\t\t *              @param {Object} model 结算账户数据模型\r\n\t\t *              @param {Object} parentView 父级View层\r\n\t\t * @return {Obj}     提现实例\r\n\t\t */\r\n\t\tconstructor : function (cfg) {\r\n\t\t\tthis.$trigger = $XP(cfg, 'triggerEl');\r\n\t\t\tthis.settleUnitID = $XP(cfg, 'settleUnitID', null);\r\n\t\t\tthis.model = $XP(cfg, 'model', null);\r\n\t\t\tthis.parentView = $XP(cfg, 'parentView', null);\r\n\t\t\tthis.modal = null;\r\n\t\t\tif (!this.settleUnitID || !this.model) {\r\n\t\t\t\tthrow(\"Withdraw Cash View init failed!\");\r\n\t\t\t}\r\n\t\t\tthis.loadTemplates();\r\n\t\t\tthis.initModal();\r\n\t\t\tthis.renderForm();\r\n\t\t\tthis.bindEvent();\r\n\t\t\tthis.emit('show');\t\t\r\n\t\t}\r\n\t});\r\n\r\n\tWithdrawCashView.proto({\r\n\t\tloadTemplates : function () {\r\n\t\t\tvar layoutTpl = Handlebars.compile(Hualala.TplLib.get('tpl_withdraw_form')),\r\n\t\t\t\tbtnTpl = Handlebars.compile(Hualala.TplLib.get('tpl_shop_modal_btns'));\r\n\t\t\tthis.set({\r\n\t\t\t\tlayoutTpl : layoutTpl,\r\n\t\t\t\tbtnTpl : btnTpl\r\n\t\t\t});\r\n\t\t},\r\n\t\tinitModal : function () {\r\n\t\t\tvar self = this;\r\n\t\t\tself.modal = new Hualala.UI.ModalDialog({\r\n\t\t\t\tid : 'account_withdraw',\r\n\t\t\t\tclz : 'service-modal',\r\n\t\t\t\ttitle : '结算账户提现',\r\n\t\t\t\tafterRemove : function () {\r\n\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t},\r\n\t\tmapFormElsData : function () {\r\n\t\t\tvar self = this,\r\n\t\t\t\taccountInfoKeys = [\r\n\t\t\t\t\t{key : 'settleUnitName', label : '结算账户名称'},\r\n\t\t\t\t\t{key : 'receiverName', label : '开户名'},\r\n\t\t\t\t\t{key : 'bankName', label : '开户行'},\r\n\t\t\t\t\t{key : 'bankAccount', label : '账号'},\r\n\t\t\t\t\t{key : 'settleBalance', label : '账户余额'}\r\n\t\t\t\t],\r\n\t\t\t\taccountInfo = _.map(accountInfoKeys, function (el) {\r\n\t\t\t\t\tvar k = $XP(el, 'key');\r\n\t\t\t\t\treturn {\r\n\t\t\t\t\t\tlabel : $XP(el, 'label', ''),\r\n\t\t\t\t\t\tvalue : k == 'settleBalance' ? ('<strong>' + self.model.get(k) + '</strong>元') : self.model.get(k)\r\n\t\t\t\t\t};\r\n\t\t\t\t});\r\n\t\t\treturn {\r\n\t\t\t\taccountInfo : accountInfo,\r\n\t\t\t\tformClz : 'account-withdraw-form',\r\n\t\t\t\tlabelClz : 'col-sm-4 control-label',\r\n\t\t\t\tclz : 'col-sm-7',\r\n\t\t\t\tid : 'transAmount',\r\n\t\t\t\tlabel : '请输入提现金额',\r\n\t\t\t\tname : 'transAmount',\r\n\t\t\t\tvalue : self.model.get('settleBalance')\r\n\t\t\t};\r\n\t\t},\r\n\t\trenderForm : function () {\r\n\t\t\tvar self = this,\r\n\t\t\t\trenderData = self.mapFormElsData(),\r\n\t\t\t\ttpl = self.get('layoutTpl'),\r\n\t\t\t\tbtnTpl = self.get('btnTpl'),\r\n\t\t\t\thtm = tpl(renderData);\r\n\t\t\tself.modal._.body.html(htm);\r\n\t\t\tself.modal._.footer.html(btnTpl({\r\n\t\t\t\tbtns : [\r\n\t\t\t\t\t{clz : 'btn-default', name : 'cancel', label : '取消'},\r\n\t\t\t\t\t{clz : 'btn-warning', name : 'submit', label : '立即提现'}\r\n\t\t\t\t]\r\n\t\t\t}));\r\n\t\t},\r\n\t\tbindEvent : function () {\r\n\t\t\tvar self = this;\r\n\t\t\tthis.on({\r\n\t\t\t\tshow : function () {\r\n\t\t\t\t\tthis.modal.show();\r\n\t\t\t\t},\r\n\t\t\t\thide : function () {\r\n\t\t\t\t\tthis.modal.hide();\r\n\t\t\t\t\tthis.parentView.emit('updateSettleBalance', self.model);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\tself.modal._.dialog.find('.btn').on('click', function (e) {\r\n\t\t\t\tvar $btn = $(this),\r\n\t\t\t\t\tact = $btn.attr('name');\r\n\t\t\t\tif (act == 'cancel') {\r\n\t\t\t\t\tself.emit('hide');\r\n\t\t\t\t} else {\r\n\t\t\t\t\tvar bv = self.modal._.body.find('form').data('bootstrapValidator');\r\n\t\t\t\t\t$btn.button('提交中...');\r\n\t\t\t\t\tbv.validate();\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\tself.modal._.body.find('form').bootstrapValidator({\r\n\t\t\t\ttrigger : 'blur',\r\n\t\t\t\tfields : {\r\n\t\t\t\t\ttransAmount : {\r\n\t\t\t\t\t\tvalidators : {\r\n\t\t\t\t\t\t\tnotEmpty : {\r\n\t\t\t\t\t\t\t\tmessage : \"提现金额不能为空\"\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\tnumeric : {\r\n\t\t\t\t\t\t\t\tmessage: \"提现金额必须为数字\"\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\tgreaterThan : {\r\n\t\t\t\t\t\t\t\tinclusive : false,\r\n\t\t\t\t\t\t\t\tvalue : 0,\r\n\t\t\t\t\t\t\t\tmessage : \"提现金额必须大于0\"\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\tlessThan : {\r\n\t\t\t\t\t\t\t\tinclusive : true,\r\n\t\t\t\t\t\t\t\tvalue : self.model.get('settleBalance')\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\taccuracy : {\r\n\t\t\t\t\t\t\t\taccuracy : 2,\r\n\t\t\t\t\t\t\t\tmessage : \"输入现金只能精确到小数点后2位\"\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}).on('error.field.bv', function (e, data) {\r\n\t\t\t\tvar $form = $(e.target),\r\n\t\t\t\t\tbv = $form.data('bootstrapValidator');\r\n\t\t\t}).on('success.form.bv', function (e, data) {\r\n\t\t\t\te.preventDefault();\r\n\t\t\t\tvar $form = $(e.target),\r\n\t\t\t\t\tbv = $form.data('bootstrapValidator');\r\n\t\t\t\tvar formParams = self.serializeForm();\r\n\t\t\t\tself.model.emit('withdrawCash', {\r\n\t\t\t\t\tparams : formParams,\r\n\t\t\t\t\tfailFn : function () {\r\n\t\t\t\t\t\tself.modal._.footer.find('.btn[name=submit]').button('reset');\r\n\t\t\t\t\t},\r\n\t\t\t\t\tsuccessFn : function () {\r\n\t\t\t\t\t\tself.modal._.footer.find('.btn[name=submit]').button('reset');\r\n\t\t\t\t\t\tself.emit('hide');\r\n\t\t\t\t\t}\r\n\t\t\t\t})\r\n\t\t\t});\r\n\t\t},\r\n\t\tserializeForm : function () {\r\n\t\t\tvar self = this,\r\n\t\t\t\t$body = self.modal._.body;\r\n\t\t\treturn {\r\n\t\t\t\ttransAmount : $body.find('#transAmount').val()\r\n\t\t\t};\r\n\t\t}\r\n\r\n\t});\r\n\r\n\tHualala.Account.WithdrawCashView = WithdrawCashView;\r\n\r\n\tvar QueryTransFormElsCfg = {\r\n\t\ttransCreateTime : {\r\n\t\t\ttype : 'section',\r\n\t\t\tlabel : '日期',\r\n\t\t\tmin : {\r\n\t\t\t\ttype : 'datetimepicker',\r\n\t\t\t\tsurfix : '<span class=\"glyphicon glyphicon-calendar\"></span>',\r\n\t\t\t\tdefaultVal : '',\r\n\t\t\t\tvalidCfg : {\r\n\t\t\t\t\tgroup : '.min-input',\r\n\t\t\t\t\tvalidators : {}\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tmax : {\r\n\t\t\t\ttype : 'datetimepicker',\r\n\t\t\t\tsurfix : '<span class=\"glyphicon glyphicon-calendar\"></span>',\r\n\t\t\t\tdefaultVal : '',\r\n\t\t\t\tvalidCfg : {\r\n\t\t\t\t\tgroup : '.max-input',\r\n\t\t\t\t\tvalidators : {}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\ttransAmount : {\r\n\t\t\ttype : 'section',\r\n\t\t\tlabel : '金额',\r\n\t\t\tmin : {\r\n\t\t\t\ttype : 'text',\r\n\t\t\t\tprefix : '￥',\r\n\t\t\t\tsurfix : '元',\r\n\t\t\t\tdefaultVal : '',\r\n\t\t\t\tvalidCfg : {\r\n\t\t\t\t\tvalidators : {\r\n\t\t\t\t\t\tnumeric : {\r\n\t\t\t\t\t\t\tmessage: \"金额必须为数字\"\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\tgreaterThan : {\r\n\t\t\t\t\t\t\tinclusive : true,\r\n\t\t\t\t\t\t\tvalue : 0,\r\n\t\t\t\t\t\t\tmessage : \"金额必须大于或等于0\"\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tmax : {\r\n\t\t\t\ttype : 'text',\r\n\t\t\t\tprefix : '￥',\r\n\t\t\t\tsurfix : '元',\r\n\t\t\t\tdefaultVal : '',\r\n\t\t\t\tvalidCfg : {\r\n\t\t\t\t\tvalidators : {\r\n\t\t\t\t\t\tnumeric : {\r\n\t\t\t\t\t\t\tmessage: \"金额必须为数字\"\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\tgreaterThan : {\r\n\t\t\t\t\t\t\tinclusive : true,\r\n\t\t\t\t\t\t\tvalue : 0,\r\n\t\t\t\t\t\t\tmessage : \"金额必须大于或等于0\"\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\ttransStatus : {\r\n\t\t\ttype : 'combo',\r\n\t\t\tlabel : '状态',\r\n\t\t\tdefaultVal : '',\r\n\t\t\toptions : Hualala.TypeDef.FSMTransStatus,\r\n\t\t\tvalidCfg : {\r\n\t\t\t\tvalidators : {\r\n\t\t\t\t\t\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\ttransType : {\r\n\t\t\ttype : 'combo',\r\n\t\t\tlabel : '类型',\r\n\t\t\tdefaultVal : '',\r\n\t\t\toptions : Hualala.TypeDef.FSMTransType,\r\n\t\t\tvalidCfg : {\r\n\t\t\t\tvalidators : {\r\n\t\t\t\t\t\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\tbutton : {\r\n\t\t\ttype : 'button',\r\n\t\t\tclz : 'btn btn-block btn-warning',\r\n\t\t\tlabel : '查询'\r\n\t\t}\r\n\t};\r\n\tvar QueryTransFormElsHT = new IX.IListManager();\r\n\t_.each(QueryTransFormElsCfg, function (el, k) {\r\n\t\tvar type = $XP(el, 'type');\r\n\t\tvar labelClz = 'col-xs-2 col-sm-2 col-md-2 control-label';\r\n\t\tif (type == 'section') {\r\n\t\t\tvar id = minID = k + '_min_' + IX.id(), maxID = k + '_max_' + IX.id(),\r\n\t\t\t\tminName = k == 'transCreateTime' ? 'transCreateBeginTime' : 'minTransAmount',\r\n\t\t\t\tmaxName = k == 'transCreateTime' ? 'transCreateEndTime' : 'maxTransAmount',\r\n\t\t\t\tmin = IX.inherit($XP(el, 'min', {}), {\r\n\t\t\t\t\tid : minID, name : minName, clz : 'col-xs-5 col-sm-5 col-md-5',\r\n\t\t\t\t}), max = IX.inherit($XP(el, 'max', {}), {\r\n\t\t\t\t\tid : maxID, name : maxName, clz : 'col-xs-5 col-sm-5 col-md-5',\r\n\t\t\t\t});\r\n\t\t\tQueryTransFormElsHT.register(k, IX.inherit(el, {\r\n\t\t\t\tid : id,\r\n\t\t\t\tlabelClz : labelClz,\r\n\t\t\t\tmin : min,\r\n\t\t\t\tmax : max\r\n\t\t\t}));\r\n\t\t} else {\r\n\t\t\tQueryTransFormElsHT.register(k, IX.inherit(el, {\r\n\t\t\t\tid : k + '_' + IX.id(),\r\n\t\t\t\tname : k,\r\n\t\t\t\tlabelClz : labelClz,\r\n\t\t\t}, $XP(el, 'type') !== 'button' ? {clz : 'col-xs-5 col-sm-8 col-md-5'} : null));\r\n\t\t}\r\n\t});\r\n\tvar TransResultCols = [\r\n\t\t{clz : '', label : '时间'},\r\n\t\t{clz : '', label : '流水号'},\r\n\t\t{clz : '', label : '交易状态'},\r\n\t\t{clz : '', label : '交易类型'},\r\n\t\t{clz : '', label : '交易金额'},\r\n\t\t{clz : '', label : '佣金'},\r\n\t\t{clz : '', label : '手续费'},\r\n\t\t{clz : '', label : '余额变动'},\r\n\t\t{clz : '', label : '交易后余额'},\r\n\t\t{clz : '', label : '操作'}\r\n\t];\r\n\r\n\tvar AccountTransListView = CardListView.subclass({\r\n\t\tconstructor : function () {\r\n\t\t\t// View层容器\r\n\t\t\tthis.$container = null;\r\n\t\t\t// 查询表单\r\n\t\t\tthis.$queryForm = null;\r\n\t\t\t// 结果容器\r\n\t\t\tthis.$resultBox = null;\r\n\t\t\t// 分页容器\r\n\t\t\tthis.$pager = null;\r\n\t\t\tthis.loadTemplates();\r\n\t\t}\r\n\t});\r\n\tAccountTransListView.proto({\r\n\t\tloadTemplates : function () {\r\n\t\t\tvar layoutTpl = Handlebars.compile(Hualala.TplLib.get('tpl_account_detail')),\r\n\t\t\t\ttableTpl = Handlebars.compile(Hualala.TplLib.get('tpl_transaQuery_result'));\r\n\t\t\tHandlebars.registerPartial(\"transaQueryForm\", Hualala.TplLib.get('tpl_transaQuery_form'));\r\n\t\t\tHandlebars.registerPartial(\"transaQueryResult\", Hualala.TplLib.get('tpl_transaQuery_result'));\r\n\t\t\tHandlebars.registerHelper('checkFormElementType', function (conditional, options) {\r\n\t\t\t\treturn (conditional == options.hash.type) ? options.fn(this) : options.inverse(this);\r\n\t\t\t});\r\n\t\t\tHandlebars.registerHelper('chkColType', function (conditional, options) {\r\n\t\t\t\treturn (conditional == options.hash.type) ? options.fn(this) : options.inverse(this);\r\n\t\t\t});\r\n\t\t\tthis.set({\r\n\t\t\t\tlayoutTpl : layoutTpl,\r\n\t\t\t\ttableTpl : tableTpl\r\n\t\t\t});\r\n\t\t},\r\n\t\tinitLayout : function () {\r\n\t\t\tvar layoutTpl = this.get('layoutTpl');\r\n\t\t\tvar result = [],\r\n\t\t\t\ttblClz = 'table-striped table-hover',\r\n\t\t\t\ttblHeaders = TransResultCols,\r\n\t\t\t\tquery = {cols : [\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tcolClz : 'col-sm-6',\r\n\t\t\t\t\t\titems : QueryTransFormElsHT.getByKeys(['transCreateTime', 'transAmount'])\r\n\t\t\t\t\t},\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tcolClz : 'col-sm-4',\r\n\t\t\t\t\t\titems : QueryTransFormElsHT.getByKeys(['transType', 'transStatus'])\r\n\t\t\t\t\t},\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tcolClz : 'col-sm-2',\r\n\t\t\t\t\t\titems : QueryTransFormElsHT.getByKeys(['button'])\r\n\t\t\t\t\t}\r\n\t\t\t\t]};\r\n\t\t\tvar htm = layoutTpl({\r\n\t\t\t\tquery : query,\r\n\t\t\t\tresult : {\r\n\t\t\t\t\tclz : tblClz,\r\n\t\t\t\t\tthead : tblHeaders,\r\n\t\t\t\t\trows : result\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\tthis.$container.html(htm);\r\n\t\t\tthis.$queryForm = this.$container.find('.query-form');\r\n\t\t\tthis.$resultBox = this.$container.find('.query-result');\r\n\t\t\tthis.$pager = this.$container.find('.page-selection');\r\n\t\t\tthis.render();\r\n\t\t\tthis.initPager();\r\n\t\t\tthis.initQueryEls();\r\n\t\t\tthis.bindEvent();\r\n\t\t\tthis.bindQueryEvent();\r\n\t\t},\r\n\t\tinitQueryEls : function () {\r\n\t\t\tvar self = this;\r\n\t\t\tself.$queryForm.find('[data-type=datetimepicker]').datetimepicker({\r\n\t\t\t\tformat : 'yyyy/mm/dd',\r\n\t\t\t\tstartDate : '2010/01/01',\r\n\t\t\t\tautoclose : true,\r\n\t\t\t\tminView : 'month',\r\n\t\t\t\ttodayBtn : true,\r\n\t\t\t\ttodayHighlight : true,\r\n\t\t\t\tlanguage : 'zh-CN'\r\n\t\t\t});\r\n\t\t\tself.$queryForm.on('click', '.input-group-addon', function (e) {\r\n\t\t\t\tvar $this = $(this),\r\n\t\t\t\t\t$picker = $this.prev(':text[data-type=datetimepicker]');\r\n\t\t\t\tif ($picker.length > 0) {\r\n\t\t\t\t\t$picker.datetimepicker('show');\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t},\r\n\t\tbindEvent : function () {\r\n\t\t\tvar self = this;\r\n\t\t\tself.$resultBox.tooltip({\r\n\t\t\t\tselector : '[title]'\r\n\t\t\t});\r\n\t\t\tself.$resultBox.on('click', '.btn[data-href]', function (e) {\r\n\t\t\t\tvar $btn = $(this),\r\n\t\t\t\t\tpath = $btn.attr('data-href');\r\n\t\t\t\tdocument.location.href = path;\r\n\t\t\t});\r\n\t\t\tself.$pager.on('page', function (e, pageNo) {\r\n\t\t\t\tvar params = self.model.getPagerParams();\r\n\t\t\t\tparams['pageNo'] = pageNo;\r\n\t\t\t\tself.model.emit('load', IX.inherit(params, {\r\n\t\t\t\t\tpageNo : $XP(params, 'pageNo', 1),\r\n\t\t\t\t\tpageSize : $XP(params, 'pageSize', 15)\r\n\t\t\t\t}));\r\n\t\t\t});\r\n\t\t},\r\n\t\tbindQueryEvent : function () {\r\n\t\t\tvar self = this;\r\n\t\t\tself.$resultBox.on('click', 'a[data-orderkey]', function (e) {\r\n\t\t\t\tvar $btn = $(this),\r\n\t\t\t\t\torderKey = $btn.attr('data-orderkey') || '',\r\n\t\t\t\t\ttransType = $btn.attr('data-type') || '',\r\n\t\t\t\t\ttransID = $btn.attr('data-id') || '',\r\n\t\t\t\t\torderID = $btn.attr('data-orderid') || '';\r\n\t\t\t\t// TODO show transaction detail modal\r\n\t\t\t\tvar detail = new Hualala.Account.AccountTransDetailModal({\r\n\t\t\t\t\ttriggerEl : $btn,\r\n\t\t\t\t\torderKey : orderKey,\r\n\t\t\t\t\torderID : orderID,\r\n\t\t\t\t\ttransType : transType,\r\n\t\t\t\t\ttransID : transID\r\n\t\t\t\t});\r\n\t\t\t});\r\n\t\t\tself.$queryForm.on('click', '.btn', function (e) {\r\n\t\t\t\t// TODO Update modal params and render query result\r\n\t\t\t\tvar params = self.getQueryFormParams();\r\n\t\t\t\tself.model.emit('load', params);\r\n\t\t\t});\r\n\t\t},\r\n\t\tgetQueryFormParams : function () {\r\n\t\t\tvar self = this;\r\n\t\t\t// var formKeys = ['transCreateBeginTime', 'transCreateEndTime', 'minTransAmount', 'maxTransAmount', 'transType', 'transStatus'];\r\n\t\t\tvar params = self.$queryForm.find('>form').serializeArray();\r\n\t\t\tvar ret = {};\r\n\t\t\t_.each(params, function (el, i) {\r\n\t\t\t\tvar k = $XP(el, 'name'), v = $XP(el, 'value', '');\r\n\t\t\t\tswitch(k) {\r\n\t\t\t\t\tcase 'transCreateBeginTime':\r\n\t\t\t\t\tcase 'transCreateEndTime':\r\n\t\t\t\t\t\tif (IX.isEmpty(v)) {\r\n\t\t\t\t\t\t\tv = '';\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tv = IX.Date.getDateByFormat(v, 'yyyyMMddHHmmss');\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tdefault :\r\n\t\t\t\t\t\tv = IX.isEmpty(v) ? '' : v;\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t\tret[k] = v;\r\n\t\t\t});\r\n\t\t\tconsole.info(ret);\r\n\t\t\treturn ret;\r\n\t\t},\r\n\t\tmapTimeData : function (s) {\r\n\t\t\tvar r = {value : '', text : ''};\r\n\t\t\tvar s1 = '';\r\n\t\t\tif (IX.isString(s) && s.length > 0) {\r\n\t\t\t\ts1 = s.replace(/([\\d]{4})([\\d]{2})([\\d]{2})([\\d]{2})([\\d]{2})([\\d]{2})/g, '$1/$2/$3 $4:$5:$6');\r\n\t\t\t\ts1 = IX.Date.getDateByFormat(s1, 'yyyy/MM/dd HH:mm');\r\n\t\t\t\tr = IX.inherit({value : s, text : s1});\r\n\t\t\t}\r\n\t\t\treturn r;\r\n\t\t},\r\n\t\tmapTransStatus : function (s) {\r\n\t\t\ts = (s + \"\") || '';\r\n\t\t\tvar status = Hualala.TypeDef.FSMTransStatus;\r\n\t\t\tvar m = _.filter(status, function (el) {\r\n\t\t\t\treturn $XP(el, 'value', '') == s;\r\n\t\t\t});\r\n\t\t\tif (s.length == 0 || m.length == 0) {\r\n\t\t\t\treturn {text : '', value : ''};\r\n\t\t\t}\r\n\t\t\treturn {text : $XP(m[0], 'label', ''), value : $XP(m[0], 'value', '')};\r\n\t\t},\r\n\t\tmapTransType : function (s) {\r\n\t\t\ts = s || '';\r\n\t\t\tvar types = Hualala.TypeDef.FSMTransType;\r\n\t\t\tvar m = _.filter(types, function (el) {\r\n\t\t\t\treturn $XP(el, 'value', '') == s;\r\n\t\t\t});\r\n\t\t\tif (s.length == 0 || m.length == 0) {\r\n\t\t\t\treturn {text : '', value : ''};\r\n\t\t\t}\r\n\t\t\treturn {text : $XP(m[0], 'label', ''), value : $XP(m[0], 'value', '')};\r\n\t\t},\r\n\t\tmapCashData : function (s) {\r\n\t\t\treturn {text : Hualala.Common.Math.prettyNumeric(s), value : s};\r\n\t\t},\r\n\t\tmapTransChanged : function (r) {\r\n\t\t\tvar transAmount = $XP(r, 'transAmount', 0),\r\n\t\t\t\ttransSalesCommission = $XP(r, 'transSalesCommission', 0),\r\n\t\t\t\ttransPoundage = $XP(r, 'transPoundage', 0),\r\n\t\t\t\ttransChanged = transAmount - transSalesCommission - transPoundage;\r\n\t\t\treturn {value : transChanged, text : transChanged};\r\n\t\t},\r\n\t\tmapColsRenderData : function (row) {\r\n\t\t\tvar self = this;\r\n\t\t\tvar colKeys = 'transCreateTime,SUATransItemID,transStatus,transType,transAmount,transSalesCommission,transPoundage,transChanged,transAfterBalance,rowControl';\r\n\t\t\tvar col = {clz : '', type : 'text'};\r\n\r\n\t\t\tvar cols = _.map(colKeys.split(','), function (k, i) {\r\n\t\t\t\tvar r = null;\r\n\t\t\t\tswitch(k) {\r\n\t\t\t\t\tcase 'transCreateTime':\r\n\t\t\t\t\t\tr = self.mapTimeData($XP(row, k, ''));\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 'SUATransItemID':\r\n\t\t\t\t\t\tr = {value : $XP(row, k, ''), text : $XP(row, k, '')};\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 'transStatus':\r\n\t\t\t\t\t\tr = self.mapTransStatus($XP(row, k, ''));\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 'transType':\r\n\t\t\t\t\t\tr = self.mapTransType($XP(row, k, ''));\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 'transAmount':\r\n\t\t\t\t\tcase 'transSalesCommission':\r\n\t\t\t\t\tcase 'transPoundage':\r\n\t\t\t\t\tcase 'transAfterBalance':\r\n\t\t\t\t\t\tr = self.mapCashData($XP(row, k, ''));\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 'transChanged':\r\n\t\t\t\t\t\tr = self.mapTransChanged(row);\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 'rowControl':\r\n\t\t\t\t\t\tvar transType = $XP(row, 'transType', ''),\r\n\t\t\t\t\t\t\ttransStatus = $XP(row, 'transStatus', '');\r\n\t\t\t\t\t\tvar hideBtnTransType = \"104,199,202,204,205,206,299\";\r\n\t\t\t\t\t\tr = {\r\n\t\t\t\t\t\t\ttype : 'button',\r\n\t\t\t\t\t\t\tbtnClz : (hideBtnTransType.indexOf(transType) >= 0 || (transType == \"203\" && transStatus < 1)) ? 'hidden' : '',\r\n\t\t\t\t\t\t\tlabel : '查看',\r\n\t\t\t\t\t\t\tSUATransItemID : $XP(row, 'SUATransItemID', ''),\r\n\t\t\t\t\t\t\ttransType : transType,\r\n\t\t\t\t\t\t\torderKey : $XP(row, 'orderKey', ''),\r\n\t\t\t\t\t\t\torderID : $XP(row, 'orderID', '')\r\n\t\t\t\t\t\t};\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t\treturn IX.inherit(col, r);\r\n\t\t\t});\r\n\t\t\treturn cols;\r\n\t\t},\r\n\t\tmapRenderData : function (data) {\r\n\t\t\tvar self = this;\r\n\t\t\tvar tblClz = 'table-striped table-hover',\r\n\t\t\t\ttblHeaders = TransResultCols;\r\n\t\t\tvar rows = _.map(data, function (row) {\r\n\t\t\t\treturn {\r\n\t\t\t\t\tclz : '',\r\n\t\t\t\t\tcols : self.mapColsRenderData(row)\r\n\t\t\t\t};\r\n\t\t\t});\r\n\t\t\treturn {\r\n\t\t\t\tclz : tblClz,\r\n\t\t\t\tthead : tblHeaders,\r\n\t\t\t\trows : rows\r\n\t\t\t};\r\n\t\t},\r\n\t\trender : function () {\r\n\t\t\tvar self = this,\r\n\t\t\t\tmodel = self.model,\r\n\t\t\t\tpagerParams = model.getPagerParams(),\r\n\t\t\t\tpageNo = $XP(pagerParams, 'pageNo');\r\n\t\t\tvar results = model.getDataByPageNo(pageNo);\r\n\t\t\tvar renderData = self.mapRenderData(results);\r\n\t\t\tvar tableTpl = self.get('tableTpl');\r\n\t\t\tvar html = tableTpl(renderData);\r\n\t\t\tself.$resultBox.empty();\r\n\t\t\tself.$resultBox.html(html);\r\n\t\t\tself.initPager({\r\n\t\t\t\ttotal : model.get('pageCount'),\r\n\t\t\t\tpage : model.get('pageNo'),\r\n\t\t\t\thref : 'javascript:void(0);'\r\n\t\t\t});\r\n\t\t}\r\n\t});\r\n\tHualala.Account.AccountTransListView = AccountTransListView;\r\n\r\n\tvar AccountQueryShopView = Hualala.Shop.QueryView.subclass({\r\n\t\tconstructor : Hualala.Shop.QueryView.prototype.constructor\r\n\t});\r\n\tHualala.Account.AccountQueryShopView = AccountQueryShopView;\r\n\r\n\tvar AccountQueryShopResultView = CardListView.subclass({\r\n\t\tconstructor : CardListView.prototype.constructor\r\n\t});\r\n\tAccountQueryShopResultView.proto({\r\n\t\tloadTemplates : function () {\r\n\t\t\tvar layoutTpl = Handlebars.compile(Hualala.TplLib.get('tpl_shop_list_layout')),\r\n\t\t\t\tlistTpl = Handlebars.compile(Hualala.TplLib.get('tpl_shop_list')),\r\n\t\t\t\titemTpl = Handlebars.compile(Hualala.TplLib.get('tpl_shop_table'));\r\n\t\t\t// 注册shopCard子模板\r\n\t\t\tHandlebars.registerPartial(\"shopTable\", Hualala.TplLib.get('tpl_shop_table'));\r\n\r\n\t\t\tthis.set({\r\n\t\t\t\tlayoutTpl : layoutTpl,\r\n\t\t\t\tlistTpl : listTpl,\r\n\t\t\t\titemTpl : itemTpl\r\n\t\t\t});\r\n\t\t},\r\n\t\t// 格式化渲染数据\r\n\t\tmapRenderData : function (data) {\r\n\t\t\tvar self = this;\r\n\t\t\t\r\n\t\t\tvar ret = _.map(data, function (shop, i, l) {\r\n\t\t\t\treturn {\r\n\t\t\t\t\tclz : '',\r\n\t\t\t\t\tid : $XP(shop, 'shopID', ''),\r\n\t\t\t\t\tname : $XP(shop, 'shopName', ''),\r\n\t\t\t\t\tcity : $XP(shop, 'cityName', '')\r\n\t\t\t\t};\r\n\t\t\t});\r\n\t\t\treturn {\r\n\t\t\t\tshopTable : {\r\n\t\t\t\t\trows : ret\r\n\t\t\t\t}\r\n\t\t\t};\r\n\t\t},\r\n\t\trender : function () {\r\n\t\t\tvar self = this,\r\n\t\t\t\tmodel = self.model,\r\n\t\t\t\tpagerParams = model.getPagerParams(),\r\n\t\t\t\tpageNo = $XP(pagerParams, 'pageNo');\r\n\t\t\tvar shops = model.getShops(pageNo);\r\n\t\t\tvar renderData = self.mapRenderData(shops);\r\n\t\t\tvar listTpl = self.get('listTpl');\r\n\t\t\tvar html = listTpl(renderData);\r\n\t\t\tself.$list.empty();\r\n\t\t\tself.$list.html(html);\r\n\t\t\tself.initPager({\r\n\t\t\t\ttotal : model.get('pageCount'),\r\n\t\t\t\tpage : model.get('pageNo'),\r\n\t\t\t\thref : 'javascript:void(0);'\r\n\t\t\t});\r\n\t\t}\r\n\t});\r\n\tHualala.Account.AccountQueryShopResultView = AccountQueryShopResultView;\r\n})(jQuery, window);;(function ($, window) {\r\n\tIX.ns(\"Hualala.Account\");\r\n\tvar popoverMsg = Hualala.UI.PopoverMsgTip;\r\n\tvar toptip = Hualala.UI.TopTip;\r\n\tvar AccountListModel = Hualala.Account.AccountListModel;\r\n\tvar AccountListView = Hualala.Account.AccountListView;\r\n\tvar ShopListController = Hualala.Shop.ShopListController;\r\n\r\n\tvar QueryModel = Hualala.Shop.QueryModel;\r\n\tvar QueryView = Hualala.Shop.QueryView;\r\n\tvar QueryController = Hualala.Shop.QueryController;\r\n\r\n\tvar AccountListController = ShopListController.subclass({\r\n\t\t/**\r\n\t\t * 结算账户列表控制器\r\n\t\t * @param  {Object} cfg 配置参数\r\n\t\t *          @param {JQueryObj} container 容器\r\n\t\t *          @param {Object} view  结果的View模块实例\r\n\t\t *          @param {Object} model 结果的数据模块实例\r\n\t\t * @return {Object}     \r\n\t\t */\r\n\t\tconstructor : ShopListController.prototype.constructor\r\n\t});\r\n\r\n\r\n\tHualala.Account.AccountListController = AccountListController;\r\n\r\n\tvar AccountQueryShopController = QueryController.subclass({\r\n\t\tconstructor : function (cfg) {\r\n\t\t\tthis.set({\r\n\t\t\t\tsessionData : Hualala.getSessionData()\r\n\t\t\t});\r\n\t\t\tthis.container = $XP(cfg, 'container', null);\r\n\t\t\tthis.needShopCreate = false;\r\n\t\t\tthis.model = new Hualala.Account.AccountQueryShopModel();\r\n\t\t\tthis.view = new Hualala.Account.AccountQueryShopView();\r\n\t\t\tthis.resultContainer = $XP(cfg, 'resultContainer', null);\r\n\t\t\tthis.resultController = new Hualala.Account.AccountQueryShopResultController({\r\n\t\t\t\tcontainer : this.resultContainer,\r\n\t\t\t\tmodel : new Hualala.Account.AccountQueryShopResultModel(),\r\n\t\t\t\tview : new Hualala.Account.AccountQueryShopResultView()\r\n\t\t\t})\r\n\t\t\tthis.init();\r\n\t\t}\r\n\t});\r\n\tAccountQueryShopController.proto({\r\n\t\tinit : function () {\r\n\t\t\tvar self = this;\r\n\t\t\tself.bindEvent();\r\n\t\t\tself.model.emit('load', function () {\r\n\t\t\t\tif (!self.model.hasReady()) {\r\n\t\t\t\t\tthrow(\"Shop Query Init Failed!!\");\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\tself.resultController.initDataStore(self.model.getShops());\r\n\t\t\t\t// 加载View层\r\n\t\t\t\tself.view.emit('init');\r\n\t\t\t\t\r\n\t\t\t});\r\n\t\t},\r\n\t});\r\n\tHualala.Account.AccountQueryShopController = AccountQueryShopController;\r\n\r\n\tvar AccountQueryShopResultController = Hualala.Shop.ShopListController.subclass({\r\n\t\tconstructor : Hualala.Shop.ShopListController.prototype.constructor\r\n\t});\r\n\tAccountQueryShopResultController.proto({\r\n\t\tinitDataStore : function (data) {\r\n\t\t\tthis.model.initDataStore(data);\r\n\t\t},\r\n\t\tbindEvent : function () {\r\n\t\t\tthis.on({\r\n\t\t\t\tload : function (params) {\r\n\t\t\t\t\tvar self = this;\r\n\t\t\t\t\tif (!self.hasReady()) {\r\n\t\t\t\t\t\tself.init(params);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tself.model.emit('load', params);\r\n\t\t\t\t}\r\n\t\t\t}, this);\r\n\t\t\tthis.model.on({\r\n\t\t\t\tload : function (params) {\r\n\t\t\t\t\tvar self = this;\r\n\t\t\t\t\tvar cbFn = function () {\r\n\t\t\t\t\t\tself.view.emit('render');\r\n\t\t\t\t\t};\r\n\t\t\t\t\tself.model.load(params, cbFn);\r\n\t\t\t\t}\r\n\t\t\t}, this);\r\n\t\t\tthis.view.on({\r\n\t\t\t\trender : function () {\r\n\t\t\t\t\tvar self = this;\r\n\t\t\t\t\tself.view.render();\r\n\t\t\t\t},\r\n\t\t\t\treloadPager : function () {\r\n\t\t\t\t\tvar self = this;\r\n\t\t\t\t\tself.view.initPager(params);\r\n\t\t\t\t}\r\n\t\t\t}, this);\r\n\t\t}\r\n\t});\r\n\tHualala.Account.AccountQueryShopResultController = AccountQueryShopResultController;\r\n\t\r\n})(jQuery, window);;(function ($, window) {\r\n\tIX.ns(\"Hualala.Account\");\r\n\tvar popoverMsg = Hualala.UI.PopoverMsgTip;\r\n\tvar toptip = Hualala.UI.TopTip;\r\n\tvar BaseAccountModel = Hualala.Account.BaseAccountModel;\r\n\r\n\t/*账户管理控制器*/\r\n\tvar AccountMgrController = Stapes.subclass({\r\n\t\t/**\r\n\t\t * 构造控制器\r\n\t\t * @param  {Object} cfg {container, settleUnitID, accountModel, mgrView, transaDetailCtrl}\r\n\t\t * @return {Object}     AccountMgrController实例\r\n\t\t */\r\n\t\tconstructor : function (cfg) {\r\n\t\t\tthis.container = $XP(cfg, 'container', null);\r\n\t\t\tthis.settleUnitID = $XP(cfg, 'settleUnitID', null);\r\n\t\t\tthis.model = $XP(cfg, 'accountModel', null);\r\n\t\t\tthis.view = $XP(cfg, 'mgrView', null);\r\n\t\t\tthis.transaDetailCtrl = $XP(cfg, 'transaDetailCtrl', null);\r\n\t\t\tif (!this.container || !this.model || !this.view || !this.transaDetailCtrl) {\r\n\t\t\t\tthrow(\"Account Detail Mgr Init Failed!!\");\r\n\t\t\t\treturn ;\r\n\t\t\t}\r\n\t\t\tthis.init();\r\n\t\t}\r\n\t});\r\n\tAccountMgrController.proto({\r\n\t\t// 初始化控制器\r\n\t\tinit : function () {\r\n\t\t\tvar self = this;\r\n\t\t\tself.bindEvent();\r\n\t\t\tself.model.emit('load', {\r\n\t\t\t\tsettleUnitID : self.settleUnitID,\r\n\t\t\t\tcbFn : function () {\r\n\t\t\t\t\tself.view.emit('init', {\r\n\t\t\t\t\t\tmodel : self.model,\r\n\t\t\t\t\t\tcontainer : self.container\r\n\t\t\t\t\t});\r\n\t\t\t\t\tself.view.emit('render');\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t},\r\n\t\t// 控制器绑定事件\r\n\t\tbindEvent : function () {\r\n\t\t\tthis.on({\r\n\t\t\t\t// 触发交易明细控制器进行查询\r\n\t\t\t\tquery : function () {\r\n\t\t\t\t\tvar self = this;\r\n\t\t\t\t\t\r\n\t\t\t\t}\r\n\t\t\t}, this);\r\n\t\t\t\r\n\t\t\tthis.view.on({\r\n\t\t\t\tinit : function (params) {\r\n\t\t\t\t\tvar self = this;\r\n\t\t\t\t\tself.view.init(params);\r\n\t\t\t\t\tself.transaDetailCtrl.init({\r\n\t\t\t\t\t\tcontainer : self.container.find('.account-detail-box'),\r\n\t\t\t\t\t\tsettleUnitID : self.settleUnitID\r\n\t\t\t\t\t});\r\n\t\t\t\t},\r\n\t\t\t\trender : function () {\r\n\t\t\t\t\tvar self = this;\r\n\t\t\t\t\tself.view.render();\r\n\t\t\t\t}\r\n\t\t\t}, this);\r\n\t\t}\r\n\t});\r\n\r\n\tHualala.Account.AccountMgrController = AccountMgrController; \r\n\r\n\t/*交易明细控制器*/\r\n\tvar TransactionDetailController = Stapes.subclass({\r\n\t\tconstructor: function () {\r\n\t\t\tthis.set({\r\n\t\t\t\tsessionData : Hualala.getSessionData()\r\n\t\t\t});\r\n\t\t\tthis.container = null;\r\n\t\t\tthis.settleUnitID = null;\r\n\t\t\tthis.model = new Hualala.Account.AccountTransListModel();\r\n\t\t\tthis.view = new Hualala.Account.AccountTransListView();\r\n\t\t\t\r\n\t\t}\r\n\t});\r\n\tTransactionDetailController.proto({\r\n\t\tinit : function (cfg) {\r\n\t\t\tvar self = this;\r\n\t\t\tself.container = $XP(cfg, 'container', null);\r\n\t\t\tself.settleUnitID = $XP(cfg, 'settleUnitID', '');\r\n\t\t\tif (!this.container || !this.model || !this.view) {\r\n\t\t\t\tthrow(\"Account Transaction Detail Mgr Init Failed!!\");\r\n\t\t\t\treturn ;\r\n\t\t\t}\r\n\t\t\tself.bindEvent();\r\n\t\t\tself.model.init({\r\n\t\t\t\t\r\n\t\t\t\tgroupID : $XP(self.get('sessionData'), 'site.groupID'),\r\n\t\t\t\tsettleUnitID : self.settleUnitID\r\n\t\t\t});\r\n\t\t\tself.model.emit('load', {\r\n\t\t\t\tpageNo : 1, pageSize : 15,\r\n\t\t\t\tcbFn : function (model) {\r\n\t\t\t\t\tself.view.emit('init', {\r\n\t\t\t\t\t\tcontainer : self.container,\r\n\t\t\t\t\t\tmodel : model\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t},\r\n\t\tbindEvent : function () {\r\n\t\t\tthis.model.on({\r\n\t\t\t\tload : function (params) {\r\n\t\t\t\t\tvar self = this;\r\n\t\t\t\t\tvar cbFn = $XP(params, 'cbFn', function () {\r\n\t\t\t\t\t\tself.view.emit('render');\r\n\t\t\t\t\t});\r\n\t\t\t\t\tthis.model.load(params, cbFn);\r\n\t\t\t\t}\r\n\t\t\t}, this);\r\n\t\t\tthis.view.on({\r\n\t\t\t\tinit : function (cfg) {\r\n\t\t\t\t\tthis.view.init(cfg);\r\n\t\t\t\t},\r\n\t\t\t\trender : function () {\r\n\t\t\t\t\tthis.view.render();\r\n\t\t\t\t}\r\n\t\t\t}, this);\r\n\t\t}\r\n\t});\r\n\tHualala.Account.TransactionDetailController = TransactionDetailController;\r\n})(jQuery, window);\r\n;(function ($, window) {\r\n\tIX.ns(\"Hualala.Account\");\r\n\tvar popoverMsg = Hualala.UI.PopoverMsgTip;\r\n\tvar toptip = Hualala.UI.TopTip;\r\n\r\n\tvar AccountActs = [\r\n\t\t{clz : 'btn-success withdraw', act : 'withdraw', label : '提现'},\r\n\t\t{clz : 'btn-link', act : 'edit', label : '修改银行卡'},\r\n\t\t{clz : 'btn-link', act : 'queryShops', label : '查看全部店铺'},\r\n\t\t{clz : 'btn-link', act : 'delete', label : '删除此帐户'}\r\n\t];\r\n\r\n\tvar AccountMgrView = Stapes.subclass({\r\n\t\tconstructor : function () {\r\n\t\t\t// View层容器\r\n\t\t\tthis.$container = null;\r\n\t\t\t// 面包屑导航条\r\n\t\t\tthis.$nav = null;\r\n\t\t\tthis.breadCrumbs = null;\r\n\t\t\t// schema容器\r\n\t\t\tthis.$schema = null;\r\n\t\t\t// 交易详情\r\n\t\t\tthis.$detail = null;\r\n\r\n\t\t\tthis.model = null;\r\n\r\n\t\t\tthis.loadTemplates();\r\n\t\t}\r\n\t});\r\n\r\n\tAccountMgrView.proto({\r\n\t\t/**\r\n\t\t * 初始化View层\r\n\t\t * \r\n\t\t * @param  {Object} cfg {model, container}\r\n\t\t * @return {[type]}\r\n\t\t */\r\n\t\tinit : function (cfg) {\r\n\t\t\tthis.$container = $XP(cfg, 'container', null);\r\n\t\t\tthis.model = $XP(cfg, 'model', null);\r\n\t\t\tif (!this.$container || !this.model) {\r\n\t\t\t\tthrow(\"Account Detail View Init Failed!\");\r\n\t\t\t\treturn ;\r\n\t\t\t}\r\n\t\t\tthis.initLayout();\r\n\t\t},\r\n\t\tinitLayout : function () {\r\n\t\t\tvar layoutTpl = this.get('layoutTpl');\r\n\t\t\tvar htm = layoutTpl();\r\n\t\t\tthis.$container.html(htm);\r\n\t\t\tthis.$nav = this.$container.find('.account-nav');\r\n\t\t\tthis.$schema = this.$container.find('.account-schema-box');\r\n\t\t\tthis.$detail = this.$container.find('.account-detail-box');\r\n\t\t\tthis.bindEvent();\r\n\t\t},\r\n\t\tinitBreadCrumbs : function () {\r\n\t\t\tvar self = this,\r\n\t\t\t\t$nav = self.$nav,\r\n\t\t\t\tparentNames = Hualala.PageRoute.getParentNamesByPath();\r\n\t\t\tself.breadCrumbs = new Hualala.UI.BreadCrumb({\r\n\t\t\t\tcontainer : $nav,\r\n\t\t\t\thideRoot : true,\r\n\t\t\t\tnodes : parentNames,\r\n\t\t\t\tclz : 'account-crumbs',\r\n\t\t\t\tclickFn : function () {\r\n\t\t\t\t\tvar $this = $(this);\r\n\t\t\t\t\tdocument.location.href = $this.attr('data-href');\r\n\t\t\t\t},\r\n\t\t\t\tmapRenderData : function (data, hideRoot, clz) {\r\n\t\t\t\t\tvar list = _.map(data, function (el, idx, l) {\r\n\t\t\t\t\t\tvar label = $XP(el, 'label', ''),\r\n\t\t\t\t\t\t\tname = $XP(el, 'name', ''),\r\n\t\t\t\t\t\t\tpath = Hualala.PageRoute.createPath(name, [self.model.get('settleUnitID')]);\r\n\t\t\t\t\t\treturn {\r\n\t\t\t\t\t\t\tclz : 'crumb',\r\n\t\t\t\t\t\t\tlabel : label,\r\n\t\t\t\t\t\t\tpath : path,\r\n\t\t\t\t\t\t\tname : name,\r\n\t\t\t\t\t\t\tisLastNode : (data.length - 1 == idx) ? true : false\r\n\t\t\t\t\t\t};\r\n\t\t\t\t\t});\r\n\t\t\t\t\thideRoot === true && list.shift();\r\n\t\t\t\t\treturn {\r\n\t\t\t\t\t\tclz : clz,\r\n\t\t\t\t\t\titems : list\r\n\t\t\t\t\t};\r\n\t\t\t\t}\r\n\r\n\t\t\t});\r\n\r\n\t\t},\r\n\t\tloadTemplates : function () {\r\n\t\t\tvar layoutTpl = Handlebars.compile(Hualala.TplLib.get('tpl_accountMgr_layout')),\r\n\t\t\t\tschemaTpl = Handlebars.compile(Hualala.TplLib.get('tpl_account_schema')),\r\n\t\t\t\twithDrawTpl = Handlebars.compile(Hualala.TplLib.get('tpl_withdraw_form'));\r\n\t\t\t// 注册子模版\r\n\t\t\tHandlebars.registerPartial(\"accountCard\", Hualala.TplLib.get('tpl_account_card'));\r\n\t\t\tthis.set({\r\n\t\t\t\tlayoutTpl : layoutTpl,\r\n\t\t\t\tschemaTpl : schemaTpl,\r\n\t\t\t\twithDrawTpl : withDrawTpl\r\n\t\t\t});\r\n\t\t},\r\n\t\tbindEvent : function () {\r\n\t\t\tvar self = this;\r\n\t\t\tself.$schema.on('click', '.btn.withdraw', function (e) {\r\n\t\t\t\tself.withdraw($(this));\r\n\t\t\t});\r\n\t\t\tself.$schema.on('click', '[data-act]', function (e) {\r\n\t\t\t\tvar act = $(this).attr('data-act');\r\n\t\t\t\tvar $btn = $(this);\r\n\t\t\t\tswitch(act) {\r\n\t\t\t\t\tcase 'edit':\r\n\t\t\t\t\t\tself.editAccount($btn);\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 'queryShops':\r\n\t\t\t\t\t\tself.queryShops();\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 'delete':\r\n\t\t\t\t\t\tself.deleteAccount();\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\t\r\n\t\t\tself.on({\r\n\t\t\t\t'updateSettleBalance' : function (mAccount) {\r\n\t\t\t\t\tvar settleUnitID = mAccount.get('settleUnitID'),\r\n\t\t\t\t\t\tsettleBalance = Hualala.Common.Math.prettyNumeric(mAccount.get('settleBalance'));\r\n\t\t\t\t\tself.$container.find('[data-id=' + settleUnitID + '] .cash > strong').html(settleBalance);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t},\r\n\t\teditAccount : function ($trigger) {\r\n\t\t\tconsole.info('editAccount');\r\n\t\t\t// triggerEl, mode, model, parentView\r\n\t\t\tvar editAccount = new AccountEditView({\r\n\t\t\t\ttriggerEl : $trigger,\r\n\t\t\t\tmode : 'edit',\r\n\t\t\t\tmodel : this.model,\r\n\t\t\t\tparentView : this\r\n\t\t\t});\r\n\t\t},\r\n\t\twithdraw : function ($trigger) {\r\n\t\t\tvar self = this;\r\n\t\t\t// console.info('withdraw');\r\n\t\t\t// 提现操作\r\n\t\t\tvar modal = new Hualala.Account.WithdrawCashView({\r\n\t\t\t\ttriggerEl : $trigger,\r\n\t\t\t\tsettleUnitID : self.model.get('settleUnitID'),\r\n\t\t\t\tmodel : self.model,\r\n\t\t\t\tparentView : self\r\n\t\t\t});\r\n\t\t},\r\n\t\tqueryShops : function ($trigger) {\r\n\t\t\tvar self = this;\r\n\t\t\tvar modal = new Hualala.Account.AccountQueryShopModal({\r\n\t\t\t\ttriggerEl : $trigger,\r\n\t\t\t\tsettleUnitID : self.model.get('settleUnitID'),\r\n\t\t\t\tmodel : self.model,\r\n\t\t\t\tparentView : self\r\n\t\t\t});\r\n\t\t\tconsole.info('queryShops');\r\n\t\t},\r\n\t\tdeleteAccount : function () {\r\n\t\t\t// console.info('deleteAccount');\r\n\t\t\tvar self = this;\r\n\t\t\tHualala.UI.Confirm({\r\n\t\t\t\ttitle : '删除结算账户',\r\n\t\t\t\tmsg : '是否删除该账户？',\r\n\t\t\t\tokLabel : '删除',\r\n\t\t\t\tokFn : function () {\r\n\t\t\t\t\tself.model.emit('delete', {\r\n\t\t\t\t\t\tsuccessFn : function (settleUnitID) {\r\n\t\t\t\t\t\t\tdocument.location.href = Hualala.PageRoute.createPath('account', [settleUnitID]);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\t\r\n\t\t},\r\n\t\tmapRenderData : function () {\r\n\t\t\tvar self = this,\r\n\t\t\t\tmodel = self.model,\r\n\t\t\t\tacts = AccountActs,\r\n\t\t\t\tacts1 = _.filter(IX.clone(acts), function (el) {\r\n\t\t\t\t\treturn $XP(el, 'act') != 'withdraw';\r\n\t\t\t\t}),\r\n\t\t\t\taccountCard = null;\r\n\t\t\tvar settleUnitID = model.get('settleUnitID') || '',\r\n\t\t\t\thasDefault = model.get('defaultAccount') == 0 ? false : true,\r\n\t\t\t\tbankInfo = Hualala.Common.mapBankInfo(model.get('bankCode')),\r\n\t\t\t\tbankAccountStr = Hualala.Common.codeMask((model.get('bankAccount') || ''), 0, -4);\r\n\r\n\t\t\taccountCard = {\r\n\t\t\t\tclz : 'pull-left',\r\n\t\t\t\tsettleUnitID : settleUnitID,\r\n\t\t\t\thasDefault : hasDefault,\r\n\t\t\t\tsettleUnitName : model.get('settleUnitName') || '',\r\n\t\t\t\tsettleBalance : parseFloat(model.get('settleBalance') || 0),\r\n\t\t\t\tbankIcon : $XP(bankInfo, 'icon_16', ''),\r\n\t\t\t\tbankComName : $XP(bankInfo, 'name', ''),\r\n\t\t\t\tbankAccountStr : $XP(bankAccountStr, 'val', '').replace(/([\\w|*]{4})/g, '$1 ').replace(/([*])/g, '<span>$1</span>'),\r\n\t\t\t\tshopCount : parseInt(model.get('shopCount') || 0),\r\n\t\t\t\tpath : Hualala.PageRoute.createPath('accountDetail', [settleUnitID]),\r\n\t\t\t\tisDetail : true,\r\n\t\t\t\tacts : IX.map(acts1, function (el, i) {\r\n\t\t\t\t\treturn IX.inherit(el, {\r\n\t\t\t\t\t\tisFirst : i == 0 ? true : false\r\n\t\t\t\t\t});\r\n\t\t\t\t})\r\n\t\t\t};\r\n\t\t\treturn {\r\n\t\t\t\taccountCard : accountCard,\r\n\t\t\t\tacts : _.map(acts, function (el) {\r\n\t\t\t\t\tif ($XP(el, 'act') == 'queryShops') {\r\n\t\t\t\t\t\treturn IX.inherit(el, {\r\n\t\t\t\t\t\t\tlabel : $XP(el, 'label', '') + '(' + parseInt(model.get('shopCount') || 0) + ')'\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn el;\r\n\t\t\t\t})\r\n\t\t\t};\r\n\t\t},\r\n\t\trender : function () {\r\n\t\t\tvar self = this,\r\n\t\t\t\tmodel = self.model,\r\n\t\t\t\trenderData = self.mapRenderData(),\r\n\t\t\t\ttpl = self.get('schemaTpl');\r\n\t\t\tvar htm = tpl(renderData);\r\n\t\t\tself.initBreadCrumbs();\r\n\t\t\tself.$schema.html(htm);\r\n\t\t},\r\n\t\trefresh : function () {\r\n\t\t\tthis.render();\r\n\t\t}\r\n\t});\r\n\t\r\n\tHualala.Account.AccountMgrView = AccountMgrView; \r\n\r\n\r\n\t// 结算账户表单配置\r\n\tvar AccountEditFormElsCfg = {\r\n\t\treceiverType : {\r\n\t\t\ttype : \"radiogrp\",\r\n\t\t\tlabel : \"收款方类型\",\r\n\t\t\tdefaultVal : 2,\r\n\t\t\toptions : Hualala.TypeDef.AccountReceiverTypes,\r\n\t\t\tvalidCfg : {\r\n\t\t\t\tvalidators : {}\r\n\t\t\t}\r\n\t\t},\r\n\t\treceiverName : {\r\n\t\t\ttype : \"text\",\r\n\t\t\tlabel : \"收款单位/姓名\",\r\n\t\t\tdefaultVal : \"\",\r\n\t\t\tvalidCfg : {\r\n\t\t\t\tvalidators : {\r\n\t\t\t\t\tnotEmpty : {\r\n\t\t\t\t\t\tmessage : \"收款单位/姓名不能为空\"\r\n\t\t\t\t\t},\r\n\t\t\t\t\tstringLength : {\r\n\t\t\t\t\t\tmax : 20,\r\n\t\t\t\t\t\tmessage : \"收款单位/姓名不能超过20个字\"\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\tsettleUnitName : {\r\n\t\t\ttype : \"text\",\r\n\t\t\tlabel : \"结算主体名称\",\r\n\t\t\tdefaultVal : \"\",\r\n\t\t\tvalidCfg : {\r\n\t\t\t\tvalidators : {\r\n\t\t\t\t\tnotEmpty : {\r\n\t\t\t\t\t\tmessage : \"结算主体名称不能为空\"\r\n\t\t\t\t\t},\r\n\t\t\t\t\tstringLength : {\r\n\t\t\t\t\t\tmax : 50,\r\n\t\t\t\t\t\tmessage : \"结算主体名称不能超过50个字\"\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\tbankAccount : {\r\n\t\t\ttype : \"text\",\r\n\t\t\tlabel : \"转账账号\",\r\n\t\t\tdefaultVal : \"\",\r\n\t\t\tvalidCfg : {\r\n\t\t\t\tvalidators : {\r\n\t\t\t\t\tnotEmpty : {\r\n\t\t\t\t\t\tmessage : \"转账账号不能为空\"\r\n\t\t\t\t\t},\r\n\t\t\t\t\tstringLength : {\r\n\t\t\t\t\t\tmax : 30,\r\n\t\t\t\t\t\tmessage : \"转账账号不能超过30个字\"\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\tbankCode : {\r\n\t\t\ttype : \"combo\",\r\n\t\t\tlabel : \"转账银行\",\r\n\t\t\tdefaultVal : \"CMB\",\r\n\t\t\toptions : Hualala.TypeDef.BankOptions,\r\n\t\t\tvalidCfg : {\r\n\t\t\t\tvalidators : {\r\n\t\t\t\t\tnotEmpty : {\r\n\t\t\t\t\t\tmessage : \"转账银行不能为空\"\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\tbankName : {\r\n\t\t\ttype : \"text\",\r\n\t\t\tlabel : \"转账分行\",\r\n\t\t\tdefaultVal : \"\",\r\n\t\t\tprefix : '<span class=\"icon-CMB-16\"></span>',\r\n\t\t\tvalidCfg : {\r\n\t\t\t\tvalidators : {\r\n\t\t\t\t\tnotEmpty : {\r\n\t\t\t\t\t\tmessage : \"转账分行不能为空\"\r\n\t\t\t\t\t},\r\n\t\t\t\t\tstringLength : {\r\n\t\t\t\t\t\tmax : 40,\r\n\t\t\t\t\t\tmessage : \"转账分行不能超过40个字\"\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\tremark : {\r\n\t\t\ttype : \"text\",\r\n\t\t\tlabel : \"备注\",\r\n\t\t\tdefaultVal : \"\",\r\n\t\t\tvalidCfg : {\r\n\t\t\t\tvalidators : {\r\n\t\t\t\t\tstringLength : {\r\n\t\t\t\t\t\tmax : 250,\r\n\t\t\t\t\t\tmessage : \"备注不能超过250个字\"\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\tdefaultAccount : {\r\n\t\t\ttype : \"switcher\",\r\n\t\t\tlabel : \"设为默认账户\",\r\n\t\t\tdefaultVal : 1,\r\n\t\t\tonLabel : \"开启\",\r\n\t\t\toffLabel : \"关闭\",\r\n\t\t\tvalidCfg : {\r\n\t\t\t\tvalidators : {}\r\n\t\t\t}\r\n\t\t},\r\n\t\treceiverLinkman : {\r\n\t\t\ttype : \"text\",\r\n\t\t\tlabel : \"姓名\",\r\n\t\t\tdefaultVal : \"\",\r\n\t\t\tprefix : '<span class=\"glyphicon glyphicon-user\"></span>',\r\n\t\t\tvalidCfg : {\r\n\t\t\t\tvalidators : {\r\n\t\t\t\t\tnotEmpty : {\r\n\t\t\t\t\t\tmessage : \"姓名不能为空\"\r\n\t\t\t\t\t},\r\n\t\t\t\t\tstringLength : {\r\n\t\t\t\t\t\tmax : 20,\r\n\t\t\t\t\t\tmessage : \"姓名不能超过20个字\"\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\treceiverMobile : {\r\n\t\t\ttype : \"text\",\r\n\t\t\tlabel : \"手机\",\r\n\t\t\tdefaultVal : \"\",\r\n\t\t\tprefix : '<span class=\"glyphicon glyphicon-phone\"></span>',\r\n\t\t\tvalidCfg : {\r\n\t\t\t\tvalidators : {\r\n\t\t\t\t\tnotEmpty : {\r\n\t\t\t\t\t\tmessage : \"手机不能为空\"\r\n\t\t\t\t\t},\r\n\t\t\t\t\tstringLength : {\r\n\t\t\t\t\t\tmax : 30,\r\n\t\t\t\t\t\tmessage : \"手机不能超过30个字符\"\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\treceiverEmail : {\r\n\t\t\ttype : \"text\",\r\n\t\t\tlabel : \"邮箱\",\r\n\t\t\tdefaultVal : \"\",\r\n\t\t\tprefix : '<span class=\"glyphicon glyphicon-envelope\"></span>',\r\n\t\t\tvalidCfg : {\r\n\t\t\t\tvalidators : {\r\n\t\t\t\t\tstringLength : {\r\n\t\t\t\t\t\tmax : 50,\r\n\t\t\t\t\t\tmessage : \"邮箱不能超过30个字符\"\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n\tvar AccountEditFormElsHT = new IX.IListManager();\r\n\t_.each(AccountEditFormElsCfg, function (el, k) {\r\n\t\tvar type = $XP(el, 'type');\r\n\t\tvar labelClz = 'col-sm-offset-1 col-sm-3 control-label';\r\n\t\tif (type == 'radiogrp') {\r\n\t\t\tvar ops = _.map($XP(el, 'options'), function (op) {\r\n\t\t\t\treturn IX.inherit(op, {\r\n\t\t\t\t\tid : k + '_' + IX.id(),\r\n\t\t\t\t\tname : k,\r\n\t\t\t\t\tclz : 'col-sm-6'\r\n\t\t\t\t});\r\n\t\t\t});\r\n\t\t\tAccountEditFormElsHT.register(k, IX.inherit(el, {\r\n\t\t\t\tid : '',\r\n\t\t\t\toptions : ops,\r\n\t\t\t\tlabelClz : labelClz,\r\n\t\t\t\tclz : 'col-sm-5'\r\n\t\t\t}));\r\n\t\t} else {\r\n\t\t\tAccountEditFormElsHT.register(k, IX.inherit(el, {\r\n\t\t\t\tid : k + '_' + IX.id(),\r\n\t\t\t\tname : k,\r\n\t\t\t\tlabelClz : labelClz,\r\n\t\t\t\tclz : 'col-sm-5'\r\n\t\t\t}));\r\n\t\t}\r\n\t\t\r\n\t});\r\n\t\r\n\t// 结算账户编辑窗口\r\n\tvar AccountEditView = Stapes.subclass({\r\n\t\t/**\r\n\t\t * 结算账户编辑窗口构造器\r\n\t\t * @param  {Object} cfg {triggerEl, mode, model, parentView}\r\n\t\t * \t\t\t\t@param {jQueryObj} triggerEl 出发元素\r\n\t\t * \t\t\t\t@param {String} mode  操作模式add:添加账户模式；edit:编辑模式; read:只读模式\r\n\t\t * \t\t\t\t@param {Object} model 结算账户数据模型\r\n\t\t * \t\t\t\t@param {Object} parentView 父级View层\r\n\t\t * @return {Object}\t\t账户编辑实例\r\n\t\t */\r\n\t\tconstructor : function (cfg) {\r\n\t\t\tthis.$trigger = $XP(cfg, 'trigger', null);\r\n\t\t\tthis.mode = $XP(cfg, 'mode', 'edit');\r\n\t\t\tthis.model = $XP(cfg, 'model', null) || new Hualala.Account.BaseAccountModel();\r\n\t\t\tthis.parentView = $XP(cfg, 'parentView', null);\r\n\t\t\tthis.modal = null;\r\n\t\t\tthis.formKeys = 'receiverType,receiverName,settleUnitName,bankAccount,bankCode,bankName,remark,defaultAccount,receiverLinkman,receiverMobile,receiverEmail'.split(',');\r\n\t\t\tthis.loadTemplates();\r\n\t\t\tthis.initModal();\r\n\t\t\tthis.renderForm();\r\n\t\t\tthis.bindEvent();\r\n\t\t\tthis.emit('show');\r\n\t\t}\r\n\t});\r\n\tAccountEditView.proto({\r\n\t\tloadTemplates : function () {\r\n\t\t\tvar layoutTpl = Handlebars.compile(Hualala.TplLib.get('tpl_account_edit')),\r\n\t\t\t\tbtnTpl = Handlebars.compile(Hualala.TplLib.get('tpl_shop_modal_btns'));\r\n\t\t\tHandlebars.registerHelper('checkFormElementType', function (conditional, options) {\r\n\t\t\t\treturn (conditional == options.hash.type) ? options.fn(this) : options.inverse(this);\r\n\t\t\t});\r\n\t\t\tHandlebars.registerHelper('isInputGroup', function (prefix, surfix, options) {\r\n\t\t\t\treturn (!prefix && !surfix) ? options.inverse(this) : options.fn(this);\r\n\t\t\t});\r\n\t\t\tthis.set({\r\n\t\t\t\tlayoutTpl : layoutTpl,\r\n\t\t\t\tbtnTpl : btnTpl\r\n\t\t\t});\r\n\t\t},\r\n\t\tgetModalTitle : function () {\r\n\t\t\treturn (this.mode == 'edit' ?  '修改' : '增加') + '结算账户';\r\n\t\t},\r\n\t\tinitModal : function () {\r\n\t\t\tvar self = this;\r\n\t\t\tself.modal = new Hualala.UI.ModalDialog({\r\n\t\t\t\tid : 'account_edit',\r\n\t\t\t\tclz : 'account-modal',\r\n\t\t\t\ttitle : self.getModalTitle(),\r\n\t\t\t\tafterRemove : function () {\r\n\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t},\r\n\t\tmapFormElsData : function () {\r\n\t\t\tvar self = this,\r\n\t\t\t\tformKeys = self.formKeys;\r\n\t\t\tvar formEls = _.map(formKeys, function (key) {\r\n\t\t\t\tvar elCfg = AccountEditFormElsHT.get(key),\r\n\t\t\t\t\ttype = $XP(elCfg, 'type');\r\n\t\t\t\tif (type == 'combo') {\r\n\t\t\t\t\tvar v = self.model.get(key) || $XP(elCfg, 'defaultVal'),\r\n\t\t\t\t\t\toptions = _.map($XP(elCfg, 'options'), function (op) {\r\n\t\t\t\t\t\t\treturn IX.inherit(op, {\r\n\t\t\t\t\t\t\t\tselected : $XP(op, 'value') == v ? 'selected' : ''\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\treturn IX.inherit(elCfg, {\r\n\t\t\t\t\t\tvalue : v,\r\n\t\t\t\t\t\toptions : options\r\n\t\t\t\t\t});\r\n\t\t\t\t} else if (type == 'radiogrp') {\r\n\t\t\t\t\tvar v = self.model.get(key) || $XP(elCfg, 'defaultVal'),\r\n\t\t\t\t\t\toptions = _.map($XP(elCfg, 'options'), function (op) {\r\n\t\t\t\t\t\t\treturn IX.inherit(op, {\r\n\t\t\t\t\t\t\t\tchecked : $XP(op, 'value') == v ? 'checked' : ''\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\treturn IX.inherit(elCfg, {\r\n\t\t\t\t\t\tvalue : v,\r\n\t\t\t\t\t\toptions : options\r\n\t\t\t\t\t});\r\n\t\t\t\t} else if (type == 'switcher') {\r\n\t\t\t\t\treturn IX.inherit(elCfg, {\r\n\t\t\t\t\t\tchecked : self.model.get(key) == $XP(elCfg, 'defaultVal') ? 'checked' : ''\r\n\t\t\t\t\t});\r\n\t\t\t\t} else {\r\n\t\t\t\t\treturn IX.inherit(elCfg, {\r\n\t\t\t\t\t\tvalue : self.model.get(key) || $XP(elCfg, 'defaultVal')\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\treturn formEls;\r\n\t\t},\r\n\t\trenderForm : function () {\r\n\t\t\tvar self = this,\r\n\t\t\t\trenderData = self.mapFormElsData(),\r\n\t\t\t\ttpl = self.get('layoutTpl'),\r\n\t\t\t\tbtnTpl = self.get('btnTpl'),\r\n\t\t\t\thtm = tpl({\r\n\t\t\t\t\tformClz : 'account-form',\r\n\t\t\t\t\titems : renderData\r\n\t\t\t\t});\r\n\t\t\tself.modal._.body.html(htm);\r\n\t\t\tself.modal._.footer.html(btnTpl({\r\n\t\t\t\tbtns : [\r\n\t\t\t\t\t{clz : 'btn-default', name : 'cancel', label : '取消'},\r\n\t\t\t\t\t{clz : 'btn-warning', name : 'submit', label : self.mode == 'edit' ? '保存' : '添加'}\r\n\t\t\t\t]\r\n\t\t\t}));\r\n\r\n\t\t\tself.initSwitcher(':checkbox[data-type=switcher]');\r\n\t\t},\r\n\t\tinitValidFieldOpts : function () {\r\n\t\t\tvar self = this,\r\n\t\t\t\tformKeys = self.formKeys,\r\n\t\t\t\tret = {};\r\n\t\t\t_.each(formKeys, function (key) {\r\n\t\t\t\tvar elCfg = AccountEditFormElsHT.get(key),\r\n\t\t\t\t\ttype = $XP(elCfg, 'type');\r\n\t\t\t\tif (type == 'section') {\r\n\t\t\t\t\tvar min = key + '_min', max = key + '_max';\r\n\t\t\t\t\tret[min] = $XP(elCfg, 'min.validCfg', {});\r\n\t\t\t\t\tret[max] = $XP(elCfg, 'max.validCfg', {});\r\n\t\t\t\t} else {\r\n\t\t\t\t\tret[key] = $XP(elCfg, 'validCfg', {});\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\treturn ret;\r\n\t\t},\r\n\t\tbindEvent : function () {\r\n\t\t\tvar self = this;\r\n\t\t\tvar fvOpts = self.initValidFieldOpts();\r\n\t\t\tthis.on({\r\n\t\t\t\tshow : function () {\r\n\t\t\t\t\tthis.modal.show();\r\n\t\t\t\t},\r\n\t\t\t\thide : function () {\r\n\t\t\t\t\tthis.modal.hide();\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\tself.modal._.dialog.find('.btn').on('click', function (e) {\r\n\t\t\t\tvar $btn = $(this),\r\n\t\t\t\t\tact = $btn.attr('name');\r\n\t\t\t\tif (act == 'cancel') {\r\n\t\t\t\t\tself.emit('hide');\r\n\t\t\t\t} else {\r\n\t\t\t\t\tvar bv = self.modal._.body.find('form').data('bootstrapValidator');\r\n\t\t\t\t\t$btn.button('提交中...');\r\n\t\t\t\t\tbv.validate();\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\tself.modal._.body.find('form').bootstrapValidator({\r\n\t\t\t\ttrigger : 'blur',\r\n\t\t\t\tfields : fvOpts\r\n\t\t\t}).on('error.field.bv', function (e, data) {\r\n\t\t\t\tvar $form = $(e.target),\r\n\t\t\t\t\tbv = $form.data('bootstrapValidator');\r\n\t\t\t}).on('success.form.bv', function (e, data) {\r\n\t\t\t\te.preventDefault();\r\n\t\t\t\tvar $form = $(e.target),\r\n\t\t\t\t\tbv = $form.data('bootstrapValidator');\r\n\t\t\t\tvar formParams = self.serializeForm();\r\n\t\t\t\tconsole.info(formParams);\r\n\t\t\t\tself.model.emit(self.mode, {\r\n\t\t\t\t\tparams : formParams,\r\n\t\t\t\t\tfailFn : function () {\r\n\t\t\t\t\t\tself.modal._.footer.find('.btn[name=submit]').button('reset');\r\n\t\t\t\t\t},\r\n\t\t\t\t\tsuccessFn : function () {\r\n\t\t\t\t\t\tself.modal._.footer.find('.btn[name=submit]').button('reset');\r\n\t\t\t\t\t\tself.parentView && IX.isFn(self.parentView.refresh) && self.parentView.refresh();\r\n\t\t\t\t\t\tself.emit('hide');\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t});\r\n\t\t},\r\n\t\tinitSwitcher : function (selector) {\r\n\t\t\tvar self = this;\r\n\t\t\tself.modal._.body.find(selector).each(function () {\r\n\t\t\t\tvar $el = $(this),\r\n\t\t\t\t\tonLabel = $el.attr('data-onLabel'),\r\n\t\t\t\t\toffLabel = $el.attr('data-offLabel');\r\n\t\t\t\t$el.bootstrapSwitch({\r\n\t\t\t\t\tsize : 'normal',\r\n\t\t\t\t\tonColor : 'primary',\r\n\t\t\t\t\toffColor : 'default',\r\n\t\t\t\t\tonText : onLabel,\r\n\t\t\t\t\toffText : offLabel\r\n\t\t\t\t});\r\n\t\t\t});\r\n\t\t},\r\n\t\tserializeForm : function () {\r\n\t\t\tvar self = this,\r\n\t\t\t\tformKeys = self.formKeys,\r\n\t\t\t\tret = {},\r\n\t\t\t\tformEls = _.map(formKeys, function (key) {\r\n\t\t\t\t\tvar elCfg = AccountEditFormElsHT.get(key),\r\n\t\t\t\t\t\ttype = $XP(elCfg, 'type');\r\n\t\t\t\t\tif (type == 'switcher') {\r\n\t\t\t\t\t\t// ret[key] = $('[name=' + key + ']').attr('checked') ? 1 : 0;\r\n\t\t\t\t\t\tret[key] = !$('[name=' + key + ']').data('bootstrapSwitch').options.state ? 0 : 1;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tret[key] = $('[name=' + key + ']').val();\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\treturn ret;\r\n\t\t}\r\n\t});\r\n\r\n\tHualala.Account.AccountEditView = AccountEditView;\r\n\r\n\tvar AccountQueryShopModal = Stapes.subclass({\r\n\t\tconstructor : function (cfg) {\r\n\t\t\tthis.$trigger = $XP(cfg, 'trigger', null);\r\n\t\t\tthis.model = $XP(cfg, 'model', null);\r\n\t\t\tthis.parentView = $XP(cfg, 'parentView', null);\r\n\t\t\tthis.modal = null;\r\n\t\t\tthis.$queryBox = null;\r\n\t\t\tthis.$resultBox = null;\r\n\t\t\tthis.queryCtrl = null;\r\n\r\n\t\t\tthis.loadTemplates();\r\n\t\t\tthis.initModal();\r\n\t\t\tthis.render();\r\n\t\t\tthis.bindEvent();\r\n\t\t\tthis.initQueryBox();\r\n\t\t\tthis.emit('show');\r\n\t\t}\r\n\t});\r\n\tAccountQueryShopModal.proto({\r\n\t\tloadTemplates : function () {\r\n\t\t\tvar layoutTpl = Handlebars.compile(Hualala.TplLib.get('tpl_account_query_shop')),\r\n\t\t\t\tbtnTpl = Handlebars.compile(Hualala.TplLib.get('tpl_shop_modal_btns'));\r\n\t\t\t\r\n\t\t\tthis.set({\r\n\t\t\t\tlayoutTpl : layoutTpl,\r\n\t\t\t\tbtnTpl : btnTpl\r\n\t\t\t});\r\n\t\t},\r\n\t\tinitModal : function () {\r\n\t\t\tvar self = this;\r\n\t\t\tself.modal = new Hualala.UI.ModalDialog({\r\n\t\t\t\tid : 'account_query_shop',\r\n\t\t\t\tclz : 'account-modal',\r\n\t\t\t\ttitle : \"结算账户关联店铺\",\r\n\t\t\t\tafterRemove : function () {\r\n\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t},\r\n\t\trender : function () {\r\n\t\t\tvar self = this,\r\n\t\t\t\tlayoutTpl = self.get('layoutTpl'),\r\n\t\t\t\tbtnTpl = self.get('btnTpl');\r\n\t\t\tvar settleUnitName = self.model.get('settleUnitName') || '',\r\n\t\t\t\tbtns = [{clz : 'btn-default', name : 'cancel', label : '关闭'}];\r\n\t\t\tvar htm = layoutTpl({\r\n\t\t\t\tclz : '',\r\n\t\t\t\ttitle : settleUnitName,\r\n\t\t\t\tlabel : \"结算账户名称\"\r\n\t\t\t});\r\n\t\t\tself.modal._.body.html(htm);\r\n\t\t\tself.modal._.footer.html(btnTpl({\r\n\t\t\t\tbtns : btns\r\n\t\t\t}));\r\n\t\t\tself.$queryBox = self.modal._.body.find('.query-box');\r\n\t\t\tself.$resultBox = self.modal._.body.find('.result-box');\r\n\t\t},\r\n\t\tbindEvent : function () {\r\n\t\t\tvar self = this;\r\n\t\t\tthis.on({\r\n\t\t\t\t\"show\" : function () {\r\n\t\t\t\t\tself.modal.show();\r\n\t\t\t\t},\r\n\t\t\t\t\"hide\" : function () {\r\n\t\t\t\t\tself.modal.hide();\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\tself.modal._.dialog.find('.btn').on('click', function (e) {\r\n\t\t\t\tvar $btn = $(this),\r\n\t\t\t\t\tact = $btn.attr('name');\r\n\t\t\t\tif (act == 'cancel') {\r\n\t\t\t\t\tself.emit('hide');\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t},\r\n\t\tinitQueryBox : function () {\r\n\t\t\tvar self = this;\r\n\t\t\tself.queryCtrl = new Hualala.Account.AccountQueryShopController({\r\n\t\t\t\tcontainer : self.$queryBox,\r\n\t\t\t\tresultContainer : self.$resultBox,\r\n\t\t\t\t// resultController : new Hualala.Account.AccountQueryShopResultController({\r\n\t\t\t\t// \tcontainer : self.$resultBox,\r\n\t\t\t\t// \tmodel : new Hualala.Account.AccountQueryShopResultModel(),\r\n\t\t\t\t// \tview : new Hualala.Account.AccountQueryShopResultView()\r\n\t\t\t\t// })\r\n\t\t\t});\r\n\t\t}\r\n\t});\r\n\tHualala.Account.AccountQueryShopModal = AccountQueryShopModal;\r\n\r\n\t// 结算账户交易明细\r\n\tvar PersonUnit = Hualala.Constants.PersonUnit,\r\n\t\tCashUnit = Hualala.Constants.CashUnit;\r\n\tvar getOrderSubTypeLabel = function (orderSubType) {\r\n\t\tif (IX.isEmpty(orderSubType)) return '';\r\n\t\tvar l = Hualala.TypeDef.ShopBusiness;\r\n\t\tvar m = _.find(l, function (el) {\r\n\t\t\tvar id = $XP(el, 'id');\r\n\t\t\treturn id == orderSubType;\r\n\t\t});\r\n\t\tif (!m) return '';\r\n\t\treturn $XP(m, 'label', '');\r\n\t};\r\n\tvar getGenderLabel = function (v) {\r\n\t\tif (IX.isEmpty(v)) return '';\r\n\t\tvar l = Hualala.TypeDef.GENDER;\r\n\t\tvar m = _.find(l, function (el) {\r\n\t\t\tvar id = $XP(el, 'value');\r\n\t\t\treturn id == v;\r\n\t\t});\r\n\t\tif (!m) return '';\r\n\t\treturn $XP(m, 'label', '');\r\n\t};\r\n\tvar mapUserFields = function (cfg, data) {\r\n\t\tvar label = $XP(cfg, 'label', ''), fieldType = $XP(cfg, 'fieldType', ''), fields = $XP(cfg, 'fields', []);\r\n\t\tvar userSex = $XP(data, 'userSex', '');\r\n\t\tuserSex = IX.isEmpty(userSex) ? '' : '(' + getGenderLabel(userSex) + ')';\r\n\t\tvar _fields = _.map(fields, function (key) {\r\n\t\t\tvar fieldLabelCfg = OrderPayFieldLabelLib[key], label = $XP(fieldLabelCfg, 'label', ''),\r\n\t\t\t\tunit = $XP(fieldLabelCfg, 'unit', ''), clz = $XP(fieldLabelCfg, 'clz', '');\r\n\t\t\tvar value = $XP(data, key, '');\r\n\t\t\tvalue += (key == 'userName') ? userSex : '';\r\n\t\t\tvalue += unit;\r\n\t\t\treturn {\r\n\t\t\t\tkey : key,\r\n\t\t\t\tclz : clz,\r\n\t\t\t\tlabel : label,\r\n\t\t\t\tvalue : value\r\n\t\t\t};\r\n\t\t});\r\n\t\treturn {\r\n\t\t\tlabel : label,\r\n\t\t\tfieldType : fieldType,\r\n\t\t\tfields : _fields\r\n\t\t};\r\n\t};\r\n\tvar mapOrderFields = function (cfg, data) {\r\n\t\tvar label = $XP(cfg, 'label', ''), fieldType = $XP(cfg, 'fieldType', ''), fields = $XP(cfg, 'fields', []);\r\n\t\tvar orderSubType = $XP(data, 'orderSubType', ''),\r\n\t\t\torderSubTypeLabel = getOrderSubTypeLabel(orderSubType);\r\n\t\torderSubTypeLabel = IX.isEmpty(orderSubTypeLabel) ? '' : '(' + orderSubTypeLabel + ')';\r\n\t\tvar _fields = _.map(fields, function (key) {\r\n\t\t\tvar fieldLabelCfg = OrderPayFieldLabelLib[key], label = $XP(fieldLabelCfg, 'label', ''),\r\n\t\t\t\tunit = $XP(fieldLabelCfg, 'unit', ''), clz = $XP(fieldLabelCfg, 'clz', '');\r\n\t\t\tvar value = $XP(data, key, '');\r\n\t\t\tswitch(key) {\r\n\t\t\t\tcase 'timeName':\r\n\t\t\t\tcase 'consumptionTypeName' :\r\n\t\t\t\tcase 'promotionDesc' :\r\n\t\t\t\tcase 'orderRemark':\r\n\t\t\t\t\tclz += IX.isEmpty(value) ? ' hidden' : '';\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'orderTime':\r\n\t\t\t\tcase 'orderCreateTime':\r\n\t\t\t\t\tvalue = IX.Date.getDateByFormat(Hualala.Common.formatDateTimeValue(value), 'yyyy/MM/dd HH:mm');\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'statusName':\r\n\t\t\t\t\tvar isAlreadyPaid = $XP(data, 'isAlreadyPaid', 0),\r\n\t\t\t\t\t\torderStatus = $XP(data, 'orderStatus', '');\r\n\t\t\t\t\tvar surfix = '';\r\n\t\t\t\t\tif (orderStatus >= 20 && isAlreadyPaid == 1) {\r\n\t\t\t\t\t\tsurfix = \"<span>线上付款</span>\";\r\n\t\t\t\t\t} else if (orderStatus >= 20 && isAlreadyPaid == 0) {\r\n\t\t\t\t\t\tsurfix = '<span color=\"red\">' + (orderStatus == 20 ? \"餐到付款\" : \"到店付款\") + \"</span>\";\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tsurfix = \"<span>未付款</span>\";\r\n\t\t\t\t\t}\r\n\t\t\t\t\tsurfix = '(' + surfix + ')';\r\n\t\t\t\t\tvalue = value + surfix;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'takeoutAddress' :\r\n\t\t\t\t\tclz += orderSubType == 20 || orderSubType == 21 ? '' : ' hidden';\r\n\t\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t\tvalue += unit;\r\n\t\t\treturn {\r\n\t\t\t\tkey : key,\r\n\t\t\t\tclz : clz,\r\n\t\t\t\tlabel : label,\r\n\t\t\t\tvalue : value\r\n\t\t\t};\r\n\t\t});\r\n\t\treturn {\r\n\t\t\tlabel : label,\r\n\t\t\torderSubTypeLabel : orderSubTypeLabel,\r\n\t\t\tfieldType : fieldType,\r\n\t\t\tfields : _fields\r\n\t\t};\r\n\t};\r\n\tvar mapPayFields = function (cfg, data) {\r\n\t\tvar label = $XP(cfg, 'label', ''), fieldType = $XP(cfg, 'fieldType', ''), fields = $XP(cfg, 'fields', []);\r\n\t\tvar orderSubType = $XP(data, 'orderSubType', '');\r\n\t\tvar _fields = _.map(fields, function (key) {\r\n\t\t\tvar fieldLabelCfg = OrderPayFieldLabelLib[key], label = $XP(fieldLabelCfg, 'label', ''),\r\n\t\t\t\tunit = $XP(fieldLabelCfg, 'unit', ''), clz = $XP(fieldLabelCfg, 'clz', '');\r\n\t\t\tvar value = $XP(data, key, '');\r\n\t\t\tswitch(key) {\r\n\t\t\t\tcase 'serviceAmount':\r\n\t\t\t\tcase 'discountAmount':\r\n\t\t\t\tcase 'freeAmount':\r\n\t\t\t\tcase 'giftAmount':\r\n\t\t\t\tcase 'cardDiscountAmount':\r\n\t\t\t\tcase 'pointBalance':\r\n\t\t\t\tcase 'moneyBalance':\r\n\t\t\t\tcase 'orderRefundAmount':\r\n\t\t\t\t\tclz += value == 0 ? ' hidden' : '';\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'presentInfo':\r\n\t\t\t\t\tclz += IX.isEmpty(value) ? ' hidden' : '';\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'takeoutPackagingAmount':\r\n\t\t\t\t\tclz += orderSubType == 20 || orderSubType == 21 ? '' : ' hidden';\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t}\r\n\t\t\tvalue += unit;\r\n\t\t\treturn {\r\n\t\t\t\tkey : key,\r\n\t\t\t\tclz : clz,\r\n\t\t\t\tlabel : label,\r\n\t\t\t\tvalue : value\r\n\t\t\t};\r\n\t\t});\r\n\t\treturn {\r\n\t\t\tlabel : label,\r\n\t\t\tfieldType : fieldType,\r\n\t\t\tfields : _fields\r\n\t\t};\r\n\t};\r\n\tvar mapFoodsFields = function (cfg, data) {\r\n\t\tvar label = $XP(cfg, 'label', ''), fieldType = $XP(cfg, 'fieldType', ''), fields = $XP(cfg, 'fields', []);\r\n\t\tvar dishes = $XP(data, 'records', []),\r\n\t\t\tcategories = _.groupBy(dishes, function (dish) {return $XP(dish, 'foodCategoryID');});\r\n\t\tcategories = _.map(categories, function (cate, key) {\r\n\t\t\tvar foodCategoryName = '';\r\n\t\t\tvar foodCategorySum = cate.length;\r\n\t\t\tvar _dishes = _.map(cate, function (dish) {\r\n\t\t\t\tvar _dish = {};\r\n\t\t\t\t_.each(fields, function (k) {\r\n\t\t\t\t\tvar v = $XP(dish, k, ''),\r\n\t\t\t\t\t\tunit = !IX.isEmpty(OrderPayFieldLabelLib[k]) && !IX.isEmpty(OrderPayFieldLabelLib[k]['unit']) ?\r\n\t\t\t\t\t\t\tOrderPayFieldLabelLib[k]['unit'] : '';\r\n\t\t\t\t\tif (k == 'foodCategoryName') {\r\n\t\t\t\t\t\tfoodCategoryName = v;\r\n\t\t\t\t\t}\r\n\t\t\t\t\t\r\n\t\t\t\t\t_dish[k] = v + unit;\r\n\t\t\t\t});\r\n\t\t\t\treturn _dish;\r\n\t\t\t});\r\n\t\t\treturn {\r\n\t\t\t\tfoodCategoryName : foodCategoryName,\r\n\t\t\t\tfoodCategorySum : '(' + foodCategorySum + ')',\r\n\t\t\t\tfoodCategoryID : key,\r\n\t\t\t\trows : _dishes\r\n\t\t\t}\r\n\t\t});\r\n\t\t\r\n\t\treturn {\r\n\t\t\tfieldType : fieldType,\r\n\t\t\tlabel : label,\r\n\t\t\tcategories : categories\r\n\t\t};\r\n\t};\r\n\tvar OrderPayFieldLabelLib = {\r\n\t\t\"userName\" : {label : \"姓名\", clz : \"col-xs-6\"},\r\n\t\t\"userLoginMobile\" : {label : \"手机\", clz : \"col-xs-6\"},\r\n\t\t\"orderID\" : {label : \"订单号\", clz : \"col-xs-6\"},\r\n\t\t\"orderCheckPWD\" : {label : \"消费密码\", clz : \"col-xs-6\"},\r\n\t\t\"person\" : {label : \"人数\", unit : PersonUnit, clz : \"col-xs-6\"},\r\n\t\t\"timeName\" : {label : \"餐段名称\", clz : \"col-xs-6\"},\r\n\t\t\"tableName\" : {label : \"桌台号\", clz : \"col-xs-6\"},\r\n\t\t\"shopOrderKey\" : {label : \"餐饮软件凭证号\", clz : \"col-xs-6\"},\r\n\t\t\"orderTime\" : {label : \"用餐时间\", clz : \"col-xs-12\"},\r\n\t\t\"orderCreateTime\" : {label : \"下单时间\", clz : \"col-xs-12\"},\r\n\t\t\"statusName\" : {label : \"订餐状态\", clz : \"col-xs-12\"},\r\n\t\t\"takeoutAddress\" : {label : \"外送地址\", clz : \"col-xs-6\"},\r\n\t\t\"consumptionTypeName\" : {label : \"用餐类型\", clz : \"col-xs-12\"},\r\n\t\t\"promotionDesc\" : {label : \"店家促销描述\", clz : \"col-xs-12\"},\r\n\t\t\"orderRemark\" : {label : \"订单备注\", clz : \"col-xs-12\"},\r\n\t\t\"foodAmount\" : {label : \"菜品金额\", unit : CashUnit, clz : \"col-xs-6\"},\r\n\t\t\"serviceAmount\" : {label : \"服务费\", unit : CashUnit, clz : \"col-xs-6\"},\r\n\t\t\"paidAmount\" : {label : \"买单前已付金额\", unit : CashUnit, clz : \"col-xs-6\"},\r\n\t\t\"promotionTotalAmount\" : {label : \"餐饮软件优惠金额\", unit : CashUnit, clz : \"col-xs-6\"},\r\n\t\t\"discountAmount\" : {label : \"商家折免\", unit : CashUnit, clz : \"col-xs-6\"},\r\n\t\t\"freeAmount\" : {label : \"商家减免\", unit : CashUnit, clz : \"col-xs-6\"},\r\n\t\t\"giftAmount\" : {label : \"商家代金券金额\", unit : CashUnit, clz : \"col-xs-6\"},\r\n\t\t\"presentInfo\" : {label : \"赠送\", clz : \"col-xs-6\"},\r\n\t\t\"cardDiscountAmount\" : {label : \"会员卡优惠\", unit : CashUnit, clz : \"col-xs-6\"},\r\n\t\t\"pointBalance\" : {label : \"积分抵扣\", unit : CashUnit, clz : \"col-xs-6\"},\r\n\t\t\"moneyBalance\" : {label : \"会员卡余额支付\", unit : CashUnit, clz : \"col-xs-6\"},\r\n\t\t\"takeoutPackagingAmount\" : {label : \"打包费\", unit : CashUnit, clz : \"col-xs-6\"},\r\n\t\t\"orderTotal\" : {label : \"订单金额\", unit : CashUnit, clz : \"col-xs-6\"},\r\n\t\t\"orderRefundAmount\" : {label : \"退款金额\", unit : CashUnit, clz : \"col-xs-6\"},\r\n\t\t\"shopName\" : {label : \"店铺名称\", clz : \"col-xs-6\"},\r\n\t\t\"shopTel\" : {label : \"电话\", clz : \"col-xs-6\"},\r\n\t\t\"foodPrice\" : {label : \"菜品价格\", unit : CashUnit}\r\n\t};\r\n\tvar OrderPayDetailElsCfg = {\r\n\t\tuserFields : {\r\n\t\t\tlabel : \"个人信息\",\r\n\t\t\tfieldType : \"list\",\r\n\t\t\tfields : [\"userName\",\"userLoginMobile\"],\r\n\t\t\tmapFn : mapUserFields\r\n\t\t},\r\n\t\torderFields : {\r\n\t\t\tlabel : \"订单信息\",\r\n\t\t\tfieldType : \"list\",\r\n\t\t\tfields : [\"orderID\",\"orderCheckPWD\",\"person\",\"timeName\",\"tableName\",\"shopOrderKey\",\"orderTime\",\"orderCreateTime\",\r\n\t\t\t\"statusName\",\"takeoutAddress\",\"consumptionTypeName\",\"promotionDesc\",\"orderRemark\"],\r\n\t\t\tmapFn : mapOrderFields\r\n\t\t},\r\n\t\tpayFields : {\r\n\t\t\tlabel : \"支付详情\",\r\n\t\t\tfieldType : \"list\",\r\n\t\t\tfields : [\"foodAmount\",\"serviceAmount\",\"paidAmount\",\"promotionTotalAmount\",\"discountAmount\",\r\n\t\t\t\"freeAmount\",\"giftAmount\",\"presentInfo\",\"cardDiscountAmount\",\"pointBalance\",\"moneyBalance\",\"takeoutPackagingAmount\",\r\n\t\t\t\"orderTotal\",\"orderRefundAmount\",\"shopName\",\"shopTel\"],\r\n\t\t\tmapFn : mapPayFields\r\n\t\t},\r\n\t\tfoodsFields : {\r\n\t\t\tlabel : \"菜品信息\",\r\n\t\t\tfieldType : \"table\",\r\n\t\t\tfields : [\"foodCategoryName\",\"foodCategoryID\",\"foodName\",\"foodUnit\",\"foodPrice\",\"foodAmount\"],\r\n\t\t\tmapFn : mapFoodsFields\r\n\t\t}\r\n\r\n\t};\r\n\t\r\n\tvar AccountTransDetailModal = Stapes.subclass({\r\n\t\t/**\r\n\t\t * 构造\r\n\t\t * @param  {Object} cfg {triggerEl, orderKey, orderID, transType, transID}\r\n\t\t * @return {Object}\r\n\t\t */\r\n\t\tconstructor : function (cfg) {\r\n\t\t\tthis.$trigger = $XP(cfg, 'triggerEl');\r\n\t\t\tthis.orderKey = $XP(cfg, 'orderKey', '');\r\n\t\t\tthis.orderID = $XP(cfg, 'orderID', '');\r\n\t\t\tthis.transType = $XP(cfg, 'transType', '');\r\n\t\t\tthis.transID = $XP(cfg, 'transID', '');\r\n\t\t\tthis.transTypes = Hualala.TypeDef.FSMTransType;\r\n\t\t\tthis.transTypeHT = new IX.IListManager();\r\n\t\t\tthis.initTransTypeLib();\r\n\t\t\tthis.modal = null;\r\n\t\t\tthis.tplName = $XP(this.transTypeHT.get(this.transType), 'tpl', null);\r\n\t\t\tthis.callServerName = $XP(this.transTypeHT.get(this.transType), 'queryCall', null);\r\n\t\t\tthis.callServer = null;\r\n\t\t\tif (IX.isFn(this.callServerName)) {\r\n\t\t\t\tthis.callServer = this.callServerName;\r\n\t\t\t} else if (!IX.isString(this.callServerName)) {\r\n\t\t\t\tthrow(\"Configuration failed : Invalid Page Initialized for \" + this.callServerName);\r\n\t\t\t\treturn false;\r\n\t\t\t} else if (IX.nsExisted(this.callServerName)) {\r\n\t\t\t\tthis.callServer = IX.getNS(this.callServerName);\r\n\t\t\t}\r\n\t\t\tthis.queryKeys = $XP(this.transTypeHT.get(this.transType), 'queryKeys', null);\r\n\t\t\tif (!this.tplName || !this.callServer) return null;\r\n\t\t\tthis.loadTemplates();\r\n\t\t\tthis.initModal();\r\n\t\t\tthis.bindEvent();\r\n\t\t\tthis.emit('load', this.mapQueryParams());\r\n\t\t}\r\n\t});\r\n\tAccountTransDetailModal.proto({\r\n\t\tinitTransTypeLib : function () {\r\n\t\t\tvar self = this;\r\n\t\t\t_.each(this.transTypes, function (el) {\r\n\t\t\t\tvar type = $XP(el, 'value', '').toString();\r\n\t\t\t\tif (type.length > 0) {\r\n\t\t\t\t\tself.transTypeHT.register(type, el);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t},\r\n\t\tloadTemplates : function () {\r\n\t\t\tvar self = this;\r\n\t\t\tvar layoutTpl = Handlebars.compile(Hualala.TplLib.get(self.tplName)),\r\n\t\t\t\tbtnTpl = Handlebars.compile(Hualala.TplLib.get('tpl_shop_modal_btns'));\r\n\t\t\tHandlebars.registerHelper('chkFieldType', function (conditional, options) {\r\n\t\t\t\treturn (conditional == options.hash.type) ? options.fn(this) : options.inverse(this);\r\n\t\t\t});\r\n\t\t\tthis.set({\r\n\t\t\t\tlayoutTpl : layoutTpl,\r\n\t\t\t\tbtnTpl : btnTpl\r\n\t\t\t});\r\n\t\t},\r\n\t\tinitModal : function () {\r\n\t\t\tvar self = this;\r\n\t\t\tself.modal = new Hualala.UI.ModalDialog({\r\n\t\t\t\tid : 'account_trans_detail',\r\n\t\t\t\tclz : 'account-modal',\r\n\t\t\t\tsizeCls : 'modal-lg',\r\n\t\t\t\ttitle : \"结算账户交易详情\",\r\n\t\t\t\tafterRemove : function () {\r\n\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t},\r\n\t\tbindEvent : function () {\r\n\t\t\tvar self = this;\r\n\t\t\tself.on({\r\n\t\t\t\t\"load\" : function (params) {\r\n\t\t\t\t\tself.callServer(params, function (res) {\r\n\t\t\t\t\t\tif (res.resultcode == '000') {\r\n\t\t\t\t\t\t\tself.render($XP(res, 'data', null));\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\ttoptip({\r\n\t\t\t\t\t\t\t\tmsg : $XP(res, 'resultmsg', ''),\r\n\t\t\t\t\t\t\t\ttype : 'danger'\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t},\r\n\t\t\t\t\"show\" : function () {\r\n\t\t\t\t\tself.modal.show();\r\n\t\t\t\t},\r\n\t\t\t\t\"hide\" : function () {\r\n\t\t\t\t\tself.modal.hide();\r\n\t\t\t\t}\r\n\t\t\t}, this);\r\n\t\t\tself.modal._.dialog.on('click', '.btn', function (e) {\r\n\t\t\t\tvar $btn = $(this),\r\n\t\t\t\t\tact = $btn.attr('name');\r\n\t\t\t\tif (act == 'cancel') {\r\n\t\t\t\t\tself.emit('hide');\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t},\r\n\t\tmapOrderPayDetail : function (data) {\r\n\t\t\tvar self = this;\r\n\t\t\tvar fieldsets = \"userFields,orderFields,payFields,foodsFields\".split(',');\r\n\t\t\tfieldsets = _.map(fieldsets, function (key, i) {\r\n\t\t\t\tvar fieldCfg = OrderPayDetailElsCfg[key];\r\n\t\t\t\tvar mapFn = $XF(fieldCfg, 'mapFn');\r\n\t\t\t\tvar cfg = _.pick(fieldCfg, 'label', 'fieldType', 'fields');\r\n\t\t\t\treturn mapFn(cfg, $XP(data, 'data', {}));\r\n\t\t\t});\r\n\t\t\tconsole.info(fieldsets);\r\n\t\t\tvar orderSubType = $XP(data, 'data.orderSubType', ''),\r\n\t\t\t\torderSubTypeLabel = getOrderSubTypeLabel(orderSubType);\r\n\t\t\torderSubTypeLabel = IX.isEmpty(orderSubTypeLabel) ? '' : '(' + orderSubTypeLabel + ')';\r\n\t\t\tvar printDetail = {\r\n\t\t\t\tlabel : \"订单打印内容\",\r\n\t\t\t\torderSubTypeLabel : orderSubTypeLabel,\r\n\t\t\t\tcontent : $XP(data, 'data.orderPrnStr', '').replace(/\\n/g, '<br/>')\r\n\t\t\t};\r\n\r\n\t\t\treturn {\r\n\t\t\t\tfieldsets : fieldsets,\r\n\t\t\t\tprintDetail : printDetail\r\n\t\t\t};\r\n\t\t},\r\n\t\tmapFsmCustomerDetail : function (data) {\r\n\t\t\tvar self = this;\r\n\t\t\tvar settleUnitDetail = $XP(data, 'settleUnitDetail', [])[0],\r\n\t\t\t\tcustomerCard = $XP(data, 'customerCard', [])[0];\r\n\t\t\tvar transType = $XP(settleUnitDetail, 'transType'),\r\n\t\t\t\ttransTypeLabel = $XP(self.transTypeHT.get(transType), 'label', '');\r\n\t\t\tsettleUnitDetail = IX.each(settleUnitDetail, {}, function (acc, el, k) {\r\n\t\t\t\tvar cashKeys = 'transAfterBalance,transAmount,transSalesCommission';\r\n\t\t\t\tif (cashKeys.indexOf(k) >= 0) {\r\n\t\t\t\t\tacc[k] = Hualala.Common.Math.prettyNumeric(Hualala.Common.Math.prettyPrice(el));\r\n\t\t\t\t} else if (k == 'transType') {\r\n\t\t\t\t\tacc = IX.inherit(acc, {\r\n\t\t\t\t\t\ttransType : el,\r\n\t\t\t\t\t\ttransTypeLabel : $XP(self.transTypeHT.get(el), 'label', '')\r\n\t\t\t\t\t});\r\n\t\t\t\t} else {\r\n\t\t\t\t\tacc[k] = el;\r\n\t\t\t\t}\r\n\t\t\t\treturn acc;\r\n\t\t\t});\r\n\t\t\tcustomerCard = IX.each(customerCard, {}, function (acc, el, k) {\r\n\t\t\t\tvar cashKeys = 'saveCashTotal,saveMoneyTotal,moneyBalance';\r\n\t\t\t\tif (cashKeys.indexOf(k) >= 0) {\r\n\t\t\t\t\tacc[k] = Hualala.Common.Math.prettyNumeric(Hualala.Common.Math.prettyPrice(el));\r\n\t\t\t\t} else {\r\n\t\t\t\t\tacc[k] = el;\r\n\t\t\t\t}\r\n\t\t\t\treturn acc;\r\n\t\t\t});\r\n\t\t\treturn {\r\n\t\t\t\tsettleUnitDetail : IX.inherit(settleUnitDetail, {\r\n\t\t\t\t\ttransTypeLabel : transTypeLabel\r\n\t\t\t\t}),\r\n\t\t\t\tcustomerCard : customerCard\r\n\t\t\t};\r\n\t\t},\r\n\t\tmapRenderData : function (data) {\r\n\t\t\tvar self = this;\r\n\t\t\tvar type = _.last(self.callServerName.split('.'));\r\n\t\t\tvar ret = null;\r\n\t\t\tswitch(type) {\r\n\t\t\t\tcase \"queryAccountOrderPayDetail\":\r\n\t\t\t\t\tret = self.mapOrderPayDetail(data);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase \"queryAccountFsmCustomerDetail\":\r\n\t\t\t\t\tret = self.mapFsmCustomerDetail(data);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tdefault : \r\n\t\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t\treturn ret;\r\n\t\t},\r\n\t\trender : function (data) {\r\n\t\t\tvar self = this;\r\n\t\t\tvar renderData = self.mapRenderData(data),\r\n\t\t\t\tlayoutTpl = self.get('layoutTpl'),\r\n\t\t\t\tbtnTpl = self.get('btnTpl');\r\n\t\t\tvar htm = layoutTpl(renderData);\r\n\t\t\tself.modal._.body.html(htm);\r\n\t\t\tself.modal._.footer.html(btnTpl({\r\n\t\t\t\tbtns : [\r\n\t\t\t\t\t{clz : 'btn-default', name : 'cancel', label : '关闭'}\r\n\t\t\t\t]\r\n\t\t\t}));\r\n\t\t\tself.emit('show');\r\n\t\t},\r\n\t\tmapQueryParams : function () {\r\n\t\t\tvar self = this;\r\n\t\t\tvar params = {};\r\n\t\t\t_.each(self.queryKeys.split(','), function (k) {\r\n\t\t\t\tvar _k = k == 'SUA_TransItemID' ? 'transID' : k;\r\n\t\t\t\tparams[k] = self[_k]; \r\n\t\t\t});\r\n\t\t\tconsole.info('queryParams:');\r\n\t\t\tconsole.info(params);\r\n\t\t\treturn params;\r\n\t\t}\r\n\t});\r\n\tHualala.Account.AccountTransDetailModal = AccountTransDetailModal;\r\n\r\n\t\r\n})(jQuery, window);;(function ($, window) {\r\n\tIX.ns(\"Hualala.Account\");\r\n\tvar initAccountListPage = function () {\r\n\t\tvar $body = $('#ix_wrapper > .ix-body > .container');\r\n\t\tvar accountListPanel = new Hualala.Account.AccountListController({\r\n\t\t\tcontainer : $body,\r\n\t\t\tview : new Hualala.Account.AccountListView(),\r\n\t\t\tmodel : new Hualala.Account.AccountListModel({\r\n\t\t\t\tcallServer : Hualala.Global.queryAccount\r\n\t\t\t})\r\n\t\t});\r\n\t\taccountListPanel.emit('load', {\r\n\t\t\tpageNo : 1,\r\n\t\t\tpageSize : 15\r\n\t\t});\r\n\t};\r\n\r\n\tvar initAccountMgrPage = function () {\r\n\t\tvar ctx = Hualala.PageRoute.getPageContextByPath();\r\n\t\tvar $body = $('#ix_wrapper > .ix-body > .container');\r\n\t\tvar accountMgrCtrl = new Hualala.Account.AccountMgrController({\r\n\t\t\tcontainer : $body,\r\n\t\t\tsettleUnitID : $XP(ctx, 'params', [])[0],\r\n\t\t\taccountModel : new Hualala.Account.BaseAccountModel(),\r\n\t\t\tmgrView : new Hualala.Account.AccountMgrView(),\r\n\t\t\ttransaDetailCtrl : new Hualala.Account.TransactionDetailController()\r\n\t\t});\r\n\t\t// $body.html(\"<h1>结算账户管理页面</h1>\");\r\n\t};\r\n\r\n\tHualala.Account.AccountMgrInit = initAccountMgrPage;\r\n\t\r\n\tHualala.Account.AccountListInit = initAccountListPage;\r\n})(jQuery, window);;(function ($, window) {\r\n\tIX.ns(\"Hualala.Common\");\r\n\tvar pageBrickConfigs = [\r\n\t\t{name : 'account', title : '结算', label : '提现.账户设置.结算报表', brickClz : 'home-brick-md-2', itemClz : 'brick-item brick-item-2', icon : 'icon-pay'},\r\n\t\t{name : 'order', title : '订单', label : '报表.菜品排行', brickClz : 'home-brick-md-3', itemClz : 'brick-item', icon : 'icon-order'},\r\n\t\t{name : 'shop', title : '店铺管理', label : '开店.信息.菜谱', brickClz : 'home-brick-md-1', itemClz : 'brick-item', icon : 'icon-home'},\r\n\t\t{name : 'pcclient', title : '下载哗啦啦', label : '', brickClz : 'home-brick-md-1', itemClz : 'brick-item', icon : 'icon-download'},\r\n\t\t{name : 'user', title : '账号管理', label : '账号.权限', brickClz : 'home-brick-md-1', itemClz : 'brick-item', icon : 'icon-lock'},\r\n\t\t{name : 'setting', title : '业务设置', label : '开通业务.业务参数', brickClz : 'home-brick-md-2', itemClz : 'brick-item', icon : 'icon-setting'}\r\n\t];\r\n\tfunction isSupportedBrowser () {\r\n\t\tvar bd = Hualala.Common.Browser;\r\n\t\tvar isIE = !$XP(bd, 'ie', null) ? false : true,\r\n\t\t\tversion = parseInt($XP(bd, 'ie', 0));\r\n\t\tvar allowOldVersion = IX.Cookie.get('allowOldVersion') == 1 ? true : false;\r\n\t\tif (!isIE || allowOldVersion) return true;\r\n\t\tif (version > 8) return true;\r\n\t\tvar msg = version == 8 ? \r\n\t\t\t'您使用的IE浏览器版本过于陈旧，可能无法获得我们为您提供的良好的用户体验。<br/>我们建议您使用以下的浏览器或插件进行访问！' : \r\n\t\t\t'您使用的IE浏览器版本过于陈旧，无法使用我们为您提供的管理功能。<br/>请您使用以下提供的浏览器进行访问！';\r\n\t\tvar browserLib = [\r\n\t\t\t{\r\n\t\t\t\thref : '',\r\n\t\t\t\ticon : '',\r\n\t\t\t\tname : 'IE10',\r\n\t\t\t\tdesc : 'IE10浏览器是微软公司出品的现代浏览器，已经支持大部分HTML5，CSS3特性'\r\n\t\t\t},\r\n\t\t\t{\r\n\t\t\t\thref : '',\r\n\t\t\t\ticon : '',\r\n\t\t\t\tname : 'IE11',\r\n\t\t\t\tdesc : 'IE11浏览器是微软公司出品的现代浏览器，已经支持绝大部分HTML5，CSS3特性'\r\n\t\t\t},\r\n\t\t\t{\r\n\t\t\t\thref : '',\r\n\t\t\t\ticon : '',\r\n\t\t\t\tname : 'Chrome',\r\n\t\t\t\tdesc : 'Chrome浏览器是谷歌公司退出的现代浏览器，完全支持HTML5，CSS3标准的特性，具有更快的浏览网页速度。'\r\n\t\t\t},\r\n\t\t\t{\r\n\t\t\t\thref : '',\r\n\t\t\t\ticon : '',\r\n\t\t\t\tname : 'Firefox',\r\n\t\t\t\tdesc : 'FireFox是Mozilla推出的现代浏览器，完全支持HTML5，CSS3标准的特性。'\r\n\t\t\t}\r\n\t\t];\r\n\t\tvar tpl = Handlebars.compile(Hualala.TplLib.get('tpl_site_browserSupport'));\r\n\t\tvar $jumbotron = $(tpl({msg : msg, items : browserLib}));\r\n\t\t$('body > #ix_wrapper').remove();\r\n\t\t$jumbotron.appendTo($('body'));\r\n\t\t$jumbotron.find('.btn').click(function (e) {\r\n\t\t\tIX.Cookie.set('allowOldVersion', 1);\r\n\t\t\tHualala.Router.check();\r\n\t\t});\r\n\t\treturn false;\r\n\t}\r\n\tfunction initPageLayout (pageCfg, pageType) {\r\n\t\tvar session = Hualala.getSessionData(),\r\n\t\t\tlayoutTpl = Handlebars.compile(Hualala.TplLib.get('tpl_site_layout'));\r\n\t\tvar isLogin = !$XP(Hualala.getSessionUser(), 'loginName', null) ? false : true,\r\n\t\t\tloginName = $XP(session, 'user.loginName', ''),\r\n\t\t\tgroupName = $XP(session, 'site.groupName', '');\r\n\t\tvar mapRanderData = function () {\r\n\t\t\tvar header = {\r\n\t\t\t\tpcClientPath : Hualala.PageRoute.createPath('pcclient'),\r\n\t\t\t\thualalaUrl : Hualala.Global.HualalaWebSite,\r\n\t\t\t\tloginName : loginName,\r\n\t\t\t\tmerchantRoot : Hualala.PageRoute.createPath('main'),\r\n\t\t\t\tgroupName : groupName,\r\n\t\t\t\t// isLogin : !isLogin ? 'hidden' : '',\r\n\t\t\t\tisLogin : isLogin,\r\n\t\t\t\tlogoutPath : Hualala.Global.getLogoutJumpToUrl(),\r\n\t\t\t\tlogo : Hualala.Global.getDefaultImage('logo'),\r\n\t\t\t},\r\n\t\t\tfooter = {\r\n\t\t\t\taboutPath : Hualala.PageRoute.createPath(\"about\") || '#',\r\n\t\t\t\tcontactPath : Hualala.PageRoute.createPath(\"contact\") || '#',\r\n\t\t\t\tgozapLogo : Hualala.Global.getDefaultImage('gozap')\r\n\t\t\t};\r\n\t\t\treturn {\r\n\t\t\t\theader : header,\r\n\t\t\t\tfooter : footer\r\n\t\t\t};\r\n\t\t};\r\n\t\tvar $wrapper = $(layoutTpl(mapRanderData()));\r\n\t\t$('body > #ix_wrapper').remove();\r\n\t\tif (isSupportedBrowser()) {\r\n\t\t\t$wrapper.appendTo($('body'));\r\n\t\t}\r\n\t\tif ($.fn.bootstrapValidator) {\r\n\t\t\t$.fn.bootstrapValidator.DEFAULT_OPTIONS = $.extend({}, $.fn.bootstrapValidator.DEFAULT_OPTIONS, {\r\n\t\t\t\tmessage: '您输入的数据有误，请核对后再次输入',\r\n                trigger: 'blur',\r\n\t\t\t\tfeedbackIcons : {\r\n\t\t\t\t\tvalid : 'glyphicon glyphicon-ok',\r\n\t\t\t\t\tinvalid : 'glyphicon glyphicon-remove',\r\n\t\t\t\t\tvalidating : 'glyphicon glyphicon-refresh'\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\t$.fn.bootstrapValidator.validators.accuracy = {\r\n\t\t\t\tvalidate : function (validator, $field, options) {\r\n\t\t\t\t\tvar accuracy = $XP(options, 'accuracy', null),\r\n\t\t\t\t\t\tmessage = $XP(options, 'message', '');\r\n\t\t\t\t\taccuracy = isNaN(accuracy) ? null : accuracy;\r\n\t\t\t\t\tvar value = $field.val();\r\n\t\t\t\t\tvar regxStr = (IX.isEmpty(accuracy) || accuracy == 0) ? \"^\\\\d+$\" : \"^\\\\d+(\\\\.\\\\d{1,\" + accuracy + \"})?$\",\r\n\t\t\t\t\t\tregX = null;\r\n\t\t\t\t\tregX = new RegExp(regxStr);\r\n\t\t\t\t\tif (isNaN(value)) {\r\n\t\t\t\t\t\treturn {\r\n\t\t\t\t\t\t\tvalid : false,\r\n\t\t\t\t\t\t\tmessage : \"只能是数字\"\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (!regX.test(value)) {\r\n\t\t\t\t\t\treturn {\r\n\t\t\t\t\t\t\tvalid : false,\r\n\t\t\t\t\t\t\tmessage : message\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn true;\r\n\t\t\t\t}\r\n\t\t\t};\r\n\t\t}\r\n\t}\r\n\r\n\tfunction initSiteNavBar (pageType) {\r\n\t\tvar session = Hualala.getSessionData(),\r\n\t\t\tnavTpl = Handlebars.compile(Hualala.TplLib.get('tpl_site_navbar')),\r\n\t\t\tnavToggleTpl = Handlebars.compile(Hualala.TplLib.get('tpl_site_navbarToggle'));\r\n\t\tvar mapRanderData = function () {\r\n\t\t\tvar navs = _.map(Hualala.TypeDef.SiteNavType, function (v, i, list) {\r\n\t\t\t\treturn {\r\n\t\t\t\t\tactive : !Hualala.Global.isCurrentPage(v.name) ? '' : 'active',\r\n\t\t\t\t\tdisabled : '',\r\n\t\t\t\t\tpath : Hualala.PageRoute.createPath(v.name) || '#',\r\n\t\t\t\t\tname : v.name,\r\n\t\t\t\t\tlabel : v.label,\r\n\t\t\t\t};\r\n\t\t\t});\r\n\t\t\treturn {items : navs};\r\n\t\t};\r\n\t\tvar $navbar = $(navTpl(mapRanderData())),\r\n\t\t\t$navToggle = $(navToggleTpl({target : '#site_navbar'})),\r\n\t\t\t$header = $('#ix_wrapper .ix-header');\r\n\t\t$header.find('> .container .navbar-collapse').remove();\r\n\t\t$header.find('> .container').append($navbar);\r\n\t\t$header.find('> .container > .navbar-header .navbar-toggle').remove();\r\n\t\t$header.find('> .container > .navbar-header').prepend($navToggle);\r\n\r\n\t}\r\n\r\n\tfunction initHomePage (pageType, params) {\r\n\t\tvar site = Hualala.getSessionSite(),\r\n\t\t\tuser = Hualala.getSessionUser(),\r\n\t\t\troles = Hualala.getSessionRoles(),\r\n\t\t\tpcclient = Hualala.getSessionPCClient(),\r\n\t\t\trights = Hualala.getSessionUserRight();\r\n\t\tvar $body = $('#ix_wrapper > .ix-body > .container');\r\n\t\tvar mapRanderData = function () {\r\n\t\t\tvar ht = new IX.IListManager();\r\n\t\t\tvar ret = null;\r\n\t\t\tIX.iterate(rights, function (el) {\r\n\t\t\t\tht.register(el.name, el);\r\n\t\t\t});\r\n\t\t\tret = _.map(pageBrickConfigs, function (el, i, l) {\r\n\t\t\t\tvar name = $XP(el, 'name');\r\n\t\t\t\tvar hasRight = !ht.get(name) ? false : true;\r\n\t\t\t\treturn IX.inherit(el, {\r\n\t\t\t\t\titemClz : ($XP(el, 'itemClz', '') + ' ' + (!hasRight ? 'disabled' : ''))\r\n\t\t\t\t});\r\n\t\t\t});\r\n\t\t\treturn ret;\r\n\t\t};\r\n\t\t// Home Page \r\n\t\tvar tpl = Handlebars.compile(Hualala.TplLib.get('tpl_site_homepage'));\r\n\t\tvar $bricks = $(tpl({bricks : mapRanderData()}));\r\n\t\t$body.html($bricks);\r\n\t\t$bricks.on('mouseenter mouseleave click', '.brick-item', function (e) {\r\n\t\t\tvar $this = $(this), pageName = $this.attr('data-pagename'),\r\n\t\t\t\teType = e.type;\r\n\t\t\tif ($this.hasClass('disabled')) return false;\r\n\t\t\tif (eType == 'click') {\r\n\t\t\t\t// console.info($this.attr('data-pagename'));\r\n\t\t\t\tdocument.location.href = Hualala.PageRoute.createPath(pageName);\r\n\t\t\t} else {\r\n\t\t\t\t$this.toggleClass('hover');\r\n\t\t\t}\r\n\t\t\t\r\n\t\t});\r\n\t}\r\n\r\n\tfunction initLoginPage (pageType, params) {\r\n\t\tvar tpl = Handlebars.compile(Hualala.TplLib.get('tpl_site_login'));\r\n\t\tvar $loginBox = $(tpl({\r\n\t\t\tbannerImg : Hualala.Global.getDefaultImage('loginBanner')\r\n\t\t}));\r\n\t\tvar $body = $('#ix_wrapper > .ix-body > .container');\r\n\t\t$body.html($loginBox);\r\n\t\tHualala.Entry.initLogin($loginBox);\r\n\t}\r\n\r\n\r\n\tHualala.Common.LoginInit = initLoginPage;\r\n\tHualala.Common.initPageLayout = initPageLayout;\r\n\tHualala.Common.initSiteNavBar = initSiteNavBar;\r\n\tHualala.Common.HomePageInit = initHomePage;\r\n\r\n\tHualala.Common.IndexInit = function () {\r\n\t\tdocument.location.href = Hualala.PageRoute.createPath(\"main\");\r\n\t}\r\n\t\r\n})(jQuery, window);;(function ($, window) {\r\n\tIX.ns(\"Hualala\");\r\n\tvar sessionData = null;\r\n\t// 获取SessionData\r\n\tHualala.getSessionData = function () {return sessionData;};\r\n\tHualala.getSessionSite = function () {return $XP(sessionData, 'site', null); };\r\n\tHualala.getSessionUser = function () {return $XP(sessionData, 'user', null); };\r\n\tHualala.getSessionRoles = function () {return $XP(sessionData, 'roles', []); };\r\n\tHualala.getSessionPCClient = function () {return $XP(sessionData, 'pcClient', null); };\r\n\tHualala.getSessionUserRight = function () {return $XP(sessionData, 'userRight', [])};\r\n\t// 判断指定用户是否为当前登录用户\r\n\tHualala.isSessionUser = function (groupLoginName, loginName) {\r\n\t\tvar _name = $XP(sessionData, 'user.groupLoginName') + $XP(sessionData, 'user.loginName');\r\n\t\treturn sessionData && _name == (groupLoginName + loginName);\r\n\t};\r\n\r\n\tfunction loadSession(appData, cbFn) {\r\n\t\tif (!$XP(appData, 'user', null)) {\r\n\t\t\tthrow(\"Permission Deny!!\");\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tsessionData = appData;\r\n\t\tcbFn();\r\n\t}\r\n\r\n\tfunction initMainPage(cbFn) {\r\n\t\tvar tick = IX.getTimeInMS();\r\n\t\tlog(\"Merchant Sys INIT : \" + tick);\r\n\t\tHualala.Global.loadAppData({}, function (appData) {\r\n\t\t\tlog(\"Load Merchant APP Data in (ms): \" + (IX.getTimeInMS() - tick));\r\n\t\t\tif ($XP(appData, 'resultcode') != 0) {\r\n\t\t\t\tdocument.location.href = Hualala.PageRoute.createPath('login');\r\n\t\t\t\tthrow(\"Session Data Load Faild!! resultcode = \" + $XP(appData, 'resultcode', '') + \"; resultMsg = \" + $XP(appData, 'resultmsg', ''));\r\n\t\t\t\treturn;\t\r\n\t\t\t}\r\n\t\t\tloadSession($XP(appData, 'data', {}), function () {\r\n\t\t\t\tlog(\"Merchant Sys INIT DONE in (ms): \" + (IX.getTimeInMS() - tick));\r\n\t\t\t\tcbFn();\r\n\t\t\t});\r\n\t\t}, function () {\r\n\t\t\tdocument.location.href = Hualala.PageRoute.createPath('login');\r\n\t\t\treturn ;\r\n\t\t});\r\n\t}\r\n\r\n\tfunction initRouteEngine () {\r\n\t\tif (!IX.nsExisted(\"Hualala.ajaxEngine.init\")) return;\r\n\t\t$.ajaxSetup({\r\n\t\t\tbeforeSend : function (xhr) {\r\n\t\t\t\txhr.setRequestHeader('X-CSRF-Token', $('meta[name=\"csrf-token\"]').attr('content'));\r\n\t\t\t}\r\n\t\t});\r\n\t\tHualala.ajaxEngine.init({\r\n\t\t\tajaxFn : jQuery.ajax,\r\n\t\t\tbaseUrl : Hualala.Global.HOME,\r\n\t\t\tcommonUrl : Hualala.Global.CommonSite,\r\n\t\t\timgUrl : Hualala.Global.IMAGE_ROOT\r\n\t\t});\r\n\t\t// Hualala.urlEngine would be initialized as ajaxEngine was initialized! ignore urlEngine's initializing.\r\n\t};\r\n\r\n\t\r\n\t/**\r\n\t * 商户系统整体加载\r\n\t * @param  {Object} cfg {config:{}, type : \"页面类型login|main|shop|setting|account|user...\"}\r\n\t * @return {NULL}     \r\n\t */\r\n\tvar APPInitialized = false, currentType;\r\n\t\r\n\tHualala.init = function () {\r\n\t\tif (!APPInitialized) {\r\n\t\t\tinitRouteEngine();\r\n\t\t\t\r\n\t\t\t// initMainPage(function () {\r\n\t\t\t// \tHualala.PageRoute.start(function (pageName) {\r\n\t\t\t// \t\tvar hasNoNavPages = 'main,pcclient,about,contact';\r\n\t\t\t// \t\tHualala.Common.initPageLayout({}, pageName);\r\n\t\t\t// \t\tif (hasNoNavPages.indexOf(pageName) < 0) {\r\n\t\t\t// \t\t\tHualala.Common.initSiteNavBar(pageName);\r\n\t\t\t// \t\t}\r\n\t\t\t// \t});\r\n\t\t\t// });\r\n\t\t\tHualala.PageRoute.start(function (pageName, pageParams, pageInitFn) {\r\n\t\t\t\tvar hasNoNavPages = 'main,pcclient,about,contact,login';\r\n\t\t\t\tvar commonPages = _.filter(hasNoNavPages.split(','), function (v) {return v != 'main'}).join(',');\r\n\t\t\t\tif (commonPages.indexOf(pageName) >= 0) {\r\n\t\t\t\t\tHualala.Common.initPageLayout({}, pageName);\r\n\t\t\t\t\tif (hasNoNavPages.indexOf(pageName) < 0) {\r\n\t\t\t\t\t\tHualala.Common.initSiteNavBar(pageName);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tpageInitFn && pageInitFn.apply(null, [pageName, pageParams]);\r\n\t\t\t\t\treturn ;\r\n\t\t\t\t}\r\n\t\t\t\tinitMainPage(function () {\r\n\t\t\t\t\tHualala.Common.initPageLayout({}, pageName);\r\n\t\t\t\t\tif (hasNoNavPages.indexOf(pageName) < 0) {\r\n\t\t\t\t\t\tHualala.Common.initSiteNavBar(pageName);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tpageInitFn && pageInitFn.apply(null, [pageName, pageParams]);\r\n\t\t\t\t});\r\n\t\t\t});\r\n\t\t\tAPPInitialized = true;\r\n\t\t}\r\n\t};\r\n\r\n})(jQuery, window);;(function ($, window) {\r\n\tIX.ns(\"Hualala.PageRoute\");\r\n\tvar Router = Hualala.Router,\r\n\t\troutes = Hualala.Global.Route;\r\n\tvar isInitialized = false,\r\n\t\tPageConfigurations = {},\r\n\t\tPath2NameMapping = {};\r\n\r\n\tfunction mappingRoute (_path, _name, _reg) {\r\n\t\tvar match = _path.match(_reg);\r\n\t\tif (!match) return;\r\n\t\tvar s = match.shift(),\r\n\t\t\tarr = s.split('/');\r\n\t\tarr = _.map(arr, function (v, i, l) {\r\n\t\t\tvar bingo = _.indexOf(s, v);\r\n\t\t\tif (bingo > -1) {\r\n\t\t\t\treturn '_';\r\n\t\t\t}\r\n\t\t\treturn v;\r\n\t\t});\r\n\t\tarr.push(\"\"); arr.unshift(\"\");\r\n\t\tvar _pattern = arr.join(\"_\");\r\n\t\tPath2NameMapping[_pattern] = _name;\r\n\t}\r\n\r\n\tvar detectPageInitializor = (function () {\r\n\t\tvar ht = new IX.I1ToNManager();\r\n\t\tvar fnames = [];\r\n\t\tfunction _checkItem(fname) {\r\n\t\t\tif (!IX.isFn(IX.getNS(fname)))\r\n\t\t\t\treturn false;\r\n\t\t\tvar _list = ht.get(fname),\r\n\t\t\t\t_fn = IX.getNS(fname);\r\n\t\t\tfor (var j = 0; j < _list.length; j++)\r\n\t\t\t\tPageConfigurations[_list[j]].init = _fn;\r\n\t\t\tht.remove(fname);\r\n\t\t\treturn true;\r\n\t\t}\r\n\r\n\t\tfunction _checking() {\r\n\t\t\tfnames = IX.loop(fnames, [], function (acc, fname) {\r\n\t\t\t\tif (!_checkItem(fname))\r\n\t\t\t\t\tacc.push(fname);\r\n\t\t\t\treturn acc;\r\n\t\t\t});\r\n\t\t\treturn fnames.length == 0;\r\n\t\t}\r\n\r\n\t\tfunction _check () {\r\n\t\t\tfnames = IX.Array.toSet(fnames);\r\n\t\t\tIX.checkReady(_checking, IX.emptyFn, 40, {\r\n\t\t\t\tmaxAge : 15000,\r\n\t\t\t\texpire : function () {\r\n\t\t\t\t\talert(\"Can't find page inializor : \\n\" + fnames.join(\"\\n\"));\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\t\t\r\n\t\tfunction _detect(name, fname) {\r\n\t\t\tvar _fn = null;\r\n\t\t\tif (IX.isFn(fname)) {\r\n\t\t\t\t_fn = fname;\r\n\t\t\t} else if (!IX.isString(fname)) {\r\n\t\t\t\tthrow(\"Configuration failed : Invalid Page Initialized for \" + name);\r\n\t\t\t\treturn false;\r\n\t\t\t} else if (IX.nsExisted(fname)) {\r\n\t\t\t\t_fn = IX.getNS(fname);\r\n\t\t\t}\r\n\t\t\tif (IX.isFn(_fn)) {\r\n\t\t\t\treturn PageConfigurations[name].init = _fn;\r\n\t\t\t}\r\n\t\t\tht.put(fname, name);\r\n\t\t\tfnames.push(fname);\r\n\t\t}\r\n\t\treturn {\r\n\t\t\tstart : function () {setTimeout(_check, 1);},\r\n\t\t\tdetect : _detect\r\n\t\t}\r\n\t})();\r\n\r\n\t/**\r\n\t * 获取路由路径\r\n\t * @param  {String} name   路由配置的名称\r\n\t * @param  {Array|NULL} params 组装路由需要的参数，按照路由规则按顺序给出参数\r\n\t * @return {String}        返回生成的路由\r\n\t */\r\n\tfunction getPathByName (name, params) {\r\n\t\tvar cfg = PageConfigurations[name];\r\n\t\tif (!cfg) \r\n\t\t\treturn console.err(\"Can't find route : \" + name);\r\n\t\tvar path = $XP(cfg, 'path'), reg = $XP(cfg, 'reg'),\r\n\t\t\tmatch = path.match(reg);\r\n\t\tvar genPath = function (p) {\r\n\t\t\treturn Hualala.Global.HOME + p;\r\n\t\t};\r\n\t\tif (!match || match.length < 1) {\r\n\t\t\treturn console.err(\"The Path of Route (\" + name + \") is wrong!!\");\r\n\t\t} else if (match.length == 1) {\r\n\t\t\treturn genPath(path);\r\n\t\t} else if (match.length > 1 && IX.isArray(params) && (match.length - 1) == params.length) {\r\n\t\t\tmatch.shift();\r\n\t\t\t_.each(match, function (v, i, m) {\r\n\t\t\t\tpath = path.replace(v, params[i]);\r\n\t\t\t});\r\n\t\t\treturn genPath(path);\r\n\t\t}\r\n\t}\r\n\t/**\r\n\t * pageConfig : {\r\n\t * \t\tname : \"\",\r\n\t * \t\tpath : \"\",\r\n\t * \t\treg : RegExp,\r\n\t * \t\tbodyClz : \"\", default \"\"\r\n\t * \t\tPageInitiator : \"Hualala.User.init\" or function (cfg) {}\r\n\t * }\r\n\t * @param  {[type]} cbFn [description]\r\n\t * @return {[type]}      [description]\r\n\t */\r\n\tvar pageConfigs = [\r\n\t\t// home page 主页\r\n\t\t// 登录\r\n\t\t{\r\n\t\t\tname : \"login\", path : \"/#login\", reg : /login$/, bodyClz : \"\",\r\n\t\t\tPageInitiator : \"Hualala.Common.LoginInit\", label : \"登录\"\r\n\t\t},\r\n\t\t// home page主页\r\n\t\t{\r\n\t\t\tname : \"main\", path : \"/#home\", reg : /home$/, bodyClz : \"\",\r\n\t\t\tPageInitiator : \"Hualala.Common.HomePageInit\", label : \"首页\"\r\n\t\t},\r\n\r\n\t\t// 店铺管理主页\t\t\r\n\t\t{\r\n\t\t\tname : \"shop\", path : \"/#shop\", reg : /shop$/, bodyClz : \"\",\r\n\t\t\tPageInitiator : \"Hualala.Shop.HomePageInit\", parentName : \"main\", label : \"店铺管理\"\r\n\t\t},\r\n\t\t// 创建店铺\r\n\t\t{\r\n\t\t\tname : \"shopCreate\", path : \"/#shop/create\", reg : /shop\\/create$/, bodyClz : \"\",\r\n\t\t\tPageInitiator : \"Hualala.Shop.CreateShopInit\", parentName : \"shop\", label : \"创建店铺\"\r\n\t\t},\r\n\t\t// 店铺信息管理\r\n\t\t{\r\n\t\t\tname : \"shopInfo\", path : \"/#shop/{id}/info\", reg : /shop\\/(.*)\\/info$/, bodyClz : \"\",\r\n\t\t\tPageInitiator : \"Hualala.Shop.BaseInfoMgrInit\", parentName : \"shop\", label : \"店铺信息\"\r\n\t\t},\r\n\t\t// 店铺菜单管理\r\n\t\t{\r\n\t\t\tname : \"shopMenu\", path : \"/#shop/{id}/menu\", reg : /shop\\/(.*)\\/menu$/, bodyClz : \"\",\r\n\t\t\tPageInitiator : \"Hualala.Shop.FoodMenuMgrInit\", parentName : \"shop\", label : \"菜单管理\"\r\n\t\t},\r\n\r\n\t\t// 店铺功能设置页面\r\n\t\t{\r\n\t\t\tname : \"setting\", path : \"/#setting\", reg : /setting$/, bodyClz : \"\",\r\n\t\t\tPageInitiator : \"Hualala.Setting.ShopMgrInit\", parentName : \"main\", label : \"业务设置\"\r\n\t\t},\r\n\r\n\t\t// 结算账户页面\r\n\t\t{\r\n\t\t\tname : \"account\", path : \"/#account\", reg : /account$/, bodyClz : \"\",\r\n\t\t\tPageInitiator : \"Hualala.Account.AccountListInit\", parentName : \"main\", label : \"结算\"\r\n\t\t},\r\n\t\t// 结算账户详情设置页面\r\n\t\t{\r\n\t\t\tname : \"accountDetail\", path : \"/#account/{id}/detail\", reg : /account\\/(.*)\\/detail$/, bodyClz : \"\",\r\n\t\t\tPageInitiator : \"Hualala.Account.AccountMgrInit\", parentName : \"account\", label : \"账户明细\"\r\n\t\t},\r\n\r\n\t\t// 账号管理页面\r\n\t\t{\r\n\t\t\tname : \"user\", path : \"/#user\", reg : /user$/, bodyClz : \"\",\r\n\t\t\tPageInitiator : \"Hualala.User.UserListInit\", parentName : \"main\", label : \"账号管理\"\r\n\t\t},\r\n\r\n\t\t// 订单报表页面\r\n\t\t{\r\n\t\t\tname : \"order\", path : \"/#order\", reg : /order$/, bodyClz : \"\",\r\n\t\t\tPageInitiator : \"Hualala.Order.OrderChartInit\", parentName : \"main\", label : \"订单\"\r\n\t\t},\r\n\r\n\t\t// 订单查询页面\r\n\t\t/*\r\n\t\t\tb : begin date(SecondTick)\r\n\t\t\te : end date(SecondTick)\r\n\t\t\tc : city ID\r\n\t\t\ts : order status ID\r\n\t\t\tn : shop ID\r\n\t\t\tm : mobile number\r\n\t\t\to : order key\r\n\t\t\ti : min amount\r\n\t\t\ta : max amount\r\n\r\n\t\t */\r\n\t\t{\r\n\t\t\tname : \"orderQuery\", path : \"/#order/query/b{begin}/e{end}/c{cityID}/n{shopID}/s{status}/m{mobile}/o{orderKey}/i{minAmount}/a{maxAmount}\", \r\n\t\t\treg : /order\\/query\\/b(.*)\\/e(.*)\\/c(.*)\\/n(.*)\\/s(.*)\\/m(.*)\\/o(.*)\\/i(.*)\\/a(.*)$/,\r\n\t\t\tbodyClz : \"\", PageInitiator : \"Hualala.Order.QueryOrderInit\", parentName : \"main\", label : \"订单查询\"\r\n\t\t},\r\n\r\n\t\t// 订单日汇总页面\r\n\t\t/*\r\n\t\t\tb : begin date(SecondTick)\r\n\t\t\te : end date(SecondTick)\r\n\t\t\tc : city ID\r\n\t\t\ts : order status ID\r\n\t\t\tn : shop ID\r\n\t\t */\r\n\t\t{\r\n\t\t\tname : \"orderQueryDay\", path : \"/#order/query/day/b{begin}/e{end}/c{cityID}/n{shopID}/s{status}\",\r\n\t\t\treg : /order\\/query\\/day\\/b(.*)\\/e(.*)\\/c(.*)\\/n(.*)\\/s(.*)/, bodyClz : \"\",\r\n\t\t\tPageInitiator : \"Hualala.Order.QueryOrderByDayDetailInit\", parentName : \"main\", label : \"订单日汇总\"\r\n\t\t},\r\n\r\n\t\t// 订单期间汇总页面\r\n\t\t/*\r\n\t\t\tb : begin date(SecondTick)\r\n\t\t\te : end date(SecondTick)\r\n\t\t\tc : city ID\r\n\t\t\ts : order status ID\r\n\t\t\tn : shop ID\r\n\t\t */\r\n\t\t{\r\n\t\t\tname : \"orderQueryDuring\", path : \"/#order/query/during/b{begin}/e{end}/c{cityID}/n{shopID}/s{status}\",\r\n\t\t\treg : /order\\/query\\/during\\/b(.*)\\/e(.*)\\/c(.*)\\/n(.*)\\/s(.*)/, bodyClz : \"\", \r\n\t\t\tPageInitiator : \"Hualala.Order.QueryOrderByDuringDetailInit\", parentName : \"main\", label : \"订单期间汇总\"\r\n\t\t},\r\n\r\n\t\t// 菜品销售排行页面\r\n\t\t/*\r\n\t\t\tb : begin date(SecondTick)\r\n\t\t\te : end date(SecondTick)\r\n\t\t\tc : city ID\r\n\t\t\tn : shopID\r\n\t\t\ts : foodCategoryName\r\n\t\t */\r\n\t\t{\r\n\t\t\tname : \"orderDishesHot\", path : \"/#order/dishes/hot/b{begin}/e{end}/c{cityID}/n{shopID}/s{foodCategoryName}\",\r\n\t\t\treg : /order\\/dishes\\/hot\\/b(.*)\\/e(.*)\\/c(.*)\\/n(.*)\\/s(.*)/, bodyClz : \"\",\r\n\t\t\tPageInitiator : \"Hualala.Order.QueryOrderDishesHotInit\", parentName : \"main\", label : \"菜品销量排行榜\"\r\n\t\t},\r\n\r\n\t\t// 订餐客户查询页面\r\n\t\t/*\r\n\t\t\tb : begin date(SecondTick)\r\n\t\t\te : end date(SecondTick)\r\n\t\t\tc : city ID\r\n\t\t\tn : shopID\r\n\t\t\tu : customerName\r\n\t\t\tm : mobile\r\n\t\t */\r\n\t\t{\r\n\t\t\tname : \"orderQueryCustomer\", path : \"/#order/customer/b{begin}/e{end}/c{cityID}/n{shopID}/m{mobile}/u{customerName}\",\r\n\t\t\treg : /order\\/customer\\/b(.*)\\/e(.*)\\/c(.*)\\/n(.*)\\/m(.*)\\/u(.*)/, bodyClz : \"\",\r\n\t\t\tPageInitiator : \"Hualala.Order.QueryOrderCustomerInit\", parentName : \"main\", label : \"顾客统计\"\r\n\t\t},\r\n\r\n\r\n\t\t// PC客户端下载页面\r\n\t\t{\r\n\t\t\tname : \"pcclient\", path : \"/#download\", reg : /download$/, bodyClz : \"\",\r\n\t\t\tPageInitiator : \"Hualala.Common.PCClientDownloadInit\", parentName : \"main\", label : \"客户端下载\"\r\n\t\t},\r\n\r\n\t\t// 关于商户中心\r\n\t\t{\r\n\t\t\tname : \"about\", path : \"/#about\", reg : /about$/, bodyClz : \"\",\r\n\t\t\tPageInitiator : \"Hualala.Common.AboutInit\", parentName : \"main\", label : \"关于\"\r\n\t\t},\r\n\r\n\t\t// 联系我们\r\n\t\t{\r\n\t\t\tname : \"contact\", path : \"/#contact\", reg : /contact$/, bodyClz : \"\",\r\n\t\t\tPageInitiator : \"Hualala.Common.ContactInit\", parentName : \"main\", label : \"联系我们\"\r\n\t\t},\r\n\t\t// 上面的path都匹配不到，需要自动跳转home\r\n\t\t{\r\n\t\t\tname : \"index\", path : \"\", reg : /(.*)$/, bodyClz : \"\",\r\n\t\t\tPageInitiator : \"Hualala.Common.IndexInit\"\r\n\t\t}\r\n\t];\r\n\tIX.iterate(pageConfigs, function (cfg) {\r\n\t\tvar _cfg = IX.inherit({\r\n\t\t\tbodyClz : \"ix-minor\",\r\n\t\t\tpath : \"\"\r\n\t\t}, cfg);\r\n\t\tvar _name = $XP(cfg, 'name'), _path = $XP(cfg, 'path'), _reg = $XP(cfg, 'reg');\r\n\t\tmappingRoute(_path, _name, _reg);\r\n\t\tPageConfigurations[_name] = {\r\n\t\t\tname : _name, bodyClz : $XP(_cfg, 'bodyClz', ''), path : _path, reg : $XP(_cfg, 'reg', null),\r\n\t\t\tparentName : $XP(cfg, 'parentName', null), label : $XP(cfg, 'label', '')\r\n\t\t};\r\n\t\tvar _pageInit = \"PageInitiator\" in _cfg ? _cfg.PageInitiator : null;\r\n\t\tif (!IX.isString(_pageInit) && !IX.isFn(_pageInit))\r\n\t\t\t_pageInit = IX.emptyFn;\r\n\t\tdetectPageInitializor.detect(_name, _pageInit);\r\n\t});\r\n\tdetectPageInitializor.start();\r\n\r\n\r\n\tHualala.PageRoute.start = function (cbFn) {\r\n\t\tisInitialized = true;\r\n\t\tRouter.flush().config({mode : 'history', root : Hualala.Global.HOME});\r\n\t\t// Router.flush().config({mode : 'history'});\r\n\t\t// IE Browser can not support this method ??\r\n\t\t_.each(PageConfigurations, function (route, name, l) {\r\n\t\t\tvar re = $XP(route, 'reg'), initFn = $XF(route, 'init'), handler = null;\r\n\t\t\t\r\n\t\t\thandler = function (params) {\r\n\t\t\t\tconsole.info(\"INFO: Init Page :\" + name);\r\n\t\t\t\tconsole.info(\"Load Page :\" + name);\r\n\t\t\t\tconsole.info(\"arguments is :\" + params);\r\n\t\t\t\tIX.isFn(cbFn) && cbFn(name, params, initFn);\r\n\t\t\t\t\r\n\t\t\t\t// initFn && initFn.apply(null, [name, params]);\r\n\t\t\t};\r\n\t\t\t\r\n\t\t\tRouter.add(re, handler);\r\n\t\t});\r\n\t\tRouter.listen().check();\r\n\t};\r\n\r\n\tHualala.PageRoute.createPath = getPathByName;\r\n\r\n\tHualala.PageRoute.getCurrentPath = function () {\r\n\t\treturn location.hash;\r\n\t};\r\n\r\n\tHualala.PageRoute.getPageContextByPath = function (path) {\r\n\t\tvar fragment = path || Hualala.Router.getFragment();\r\n\t\tvar match = _.filter(PageConfigurations, function (el, k, l) {\r\n\t\t\treturn !!fragment.match(el.reg);\r\n\t\t});\r\n\t\tvar params = null;\r\n\t\tif (match.length == 0) return null;\r\n\t\tif (match.length == 1) {\r\n\t\t\tparams = fragment.match(match[0]['reg']);\r\n\t\t\tparams.shift();\r\n\t\t\treturn IX.inherit({params : params}, match[0]);\r\n\t\t}\r\n\t\tmatch = _.filter(match, function (el, k, l) {\r\n\t\t\treturn el.name != 'index';\r\n\t\t});\r\n\t\tparams = fragment.match(match[match.length - 1]['reg']);\r\n\t\tparams.shift();\r\n\t\treturn IX.inherit({params : params}, match[match.length - 1]);\r\n\t};\r\n\r\n\tHualala.PageRoute.getParentNamesByPath = function (path) {\r\n\t\tvar curContext = Hualala.PageRoute.getPageContextByPath(path);\r\n\t\tvar curName = $XP(curContext, 'name', null);\r\n\t\tvar ret = [];\r\n\t\twhile(!IX.isEmpty(curName)) {\r\n\t\t\tret.unshift({\r\n\t\t\t\tname : curName,\r\n\t\t\t\tlabel : $XP(curContext, 'label', ''),\r\n                path: Hualala.PageRoute.createPath(curName, curContext.params)\r\n\t\t\t});\r\n\t\t\tvar parentName = $XP(curContext, 'parentName', null);\r\n\t\t\tcurContext = IX.isEmpty(parentName) ? null : $XP(PageConfigurations, parentName, null);\r\n\t\t\tcurName = $XP(curContext, 'name', null);\r\n\t\t}\r\n        ret[ret.length - 1].isLastNode = true;\r\n\t\treturn ret;\r\n\t};\r\n    \r\n    Hualala.PageRoute.getPageLabelByName = function (name) {\r\n        if(!name) return null;\r\n        var cfg = PageConfigurations[name];\r\n        if(!cfg) return null;\r\n        return cfg.label;\r\n    };\r\n    \r\n\r\n})(jQuery, window);"]}