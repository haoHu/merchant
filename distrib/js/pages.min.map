{"version":3,"file":"pages.min.js","sources":["pages.js"],"names":["$","IX","ns","formFields","name","type","palceholder","clz","key","field","validators","notEmpty","message","callback","val","min","max","length","valid","AuthCode","cfg","container","$XP","$img","find","$progress","callServer","Hualala","Global","genAuthCode","toggleProgress","isShow","getAuthCode","cbFn","res","code","UI","TopTip","msg","setAuthCode","attr","setTimeout","bindEvent","delegate","e","target","init","genCode","Entry","initLogin","$container","console","err","loginCallServer","fvOpts","$subBtn","parent","$authCode","initValidFieldOpts","ret","_","each","f","getFormData","params","initLoginForm","bootstrapValidator","trigger","fields","on","$form","data","preventDefault","Debug","info","resultcode","document","location","href","PageRoute","createPath","bv","validate","keyCode","$this","this","el","parseInt","blur","is","focus","jQuery","window","toptip","PopoverMsgTip","QueryModel","Stapes","subclass","constructor","origCities","origAreas","origShops","isReady","getShopQuerySchema","proto","self","initDataModel","cityHT","IListManager","areaHT","shopHT","c","cid","shopLst","filter","s","areaLst","a","pluck","register","inherit","aid","sid","set","ds_city","ds_area","ds_shop","hasReady","getCities","ids","isEmpty","isString","ds","get","getShops","getShopsByAreaID","areaID","getAll","getShopsByCityID","cityID","getAreas","destroy","Shop","QueryView","needShopCreate","$queryBox","$filter","$query","loadTemplates","model","keywordLst","renderLayout","emit","getFilterParams","queryTpl","Handlebars","compile","TplLib","filterTpl","registerPartial","mapChosenShopData","cities","city","cityName","shops","push","items","map","shop","mapRenderLayoutData","filterCities","mapFilterData","queryChosenShops","shopCity","toggle","optGrp","renderData","html","prepend","initShopChosenPanel","count","btn_all","focusClz","o","unshift","matcher","Pymatch","sections","getMatchedFn","searchText","setNames","shopName","matchedSections","match","matchedOptions","shopID","chosen","width","placeholder_text","no_results_text","allow_single_deselect","change","renderAreaFilter","remove","append","updateFilterCityLayout","removeClass","addClass","updateFilterAreaLayout","$btn","getQueryParams","hasClass","first","focusedBtn","QueryController","sessionData","getSessionData","resultController","view","reload","distory","query","pageNo","pageSize","load","CardListModel","pageCount","totalSize","ds_page","updatePagerParams","pagerParamkeys","v","k","indexOf","getPagerParams","updateDataStore","pageHT","shopIDs","mShop","BaseShopModel","resetDataStore","clear","getByKeys","getShopModelByShopID","updateShopStatus","status","failFn","updateShopBusinessStatus","id","switchShopStatusCallServer","switchShopStatus","switchShopBusinessStatusCallServer","switchShopServiceFeatureStatus","switchShopBusinessStatus","$XF","setServiceFeature","sName","serviceFeatures","split","join","operation","switchBusinessStatus","setServiceParams","serviceID","successFn","strType","newData","revParamJson","JSON","parse","stringify","CardListView","$resultBox","$list","$pager","emptyBar","initLayout","layoutTpl","htm","initPager","baseCfg","total","page","maxVisible","leaps","IXPager","tooltip","selector","path","listTpl","itemTpl","tagTpl","mapTags","d","tagKeys","tags","t","mapRenderData","getTags","tag","address","byteLen","Common","strByteLength","slugAddr","substrByte","img","getSourceImage","height","quality","tel","infoHref","menuHref","checked","shopCard","list","initSwitcher","bootstrapSwitch","size","onColor","offColor","onText","offText","state","$chkbox","_shopID","render","pagerParams","empty","EmptyPlaceholder","show","ShopListView","businessName","businessID","initBusinessModal","getBusinessDesc","operationMode","businessInfo","tpl","renderKeys","minuteIntervalOpts","TypeDef","MinuteIntervalOptions","getMinutIntervalLabel","m","r","Constants","CashUnit","replace","object","slice","lastIndexOf","getShopBusiness","business","ShopBusiness","businessHT","businessCfg","item","switcherStatus","toString","desc","mapBusinessRenderData","icon","switcherName","open","label","chkHasAccountRole","loginUsr","getSessionUser","usrRoles","roles","getSessionRoles","role","roleType","matchedID","hideAccount","settleName","shopOpen","shopItem","Setting","editServiceView","triggerEl","serviceName","LoadingModal","ShopListController","ShopListModel","loadingModal","start","hide","reloadPager","ShopMap","options","extend","defaults","sContent","$searchBox","searchBox","$mapResult","mapResult","searchArea","mapPoint","isSearchMap","keyword","area","lng","lat","mapCanvasId","serach","prototype","mapParams","BMap","Map","addControl","NavigationControl","enableScrollWheelZoom","$keyword","$searchBtn","searchParams","trim","searchMap","loadMap","centerAndZoom","Point","marker","Marker","enableMassClear","raiseOnDrag","enableDragging","addOverlay","openInfoWindow","InfoWindow","addEventListener","setResult","point","local","LocalSearch","renderOptions","pageCapacity","onInfoHtmlSet","poi","onMarkersSet","search","setSearchCompleteCallback","getStatus","BMAP_STATUS_SUCCESS","setMarkersSetCallback","pois","i","pos","getPosition","initCuisines","$cuisine1","$cuisine2","G","getCuisines","rsp","resultmsg","topTip","fillSelectBox","records","initAreas","$selectBox","initCities","isActive","value","initialValue","optionsHtml","getSelectText","$select","text","U","initCreate","$wizard","bootstrapWizard","bsWizard","$step1","$step2","$step3","$city","$area","timepicker","minuteStep","showMeridian","disableFocus","showInputs","stringLength","telOrMobile","PCCL","numeric","openingHoursStart","time","openingHoursEnd","startTimeField","cuisineID1","$uploadImg","imagePath","IMAGE_ROOT","uploadImg","onSuccess","imgPath","$dlg","src","IMAGE_RESOURCE_DOMAIN","modal","dataStep1","$shopSettingLink","$curStep","activePane","isValid","parseForm","areaName","cuisineName1","cuisineName2","cuisineID2","openingHours","keywords","updateShopBaseInfo","createShop","next","mapInfo","mapLongitudeValue","mapLatitudeValue","mapLongitudeValueBaiDu","mapLatitudeValueBaiDu","setShopMap","updateReadMode","not","$p","siblings","shopInfo","S","initInfo","pageType","$shopFuncNav","createShopFuncNav","imgHost","getShopInfo","createShopInfoHead","$shopInfoHead","before","openTime","operationModeName","appendTo","$target","isValidField","coords","formData","shopData","throttle","method","context","clearTimeout","tId","call","initMenu","initFoodChosen","foods","foodName","foodID","$foodName","searchFood","scrollFood","viewBottom","scrollTop","foodsBottom","$foods","offset","top","current","renderFoods","previewImg","fileInput","files","reader","FileReader","onload","result","readAsDataURL","$checked","$chekbox","takeawayTag","$takeawayTag","isHasImage","filterFoods","$foodCount","foodTpl","lazyload","findFood","cfs","classifiedFoods","foodClass","foodCategoryID","apply","p","grep","food","classifyFoods","foodsData","l","foodCategoryName","updateFood","takeoutPackagingFee","parseFloat","prePrice","price","vipPrice","unit","idx","inAarry","units","imgePath","hwp","imageHWP","w","Math","round","h","imgSrc","imgRoot","discountIco","isDiscount","takeawayIco","activeIco","foodIsActive","arr","obj","foodParams","ef","editFoodTpl","$menu","$foodClass","$foodSearch","$editFood","modalEditFood","getShopMenu","$foodClassBox","category","foodNameTpl","closest","$foodPic","submit","imgCallback","json","parseJSON","url","foodIcos","foodPic","hotTag1","hotTag2","hotTag3","ModalDialog","title","hideCloseBtn","footer","minOrderCount","integer","between","foodIco","prop","param","$foodIco","tasteList","fn","tplData","shopUrl","getShopUrl","shopListLink","resetPwdTpl","$resetPwdForm","sizeCls","$feedback","$feedbackIcon","$errMsg","$pwd","toggleClass","setShopClientPwd","hLLAgentLoginPWD","isPlainObject","currentPageName","shopFuncs","R","$ul","shopFunc","getPageLabelByName","initShopList","$body","queryShop","HomePageInit","initShopBaseInfoMgr","BreadCrumb","hideRoot","nodes","getParentNamesByPath","BaseInfoMgrInit","initFoodMenuMgr","FoodMenuMgrInit","initCreateShop","$shopCreateWizard","pcClientPath","CreateShopInit","ServiceFormElsCfg","advanceTime","defaultVal","validCfg","noticeTime","minAmount","prefix","surfix","greaterThan","inclusive","serviceAmount","freeServiceAmount","holidayFlag","HolidayFlagOptions","openDays","digits","servicePeriods","group","reserveTableTime","reserveTableDesc","takeawayDeliveryAgent","takeawayDeliveryTime","takeawayScope","takeawayScopeDesc","submitSMSTemplateID","checkSMSTemplateID","payMethod","PayMethodOptions","needInputTableName","onLabel","offLabel","supportInvoice","supportCommitToSoftware","payMethodAtShop","PayMethodAtShopOptions","checkSpotOrder","payBeforeCommit","fetchFoodMode","FetchFoodModeOptions","ServiceFormElsHT","labelClz","minID","maxID","minName","maxName","$trigger","serviceList","serviceInfo","getServiceInfo","isFn","nsExisted","getNS","formParams","initModal","renderForm","btnTpl","registerHelper","conditional","hash","inverse","getModalTitle","afterRemove","body","$el","initTimePicker","showSeconds","servData","formKeys","dialog","act","button","serializeForm","decodeTimeStr","substr","encodeTimeStr","mapServiceFormElsData","formEls","elCfg","op","selected","formClz","btns","initShopMgr","ShopMgrInit","AccountListModel","transCreateBeginTime","transCreateEndTime","settleUnitID","transStatus","transType","groupID","minTransAmount","maxTransAmount","ds_account","accountHT","accountIDs","account","mAccount","BaseAccountModel","getAccounts","getAccountModelByID","accountID","Account","queryAccount","getSessionSite","withdrawCash","poundageAmount","poundageMinAmount","transAmount","settleBalance","newSettleBalance","sub","delete","deleteAccount","edit","editAccount","add","addAccount","AccountTransListModel","queryAccountTransDetail","ds_trans","transHT","transIDs","trans","transID","mTrans","BaseTransactionModel","getDataByPageNo","getModelByID","AccountQueryShopModel","getAccountQueryShop","AccountQueryShopResultModel","origData","dataStore","initDataStore","end","_shop","ceil","AccountListView","bindCardEvent","settleAccountID","parents","WithdrawCashView","parentView","AccountEditView","mode","updateSettleBalance","hasDefault","bankInfo","mapBankInfo","bankAccountStr","codeMask","settleUnitName","disableWithdraw","bankIcon","bankComName","shopCount","accountCard","accounts","refresh","mapFormElsData","accountInfoKeys","accountInfo","lessThan","accuracy","QueryTransFormElsCfg","transCreateTime","FSMTransStatus","FSMTransType","QueryTransFormElsHT","TransResultCols","AccountTransListView","$queryForm","tableTpl","tblClz","tblHeaders","cols","colClz","thead","rows","initQueryEls","bindQueryEvent","datetimepicker","format","startDate","autoclose","minView","todayBtn","todayHighlight","language","$picker","prev","orderKey","orderID","AccountTransDetailModal","getQueryFormParams","serializeArray","Date","getDateByFormat","mapTimeData","s1","mapTransStatus","mapTransType","types","mapCashData","prettyNumeric","mapTransChanged","transSalesCommission","transPoundage","transChanged","mapColsRenderData","row","colKeys","col","hideBtnTransType","btnClz","SUATransItemID","colCount","results","AccountQueryShopView","AccountQueryShopResultView","shopTable","AccountListController","AccountQueryShopController","resultContainer","AccountQueryShopResultController","AccountMgrController","transaDetailCtrl","TransactionDetailController","AccountActs","AccountMgrView","$nav","breadCrumbs","$schema","$detail","initBreadCrumbs","parentNames","clickFn","isLastNode","shift","schemaTpl","withDrawTpl","withdraw","queryShops","AccountQueryShopModal","Confirm","okLabel","okFn","acts","acts1","clone","isDetail","isFirst","AccountEditFormElsCfg","receiverType","AccountReceiverTypes","receiverName","bankAccount","bankCode","BankOptions","bankName","remark","defaultAccount","receiverLinkman","receiverMobile","receiverEmail","AccountEditFormElsHT","ops","resetBankCode","$combo","$bankNameIcon","queryCtrl","initQueryBox","PersonUnit","getOrderSubTypeLabel","orderSubType","getGenderLabel","GENDER","mapUserFields","fieldType","userSex","_fields","fieldLabelCfg","OrderPayFieldLabelLib","mapOrderFields","orderSubTypeLabel","formatDateTimeValue","isAlreadyPaid","orderStatus","mapPayFields","mapFoodsFields","dishes","categories","groupBy","dish","cate","foodCategorySum","_dishes","_dish","userName","userLoginMobile","orderCheckPWD","person","timeName","tableName","shopOrderKey","orderTime","orderCreateTime","statusName","takeoutAddress","consumptionTypeName","promotionDesc","orderRemark","foodAmount","paidAmount","promotionTotalAmount","discountAmount","freeAmount","giftAmount","presentInfo","cardDiscountAmount","pointBalance","moneyBalance","takeoutPackagingAmount","orderTotal","orderRefundAmount","shopTel","foodPrice","OrderPayDetailElsCfg","userFields","mapFn","orderFields","payFields","foodsFields","transTypes","transTypeHT","initTransTypeLib","tplName","callServerName","queryKeys","mapQueryParams","mapOrderPayDetail","fieldsets","fieldCfg","pick","printDetail","content","mapFsmCustomerDetail","settleUnitDetail","customerCard","transTypeLabel","acc","cashKeys","prettyPrice","last","_k","initAccountListPage","accountListPanel","initAccountMgrPage","ctx","getPageContextByPath","accountModel","mgrView","AccountMgrInit","AccountListInit","OrderQueryResultModel","statisticKeys","pagerKeys","queryParamsKeys","hasPager","recordModel","BaseOrderRecordModel","initQueryParams","ds_record","ds_statistic","concat","recordHT","recordIDs","mRecord","__id__","updateStatisticDataStore","statisticHT","getRecordsByPageNo","getRecordModelByID","getCityByCityID","getStatisticData","Order","order","OrderQueryTableHeaderCfg","OrderQueryDuringTableHeaderCfg","OrderQueryDishHotTableHeaderCfg","OrderQueryUserTableHeaderCfg","mapColItemRenderData","rowIdx","colKey","pageName","getGender","getOrderStatus","div","link","n","mapQueryOrderResultRenderData","statisticData","ftCols","rowspan","colspan","tfoot","mapQueryOrderDuringRenderData","mapQueryDishesHotRenderData","mapQueryUserRenderData","renderQueryOrderResult","$result","OrderQueryResultView","loadTemplate","resultTpl","arguments","renderRecords","renderFn","OrderListController","queryVals","vals","QueryFormElsCfg","OrderStatus","userMobile","QueryFormElsHT","mapOrderQueryFormRenderData","mapOrderQueryBaseFormRenderData","mapDishesHotQueryFormRenderData","mapUsersQueryFormRenderData","comboOptsTpl","initQueryFormEls","els","initCityComboOpts","initShopComboOpts","curCityID","optTpl","opts","curShopID","initOrderPageLayout","mapNavRenderData","curDateStamp","getTime","toText","navs","OrderSubNavType","active","disabled","navTpl","$navbar","initOrderChartPage","pageCfg","pkeys","initQueryOrderPage","$pageBody","findWhere","queryOrderDetail","mapResultRenderData","renderResult","mapRenderDataFn","initQueryOrderDayDetailPage","queryOrderDayDetail","initQueryOrderDuringDetailPage","queryOrderDuringDetail","initQueryOrderDishesHotPage","queryOrderDishesHot","initQueryOrderCustomerPage","queryUserOrderStatistic","OrderPageLayoutInit","OrderChartInit","QueryOrderInit","QueryOrderByDayDetailInit","QueryOrderByDuringDetailInit","QueryOrderDishesHotInit","QueryOrderCustomerInit","isSupportedBrowser","bd","Browser","isIE","version","allowOldVersion","Cookie","browserLib","$jumbotron","click","Router","check","initPageLayout","session","isLogin","loginName","groupName","mapRanderData","header","hualalaUrl","HualalaWebSite","merchantRoot","logoutPath","getLogoutJumpToUrl","logo","getDefaultImage","aboutPath","contactPath","gozapLogo","$wrapper","DEFAULT_OPTIONS","feedbackIcons","invalid","validating","validator","$field","isNaN","regxStr","regX","RegExp","test","initSiteNavBar","navToggleTpl","SiteNavType","isCurrentPage","$navToggle","$header","initHomePage","rights","getSessionPCClient","getSessionUserRight","ht","iterate","pageBrickConfigs","hasRight","itemClz","$bricks","bricks","eType","initLoginPage","$loginBox","bannerImg","initAboutPage","$page","replaceAll","initContactPage","initPCClientDownloadPage","brickClz","LoginInit","AboutInit","ContactInit","PCClientDownloadInit","IndexInit","loadSession","appData","initMainPage","tick","getTimeInMS","log","loadAppData","initRouteEngine","ajaxSetup","beforeSend","xhr","setRequestHeader","ajaxEngine","ajaxFn","ajax","baseUrl","HOME","commonUrl","CommonSite","imgUrl","isSessionUser","groupLoginName","_name","APPInitialized","pageParams","pageInitFn","hasNoNavPages","commonPages","mappingRoute","_path","_reg","bingo","_pattern","Path2NameMapping","getPathByName","PageConfigurations","reg","genPath","isArray","isInitialized","Route","detectPageInitializor","_checkItem","fname","_list","_fn","j","_checking","fnames","loop","_check","Array","toSet","checkReady","emptyFn","maxAge","expire","alert","_detect","put","I1ToNManager","detect","pageConfigs","bodyClz","PageInitiator","parentName","_cfg","_pageInit","flush","config","root","route","re","initFn","handler","listen","getCurrentPath","fragment","getFragment","curContext","curName"],"mappings":"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","sourcesContent":["/** \r\n * -------------------------------------------------\r\n * Copyright (c) 2014, All rights reserved. \r\n * Hualala-Merchant-Management\r\n * \r\n * @version : 0.1.0\r\n * @author : HuHao\r\n * @description : Hualala Merchant Management System.  \r\n * -------------------------------------------------\r\n */ \r\n\r\n(function ($, window) {\r\n\tIX.ns('Hualala.Entry');\r\n\tvar formFields = [\r\n\t\t{\r\n\t\t\tname : 'group_name', type : 'text', palceholder : '请输入集团主账号', clz : 'form-control input-md',\r\n\t\t\tkey : 'groupName',\r\n\t\t\tfield : {\r\n\t\t\t\tvalidators : {\r\n\t\t\t\t\tnotEmpty : {\r\n\t\t\t\t\t\tmessage : \"请输入集团主账号\"\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\t{\r\n\t\t\tname : 'group_subname', type : 'text', palceholder : '请输入集团子账号', clz : 'form-control input-md',\r\n\t\t\tkey : 'childName',\r\n\t\t\tfield : {\r\n\t\t\t\tvalidators : {\r\n\t\t\t\t\t// notEmpty : {\r\n\t\t\t\t\t// \tmessage : \"集团子账号不能为空\"\r\n\t\t\t\t\t// }\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\t{\r\n\t\t\tname : 'login_pwd', type : 'passowrd', palceholder : '请输入登陆密码', clz : 'form-control input-md',\r\n\t\t\tkey : 'password',\r\n\t\t\tfield : {\r\n\t\t\t\tvalidators : {\r\n\t\t\t\t\tnotEmpty : {\r\n\t\t\t\t\t\tmessage : \"请输入登陆密码\"\r\n\t\t\t\t\t},\r\n\t\t\t\t\tcallback : {\r\n\t\t\t\t\t\tcallback : function (val, validator, $field) {\r\n\t\t\t\t\t\t\tvar min = 6, max = 32;\r\n\t\t\t\t\t\t\tif (val.length < 6 || val.length > 32) {\r\n\t\t\t\t\t\t\t\treturn {\r\n\t\t\t\t\t\t\t\t\tvalid : false,\r\n\t\t\t\t\t\t\t\t\tmessage : '密码长度必须在' + min + '位到' + max + '位之间'\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\treturn {\r\n\t\t\t\t\t\t\t\tvalid : true\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\t{\r\n\t\t\tname : 'login_auth', type : 'text', palceholder : '请输入验证码', clz : 'form-control input-md',\r\n\t\t\tkey : 'authCode',\r\n\t\t\tfield : {\r\n\t\t\t\tvalidators : {\r\n\t\t\t\t\tnotEmpty : {\r\n\t\t\t\t\t\tmessage : \"请输入验证码\"\r\n\t\t\t\t\t}/*,\r\n\t\t\t\t\tcallback : function (val, validator, $field) {\r\n\t\t\t\t\t\tif (val != $('[name=auth_code]').val()) {\r\n\t\t\t\t\t\t\treturn {\r\n\t\t\t\t\t\t\t\tvalid : false,\r\n\t\t\t\t\t\t\t\tmessage : '验证码错误'\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\treturn {valid : true};\r\n\t\t\t\t\t}*/\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t];\r\n\r\n\t/**\r\n\t * 生成AuthCode实例\r\n\t * @param {Object} cfg {container}\r\n\t */\r\n\tvar AuthCode = function (cfg) {\r\n\t\tvar container = $($XP(cfg, 'container')),\r\n\t\t\t$img = container.find('.auth-img'),\r\n\t\t\t$progress = container.find('.progress');\r\n\t\tvar callServer = Hualala.Global.genAuthCode;\r\n\t\tvar toggleProgress = function (isShow) {\r\n\t\t\t$progress[isShow ? 'removeClass' : 'addClass']('hidden');\r\n\t\t\t$img[isShow ? 'addClass' : 'removeClass']('hidden');\r\n\t\t};\r\n\t\tvar getAuthCode = function (cbFn) {\r\n\t\t\ttoggleProgress(true);\r\n\t\t\tcallServer({}, function (res) {\r\n\t\t\t\tvar code = null;\r\n\t\t\t\tif ($XP(res, 'resultcode') == \"000\") {\r\n\t\t\t\t\tcode = $XP(res, 'data.code', null);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tHualala.UI.TopTip({\r\n\t\t\t\t\t\ttype : 'warning',\r\n\t\t\t\t\t\tmsg : \"获取验证码失败\"\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t\ttoggleProgress();\r\n\t\t\t\t}\r\n\t\t\t\tcbFn(code);\r\n\t\t\t});\r\n\t\t};\r\n\t\tvar setAuthCode = function (code) {\r\n\t\t\tif (!code) {\r\n\t\t\t\tsetTimeout(function () {\r\n\t\t\t\t\tgetAuthCode(setAuthCode);\r\n\t\t\t\t}, 1000);\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\t$img.attr('src', code);\r\n\t\t\t// FOR TEST\r\n\t\t\tsetTimeout(function () {\r\n\t\t\t\ttoggleProgress();\r\n\t\t\t}, 500);\r\n\t\t};\r\n\t\tvar bindEvent = function () {\r\n\t\t\tcontainer.delegate('.auth-img', 'click', function (e) {\r\n\t\t\t\t$img = $(e.target);\r\n\t\t\t\tgetAuthCode(setAuthCode);\r\n\t\t\t});\r\n\t\t};\r\n\t\tvar init = function () {\r\n\t\t\tgetAuthCode(setAuthCode);\r\n\t\t\tbindEvent();\r\n\t\t};\r\n\t\tinit();\r\n\t\treturn {\r\n\t\t\tgenCode : function () {\r\n\t\t\t\tgetAuthCode(setAuthCode);\r\n\t\t\t}\r\n\t\t};\r\n\t};\r\n\r\n\tHualala.Entry.initLogin = function ($container) {\r\n\t\tif (!$container || $container.length == 0) {\r\n\t\t\tconsole.err(\"Login Form init failed!\");\r\n\t\t\treturn ;\r\n\t\t}\r\n\t\tvar callServer = Hualala.Global.loginCallServer;\r\n\t\tvar fvOpts = {},\r\n\t\t\t$subBtn = $container.find('#login_sub'),\r\n\t\t\t$progress = $subBtn.parent().find('.progress'),\r\n\t\t\t$authCode = $container.find('.ix-authcode'),\r\n\t\t\tauthCode = new AuthCode({\r\n\t\t\t\tcontainer : $authCode\r\n\t\t\t});\r\n\t\tvar toggleProgress = function (isShow) {\r\n\t\t\t$progress[isShow ? 'removeClass' : 'addClass']('hidden');\r\n\t\t\t$subBtn[isShow ? 'addClass' : 'removeClass']('hidden');\r\n\t\t};\r\n\t\tvar initValidFieldOpts = function () {\r\n\t\t\tvar ret = {};\r\n\t\t\t_.each(formFields, function (f, i, l) {\r\n\t\t\t\tvar key = $XP(f, 'name'), field = $XP(f, 'field');\r\n\t\t\t\tret[key] = field;\r\n\t\t\t});\r\n\t\t\treturn ret;\r\n\t\t};\r\n\t\tvar getFormData = function () {\r\n\t\t\tvar params = {};\r\n\t\t\t_.each(formFields, function (f, i, l) {\r\n\t\t\t\tvar name = $XP(f, 'name'), key = $XP(f, 'key'), \r\n\t\t\t\t\tval = $('[name=' + name + ']', $container).val();\r\n\t\t\t\tparams[key] = val;\r\n\t\t\t});\r\n\t\t\treturn params;\r\n\t\t};\r\n\t\tvar initLoginForm = function () {\r\n\t\t\tfvOpts = initValidFieldOpts();\r\n\t\t\t$container.bootstrapValidator({\r\n\t\t\t\ttrigger : 'blur',\r\n\t\t\t\tfields : fvOpts\r\n\t\t\t}).on('error.field.bv', function (e, data) {\r\n\t\t\t\tvar $form = $(e.target),\r\n\t\t\t\t\tbv = $form.data('bootstrapValidator');\r\n\t\t\t\ttoggleProgress();\r\n\t\t\t}).on('success.form.bv', function (e, data) {\r\n\t\t\t\te.preventDefault();\r\n\t\t\t\tvar $form = $(e.target),\r\n\t\t\t\t\tbv = $form.data('bootstrapValidator'),\r\n\t\t\t\t\tparams = getFormData();\r\n\t\t\t\t// TODO AJAX Submit Login Form\r\n\t\t\t\tIX.Debug.info('INFO: Login Params : ');\r\n\t\t\t\tIX.Debug.info(params);\r\n\t\t\t\t\r\n\t\t\t\tcallServer(params, function (res) {\r\n\t\t\t\t\tif (res.resultcode == 000) {\r\n\t\t\t\t\t\tdocument.location.href = Hualala.PageRoute.createPath('main'); \r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tHualala.UI.TopTip({\r\n\t\t\t\t\t\t\ttype : 'danger',\r\n\t\t\t\t\t\t\tmsg : $XP(res, 'resultmsg')\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\t\t\t\t\ttoggleProgress();\r\n\t\t\t\t});\r\n\t\t\t});\r\n\t\t\t$container.delegate('#login_sub', 'click', function (e) {\r\n\t\t\t\ttoggleProgress(true);\r\n\t\t\t\tvar bv = $container.data('bootstrapValidator');\r\n\t\t\t\tbv.validate();\r\n\t\t\t});\r\n\t\t\t$container.delegate('.form-control[tabIndex]', 'keyup', function (e) {\r\n\t\t\t\tif (e.keyCode != 13) return;\r\n\t\t\t\tvar $this = $(this),\r\n\t\t\t\t\tel = $('.form-control[tabIndex=' + (parseInt($this.attr('tabIndex')) + 1) + ']');\r\n\t\t\t\t$this.blur();\r\n\t\t\t\t(el.length > 0 && !el.is(\".btn\")) ? el.focus() : $container.find('#login_sub').trigger('click');\r\n\t\t\t});\r\n\t\t};\r\n\r\n\t\tinitLoginForm();\r\n\t};\r\n})(jQuery, window);;(function ($, window) {\r\n\tIX.ns(\"Hualala.Shop\");\r\n\tvar popoverMsg = Hualala.UI.PopoverMsgTip;\r\n\tvar toptip = Hualala.UI.TopTip;\r\n\tvar QueryModel = Stapes.subclass({\r\n\t\tconstructor : function () {\r\n\t\t\t// 原始数据\r\n\t\t\tthis.origCities = [];\r\n\t\t\tthis.origAreas = [];\r\n\t\t\tthis.origShops = [];\r\n\t\t\t// 数据是否已经加载完毕\r\n\t\t\tthis.isReady = false;\r\n\t\t\tthis.callServer = Hualala.Global.getShopQuerySchema;\r\n\t\t}\r\n\t});\r\n\tQueryModel.proto({\r\n\t\t// 数据模型初始化，获取查询条件的数据\r\n\t\tinit : function (params, cbFn) {\r\n\t\t\tvar self = this;\r\n\t\t\tself.isReady = false;\r\n\t\t\tself.callServer(params, function (res) {\r\n\t\t\t\tif (res.resultcode == '000') {\r\n\t\t\t\t\t// 装填原始数据\r\n\t\t\t\t\tself.origCities = $XP(res, 'data.cities', []);\r\n\t\t\t\t\tself.origAreas = $XP(res, 'data.areas', []);\r\n\t\t\t\t\tself.origShops = $XP(res, 'data.shops', []);\r\n\t\t\t\t\tself.initDataModel();\r\n\t\t\t\t\tself.isReady = true;\r\n\t\t\t\t} else {\r\n\t\t\t\t\ttoptip({\r\n\t\t\t\t\t\tmsg : $XP(res, 'resultmsg', ''),\r\n\t\t\t\t\t\ttype : 'danger'\r\n\t\t\t\t\t});\r\n\t\t\t\t\tself.isReady = false;\r\n\t\t\t\t}\r\n\t\t\t\tcbFn(self);\r\n\t\t\t});\r\n\t\t},\r\n\t\t// 初始化整体数据模型\r\n\t\t// ds_city, ds_area, ds_shop\r\n\t\tinitDataModel : function () {\r\n\t\t\tvar self = this;\r\n\t\t\tvar cityHT = new IX.IListManager(),\r\n\t\t\t\tareaHT = new IX.IListManager(),\r\n\t\t\t\tshopHT = new IX.IListManager();\r\n\t\t\t_.each(this.origCities, function (c, i, l) {\r\n\t\t\t\tvar cid = $XP(c, 'cityID'), \r\n\t\t\t\t\tshopLst = _.filter(self.origShops, function (s) {\r\n\t\t\t\t\t\treturn $XP(s, 'cityID') == cid;\r\n\t\t\t\t\t}),\r\n\t\t\t\t\tareaLst = _.filter(self.origAreas, function (a) {\r\n\t\t\t\t\t\treturn $XP(a, 'cityID') == cid;\r\n\t\t\t\t\t});\r\n\t\t\t\tshopLst = _.pluck(shopLst, 'shopID');\r\n\t\t\t\tareaLst = _.pluck(areaLst, 'areaID');\r\n\t\t\t\tcityHT.register(cid, IX.inherit(c, {\r\n\t\t\t\t\tshopLst : shopLst,\r\n\t\t\t\t\tareaLst : areaLst\r\n\t\t\t\t}));\r\n\t\t\t});\r\n\t\t\t_.each(this.origAreas, function (a, i, l) {\r\n\t\t\t\tvar aid = $XP(a, 'areaID'),\r\n\t\t\t\t\tshopLst = _.filter(self.origShops, function (s) {\r\n\t\t\t\t\t\treturn $XP(s, 'areaID') == aid;\r\n\t\t\t\t\t});\r\n\t\t\t\tshopLst = _.pluck(shopLst, 'areaID');\r\n\t\t\t\tareaHT.register(aid, IX.inherit(a, {\r\n\t\t\t\t\tshopLst : shopLst\r\n\t\t\t\t}));\r\n\t\t\t});\r\n\t\t\t_.each(this.origShops, function (s, i, l) {\r\n\t\t\t\tvar sid = $XP(s, 'shopID');\r\n\t\t\t\tshopHT.register(sid, s);\r\n\t\t\t});\r\n\t\t\tself.set({\r\n\t\t\t\tds_city : cityHT,\r\n\t\t\t\tds_area : areaHT,\r\n\t\t\t\tds_shop : shopHT\r\n\t\t\t});\r\n\t\t},\r\n\t\t// 数据是否准备完成\r\n\t\thasReady : function () {return this.isReady;},\r\n\t\t/**\r\n\t\t * 通过cityIDs获取城市数据\r\n\t\t * @param  {String|Array|NULL} ids cityID，如果参数是一个城市的cityID，获取一个城市的数据；如果参数是cityID的数组，获取多个城市数据；如果不传参数，获取全部城市数据\r\n\t\t * @return {Array|NULL}\t如果没有找到匹配的城市数据返回null，否则返回城市数据的数组数据     \r\n\t\t */\r\n\t\tgetCities : function (ids) {\r\n\t\t\tids = IX.isEmpty(ids) ? null : (IX.isString(ids) ? [ids] : ids);\r\n\t\t\tvar ds = this.get('ds_city');\r\n\t\t\tvar ret = null;\r\n\t\t\tret = ds[!ids ? 'getAll' : 'getByKeys'](ids);\r\n\t\t\treturn ret;\r\n\t\t},\r\n\t\t/**\r\n\t\t * 通过shopIDs获取店铺数据\r\n\t\t * @param  {String|Array|NULL} ids shopID，如果参数是一个店铺的shopID，获取一个店铺的数据；如果参数是shopID的数组，获取多个店铺数据；如果不传参数，获取全部店铺数据\r\n\t\t * @return {Array|NULL}\t如果没有找到匹配的店铺数据返回null，否则返回店铺数据的数组数据     \r\n\t\t */\r\n\t\tgetShops : function (ids) {\r\n\t\t\tids = IX.isEmpty(ids) ? null : (IX.isString(ids) ? [ids] : ids);\r\n\t\t\tvar ds = this.get('ds_shop');\r\n\t\t\tvar ret = null;\r\n\t\t\tret = ds[!ids ? 'getAll' : 'getByKeys'](ids);\r\n\t\t\treturn ret;\r\n\t\t},\r\n\t\t/**\r\n\t\t * 获取指定区域下的店铺数据\r\n\t\t * @param  {String} areaID 指定区域ID\r\n\t\t * @return {Array|NULL} 如果没有找到匹配的店铺数据返回null，否则返回店铺数据的数组数据\r\n\t\t */\r\n\t\tgetShopsByAreaID : function (areaID) {\r\n\t\t\tif (!areaID) return null;\r\n\t\t\tvar ds = this.get('ds_shop');\r\n\t\t\tvar ret = _.filter(ds.getAll(), function (s, idx) {\r\n\t\t\t\tvar aid = $XP(s, 'areaID');\r\n\t\t\t\treturn areaID == aid;\r\n\t\t\t});\r\n\t\t\treturn ret.length == 0 ? null : ret;\r\n\t\t},\r\n\t\t/**\r\n\t\t * 获取指定城市的店铺数据\r\n\t\t * @param  {String} cityID 指定城市ID\r\n\t\t * @return {Array|NULL} 如果没有找到匹配的店铺数据返回null，否则返回店铺数据的数组数据\r\n\t\t */\r\n\t\tgetShopsByCityID : function (cityID) {\r\n\t\t\tif (!cityID) return null;\r\n\t\t\tvar ds = this.get('ds_shop');\r\n\t\t\tvar ret = _.filter(ds.getAll(), function (s, idx) {\r\n\t\t\t\tvar cid = $XP(s, 'cityID');\r\n\t\t\t\treturn cityID == cid;\r\n\t\t\t});\r\n\t\t\treturn ret.length == 0 ? null : ret;\r\n\t\t},\r\n\t\t/**\r\n\t\t * 通过areaIDs获取区域数据\r\n\t\t * @param  {String|Array|NULL} ids areaID，如果参数是一个区域的areaID，获取一个区域的数据；如果参数是areaID的数组，获取多个区域数据；如果不传参数，获取全部区域数据\r\n\t\t * @return {Array|NULL}\t如果没有找到匹配的区域数据返回null，否则返回区域数据的数组数据     \r\n\t\t */\r\n\t\tgetAreas : function (ids) {\r\n\t\t\tids = IX.isEmpty(ids) ? null : (IX.isString(ids) ? [ids] : ids);\r\n\t\t\tvar ds = this.get('ds_area');\r\n\t\t\tvar ret = null;\r\n\t\t\tret = ds[!ids ? 'getAll' : 'getByKeys'](ids);\r\n\t\t\treturn ret;\r\n\t\t},\r\n\t\tdestroy : function () {\r\n\t\t\tthis.origCities = [];\r\n\t\t\tthis.origAreas = [];\r\n\t\t\tthis.origShops = [];\r\n\t\t\tthis.isReady = false;\r\n\t\t}\r\n\t});\r\n\tHualala.Shop.QueryModel = QueryModel;\r\n})(jQuery, window);;(function ($, window) {\r\n\tIX.ns(\"Hualala.Shop\");\r\n\tvar popoverMsg = Hualala.UI.PopoverMsgTip;\r\n\tvar toptip = Hualala.UI.TopTip;\r\n\tvar QueryView = Stapes.subclass({\r\n\t\tconstructor : function () {\r\n\t\t\t// View层是否初始化完毕\r\n\t\t\tthis.isReady = false;\r\n\t\t\t// 是否开放创建店铺功能\r\n\t\t\tthis.needShopCreate = false;\r\n\t\t\t// View层容器\r\n\t\t\tthis.$container = null;\r\n\t\t\tthis.$queryBox = null;\r\n\t\t\t// 过滤部分容器\r\n\t\t\tthis.$filter = null;\r\n\t\t\t// 搜索部分容器\r\n\t\t\tthis.$query = null;\r\n\t\t\tthis.loadTemplates();\r\n\t\t}\r\n\t});\r\n\tQueryView.proto({\r\n\t\t// 初始化View层\r\n\t\tinit : function (cfg) {\r\n\t\t\tthis.model = $XP(cfg, 'model', null);\r\n\t\t\tthis.needShopCreate = $XP(cfg, 'needShopCreate', false);\r\n\t\t\tthis.$container = $XP(cfg, 'container', null);\r\n\t\t\tif (!this.model || !this.$container || this.$container.length == 0) {\r\n\t\t\t\tthrow(\"Init Query View Failed!!\");\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tthis.keywordLst = null;\r\n\t\t\tthis.renderLayout();\r\n\t\t\tthis.bindEvent();\r\n\t\t\tthis.isReady = true;\r\n\t\t\tthis.emit('filter', this.getFilterParams());\r\n\r\n\t\t},\r\n\t\t// 判断是否View初始化完毕\r\n\t\thasReady : function () {return this.isReady;},\r\n\t\t// 加载View层需要的模板\r\n\t\tloadTemplates : function () {\r\n\t\t\tvar queryTpl = Handlebars.compile(Hualala.TplLib.get('tpl_shop_query')),\r\n\t\t\t\tfilterTpl = Handlebars.compile(Hualala.TplLib.get('tpl_shop_filter'));\r\n\t\t\t// 注册子模板\r\n\t\t\tHandlebars.registerPartial(\"shopCity\", Hualala.TplLib.get('tpl_shop_filter'));\r\n\t\t\tHandlebars.registerPartial(\"toggle\", Hualala.TplLib.get('tpl_site_navbarToggle'));\r\n\t\t\t// Handlebars.registerPartial(\"shopArea\", Hualala.TplLib.get('tpl_shop_filter'));\r\n\t\t\tthis.set({\r\n\t\t\t\tqueryTpl : queryTpl,\r\n\t\t\t\tfilterTpl : filterTpl\r\n\t\t\t});\r\n\t\t},\r\n\t\t// 生成搜索栏店铺选择框组件的渲染数据\r\n\t\tmapChosenShopData : function () {\r\n\t\t\tvar self = this;\r\n\t\t\tvar cities = this.model.getCities();\r\n\t\t\tvar ret = [];\r\n\t\t\t_.each(cities, function (city, i, l) {\r\n\t\t\t\tvar cityName = $XP(city, 'cityName', ''),\r\n\t\t\t\t\tcityID = $XP(city, 'cityID', ''),\r\n\t\t\t\t\tshopLst = $XP(city, 'shopLst');\r\n\t\t\t\tvar shops = self.model.getShops(shopLst);\r\n\t\t\t\tret.push({\r\n\t\t\t\t\tname : cityName,\r\n\t\t\t\t\titems : _.map(shops, function (shop, j, l) {\r\n\t\t\t\t\t\treturn {\r\n\t\t\t\t\t\t\tcode : $XP(shop, 'shopID'),\r\n\t\t\t\t\t\t\tname : $XP(shop, 'shopName')\r\n\t\t\t\t\t\t};\r\n\t\t\t\t\t})\r\n\t\t\t\t});\r\n\t\t\t});\r\n\t\t\treturn ret;\r\n\t\t},\r\n\t\t// 生成渲染数据\r\n\t\tmapRenderLayoutData : function () {\r\n\t\t\tvar cities = this.model.getCities(),\r\n\t\t\t\tshops = this.model.getShops();\r\n\t\t\tvar filterCities = this.mapFilterData({\r\n\t\t\t\t\ttype : 'city',\r\n\t\t\t\t\tname : '城市：',\r\n\t\t\t\t\tfocus : 0,\r\n\t\t\t\t\tdata : cities\r\n\t\t\t\t}),\r\n\t\t\t\tqueryChosenShops = this.mapChosenShopData();\r\n\t\t\treturn {\r\n\t\t\t\tclz : '',\r\n\t\t\t\tshopCity : filterCities,\r\n\t\t\t\ttoggle : {target : '#shop_query'},\r\n\t\t\t\tneedShopCreate : this.needShopCreate,\r\n\t\t\t\toptGrp : queryChosenShops\r\n\t\t\t};\r\n\t\t},\r\n\t\t// 渲染整体query 框架\r\n\t\trenderLayout : function () {\r\n\t\t\tvar self = this,\r\n\t\t\t\tqueryTpl = self.get('queryTpl'),\r\n\t\t\t\tmodel = self.model;\r\n\t\t\tvar renderData = self.mapRenderLayoutData();\r\n\t\t\tvar html = queryTpl(renderData);\r\n\t\t\tthis.$queryBox = $(html);\r\n\t\t\tthis.$container.prepend(this.$queryBox);\r\n\t\t\tthis.$filter = this.$queryBox.find('.filter');\r\n\t\t\tthis.$query = this.$queryBox.find('.query');\r\n\t\t\tthis.initShopChosenPanel();\r\n\t\t},\r\n\t\t// 生成渲染地区的渲染数据\r\n\t\tmapFilterData : function (cfg) {\r\n\t\t\tvar data = $XP(cfg, 'data', []),\r\n\t\t\t\ttype = $XP(cfg, 'type'),\r\n\t\t\t\tname = $XP(cfg, 'name'),\r\n\t\t\t\tfocus = $XP(cfg, 'focus', 0),\r\n\t\t\t\tret = {\r\n\t\t\t\t\ttype : type,\r\n\t\t\t\t\tname : name,\r\n\t\t\t\t\titems : []\r\n\t\t\t\t},\r\n\t\t\t\tcount = 0;\r\n\t\t\tvar btn_all = {\r\n\t\t\t\tfocusClz : '',\r\n\t\t\t\ttype : type,\r\n\t\t\t\tcode : -1,\r\n\t\t\t\tname : '全部',\r\n\t\t\t\tcount : 0\r\n\t\t\t};\r\n\t\t\tret.items = _.map(data, function (o, i, l) {\r\n\t\t\t\tvar key = type + 'Count';\r\n\t\t\t\tvar c = parseInt($XP(o, key, 0));\r\n\t\t\t\tcount += c;\r\n\t\t\t\treturn {\r\n\t\t\t\t\tfocusClz : '',\r\n\t\t\t\t\ttype : type,\r\n\t\t\t\t\tcode : $XP(o, (type + 'ID'), ''),\r\n\t\t\t\t\tname : $XP(o, (type + 'Name'), ''),\r\n\t\t\t\t\tcount : c\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\tbtn_all = IX.inherit(btn_all, {\r\n\t\t\t\tcount : count,\r\n\t\t\t\tfocusClz : ''\r\n\t\t\t});\r\n\t\t\tret.items.unshift(btn_all);\r\n\t\t\tret.items[focus]['focusClz'] = 'disabled';\r\n\t\t\treturn ret;\r\n\t\t},\r\n\t\tinitShopChosenPanel : function () {\r\n\t\t\tvar self = this;\r\n\t\t\tvar matcher = (new Pymatch([]));\r\n\t\t\tvar sections = self.model.getShops();\r\n\t\t\tvar getMatchedFn = function (searchText) {\r\n\t\t\t\tmatcher.setNames(_.map(sections, function (el) {\r\n\t\t\t\t\treturn IX.inherit(el, {\r\n\t\t\t\t\t\tname : el.shopName\r\n\t\t\t\t\t});\r\n\t\t\t\t}));\r\n\t\t\t\tvar matchedSections = matcher.match(searchText);\r\n\t\t\t\tvar matchedOptions = {};\r\n\t\t\t\t_.each(matchedSections, function (el, i) {\r\n\t\t\t\t\tmatchedOptions[el[0].shopID] = true;\r\n\t\t\t\t});\r\n\t\t\t\treturn matchedOptions;\r\n\t\t\t};\r\n\t\t\tself.$query.find('.navbar-form[role=\"search\"] select').chosen({\r\n\t\t\t\twidth : '200px',\r\n\t\t\t\tplaceholder_text : \"请选择店铺名称\",\r\n\t\t\t\t// max_selected_options: 1,\r\n\t\t\t\tno_results_text : \"抱歉，没有找到！\",\r\n\t\t\t\tallow_single_deselect : true,\r\n\t\t\t\tgetMatchedFn : getMatchedFn\r\n\t\t\t}).change(function (e) {\r\n\t\t\t\tvar $this = $(this);\r\n\t\t\t\tself.keywordLst = $this.val();\r\n\t\t\t});\r\n\t\t},\r\n\t\t// 渲染filter\r\n\t\trenderAreaFilter : function (data) {\r\n\t\t\tvar self = this,\r\n\t\t\t\tfilterTpl = self.get('filterTpl'),\r\n\t\t\t\tmodel = self.model;\r\n\t\t\tvar renderData = self.mapFilterData({\r\n\t\t\t\ttype : 'area',\r\n\t\t\t\tname : '区域：',\r\n\t\t\t\tfocus : 0,\r\n\t\t\t\tdata : data\r\n\t\t\t});\r\n\t\t\tvar html = filterTpl(renderData);\r\n\t\t\tthis.$filter.find('.area').remove();\r\n\t\t\tthis.$filter.append(html);\r\n\t\t\tthis.initShopChosenPanel();\r\n\t\t},\r\n\t\tupdateFilterCityLayout : function (cityID) {\r\n\t\t\tvar self = this;\r\n\t\t\tvar data = null;\r\n\t\t\tif (cityID != -1) {\r\n\t\t\t\tdata = self.model.getCities(cityID);\r\n\t\t\t\tdata = $XP(data[0], 'areaLst', null);\r\n\t\t\t\tdata = self.model.getAreas(data);\r\n\t\t\t\tself.renderAreaFilter(data);\r\n\t\t\t} else {\r\n\t\t\t\tself.$filter.find('.area').remove();\r\n\t\t\t}\r\n\t\t\tself.$filter.find('.btn-link[data-city]').removeClass('disabled');\r\n\t\t\tself.$filter.find('.btn-link[data-city=' + cityID + ']').addClass('disabled');\r\n\t\t},\r\n\t\tupdateFilterAreaLayout : function (areaID) {\r\n\t\t\tvar self = this;\r\n\t\t\tself.$filter.find('.btn-link[data-area]').removeClass('disabled');\r\n\t\t\tself.$filter.find('.btn-link[data-area=' + areaID + ']').addClass('disabled');\r\n\t\t},\r\n\t\t// 绑定View层操作\r\n\t\tbindEvent : function () {\r\n\t\t\tvar self = this;\r\n\t\t\tthis.$filter.on('click', '.btn-link[data-city]', function (e) {\r\n\t\t\t\tvar $btn = $(this);\r\n\t\t\t\tvar cityID = $btn.attr('data-city');\r\n\t\t\t\t// var data = null;\r\n\t\t\t\t// if (cityID != -1) {\r\n\t\t\t\t// \tdata = self.model.getCities(cityID);\r\n\t\t\t\t// \tdata = $XP(data[0], 'areaLst', null);\r\n\t\t\t\t// \tdata = self.model.getAreas(data);\r\n\t\t\t\t// \tself.renderAreaFilter(data);\r\n\t\t\t\t// } else {\r\n\t\t\t\t// \tself.$filter.find('.area').remove();\r\n\t\t\t\t// }\r\n\t\t\t\t// self.$filter.find('.btn-link[data-city]').removeClass('disabled');\r\n\t\t\t\t// $btn.addClass('disabled');\r\n\t\t\t\tself.updateFilterCityLayout(cityID);\r\n\t\t\t\tself.emit('filter', self.getFilterParams());\r\n\t\t\t});\r\n\t\t\tthis.$filter.on('click', '.btn-link[data-area]', function (e) {\r\n\t\t\t\tvar $btn = $(this);\r\n\t\t\t\tvar areaID = $btn.attr('data-area');\r\n\t\t\t\t// self.$filter.find('.btn-link[data-area]').removeClass('disabled');\r\n\t\t\t\t// $btn.addClass('disabled');\r\n\t\t\t\tself.updateFilterAreaLayout(areaID);\r\n\t\t\t\tself.emit('filter', self.getFilterParams());\r\n\t\t\t});\r\n\t\t\tthis.$query.on('click', '.create-shop', function (e) {\r\n\t\t\t\tvar $btn = $(this);\r\n\t\t\t\tdocument.location.href = Hualala.PageRoute.createPath('shopCreate');\r\n\t\t\t});\r\n\t\t\tthis.$query.on('click', '.query-btn', function (e) {\r\n\t\t\t\tvar $btn = $(this);\r\n\t\t\t\tvar shopID = self.keywordLst || null,\r\n\t\t\t\t\tshop = null, cityID = -1, areaID = -1;\r\n\t\t\t\tif (!IX.isEmpty(shopID)) {\r\n\t\t\t\t\tshop = self.model.getShops(shopID)[0];\r\n\t\t\t\t\tcityID = $XP(shop, 'cityID', -1);\r\n\t\t\t\t\tareaID = $XP(shop, 'areaID', -1);\r\n\t\t\t\t}\r\n\t\t\t\tself.updateFilterCityLayout(cityID);\r\n\t\t\t\tself.updateFilterAreaLayout(areaID);\r\n\t\t\t\tself.emit('query', self.getQueryParams());\r\n\t\t\t});\r\n\t\t\tthis.$query.on('keyup', '.chosen-container', function (e) {\r\n\t\t\t\tvar $this = $(this);\r\n\t\t\t\tif ($this.hasClass('chosen-container-active') && !$this.hasClass('chosen-with-drop')) {\r\n\t\t\t\t\t$this.find('input').first().trigger('blur.chosen');\r\n\t\t\t\t\tself.$query.find('.query-btn').trigger('click');\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t},\r\n\t\tdestroy : function () {\r\n\t\t\tthis.isReady = false;\r\n\t\t\tthis.needShopCreate = false;\r\n\t\t\tthis.$container.find('.shop-query').remove();\r\n\t\t\tthis.$queryBox = null;\r\n\t\t\tthis.$filter = null;\r\n\t\t\tthis.$query = null;\r\n\t\t},\r\n\t\t// 获取过滤参数\r\n\t\tgetFilterParams : function () {\r\n\t\t\t// TODO\r\n\t\t\tvar self = this;\r\n\t\t\tvar focusedBtn = self.$filter.find('.btn-link.disabled');\r\n\t\t\tvar cityID = focusedBtn.filter('[data-city]').attr('data-city'),\r\n\t\t\t\tareaID = focusedBtn.filter('[data-area]').attr('data-area');\r\n\t\t\tcityID = (!cityID || cityID == -1) ? '' : cityID;\r\n\t\t\tareaID = (!areaID || areaID == -1) ? '' : areaID;\r\n\t\t\treturn {\r\n\t\t\t\tcityID : cityID,\r\n\t\t\t\tareaID : areaID,\r\n\t\t\t\tkeywordLst : ''\r\n\t\t\t};\r\n\t\t},\r\n\t\t// 获取搜索参数\r\n\t\tgetQueryParams : function () {\r\n\t\t\t// TODO\r\n\t\t\tvar self = this;\r\n\t\t\tvar keywordLst = self.keywordLst || null;\r\n\t\t\tvar params = self.getFilterParams();\r\n\t\t\tvar shops = self.model.getShops();\r\n\t\t\tif (IX.isEmpty(keywordLst)) {\r\n\t\t\t\tkeywordLst = '';\r\n\t\t\t} else {\r\n\t\t\t\tkeywordLst = $XP(_.find(shops, function (el) {\r\n\t\t\t\t\treturn $XP(el, 'shopID') == keywordLst;\r\n\t\t\t\t}), 'shopName', '');\r\n\t\t\t}\r\n\t\t\treturn IX.inherit(params, {\r\n\t\t\t\tkeywordLst : keywordLst\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t});\r\n\tHualala.Shop.QueryView = QueryView;\r\n})(jQuery, window);;(function ($, window) {\r\n\tIX.ns(\"Hualala.Shop\");\r\n\tvar popoverMsg = Hualala.UI.PopoverMsgTip;\r\n\tvar toptip = Hualala.UI.TopTip;\r\n\tvar QueryModel = Hualala.Shop.QueryModel;\r\n\tvar QueryView = Hualala.Shop.QueryView;\r\n\tvar QueryController = Stapes.subclass({\r\n\t\t/**\r\n\t\t * 店铺查询控制器\r\n\t\t * @param  {Object} cfg 配置数据\r\n\t\t *            @param {Boolean} cfg.needShopCreate 是否开启创建店铺功能\r\n\t\t *            @param {JQueryObj} container 容器\r\n\t\t *            @param {Object} resultController 结果输出控制器\r\n\t\t * @return {Object}     \r\n\t\t */\r\n\t\tconstructor : function (cfg) {\r\n\t\t\tthis.set({\r\n\t\t\t\tsessionData : Hualala.getSessionData()\r\n\t\t\t});\r\n\t\t\tthis.container = $XP(cfg, 'container', null);\r\n\t\t\tthis.needShopCreate = $XP(cfg, 'needShopCreate', false);\r\n\t\t\tthis.resultController = $XP(cfg, 'resultController', null);\r\n\t\t\tthis.model = new QueryModel();\r\n\t\t\tthis.view = new QueryView();\r\n\t\t\tthis.init();\r\n\t\t}\r\n\t});\r\n\tQueryController.proto({\r\n\t\t// 初始化控制器\r\n\t\tinit : function () {\r\n\t\t\tvar self = this;\r\n\t\t\tself.bindEvent();\r\n\t\t\tself.model.emit('load', function () {\r\n\t\t\t\tif (!self.model.hasReady()) {\r\n\t\t\t\t\tthrow(\"Shop Query Init Failed!!\");\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\t// 加载View层\r\n\t\t\t\tself.view.emit('init');\r\n\t\t\t});\r\n\t\t},\r\n\t\t// 绑定事件\r\n\t\tbindEvent : function () {\r\n\t\t\t// 控制器的事件绑定\r\n\t\t\tthis.on({\r\n\t\t\t\treload : function () {\r\n\t\t\t\t\tvar self = this;\r\n\t\t\t\t\tself.model.distory();\r\n\t\t\t\t\tself.view.distory();\r\n\t\t\t\t\tself.init();\r\n\t\t\t\t},\r\n\t\t\t\tquery : function (params) {\r\n\t\t\t\t\tvar self = this;\r\n\t\t\t\t\tIX.Debug.info(\"DEBUG: Shop Query Controller Query Params : \");\r\n\t\t\t\t\tIX.Debug.info(params);\r\n\t\t\t\t\tself.resultController && self.resultController.emit('load', IX.inherit(params, {\r\n\t\t\t\t\t\tpageNo : 1,\r\n\t\t\t\t\t\tpageSize : 15\r\n\t\t\t\t\t}));\r\n\t\t\t\t}\r\n\t\t\t}, this);\r\n\t\t\t// 模型的事件绑定\r\n\t\t\tthis.model.on({\r\n\t\t\t\tload : function (cbFn) {\r\n\t\t\t\t\tvar self = this,\r\n\t\t\t\t\t\tparams = $XP(self.get('sessionData'), 'user', {});\r\n\t\t\t\t\tself.model.init(params, cbFn);\r\n\t\t\t\t}\r\n\t\t\t}, this);\r\n\t\t\t// 视图事件绑定\r\n\t\t\tthis.view.on({\r\n\t\t\t\tinit : function () {\r\n\t\t\t\t\tvar self = this;\r\n\t\t\t\t\tself.view.init({\r\n\t\t\t\t\t\tmodel : self.model,\r\n\t\t\t\t\t\tneedShopCreate : self.needShopCreate,\r\n\t\t\t\t\t\tcontainer : self.container\r\n\t\t\t\t\t});\r\n\t\t\t\t},\r\n\t\t\t\t// 过滤操作，触发显示结果\r\n\t\t\t\tfilter : function (params) {\r\n\t\t\t\t\tvar self = this;\r\n\t\t\t\t\tself.emit('query', params);\r\n\t\t\t\t\t//TODO 重置Query的chosenPanel\r\n\t\t\t\t},\r\n\t\t\t\t// 搜索操作，触发显示结果\r\n\t\t\t\tquery : function (params) {\r\n\t\t\t\t\tvar self = this;\r\n\t\t\t\t\tself.emit('query', params);\r\n\t\t\t\t}\r\n\t\t\t}, this);\r\n\t\t}\r\n\t});\r\n\tHualala.Shop.QueryController = QueryController;\r\n})(jQuery, window);;(function ($, window) {\r\n\tIX.ns(\"Hualala.Shop\");\r\n\tvar popoverMsg = Hualala.UI.PopoverMsgTip;\r\n\tvar toptip = Hualala.UI.TopTip;\r\n\tvar CardListModel = Stapes.subclass({\r\n\t\t/**\r\n\t\t * 构造卡片店铺列表的数据模型\r\n\t\t * @param  {Object} cfg 配置信息\r\n\t\t *           @param {Function} callServer 获取数据接口\r\n\t\t * @return {Object}     \r\n\t\t */\r\n\t\tconstructor : function (cfg) {\r\n\t\t\tthis.callServer = $XP(cfg, 'callServer', null);\r\n\t\t\tif (!this.callServer) {\r\n\t\t\t\tthrow(\"callServer is empty!\");\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t}\r\n\t});\r\n\tCardListModel.proto({\r\n\t\tinit : function (params) {\r\n\t\t\tthis.set({\r\n\t\t\t\tpageCount : 0,\r\n\t\t\t\ttotalSize : 0,\r\n\t\t\t\tpageNo : $XP(params, 'pageNo', 1),\r\n\t\t\t\tpageSize : $XP(params, 'pageSize', 15),\r\n\t\t\t\tcityID : $XP(params, 'cityID', ''),\r\n\t\t\t\tareaID : $XP(params, 'areaID', ''),\r\n\t\t\t\tkeywordLst : $XP(params, 'keywordLst', ''),\r\n\t\t\t\tds_shop : new IX.IListManager(),\r\n\t\t\t\tds_page : new IX.IListManager()\r\n\t\t\t});\r\n\t\t},\r\n\t\tupdatePagerParams : function (params) {\r\n\t\t\tvar self = this;\r\n\t\t\tvar pagerParamkeys = 'pageCount,totalSize,pageNo,pageSize,cityID,areaID,keywordLst';\r\n\t\t\t// _.each(pagerParamkeys.split(','), function (k, i, l) {\r\n\t\t\t// \tswitch(k) {\r\n\t\t\t// \t\tcase 'pageCount': \r\n\t\t\t// \t\tcase 'totalSize' :\r\n\t\t\t// \t\t\tself.set(k, $XP(params, k, 0));\r\n\t\t\t// \t\t\tbreak;\r\n\t\t\t// \t\tcase 'pageNo' : \r\n\t\t\t// \t\t\tself.set(k, $XP(params, k, 1));\r\n\t\t\t// \t\t\tbreak;\r\n\t\t\t// \t\tcase 'pageSize' :\r\n\t\t\t// \t\t\tself.set(k, $XP(params, k, 15));\r\n\t\t\t// \t\t\tbreak;\r\n\t\t\t// \t\tdefault:\r\n\t\t\t// \t\t\tself.set(k, $XP(params, k, ''));\r\n\t\t\t// \t\t\tbreak;\r\n\t\t\t// \t}\r\n\t\t\t// });\r\n\t\t\t_.each(params, function (v, k, l) {\r\n\t\t\t\tif (pagerParamkeys.indexOf(k) > -1) {\r\n\t\t\t\t\tself.set(k, v);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t},\r\n\t\tgetPagerParams : function () {\r\n\t\t\t// return {\r\n\t\t\t// \tPage : {\r\n\t\t\t// \t\tpageNo : this.get('pageNo'),\r\n\t\t\t// \t\tpageSize : this.get('pageSize')\r\n\t\t\t// \t},\r\n\t\t\t// \tcityID : this.get('cityID'),\r\n\t\t\t// \tareaID : this.get('areaID'),\r\n\t\t\t// \tkeywordLst : this.get('keywordLst')\r\n\t\t\t// };\r\n\t\t\treturn {\r\n\t\t\t\tpageNo : this.get('pageNo'),\r\n\t\t\t\tpageSize : this.get('pageSize'),\r\n\t\t\t\tcityID : this.get('cityID'),\r\n\t\t\t\tareaID : this.get('areaID'),\r\n\t\t\t\tkeywordLst : this.get('keywordLst')\r\n\t\t\t};\r\n\t\t},\r\n\t\tupdateDataStore : function (data, pageNo) {\r\n\t\t\tvar self = this,\r\n\t\t\t\tshopHT = self.get('ds_shop'),\r\n\t\t\t\tpageHT = self.get('ds_page');\r\n\t\t\tvar shopIDs = _.map(data, function (shop, i, l) {\r\n\t\t\t\t// var shopID = $XP(shop, 'shopID');\r\n\t\t\t\t// shopHT.register(shopID, shop);\r\n\t\t\t\t// return shopID;\r\n\t\t\t\tvar shopID = $XP(shop, 'shopID'),\r\n\t\t\t\t\tmShop = new BaseShopModel(shop);\r\n\t\t\t\tshopHT.register(shopID, mShop);\r\n\t\t\t\treturn shopID;\r\n\t\t\t});\r\n\t\t\tpageHT.register(pageNo, shopIDs);\r\n\t\t},\r\n\t\tresetDataStore : function () {\r\n\t\t\tvar self = this,\r\n\t\t\t\tshopHT = self.get('ds_shop'),\r\n\t\t\t\tpageHT = self.get('ds_page');\r\n\t\t\tshopHT.clear();\r\n\t\t\tpageHT.clear();\r\n\t\t},\r\n\t\tload : function (params, cbFn) {\r\n\t\t\tvar self = this;\r\n\t\t\tself.updatePagerParams(params);\r\n\t\t\tself.callServer(self.getPagerParams(), function (res) {\r\n\t\t\t\tif (res.resultcode == '000') {\r\n\t\t\t\t\tself.updateDataStore($XP(res, 'data.records', []), $XP(res, 'data.page.pageNo'));\r\n\t\t\t\t\tself.updatePagerParams($XP(res, 'data.page', {}));\r\n\t\t\t\t} else {\r\n\t\t\t\t\ttoptip({\r\n\t\t\t\t\t\tmsg : $XP(res, 'resultmsg', ''),\r\n\t\t\t\t\t\ttype : 'danger'\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t\tcbFn(self);\r\n\t\t\t});\r\n\t\t},\r\n\t\tgetShops : function (pageNo) {\r\n\t\t\tvar self = this,\r\n\t\t\t\tshopHT = self.get('ds_shop'),\r\n\t\t\t\tpageHT = self.get('ds_page');\r\n\t\t\tvar ret = _.map(shopHT.getByKeys(pageHT.get(pageNo)), function (mShop, i, l) {\r\n\t\t\t\treturn mShop.getAll();\r\n\t\t\t});\r\n\t\t\tIX.Debug.info(\"DEBUG: Shop Card List Model PageData : \");\r\n\t\t\tIX.Debug.info(ret);\r\n\t\t\treturn ret;\r\n\t\t},\r\n\t\tgetShopModelByShopID : function (shopID) {\r\n\t\t\tvar self = this,\r\n\t\t\t\tshopHT = self.get('ds_shop');\r\n\t\t\treturn shopHT.get(shopID);\r\n\t\t},\r\n\t\t// 更新店铺状态\r\n\t\tupdateShopStatus : function (shopID, status, failFn) {\r\n\t\t\tvar self = this,\r\n\t\t\t\tshopHT = self.get('ds_shop');\r\n\t\t\tvar shop = shopHT.get(shopID);\r\n\t\t\t// shop = IX.inherit(shop, {\r\n\t\t\t// \tstatus : status\r\n\t\t\t// });\r\n\t\t\t// shopHT.register(shopID, shop);\r\n\t\t\t// shop.set('status', status);\r\n\t\t\tshop.emit('switchShopStatus', {\r\n\t\t\t\tstatus : status,\r\n\t\t\t\tfailFn : failFn\r\n\t\t\t});\r\n\t\t},\r\n\t\t// 更新店铺业务状态\r\n\t\tupdateShopBusinessStatus : function (params, failFn) {\r\n\t\t\tvar self = this,\r\n\t\t\t\tshopHT = self.get('ds_shop'),\r\n\t\t\t\tshopID = $XP(params, 'shopID'),\r\n\t\t\t\tshop = shopHT.get(shopID);\r\n\t\t\tshop.emit('switchBusinessStatus', {\r\n\t\t\t\tname : $XP(params, 'name'),\r\n\t\t\t\tid : $XP(params, 'id'),\r\n\t\t\t\tstatus : $XP(params, 'status', 0),\r\n\t\t\t\tfailFn : failFn\r\n\t\t\t});\r\n\r\n\t\t}\r\n\t});\r\n\r\n\r\n\tHualala.Shop.CardListModel = CardListModel;\r\n\r\n\tvar BaseShopModel = Stapes.subclass({\r\n\t\tconstructor : function (shop) {\r\n\t\t\tthis.switchShopStatusCallServer = Hualala.Global.switchShopStatus;\r\n\t\t\tthis.switchShopBusinessStatusCallServer = Hualala.Global.switchShopServiceFeatureStatus;\r\n\t\t\tthis.set(shop);\r\n\t\t\tthis.bindEvent();\r\n\t\t}\r\n\t});\r\n\tBaseShopModel.proto({\r\n\t\tswitchShopStatus : function (status, failFn) {\r\n\t\t\tvar self = this,\r\n\t\t\t\tshopID = self.get('shopID');\r\n\t\t\tself.set('status', status);\r\n\t\t\tIX.Debug.info(\"DEBUG: Base Shop Model [\" + self.get('shopID') + \"] Status :\" + status);\r\n\t\t\tthis.switchShopStatusCallServer({\r\n\t\t\t\tshopID : shopID,\r\n\t\t\t\tstatus : status\r\n\t\t\t}, function (res) {\r\n\t\t\t\tif (res.resultcode !== '000') {\r\n\t\t\t\t\t\r\n\t\t\t\t\ttoptip({\r\n\t\t\t\t\t\tmsg : $XP(res, 'resultmsg', ''),\r\n\t\t\t\t\t\ttype : 'danger'\r\n\t\t\t\t\t});\r\n\t\t\t\t\tself.set('status', !status ? 1 : 0);\r\n\t\t\t\t\tfailFn(shopID);\r\n\t\t\t\t\t\r\n\t\t\t\t} else {\r\n\t\t\t\t\ttoptip({\r\n\t\t\t\t\t\tmsg : '切换成功!',\r\n\t\t\t\t\t\ttype : 'success'\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t},\r\n\t\tswitchShopBusinessStatus : function (params) {\r\n\t\t\tvar self = this,\r\n\t\t\t\tshopID = self.get('shopID');\r\n\t\t\tvar failFn = $XF(params, 'failFn'),\r\n\t\t\t\tname = $XP(params, 'name'),\r\n\t\t\t\tid = $XP(params, 'id'),\r\n\t\t\t\tstatus = $XP(params, 'status');\r\n\t\t\tvar setServiceFeature = function (sName, s) {\r\n\t\t\t\tvar serviceFeatures = self.get('serviceFeatures').split(',');\r\n\t\t\t\t// 更新serviceFeature\r\n\t\t\t\tif (s == 1) {\r\n\t\t\t\t\tserviceFeatures.push(sName);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tserviceFeatures = _.filter(serviceFeatures, function (el) {\r\n\t\t\t\t\t\treturn el !== sName;\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t\tself.set('serviceFeatures', serviceFeatures.join(','));\r\n\t\t\t};\r\n\t\t\tsetServiceFeature(name, status);\r\n\t\t\tIX.Debug.info(\"DEBUG: Switch Shop [\" + self.get('shopID') + \"] ServiceFeature: \" + self.get('serviceFeatures'));\r\n\t\t\tthis.switchShopBusinessStatusCallServer({\r\n\t\t\t\tshopID : shopID,\r\n\t\t\t\tserviceFeatures : name,\r\n\t\t\t\toperation : status\r\n\t\t\t}, function (res) {\r\n\t\t\t\tif (res.resultcode !== '000') {\r\n\t\t\t\t\ttoptip({\r\n\t\t\t\t\t\tmsg : $XP(res, 'resultmsg', ''),\r\n\t\t\t\t\t\ttype : 'danger'\r\n\t\t\t\t\t});\r\n\t\t\t\t\tsetServiceFeature(name, !status ? 1 : 0);\r\n\t\t\t\t\tfailFn({\r\n\t\t\t\t\t\tshopID : shopID,\r\n\t\t\t\t\t\tid : id\r\n\t\t\t\t\t});\r\n\t\t\t\t} else {\r\n\t\t\t\t\ttoptip({\r\n\t\t\t\t\t\tmsg : '切换成功!',\r\n\t\t\t\t\t\ttype : 'success'\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t},\r\n\t\tbindEvent : function () {\r\n\t\t\tvar self = this;\r\n\t\t\tthis.on({\r\n\t\t\t\t\"switchShopStatus\" : function (params) {\r\n\t\t\t\t\tvar status = $XP(params, 'status'),\r\n\t\t\t\t\t\tfailFn = $XF(params, 'failFn');\r\n\t\t\t\t\tthis.switchShopStatus(status, failFn);\r\n\t\t\t\t},\r\n\t\t\t\t\"switchBusinessStatus\" : function (params) {\r\n\t\t\t\t\tthis.switchShopBusinessStatus(params);\r\n\t\t\t\t},\r\n\t\t\t\t\"setServiceParams\" : function (cfg) {\r\n\t\t\t\t\tvar callServer = $XF(cfg, 'callServer'),\r\n\t\t\t\t\t\tparams = $XP(cfg, 'params', {}),\r\n\t\t\t\t\t\tserviceID = $XP(cfg, 'serviceID'),\r\n\t\t\t\t\t\tshopID = self.get('shopID'),\r\n\t\t\t\t\t\tfailFn = $XF(cfg, 'failFn'),\r\n\t\t\t\t\t\tsuccessFn = $XF(cfg, 'successFn');\r\n\t\t\t\t\tcallServer(IX.inherit(params, {\r\n\t\t\t\t\t\tshopID : shopID,\r\n\t\t\t\t\t\tstrType : serviceID\r\n\t\t\t\t\t}), function (res) {\r\n\t\t\t\t\t\tif (res.resultcode !== '000') {\r\n\t\t\t\t\t\t\ttoptip({\r\n\t\t\t\t\t\t\t\tmsg : $XP(res, 'resultmsg', ''),\r\n\t\t\t\t\t\t\t\ttype : 'danger'\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\tfailFn();\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tvar newData = {};\r\n\t\t\t\t\t\t\t// var revParamJson = JSON.parse(self.get('revParamJson'));\r\n\t\t\t\t\t\t\tvar revParamJson = self.get('revParamJson') || null;\r\n\t\t\t\t\t\t\trevParamJson = !revParamJson ? {} : JSON.parse(revParamJson);\r\n\t\t\t\t\t\t\trevParamJson = IX.inherit(revParamJson, newData);\r\n\t\t\t\t\t\t\tnewData[serviceID] = params;\r\n\t\t\t\t\t\t\tself.set('revParamJson', JSON.stringify(revParamJson));\r\n\t\t\t\t\t\t\tsuccessFn();\r\n\t\t\t\t\t\t\ttoptip({\r\n\t\t\t\t\t\t\t\tmsg : '配置成功!',\r\n\t\t\t\t\t\t\t\ttype : 'success'\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\t});\r\n})(jQuery, window);;(function ($, window) {\r\n\tIX.ns(\"Hualala.Shop\");\r\n\tvar popoverMsg = Hualala.UI.PopoverMsgTip;\r\n\tvar toptip = Hualala.UI.TopTip;\r\n\tvar CardListView = Stapes.subclass({\r\n\t\tconstructor : function () {\r\n\t\t\t// View层容器\r\n\t\t\tthis.$container = null;\r\n\t\t\t// 结果容器\r\n\t\t\tthis.$resultBox = null;\r\n\t\t\t// 结果列表\r\n\t\t\tthis.$list = null;\r\n\t\t\t// 分页容器\r\n\t\t\tthis.$pager = null;\r\n\t\t\tthis.emptyBar = null;\r\n\t\t\tthis.loadTemplates();\r\n\t\t}\r\n\t});\r\n\tCardListView.proto({\r\n\t\tinit : function (cfg) {\r\n\t\t\tthis.$container = $XP(cfg, 'container', null);\r\n\t\t\tthis.model = $XP(cfg, 'model', null);\r\n\t\t\tif (!this.$container || !this.model) {\r\n\t\t\t\tthrow(\"CardList View Init Failed!\");\r\n\t\t\t\treturn ;\r\n\t\t\t}\r\n\t\t\tthis.initLayout();\r\n\t\t},\r\n\t\tinitLayout : function () {\r\n\t\t\tvar layoutTpl = this.get('layoutTpl');\r\n\t\t\tvar htm = layoutTpl();\r\n\t\t\tthis.$container.append(htm);\r\n\t\t\tthis.$resultBox = this.$container.find('.shop-list');\r\n\t\t\tthis.$list = this.$container.find('.shop-list-body');\r\n\t\t\tthis.$pager = this.$container.find('.page-selection');\r\n\t\t\tthis.initPager();\r\n\t\t\tthis.bindEvent();\r\n\t\t},\r\n\t\tinitPager : function (params) {\r\n\t\t\tvar baseCfg = {\r\n\t\t\t\ttotal : 0,\r\n\t\t\t\tpage : 1,\r\n\t\t\t\tmaxVisible : 10,\r\n\t\t\t\tleaps : true\r\n\t\t\t};\r\n\t\t\tthis.$pager.IXPager(IX.inherit(baseCfg, params));\r\n\t\t},\r\n\t\tbindEvent : function () {\r\n\t\t\tvar self = this;\r\n\t\t\tself.$list.tooltip({\r\n\t\t\t\tselector : '[title]'\r\n\t\t\t});\r\n\t\t\tself.$list.on('click', '.btn[data-href]', function (e) {\r\n\t\t\t\tvar $btn = $(this),\r\n\t\t\t\t\tpath = $btn.attr('data-href');\r\n\t\t\t\tif (!IX.isEmpty(path)) {\r\n\t\t\t\t\tdocument.location.href = path;\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\tself.$pager.on('page', function (e, pageNo) {\r\n\t\t\t\tvar params = self.model.getPagerParams();\r\n\t\t\t\tparams['pageNo'] = pageNo;\r\n\t\t\t\tself.model.emit('load', IX.inherit(params, {\r\n\t\t\t\t\tpageNo : $XP(params, 'pageNo', 1),\r\n\t\t\t\t\tpageSize : $XP(params, 'pageSize', 15)\r\n\t\t\t\t}));\r\n\t\t\t});\r\n\t\t},\r\n\t\t// 加载View层所需模板\r\n\t\tloadTemplates : function () {\r\n\t\t\tvar layoutTpl = Handlebars.compile(Hualala.TplLib.get('tpl_shop_list_layout')),\r\n\t\t\t\tlistTpl = Handlebars.compile(Hualala.TplLib.get('tpl_shop_list')),\r\n\t\t\t\titemTpl = Handlebars.compile(Hualala.TplLib.get('tpl_shop_card')),\r\n\t\t\t\ttagTpl = Handlebars.compile(Hualala.TplLib.get('tpl_shop_tags'));\r\n\t\t\t// 注册shopCard子模板\r\n\t\t\tHandlebars.registerPartial(\"shopTag\", Hualala.TplLib.get('tpl_shop_tags'));\r\n\t\t\tHandlebars.registerPartial(\"shopCard\", Hualala.TplLib.get('tpl_shop_card'));\r\n\r\n\t\t\tthis.set({\r\n\t\t\t\tlayoutTpl : layoutTpl,\r\n\t\t\t\tlistTpl : listTpl,\r\n\t\t\t\titemTpl : itemTpl,\r\n\t\t\t\ttagTpl : tagTpl\r\n\t\t\t});\r\n\t\t},\r\n\t\t// 组装标签\r\n\t\tmapTags : function (d) {\r\n\t\t\tvar self = this,\r\n\t\t\t\ttagKeys = 'areaName,cuisineName1,cuisineName2'.split(',');\r\n\t\t\tvar tags = _.map(tagKeys, function (k) {\r\n\t\t\t\treturn $XP(d, k, null);\r\n\t\t\t});\r\n\t\t\treturn _.filter(tags, function (t) {\r\n\t\t\t\treturn !IX.isEmpty(t);\r\n\t\t\t});\r\n\t\t},\r\n\t\t// 格式化渲染数据\r\n\t\tmapRenderData : function (data) {\r\n\t\t\tvar self = this;\r\n\t\t\tvar getTags = function (tags) {\r\n\t\t\t\treturn _.map(tags, function (t, i, l) {\r\n\t\t\t\t\treturn {\r\n\t\t\t\t\t\tclz : 'label-info',\r\n\t\t\t\t\t\ttag : t\r\n\t\t\t\t\t};\r\n\t\t\t\t});\r\n\t\t\t};\r\n\t\t\tvar ret = _.map(data, function (shop, i, l) {\r\n\t\t\t\tvar address = $XP(shop, 'address', ''),\r\n\t\t\t\t\tbyteLen = Hualala.Common.strByteLength(address),\r\n\t\t\t\t\tslugAddr = '';\r\n\t\t\t\tslugAddr = byteLen < 72 ? address : (Hualala.Common.substrByte(address, 70) + '...');\r\n\t\t\t\treturn {\r\n\t\t\t\t\tclz : '',\r\n\t\t\t\t\tid : $XP(shop, 'shopID', ''),\r\n\t\t\t\t\tname : $XP(shop, 'shopName', ''),\r\n\t\t\t\t\timg : Hualala.Common.getSourceImage($XP(shop, 'imagePath', ''), {\r\n\t\t\t\t\t\twidth : 100,\r\n\t\t\t\t\t\theight : 100,\r\n\t\t\t\t\t\tquality : 50\r\n\t\t\t\t\t}),\r\n\t\t\t\t\t// tags : getTags($XP(shop, 'tags', [])),\r\n\t\t\t\t\ttags : getTags(self.mapTags(shop)),\r\n\t\t\t\t\taddress : address,\r\n\t\t\t\t\tslugAddr : slugAddr,\r\n\t\t\t\t\ttel : $XP(shop, 'tel', ''),\r\n\t\t\t\t\tinfoHref : Hualala.PageRoute.createPath('shopInfo', [$XP(shop, 'shopID', '')]),\r\n\t\t\t\t\tmenuHref : Hualala.PageRoute.createPath('shopMenu', [$XP(shop, 'shopID', '')]),\r\n\t\t\t\t\tchecked : $XP(shop, 'status') == 1 ? 'checked' : ''\r\n\t\t\t\t};\r\n\t\t\t});\r\n\t\t\treturn {\r\n\t\t\t\tshopCard : {\r\n\t\t\t\t\tlist : ret\r\n\t\t\t\t}\r\n\t\t\t};\r\n\t\t},\r\n\t\t// 渲染开关\r\n\t\tinitSwitcher : function (selector) {\r\n\t\t\tvar self = this;\r\n\t\t\tself.$list.find(selector).bootstrapSwitch({\r\n\t\t\t\t// baseClass : 'ix-bs-switch',\r\n\t\t\t\t// wrapperClass : 'ix-bs-switch-wrapper',\r\n\t\t\t\tsize : 'normal',\r\n\t\t\t\tonColor : 'success',\r\n\t\t\t\toffColor : 'default',\r\n\t\t\t\tonText : '已开通',\r\n\t\t\t\toffText : '未开通'\r\n\t\t\t});\r\n\t\t\t// 绑定开关事件\r\n\t\t\tself.$list.find(selector).on('switchChange.bootstrapSwitch', function (e, state) {\r\n\t\t\t\tvar $chkbox = $(this),\r\n\t\t\t\t\tshopID = $chkbox.attr('data-shop'),\r\n\t\t\t\t\tstate = !state ? 0 : 1;\r\n\t\t\t\tself.model.updateShopStatus(shopID, state, function (_shopID) {\r\n\t\t\t\t\tself.$list.find(selector).filter('[data-shop=' + _shopID + ']').bootstrapSwitch('toggleState', true);\r\n\t\t\t\t});\r\n\t\t\t});\r\n\t\t},\r\n\t\t// 渲染view\r\n\t\trender : function () {\r\n\t\t\tvar self = this,\r\n\t\t\t\tmodel = self.model,\r\n\t\t\t\tpagerParams = model.getPagerParams(),\r\n\t\t\t\tpageNo = $XP(pagerParams, 'pageNo');\r\n\t\t\tvar shops = model.getShops(pageNo);\r\n\t\t\tvar renderData = self.mapRenderData(shops);\r\n\t\t\tvar listTpl = self.get('listTpl');\r\n\t\t\tvar html = listTpl(renderData);\r\n\t\t\tself.emptyBar && self.emptyBar.destroy();\r\n\t\t\tself.$list.empty();\r\n\t\t\tif (shops.length == 0) {\r\n\t\t\t\tself.emptyBar = new Hualala.UI.EmptyPlaceholder({\r\n\t\t\t\t\tcontainer : self.$list\r\n\t\t\t\t});\r\n\t\t\t\tself.emptyBar.show();\r\n\t\t\t} else {\r\n\t\t\t\tself.$list.html(html);\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tself.initPager({\r\n\t\t\t\ttotal : model.get('pageCount'),\r\n\t\t\t\tpage : model.get('pageNo'),\r\n\t\t\t\thref : 'javascript:void(0);'\r\n\t\t\t});\r\n\t\t\t// self.$list.find(':checkbox[name*=switcher_]').bootstrapSwitch();\r\n\t\t\tself.initSwitcher(':checkbox[name=switcher]');\r\n\t\t}\r\n\t});\r\n\r\n\tHualala.Shop.CardListView = CardListView;\r\n\r\n\tvar ShopListView = CardListView.subclass({\r\n\t\tconstructor : function () {\r\n\t\t\t// View层容器\r\n\t\t\tthis.$container = null;\r\n\t\t\t// 结果容器\r\n\t\t\tthis.$resultBox = null;\r\n\t\t\t// 结果列表\r\n\t\t\tthis.$list = null;\r\n\t\t\t// 分页容器\r\n\t\t\tthis.$pager = null;\r\n\t\t\tthis.emptyBar = null;\r\n\t\t\tthis.loadTemplates();\r\n\t\t}\r\n\t});\r\n\tShopListView.proto({\r\n\t\tbindEvent : function () {\r\n\t\t\tvar self = this;\r\n\t\t\tself.$list.tooltip({\r\n\t\t\t\tselector : '[title]'\r\n\t\t\t});\r\n\t\t\tself.$pager.on('page', function (e, pageNo) {\r\n\t\t\t\tvar params = self.model.getPagerParams();\r\n\t\t\t\tparams['pageNo'] = pageNo;\r\n\t\t\t\tself.model.emit('load', IX.inherit(params, {\r\n\t\t\t\t\tpageNo : $XP(params, 'pageNo', 1),\r\n\t\t\t\t\tpageSize : $XP(params, 'pageSize', 15)\r\n\t\t\t\t}));\r\n\t\t\t});\r\n\t\t\t// 弹出修改业务窗口\r\n\t\t\tself.$list.on('click', '.btn[data-business]', function (e) {\r\n\t\t\t\tvar $btn = $(this),\r\n\t\t\t\t\tshopID = $btn.attr('data-shop'),\r\n\t\t\t\t\tbusinessName = $btn.attr('data-business'),\r\n\t\t\t\t\tbusinessID = $btn.attr('data-business-id');\r\n\t\t\t\tself.initBusinessModal($btn, shopID, businessName, businessID);\r\n\t\t\t});\r\n\t\t},\r\n\t\t// 加载View层所需模板\r\n\t\tloadTemplates : function () {\r\n\t\t\tvar layoutTpl = Handlebars.compile(Hualala.TplLib.get('tpl_shop_list_layout')),\r\n\t\t\t\tlistTpl = Handlebars.compile(Hualala.TplLib.get('tpl_shop_list')),\r\n\t\t\t\titemTpl = Handlebars.compile(Hualala.TplLib.get('tpl_shop_list_item')),\r\n\t\t\t\ttagTpl = Handlebars.compile(Hualala.TplLib.get('tpl_shop_tags'));\r\n\t\t\t// 注册shopCard子模板\r\n\t\t\tHandlebars.registerPartial(\"shopTag\", Hualala.TplLib.get('tpl_shop_tags'));\r\n\t\t\tHandlebars.registerPartial(\"shopItem\", Hualala.TplLib.get('tpl_shop_list_item'));\r\n\r\n\t\t\tthis.set({\r\n\t\t\t\tlayoutTpl : layoutTpl,\r\n\t\t\t\tlistTpl : listTpl,\r\n\t\t\t\titemTpl : itemTpl,\r\n\t\t\t\ttagTpl : tagTpl\r\n\t\t\t});\r\n\t\t},\r\n\t\t/**\r\n\t\t * 获取店铺业务描述信息\r\n\t\t * @param  {Int} businessID    业务ID(10:常规预订,11:闪吃,20:外送,21:到店自提,41:店内自助)\r\n\t\t * @param  {Int} operationMode 餐厅运营模式 0：正餐；1：正餐\r\n\t\t * @param  {Object} businessInfo  业务配置信息\r\n\t\t * @return {String}               业务配置描述\r\n\t\t */\r\n\t\tgetBusinessDesc : function (businessID, operationMode, businessInfo) {\r\n\t\t\tvar self = this;\r\n\t\t\tvar tpl = null, renderKeys = null, params = null, htm = '';\r\n\t\t\tvar minuteIntervalOpts = Hualala.TypeDef.MinuteIntervalOptions();\r\n\t\t\tvar getMinutIntervalLabel = function (v) {\r\n\t\t\t\tvar m = _.find(minuteIntervalOpts, function (el, i) {\r\n\t\t\t\t\treturn $XP(el, 'value') == v;\r\n\t\t\t\t});\r\n\t\t\t\treturn $XP(m, 'label', '');\r\n\t\t\t};\r\n\t\t\tswitch(businessID) {\r\n\t\t\t\t// 常规预定点菜\r\n\t\t\t\tcase 10:\r\n\t\t\t\t\ttpl = Handlebars.compile(Hualala.TplLib.get('tpl_shop_commonreserve_desc'));\r\n\t\t\t\t\trenderKeys = 'advanceTime,noticeTime,minAmount,reserveTableTime,reserveTableDesc,payMethod'.split(',');\r\n\t\t\t\t\tparams = _.map(renderKeys, function (k) {\r\n\t\t\t\t\t\tvar r = $XP(businessInfo, k, '');\r\n\t\t\t\t\t\tswitch(k) {\r\n\t\t\t\t\t\t\tcase \"advanceTime\":\r\n\t\t\t\t\t\t\t\tr = IX.isEmpty(r) || r == 0 ? '不限制顾客提前预定时间' : ('顾客需提前' + getMinutIntervalLabel(r) + '预订, ');\r\n\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\tcase \"noticeTime\":\r\n\t\t\t\t\t\t\t\tr = IX.isEmpty(r) || r == 0 ? '订单立即通知餐厅' : ('订单提前' + getMinutIntervalLabel(r) + '通知餐厅, ');\r\n\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\tcase \"minAmount\":\r\n\t\t\t\t\t\t\t\tr = IX.isEmpty(r) || r == 0 ? '' : ('最低消费' + r + Hualala.Constants.CashUnit + ', ');\r\n\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\tcase \"reserveTableTime\":\r\n\t\t\t\t\t\t\t\tr = IX.isEmpty(r) || r == 0 ? '' : ('留位' + getMinutIntervalLabel(r) + ', ');\r\n\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\tcase \"reserveTableDesc\":\r\n\t\t\t\t\t\t\t\tr = IX.isEmpty(r) ? '' : r + ',';\r\n\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\tcase \"payMethod\":\r\n\t\t\t\t\t\t\t\tr = (r == 0 ? '仅支持在线支付' : (r == 1 ? '仅支持线下支付' : '线上及线下支付均支持')) + ', ';\r\n\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\treturn r;\r\n\t\t\t\t\t});\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t// 闪吃描述\r\n\t\t\t\tcase 11:\r\n\t\t\t\t\ttpl = Handlebars.compile(Hualala.TplLib.get('tpl_shop_justeat_desc'));\r\n\t\t\t\t\trenderKeys = 'servicePeriods,holidayFlag,minAmount,advanceTime,noticeTime,reserveTableTime,reserveTableDesc,payMethod'.split(',');\r\n\t\t\t\t\tparams = _.map(renderKeys, function (k) {\r\n\t\t\t\t\t\tvar r = $XP(businessInfo, k, '');\r\n\t\t\t\t\t\tswitch(k) {\r\n\t\t\t\t\t\t\tcase \"servicePeriods\" :\r\n\t\t\t\t\t\t\t\tr = '开放时间段：' + r.replace(',', '-').replace(/([\\d]{2})([\\d]{2})/g, '$1:$2') + ', ';\r\n\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\tcase \"holidayFlag\" : \r\n\t\t\t\t\t\t\t\tr = (r == 0 ? '工作日及节假日均开放' : (r == 1 ? '仅节假日开放' : '仅工作日开放')) + ', ';\r\n\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\tcase \"minAmount\" : \r\n\t\t\t\t\t\t\t\tr = IX.isEmpty(r) || r == 0 ? '' : ('最低消费' + r + Hualala.Constants.CashUnit + ', ');\r\n\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\tcase \"advanceTime\" : \r\n\t\t\t\t\t\t\t\tr = IX.isEmpty(r) || r == 0 ? '不限制顾客提前预定时间' : ('顾客需提前' + getMinutIntervalLabel(r) + '预订, ');\r\n\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\tcase \"noticeTime\" : \r\n\t\t\t\t\t\t\t\tr = IX.isEmpty(r) || r == 0 ? '订单立即通知餐厅' : ('订单提前' + getMinutIntervalLabel(r) + '通知餐厅, ');\r\n\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\tcase \"reserveTableTime\" : \r\n\t\t\t\t\t\t\t\tr = IX.isEmpty(r) || r == 0 ? '' : ('留位' + getMinutIntervalLabel(r) + ', ');\r\n\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\tcase \"reserveTableDesc\" : \r\n\t\t\t\t\t\t\t\tr = IX.isEmpty(r) ? '' : r + ',';\r\n\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\tcase \"payMethod\":\r\n\t\t\t\t\t\t\t\tr = (r == 0 ? '仅支持在线支付' : (r == 1 ? '仅支持线下支付' : '线上及线下支付均支持')) + ', ';\r\n\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\treturn r;\r\n\t\t\t\t\t});\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t// 店内自助描述\r\n\t\t\t\tcase 41:\r\n\t\t\t\t\ttpl = Handlebars.compile(Hualala.TplLib.get('tpl_shop_spotorder_desc'));\r\n\t\t\t\t\trenderKeys = operationMode == 0 ?\r\n\t\t\t\t\t\t// 'isDinner,supportCommitToSoftware,payMethodAtShop,payBeforeCommit'.split(',') :\r\n\t\t\t\t\t\t'isDinner,supportCommitToSoftware,checkSpotOrder,payBeforeCommit'.split(',') :\r\n\t\t\t\t\t\t'isDinner,supportCommitToSoftware,fetchFoodMode'.split(',');\r\n\t\t\t\t\tparams = _.map(renderKeys, function (k) {\r\n\t\t\t\t\t\tvar r = $XP(businessInfo, k, '');\r\n\t\t\t\t\t\tswitch(k) {\r\n\t\t\t\t\t\t\tcase \"isDinner\":\r\n\t\t\t\t\t\t\t\tr = operationMode == 0 ? true : false;\r\n\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\tcase \"supportCommitToSoftware\":\r\n\t\t\t\t\t\t\t\tr = (r == 1 ? '支持' : '不支持') + '下单到餐饮软件, ';\r\n\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\tcase \"fetchFoodMode\":\r\n\t\t\t\t\t\t\t\tr = '下单后' + (r == 1 ? '凭牌号' : (r == 2 ? '直接' : '凭流水号')) + '在收银台取餐, ';\r\n\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\tcase \"checkSpotOrder\":\r\n\t\t\t\t\t\t\t\tr = (r == 1 ? '支持' : '不支持') + '顾客通过手机结账, ';\r\n\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\tcase \"payMethodAtShop\":\r\n\t\t\t\t\t\t\t\tr = (r == 1 ? '餐前先通过手机结账' : (r == 2 ? '餐后可通过手机结账' : '不能用手机结账')) + ', ';\r\n\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\tcase \"payBeforeCommit\":\r\n\t\t\t\t\t\t\t\t// r = r == 1 ? '支付完成后才能下单, ' : '';\r\n\t\t\t\t\t\t\t\tr = (r == 1 ? '餐前' : '餐后') + '结账, ';\r\n\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\treturn r;\r\n\t\t\t\t\t});\r\n\t\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t\tif (businessID == 11 || businessID == 41 || businessID == 10) {\r\n\t\t\t\thtm = tpl(_.object(renderKeys, params));\r\n\t\t\t\thtm = htm.slice(0, htm.lastIndexOf(','));\r\n\t\t\t}\r\n\t\t\treturn htm;\r\n\t\t},\r\n\t\t// 获取店铺业务信息数据\r\n\t\tgetShopBusiness : function (shop) {\r\n\t\t\tvar self = this;\r\n\t\t\tvar business = Hualala.TypeDef.ShopBusiness,\r\n\t\t\t\tbusinessHT = new IX.IListManager(),\r\n\t\t\t\tserviceFeatures = $XP(shop, 'serviceFeatures', ''),\r\n\t\t\t\t// businessCfg = JSON.parse($XP(shop, 'revParamJson', {})),\r\n\t\t\t\tbusinessCfg = $XP(shop, 'revParamJson', null);\r\n\t\t\tbusinessCfg = !businessCfg ? {} : JSON.parse(businessCfg)\r\n\t\t\tvar ret = null;\r\n\t\t\t_.each(business, function (item, i, l) {\r\n\t\t\t\tvar id = $XP(item, 'id'), name = $XP(item, 'name')\r\n\t\t\t\t\tswitcherStatus = serviceFeatures.indexOf(name) >= 0 ? 1 : 0,\r\n\t\t\t\t\tbusinessInfo = $XP(businessCfg, id.toString(), {}),\r\n\t\t\t\t\toperationMode = $XP(shop, 'operationMode', null);\r\n\t\t\t\tvar ret = IX.inherit(item, businessInfo, {\r\n\t\t\t\t\tswitcherStatus : switcherStatus,\r\n\t\t\t\t\tshopID : $XP(shop, 'shopID'),\r\n\t\t\t\t\tdesc : self.getBusinessDesc(id, operationMode, businessInfo)\r\n\t\t\t\t});\r\n\t\t\t\tbusinessHT.register(name, ret);\r\n\t\t\t});\r\n\t\t\tret = _.filter(businessHT.getAll(), function (el) {\r\n\t\t\t\treturn $XP(el, 'businessIsSupported', false) == true;\r\n\t\t\t});\r\n\t\t\treturn ret;\r\n\t\t},\r\n\t\t// 获取店铺业务信息渲染数据\r\n\t\tmapBusinessRenderData : function (shop) {\r\n\t\t\tvar self = this,\r\n\t\t\t\tdata = self.getShopBusiness(shop);\r\n\t\t\treturn _.map(data, function (el) {\r\n\t\t\t\tvar name = $XP(el, 'name'),\r\n\t\t\t\t\ticon = 'icon-' + name,\r\n\t\t\t\t\tswitcherName = 'switcher_business',\r\n\t\t\t\t\topen = $XP(el, 'switcherStatus') == 1 ? 'checked' : '';\r\n\t\t\t\treturn {\r\n\t\t\t\t\ticon : icon,\r\n\t\t\t\t\tlabel : $XP(el, 'label'),\r\n\t\t\t\t\tswitcherName : switcherName,\r\n\t\t\t\t\tshopID : $XP(el, 'shopID'),\r\n\t\t\t\t\ttype : name,\r\n\t\t\t\t\tid : $XP(el, 'id'),\r\n\t\t\t\t\topen : open,\r\n\t\t\t\t\tdesc : $XP(el, 'desc', '')\r\n\t\t\t\t};\r\n\t\t\t});\r\n\t\t},\r\n\t\t// 校验是否有财务或更高权限\r\n\t\tchkHasAccountRole : function () {\r\n\t\t\tvar loginUsr = Hualala.getSessionUser(),\r\n\t\t\t\tusrRoles = $XP(loginUsr, 'role');\r\n\t\t\t\troles = Hualala.getSessionRoles();\r\n\t\t\tvar ret = _.find(roles, function (role) {\r\n\t\t\t\tvar roleType = $XP(role, 'roleType');\r\n\t\t\t\tvar matchedID = _.find(usrRoles, function (v) {\r\n\t\t\t\t\treturn $XP(role, 'id') == v;\r\n\t\t\t\t});\r\n\t\t\t\treturn !!matchedID && (roleType == 'account' || roleType == 'all');\r\n\t\t\t});\r\n\t\t\treturn !!ret;\r\n\t\t},\r\n\t\t// 格式化渲染数据\r\n\t\tmapRenderData : function (data) {\r\n\t\t\tvar self = this;\r\n\t\t\tvar ret = _.map(data, function (shop, i, l) {\r\n\t\t\t\treturn {\r\n\t\t\t\t\tclz : '',\r\n\t\t\t\t\tshopID : $XP(shop, 'shopID', ''),\r\n\t\t\t\t\tshopName : $XP(shop, 'shopName', ''),\r\n\t\t\t\t\thideAccount : !self.chkHasAccountRole() ? 'hidden' : '',\r\n\t\t\t\t\tsettleName : $XP(shop, 'settleName', ''),\r\n\t\t\t\t\tswitcherName : 'switcher_status',\r\n\t\t\t\t\tshopOpen : $XP(shop, 'status') == 1 ? 'checked' : '',\r\n\t\t\t\t\tbusiness : self.mapBusinessRenderData(shop)\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\treturn {\r\n\t\t\t\tshopItem : {\r\n\t\t\t\t\tlist : ret\r\n\t\t\t\t}\r\n\t\t\t};\r\n\t\t},\r\n\t\t// 渲染开关\r\n\t\tinitSwitcher : function (selector) {\r\n\t\t\tvar self = this;\r\n\t\t\tself.$list.find(selector).bootstrapSwitch({\r\n\t\t\t\t// baseClass : 'ix-bs-switch',\r\n\t\t\t\t// wrapperClass : 'ix-bs-switch-wrapper',\r\n\t\t\t\tsize : 'normal',\r\n\t\t\t\tonColor : selector == ':checkbox[name=switcher_business]' ? 'primary' : 'success',\r\n\t\t\t\toffColor : 'default',\r\n\t\t\t\tonText : '已开通',\r\n\t\t\t\toffText : '未开通'\r\n\t\t\t});\r\n\t\t\t// 绑定开关事件\r\n\t\t\tself.$list.find(selector).on('switchChange.bootstrapSwitch', function (e, state) {\r\n\t\t\t\tvar $chkbox = $(this),\r\n\t\t\t\t\tname = $chkbox.attr('name'),\r\n\t\t\t\t\tshopID = $chkbox.attr('data-shop'),\r\n\t\t\t\t\tstate = !state ? 0 : 1,\r\n\t\t\t\t\tbusiness = $chkbox.attr('data-business'),\r\n\t\t\t\t\tbusinessID = $chkbox.attr('data-business-id');\r\n\t\t\t\tif (name == 'switcher_status') {\r\n\t\t\t\t\tself.model.updateShopStatus(shopID, state, function (_shopID) {\r\n\t\t\t\t\t\tself.$list.find(selector).filter('[data-shop=' + _shopID + ']').bootstrapSwitch('toggleState', true);\r\n\t\t\t\t\t});\r\n\t\t\t\t} else {\r\n\t\t\t\t\tself.model.updateShopBusinessStatus({\r\n\t\t\t\t\t\tshopID : shopID,\r\n\t\t\t\t\t\tname : business,\r\n\t\t\t\t\t\tid : businessID,\r\n\t\t\t\t\t\tstatus : state\r\n\t\t\t\t\t}, function (params) {\r\n\t\t\t\t\t\tself.$list.find(selector).filter('[data-shop=' + $XP(params, 'shopID') + '][data-business-id=' + $XP(params, 'id') + ']')\r\n\t\t\t\t\t\t\t.bootstrapSwitch('toggleState', true);\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t});\r\n\t\t},\r\n\t\t// 渲染view\r\n\t\trender : function () {\r\n\t\t\tvar self = this,\r\n\t\t\t\tmodel = self.model,\r\n\t\t\t\tpagerParams = model.getPagerParams(),\r\n\t\t\t\tpageNo = $XP(pagerParams, 'pageNo');\r\n\t\t\tvar shops = model.getShops(pageNo);\r\n\t\t\tvar renderData = self.mapRenderData(shops);\r\n\t\t\tvar listTpl = self.get('listTpl');\r\n\t\t\tvar html = listTpl(renderData);\r\n\t\t\tself.emptyBar && self.emptyBar.destroy();\r\n\t\t\tself.$list.empty();\r\n\t\t\tif (shops.length == 0) {\r\n\t\t\t\tself.emptyBar = new Hualala.UI.EmptyPlaceholder({\r\n\t\t\t\t\tcontainer : self.$list\r\n\t\t\t\t});\r\n\t\t\t\tself.emptyBar.show();\r\n\t\t\t} else {\r\n\t\t\t\tself.$list.html(html);\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\t\r\n\t\t\tself.initPager({\r\n\t\t\t\ttotal : model.get('pageCount'),\r\n\t\t\t\tpage : model.get('pageNo'),\r\n\t\t\t\thref : 'javascript:void(0);'\r\n\t\t\t});\r\n\t\t\t// self.$list.find(':checkbox[name*=switcher_]').bootstrapSwitch();\r\n\t\t\tself.initSwitcher(':checkbox[name=switcher_business]');\r\n\t\t\tself.initSwitcher(':checkbox[name=switcher_status]');\r\n\t\t},\r\n\t\t// 生成业务编辑窗口\r\n\t\tinitBusinessModal : function (trigger, shopID, name, id) {\r\n\t\t\tvar self = this;\r\n\t\t\tvar editView = new Hualala.Setting.editServiceView({\r\n\t\t\t\ttriggerEl : trigger,\r\n\t\t\t\tserviceID : id,\r\n\t\t\t\tserviceName : name,\r\n\t\t\t\tmodel : self.model.getShopModelByShopID(shopID)\r\n\t\t\t});\r\n\t\t}\r\n\t});\r\n\tHualala.Shop.ShopListView = ShopListView;\r\n})(jQuery, window);;(function ($, window) {\r\n\tIX.ns(\"Hualala.Shop\");\r\n\tvar popoverMsg = Hualala.UI.PopoverMsgTip;\r\n\tvar toptip = Hualala.UI.TopTip;\r\n\tvar LoadingModal = Hualala.UI.LoadingModal;\r\n\tvar ShopListModel = Hualala.Shop.ShopListModel;\r\n\tvar ShopListView = Hualala.Shop.ShopListView;\r\n\tvar ShopListController = Stapes.subclass({\r\n\t\t/**\r\n\t\t * 店铺结果列表控制器\r\n\t\t * @param  {Object} cfg 配置参数\r\n\t\t *          @param {JQueryObj} container 容器\r\n\t\t *          @param {Object} view  店铺结果的View模块实例\r\n\t\t *          @param {Object} model 店铺结果的数据模块实例\r\n\t\t * @return {Object}     \r\n\t\t */\r\n\t\tconstructor : function (cfg) {\r\n\t\t\tthis.set({\r\n\t\t\t\tsessionData : Hualala.getSessionData()\r\n\t\t\t});\r\n\t\t\tthis.container = $XP(cfg, 'container', null);\r\n\t\t\tthis.view = $XP(cfg, 'view', null),\r\n\t\t\tthis.model = $XP(cfg, 'model', null);\r\n\t\t\tif (!this.view || !this.model || !this.container) {\r\n\t\t\t\tthrow(\"Shop List init faild!!\");\r\n\t\t\t}\r\n\t\t\tthis.isReady = false;\r\n\t\t\tthis.bindEvent();\r\n\t\t}\r\n\t});\r\n\tShopListController.proto({\r\n\t\tinit : function (params) {\r\n\t\t\tthis.model.init(params);\r\n\t\t\tthis.view.init({\r\n\t\t\t\tmodel : this.model,\r\n\t\t\t\tcontainer : this.container\r\n\t\t\t});\r\n\t\t\tthis.loadingModal = new LoadingModal({\r\n\t\t\t\tstart : 100\r\n\t\t\t});\r\n\t\t\tthis.isReady = true;\r\n\t\t},\r\n\t\thasReady : function () {return this.isReady;},\r\n\t\tbindEvent : function () {\r\n\t\t\tthis.on({\r\n\t\t\t\tload : function (params) {\r\n\t\t\t\t\tvar self = this;\r\n\t\t\t\t\tif (!self.hasReady()) {\r\n\t\t\t\t\t\tself.init(params);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tself.model.emit('load', params);\r\n\t\t\t\t}\r\n\t\t\t}, this);\r\n\t\t\tthis.model.on({\r\n\t\t\t\tload : function (params) {\r\n\t\t\t\t\tvar self = this;\r\n\t\t\t\t\tvar cbFn = function () {\r\n\t\t\t\t\t\tself.view.emit('render');\r\n\t\t\t\t\t\tself.loadingModal.hide();\r\n\t\t\t\t\t};\r\n\t\t\t\t\tself.loadingModal.show();\r\n\t\t\t\t\tself.model.load(params, cbFn);\r\n\t\t\t\t},\r\n\t\t\t\t// \"update:totalSize\" : function (v) {\r\n\t\t\t\t// \tvar self = this;\r\n\t\t\t\t// \tself.view.initPager({\r\n\t\t\t\t// \t\ttotal : self.get('totalSize'),\r\n\t\t\t\t// \t\tpage : self.get('pageNo')\r\n\t\t\t\t// \t});\r\n\t\t\t\t// }\r\n\t\t\t}, this);\r\n\t\t\tthis.view.on({\r\n\t\t\t\trender : function () {\r\n\t\t\t\t\tvar self = this;\r\n\t\t\t\t\tself.view.render();\r\n\t\t\t\t},\r\n\t\t\t\treloadPager : function (params) {\r\n\t\t\t\t\tvar self = this;\r\n\t\t\t\t\tself.view.initPager(params);\r\n\t\t\t\t}\r\n\t\t\t}, this);\r\n\t\t}\r\n\t});\r\n\tHualala.Shop.ShopListController = ShopListController;\r\n})(jQuery, window);;\r\n;(function($) \r\n{\r\n\tvar defaults = {\r\n            data : {\r\n                isSearchMap: false,\r\n                keyword: '',\r\n                shopName: '',\r\n                tel: '',\r\n                address: '',\r\n                city: '',\r\n                area: '',\r\n                lng: '',\r\n                lat: ''\r\n            },\r\n            searchBox: '.search-box',\r\n            mapResult: '.map-result',\r\n            //mapContainer: '#shopMap',\r\n            mapCanvasId: 'mapCanvas',\r\n            load: function() { },\r\n            serach: function() { }\r\n        };\r\n\tfunction ShopMap(options)\r\n    {\r\n        this.cfg = $.extend({}, defaults, options);\r\n        //this.$shopMap = $(mapContainer);\r\n        this.sContent = '';\r\n        this.$searchBox = $(this.cfg.searchBox);\r\n        this.$mapResult = $(this.cfg.mapResult);\r\n        this.map = '';\r\n        this.searchArea = true;\r\n        this.mapPoint = {};\r\n        \r\n    }\r\n\tShopMap.prototype = \r\n    {\r\n        init: function()\r\n        {\r\n            var self = this,\r\n                markerTrick = false,\r\n                mapParams = self.cfg.data;\r\n            self.map = new BMap.Map(self.cfg.mapCanvasId);\r\n            //添加默认缩放平移控件\r\n            self.map.addControl(new BMap.NavigationControl());\r\n            self.map.enableScrollWheelZoom();\r\n            self.sContent = [\r\n                '<dl class=\"map-shop-info\">',\r\n                    '<dt>' + mapParams.shopName + '</dt>',\r\n                    '<dd>',\r\n                        '<p><span>电话：</span>' + mapParams.tel + '</p>',\r\n                        '<p><span>地址：</span>' + mapParams.address + '</p>',\r\n                    '</dd>',\r\n                '</dl>'\r\n            ].join('');\r\n            \r\n            self[(mapParams.isSearchMap || !mapParams.lng || !mapParams.lat ? 'search' : 'load') + 'Map'](mapParams);\r\n            \r\n            if(self.$searchBox[0])\r\n            {\r\n                var $keyword = self.$searchBox.find('.map-keyword'),\r\n                    $searchBtn = self.$searchBox.find('.map-search-btn'),\r\n                    searchParams = $.extend({}, self.cfg.data);\r\n                $searchBtn.on('click', function ()\r\n                {\r\n                    searchParams.keyword = $.trim($keyword.val());\r\n                    self.searchMap(searchParams);\r\n                });\r\n            }\r\n            \r\n            \r\n            return this;\r\n        },\r\n        loadMap: function(data)\r\n        {\r\n            var self = this;\r\n            data = data || self.self.cfg.data;\r\n            self.map.centerAndZoom(new BMap.Point(data.lng, data.lat), 14);\r\n            self.map.enableScrollWheelZoom();\r\n\r\n            var marker = new BMap.Marker(new BMap.Point(data.lng, data.lat), \r\n                {\r\n                    enableMassClear: true,\r\n                    raiseOnDrag: true\r\n                });\r\n            marker.enableDragging();\r\n            self.map.addOverlay(marker);\r\n            marker.openInfoWindow(new BMap.InfoWindow(self.sContent));\r\n           /* map.addEventListener(\"click\", function(e){\r\n                if(!(e.overlay)){\r\n                    map.clearOverlays();\r\n                    marker.show();\r\n                    map.addOverlay(marker);\r\n                    marker.setPosition(e.point);\r\n                    setResult(e.point.lng, e.point.lat);\r\n                }\r\n            });*/\r\n            marker.addEventListener(\"click\", function(e)\r\n            {\r\n                 marker.openInfoWindow(new BMap.InfoWindow(self.sContent));\r\n            });\r\n            marker.addEventListener(\"dragend\", function(e)\r\n            {\r\n                self.setResult(e.point.lng, e.point.lat);\r\n            });\r\n            self.setResult(data.lng, data.lat);\r\n        },\r\n        searchMap : function (data)\r\n        {\r\n            var self = this;\r\n            data = data || self.cfg.data;\r\n            //self.map.centerAndZoom(new BMap.Point(116.404, 39.915), 14);\r\n            //self.map.enableScrollWheelZoom();\r\n                \r\n            var local = new BMap.LocalSearch(self.map, {\r\n                renderOptions: {map: self.map},\r\n                pageCapacity: 1,\r\n                onInfoHtmlSet : function (poi) {\r\n                    poi.marker.openInfoWindow(new BMap.InfoWindow(self.sContent));\r\n                    //target.openInfoWindow(infoWindow);\r\n                },\r\n                onMarkersSet : function (poi) {\r\n                    //console.info(poi.marker.infoWindow);\r\n                }\r\n            });\r\n            local.search(data.keyword || data.address || data.area || data.city);\r\n\r\n            local.setSearchCompleteCallback(function(results)\r\n            {\r\n                if(local.getStatus() !== BMAP_STATUS_SUCCESS)\r\n                {\r\n                    if(self.searchArea)\r\n                    {\r\n                        local.search(data.area);\r\n                        self.searchArea = false;\r\n                    } else\r\n                    {\r\n                        local.search(data.city);\r\n                    }\r\n                } else \r\n                {\r\n                    //marker.hide();\r\n                }\r\n            });\r\n            local.setMarkersSetCallback(function(pois)\r\n            {\r\n                for(var i = pois.length; i--;)\r\n                {\r\n                    var marker = pois[i].marker;\r\n                    marker.enableDragging();\r\n                    self.setResult(marker.point.lng, marker.point.lat);\r\n                    //var mapParams = {\r\n                    //  width : 250,     // 信息窗口宽度\r\n                    //  height: 100,     // 信息窗口高度\r\n                    //  title : \"Hello\"  // 信息窗口标题\r\n                    //}\r\n                    //var infoWindow = new BMap.InfoWindow(\"World\", mapParams);  // 创建信息窗口对象\r\n                    //map.openInfoWindow(infoWindow,point); //开启信息窗口\r\n                    marker.openInfoWindow(new BMap.InfoWindow(self.sContent));\r\n                    marker.addEventListener(\"click\", function(e)\r\n                    {\r\n                       // markerTrick = true;\r\n                        var pos = this.getPosition();\r\n                        self.setResult(pos.lng, pos.lat);\r\n                    });\r\n                    marker.addEventListener(\"dragend\", function(e)\r\n                    {\r\n                        self.setResult(e.point.lng, e.point.lat);\r\n                    });\r\n                }\r\n            });\r\n            \r\n        },\r\n         /*\r\n         * setResult : 定义得到标注经纬度后的操作\r\n         * 请修改此函数以满足您的需求\r\n         * lng: 标注的经度\r\n         * lat: 标注的纬度\r\n         */\r\n        setResult: function (lng, lat)\r\n        {\r\n            var self = this;\r\n            self.mapPoint = { lng: lng, lat: lat };\r\n            self.$mapResult[0] && self.$mapResult.html('您店铺的经度：' + lng + '    纬度： ' + lat);\r\n        }\r\n\t}\r\n    IX.ns(\"Hualala.Shop\");\r\n    Hualala.Shop.map = function(options) \r\n    { \r\n        return new ShopMap(options).init(); \r\n    };\r\n}(jQuery));\r\n\r\n\r\n\r\n\r\n\r\n\r\n;(function ($, window) {\r\nIX.ns('Hualala.Shop');\r\nvar G = Hualala.Global,\r\n    U = Hualala.UI,\r\n    topTip = U.TopTip; \r\n// 初始化创建店铺页面\r\nHualala.Shop.initCreate = function ($wizard)\r\n{\r\n    //初始化向导控件\r\n    $wizard.bootstrapWizard();\r\n    var bsWizard = $wizard.data('bootstrapWizard'),\r\n        $step1 = $wizard.find('#tab1'),\r\n        $step2 = $wizard.find('#tab2'),\r\n        $step3 = $wizard.find('#tab3'),\r\n        $city = $step1.find('#cityID'),\r\n        $area = $step1.find('#areaID'),\r\n        $cuisine1 = $step1.find('#cuisineID1'),\r\n        $cuisine2 = $step1.find('#cuisineID2');\r\n    // 初始化城市列表下拉框\r\n    initCities($city);\r\n    // 根据所选择的城市设置地标、菜系下拉列表\r\n    $city.on('change', function ()\r\n    {\r\n        var cityID = $(this).val();\r\n        if(!cityID) return;\r\n        \r\n        initAreas($area, cityID);\r\n        initCuisines($cuisine1, $cuisine2, cityID);\r\n        \r\n    });\r\n    // 初始化timepicker\r\n    $step1.find('#openingHoursStart, #openingHoursEnd').timepicker({\r\n        minuteStep: 1,\r\n        showMeridian: false,\r\n        disableFocus : true,\r\n        showInputs : false\r\n    });\r\n    // 初始化表单验证\r\n    $step1.bootstrapValidator({\r\n        fields: {\r\n            shopName: {\r\n                message: '店铺名无效',\r\n                validators: {\r\n                    notEmpty: {\r\n                        message: '店铺名不能为空'\r\n                    },\r\n                    stringLength: {\r\n                        min: 2,\r\n                        max: 100,\r\n                        message: '店铺名长度必须在2到100个字符之间'\r\n                    }\r\n                }\r\n            },\r\n            cityID: {\r\n                validators: { notEmpty: { message: '请选择店铺所在城市' } }\r\n            },\r\n            tel: {\r\n                validators: {\r\n                    notEmpty: { message: '店铺电话不能为空' },\r\n                    telOrMobile: { message: '' }\r\n                }\r\n            },\r\n            address: {\r\n                validators: {\r\n                    notEmpty: { message: '店铺地址不能为空' },\r\n                    stringLength: {\r\n                        min: 2,\r\n                        max: 100,\r\n                        message: '地址长度必须在6到100个字符之间'\r\n                    }\r\n                }\r\n            },\r\n            PCCL: {\r\n                validators: {\r\n                    notEmpty: { message: '人均消费不能为空' },\r\n                    numeric: { message: '人均消费必须是金额数字' }\r\n                }\r\n            },\r\n            operationMode: {\r\n                validators: {\r\n                    notEmpty: { message: '请选择店铺运营模式' }\r\n                }\r\n            },\r\n            openingHoursStart: {\r\n                validators: {\r\n                    notEmpty: { message: '每天营业开始时间不能空' },\r\n                    time: { message: '' }\r\n                }\r\n            },\r\n            openingHoursEnd: {\r\n                validators: {\r\n                    notEmpty: { message: '每天营业结束时间不能空' },\r\n                    time: {\r\n                        message: '',\r\n                        startTimeField: 'openingHoursStart'\r\n                    }\r\n                }\r\n            },\r\n            areaID: {\r\n                validators: {\r\n                    notEmpty: { message: '请选择店铺所在地标' }\r\n                }\r\n            },\r\n            cuisineID1: {\r\n                validators: {\r\n                    notEmpty: { message: '请选择菜系1' }\r\n                }\r\n            }\r\n        }\r\n    });\r\n    \r\n    var $uploadImg = $step1.find('#uploadImg'),\r\n        imagePath = ''; // 门头图图片路径\r\n    $uploadImg.find('img').attr('src', G.IMAGE_ROOT + '/shop_head_img_default.png');\r\n    // 上传门头图\r\n    $uploadImg.find('button, img').on('click', function()\r\n    {\r\n        U.uploadImg({\r\n            onSuccess: function (imgPath, $dlg)\r\n            {\r\n                var src = G.IMAGE_RESOURCE_DOMAIN + '/' + imgPath;\r\n                imagePath = imgPath;\r\n                $uploadImg.find('img').attr('src', src);\r\n                $dlg.modal('hide');\r\n            }\r\n        });\r\n    });\r\n    //bsWizard.show(1);\r\n    var dataStep1 = null, // 第一步店铺基本信息数据\r\n        map = null, // 地图组件实例\r\n        shopID = '',\r\n        $searchBox = $step2.find('.map-search-box'),\r\n        $shopSettingLink = $step3.find('#shopSettingLink');\r\n    // 向导组件的下一步行为控制\r\n    $wizard.find('#nextStep').on('click', function()\r\n    {\r\n        var $curStep = bsWizard.activePane();\r\n        // 第一步\r\n        if($curStep.is('#tab1'))\r\n        {\r\n            if(!$step1.data('bootstrapValidator').validate().isValid()) return;\r\n            // 数据提交前预处理\r\n            dataStep1 = Hualala.Common.parseForm($step1);\r\n            dataStep1.shopID = shopID;\r\n            dataStep1.shopName = dataStep1.shopName.replace('（', '(').replace('）', ')');\r\n            dataStep1.areaName = getSelectText($area);\r\n            dataStep1.cuisineName1 = getSelectText($cuisine1);\r\n            dataStep1.cuisineName2 = dataStep1.cuisineID2 ? getSelectText($cuisine2) : '';\r\n            dataStep1.imagePath = imagePath;\r\n            dataStep1.openingHours = dataStep1.openingHoursStart + '-' + dataStep1.openingHoursEnd;\r\n            var keywords = [dataStep1.shopName, dataStep1.address, dataStep1.cuisineName1];\r\n            dataStep1.cuisineName2 && keywords.push(dataStep1.cuisineName2);\r\n            keywords.push(dataStep1.areaName);\r\n            dataStep1.keywordLst = keywords.join(' | ');\r\n            // 根据店铺是否已经产生调用不同的服务\r\n            var callServer = shopID ? G.updateShopBaseInfo : G.createShop;\r\n            callServer(dataStep1, function(rsp)\r\n            {\r\n                if(rsp.resultcode != '000')\r\n                {\r\n                    rsp.resultmsg && topTip({msg: rsp.resultmsg, type: 'danger'});\r\n                    return;\r\n                }\r\n                shopID = shopID || rsp.data.records[0].shopID;\r\n                $shopSettingLink.attr('href', Hualala.PageRoute.createPath('setting'));\r\n                // 进入第二步标注地图\r\n                bsWizard.next();\r\n                // 地图对象必须在第二步面板显示出来后初始化\r\n                map = Hualala.Shop.map({data: {\r\n                    isSearchMap: true,\r\n                    shopName: dataStep1.shopName,\r\n                    tel: dataStep1.tel,\r\n                    address: dataStep1.address\r\n                }, searchBox: $searchBox});\r\n                \r\n            });\r\n            \r\n            return;\r\n        }\r\n        // 第二步\r\n        if($curStep.is('#tab2'))\r\n        {\r\n            var lng = map.mapPoint.lng, lat = map.mapPoint.lat,\r\n                mapInfo = {\r\n                    shopID: shopID,\r\n                    mapLongitudeValue: lng,\r\n                    mapLatitudeValue: lat,\r\n                    mapLongitudeValueBaiDu: lng,\r\n                    mapLatitudeValueBaiDu: lat\r\n                };\r\n            var callServer = G.setShopMap;\r\n            callServer(mapInfo, function(rsp)\r\n            {\r\n                if(rsp.resultcode != '000')\r\n                {\r\n                    rsp.resultmsg && topTip({msg: rsp.resultmsg, type: 'danger'});\r\n                    return;\r\n                }\r\n            });\r\n        }\r\n        bsWizard.next();\r\n    });\r\n    \r\n}\r\n// 初始化菜系下拉列表\r\nfunction initCuisines($cuisine1, $cuisine2, cityID)\r\n{\r\n    var callServer = G.getCuisines;\r\n    callServer({cityID: cityID}, function(rsp)\r\n    {\r\n        if(rsp.resultcode != '000')\r\n        {\r\n            rsp.resultmsg && topTip({msg: rsp.resultmsg, type: 'danger'});\r\n            return;\r\n        }\r\n        \r\n        fillSelectBox($cuisine1, rsp.data.records, 'cuisineID', 'cuisineName');\r\n        fillSelectBox($cuisine2, rsp.data.records, 'cuisineID', 'cuisineName', '--不限--');\r\n    });\r\n    \r\n}\r\n// 初始化地标下拉列表\r\nfunction initAreas($selectBox, cityID)\r\n{\r\n    var callServer = G.getAreas;\r\n    callServer({cityID: cityID}, function(rsp)\r\n    {\r\n        if(rsp.resultcode != '000')\r\n        {\r\n            rsp.resultmsg && topTip({msg: rsp.resultmsg, type: 'danger'});\r\n            return;\r\n        }\r\n        \r\n        fillSelectBox($selectBox, rsp.data.records, 'areaID', 'areaName');\r\n    });\r\n    \r\n}\r\n// 初始化城市下拉列表\r\nfunction initCities($selectBox)\r\n{\r\n    var callServer = G.getCities;\r\n    callServer({isActive: 1}, function(rsp)\r\n    {\r\n        if(rsp.resultcode != '000')\r\n        {\r\n            rsp.resultmsg && topTip({msg: rsp.resultmsg, type: 'danger'});\r\n            return;\r\n        }\r\n        \r\n        fillSelectBox($selectBox, rsp.data.records, 'cityID', 'cityName');\r\n    });\r\n    \r\n}\r\n// 设置下拉列表的项\r\nfunction fillSelectBox($selectBox, data, key, value, initialValue)\r\n{\r\n    var optionsHtml = '<option value=\"\">' + \r\n                      (initialValue || '--请选择--') + \r\n                      '</option>';\r\n    $.each(data, function (i, o)\r\n    {\r\n        optionsHtml += '<option value=\"' + \r\n                       o[key] + '\">' + \r\n                       o[value] + \r\n                       '</option>';\r\n    });\r\n        \r\n    $selectBox.empty().html(optionsHtml);\r\n}\r\n// 处理并获取下拉列表当前选择项的文本\r\nfunction getSelectText($select)\r\n{\r\n    return $select.find('option:selected').text().replace(/-/g, '');\r\n}\r\n\r\n})(jQuery, window);\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n;(function ($, window) {\r\nIX.ns('Hualala.Shop');\r\nvar G = Hualala.Global,\r\n    U = Hualala.UI,\r\n    S = Hualala.Shop,\r\n    topTip = U.TopTip,\r\n    parseForm = Hualala.Common.parseForm;\r\n// 初始化店铺店铺详情页面\r\nS.initInfo = function ($container, pageType, params)\r\n{\r\n    if(!params) return;\r\n    // 渲染店铺功能导航\r\n    var $shopFuncNav = S.createShopFuncNav(pageType, params, $container);\r\n    \r\n    var shopID = params, shopInfo = null,\r\n        $form = null, $city = null, $area = null, \r\n        $cuisine1 = null, $cuisine2 = null,\r\n        imagePath = '', $img = null,\r\n        imgHost = G.IMAGE_RESOURCE_DOMAIN + '/',\r\n        bv = null, map = null;\r\n    \r\n    G.getShopInfo({shopID : shopID}, function (rsp)\r\n    {\r\n        if(rsp.resultcode != '000')\r\n        {\r\n            rsp.resultmsg && topTip({msg: rsp.resultmsg, type: 'danger'});\r\n            return;\r\n        }\r\n        shopInfo = rsp.data.records[0];\r\n        \r\n        // 渲染店铺详情头部\r\n        S.createShopInfoHead(shopInfo, $container, function($shopInfoHead)\r\n        {\r\n            $shopFuncNav.before($shopInfoHead);\r\n        });\r\n        \r\n        var openTime = shopInfo.openingHours.split('-');\r\n        shopInfo.openingHoursStart = openTime[0];\r\n        shopInfo.openingHoursEnd = openTime[1];\r\n        shopInfo.operationModeName = shopInfo.operationMode == '1' ? '快餐' : '正餐';\r\n        \r\n        var tpl = Handlebars.compile(Hualala.TplLib.get('tpl_shop_info'));\r\n        $form = $(tpl(shopInfo)).appendTo($container);\r\n        $city = $form.find('#cityID'),\r\n        $area = $form.find('#areaID'),\r\n        $cuisine1 = $form.find('#cuisineID1'),\r\n        $cuisine2 = $form.find('#cuisineID2');\r\n        \r\n        // 初始化城市列表下拉框\r\n        $city.on('change', function (e, areaID, cuisineID1, cuisineID2)\r\n        {\r\n            var cityID = $(this).val();\r\n            if(!cityID) return;\r\n            \r\n            initAreas($area, cityID, areaID);\r\n            initCuisines($cuisine1, $cuisine2, cityID, cuisineID1, cuisineID2);\r\n            \r\n        });\r\n        initCities($city, shopInfo);\r\n        // 根据所选择的城市设置地标、菜系下拉列表\r\n        \r\n        // 初始化timepicker\r\n        $form.find('#openingHoursStart, #openingHoursEnd').timepicker({\r\n            minuteStep: 1,\r\n            showMeridian: false,\r\n            disableFocus : true,\r\n            showInputs : false\r\n        });\r\n        // 初始化表单验证\r\n        $form.bootstrapValidator({\r\n            fields: {\r\n                shopName: {\r\n                    message: '店铺名无效',\r\n                    validators: {\r\n                        notEmpty: {\r\n                            message: '店铺名不能为空'\r\n                        },\r\n                        stringLength: {\r\n                            min: 2,\r\n                            max: 100,\r\n                            message: '店铺名长度必须在2到100个字符之间'\r\n                        }\r\n                    }\r\n                },\r\n                cityID: {\r\n                    validators: { notEmpty: { message: '请选择店铺所在城市' } }\r\n                },\r\n                tel: {\r\n                    validators: {\r\n                        notEmpty: { message: '店铺电话不能为空' },\r\n                        telOrMobile: { message: '' }\r\n                    }\r\n                },\r\n                address: {\r\n                    validators: {\r\n                        notEmpty: { message: '店铺地址不能为空' },\r\n                        stringLength: {\r\n                            min: 2,\r\n                            max: 100,\r\n                            message: '地址长度必须在6到100个字符之间'\r\n                        }\r\n                    }\r\n                },\r\n                PCCL: {\r\n                    validators: {\r\n                        notEmpty: { message: '人均消费不能为空' },\r\n                        numeric: { message: '人均消费必须是金额数字' }\r\n                    }\r\n                },\r\n                operationMode: {\r\n                    validators: {\r\n                        notEmpty: { message: '请选择店铺运营模式' }\r\n                    }\r\n                },\r\n                openingHoursStart: {\r\n                    validators: {\r\n                        notEmpty: { message: '每天营业开始时间不能空' },\r\n                        time: { message: '' }\r\n                    }\r\n                },\r\n                openingHoursEnd: {\r\n                    validators: {\r\n                        notEmpty: { message: '每天营业结束时间不能空' },\r\n                        time: {\r\n                            message: '',\r\n                            startTimeField: 'openingHoursStart'\r\n                        }\r\n                    }\r\n                },\r\n                areaID: {\r\n                    validators: {\r\n                        notEmpty: { message: '请选择店铺所在地标' }\r\n                    }\r\n                },\r\n                cuisineID1: {\r\n                    validators: {\r\n                        notEmpty: { message: '请选择菜系1' }\r\n                    }\r\n                }\r\n            }\r\n        });\r\n        bv = $form.data('bootstrapValidator');\r\n        \r\n        var $uploadImg = $form.find('#uploadImg');\r\n        $img = $uploadImg.find('img').attr('src', G.IMAGE_ROOT + '/shop_head_img_default.png');\r\n        imagePath = shopInfo.imagePath;\r\n        imagePath && $img.attr('src', imgHost + imagePath);\r\n        \r\n        map = S.map({data: {\r\n            isSearchMap: false,\r\n            shopName: shopInfo.shopName,\r\n            tel: shopInfo.tel,\r\n            address: shopInfo.address,\r\n            lng: shopInfo.mapLongitudeValueBaiDu,\r\n            lat: shopInfo.mapLatitudeValueBaiDu\r\n        }});\r\n        \r\n    });\r\n    // click 事件 delegate\r\n    $container.on('click', function(e)\r\n    {\r\n        var $target = $(e.target);\r\n        // 修改门头图\r\n        if($target.is('#uploadImg img, #uploadImg a'))\r\n        {\r\n            U.uploadImg({\r\n                onSuccess: function (imgPath, $dlg)\r\n                {\r\n                    imagePath = imgPath;\r\n                    $img.attr('src', imgHost + imgPath);\r\n                    $dlg.modal('hide');\r\n                }\r\n            });\r\n        }\r\n        // 重新标记地图\r\n        if($target.is('#remarkMap'))\r\n        {\r\n            if(bv.isValidField('shopName') && bv.isValidField('tel') && bv.isValidField('address'))\r\n            {\r\n                var coords = map.mapPoint,\r\n                    formData = parseForm($form);\r\n                map = S.map({data: {\r\n                    isSearchMap: false,\r\n                    shopName: formData.shopName,\r\n                    tel: formData.tel,\r\n                    address: formData.address,\r\n                    lng: coords.lng,\r\n                    lat: coords.lat\r\n                }});\r\n                \r\n                var mapInfo = {\r\n                        shopID: shopID,\r\n                        mapLongitudeValue: coords.lng,\r\n                        mapLatitudeValue: coords.lat,\r\n                        mapLongitudeValueBaiDu: coords.lng,\r\n                        mapLatitudeValueBaiDu: coords.lat\r\n                    };\r\n                // 标注店铺地图callServer调用\r\n                G.setShopMap(mapInfo, function(rsp)\r\n                {\r\n                    if(rsp.resultcode != '000')\r\n                    {\r\n                        rsp.resultmsg && topTip({msg: rsp.resultmsg, type: 'danger'});\r\n                        return;\r\n                    }\r\n                    \r\n                    topTip({msg: '重新标记地图成功！', type: 'success'});\r\n                    \r\n                });\r\n                \r\n            }\r\n            else\r\n            {\r\n                topTip({msg: '店铺相关信息填写有误！', type: 'danger'});\r\n            }\r\n            \r\n        }\r\n        // 切换为编辑模式\r\n        if($target.is('#editBtn'))\r\n        {\r\n            $form.removeClass('read-mode').addClass('edit-mode');\r\n        }\r\n        // 保存店铺基本信息修改\r\n        if($target.is('#saveBtn'))\r\n        {\r\n            if(!bv.validate().isValid()) return;\r\n            // 数据提交前预处理\r\n            var shopData = parseForm($form);\r\n            shopData.shopID = shopID;\r\n            shopData.shopName = shopData.shopName.replace('（', '(').replace('）', ')');\r\n            shopData.areaName = getSelectText($area);\r\n            shopData.cuisineName1 = getSelectText($cuisine1);\r\n            shopData.cuisineName2 = shopData.cuisineID2 ? getSelectText($cuisine2) : '';\r\n            shopData.imagePath = imagePath;\r\n            shopData.openingHours = shopData.openingHoursStart + '-' + shopData.openingHoursEnd;\r\n            var keywords = [shopData.shopName, shopData.address, shopData.cuisineName1];\r\n            shopData.cuisineName2 && keywords.push(shopData.cuisineName2);\r\n            keywords.push(shopData.areaName);\r\n            shopData.keywordLst = keywords.join(' | ');\r\n            // 保存店铺基本信息callServer调用\r\n            G.updateShopBaseInfo(shopData, function(rsp)\r\n            {\r\n                if(rsp.resultcode != '000')\r\n                {\r\n                    rsp.resultmsg && topTip({msg: rsp.resultmsg, type: 'danger'});\r\n                    return;\r\n                }\r\n                \r\n                $form.removeClass('edit-mode').addClass('read-mode');\r\n                topTip({msg: '保存成功！', type: 'success'});\r\n                updateReadMode($form, shopData);\r\n            });\r\n        }\r\n    });\r\n    \r\n}\r\n// 保存提交后更新店铺信息只读模式\r\nfunction updateReadMode($form, data)\r\n{\r\n    $form.find('input, select').not('.map-keyword, #openingHoursEnd').each(function ()\r\n    {\r\n        var $this = $(this),\r\n            $p = $this.siblings('p');\r\n        if($this.is('#openingHoursStart'))\r\n            $p.text(data.openingHours);\r\n        else if($this.is('select'))\r\n            $p.text(getSelectText($this));\r\n        else\r\n            $p.text($this.val());\r\n    });\r\n}\r\n// 初始化菜系下拉列表\r\nfunction initCuisines($cuisine1, $cuisine2, cityID, cuisineID1, cuisineID2)\r\n{\r\n    var callServer = G.getCuisines;\r\n    callServer({cityID: cityID}, function(rsp)\r\n    {\r\n        if(rsp.resultcode != '000')\r\n        {\r\n            rsp.resultmsg && topTip({msg: rsp.resultmsg, type: 'danger'});\r\n            return;\r\n        }\r\n        \r\n        fillSelectBox($cuisine1, rsp.data.records, 'cuisineID', 'cuisineName');\r\n        fillSelectBox($cuisine2, rsp.data.records, 'cuisineID', 'cuisineName', '--不限--');\r\n        cuisineID1 && $cuisine1.val(cuisineID1);\r\n        cuisineID2 && $cuisine2.val(cuisineID2);\r\n    });\r\n    \r\n}\r\n// 初始化地标下拉列表\r\nfunction initAreas($area, cityID, areaID)\r\n{\r\n    var callServer = G.getAreas;\r\n    callServer({cityID: cityID}, function(rsp)\r\n    {\r\n        if(rsp.resultcode != '000')\r\n        {\r\n            rsp.resultmsg && topTip({msg: rsp.resultmsg, type: 'danger'});\r\n            return;\r\n        }\r\n        \r\n        fillSelectBox($area, rsp.data.records, 'areaID', 'areaName');\r\n        areaID && $area.val(areaID);\r\n    });\r\n    \r\n}\r\n// 初始化城市下拉列表\r\nfunction initCities($city, shopInfo)\r\n{\r\n    var callServer = G.getCities;\r\n    callServer({isActive: 1}, function(rsp)\r\n    {\r\n        if(rsp.resultcode != '000')\r\n        {\r\n            rsp.resultmsg && topTip({msg: rsp.resultmsg, type: 'danger'});\r\n            return;\r\n        }\r\n        \r\n        fillSelectBox($city, rsp.data.records, 'cityID', 'cityName');\r\n        $city.val(shopInfo.cityID).trigger('change', [shopInfo.areaID, shopInfo.cuisineID1, shopInfo.cuisineID2]);\r\n    });\r\n    \r\n}\r\n// 设置下拉列表的项\r\nfunction fillSelectBox($selectBox, data, key, value, initialValue)\r\n{\r\n    var optionsHtml = '<option value=\"\">' + \r\n                      (initialValue || '--请选择--') + \r\n                      '</option>';\r\n    $.each(data, function (i, o)\r\n    {\r\n        optionsHtml += '<option value=\"' + \r\n                       o[key] + '\">' + \r\n                       o[value] + \r\n                       '</option>';\r\n    });\r\n        \r\n    $selectBox.empty().html(optionsHtml);\r\n}\r\n// 处理并获取下拉列表当前选择项的文本\r\nfunction getSelectText($select)\r\n{\r\n    return $select.find('option:selected').text().replace(/-/g, '');\r\n}\r\n\r\n})(jQuery, window);\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n;(function ($, window) {\r\nIX.ns('Hualala.Shop');\r\n\r\n// 初始化店铺菜品页面\r\nHualala.Shop.initMenu = function ($container, pageType, params)\r\n{\r\n    if(!params) return;\r\n    \r\n    var G = Hualala.Global,\r\n        U = Hualala.UI,\r\n        topTip = U.TopTip;\r\n    \r\n    var shopID = params;\r\n        imgHost = G.IMAGE_RESOURCE_DOMAIN + '/',\r\n        imgRoot = G.IMAGE_ROOT + '/';\r\n\r\n    var classifiedFoods = null, //已分类菜品\r\n        foodClass = '', //当菜菜品类别的 foodCategoryID\r\n        foods = null, //当前表格显示的菜品数组\r\n        current = 0, //页面滚动时渲染foods所在的索引\r\n        size = 10, // 首次或者滚动加载的food数量\r\n        searchParams = null, //菜品搜索过滤参数\r\n        //修改菜品弹出框里几个 radio 的名称\r\n        foodParams = ['hotTag', 'takeawayTag', 'isDiscount'],\r\n        food = null, //当前菜品\r\n        ef = null; //修改菜品后用于向服务器发送的数据\r\n        \r\n    //单个菜品模板（菜品表格中的一行）\r\n    var foodTpl = Handlebars.compile(Hualala.TplLib.get('tpl_food')),\r\n        //修改菜品弹出框模板\r\n        editFoodTpl = Handlebars.compile(Hualala.TplLib.get('tpl_edit_food'));\r\n        //页面主内容\r\n    var $menu = $(Hualala.TplLib.get('tpl_shop_menu')),\r\n        $foodClass = null, //菜品类别 UI 对象集合\r\n        $foodSearch = $menu.find('#foodSearch'),\r\n        $takeawayTag = $foodSearch.find('#takeawayTag'),\r\n        $foodName = $foodSearch.find('#foodName'),\r\n        $chekbox = $foodSearch.find('input[type=checkbox]'),\r\n        $tblHead = $menu.find('.tbl-foods thead'),\r\n        $foodCount = $menu.find('#foodSearchInfo span'),\r\n        $foods = $menu.find('.tbl-foods tbody'),\r\n        $editFood = null,\r\n        modalEditFood = null, \r\n        bv = null; //表单验证器\r\n    //调用服务，根据 shopID 获取所有分类和菜品信息\r\n    G.getShopMenu({shopID : shopID}, function (rsp)\r\n    {\r\n        if(rsp.resultcode != '000')\r\n        {\r\n            rsp.resultmsg && topTip({msg: rsp.resultmsg, type: 'danger'});\r\n            return;\r\n        }\r\n        \r\n        classifiedFoods = classifyFoods(rsp.data.records);\r\n        renderFoods(); //渲染所有菜品\r\n        //渲染菜品分类\r\n        var $foodClassBox = $menu.find('#foodClassBox').append($('<span class=\"current-food-class\"></span>').text('全部菜品 (' + foods.length + ')'));\r\n        \r\n        for(var id in classifiedFoods)\r\n        {\r\n            var category = classifiedFoods[id]; \r\n            $('<span></span>').data('id', id).text(category.foodCategoryName + ' (' + category.foods.length + ')').appendTo($foodClassBox);\r\n        }\r\n        $foodClass = $foodClassBox.find('span');\r\n        \r\n        var foodNameTpl = Handlebars.compile(Hualala.TplLib.get('tpl_food_name'));\r\n        $foodName.html(foodNameTpl({classifiedFoods: classifiedFoods}));\r\n        initFoodChosen();\r\n        $menu.appendTo($container);\r\n    });\r\n    \r\n    function initFoodChosen() \r\n    {\r\n        var matcher = (new Pymatch([]));\r\n        var sections = foods;\r\n        var getMatchedFn = function (searchText) {\r\n            matcher.setNames(_.map(sections, function (el) {\r\n                return IX.inherit(el, {\r\n                    name : el.foodName\r\n                });\r\n            }));\r\n            var matchedSections = matcher.match(searchText);\r\n            var matchedOptions = {};\r\n            _.each(matchedSections, function (el, i) {\r\n                matchedOptions[el[0].foodID] = true;\r\n            });\r\n            return matchedOptions;\r\n        };\r\n        $foodName.chosen({\r\n            width : '200px',\r\n            placeholder_text : \"选择或输入菜品名称\",\r\n            // max_selected_options: 1,\r\n            no_results_text : \"抱歉，没有相关菜品！\",\r\n            allow_single_deselect : true,\r\n            getMatchedFn : getMatchedFn\r\n        }).change(function()\r\n        {\r\n            searchFood();\r\n        });\r\n    }\r\n    \r\n    //页面滚动时加载更多菜品\r\n    $(window).on('scroll', function(e)\r\n    {\r\n        throttle(scrollFood);\r\n    });\r\n    \r\n    function scrollFood()\r\n    {\r\n        var viewBottom = $(window).scrollTop() + $(window).height(),\r\n            foodsBottom = $foods.offset().top + $foods.height();\r\n        \r\n        if(foodsBottom < viewBottom && current < foods.length)\r\n        {\r\n            renderFoods();\r\n        }\r\n    }\r\n    \r\n    $(document).on('change', function(e)\r\n    {\r\n        var $target = $(e.target);\r\n        //菜品过滤筛选\r\n        if($target.is('#takeawayTag , #foodSearch input[type=checkbox]'))\r\n        {\r\n            searchFood();\r\n        }\r\n        //自定义按钮组相关\r\n        if($target.is('.form-food input[type=radio]'))\r\n        {\r\n            $target.closest('div').find('label').removeClass('active')\r\n            .find('input:checked').parent().addClass('active');\r\n        }\r\n        //修改菜品图片\r\n        if($target.is('.food-pic input'))\r\n        {\r\n            var $foodPic = $editFood.filter('.food-pic');\r\n            if($target.val())\r\n            {\r\n                $foodPic.addClass('loading');\r\n                previewImg($target[0], $foodPic.find('img'));\r\n                $foodPic.submit();\r\n            }\r\n        }\r\n        \r\n    });\r\n    \r\n    top.imgCallback = function(rsp)\r\n    {\r\n        var $foodPic = $editFood.filter('.food-pic');\r\n        var json = $.parseJSON(rsp),\r\n            status = json.status;\r\n        if(status == 'success')\r\n        {\r\n            var url = json.url,\r\n                imageHWP = json.imageHWP || '';\r\n            ef.imagePath = url;\r\n            if(imageHWP) ef.imageHWP = imageHWP;\r\n            if(!FileReader)\r\n            {\r\n                $foodPic.find('img').attr('src', imgHost + url.replace(/\\.\\w+$/, (imageHWP ? '=200x' + Math.round(200 * imageHWP) : '') + '$&?quality=70'));\r\n            }\r\n        }\r\n        else\r\n        {\r\n            topTip({msg: status + '：菜品图片上传失败'});\r\n        }\r\n        $foodPic.removeClass('loading');\r\n        $('#imgResponse').remove();\r\n    }\r\n    \r\n    //图片上传本地预览\r\n    function previewImg(fileInput, $img)\r\n    {\r\n        if (fileInput.files && fileInput.files[0])  \r\n        {\r\n            var reader = new FileReader();  \r\n            reader.onload = function(e){\r\n                $img.attr('src', e.target.result);\r\n            }\r\n            reader.readAsDataURL(fileInput.files[0]);  \r\n        }\r\n    }\r\n    \r\n    //修改菜品\r\n    $foods.on('click', 'tr', function()\r\n    {\r\n        var $this = $(this);\r\n        food = findFood($this.data('cid'), $this.data('id'));\r\n        //菜品图标：招、荐、新\r\n        var foodIcos = ['isSpecialty', 'isRecommend', 'isNew'],\r\n            path = food.imgePath,\r\n            imageHWP = food.imageHWP;\r\n        \r\n        food.foodPic = path ? imgHost + path.replace(/\\.\\w+$/, (imageHWP ? '=200x' + Math.round(200 * food.imageHWP) : '') + '$&?quality=70') : imgRoot + 'food_bg.png';\r\n        //辣度\r\n        food.hotTag1 = imgRoot + 'hottag1.png';\r\n        food.hotTag2 = imgRoot + 'hottag2.png';\r\n        food.hotTag3 = imgRoot + 'hottag3.png';\r\n        \r\n        $editFood = $(editFoodTpl(food));\r\n        //弹出对话框\r\n        modalEditFood = new U.ModalDialog({\r\n            id: 'editFood',\r\n            title: '修改菜品',\r\n            html: $editFood,\r\n            hideCloseBtn: false\r\n        }).show();\r\n        modalEditFood._.footer.find('.btn-ok').text('保存修改');\r\n        modalEditFood._.footer.find('.btn-close').text('返回');\r\n        //初始化表单验证\r\n        bv = $editFood.filter('.form-food').bootstrapValidator({\r\n            fields: {\r\n                minOrderCount: {\r\n                    validators: {\r\n                        notEmpty: {\r\n                            message: '起售份数不能为空'\r\n                        },\r\n                        integer: {\r\n                            message: '起售份数必须是整数'\r\n                        },\r\n                        between: {\r\n                            min: 1,\r\n                            max: 99,\r\n                            message: '起售份数必须在1到99之间'\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n        }).data('bootstrapValidator');\r\n        //初始化ef\r\n        ef = {shopID: shopID, foodID: $this.data('id')};\r\n        for(var i = foodIcos.length; i--;)\r\n        {\r\n            var foodIco = foodIcos[i];\r\n            ef[foodIco] = '0';\r\n            if(food[foodIco] == 1)\r\n            {\r\n                $editFood.find('input[name=foodIco][value=' + foodIco +']').prop('checked', true).trigger('change');\r\n            }\r\n        }\r\n        for(var i = foodParams.length; i--;)\r\n        {\r\n            var param = foodParams[i];\r\n            $editFood.find('input[name=' + param + '][value=' + food[param] +']').prop('checked', true).trigger('change');\r\n        }\r\n        //菜品“可售/停售”\r\n        $editFood.find('input[name=isActive][value=' + food.foodIsActive + ']').prop('checked', true).trigger('change');\r\n    });\r\n    \r\n    $(document).on('click', function(e)\r\n    {\r\n        var $target = $(e.target);\r\n        //修改菜品“保存修改”\r\n        if($target.is('#editFood .btn-ok'))\r\n        {\r\n            if(!bv.validate().isValid()) return;\r\n            \r\n            var $foodIco = $editFood.find('input[name=foodIco]:checked').not('[value=none]');\r\n            if($foodIco[0]) ef[$foodIco.val()] = '1';\r\n            \r\n            for(var i = foodParams.length; i--;)\r\n            {\r\n                var param = foodParams[i];\r\n                ef[param] = $editFood.find('input[name=' + param + ']').filter(':checked').val();\r\n            }\r\n            ef.isActive = $editFood.find('input[name=isActive]:checked').val();\r\n            ef.minOrderCount = $editFood.find('input[name=minOrderCount]').val();\r\n            ef.tasteList = $.trim($editFood.find('input[name=tasteList]').val());\r\n            //调用修改菜品相关服务\r\n            G.updateFood(ef, function (rsp)\r\n            {\r\n                if(rsp.resultcode != '000')\r\n                {\r\n                    rsp.resultmsg && topTip({msg: rsp.resultmsg, type: 'danger'});\r\n                    return;\r\n                }\r\n                \r\n                modalEditFood.hide();\r\n                $.extend(food, ef);\r\n                if(ef.imagePath) food.imgePath = ef.imagePath;\r\n                food.foodIsActive = food.isActive;\r\n                updateFood(food);\r\n                $foods.empty();\r\n                renderFoods(true);\r\n            });\r\n        }\r\n        //点击某个菜品类别渲染对应菜品\r\n        if($target.is('#foodClassBox span'))\r\n        {\r\n            $foodClass.removeClass('current-food-class');\r\n            $target.addClass('current-food-class');\r\n            foodClass = $target.data('id');\r\n            $takeawayTag.val('');\r\n            $foodName.val('');\r\n            $chekbox.prop('checked', false);\r\n            searchParams = null;\r\n            current = 0;\r\n            renderFoods();\r\n        }\r\n        //搜索过滤菜品\r\n        /*if($target.is('#btnSearchFood'))\r\n        {\r\n            searchFood();\r\n        }*/\r\n        \r\n    });\r\n    \r\n    /*$foodName.on('keydown', function(e)\r\n    {\r\n        e.keyCode == 13 && searchFood();\r\n    });*/\r\n    //过滤筛选菜品UI\r\n    function searchFood()\r\n    {\r\n        var $checked = $chekbox.filter(':checked'),\r\n            takeawayTag = $.trim($takeawayTag.val()),\r\n            foodID = $.trim($foodName.val());\r\n        if(takeawayTag || foodID || $checked.length)\r\n        {\r\n            searchParams = {};\r\n            if(takeawayTag) searchParams.takeawayTag = takeawayTag;\r\n            if(foodID) searchParams.foodID = foodID;\r\n            $checked.each(function ()\r\n            {\r\n                if(this.id == 'isHasImage')\r\n                    searchParams.isHasImage = '0';\r\n                else\r\n                    searchParams[this.id] = '1';\r\n            });\r\n        }\r\n        else\r\n        {\r\n            searchParams = null;\r\n        }\r\n        current = 0;\r\n        renderFoods();\r\n    }\r\n    \r\n    //渲染菜品\r\n    function renderFoods(start)\r\n    {\r\n        foods = filterFoods();\r\n        $foodCount.text(foods.length);\r\n        if(current == 0) $foods.empty();\r\n        $foods.append(foodTpl({foods: foods.slice(start ? 0 : current, current + size)}));\r\n        current += size;\r\n        $foods.find('img').lazyload();\r\n    }\r\n    //在某个菜品分类下根据foodID查找某个菜品\r\n    function findFood(cid, id)\r\n    {\r\n        var cfs = classifiedFoods[cid].foods; \r\n        for(var i = cfs.length; i--;)\r\n        {\r\n            if(cfs[i].foodID == id) return cfs[i];\r\n        }\r\n        return null;\r\n    }\r\n    //根据各种条件过滤菜品\r\n    function filterFoods()\r\n    {\r\n        var result = [];\r\n        if(!foodClass)\r\n        {\r\n            for(var foodCategoryID in classifiedFoods)\r\n            {\r\n                result.push.apply(result, classifiedFoods[foodCategoryID].foods);\r\n            }\r\n        }\r\n        else\r\n        {\r\n            result = classifiedFoods[foodClass].foods;\r\n        }\r\n        \r\n        for(p in searchParams)\r\n        {\r\n            result = $.grep(result, function (food)\r\n            {\r\n                return food[p] == searchParams[p];\r\n            });\r\n        }\r\n        \r\n        return result;\r\n    }\r\n    //将菜品分类\r\n    function classifyFoods(foodsData)\r\n    {\r\n        var result = {};\r\n        for(i = 0, l = foodsData.length; i < l; i++)\r\n        {\r\n            var food = foodsData[i], cid = food.foodCategoryID;\r\n            //根据foodCategoryID分类\r\n            result[cid] = result[cid] || {foods: [], foodCategoryName: food.foodCategoryName};\r\n            //某个菜品可能无foodID\r\n            if(!food.foodID) continue;\r\n            \r\n            updateFood(food);\r\n            \r\n            food.takeoutPackagingFee = food.takeoutPackagingFee > 0 ? parseFloat(food.takeoutPackagingFee) : '';\r\n            \r\n            if(food.prePrice == -1 || food.prePrice == food.price)\r\n            {\r\n                food.prePrice = food.price;\r\n                food.price = '';\r\n            }\r\n            if(food.vipPrice == -1 || food.vipPrice >= food.prePrice)\r\n            {\r\n                food.vipPrice = '';\r\n            }\r\n            food.price = food.price || '';\r\n            food.prePrice = food.prePrice || '';\r\n            food.vipPrice = food.vipPrice || '';\r\n            \r\n            var cfs = result[cid].foods,\r\n                unit = {\r\n                    unit: food.unit ? food.unit + ':' : '',\r\n                    price: food.price ? '￥' + parseFloat(food.price) : '',\r\n                    prePrice: food.prePrice ? '￥' + parseFloat(food.prePrice) : '',\r\n                    vipPrice: food.vipPrice ? '￥' + parseFloat(food.vipPrice) : ''\r\n                },\r\n                idx = inAarry(cfs, food, 'foodID');\r\n            //if(unit.prePrice == '￥NaN') console.log(food);\r\n            if(idx == -1)\r\n            {\r\n                food.units = [unit];\r\n                cfs.push(food);\r\n            }\r\n            else\r\n            {//将相同foodID的菜品按照规格合并\r\n                cfs[idx].units.push(unit);\r\n            }\r\n            \r\n        }\r\n        return result;\r\n    }\r\n    //更新某个菜品在表格中显示的相关属性\r\n    function updateFood(food)\r\n    {\r\n        var path = food.imgePath;\r\n        if(path)\r\n        {\r\n            var hwp = food.imageHWP, min = 92,\r\n                w = hwp > 1 ? min : Math.round(min / hwp),\r\n                h = hwp > 1 ? Math.round(min * hwp) : min;\r\n            food.imgSrc = imgHost + path.replace(/\\.\\w+$/, (hwp ? '=' + w + 'x' + h : '') + '$&?quality=70');\r\n        }\r\n        else\r\n            food.imgSrc = imgRoot + 'dino80.png';\r\n        \r\n        food.discountIco = food.isDiscount == 1 ? 'glyphicon-ok' : 'glyphicon-minus';\r\n        food.takeawayIco = food.takeawayTag > 0 ? 'glyphicon-ok' : 'glyphicon-minus';\r\n        food.activeIco = food.foodIsActive == 1 ? 'glyphicon-ok' : 'glyphicon-minus';\r\n    }\r\n    \r\n    //根据对象的一个属性检查某个对象是否在一个对象数组中\r\n    function inAarry(arr, obj, key)\r\n    {\r\n        for(var i = 0, l = arr.length; i < l; i++)\r\n        {\r\n            if(arr[i][key] == obj[key]) return i;\r\n        }\r\n        return -1;\r\n    }\r\n    \r\n}\r\n//将频繁执行的代码延迟执行以提高性能\r\nfunction throttle(method, context)\r\n{\r\n    clearTimeout(method.tId);\r\n    method.tId = setTimeout(function()\r\n    {\r\n        method.call(context);\r\n    }, 100);\r\n}\r\n\r\n})(jQuery, window);\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n;(function ($, window) {\r\n\t\r\n})(jQuery, window);;(function ($, window) {\r\n\tIX.ns(\"Hualala.Shop\");\r\n    /**\r\n\t  * 渲染店铺详情页头部\r\n\t  * @param {Object | String} shopInfo 店铺ID或者店铺详情信息对象\r\n\t  * @param {jQuery Object} container  容器\r\n      * @param {function} callback  回调函数，参数是店铺详情头部的jQuery对象\r\n\t  * @return {NULL} \r\n\t  */\r\n    Hualala.Shop.createShopInfoHead = function(shopInfo, container, callback)\r\n    {\r\n        var $container = container || $('#ix_wrapper > .ix-body > .container'),\r\n            $shopInfoHead = $('<div class=\"bs-callout shop-info-head\"></div>');\r\n        !callback && $shopInfoHead.appendTo($container);\r\n        \r\n        var fn = function (shopInfo)\r\n        {\r\n            var tplData = {\r\n                    shopName: shopInfo.shopName,\r\n                    shopUrl: Hualala.Common.getShopUrl(shopInfo.shopID),\r\n                    shopListLink: Hualala.PageRoute.createPath('shop'),\r\n                    checked: shopInfo.status == 1 ? 'checked' : ''\r\n                };\r\n            \r\n            var tpl = Handlebars.compile(Hualala.TplLib.get('tpl_shop_info_head'));\r\n            \r\n            $shopInfoHead.append($(tpl(tplData))).find('input').bootstrapSwitch({\r\n                onColor : 'success',\r\n                onText : '已开通',\r\n                offText : '未开通'\r\n            }).on('switchChange.bootstrapSwitch', function (e, state)\r\n            {//店铺状态切换\r\n                var $chkbox = $(this);\r\n                Hualala.Global.switchShopStatus({shopID: shopInfo.shopID, status: state}, function (rsp)\r\n                {\r\n                    if(rsp.resultcode != '000')\r\n                    {\r\n                        $chkbox.bootstrapSwitch('toggleState', true);\r\n                        rsp.resultmsg && Hualala.UI.TopTip({msg: rsp.resultmsg, type: 'danger'});\r\n                        return;\r\n                    }\r\n                });\r\n\t\t\t});;\r\n            //重置客户端密码\r\n            $shopInfoHead.find('#resetPwd').on('click', function ()\r\n            {\r\n                var resetPwdTpl = Handlebars.compile(Hualala.TplLib.get('tpl_set_shop_client_pwd'));\r\n                var $resetPwdForm = $(resetPwdTpl(shopInfo));\r\n                //弹出重置客户端密码模态框\r\n                var modal = new Hualala.UI.ModalDialog({\r\n                    id: 'resetCltPwdDlg',\r\n                    title: '重置客户端密码',\r\n                    html: $resetPwdForm,\r\n                    sizeCls: 'modal-sm',\r\n                    hideCloseBtn: false\r\n                }).show();\r\n                var $feedback = $resetPwdForm.find('.has-feedback'),\r\n                    $feedbackIcon = $feedback.find('.form-control-feedback'),\r\n                    $errMsg = $feedback.find('small');\r\n                var $pwd = $resetPwdForm.find('#shopClinetPwd').data('validate', false).on('blur', function ()\r\n                {//验证密码输入\r\n                    var $this = $(this),\r\n                        l = $.trim($this.val()).length;\r\n                    $this.data('validate', false);\r\n                    if(!l)\r\n                        $errMsg.text('密码不能为空');\r\n                    else if(l < 6 || l > 16)\r\n                        $errMsg.text('密码长度必须在6到16个字符之间');\r\n                    else\r\n                    {\r\n                        $errMsg.text('');\r\n                        $this.data('validate', true);\r\n                    }\r\n                        \r\n                    var isValid = $this.data('validate');\r\n                    $feedback.toggleClass('has-success', isValid).toggleClass('has-error', !isValid);\r\n                    $feedbackIcon.toggleClass('glyphicon-ok', isValid).toggleClass('glyphicon-remove', !isValid);\r\n                });\r\n                //密码/明文切换\r\n                $resetPwdForm.find('#showPwd').change(function()\r\n                {\r\n                    $pwd.attr('type', this.checked ? 'text' : 'password');\r\n                });\r\n                //提交密码重设请求\r\n                modal._.footer.find('.btn-ok').on('click', function ()\r\n                {\r\n                    if(!$pwd.trigger('blur').data('validate')) return;\r\n                    \r\n                    Hualala.Global.setShopClientPwd({shopID: shopInfo.shopID, hLLAgentLoginPWD: $pwd.val()}, function (rsp)\r\n                    {\r\n                        if(rsp.resultcode != '000')\r\n                        {\r\n                            rsp.resultmsg && Hualala.UI.TopTip({msg: rsp.resultmsg, type: 'danger'});\r\n                            return;\r\n                        }\r\n                        modal.hide();\r\n                        Hualala.UI.TopTip({msg: '重置客户端密码成功！', type: 'success'});\r\n                    });\r\n                    \r\n                });\r\n                \r\n            });\r\n            //执行回调函数\r\n            callback && callback($shopInfoHead);\r\n        };\r\n        //如果是参数shopInfo是店铺详情对象\r\n        if($.isPlainObject(shopInfo))\r\n        {\r\n            fn(shopInfo);\r\n            return;\r\n        }\r\n        //如果参数shopInfo是shopID，发送ajax获取店铺详情信息\r\n        Hualala.Global.getShopInfo({shopID: shopInfo}, function (rsp)\r\n        {\r\n            if(rsp.resultcode != '000')\r\n            {\r\n                rsp.resultmsg && Hualala.UI.TopTip({msg: rsp.resultmsg, type: 'danger'});\r\n                return;\r\n            }\r\n            var shopInfo = rsp.data.records[0];\r\n            fn(shopInfo);\r\n        });\r\n        \r\n    };\r\n    \r\n    // 店铺详情页功能导航\r\n    Hualala.Shop.createShopFuncNav = function (currentPageName, shopID, container)\r\n    {\r\n        var shopFuncs = ['shopInfo', 'shopMenu'],\r\n            R = Hualala.PageRoute,\r\n            $ul = $('<ul class=\"nav navbar-nav\"></ul>'),\r\n            $container = container || $('#ix_wrapper > .ix-body > .container');\r\n        \r\n        for(i = 0, l = shopFuncs.length; i < l; i++)\r\n        {\r\n            var shopFunc = shopFuncs[i],\r\n                isActive = shopFunc == currentPageName,\r\n                path = isActive ? 'javascript:;' : R.createPath(shopFunc, [shopID]),\r\n                label = R.getPageLabelByName(shopFunc);\r\n            \r\n            $('<li></li>').toggleClass('active', isActive).append($('<a></a>').attr('href', path).text(label)).appendTo($ul);\r\n        }\r\n        \r\n        return $('<div class=\"navbar navbar-default shop-func-nav\"></div>').append($ul).appendTo($container);\r\n    };\r\n    \r\n\tvar initShopList = function (pageType, params) {\r\n        var $body = $('#ix_wrapper > .ix-body > .container');\r\n\t\tvar queryPanel = new Hualala.Shop.QueryController({\r\n\t\t\tneedShopCreate : true,\r\n\t\t\tcontainer : $body,\r\n\t\t\tresultController : new Hualala.Shop.ShopListController({\r\n\t\t\t\tcontainer : $body,\r\n\t\t\t\tmodel : new Hualala.Shop.CardListModel({callServer : Hualala.Global.queryShop}),\r\n\t\t\t\tview : new Hualala.Shop.CardListView()\r\n\t\t\t})\r\n\t\t});\r\n\t\t// TODO 店铺管理首页，店铺查询及列表展示页面\r\n\t};\r\n\tHualala.Shop.HomePageInit = initShopList;\r\n\r\n\tvar initShopBaseInfoMgr = function (pageType, params) {\r\n        var $body = $('#ix_wrapper > .ix-body > .container');\r\n        Hualala.UI.BreadCrumb({\r\n            container: $body,\r\n            hideRoot: true,\r\n            nodes: Hualala.PageRoute.getParentNamesByPath()\r\n        });\r\n\t\tHualala.Shop.initInfo($body, pageType, params);\r\n\t};\r\n\tHualala.Shop.BaseInfoMgrInit = initShopBaseInfoMgr;\r\n\r\n\tvar initFoodMenuMgr = function (pageType, params) {\r\n\t\tvar $body = $('#ix_wrapper > .ix-body > .container');\r\n\t\tHualala.UI.BreadCrumb({\r\n            container: $body,\r\n            hideRoot: true,\r\n            nodes: Hualala.PageRoute.getParentNamesByPath()\r\n        });\r\n        Hualala.Shop.createShopInfoHead(params, $body);\r\n        Hualala.Shop.createShopFuncNav(pageType, params, $body);\r\n        Hualala.Shop.initMenu($body, pageType, params);\r\n\t};\r\n\tHualala.Shop.FoodMenuMgrInit = initFoodMenuMgr;\r\n\r\n\tvar initCreateShop = function (pageType, params) {\r\n\t\tvar $body = $('#ix_wrapper > .ix-body > .container');\r\n        Hualala.UI.BreadCrumb({\r\n            container: $body,\r\n            hideRoot: true,\r\n            nodes: Hualala.PageRoute.getParentNamesByPath()\r\n        });\r\n        var tpl = Handlebars.compile(Hualala.TplLib.get('tpl_shop_create')),\r\n            $shopCreateWizard = $(tpl({\r\n                pcClientPath: Hualala.PageRoute.createPath('pcclient')\r\n            }));\r\n\t\t$body.append($shopCreateWizard);\r\n        Hualala.Shop.initCreate($shopCreateWizard);\r\n\t\t\r\n\t};\r\n\tHualala.Shop.CreateShopInit = initCreateShop;\r\n\r\n\t\r\n})(jQuery, window);;(function ($, window) {\r\n\tIX.ns(\"Hualala.Setting\");\r\n\tvar popoverMsg = Hualala.UI.PopoverMsgTip;\r\n\tvar toptip = Hualala.UI.TopTip;\r\n\tvar ServiceFormElsCfg = {\r\n\t\tadvanceTime : {\r\n\t\t\ttype : 'combo',\r\n\t\t\tlabel : '用户提前预订时间',\r\n\t\t\tdefaultVal : 0,\r\n\t\t\t// prefix : '$',\r\n\t\t\t// surfix : '元',\r\n\t\t\toptions : Hualala.TypeDef.MinuteIntervalOptions(),\r\n\t\t\tvalidCfg : {\r\n\t\t\t\tvalidators : {\r\n\t\t\t\t\tnotEmpty : {\r\n\t\t\t\t\t\tmessage : \"请输入用户提前预订时间\"\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\tnoticeTime : {\r\n\t\t\ttype : 'combo',\r\n\t\t\tlabel : '订单提前通知时间',\r\n\t\t\tdefaultVal : 0,\r\n\t\t\toptions : Hualala.TypeDef.MinuteIntervalOptions(),\r\n\t\t\tvalidCfg : {\r\n\t\t\t\tvalidators : {\r\n\t\t\t\t\tnotEmpty : {\r\n\t\t\t\t\t\tmessage : \"请输入订单提前通知时间\"\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\tminAmount : {\r\n\t\t\ttype : 'text',\r\n\t\t\tlabel : '最低消费金额',\r\n\t\t\tprefix : '￥',\r\n\t\t\tsurfix : Hualala.Constants.CashUnit,\r\n\t\t\tdefaultVal : 0,\r\n\t\t\tvalidCfg : {\r\n\t\t\t\tvalidators : {\r\n\t\t\t\t\tnotEmpty : {\r\n\t\t\t\t\t\tmessage : \"请输入最低消费金额\"\r\n\t\t\t\t\t},\r\n\t\t\t\t\tnumeric : {\r\n\t\t\t\t\t\tmessage: \"最低消费金额必须为数字\"\r\n\t\t\t\t\t},\r\n\t\t\t\t\tgreaterThan : {\r\n\t\t\t\t\t\tinclusive : true,\r\n\t\t\t\t\t\tvalue : 0,\r\n\t\t\t\t\t\tmessage : \"最低消费金额必须大于或等于0\"\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\tserviceAmount : {\r\n\t\t\ttype : 'text',\r\n\t\t\tlabel : '服务费',\r\n\t\t\tprefix : '￥',\r\n\t\t\tsurfix : Hualala.Constants.CashUnit,\r\n\t\t\tdefaultVal : 0,\r\n\t\t\tvalidCfg : {\r\n\t\t\t\tvalidators : {\r\n\t\t\t\t\tnumeric : {\r\n\t\t\t\t\t\tmessage: \"服务费必须为数字\"\r\n\t\t\t\t\t},\r\n\t\t\t\t\tgreaterThan : {\r\n\t\t\t\t\t\tinclusive : true,\r\n\t\t\t\t\t\tvalue : 0,\r\n\t\t\t\t\t\tmessage : \"服务费必须大于或等于0\"\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\tfreeServiceAmount : {\r\n\t\t\ttype : 'text',\r\n\t\t\tlabel : '免服务费菜品金额',\r\n\t\t\tprefix : '￥',\r\n\t\t\tsurfix : Hualala.Constants.CashUnit,\r\n\t\t\tdefaultVal : 0,\r\n\t\t\tvalidCfg : {\r\n\t\t\t\tvalidators : {\r\n\t\t\t\t\tnumeric : {\r\n\t\t\t\t\t\tmessage: \"免服务费菜品金额必须为数字\"\r\n\t\t\t\t\t},\r\n\t\t\t\t\tgreaterThan : {\r\n\t\t\t\t\t\tinclusive : true,\r\n\t\t\t\t\t\tvalue : 0,\r\n\t\t\t\t\t\tmessage : \"免服务费菜品金额必须大于或等于0\"\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\tholidayFlag : {\r\n\t\t\ttype : 'combo',\r\n\t\t\tlabel : '节假日开放',\r\n\t\t\tdefaultVal : 0,\r\n\t\t\toptions : Hualala.TypeDef.HolidayFlagOptions,\r\n\t\t\tvalidCfg : {\r\n\t\t\t\tvalidators : {\r\n\t\t\t\t\tnotEmpty : {\r\n\t\t\t\t\t\tmessage : \"请选择节假日开放类型\"\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\topenDays : {\r\n\t\t\ttype : 'text',\r\n\t\t\tlabel : '开放服务天数',\r\n\t\t\tsurfix : '天',\r\n\t\t\tdefaultVal : '',\r\n\t\t\tvalidCfg : {\r\n\t\t\t\tvalidators : {\r\n\t\t\t\t\tnotEmpty : {\r\n\t\t\t\t\t\tmessage : \"请输入开放服务天数\"\r\n\t\t\t\t\t},\r\n\t\t\t\t\tdigits : {\r\n\t\t\t\t\t\tmessage: \"开放服务天数必须为数字\"\r\n\t\t\t\t\t},\r\n\t\t\t\t\tgreaterThan : {\r\n\t\t\t\t\t\tinclusive : true,\r\n\t\t\t\t\t\tvalue : 0,\r\n\t\t\t\t\t\tmessage : \"开放服务天数必须大于或等于0\"\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\tservicePeriods : {\r\n\t\t\ttype : 'section',\r\n\t\t\tlabel : '开放时段',\r\n\t\t\tmin : {\r\n\t\t\t\ttype : 'timepicker',\r\n\t\t\t\tsurfix : '<span class=\"glyphicon glyphicon-time\"></span>',\r\n\t\t\t\tdefaultVal : '',\r\n\t\t\t\tvalidCfg : {\r\n\t\t\t\t\tgroup : '.min-input',\r\n\t\t\t\t\tvalidators : {\r\n\t\t\t\t\t\tnotEmpty : {\r\n\t\t\t\t\t\t\tmessage : \"请输入起始时间\"\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tmax : {\r\n\t\t\t\ttype : 'timepicker',\r\n\t\t\t\tsurfix : '<span class=\"glyphicon glyphicon-time\"></span>',\r\n\t\t\t\tdefaultVal : '',\r\n\t\t\t\tvalidCfg : {\r\n\t\t\t\t\tgroup : '.max-input',\r\n\t\t\t\t\tvalidators : {\r\n\t\t\t\t\t\tnotEmpty : {\r\n\t\t\t\t\t\t\tmessage : \"请输入结束时间\"\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\treserveTableTime : {\r\n\t\t\ttype : 'combo',\r\n\t\t\tlabel : '留位时间',\r\n\t\t\tdefaultVal : 0,\r\n\t\t\toptions : Hualala.TypeDef.MinuteIntervalOptions(60),\r\n\t\t\tvalidCfg : {\r\n\t\t\t\tvalidators : {\r\n\t\t\t\t\tnotEmpty : {\r\n\t\t\t\t\t\tmessage : \"请选择留位时间\"\r\n\t\t\t\t\t},\r\n\t\t\t\t\tnumeric : {\r\n\t\t\t\t\t\tmessage: \"留位时间必须为数字\"\r\n\t\t\t\t\t},\r\n\t\t\t\t\tgreaterThan : {\r\n\t\t\t\t\t\tinclusive : true,\r\n\t\t\t\t\t\tvalue : 0,\r\n\t\t\t\t\t\tmessage : \"留位时间必须大于或等于0\"\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\treserveTableDesc : {\r\n\t\t\ttype : 'text',\r\n\t\t\tlabel : '留位特别说明',\r\n\t\t\tdefaultVal : '',\r\n\t\t\tvalidCfg : {\r\n\t\t\t\tvalidators : {\r\n\t\t\t\t\tstringLength : {\r\n\t\t\t\t\t\tmax : 40,\r\n\t\t\t\t\t\tmessage : '留位特别说明不能超过40个字'\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\ttakeawayDeliveryAgent : {\r\n\t\t\ttype : 'text',\r\n\t\t\tlabel : '配送单位',\r\n\t\t\tdefaultVal : '自助配送',\r\n\t\t\tvalidCfg : {}\r\n\t\t},\r\n\t\ttakeawayDeliveryTime : {\r\n\t\t\ttype : 'text',\r\n\t\t\tlabel : '预计送餐所需时间',\r\n\t\t\tsurfix : '分钟',\r\n\t\t\tdefaultVal : '',\r\n\t\t\tvalidCfg : {\r\n\t\t\t\tvalidators : {\r\n\t\t\t\t\tnotEmpty : {\r\n\t\t\t\t\t\tmessage : \"请输入预计送餐所需时间\"\r\n\t\t\t\t\t},\r\n\t\t\t\t\tnumeric : {\r\n\t\t\t\t\t\tmessage: \"预计送餐所需时间必须为数字\"\r\n\t\t\t\t\t},\r\n\t\t\t\t\tgreaterThan : {\r\n\t\t\t\t\t\tinclusive : true,\r\n\t\t\t\t\t\tvalue : 0,\r\n\t\t\t\t\t\tmessage : \"预计送餐所需时间必须大于或等于0\"\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\ttakeawayScope : {\r\n\t\t\ttype : 'text',\r\n\t\t\tlabel : '送餐范围',\r\n\t\t\tsurfix : '公里',\r\n\t\t\tdefaultVal : '',\r\n\t\t\tvalidCfg : {\r\n\t\t\t\tvalidators : {\r\n\t\t\t\t\tnotEmpty : {\r\n\t\t\t\t\t\tmessage : \"请输入送餐范围\"\r\n\t\t\t\t\t},\r\n\t\t\t\t\tnumeric : {\r\n\t\t\t\t\t\tmessage: \"送餐范围必须为数字\"\r\n\t\t\t\t\t},\r\n\t\t\t\t\tgreaterThan : {\r\n\t\t\t\t\t\tinclusive : true,\r\n\t\t\t\t\t\tvalue : 0,\r\n\t\t\t\t\t\tmessage : \"送餐范围必须大于或等于0\"\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\ttakeawayScopeDesc : {\r\n\t\t\ttype : 'text',\r\n\t\t\tlabel : '送餐范围说明',\r\n\t\t\tdefaultVal : '',\r\n\t\t\tvalidCfg : {\r\n\t\t\t\tvalidators : {\r\n\t\t\t\t\tstringLength : {\r\n\t\t\t\t\t\tmax : 200,\r\n\t\t\t\t\t\tmessage : '送餐范围说明不能超过200个字'\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\tsubmitSMSTemplateID : {\r\n\t\t\ttype : 'hidden',\r\n\t\t\tdefaultVal : ''\r\n\t\t},\r\n\t\tcheckSMSTemplateID : {\r\n\t\t\ttype : 'hidden',\r\n\t\t\tdefaultVal : ''\r\n\t\t},\r\n\t\tpayMethod : {\r\n\t\t\ttype : 'combo',\r\n\t\t\tlabel : '可选支付方式',\r\n\t\t\tdefaultVal : 0,\r\n\t\t\toptions : Hualala.TypeDef.PayMethodOptions,\r\n\t\t\tvalidCfg : {\r\n\t\t\t\tvalidators : {\r\n\t\t\t\t\tnotEmpty : {\r\n\t\t\t\t\t\tmessage : \"请选择可选支付方式\"\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\tneedInputTableName : {\r\n\t\t\ttype : 'switcher',\r\n\t\t\tlabel : '下单时输入桌号',\r\n\t\t\tdefaultVal : 1,\r\n\t\t\tonLabel : '需要',\r\n\t\t\toffLabel : '不需要',\r\n\t\t\tvalidCfg : {\r\n\t\t\t\tvalidators : {\r\n\t\t\t\t\t\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\tsupportInvoice : {\r\n\t\t\ttype : 'switcher',\r\n\t\t\tlabel : '提供发票',\r\n\t\t\tdefaultVal : 1,\r\n\t\t\tonLabel : '需要',\r\n\t\t\toffLabel : '不需要',\r\n\t\t\tvalidCfg : {\r\n\t\t\t\tvalidators : {\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t\r\n\t\t},\r\n\t\tsupportCommitToSoftware : {\r\n\t\t\ttype : 'switcher',\r\n\t\t\tlabel : '下单到餐饮软件',\r\n\t\t\tdefaultVal : 1,\r\n\t\t\tonLabel : '支持',\r\n\t\t\toffLabel : '不支持',\r\n\t\t\tvalidCfg : {\r\n\t\t\t\tvalidators : {\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\tpayMethodAtShop : {\r\n\t\t\ttype : 'combo',\r\n\t\t\tlabel : '店内支付方式',\r\n\t\t\tdefaultVal : 0,\r\n\t\t\toptions : Hualala.TypeDef.PayMethodAtShopOptions,\r\n\t\t\tvalidCfg : {\r\n\t\t\t\tvalidators : {\r\n\t\t\t\t\tnotEmpty : {\r\n\t\t\t\t\t\tmessage : \"请选择店内支付方式\"\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\tcheckSpotOrder : {\r\n\t\t\ttype : 'switcher',\r\n\t\t\tlabel : '支持手机结账',\r\n\t\t\tdefaultVal : 0,\r\n\t\t\tonLabel : '支持',\r\n\t\t\toffLabel : '不支持',\r\n\t\t\tvalidCfg : {\r\n\t\t\t\tvalidators : {}\r\n\t\t\t}\r\n\t\t},\r\n\t\tpayBeforeCommit : {\r\n\t\t\ttype : 'switcher',\r\n\t\t\tlabel : '支持餐前结账',\r\n\t\t\tdefaultVal : 1,\r\n\t\t\tonLabel : '支持',\r\n\t\t\toffLabel : '不支持',\r\n\t\t\tvalidCfg : {\r\n\t\t\t\tvalidators : {}\r\n\t\t\t}\r\n\t\t\t\r\n\t\t},\r\n\t\tfetchFoodMode : {\r\n\t\t\ttype : 'combo',\r\n\t\t\tlabel : '取餐模式',\r\n\t\t\tdefaultVal : 0,\r\n\t\t\toptions : Hualala.TypeDef.FetchFoodModeOptions,\r\n\t\t\tvalidCfg : {\r\n\t\t\t\tvalidators : {\r\n\t\t\t\t\tnotEmpty : {\r\n\t\t\t\t\t\tmessage : \"取餐模式不能为空\"\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n\tvar ServiceFormElsHT = new IX.IListManager();\r\n\t_.each(ServiceFormElsCfg, function (el, k) {\r\n\t\tvar type = $XP(el, 'type');\r\n\t\tvar labelClz = 'col-sm-offset-1 col-sm-3 control-label';\r\n\t\tif (type == 'section') {\r\n\t\t\tvar id = minID = k + '_min_' + IX.id(), maxID = k + '_max_' + IX.id(),\r\n\t\t\t\tminName = k + '_min', maxName = k + '_max',\r\n\t\t\t\tmin = IX.inherit($XP(el, 'min', {}), {\r\n\t\t\t\t\tid : minID, name : minName, clz : 'col-sm-3',\r\n\t\t\t\t}), max = IX.inherit($XP(el, 'max', {}), {\r\n\t\t\t\t\tid : maxID, name : maxName, clz : 'col-sm-3',\r\n\t\t\t\t});\r\n\t\t\tServiceFormElsHT.register(k, IX.inherit(el, {\r\n\t\t\t\tid : id,\r\n\t\t\t\tlabelClz : labelClz,\r\n\t\t\t\tmin : min,\r\n\t\t\t\tmax : max\r\n\t\t\t}));\r\n\t\t} else {\r\n\t\t\tServiceFormElsHT.register(k, IX.inherit(el, {\r\n\t\t\t\tid : k + '_' + IX.id(),\r\n\t\t\t\tname : k,\r\n\t\t\t\tlabelClz : labelClz,\r\n\t\t\t\tclz : 'col-sm-5'\r\n\t\t\t}));\r\n\t\t}\r\n\t});\r\n\t\r\n\tvar editServiceView = Stapes.subclass({\r\n\t\t/**\r\n\t\t * 编辑业务详情\r\n\t\t * @param  {Object} cfg {triggerEl, serviceID, serviceName, model}\r\n\t\t *              @param {jQueryObj} triggerEl 触发元素 \r\n\t\t *              @param {String} serviceID 业务ID\r\n\t\t *              @param {String} serviceName 业务名称\r\n\t\t *              @param {Object} model 店铺数据模型\r\n\t\t * @return {NULL}    \r\n\t\t */\r\n\t\tconstructor : function (cfg) {\r\n\t\t\tthis.$trigger = $XP(cfg, 'triggerEl');\r\n\t\t\tthis.serviceID = $XP(cfg, 'serviceID', null);\r\n\t\t\tthis.serviceName = $XP(cfg, 'serviceName', null);\r\n\t\t\tthis.model = $XP(cfg, 'model', null);\r\n\t\t\tthis.serviceList = Hualala.TypeDef.ShopBusiness;\r\n\t\t\tthis.modal = null;\r\n\t\t\tif (!this.serviceID || !this.serviceName || !this.model) {\r\n\t\t\t\tthrow(\"Service View init failed!\");\r\n\t\t\t}\r\n\t\t\tthis.loadTemplates();\r\n\t\t\tthis.serviceInfo = this.getServiceInfo('id', this.serviceID);\r\n\t\t\tthis.callServer = $XP(this.serviceInfo, 'callServer', '');\r\n\t\t\tif (IX.isFn(this.callServer)) {\r\n\t\t\t\tthis.callServer = this.callServer;\r\n\t\t\t} else if (!IX.isString(this.callServer)) {\r\n\t\t\t\tthrow(\"Configuration failed : Invalid Page Initialized for \" + this.callServer);\r\n\t\t\t\treturn false;\r\n\t\t\t} else if (IX.nsExisted(this.callServer)) {\r\n\t\t\t\tthis.callServer = IX.getNS(this.callServer);\r\n\t\t\t}\r\n\t\t\t// var revParamJson = JSON.parse(this.model.get('revParamJson'));\r\n\t\t\tvar revParamJson = this.model.get('revParamJson') || null;\r\n\t\t\trevParamJson = !revParamJson ? {} : JSON.parse(revParamJson);\r\n\t\t\tthis.formParams = $XP(revParamJson, this.serviceID);\r\n\t\t\tthis.initModal();\r\n\t\t\tthis.renderForm();\r\n\t\t\tthis.bindEvent();\r\n\t\t\tthis.emit('show');\r\n\t\t}\r\n\t});\r\n\teditServiceView.proto({\r\n\t\tloadTemplates : function () {\r\n\t\t\tvar layoutTpl = Handlebars.compile(Hualala.TplLib.get('tpl_shop_service_form_layout')),\r\n\t\t\t\tbtnTpl = Handlebars.compile(Hualala.TplLib.get('tpl_shop_modal_btns'));\r\n\t\t\tHandlebars.registerHelper('checkFormElementType', function (conditional, options) {\r\n\t\t\t\treturn (conditional == options.hash.type) ? options.fn(this) : options.inverse(this);\r\n\t\t\t});\r\n\t\t\tHandlebars.registerHelper('isInputGroup', function (prefix, surfix, options) {\r\n\t\t\t\treturn (!prefix && !surfix) ? options.inverse(this) : options.fn(this);\r\n\t\t\t});\r\n\t\t\tthis.set({\r\n\t\t\t\tlayoutTpl : layoutTpl,\r\n\t\t\t\tbtnTpl : btnTpl\r\n\t\t\t});\r\n\t\t},\t\r\n\t\tinitModal : function () {\r\n\t\t\tvar self = this;\r\n\t\t\tself.modal = new Hualala.UI.ModalDialog({\r\n\t\t\t\tid : 'service_edit',\r\n\t\t\t\tclz : 'service-modal',\r\n\t\t\t\ttitle : self.getModalTitle(),\r\n\t\t\t\tafterRemove : function () {\r\n\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t},\r\n\t\tinitSwitcher : function (selector) {\r\n\t\t\tvar self = this;\r\n\t\t\tself.modal._.body.find(selector).each(function () {\r\n\t\t\t\tvar $el = $(this),\r\n\t\t\t\t\tonLabel = $el.attr('data-onLabel'),\r\n\t\t\t\t\toffLabel = $el.attr('data-offLabel');\r\n\t\t\t\t$el.bootstrapSwitch({\r\n\t\t\t\t\tsize : 'normal',\r\n\t\t\t\t\tonColor : 'primary',\r\n\t\t\t\t\toffColor : 'default',\r\n\t\t\t\t\tonText : onLabel,\r\n\t\t\t\t\toffText : offLabel\r\n\t\t\t\t});\r\n\t\t\t});\r\n\t\t},\r\n\t\tinitTimePicker : function (selector) {\r\n\t\t\tvar self = this;\r\n\t\t\tself.modal._.body.find(selector).timepicker({\r\n\t\t\t\tminuteStep : 30,\r\n\t\t\t\tshowSeconds : false,\r\n\t\t\t\tshowMeridian :  false,\r\n\t\t\t\tdisableFocus : true,\r\n\t\t\t\tshowInputs : false\r\n\t\t\t});\r\n\t\t},\r\n\t\tgetServiceInfo : function (key, val) {\r\n\t\t\tvar self = this;\r\n\t\t\tvar operationMode = self.model.get('operationMode');\r\n\t\t\tvar servData = IX.inherit({}, _.find(this.serviceList, function (v) {return v[key] == val}));\r\n\t\t\tif (!IX.isEmpty($XP(servData, 'operationMode'))) {\r\n\t\t\t\tservData = IX.inherit(servData, {\r\n\t\t\t\t\tformKeys : $XP(servData, 'operationMode.' + operationMode)\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t\treturn servData;\r\n\t\t},\r\n\t\tgetModalTitle : function () {\r\n\t\t\treturn $XP(this.serviceInfo, 'label') + '配置';\r\n\t\t},\r\n\t\tbindEvent : function () {\r\n\t\t\tvar self = this;\r\n\t\t\tvar fvOpts = self.initValidFieldOpts();\r\n\t\t\tthis.on({\r\n\t\t\t\tshow : function () {\r\n\t\t\t\t\tthis.modal.show();\r\n\t\t\t\t},\r\n\t\t\t\thide : function () {\r\n\t\t\t\t\tthis.modal.hide();\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\tself.modal._.dialog.find('.btn').on('click', function (e) {\r\n\t\t\t\tvar $btn = $(this),\r\n\t\t\t\t\tact = $btn.attr('name');\r\n\t\t\t\tif (act == 'cancel') {\r\n\t\t\t\t\tself.emit('hide');\r\n\t\t\t\t} else {\r\n\t\t\t\t\tvar bv = self.modal._.body.find('form').data('bootstrapValidator');\r\n\t\t\t\t\t$btn.button('提交中...');\r\n\t\t\t\t\tbv.validate();\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\tself.modal._.body.find('form').bootstrapValidator({\r\n\t\t\t\ttrigger : 'blur',\r\n\t\t\t\tfields : fvOpts\r\n\t\t\t}).on('error.field.bv', function (e, data) {\r\n\t\t\t\tvar $form = $(e.target),\r\n\t\t\t\t\tbv = $form.data('bootstrapValidator');\r\n\t\t\t}).on('success.form.bv', function (e, data) {\r\n\t\t\t\te.preventDefault();\r\n\t\t\t\tvar $form = $(e.target),\r\n\t\t\t\t\tbv = $form.data('bootstrapValidator');\r\n\t\t\t\tvar formParams = self.serializeForm();\r\n\t\t\t\tIX.Debug.info(\"DEBUG: Shop Business Service Edit View Form Params : \");\r\n\t\t\t\tIX.Debug.info(formParams);\r\n\t\t\t\tself.model.emit('setServiceParams', {\r\n\t\t\t\t\tcallServer : self.callServer,\r\n\t\t\t\t\tparams : formParams,\r\n\t\t\t\t\tserviceID : self.serviceID,\r\n\t\t\t\t\tfailFn : function () {\r\n\t\t\t\t\t\tself.modal._.footer.find('.btn[name=submit]').button('reset');\r\n\t\t\t\t\t},\r\n\t\t\t\t\tsuccessFn : function () {\r\n\t\t\t\t\t\tself.modal._.footer.find('.btn[name=submit]').button('reset');\r\n\t\t\t\t\t\tself.emit('hide');\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t});;\r\n\t\t},\r\n\t\tdecodeTimeStr : function (t) {\r\n\t\t\tif (t.length == 0) return '';\r\n\t\t\treturn t.substr(0,2) + ':' + t.substr(2);\r\n\t\t},\r\n\t\tencodeTimeStr : function (min, max) {\r\n\t\t\treturn (min + ',' + max).replace(/\\:/g, '');\r\n\t\t},\r\n\t\t// 获取表单元素渲染数据\r\n\t\tmapServiceFormElsData : function () {\r\n\t\t\tvar self = this,\r\n\t\t\t\tformKeys = $XP(self.serviceInfo, 'formKeys', '').split(','),\r\n\t\t\t\tformEls = _.map(formKeys, function (key) {\r\n\t\t\t\t\tvar elCfg = ServiceFormElsHT.get(key),\r\n\t\t\t\t\t\ttype = $XP(elCfg, 'type');\r\n\t\t\t\t\tif (type == 'section' && key == 'servicePeriods') {\r\n\t\t\t\t\t\tvar v = $XP(self.formParams, key, '').split(',');\r\n\t\t\t\t\t\tv = _.map(v, function (t) {\r\n\t\t\t\t\t\t\treturn self.decodeTimeStr(t);\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t\treturn IX.inherit(elCfg, {\r\n\t\t\t\t\t\t\tmin : IX.inherit($XP(elCfg, 'min'), {\r\n\t\t\t\t\t\t\t\tvalue : v[0] || $XP(elCfg, 'min.defaultVal')\r\n\t\t\t\t\t\t\t}),\r\n\t\t\t\t\t\t\tmax : IX.inherit($XP(elCfg, 'max'), {\r\n\t\t\t\t\t\t\t\tvalue : v[1] || $XP(elCfg, 'max.defaultVal')\r\n\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t} else if (type == 'combo') {\r\n\t\t\t\t\t\tvar v = $XP(self.formParams, key, $XP(elCfg, 'defaultVal')),\r\n\t\t\t\t\t\t\toptions = _.map($XP(elCfg, 'options'), function (op) {\r\n\t\t\t\t\t\t\t\treturn IX.inherit(op, {\r\n\t\t\t\t\t\t\t\t\tselected : $XP(op, 'value') == v ? 'selected' : ''\r\n\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\treturn IX.inherit(elCfg, {\r\n\t\t\t\t\t\t\tvalue : $XP(self.formParams, key, $XP(elCfg, 'defaultVal')),\r\n\t\t\t\t\t\t\toptions : options\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t} else if (type == 'switcher') {\r\n\t\t\t\t\t\treturn IX.inherit(elCfg, {\r\n\t\t\t\t\t\t\tchecked : $XP(self.formParams, key) == $XP(elCfg, 'defaultVal') ? 'checked' : ''\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\treturn IX.inherit(elCfg, {\r\n\t\t\t\t\t\t\tvalue : $XP(self.formParams, key, $XP(elCfg, 'defaultVal'))\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\tIX.Debug.info(\"DEBUG: Shop Business Service Edit View Form Elements : \");\r\n\t\t\tIX.Debug.info(formEls);\r\n\t\t\treturn formEls;\r\n\t\t},\r\n\t\t// 渲染表单\r\n\t\trenderForm : function () {\r\n\t\t\tvar self = this,\r\n\t\t\t\tfvOpts = self.initValidFieldOpts(),\r\n\t\t\t\trenderData = self.mapServiceFormElsData(),\r\n\t\t\t\ttpl = self.get('layoutTpl'),\r\n\t\t\t\tbtnTpl = self.get('btnTpl'),\r\n\t\t\t\thtm = tpl({\r\n\t\t\t\t\tformClz : 'shop-service-form form-feedback-out',\r\n\t\t\t\t\titems : renderData\r\n\t\t\t\t});\r\n\t\t\tself.modal._.body.html(htm);\r\n\t\t\tself.modal._.footer.html(btnTpl({\r\n\t\t\t\tbtns : [\r\n\t\t\t\t\t{clz : 'btn-default', name : 'cancel', label : '取消'},\r\n\t\t\t\t\t{clz : 'btn-warning', name : 'submit', label : '保存'}\r\n\t\t\t\t]\r\n\t\t\t}));\r\n\r\n\t\t\tself.initSwitcher(':checkbox[data-type=switcher]');\r\n\t\t\tself.initTimePicker('[data-type=timepicker]');\r\n\r\n\t\t},\r\n\t\t// 获取表单数据\r\n\t\tserializeForm : function () {\r\n\t\t\tvar self = this,\r\n\t\t\t\tformKeys = $XP(self.serviceInfo, 'formKeys', '').split(','),\r\n\t\t\t\tret = {},\r\n\t\t\t\tformEls = _.map(formKeys, function (key) {\r\n\t\t\t\t\tvar elCfg = ServiceFormElsHT.get(key),\r\n\t\t\t\t\t\ttype = $XP(elCfg, 'type');\r\n\t\t\t\t\tif (type == 'section' && key == 'servicePeriods') {\r\n\t\t\t\t\t\tvar min = $('[name=' + key + '_min]').val(),\r\n\t\t\t\t\t\t\tmax = $('[name=' + key + '_max]').val();\r\n\t\t\t\t\t\tret[key] = self.encodeTimeStr(min, max);\r\n\t\t\t\t\t} else if (type == 'switcher') {\r\n\t\t\t\t\t\t// ret[key] = $('[name=' + key + ']').attr('checked') ? 1 : 0;\r\n\t\t\t\t\t\tret[key] = !$('[name=' + key + ']').data('bootstrapSwitch').options.state ? 0 : 1;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tret[key] = $('[name=' + key + ']').val();\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\treturn ret;\r\n\t\t},\r\n\t\t// 获取表单验证配置\r\n\t\tinitValidFieldOpts : function () {\r\n\t\t\tvar self = this,\r\n\t\t\t\tformKeys = $XP(self.serviceInfo, 'formKeys', '').split(','),\r\n\t\t\t\tret = {};\r\n\t\t\t_.each(formKeys, function (key) {\r\n\t\t\t\tvar elCfg = ServiceFormElsHT.get(key),\r\n\t\t\t\t\ttype = $XP(elCfg, 'type');\r\n\t\t\t\tif (type == 'section') {\r\n\t\t\t\t\tvar min = key + '_min', max = key + '_max';\r\n\t\t\t\t\tret[min] = $XP(elCfg, 'min.validCfg', {});\r\n\t\t\t\t\tret[max] = $XP(elCfg, 'max.validCfg', {});\r\n\t\t\t\t} else {\r\n\t\t\t\t\tret[key] = $XP(elCfg, 'validCfg', {});\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\treturn ret;\r\n\t\t}\r\n\t});\r\n\tHualala.Setting.editServiceView = editServiceView;\r\n})(jQuery, window);;(function ($, window) {\r\n\tIX.ns(\"Hualala.Setting\");\r\n\tvar initShopMgr = function (pageType, params) {\r\n\t\tvar $body = $('#ix_wrapper > .ix-body > .container');\r\n\t\tvar queryPanel = new Hualala.Shop.QueryController({\r\n\t\t\tneedShopCreate : false,\r\n\t\t\tcontainer : $body,\r\n\t\t\tresultController : new Hualala.Shop.ShopListController({\r\n\t\t\t\tcontainer : $body,\r\n\t\t\t\tmodel : new Hualala.Shop.CardListModel({callServer : Hualala.Global.queryShop}),\r\n\t\t\t\tview : new Hualala.Shop.ShopListView()\r\n\t\t\t})\r\n\t\t});\r\n\t};\r\n\tHualala.Setting.ShopMgrInit = initShopMgr;\r\n})(jQuery, window);;(function ($, window) {\r\n\tIX.ns(\"Hualala.Account\");\r\n\tvar popoverMsg = Hualala.UI.PopoverMsgTip;\r\n\tvar toptip = Hualala.UI.TopTip;\r\n\tvar CardListModel = Hualala.Shop.CardListModel;\r\n\tvar AccountListModel = CardListModel.subclass({\r\n\t\tconstructor : CardListModel.prototype.constructor\r\n\t});\r\n\tAccountListModel.proto({\r\n\t\tinit : function (params) {\r\n\t\t\tthis.set({\r\n\t\t\t\tpageCount : 0,\r\n\t\t\t\ttotalSize : 0,\r\n\t\t\t\tpageNo : $XP(params, 'pageNo', 1),\r\n\t\t\t\tpageSize : $XP(params, 'pageSize', 15),\r\n\t\t\t\ttransCreateBeginTime : $XP(params, 'transCreateBeginTime', ''),\r\n\t\t\t\ttransCreateEndTime : $XP(params, 'transCreateEndTime', ''),\r\n\t\t\t\tsettleUnitID : $XP(params, 'settleUnitID', ''),\r\n\t\t\t\ttransStatus : $XP(params, 'transStatus', ''),\r\n\t\t\t\ttransType : $XP(params, 'transType', ''),\r\n\t\t\t\tgroupID : $XP(params, 'groupID', ''),\r\n\t\t\t\tminTransAmount : $XP(params, 'minTransAmount', ''),\r\n\t\t\t\tmaxTransAmount : $XP(params, 'maxTransAmount', ''),\r\n\t\t\t\tds_account : new IX.IListManager(),\r\n\t\t\t\tds_page : new IX.IListManager()\r\n\t\t\t});\r\n\t\t},\r\n\t\tupdatePagerParams : function (params) {\r\n\t\t\tvar self = this;\r\n\t\t\tvar pagerParamkeys = 'pageCount,totalSize,pageNo,pageSize,transCreateBeginTime,transCreateEndTime,settleUnitID,transStatus,transType,groupID,minTransAmount,maxTransAmount';\r\n\t\t\t_.each(params, function (v, k, l) {\r\n\t\t\t\tif (pagerParamkeys.indexOf(k) > -1) {\r\n\t\t\t\t\tself.set(k, v);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t},\r\n\t\tgetPagerParams : function () {\r\n\t\t\t// return {\r\n\t\t\t// \tPage : {\r\n\t\t\t// \t\tpageNo : this.get('pageNo'),\r\n\t\t\t// \t\tpageSize : this.get('pageSize')\r\n\t\t\t// \t},\r\n\t\t\t// \tsettleUnitID : this.get('settleUnitID'),\r\n\t\t\t// \ttransCreateBeginTime : this.get('transCreateBeginTime'),\r\n\t\t\t// \ttransCreateEndTime : this.get('transCreateEndTime'),\r\n\t\t\t// \ttransStatus : this.get('transStatus'),\r\n\t\t\t// \ttransType : this.get('transType'),\r\n\t\t\t// \tgroupID : this.get('groupID'),\r\n\t\t\t// \tminTransAmount : this.get('minTransAmount'),\r\n\t\t\t// \tmaxTransAmount : this.get('maxTransAmount')\r\n\t\t\t// };\r\n\t\t\treturn {\r\n\t\t\t\tpageNo : this.get('pageNo'),\r\n\t\t\t\tpageSize : this.get('pageSize'),\r\n\t\t\t\tsettleUnitID : this.get('settleUnitID'),\r\n\t\t\t\ttransCreateBeginTime : this.get('transCreateBeginTime'),\r\n\t\t\t\ttransCreateEndTime : this.get('transCreateEndTime'),\r\n\t\t\t\ttransStatus : this.get('transStatus'),\r\n\t\t\t\ttransType : this.get('transType'),\r\n\t\t\t\tgroupID : this.get('groupID'),\r\n\t\t\t\tminTransAmount : this.get('minTransAmount'),\r\n\t\t\t\tmaxTransAmount : this.get('maxTransAmount')\r\n\t\t\t};\r\n\t\t},\r\n\t\tupdateDataStore : function (data, pageNo) {\r\n\t\t\tvar self = this,\r\n\t\t\t\taccountHT = self.get('ds_account'),\r\n\t\t\t\tpageHT = self.get('ds_page');\r\n\t\t\tvar accountIDs = _.map(data, function (account, i, l) {\r\n\t\t\t\tvar settleUnitID = $XP(account, 'settleUnitID'),\r\n\t\t\t\t\tmAccount = new BaseAccountModel(account);\r\n\t\t\t\taccountHT.register(settleUnitID, mAccount);\r\n\t\t\t\treturn settleUnitID;\r\n\t\t\t});\r\n\t\t\tpageHT.register(pageNo, accountIDs);\r\n\t\t},\r\n\t\tresetDataStore : function () {\r\n\t\t\tvar self = this,\r\n\t\t\t\taccountHT = self.get('ds_account'),\r\n\t\t\t\tpageHT = self.get('ds_page');\r\n\t\t\taccountHT.clear();\r\n\t\t\tpageHT.clear();\r\n\t\t},\r\n\t\tload : function (params, cbFn) {\r\n\t\t\tvar self = this;\r\n\t\t\tself.updatePagerParams(params);\r\n\t\t\tself.callServer(self.getPagerParams(), function (res) {\r\n\t\t\t\tif (res.resultcode == '000') {\r\n\t\t\t\t\tself.updateDataStore($XP(res, 'data.records', []), $XP(res, 'data.page.pageNo'));\r\n\t\t\t\t\tself.updatePagerParams(IX.inherit($XP(res, 'data', {}), $XP(res, 'data.page', {})));\r\n\t\t\t\t} else {\r\n\t\t\t\t\ttoptip({\r\n\t\t\t\t\t\tmsg : $XP(res, 'resultmsg', ''),\r\n\t\t\t\t\t\ttype : 'danger'\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t\tcbFn(self);\r\n\t\t\t});\r\n\t\t},\r\n\t\tgetAccounts : function (pageNo) {\r\n\t\t\tvar self = this,\r\n\t\t\t\taccountHT = self.get('ds_account'),\r\n\t\t\t\tpageHT = self.get('ds_page');\r\n\t\t\tvar ret = _.map(accountHT.getByKeys(pageHT.get(pageNo)), function (mAccount) {\r\n\t\t\t\treturn mAccount.getAll();\r\n\t\t\t});\r\n\t\t\tIX.Debug.info(\"DEBUG: Account List Model PageData :\");\r\n\t\t\tIX.Debug.info(ret);\r\n\t\t\treturn ret;\r\n\t\t},\r\n\t\tgetAccountModelByID : function (accountID) {\r\n\t\t\tvar self = this,\t\r\n\t\t\t\taccountHT = self.get('ds_account');\r\n\t\t\treturn accountHT.get(accountID);\r\n\t\t}\r\n\t});\r\n\r\n\r\n\tHualala.Account.AccountListModel = AccountListModel;\r\n\r\n\tvar BaseAccountModel = Stapes.subclass({\r\n\t\tconstructor : function (account) {\r\n\t\t\t!IX.isEmpty(account) && this.set(account);\r\n\t\t\tthis.bindEvent();\r\n\t\t}\r\n\t});\r\n\tBaseAccountModel.proto({\r\n\t\tbindEvent : function () {\r\n\t\t\tvar self = this;\r\n\t\t\tself.on({\r\n\t\t\t\t\"load\" : function (params) {\r\n\t\t\t\t\tvar settleUnitID = $XP(params, 'settleUnitID'),\r\n\t\t\t\t\t\tcbFn = $XF(params, 'cbFn');\r\n\t\t\t\t\tvar callServer = Hualala.Global.queryAccount,\r\n\t\t\t\t\t\tgroupID = $XP(Hualala.getSessionSite(), 'groupID', '');\r\n\t\t\t\t\tcallServer({\r\n\t\t\t\t\t\tsettleUnitID : settleUnitID,\r\n\t\t\t\t\t\tgroupID : groupID\r\n\t\t\t\t\t}, function (res) {\r\n\t\t\t\t\t\tvar records = $XP(res, \"data.records\", []);\r\n\t\t\t\t\t\tif (records.length == 0) {\r\n\t\t\t\t\t\t\tthrow(\"get Account Data (\" + settleUnitID + \") Failed!\");\r\n\t\t\t\t\t\t\treturn ;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tself.set(records[0]);\r\n\t\t\t\t\t\tcbFn();\r\n\t\t\t\t\t});\r\n\t\t\t\t},\r\n\t\t\t\t// 提现\r\n\t\t\t\t\"withdrawCash\" : function (cfg) {\r\n\t\t\t\t\tvar callServer = Hualala.Global.withdrawCash,\r\n\t\t\t\t\t\tparams = $XP(cfg, 'params', {}),\r\n\t\t\t\t\t\tsettleUnitID = self.get('settleUnitID'),\r\n\t\t\t\t\t\tfailFn = $XF(cfg, 'failFn'),\r\n\t\t\t\t\t\tsuccessFn = $XF(cfg, 'successFn'),\r\n\t\t\t\t\t\tpoundageAmount = self.get('poundageAmount') || 0,\r\n\t\t\t\t\t\tpoundageMinAmount = self.get('poundageMinAmount') || 0;\r\n\t\t\t\t\tcallServer(IX.inherit(params, {\r\n\t\t\t\t\t\tsettleUnitID : settleUnitID,\r\n\t\t\t\t\t\tpoundageAmount : poundageAmount,\r\n\t\t\t\t\t\tpoundageMinAmount : poundageMinAmount\r\n\t\t\t\t\t}), function (res) {\r\n\t\t\t\t\t\tif (res.resultcode !== '000') {\r\n\t\t\t\t\t\t\ttoptip({\r\n\t\t\t\t\t\t\t\tmsg : $XP(res, 'resultmsg', ''),\r\n\t\t\t\t\t\t\t\ttype : 'danger'\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\tfailFn();\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tvar transAmount = $XP(params, 'transAmount', 0),\r\n\t\t\t\t\t\t\t\tsettleBalance = self.get('settleBalance') || 0,\r\n\t\t\t\t\t\t\t\tnewSettleBalance = Hualala.Common.Math.sub(settleBalance - transAmount);\r\n\t\t\t\t\t\t\tself.set('settleBalance', newSettleBalance);\r\n\t\t\t\t\t\t\t// TODO update View\r\n\t\t\t\t\t\t\tsuccessFn();\r\n\t\t\t\t\t\t\ttoptip({\r\n\t\t\t\t\t\t\t\tmsg : '提现成功!',\r\n\t\t\t\t\t\t\t\ttype : 'success'\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t},\r\n\t\t\t\t// 删除结算账户\r\n\t\t\t\t\"delete\" : function (cfg) {\r\n\t\t\t\t\tvar callServer = Hualala.Global.deleteAccount,\r\n\t\t\t\t\t\tsettleUnitID = self.get('settleUnitID'),\r\n\t\t\t\t\t\tgroupID = $XP(Hualala.getSessionSite(), 'groupID', ''),\r\n\t\t\t\t\t\tfailFn = $XF(cfg, 'failFn'),\r\n\t\t\t\t\t\tsuccessFn = $XF(cfg, 'successFn');\r\n\t\t\t\t\tcallServer({\r\n\t\t\t\t\t\tsettleUnitID : settleUnitID,\r\n\t\t\t\t\t\tgroupID : groupID\r\n\t\t\t\t\t}, function (res) {\r\n\t\t\t\t\t\tif (res.resultcode !== '000') {\r\n\t\t\t\t\t\t\ttoptip({\r\n\t\t\t\t\t\t\t\tmsg : $XP(res, 'resultmsg', ''),\r\n\t\t\t\t\t\t\t\ttype : 'danger'\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\tfailFn(settleUnitID);\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\ttoptip({\r\n\t\t\t\t\t\t\t\tmsg : '删除成功!',\r\n\t\t\t\t\t\t\t\ttype : 'success'\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t// TODO update View\r\n\t\t\t\t\t\t\tsuccessFn(settleUnitID);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t},\r\n\t\t\t\t// 编辑结算账户\r\n\t\t\t\t\"edit\" : function (cfg) {\r\n\t\t\t\t\tvar callServer = Hualala.Global.editAccount,\r\n\t\t\t\t\t\tsettleUnitID = self.get('settleUnitID'),\r\n\t\t\t\t\t\tgroupID = $XP(Hualala.getSessionSite(), 'groupID', ''),\r\n\t\t\t\t\t\tfailFn = $XF(cfg, 'failFn'),\r\n\t\t\t\t\t\tsuccessFn = $XF(cfg, 'successFn');\r\n\t\t\t\t\tcallServer(IX.inherit($XP(cfg, 'params', {}), {\r\n\t\t\t\t\t\tgroupID : groupID,\r\n\t\t\t\t\t\tsettleUnitID : settleUnitID\r\n\t\t\t\t\t}), function (res) {\r\n\t\t\t\t\t\tif (res.resultcode !== '000') {\r\n\t\t\t\t\t\t\ttoptip({\r\n\t\t\t\t\t\t\t\tmsg : $XP(res, 'resultmsg', ''),\r\n\t\t\t\t\t\t\t\ttype : 'danger'\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\tfailFn(settleUnitID);\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\ttoptip({\r\n\t\t\t\t\t\t\t\tmsg : '修改成功!',\r\n\t\t\t\t\t\t\t\ttype : 'success'\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t// TODO update View\r\n\t\t\t\t\t\t\tself.set($XP(cfg, 'params', {}));\r\n\t\t\t\t\t\t\tsuccessFn(settleUnitID);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t},\r\n\t\t\t\t// 添加结算账户\r\n\t\t\t\t\"add\" : function (cfg) {\r\n\t\t\t\t\tvar callServer = Hualala.Global.addAccount,\r\n\t\t\t\t\t\tgroupID = $XP(Hualala.getSessionSite(), 'groupID', ''),\r\n\t\t\t\t\t\tfailFn = $XF(cfg, 'failFn'),\r\n\t\t\t\t\t\tsuccessFn = $XF(cfg, 'successFn');\r\n\t\t\t\t\tcallServer(IX.inherit($XP(cfg, 'params', {}), {\r\n\t\t\t\t\t\tgroupID : groupID\r\n\t\t\t\t\t}), function (res) {\r\n\t\t\t\t\t\tif (res.resultcode !== '000') {\r\n\t\t\t\t\t\t\ttoptip({\r\n\t\t\t\t\t\t\t\tmsg : $XP(res, 'resultmsg', ''),\r\n\t\t\t\t\t\t\t\ttype : 'danger'\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\tfailFn();\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\ttoptip({\r\n\t\t\t\t\t\t\t\tmsg : '添加成功!',\r\n\t\t\t\t\t\t\t\ttype : 'success'\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t// TODO update View\r\n\t\t\t\t\t\t\tself.set($XP(cfg, 'params', {}));\r\n\t\t\t\t\t\t\tsuccessFn();\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\t});\r\n\r\n\tHualala.Account.BaseAccountModel = BaseAccountModel;\r\n\r\n\tvar AccountTransListModel = AccountListModel.subclass({\r\n\t\tconstructor : function () {\r\n\t\t\tthis.callServer = Hualala.Global.queryAccountTransDetail;\r\n\t\t}\r\n\t});\r\n\tAccountTransListModel.proto({\r\n\t\tinit : function (params) {\r\n\t\t\tthis.set({\r\n\t\t\t\tpageCount : 0,\r\n\t\t\t\ttotalSize : 0,\r\n\t\t\t\tpageNo : $XP(params, 'pageNo', 1),\r\n\t\t\t\tpageSize : $XP(params, 'pageSize', 15),\r\n\t\t\t\ttransCreateBeginTime : $XP(params, 'transCreateBeginTime', ''),\r\n\t\t\t\ttransCreateEndTime : $XP(params, 'transCreateEndTime', ''),\r\n\t\t\t\tsettleUnitID : $XP(params, 'settleUnitID', ''),\r\n\t\t\t\ttransStatus : $XP(params, 'transStatus', ''),\r\n\t\t\t\ttransType : $XP(params, 'transType', ''),\r\n\t\t\t\tgroupID : $XP(params, 'groupID', ''),\r\n\t\t\t\tminTransAmount : $XP(params, 'minTransAmount', ''),\r\n\t\t\t\tmaxTransAmount : $XP(params, 'maxTransAmount', ''),\r\n\t\t\t\tds_trans : new IX.IListManager(),\r\n\t\t\t\tds_page : new IX.IListManager()\r\n\t\t\t});\r\n\t\t},\r\n\t\tupdateDataStore : function (data, pageNo) {\r\n\t\t\tvar self = this,\r\n\t\t\t\ttransHT = self.get('ds_trans'),\r\n\t\t\t\tpageHT = self.get('ds_page');\r\n\t\t\tvar transIDs = _.map(data, function (trans, i, l) {\r\n\t\t\t\tvar transID = $XP(trans, 'SUATransItemID'),\r\n\t\t\t\t\tmTrans = new BaseTransactionModel(trans);\r\n\t\t\t\ttransHT.register(transID, mTrans);\r\n\t\t\t\treturn transID;\r\n\t\t\t});\r\n\t\t\tpageHT.register(pageNo, transIDs);\r\n\t\t},\r\n\t\tresetDataStore : function () {\r\n\t\t\tvar self = this,\r\n\t\t\t\ttransHT = self.get('ds_trans'),\r\n\t\t\t\tpageHT = self.get('ds_page');\r\n\t\t\ttransHT.clear();\r\n\t\t\tpageHT.clear();\r\n\t\t},\r\n\t\tload : function (params, cbFn) {\r\n\t\t\tvar self = this;\r\n\t\t\tself.updatePagerParams(params);\r\n\t\t\tself.callServer(self.getPagerParams(), function (res) {\r\n\t\t\t\tif (res.resultcode == '000') {\r\n\t\t\t\t\tself.updateDataStore($XP(res, 'data.records', []), $XP(res, 'data.page.pageNo'));\r\n\t\t\t\t\tself.updatePagerParams(IX.inherit($XP(res, 'data', {}), $XP(res, 'data.page', {})));\r\n\t\t\t\t} else {\r\n\t\t\t\t\ttoptip({\r\n\t\t\t\t\t\tmsg : $XP(res, 'resultmsg', ''),\r\n\t\t\t\t\t\ttype : 'danger'\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t\tcbFn(self);\r\n\t\t\t});\r\n\t\t},\r\n\t\tgetDataByPageNo : function (pageNo) {\r\n\t\t\tvar self = this,\r\n\t\t\t\ttransHT = self.get('ds_trans'),\r\n\t\t\t\tpageHT = self.get('ds_page');\r\n\t\t\tvar ret = _.map(transHT.getByKeys(pageHT.get(pageNo)), function (mTrans) {\r\n\t\t\t\treturn mTrans.getAll();\r\n\t\t\t});\r\n\t\t\tIX.Debug.info(\"DEBUG: Account TransList Model PageData :\");\r\n\t\t\tIX.Debug.info(ret);\r\n\t\t\treturn ret;\r\n\t\t},\r\n\t\tgetModelByID : function (transID) {\r\n\t\t\tvar self = this,\t\r\n\t\t\t\ttransHT = self.get('ds_trans');\r\n\t\t\treturn transHT.get(transID);\r\n\t\t}\r\n\t});\r\n\r\n\tHualala.Account.AccountTransListModel = AccountTransListModel;\r\n\r\n\tvar BaseTransactionModel = BaseAccountModel.subclass({\r\n\t\tconstructor : BaseAccountModel.prototype.constructor\r\n\t});\r\n\tBaseTransactionModel.proto({\r\n\t\tbindEvent : function () {\r\n\t\t\tvar self = this;\r\n\t\t\t\r\n\t\t}\r\n\t});\r\n\r\n\tHualala.Account.BaseTransactionModel = BaseTransactionModel;\r\n\r\n\tvar AccountQueryShopModel = Hualala.Shop.QueryModel.subclass({\r\n\t\tconstructor : function () {\r\n\t\t\t// 原始数据\r\n\t\t\tthis.origCities = [];\r\n\t\t\tthis.origAreas = [];\r\n\t\t\tthis.origShops = [];\r\n\t\t\t// 数据是否已经加载完毕\r\n\t\t\tthis.isReady = false;\r\n\t\t\t// this.callServer = Hualala.Global.getShopQuerySchema;\r\n\t\t\tthis.callServer = Hualala.Global.getAccountQueryShop;\r\n\t\t}\r\n\t});\r\n\r\n\tHualala.Account.AccountQueryShopModel = AccountQueryShopModel;\r\n\r\n\tvar AccountQueryShopResultModel = Hualala.Shop.CardListModel.subclass({\r\n\t\tconstructor : function () {\r\n\t\t\tthis.origData = null;\r\n\t\t\t\r\n\t\t\tthis.dataStore = new IX.IListManager();\r\n\t\t}\r\n\t});\r\n\tAccountQueryShopResultModel.proto({\r\n\t\tinitDataStore : function (data) {\r\n\t\t\tvar self = this;\r\n\t\t\tself.origData = data;\r\n\t\t\t_.each(self.origData, function (shop) {\r\n\t\t\t\tself.dataStore.register($XP(shop, 'shipID'), shop);\r\n\t\t\t});\r\n\t\t},\r\n\t\tload : function (params, cbFn) {\r\n\t\t\tvar self = this;\r\n\t\t\tself.updatePagerParams(params);\r\n\t\t\tvar pageNo = self.get('pageNo'),\r\n\t\t\t\tpageSize = self.get('pageSize'),\r\n\t\t\t\tcityID = self.get('cityID'),\r\n\t\t\t\tareaID = self.get('areaID'),\r\n\t\t\t\tkeywordLst = self.get('keywordLst'),\r\n\t\t\t\ttotalSize = 0,\r\n\t\t\t\tstart = (pageNo - 1) * pageSize,\r\n\t\t\t\tend = pageSize * pageNo,\r\n\t\t\t\tpageCount = 0;\r\n\t\t\tvar shops = [];\r\n\t\t\tshops = areaID.length > 0 ? _.filter(self.origData, function (_shop) {\r\n\t\t\t\treturn $XP(_shop, 'areaID') == areaID;\r\n\t\t\t}) : self.origData;\r\n\t\t\tshops = cityID.length > 0 ? _.filter(shops, function (_shop) {\r\n\t\t\t\treturn $XP(_shop, 'cityID') == cityID;\r\n\t\t\t}) : shops;\r\n\t\t\tshops = keywordLst.length > 0 ? _.filter(shops, function (_shop) {\r\n\t\t\t\treturn $XP(_shop, 'shopName') == keywordLst;\r\n\t\t\t}) : shops;\r\n\t\t\ttotalSize = shops.length;\r\n\t\t\tpageCount = Math.ceil(totalSize / pageSize);\r\n\t\t\tshops = _.filter(shops, function (_shop, idx) {\r\n\t\t\t\treturn idx >= start && idx < end;\r\n\t\t\t});\r\n\t\t\tself.updateDataStore(shops, pageNo);\r\n\t\t\tself.updatePagerParams({\r\n\t\t\t\tpageCount : pageCount,\r\n\t\t\t\ttotalSize : totalSize,\r\n\t\t\t\tpageNo : pageNo,\r\n\t\t\t\tpageSize : pageSize\r\n\t\t\t});\r\n\t\t\tcbFn(self);\r\n\t\t}\r\n\t});\r\n\r\n\tHualala.Account.AccountQueryShopResultModel = AccountQueryShopResultModel;\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n})(jQuery, window);;(function ($, window) {\r\n\tIX.ns(\"Hualala.Account\");\r\n\tvar popoverMsg = Hualala.UI.PopoverMsgTip;\r\n\tvar toptip = Hualala.UI.TopTip;\r\n\tvar CardListView = Hualala.Shop.CardListView;\r\n\tvar AccountListView = CardListView.subclass({\r\n\t\tconstructor : CardListView.prototype.constructor\r\n\t});\r\n\tAccountListView.proto({\r\n\t\t// 重载loadTemplates\r\n\t\t// 加载View层所需要的模板\r\n\t\tloadTemplates : function () {\r\n\t\t\tvar layoutTpl = Handlebars.compile(Hualala.TplLib.get('tpl_account_list_layout')),\r\n\t\t\t\tlistTpl = Handlebars.compile(Hualala.TplLib.get('tpl_account_list')),\r\n\t\t\t\titemTpl = Handlebars.compile(Hualala.TplLib.get('tpl_account_card')),\r\n\t\t\t\taddAccountTpl = Handlebars.compile(Hualala.TplLib.get('tpl_addAccount_Card'));\r\n\t\t\t// 注册accountCard子模板\r\n\t\t\tHandlebars.registerPartial(\"accountCard\", Hualala.TplLib.get('tpl_account_card'));\r\n\t\t\tHandlebars.registerPartial(\"addAccountCard\", Hualala.TplLib.get('tpl_addAccount_Card'));\r\n\r\n\t\t\tthis.set({\r\n\t\t\t\tlayoutTpl : layoutTpl,\r\n\t\t\t\tlistTpl : listTpl,\r\n\t\t\t\titemTpl : itemTpl\r\n\t\t\t});\r\n\t\t},\r\n\t\t// 重载initLayout\r\n\t\tinitLayout : function () {\r\n\t\t\tvar layoutTpl = this.get('layoutTpl');\r\n\t\t\tvar htm = layoutTpl();\r\n\t\t\tthis.$container.append(htm);\r\n\t\t\tthis.$resultBox = this.$container.find('.account-list');\r\n\t\t\tthis.$list = this.$container.find('.account-list-body');\r\n\t\t\tthis.$pager = this.$container.find('.page-selection');\r\n\t\t\tthis.initPager();\r\n\t\t\tthis.bindEvent();\r\n\t\t\tthis.bindCardEvent();\r\n\t\t},\r\n\t\tbindCardEvent : function () {\r\n\t\t\tvar self = this;\r\n\t\t\tself.$list.on('click', '.btn.withdraw', function (e) {\r\n\t\t\t\tvar $btn = $(this);\r\n\t\t\t\tvar settleAccountID = $btn.parents('.bank-card').attr('data-id');\r\n\t\t\t\tif ($btn.hasClass('disabled')) return;\r\n\t\t\t\t// 提现操作\r\n\t\t\t\tvar modal = new WithdrawCashView({\r\n\t\t\t\t\ttriggerEl : $btn,\r\n\t\t\t\t\tsettleUnitID : settleAccountID,\r\n\t\t\t\t\tmodel : self.model.getAccountModelByID(settleAccountID),\r\n\t\t\t\t\tparentView : self\r\n\t\t\t\t});\r\n\t\t\t});\r\n\t\t\tself.$list.on('click', '.create-account', function (e) {\r\n\t\t\t\tvar $btn = $(this);\r\n\t\t\t\t// TODO 创建账户\r\n\t\t\t\tvar editAccount = new Hualala.Account.AccountEditView({\r\n\t\t\t\t\ttriggerEl : $btn,\r\n\t\t\t\t\tmode : 'add',\r\n\t\t\t\t\tmodel : null,\r\n\t\t\t\t\tparentView : self\r\n\t\t\t\t});\r\n\t\t\t});\r\n\t\t\tself.on({\r\n\t\t\t\t'updateSettleBalance' : function (mAccount) {\r\n\t\t\t\t\tvar settleUnitID = mAccount.get('settleUnitID'),\r\n\t\t\t\t\t\tsettleBalance = mAccount.get('settleBalance');\r\n\t\t\t\t\tself.$container.find('[data-id=' + settleUnitID + '] .cash > strong').html(settleBalance);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t},\r\n\t\t// 重载格式化渲染数据\r\n\t\tmapRenderData : function (data) {\r\n\t\t\tvar self = this;\r\n\t\t\tvar ret = _.map(data, function (account, i, l) {\r\n\t\t\t\tvar settleUnitID = $XP(account, 'settleUnitID'),\r\n\t\t\t\t\thasDefault = $XP(account, 'defaultAccount', 0) == 0 ? false : true,\r\n\t\t\t\t\tbankInfo = Hualala.Common.mapBankInfo($XP(account, 'bankCode')),\r\n\t\t\t\t\tbankAccountStr = Hualala.Common.codeMask($XP(account, 'bankAccount', ''), 0, -4),\r\n\t\t\t\t\tsettleBalance = parseFloat($XP(account, 'settleBalance', 0));\r\n\r\n\t\t\t\treturn {\r\n\t\t\t\t\tsettleUnitID : settleUnitID,\r\n\t\t\t\t\thasDefault : hasDefault,\r\n\t\t\t\t\tsettleUnitName : $XP(account, 'settleUnitName', ''),\r\n\t\t\t\t\tdisableWithdraw : settleBalance <= 0 ? 'disabled' : '',\r\n\t\t\t\t\tsettleBalance : settleBalance,\r\n\t\t\t\t\tbankIcon : $XP(bankInfo, 'icon_16', ''),\r\n\t\t\t\t\tbankComName : $XP(bankInfo, 'name', ''),\r\n\t\t\t\t\tbankAccountStr : $XP(bankAccountStr, 'val', '').replace(/([\\w|*]{4})/g, '$1 ').replace(/([*])/g, '<span>$1</span>'),\r\n\t\t\t\t\tshopCount : parseInt($XP(account, 'shopCount', 0)),\r\n\t\t\t\t\tpath : Hualala.PageRoute.createPath('accountDetail', [settleUnitID])\r\n\t\t\t\t};\r\n\t\t\t});\r\n\t\t\treturn {\r\n\t\t\t\taccountCard : {\r\n\t\t\t\t\tlist : ret\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\t// 重载渲染列表\r\n\t\trender : function () {\r\n\t\t\tvar self = this,\r\n\t\t\t\tmodel = self.model,\r\n\t\t\t\tpagerParams = model.getPagerParams(),\r\n\t\t\t\tpageNo = $XP(pagerParams, 'pageNo');\r\n\t\t\tvar accounts = model.getAccounts(pageNo);\r\n\t\t\tvar renderData = self.mapRenderData(accounts);\r\n\t\t\tvar listTpl = self.get('listTpl');\r\n\t\t\tvar html = listTpl(renderData);\r\n\t\t\t// self.$list.empty();\r\n\t\t\t// self.$list.html(html);\r\n\t\t\tself.emptyBar && self.emptyBar.destroy();\r\n\t\t\tself.$list.empty();\r\n\t\t\tif (accounts.length == 0) {\r\n\t\t\t\tself.emptyBar = new Hualala.UI.EmptyPlaceholder({\r\n\t\t\t\t\tcontainer : self.$list\r\n\t\t\t\t});\r\n\t\t\t\tself.emptyBar.show();\r\n\t\t\t} else {\r\n\t\t\t\tself.$list.html(html);\r\n\t\t\t}\r\n\t\t\tself.initPager({\r\n\t\t\t\ttotal : model.get('pageCount'),\r\n\t\t\t\tpage : model.get('pageNo'),\r\n\t\t\t\thref : 'javascript:void(0);'\r\n\t\t\t});\r\n\t\t},\r\n\t\trefresh : function () {\r\n\t\t\tvar self = this;\r\n\t\t\t// self.render();\r\n\t\t\tdocument.location.reload(false);\r\n\t\t}\r\n\t\t\r\n\t});\r\n\r\n\tHualala.Account.AccountListView = AccountListView;\r\n\r\n\tvar WithdrawCashView = Stapes.subclass({\r\n\t\t/**\r\n\t\t * 提现窗口\r\n\t\t * @param  {Object} cfg {triggerEl, settleUnitID, model}\r\n\t\t *              @param {jQueryObj} triggerEl 触发元素\r\n\t\t *              @param {String} settleUnitID 结算账户ID\r\n\t\t *              @param {Object} model 结算账户数据模型\r\n\t\t *              @param {Object} parentView 父级View层\r\n\t\t * @return {Obj}     提现实例\r\n\t\t */\r\n\t\tconstructor : function (cfg) {\r\n\t\t\tthis.$trigger = $XP(cfg, 'triggerEl');\r\n\t\t\tthis.settleUnitID = $XP(cfg, 'settleUnitID', null);\r\n\t\t\tthis.model = $XP(cfg, 'model', null);\r\n\t\t\tthis.parentView = $XP(cfg, 'parentView', null);\r\n\t\t\tthis.modal = null;\r\n\t\t\tif (!this.settleUnitID || !this.model) {\r\n\t\t\t\tthrow(\"Withdraw Cash View init failed!\");\r\n\t\t\t}\r\n\t\t\tthis.loadTemplates();\r\n\t\t\tthis.initModal();\r\n\t\t\tthis.renderForm();\r\n\t\t\tthis.bindEvent();\r\n\t\t\tthis.emit('show');\t\t\r\n\t\t}\r\n\t});\r\n\r\n\tWithdrawCashView.proto({\r\n\t\tloadTemplates : function () {\r\n\t\t\tvar layoutTpl = Handlebars.compile(Hualala.TplLib.get('tpl_withdraw_form')),\r\n\t\t\t\tbtnTpl = Handlebars.compile(Hualala.TplLib.get('tpl_shop_modal_btns'));\r\n\t\t\tthis.set({\r\n\t\t\t\tlayoutTpl : layoutTpl,\r\n\t\t\t\tbtnTpl : btnTpl\r\n\t\t\t});\r\n\t\t},\r\n\t\tinitModal : function () {\r\n\t\t\tvar self = this;\r\n\t\t\tself.modal = new Hualala.UI.ModalDialog({\r\n\t\t\t\tid : 'account_withdraw',\r\n\t\t\t\tclz : 'service-modal',\r\n\t\t\t\ttitle : '结算账户提现',\r\n\t\t\t\tafterRemove : function () {\r\n\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t},\r\n\t\tmapFormElsData : function () {\r\n\t\t\tvar self = this,\r\n\t\t\t\taccountInfoKeys = [\r\n\t\t\t\t\t{key : 'settleUnitName', label : '结算账户名称'},\r\n\t\t\t\t\t{key : 'receiverName', label : '开户名'},\r\n\t\t\t\t\t{key : 'bankName', label : '开户行'},\r\n\t\t\t\t\t{key : 'bankAccount', label : '账号'},\r\n\t\t\t\t\t{key : 'settleBalance', label : '账户余额'}\r\n\t\t\t\t],\r\n\t\t\t\taccountInfo = _.map(accountInfoKeys, function (el) {\r\n\t\t\t\t\tvar k = $XP(el, 'key');\r\n\t\t\t\t\treturn {\r\n\t\t\t\t\t\tlabel : $XP(el, 'label', ''),\r\n\t\t\t\t\t\tvalue : k == 'settleBalance' ? ('<strong>' + self.model.get(k) + '</strong>元') : self.model.get(k)\r\n\t\t\t\t\t};\r\n\t\t\t\t});\r\n\t\t\treturn {\r\n\t\t\t\taccountInfo : accountInfo,\r\n\t\t\t\tformClz : 'account-withdraw-form form-feedback-out',\r\n\t\t\t\tlabelClz : 'col-sm-4 control-label',\r\n\t\t\t\tclz : 'col-sm-7',\r\n\t\t\t\tid : 'transAmount',\r\n\t\t\t\tlabel : '请输入提现金额',\r\n\t\t\t\tname : 'transAmount',\r\n\t\t\t\tvalue : self.model.get('settleBalance')\r\n\t\t\t};\r\n\t\t},\r\n\t\trenderForm : function () {\r\n\t\t\tvar self = this,\r\n\t\t\t\trenderData = self.mapFormElsData(),\r\n\t\t\t\ttpl = self.get('layoutTpl'),\r\n\t\t\t\tbtnTpl = self.get('btnTpl'),\r\n\t\t\t\thtm = tpl(renderData);\r\n\t\t\tself.modal._.body.html(htm);\r\n\t\t\tself.modal._.footer.html(btnTpl({\r\n\t\t\t\tbtns : [\r\n\t\t\t\t\t{clz : 'btn-default', name : 'cancel', label : '取消'},\r\n\t\t\t\t\t{clz : 'btn-warning', name : 'submit', label : '立即提现'}\r\n\t\t\t\t]\r\n\t\t\t}));\r\n\t\t},\r\n\t\tbindEvent : function () {\r\n\t\t\tvar self = this;\r\n\t\t\tthis.on({\r\n\t\t\t\tshow : function () {\r\n\t\t\t\t\tthis.modal.show();\r\n\t\t\t\t},\r\n\t\t\t\thide : function () {\r\n\t\t\t\t\tthis.modal.hide();\r\n\t\t\t\t\tthis.parentView.emit('updateSettleBalance', self.model);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\tself.modal._.dialog.find('.btn').on('click', function (e) {\r\n\t\t\t\tvar $btn = $(this),\r\n\t\t\t\t\tact = $btn.attr('name');\r\n\t\t\t\tif (act == 'cancel') {\r\n\t\t\t\t\tself.emit('hide');\r\n\t\t\t\t} else {\r\n\t\t\t\t\tvar bv = self.modal._.body.find('form').data('bootstrapValidator');\r\n\t\t\t\t\t$btn.button('提交中...');\r\n\t\t\t\t\tbv.validate();\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\tself.modal._.body.find('form').bootstrapValidator({\r\n\t\t\t\ttrigger : 'blur',\r\n\t\t\t\tfields : {\r\n\t\t\t\t\ttransAmount : {\r\n\t\t\t\t\t\tvalidators : {\r\n\t\t\t\t\t\t\tnotEmpty : {\r\n\t\t\t\t\t\t\t\tmessage : \"请输入提现金额\"\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\tnumeric : {\r\n\t\t\t\t\t\t\t\tmessage: \"提现金额必须为数字\"\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\tgreaterThan : {\r\n\t\t\t\t\t\t\t\tinclusive : false,\r\n\t\t\t\t\t\t\t\tvalue : 0,\r\n\t\t\t\t\t\t\t\tmessage : \"提现金额必须大于0\"\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\tlessThan : {\r\n\t\t\t\t\t\t\t\tinclusive : true,\r\n\t\t\t\t\t\t\t\tvalue : self.model.get('settleBalance')\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\taccuracy : {\r\n\t\t\t\t\t\t\t\taccuracy : 2,\r\n\t\t\t\t\t\t\t\tmessage : \"输入现金只能精确到小数点后2位\"\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}).on('error.field.bv', function (e, data) {\r\n\t\t\t\tvar $form = $(e.target),\r\n\t\t\t\t\tbv = $form.data('bootstrapValidator');\r\n\t\t\t}).on('success.form.bv', function (e, data) {\r\n\t\t\t\te.preventDefault();\r\n\t\t\t\tvar $form = $(e.target),\r\n\t\t\t\t\tbv = $form.data('bootstrapValidator');\r\n\t\t\t\tvar formParams = self.serializeForm();\r\n\t\t\t\tself.model.emit('withdrawCash', {\r\n\t\t\t\t\tparams : formParams,\r\n\t\t\t\t\tfailFn : function () {\r\n\t\t\t\t\t\tself.modal._.footer.find('.btn[name=submit]').button('reset');\r\n\t\t\t\t\t},\r\n\t\t\t\t\tsuccessFn : function () {\r\n\t\t\t\t\t\tself.modal._.footer.find('.btn[name=submit]').button('reset');\r\n\t\t\t\t\t\tself.emit('hide');\r\n\t\t\t\t\t}\r\n\t\t\t\t})\r\n\t\t\t});\r\n\t\t},\r\n\t\tserializeForm : function () {\r\n\t\t\tvar self = this,\r\n\t\t\t\t$body = self.modal._.body;\r\n\t\t\treturn {\r\n\t\t\t\ttransAmount : $body.find('#transAmount').val()\r\n\t\t\t};\r\n\t\t}\r\n\r\n\t});\r\n\r\n\tHualala.Account.WithdrawCashView = WithdrawCashView;\r\n\r\n\tvar QueryTransFormElsCfg = {\r\n\t\ttransCreateTime : {\r\n\t\t\ttype : 'section',\r\n\t\t\tlabel : '日期',\r\n\t\t\tmin : {\r\n\t\t\t\ttype : 'datetimepicker',\r\n\t\t\t\tsurfix : '<span class=\"glyphicon glyphicon-calendar\"></span>',\r\n\t\t\t\tdefaultVal : '',\r\n\t\t\t\tvalidCfg : {\r\n\t\t\t\t\tgroup : '.min-input',\r\n\t\t\t\t\tvalidators : {}\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tmax : {\r\n\t\t\t\ttype : 'datetimepicker',\r\n\t\t\t\tsurfix : '<span class=\"glyphicon glyphicon-calendar\"></span>',\r\n\t\t\t\tdefaultVal : '',\r\n\t\t\t\tvalidCfg : {\r\n\t\t\t\t\tgroup : '.max-input',\r\n\t\t\t\t\tvalidators : {}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\ttransAmount : {\r\n\t\t\ttype : 'section',\r\n\t\t\tlabel : '金额',\r\n\t\t\tmin : {\r\n\t\t\t\ttype : 'text',\r\n\t\t\t\tprefix : '￥',\r\n\t\t\t\tsurfix : '元',\r\n\t\t\t\tdefaultVal : '',\r\n\t\t\t\tvalidCfg : {\r\n\t\t\t\t\tvalidators : {\r\n\t\t\t\t\t\tnumeric : {\r\n\t\t\t\t\t\t\tmessage: \"金额必须为数字\"\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\tgreaterThan : {\r\n\t\t\t\t\t\t\tinclusive : true,\r\n\t\t\t\t\t\t\tvalue : 0,\r\n\t\t\t\t\t\t\tmessage : \"金额必须大于或等于0\"\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tmax : {\r\n\t\t\t\ttype : 'text',\r\n\t\t\t\tprefix : '￥',\r\n\t\t\t\tsurfix : '元',\r\n\t\t\t\tdefaultVal : '',\r\n\t\t\t\tvalidCfg : {\r\n\t\t\t\t\tvalidators : {\r\n\t\t\t\t\t\tnumeric : {\r\n\t\t\t\t\t\t\tmessage: \"金额必须为数字\"\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\tgreaterThan : {\r\n\t\t\t\t\t\t\tinclusive : true,\r\n\t\t\t\t\t\t\tvalue : 0,\r\n\t\t\t\t\t\t\tmessage : \"金额必须大于或等于0\"\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\ttransStatus : {\r\n\t\t\ttype : 'combo',\r\n\t\t\tlabel : '状态',\r\n\t\t\tdefaultVal : '',\r\n\t\t\toptions : Hualala.TypeDef.FSMTransStatus,\r\n\t\t\tvalidCfg : {\r\n\t\t\t\tvalidators : {\r\n\t\t\t\t\t\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\ttransType : {\r\n\t\t\ttype : 'combo',\r\n\t\t\tlabel : '类型',\r\n\t\t\tdefaultVal : '',\r\n\t\t\toptions : Hualala.TypeDef.FSMTransType,\r\n\t\t\tvalidCfg : {\r\n\t\t\t\tvalidators : {\r\n\t\t\t\t\t\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\tbutton : {\r\n\t\t\ttype : 'button',\r\n\t\t\tclz : 'btn btn-block btn-warning',\r\n\t\t\tlabel : '查询'\r\n\t\t}\r\n\t};\r\n\tvar QueryTransFormElsHT = new IX.IListManager();\r\n\t_.each(QueryTransFormElsCfg, function (el, k) {\r\n\t\tvar type = $XP(el, 'type');\r\n\t\tvar labelClz = 'col-xs-2 col-sm-2 col-md-2 control-label';\r\n\t\tif (type == 'section') {\r\n\t\t\tvar id = minID = k + '_min_' + IX.id(), maxID = k + '_max_' + IX.id(),\r\n\t\t\t\tminName = k == 'transCreateTime' ? 'transCreateBeginTime' : 'minTransAmount',\r\n\t\t\t\tmaxName = k == 'transCreateTime' ? 'transCreateEndTime' : 'maxTransAmount',\r\n\t\t\t\tmin = IX.inherit($XP(el, 'min', {}), {\r\n\t\t\t\t\tid : minID, name : minName, clz : 'col-xs-5 col-sm-5 col-md-5',\r\n\t\t\t\t}), max = IX.inherit($XP(el, 'max', {}), {\r\n\t\t\t\t\tid : maxID, name : maxName, clz : 'col-xs-5 col-sm-5 col-md-5',\r\n\t\t\t\t});\r\n\t\t\tQueryTransFormElsHT.register(k, IX.inherit(el, {\r\n\t\t\t\tid : id,\r\n\t\t\t\tlabelClz : labelClz,\r\n\t\t\t\tmin : min,\r\n\t\t\t\tmax : max\r\n\t\t\t}));\r\n\t\t} else {\r\n\t\t\tQueryTransFormElsHT.register(k, IX.inherit(el, {\r\n\t\t\t\tid : k + '_' + IX.id(),\r\n\t\t\t\tname : k,\r\n\t\t\t\tlabelClz : labelClz,\r\n\t\t\t}, $XP(el, 'type') !== 'button' ? {clz : 'col-xs-5 col-sm-8 col-md-5'} : null));\r\n\t\t}\r\n\t});\r\n\tvar TransResultCols = [\r\n\t\t{clz : '', label : '时间'},\r\n\t\t{clz : '', label : '流水号'},\r\n\t\t{clz : '', label : '交易状态'},\r\n\t\t{clz : '', label : '交易类型'},\r\n\t\t{clz : '', label : '交易金额'},\r\n\t\t{clz : '', label : '佣金'},\r\n\t\t{clz : '', label : '手续费'},\r\n\t\t{clz : '', label : '余额变动'},\r\n\t\t{clz : '', label : '交易后余额'},\r\n\t\t{clz : '', label : '操作'}\r\n\t];\r\n\r\n\tvar AccountTransListView = CardListView.subclass({\r\n\t\tconstructor : function () {\r\n\t\t\t// View层容器\r\n\t\t\tthis.$container = null;\r\n\t\t\t// 查询表单\r\n\t\t\tthis.$queryForm = null;\r\n\t\t\t// 结果容器\r\n\t\t\tthis.$resultBox = null;\r\n\t\t\t// 分页容器\r\n\t\t\tthis.$pager = null;\r\n\t\t\tthis.loadTemplates();\r\n\t\t}\r\n\t});\r\n\tAccountTransListView.proto({\r\n\t\tloadTemplates : function () {\r\n\t\t\tvar layoutTpl = Handlebars.compile(Hualala.TplLib.get('tpl_account_detail')),\r\n\t\t\t\ttableTpl = Handlebars.compile(Hualala.TplLib.get('tpl_transaQuery_result'));\r\n\t\t\tHandlebars.registerPartial(\"transaQueryForm\", Hualala.TplLib.get('tpl_transaQuery_form'));\r\n\t\t\tHandlebars.registerPartial(\"transaQueryResult\", Hualala.TplLib.get('tpl_transaQuery_result'));\r\n\t\t\tHandlebars.registerHelper('checkFormElementType', function (conditional, options) {\r\n\t\t\t\treturn (conditional == options.hash.type) ? options.fn(this) : options.inverse(this);\r\n\t\t\t});\r\n\t\t\tHandlebars.registerHelper('chkColType', function (conditional, options) {\r\n\t\t\t\treturn (conditional == options.hash.type) ? options.fn(this) : options.inverse(this);\r\n\t\t\t});\r\n\t\t\tthis.set({\r\n\t\t\t\tlayoutTpl : layoutTpl,\r\n\t\t\t\ttableTpl : tableTpl\r\n\t\t\t});\r\n\t\t},\r\n\t\tinitLayout : function () {\r\n\t\t\tvar layoutTpl = this.get('layoutTpl');\r\n\t\t\tvar result = [],\r\n\t\t\t\ttblClz = 'table-striped table-hover',\r\n\t\t\t\ttblHeaders = TransResultCols,\r\n\t\t\t\tquery = {cols : [\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tcolClz : 'col-sm-6',\r\n\t\t\t\t\t\titems : QueryTransFormElsHT.getByKeys(['transCreateTime', 'transAmount'])\r\n\t\t\t\t\t},\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tcolClz : 'col-sm-4',\r\n\t\t\t\t\t\titems : QueryTransFormElsHT.getByKeys(['transType', 'transStatus'])\r\n\t\t\t\t\t},\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tcolClz : 'col-sm-2',\r\n\t\t\t\t\t\titems : QueryTransFormElsHT.getByKeys(['button'])\r\n\t\t\t\t\t}\r\n\t\t\t\t]};\r\n\t\t\tvar htm = layoutTpl({\r\n\t\t\t\tquery : query,\r\n\t\t\t\tresult : {\r\n\t\t\t\t\tclz : tblClz,\r\n\t\t\t\t\tthead : tblHeaders,\r\n\t\t\t\t\trows : result\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\tthis.$container.html(htm);\r\n\t\t\tthis.$queryForm = this.$container.find('.query-form');\r\n\t\t\tthis.$resultBox = this.$container.find('.query-result');\r\n\t\t\tthis.$pager = this.$container.find('.page-selection');\r\n\t\t\tthis.render();\r\n\t\t\t// this.initPager();\r\n\t\t\tthis.initQueryEls();\r\n\t\t\tthis.bindEvent();\r\n\t\t\tthis.bindQueryEvent();\r\n\t\t},\r\n\t\tinitQueryEls : function () {\r\n\t\t\tvar self = this;\r\n\t\t\tself.$queryForm.find('[data-type=datetimepicker]').datetimepicker({\r\n\t\t\t\tformat : 'yyyy/mm/dd',\r\n\t\t\t\tstartDate : '2010/01/01',\r\n\t\t\t\tautoclose : true,\r\n\t\t\t\tminView : 'month',\r\n\t\t\t\ttodayBtn : true,\r\n\t\t\t\ttodayHighlight : true,\r\n\t\t\t\tlanguage : 'zh-CN'\r\n\t\t\t});\r\n\t\t\tself.$queryForm.on('click', '.input-group-addon', function (e) {\r\n\t\t\t\tvar $this = $(this),\r\n\t\t\t\t\t$picker = $this.prev(':text[data-type=datetimepicker]');\r\n\t\t\t\tif ($picker.length > 0) {\r\n\t\t\t\t\t$picker.datetimepicker('show');\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t},\r\n\t\tbindEvent : function () {\r\n\t\t\tvar self = this;\r\n\t\t\tself.$resultBox.tooltip({\r\n\t\t\t\tselector : '[title]'\r\n\t\t\t});\r\n\t\t\tself.$resultBox.on('click', '.btn[data-href]', function (e) {\r\n\t\t\t\tvar $btn = $(this),\r\n\t\t\t\t\tpath = $btn.attr('data-href');\r\n\t\t\t\tif (!IX.isEmpty(path)) {\r\n\t\t\t\t\tdocument.location.href = path;\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\tself.$pager.on('page', function (e, pageNo) {\r\n\t\t\t\tvar params = self.model.getPagerParams();\r\n\t\t\t\tparams['pageNo'] = pageNo;\r\n\t\t\t\tself.model.emit('load', IX.inherit(params, {\r\n\t\t\t\t\tpageNo : $XP(params, 'pageNo', 1),\r\n\t\t\t\t\tpageSize : $XP(params, 'pageSize', 15)\r\n\t\t\t\t}));\r\n\t\t\t});\r\n\t\t},\r\n\t\tbindQueryEvent : function () {\r\n\t\t\tvar self = this;\r\n\t\t\tself.$resultBox.on('click', 'a[data-orderkey]', function (e) {\r\n\t\t\t\tvar $btn = $(this),\r\n\t\t\t\t\torderKey = $btn.attr('data-orderkey') || '',\r\n\t\t\t\t\ttransType = $btn.attr('data-type') || '',\r\n\t\t\t\t\ttransID = $btn.attr('data-id') || '',\r\n\t\t\t\t\torderID = $btn.attr('data-orderid') || '';\r\n\t\t\t\t// TODO show transaction detail modal\r\n\t\t\t\tvar detail = new Hualala.Account.AccountTransDetailModal({\r\n\t\t\t\t\ttriggerEl : $btn,\r\n\t\t\t\t\torderKey : orderKey,\r\n\t\t\t\t\torderID : orderID,\r\n\t\t\t\t\ttransType : transType,\r\n\t\t\t\t\ttransID : transID\r\n\t\t\t\t});\r\n\t\t\t});\r\n\t\t\tself.$queryForm.on('click', '.btn', function (e) {\r\n\t\t\t\t// TODO Update modal params and render query result\r\n\t\t\t\tvar params = self.getQueryFormParams();\r\n\t\t\t\tself.model.emit('load', params);\r\n\t\t\t});\r\n\t\t},\r\n\t\tgetQueryFormParams : function () {\r\n\t\t\tvar self = this;\r\n\t\t\t// var formKeys = ['transCreateBeginTime', 'transCreateEndTime', 'minTransAmount', 'maxTransAmount', 'transType', 'transStatus'];\r\n\t\t\tvar params = self.$queryForm.find('>form').serializeArray();\r\n\t\t\tvar ret = {};\r\n\t\t\t_.each(params, function (el, i) {\r\n\t\t\t\tvar k = $XP(el, 'name'), v = $XP(el, 'value', '');\r\n\t\t\t\tswitch(k) {\r\n\t\t\t\t\tcase 'transCreateBeginTime':\r\n\t\t\t\t\tcase 'transCreateEndTime':\r\n\t\t\t\t\t\tif (IX.isEmpty(v)) {\r\n\t\t\t\t\t\t\tv = '';\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tv = IX.Date.getDateByFormat(v, 'yyyyMMddHHmmss');\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tdefault :\r\n\t\t\t\t\t\tv = IX.isEmpty(v) ? '' : v;\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t\tret[k] = v;\r\n\t\t\t});\r\n\t\t\tIX.Debug.info(\"DEBUG: Account TransList View Query Form Params : \");\r\n\t\t\tIX.Debug.info(ret);\r\n\t\t\treturn ret;\r\n\t\t},\r\n\t\tmapTimeData : function (s) {\r\n\t\t\tvar r = {value : '', text : ''};\r\n\t\t\tvar s1 = '';\r\n\t\t\tif (IX.isString(s) && s.length > 0) {\r\n\t\t\t\ts1 = s.replace(/([\\d]{4})([\\d]{2})([\\d]{2})([\\d]{2})([\\d]{2})([\\d]{2})/g, '$1/$2/$3 $4:$5:$6');\r\n\t\t\t\ts1 = IX.Date.getDateByFormat(s1, 'yyyy/MM/dd HH:mm');\r\n\t\t\t\tr = IX.inherit({value : s, text : s1});\r\n\t\t\t}\r\n\t\t\treturn r;\r\n\t\t},\r\n\t\tmapTransStatus : function (s) {\r\n\t\t\ts = (s + \"\") || '';\r\n\t\t\tvar status = Hualala.TypeDef.FSMTransStatus;\r\n\t\t\tvar m = _.filter(status, function (el) {\r\n\t\t\t\treturn $XP(el, 'value', '') == s;\r\n\t\t\t});\r\n\t\t\tif (s.length == 0 || m.length == 0) {\r\n\t\t\t\treturn {text : '', value : ''};\r\n\t\t\t}\r\n\t\t\treturn {text : $XP(m[0], 'label', ''), value : $XP(m[0], 'value', '')};\r\n\t\t},\r\n\t\tmapTransType : function (s) {\r\n\t\t\ts = s || '';\r\n\t\t\tvar types = Hualala.TypeDef.FSMTransType;\r\n\t\t\tvar m = _.filter(types, function (el) {\r\n\t\t\t\treturn $XP(el, 'value', '') == s;\r\n\t\t\t});\r\n\t\t\tif (s.length == 0 || m.length == 0) {\r\n\t\t\t\treturn {text : '', value : ''};\r\n\t\t\t}\r\n\t\t\treturn {text : $XP(m[0], 'label', ''), value : $XP(m[0], 'value', '')};\r\n\t\t},\r\n\t\tmapCashData : function (s) {\r\n\t\t\treturn {text : Hualala.Common.Math.prettyNumeric(s), value : s};\r\n\t\t},\r\n\t\tmapTransChanged : function (r) {\r\n\t\t\tvar transAmount = $XP(r, 'transAmount', 0),\r\n\t\t\t\ttransSalesCommission = $XP(r, 'transSalesCommission', 0),\r\n\t\t\t\ttransPoundage = $XP(r, 'transPoundage', 0),\r\n\t\t\t\ttransChanged = transAmount - transSalesCommission - transPoundage;\r\n\t\t\treturn {value : transChanged, text : transChanged};\r\n\t\t},\r\n\t\tmapColsRenderData : function (row) {\r\n\t\t\tvar self = this;\r\n\t\t\tvar colKeys = 'transCreateTime,SUATransItemID,transStatus,transType,transAmount,transSalesCommission,transPoundage,transChanged,transAfterBalance,rowControl';\r\n\t\t\tvar col = {clz : '', type : 'text'};\r\n\r\n\t\t\tvar cols = _.map(colKeys.split(','), function (k, i) {\r\n\t\t\t\tvar r = null;\r\n\t\t\t\tswitch(k) {\r\n\t\t\t\t\tcase 'transCreateTime':\r\n\t\t\t\t\t\tr = self.mapTimeData($XP(row, k, ''));\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 'SUATransItemID':\r\n\t\t\t\t\t\tr = {value : $XP(row, k, ''), text : $XP(row, k, '')};\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 'transStatus':\r\n\t\t\t\t\t\tr = self.mapTransStatus($XP(row, k, ''));\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 'transType':\r\n\t\t\t\t\t\tr = self.mapTransType($XP(row, k, ''));\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 'transAmount':\r\n\t\t\t\t\tcase 'transSalesCommission':\r\n\t\t\t\t\tcase 'transPoundage':\r\n\t\t\t\t\tcase 'transAfterBalance':\r\n\t\t\t\t\t\tr = self.mapCashData($XP(row, k, ''));\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 'transChanged':\r\n\t\t\t\t\t\tr = self.mapTransChanged(row);\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 'rowControl':\r\n\t\t\t\t\t\tvar transType = $XP(row, 'transType', ''),\r\n\t\t\t\t\t\t\ttransStatus = $XP(row, 'transStatus', '');\r\n\t\t\t\t\t\tvar hideBtnTransType = \"104,199,202,203,204,205,206,299\";\r\n\t\t\t\t\t\tr = {\r\n\t\t\t\t\t\t\ttype : 'button',\r\n\t\t\t\t\t\t\tbtnClz : (hideBtnTransType.indexOf(transType) >= 0 || (transType == \"203\" && transStatus < 1)) ? 'hidden' : '',\r\n\t\t\t\t\t\t\tlabel : '查看',\r\n\t\t\t\t\t\t\tSUATransItemID : $XP(row, 'SUATransItemID', ''),\r\n\t\t\t\t\t\t\ttransType : transType,\r\n\t\t\t\t\t\t\torderKey : $XP(row, 'orderKey', ''),\r\n\t\t\t\t\t\t\torderID : $XP(row, 'orderID', '')\r\n\t\t\t\t\t\t};\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t\treturn IX.inherit(col, r);\r\n\t\t\t});\r\n\t\t\treturn cols;\r\n\t\t},\r\n\t\tmapRenderData : function (data) {\r\n\t\t\tvar self = this;\r\n\t\t\tvar tblClz = 'table-striped table-hover',\r\n\t\t\t\ttblHeaders = TransResultCols;\r\n\t\t\tvar rows = _.map(data, function (row) {\r\n\t\t\t\treturn {\r\n\t\t\t\t\tclz : '',\r\n\t\t\t\t\tcols : self.mapColsRenderData(row)\r\n\t\t\t\t};\r\n\t\t\t});\r\n\t\t\treturn {\r\n\t\t\t\tclz : tblClz,\r\n\t\t\t\tisEmpty : data.length == 0 ? true : false,\r\n\t\t\t\tcolCount : tblHeaders.length,\r\n\t\t\t\tthead : tblHeaders,\r\n\t\t\t\trows : rows\r\n\t\t\t};\r\n\t\t},\r\n\t\trender : function () {\r\n\t\t\tvar self = this,\r\n\t\t\t\tmodel = self.model,\r\n\t\t\t\tpagerParams = model.getPagerParams(),\r\n\t\t\t\tpageNo = $XP(pagerParams, 'pageNo');\r\n\t\t\tvar results = model.getDataByPageNo(pageNo);\r\n\t\t\tvar renderData = self.mapRenderData(results);\r\n\t\t\tvar tableTpl = self.get('tableTpl');\r\n\t\t\tvar html = tableTpl(renderData);\r\n\t\t\tself.$resultBox.empty();\r\n\t\t\tself.$resultBox.html(html);\r\n\t\t\tself.initPager({\r\n\t\t\t\ttotal : model.get('pageCount'),\r\n\t\t\t\tpage : model.get('pageNo'),\r\n\t\t\t\thref : 'javascript:void(0);'\r\n\t\t\t});\r\n\t\t}\r\n\t});\r\n\tHualala.Account.AccountTransListView = AccountTransListView;\r\n\r\n\tvar AccountQueryShopView = Hualala.Shop.QueryView.subclass({\r\n\t\tconstructor : Hualala.Shop.QueryView.prototype.constructor\r\n\t});\r\n\tHualala.Account.AccountQueryShopView = AccountQueryShopView;\r\n\r\n\tvar AccountQueryShopResultView = CardListView.subclass({\r\n\t\tconstructor : CardListView.prototype.constructor\r\n\t});\r\n\tAccountQueryShopResultView.proto({\r\n\t\tloadTemplates : function () {\r\n\t\t\tvar layoutTpl = Handlebars.compile(Hualala.TplLib.get('tpl_shop_list_layout')),\r\n\t\t\t\tlistTpl = Handlebars.compile(Hualala.TplLib.get('tpl_shop_list')),\r\n\t\t\t\titemTpl = Handlebars.compile(Hualala.TplLib.get('tpl_shop_table'));\r\n\t\t\t// 注册shopCard子模板\r\n\t\t\tHandlebars.registerPartial(\"shopTable\", Hualala.TplLib.get('tpl_shop_table'));\r\n\r\n\t\t\tthis.set({\r\n\t\t\t\tlayoutTpl : layoutTpl,\r\n\t\t\t\tlistTpl : listTpl,\r\n\t\t\t\titemTpl : itemTpl\r\n\t\t\t});\r\n\t\t},\r\n\t\t// 格式化渲染数据\r\n\t\tmapRenderData : function (data) {\r\n\t\t\tvar self = this;\r\n\t\t\t\r\n\t\t\tvar ret = _.map(data, function (shop, i, l) {\r\n\t\t\t\treturn {\r\n\t\t\t\t\tclz : '',\r\n\t\t\t\t\tid : $XP(shop, 'shopID', ''),\r\n\t\t\t\t\tname : $XP(shop, 'shopName', ''),\r\n\t\t\t\t\tcity : $XP(shop, 'cityName', '')\r\n\t\t\t\t};\r\n\t\t\t});\r\n\t\t\treturn {\r\n\t\t\t\tshopTable : {\r\n\t\t\t\t\tisEmpty : !data || data.length == 0 ? true : false,\r\n\t\t\t\t\tcolCount : 3,\r\n\t\t\t\t\trows : ret\r\n\t\t\t\t}\r\n\t\t\t};\r\n\t\t},\r\n\t\trender : function () {\r\n\t\t\tvar self = this,\r\n\t\t\t\tmodel = self.model,\r\n\t\t\t\tpagerParams = model.getPagerParams(),\r\n\t\t\t\tpageNo = $XP(pagerParams, 'pageNo');\r\n\t\t\tvar shops = model.getShops(pageNo);\r\n\t\t\tvar renderData = self.mapRenderData(shops);\r\n\t\t\tvar listTpl = self.get('listTpl');\r\n\t\t\tvar html = listTpl(renderData);\r\n\t\t\tself.$list.empty();\r\n\t\t\tself.$list.html(html);\r\n\t\t\tself.initPager({\r\n\t\t\t\ttotal : model.get('pageCount'),\r\n\t\t\t\tpage : model.get('pageNo'),\r\n\t\t\t\thref : 'javascript:void(0);'\r\n\t\t\t});\r\n\t\t}\r\n\t});\r\n\tHualala.Account.AccountQueryShopResultView = AccountQueryShopResultView;\r\n})(jQuery, window);;(function ($, window) {\r\n\tIX.ns(\"Hualala.Account\");\r\n\tvar popoverMsg = Hualala.UI.PopoverMsgTip;\r\n\tvar toptip = Hualala.UI.TopTip;\r\n\tvar AccountListModel = Hualala.Account.AccountListModel;\r\n\tvar AccountListView = Hualala.Account.AccountListView;\r\n\tvar ShopListController = Hualala.Shop.ShopListController;\r\n\r\n\tvar QueryModel = Hualala.Shop.QueryModel;\r\n\tvar QueryView = Hualala.Shop.QueryView;\r\n\tvar QueryController = Hualala.Shop.QueryController;\r\n\r\n\tvar AccountListController = ShopListController.subclass({\r\n\t\t/**\r\n\t\t * 结算账户列表控制器\r\n\t\t * @param  {Object} cfg 配置参数\r\n\t\t *          @param {JQueryObj} container 容器\r\n\t\t *          @param {Object} view  结果的View模块实例\r\n\t\t *          @param {Object} model 结果的数据模块实例\r\n\t\t * @return {Object}     \r\n\t\t */\r\n\t\tconstructor : ShopListController.prototype.constructor\r\n\t});\r\n\r\n\r\n\tHualala.Account.AccountListController = AccountListController;\r\n\r\n\tvar AccountQueryShopController = QueryController.subclass({\r\n\t\tconstructor : function (cfg) {\r\n\t\t\tthis.set({\r\n\t\t\t\tsessionData : Hualala.getSessionData()\r\n\t\t\t});\r\n\t\t\tthis.settleUnitID = $XP(cfg, 'settleUnitID', '');\r\n\t\t\tthis.settleName = $XP(cfg, 'settleName', '');\r\n\t\t\tthis.shopCount = $XP(cfg, 'shopCount', '');\r\n\t\t\tthis.container = $XP(cfg, 'container', null);\r\n\t\t\tthis.needShopCreate = false;\r\n\t\t\tthis.model = new Hualala.Account.AccountQueryShopModel();\r\n\t\t\tthis.view = new Hualala.Account.AccountQueryShopView();\r\n\t\t\tthis.resultContainer = $XP(cfg, 'resultContainer', null);\r\n\t\t\tthis.resultController = new Hualala.Account.AccountQueryShopResultController({\r\n\t\t\t\tcontainer : this.resultContainer,\r\n\t\t\t\tmodel : new Hualala.Account.AccountQueryShopResultModel(),\r\n\t\t\t\tview : new Hualala.Account.AccountQueryShopResultView()\r\n\t\t\t})\r\n\t\t\tthis.init();\r\n\t\t}\r\n\t});\r\n\tAccountQueryShopController.proto({\r\n\t\tinit : function () {\r\n\t\t\tvar self = this;\r\n\t\t\tself.bindEvent();\r\n\t\t\tself.model.emit('load', function () {\r\n\t\t\t\tif (!self.model.hasReady()) {\r\n\t\t\t\t\tthrow(\"Shop Query Init Failed!!\");\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\tself.resultController.initDataStore(self.model.getShops());\r\n\t\t\t\t// 加载View层\r\n\t\t\t\tself.view.emit('init');\r\n\t\t\t\t\r\n\t\t\t});\r\n\t\t},\r\n\t\t// 绑定事件\r\n\t\tbindEvent : function () {\r\n\t\t\t// 控制器的事件绑定\r\n\t\t\tthis.on({\r\n\t\t\t\treload : function () {\r\n\t\t\t\t\tvar self = this;\r\n\t\t\t\t\tself.model.distory();\r\n\t\t\t\t\tself.view.distory();\r\n\t\t\t\t\tself.init();\r\n\t\t\t\t},\r\n\t\t\t\tquery : function (params) {\r\n\t\t\t\t\tvar self = this;\r\n\t\t\t\t\tIX.Debug.info('DEBUG: Account Query Shops Params:');\r\n\t\t\t\t\tIX.Debug.info(params);\r\n\t\t\t\t\tself.resultController && self.resultController.emit('load', IX.inherit(params, {\r\n\t\t\t\t\t\tpageNo : 1,\r\n\t\t\t\t\t\tpageSize : 15\r\n\t\t\t\t\t}));\r\n\t\t\t\t}\r\n\t\t\t}, this);\r\n\t\t\t// 模型的事件绑定\r\n\t\t\tthis.model.on({\r\n\t\t\t\tload : function (cbFn) {\r\n\t\t\t\t\tvar self = this,\r\n\t\t\t\t\t\tparams = {\r\n\t\t\t\t\t\t\tsettleUnitID : self.settleUnitID,\r\n\t\t\t\t\t\t\tsettleName : self.settleName,\r\n\t\t\t\t\t\t\tshopCount : self.shopCount\r\n\t\t\t\t\t\t};\r\n\t\t\t\t\t\t// params = $XP(self.get('sessionData'), 'user', {});\r\n\t\t\t\t\tself.model.init(params, cbFn);\r\n\t\t\t\t}\r\n\t\t\t}, this);\r\n\t\t\t// 视图事件绑定\r\n\t\t\tthis.view.on({\r\n\t\t\t\tinit : function () {\r\n\t\t\t\t\tvar self = this;\r\n\t\t\t\t\tself.view.init({\r\n\t\t\t\t\t\tmodel : self.model,\r\n\t\t\t\t\t\tneedShopCreate : self.needShopCreate,\r\n\t\t\t\t\t\tcontainer : self.container\r\n\t\t\t\t\t});\r\n\t\t\t\t},\r\n\t\t\t\t// 过滤操作，触发显示结果\r\n\t\t\t\tfilter : function (params) {\r\n\t\t\t\t\tvar self = this;\r\n\t\t\t\t\tself.emit('query', params);\r\n\t\t\t\t\t//TODO 重置Query的chosenPanel\r\n\t\t\t\t},\r\n\t\t\t\t// 搜索操作，触发显示结果\r\n\t\t\t\tquery : function (params) {\r\n\t\t\t\t\tvar self = this;\r\n\t\t\t\t\tself.emit('query', params);\r\n\t\t\t\t}\r\n\t\t\t}, this);\r\n\t\t}\r\n\t});\r\n\tHualala.Account.AccountQueryShopController = AccountQueryShopController;\r\n\r\n\tvar AccountQueryShopResultController = Hualala.Shop.ShopListController.subclass({\r\n\t\tconstructor : Hualala.Shop.ShopListController.prototype.constructor\r\n\t});\r\n\tAccountQueryShopResultController.proto({\r\n\t\tinitDataStore : function (data) {\r\n\t\t\tthis.model.initDataStore(data);\r\n\t\t},\r\n\t\tbindEvent : function () {\r\n\t\t\tthis.on({\r\n\t\t\t\tload : function (params) {\r\n\t\t\t\t\tvar self = this;\r\n\t\t\t\t\tif (!self.hasReady()) {\r\n\t\t\t\t\t\tself.init(params);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tself.model.emit('load', params);\r\n\t\t\t\t}\r\n\t\t\t}, this);\r\n\t\t\tthis.model.on({\r\n\t\t\t\tload : function (params) {\r\n\t\t\t\t\tvar self = this;\r\n\t\t\t\t\tvar cbFn = function () {\r\n\t\t\t\t\t\tself.view.emit('render');\r\n\t\t\t\t\t};\r\n\t\t\t\t\tself.model.load(params, cbFn);\r\n\t\t\t\t}\r\n\t\t\t}, this);\r\n\t\t\tthis.view.on({\r\n\t\t\t\trender : function () {\r\n\t\t\t\t\tvar self = this;\r\n\t\t\t\t\tself.view.render();\r\n\t\t\t\t},\r\n\t\t\t\treloadPager : function () {\r\n\t\t\t\t\tvar self = this;\r\n\t\t\t\t\tself.view.initPager(params);\r\n\t\t\t\t}\r\n\t\t\t}, this);\r\n\t\t}\r\n\t});\r\n\tHualala.Account.AccountQueryShopResultController = AccountQueryShopResultController;\r\n\t\r\n})(jQuery, window);;(function ($, window) {\r\n\tIX.ns(\"Hualala.Account\");\r\n\tvar popoverMsg = Hualala.UI.PopoverMsgTip;\r\n\tvar toptip = Hualala.UI.TopTip;\r\n\tvar LoadingModal = Hualala.UI.LoadingModal;\r\n\tvar BaseAccountModel = Hualala.Account.BaseAccountModel;\r\n\r\n\t/*账户管理控制器*/\r\n\tvar AccountMgrController = Stapes.subclass({\r\n\t\t/**\r\n\t\t * 构造控制器\r\n\t\t * @param  {Object} cfg {container, settleUnitID, accountModel, mgrView, transaDetailCtrl}\r\n\t\t * @return {Object}     AccountMgrController实例\r\n\t\t */\r\n\t\tconstructor : function (cfg) {\r\n\t\t\tthis.container = $XP(cfg, 'container', null);\r\n\t\t\tthis.settleUnitID = $XP(cfg, 'settleUnitID', null);\r\n\t\t\tthis.model = $XP(cfg, 'accountModel', null);\r\n\t\t\tthis.view = $XP(cfg, 'mgrView', null);\r\n\t\t\tthis.transaDetailCtrl = $XP(cfg, 'transaDetailCtrl', null);\r\n\t\t\tif (!this.container || !this.model || !this.view || !this.transaDetailCtrl) {\r\n\t\t\t\tthrow(\"Account Detail Mgr Init Failed!!\");\r\n\t\t\t\treturn ;\r\n\t\t\t}\r\n\t\t\tthis.init();\r\n\t\t}\r\n\t});\r\n\tAccountMgrController.proto({\r\n\t\t// 初始化控制器\r\n\t\tinit : function () {\r\n\t\t\tvar self = this;\r\n\t\t\tself.bindEvent();\r\n\t\t\tself.model.emit('load', {\r\n\t\t\t\tsettleUnitID : self.settleUnitID,\r\n\t\t\t\tcbFn : function () {\r\n\t\t\t\t\tself.view.emit('init', {\r\n\t\t\t\t\t\tmodel : self.model,\r\n\t\t\t\t\t\tcontainer : self.container\r\n\t\t\t\t\t});\r\n\t\t\t\t\tself.view.emit('render');\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t},\r\n\t\t// 控制器绑定事件\r\n\t\tbindEvent : function () {\r\n\t\t\tthis.on({\r\n\t\t\t\t// 触发交易明细控制器进行查询\r\n\t\t\t\tquery : function () {\r\n\t\t\t\t\tvar self = this;\r\n\t\t\t\t\t\r\n\t\t\t\t}\r\n\t\t\t}, this);\r\n\t\t\t\r\n\t\t\tthis.view.on({\r\n\t\t\t\tinit : function (params) {\r\n\t\t\t\t\tvar self = this;\r\n\t\t\t\t\tself.view.init(params);\r\n\t\t\t\t\tself.transaDetailCtrl.init({\r\n\t\t\t\t\t\tcontainer : self.container.find('.account-detail-box'),\r\n\t\t\t\t\t\tsettleUnitID : self.settleUnitID\r\n\t\t\t\t\t});\r\n\t\t\t\t},\r\n\t\t\t\trender : function () {\r\n\t\t\t\t\tvar self = this;\r\n\t\t\t\t\tself.view.render();\r\n\t\t\t\t}\r\n\t\t\t}, this);\r\n\t\t}\r\n\t});\r\n\r\n\tHualala.Account.AccountMgrController = AccountMgrController; \r\n\r\n\t/*交易明细控制器*/\r\n\tvar TransactionDetailController = Stapes.subclass({\r\n\t\tconstructor: function () {\r\n\t\t\tthis.set({\r\n\t\t\t\tsessionData : Hualala.getSessionData()\r\n\t\t\t});\r\n\t\t\tthis.container = null;\r\n\t\t\tthis.settleUnitID = null;\r\n\t\t\tthis.model = new Hualala.Account.AccountTransListModel();\r\n\t\t\tthis.view = new Hualala.Account.AccountTransListView();\r\n\t\t\t\r\n\t\t}\r\n\t});\r\n\tTransactionDetailController.proto({\r\n\t\tinit : function (cfg) {\r\n\t\t\tvar self = this;\r\n\t\t\tself.container = $XP(cfg, 'container', null);\r\n\t\t\tself.settleUnitID = $XP(cfg, 'settleUnitID', '');\r\n\t\t\tself.loadingModal = new LoadingModal({\r\n\t\t\t\tstart : 100\r\n\t\t\t});\r\n\t\t\tif (!this.container || !this.model || !this.view) {\r\n\t\t\t\tthrow(\"Account Transaction Detail Mgr Init Failed!!\");\r\n\t\t\t\treturn ;\r\n\t\t\t}\r\n\t\t\tself.bindEvent();\r\n\t\t\tself.model.init({\r\n\t\t\t\t\r\n\t\t\t\tgroupID : $XP(self.get('sessionData'), 'site.groupID'),\r\n\t\t\t\tsettleUnitID : self.settleUnitID\r\n\t\t\t});\r\n\t\t\tself.model.emit('load', {\r\n\t\t\t\tpageNo : 1, pageSize : 15,\r\n\t\t\t\tcbFn : function (model) {\r\n\t\t\t\t\tself.view.emit('init', {\r\n\t\t\t\t\t\tcontainer : self.container,\r\n\t\t\t\t\t\tmodel : model\r\n\t\t\t\t\t});\r\n\t\t\t\t\tself.loadingModal.hide();\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t},\r\n\t\tbindEvent : function () {\r\n\t\t\tthis.model.on({\r\n\t\t\t\tload : function (params) {\r\n\t\t\t\t\tvar self = this;\r\n\t\t\t\t\tvar cbFn = $XP(params, 'cbFn', function () {\r\n\t\t\t\t\t\tself.view.emit('render');\r\n\t\t\t\t\t\tself.loadingModal.hide();\r\n\t\t\t\t\t});\r\n\t\t\t\t\tself.loadingModal.show();\r\n\t\t\t\t\tthis.model.load(params, cbFn);\r\n\t\t\t\t}\r\n\t\t\t}, this);\r\n\t\t\tthis.view.on({\r\n\t\t\t\tinit : function (cfg) {\r\n\t\t\t\t\tthis.view.init(cfg);\r\n\t\t\t\t},\r\n\t\t\t\trender : function () {\r\n\t\t\t\t\tthis.view.render();\r\n\t\t\t\t}\r\n\t\t\t}, this);\r\n\t\t}\r\n\t});\r\n\tHualala.Account.TransactionDetailController = TransactionDetailController;\r\n})(jQuery, window);\r\n;(function ($, window) {\r\n\tIX.ns(\"Hualala.Account\");\r\n\tvar popoverMsg = Hualala.UI.PopoverMsgTip;\r\n\tvar toptip = Hualala.UI.TopTip;\r\n\r\n\tvar AccountActs = [\r\n\t\t{clz : 'btn-success withdraw', act : 'withdraw', label : '提现'},\r\n\t\t{clz : 'btn-link', act : 'edit', label : '修改银行卡'},\r\n\t\t{clz : 'btn-link', act : 'queryShops', label : '查看全部店铺'},\r\n\t\t{clz : 'btn-link', act : 'delete', label : '删除此帐户'}\r\n\t];\r\n\r\n\tvar AccountMgrView = Stapes.subclass({\r\n\t\tconstructor : function () {\r\n\t\t\t// View层容器\r\n\t\t\tthis.$container = null;\r\n\t\t\t// 面包屑导航条\r\n\t\t\tthis.$nav = null;\r\n\t\t\tthis.breadCrumbs = null;\r\n\t\t\t// schema容器\r\n\t\t\tthis.$schema = null;\r\n\t\t\t// 交易详情\r\n\t\t\tthis.$detail = null;\r\n\r\n\t\t\tthis.model = null;\r\n\r\n\t\t\tthis.loadTemplates();\r\n\t\t}\r\n\t});\r\n\r\n\tAccountMgrView.proto({\r\n\t\t/**\r\n\t\t * 初始化View层\r\n\t\t * \r\n\t\t * @param  {Object} cfg {model, container}\r\n\t\t * @return {[type]}\r\n\t\t */\r\n\t\tinit : function (cfg) {\r\n\t\t\tthis.$container = $XP(cfg, 'container', null);\r\n\t\t\tthis.model = $XP(cfg, 'model', null);\r\n\t\t\tif (!this.$container || !this.model) {\r\n\t\t\t\tthrow(\"Account Detail View Init Failed!\");\r\n\t\t\t\treturn ;\r\n\t\t\t}\r\n\t\t\tthis.initLayout();\r\n\t\t},\r\n\t\tinitLayout : function () {\r\n\t\t\tvar layoutTpl = this.get('layoutTpl');\r\n\t\t\tvar htm = layoutTpl();\r\n\t\t\tthis.$container.html(htm);\r\n\t\t\tthis.$nav = this.$container.find('.account-nav');\r\n\t\t\tthis.$schema = this.$container.find('.account-schema-box');\r\n\t\t\tthis.$detail = this.$container.find('.account-detail-box');\r\n\t\t\tthis.bindEvent();\r\n\t\t},\r\n\t\tinitBreadCrumbs : function () {\r\n\t\t\tvar self = this,\r\n\t\t\t\t$nav = self.$nav,\r\n\t\t\t\tparentNames = Hualala.PageRoute.getParentNamesByPath();\r\n\t\t\tself.breadCrumbs = new Hualala.UI.BreadCrumb({\r\n\t\t\t\tcontainer : $nav,\r\n\t\t\t\thideRoot : true,\r\n\t\t\t\tnodes : parentNames,\r\n\t\t\t\tclz : 'account-crumbs',\r\n\t\t\t\tclickFn : function () {\r\n\t\t\t\t\tvar $this = $(this);\r\n\t\t\t\t\tdocument.location.href = $this.attr('data-href');\r\n\t\t\t\t},\r\n\t\t\t\tmapRenderData : function (data, hideRoot, clz) {\r\n\t\t\t\t\tvar list = _.map(data, function (el, idx, l) {\r\n\t\t\t\t\t\tvar label = $XP(el, 'label', ''),\r\n\t\t\t\t\t\t\tname = $XP(el, 'name', ''),\r\n\t\t\t\t\t\t\tpath = Hualala.PageRoute.createPath(name, [self.model.get('settleUnitID')]);\r\n\t\t\t\t\t\treturn {\r\n\t\t\t\t\t\t\tclz : 'crumb',\r\n\t\t\t\t\t\t\tlabel : label,\r\n\t\t\t\t\t\t\tpath : path,\r\n\t\t\t\t\t\t\tname : name,\r\n\t\t\t\t\t\t\tisLastNode : (data.length - 1 == idx) ? true : false\r\n\t\t\t\t\t\t};\r\n\t\t\t\t\t});\r\n\t\t\t\t\thideRoot === true && list.shift();\r\n\t\t\t\t\treturn {\r\n\t\t\t\t\t\tclz : clz,\r\n\t\t\t\t\t\titems : list\r\n\t\t\t\t\t};\r\n\t\t\t\t}\r\n\r\n\t\t\t});\r\n\r\n\t\t},\r\n\t\tloadTemplates : function () {\r\n\t\t\tvar layoutTpl = Handlebars.compile(Hualala.TplLib.get('tpl_accountMgr_layout')),\r\n\t\t\t\tschemaTpl = Handlebars.compile(Hualala.TplLib.get('tpl_account_schema')),\r\n\t\t\t\twithDrawTpl = Handlebars.compile(Hualala.TplLib.get('tpl_withdraw_form'));\r\n\t\t\t// 注册子模版\r\n\t\t\tHandlebars.registerPartial(\"accountCard\", Hualala.TplLib.get('tpl_account_card'));\r\n\t\t\tthis.set({\r\n\t\t\t\tlayoutTpl : layoutTpl,\r\n\t\t\t\tschemaTpl : schemaTpl,\r\n\t\t\t\twithDrawTpl : withDrawTpl\r\n\t\t\t});\r\n\t\t},\r\n\t\tbindEvent : function () {\r\n\t\t\tvar self = this;\r\n\t\t\tself.$schema.on('click', '.btn.withdraw', function (e) {\r\n\t\t\t\tif ($(this).hasClass('disabled')) return;\r\n\t\t\t\tself.withdraw($(this));\r\n\t\t\t});\r\n\t\t\tself.$schema.on('click', '[data-act]', function (e) {\r\n\t\t\t\tvar act = $(this).attr('data-act');\r\n\t\t\t\tvar $btn = $(this);\r\n\t\t\t\tswitch(act) {\r\n\t\t\t\t\tcase 'edit':\r\n\t\t\t\t\t\tself.editAccount($btn);\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 'queryShops':\r\n\t\t\t\t\t\tself.queryShops();\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 'delete':\r\n\t\t\t\t\t\tself.deleteAccount();\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\t\r\n\t\t\tself.on({\r\n\t\t\t\t'updateSettleBalance' : function (mAccount) {\r\n\t\t\t\t\tvar settleUnitID = mAccount.get('settleUnitID'),\r\n\t\t\t\t\t\tsettleBalance = Hualala.Common.Math.prettyNumeric(mAccount.get('settleBalance'));\r\n\t\t\t\t\tself.$container.find('[data-id=' + settleUnitID + '] .cash > strong').html(settleBalance);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t},\r\n\t\teditAccount : function ($trigger) {\r\n\t\t\t// triggerEl, mode, model, parentView\r\n\t\t\tvar editAccount = new AccountEditView({\r\n\t\t\t\ttriggerEl : $trigger,\r\n\t\t\t\tmode : 'edit',\r\n\t\t\t\tmodel : this.model,\r\n\t\t\t\tparentView : this\r\n\t\t\t});\r\n\t\t},\r\n\t\twithdraw : function ($trigger) {\r\n\t\t\tvar self = this;\r\n\t\t\t// 提现操作\r\n\t\t\tvar modal = new Hualala.Account.WithdrawCashView({\r\n\t\t\t\ttriggerEl : $trigger,\r\n\t\t\t\tsettleUnitID : self.model.get('settleUnitID'),\r\n\t\t\t\tmodel : self.model,\r\n\t\t\t\tparentView : self\r\n\t\t\t});\r\n\t\t},\r\n\t\tqueryShops : function ($trigger) {\r\n\t\t\tvar self = this;\r\n\t\t\tvar modal = new Hualala.Account.AccountQueryShopModal({\r\n\t\t\t\ttriggerEl : $trigger,\r\n\t\t\t\tsettleUnitID : self.model.get('settleUnitID'),\r\n\t\t\t\tmodel : self.model,\r\n\t\t\t\tparentView : self\r\n\t\t\t});\r\n\t\t},\r\n\t\tdeleteAccount : function () {\r\n\t\t\tvar self = this;\r\n\t\t\tHualala.UI.Confirm({\r\n\t\t\t\ttitle : '删除结算账户',\r\n\t\t\t\tmsg : '是否删除该账户？',\r\n\t\t\t\tokLabel : '删除',\r\n\t\t\t\tokFn : function () {\r\n\t\t\t\t\tself.model.emit('delete', {\r\n\t\t\t\t\t\tsuccessFn : function (settleUnitID) {\r\n\t\t\t\t\t\t\tdocument.location.href = Hualala.PageRoute.createPath('account', [settleUnitID]);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\t\r\n\t\t},\r\n\t\tmapRenderData : function () {\r\n\t\t\tvar self = this,\r\n\t\t\t\tmodel = self.model,\r\n\t\t\t\tacts = AccountActs,\r\n\t\t\t\tacts1 = _.filter(IX.clone(acts), function (el) {\r\n\t\t\t\t\treturn $XP(el, 'act') != 'withdraw';\r\n\t\t\t\t}),\r\n\t\t\t\taccountCard = null;\r\n\t\t\tvar settleUnitID = model.get('settleUnitID') || '',\r\n\t\t\t\thasDefault = model.get('defaultAccount') == 0 ? false : true,\r\n\t\t\t\tbankInfo = Hualala.Common.mapBankInfo(model.get('bankCode')),\r\n\t\t\t\tbankAccountStr = Hualala.Common.codeMask((model.get('bankAccount') || ''), 0, -4),\r\n\t\t\t\tsettleBalance = parseFloat(model.get('settleBalance') || 0),\r\n\t\t\t\tdisableWithdraw = settleBalance <= 0 ? 'disabled' : '';\r\n\r\n\t\t\taccountCard = {\r\n\t\t\t\tclz : 'pull-left',\r\n\t\t\t\tsettleUnitID : settleUnitID,\r\n\t\t\t\thasDefault : hasDefault,\r\n\t\t\t\tsettleUnitName : model.get('settleUnitName') || '',\r\n\t\t\t\tdisableWithdraw : disableWithdraw,\r\n\t\t\t\tsettleBalance : settleBalance,\r\n\t\t\t\tbankIcon : $XP(bankInfo, 'icon_16', ''),\r\n\t\t\t\tbankComName : $XP(bankInfo, 'name', ''),\r\n\t\t\t\tbankAccountStr : $XP(bankAccountStr, 'val', '').replace(/([\\w|*]{4})/g, '$1 ').replace(/([*])/g, '<span>$1</span>'),\r\n\t\t\t\tshopCount : parseInt(model.get('shopCount') || 0),\r\n\t\t\t\tpath : Hualala.PageRoute.createPath('accountDetail', [settleUnitID]),\r\n\t\t\t\tisDetail : true,\r\n\t\t\t\tacts : IX.map(acts1, function (el, i) {\r\n\t\t\t\t\treturn IX.inherit(el, {\r\n\t\t\t\t\t\tisFirst : i == 0 ? true : false\r\n\t\t\t\t\t});\r\n\t\t\t\t})\r\n\t\t\t};\r\n\t\t\treturn {\r\n\t\t\t\taccountCard : accountCard,\r\n\t\t\t\tacts : _.map(acts, function (el) {\r\n\t\t\t\t\tif ($XP(el, 'act') == 'queryShops') {\r\n\t\t\t\t\t\treturn IX.inherit(el, {\r\n\t\t\t\t\t\t\tlabel : $XP(el, 'label', '') + '(' + parseInt(model.get('shopCount') || 0) + ')'\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t} else if ($XP(el, 'act') == 'withdraw') {\r\n\t\t\t\t\t\treturn IX.inherit(el, {\r\n\t\t\t\t\t\t\tdisableWithdraw : disableWithdraw\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn el;\r\n\t\t\t\t})\r\n\t\t\t};\r\n\t\t},\r\n\t\trender : function () {\r\n\t\t\tvar self = this,\r\n\t\t\t\tmodel = self.model,\r\n\t\t\t\trenderData = self.mapRenderData(),\r\n\t\t\t\ttpl = self.get('schemaTpl');\r\n\t\t\tvar htm = tpl(renderData);\r\n\t\t\tself.initBreadCrumbs();\r\n\t\t\tself.$schema.html(htm);\r\n\t\t},\r\n\t\trefresh : function () {\r\n\t\t\tthis.render();\r\n\t\t}\r\n\t});\r\n\t\r\n\tHualala.Account.AccountMgrView = AccountMgrView; \r\n\r\n\r\n\t// 结算账户表单配置\r\n\tvar AccountEditFormElsCfg = {\r\n\t\treceiverType : {\r\n\t\t\ttype : \"radiogrp\",\r\n\t\t\tlabel : \"收款方类型\",\r\n\t\t\tdefaultVal : 2,\r\n\t\t\toptions : Hualala.TypeDef.AccountReceiverTypes,\r\n\t\t\tvalidCfg : {\r\n\t\t\t\tvalidators : {}\r\n\t\t\t}\r\n\t\t},\r\n\t\treceiverName : {\r\n\t\t\ttype : \"text\",\r\n\t\t\tlabel : \"收款单位/姓名\",\r\n\t\t\tdefaultVal : \"\",\r\n\t\t\tvalidCfg : {\r\n\t\t\t\tvalidators : {\r\n\t\t\t\t\tnotEmpty : {\r\n\t\t\t\t\t\tmessage : \"请输入收款单位/姓名\"\r\n\t\t\t\t\t},\r\n\t\t\t\t\tstringLength : {\r\n\t\t\t\t\t\tmax : 20,\r\n\t\t\t\t\t\tmessage : \"收款单位/姓名不能超过20个字\"\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\tsettleUnitName : {\r\n\t\t\ttype : \"text\",\r\n\t\t\tlabel : \"结算账户名称\",\r\n\t\t\tdefaultVal : \"\",\r\n\t\t\tvalidCfg : {\r\n\t\t\t\tvalidators : {\r\n\t\t\t\t\tnotEmpty : {\r\n\t\t\t\t\t\tmessage : \"请输入结算账户名称\"\r\n\t\t\t\t\t},\r\n\t\t\t\t\tstringLength : {\r\n\t\t\t\t\t\tmax : 50,\r\n\t\t\t\t\t\tmessage : \"结算账户名称不能超过50个字\"\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\tbankAccount : {\r\n\t\t\ttype : \"text\",\r\n\t\t\tlabel : \"转账账号\",\r\n\t\t\tdefaultVal : \"\",\r\n\t\t\tvalidCfg : {\r\n\t\t\t\tvalidators : {\r\n\t\t\t\t\tnotEmpty : {\r\n\t\t\t\t\t\tmessage : \"请输入转账账号\"\r\n\t\t\t\t\t},\r\n\t\t\t\t\tstringLength : {\r\n\t\t\t\t\t\tmax : 30,\r\n\t\t\t\t\t\tmessage : \"转账账号不能超过30个字\"\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\tbankCode : {\r\n\t\t\ttype : \"combo\",\r\n\t\t\tlabel : \"转账银行\",\r\n\t\t\tdefaultVal : \"CMB\",\r\n\t\t\toptions : Hualala.TypeDef.BankOptions,\r\n\t\t\tvalidCfg : {\r\n\t\t\t\tvalidators : {\r\n\t\t\t\t\tnotEmpty : {\r\n\t\t\t\t\t\tmessage : \"请选择转账银行\"\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\tbankName : {\r\n\t\t\ttype : \"text\",\r\n\t\t\tlabel : \"转账分行\",\r\n\t\t\tdefaultVal : \"\",\r\n\t\t\tprefix : '<span class=\"bank-name-icon icon-CMB-16\"></span>',\r\n\t\t\tvalidCfg : {\r\n\t\t\t\tvalidators : {\r\n\t\t\t\t\tnotEmpty : {\r\n\t\t\t\t\t\tmessage : \"请输入转账分行名称\"\r\n\t\t\t\t\t},\r\n\t\t\t\t\tstringLength : {\r\n\t\t\t\t\t\tmax : 40,\r\n\t\t\t\t\t\tmessage : \"转账分行不能超过40个字\"\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\tremark : {\r\n\t\t\ttype : \"text\",\r\n\t\t\tlabel : \"备注\",\r\n\t\t\tdefaultVal : \"\",\r\n\t\t\tvalidCfg : {\r\n\t\t\t\tvalidators : {\r\n\t\t\t\t\tstringLength : {\r\n\t\t\t\t\t\tmax : 250,\r\n\t\t\t\t\t\tmessage : \"备注不能超过250个字\"\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\tdefaultAccount : {\r\n\t\t\ttype : \"switcher\",\r\n\t\t\tlabel : \"默认账户\",\r\n\t\t\tdefaultVal : 1,\r\n\t\t\tonLabel : \"开启\",\r\n\t\t\toffLabel : \"关闭\",\r\n\t\t\tvalidCfg : {\r\n\t\t\t\tvalidators : {}\r\n\t\t\t}\r\n\t\t},\r\n\t\treceiverLinkman : {\r\n\t\t\ttype : \"text\",\r\n\t\t\tlabel : \"姓名\",\r\n\t\t\tdefaultVal : \"\",\r\n\t\t\tprefix : '<span class=\"glyphicon glyphicon-user\"></span>',\r\n\t\t\tvalidCfg : {\r\n\t\t\t\tvalidators : {\r\n\t\t\t\t\tnotEmpty : {\r\n\t\t\t\t\t\tmessage : \"请输入姓名\"\r\n\t\t\t\t\t},\r\n\t\t\t\t\tstringLength : {\r\n\t\t\t\t\t\tmax : 20,\r\n\t\t\t\t\t\tmessage : \"姓名不能超过20个字\"\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\treceiverMobile : {\r\n\t\t\ttype : \"text\",\r\n\t\t\tlabel : \"手机\",\r\n\t\t\tdefaultVal : \"\",\r\n\t\t\tprefix : '<span class=\"glyphicon glyphicon-phone\"></span>',\r\n\t\t\tvalidCfg : {\r\n\t\t\t\tvalidators : {\r\n\t\t\t\t\tnotEmpty : {\r\n\t\t\t\t\t\tmessage : \"请输入手机号\"\r\n\t\t\t\t\t},\r\n\t\t\t\t\tstringLength : {\r\n\t\t\t\t\t\tmax : 30,\r\n\t\t\t\t\t\tmessage : \"手机不能超过30个字\"\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\treceiverEmail : {\r\n\t\t\ttype : \"text\",\r\n\t\t\tlabel : \"邮箱\",\r\n\t\t\tdefaultVal : \"\",\r\n\t\t\tprefix : '<span class=\"glyphicon glyphicon-envelope\"></span>',\r\n\t\t\tvalidCfg : {\r\n\t\t\t\tvalidators : {\r\n\t\t\t\t\tstringLength : {\r\n\t\t\t\t\t\tmax : 50,\r\n\t\t\t\t\t\tmessage : \"邮箱不能超过30个字\"\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n\tvar AccountEditFormElsHT = new IX.IListManager();\r\n\t_.each(AccountEditFormElsCfg, function (el, k) {\r\n\t\tvar type = $XP(el, 'type');\r\n\t\tvar labelClz = 'col-sm-offset-1 col-sm-3 control-label';\r\n\t\tif (type == 'radiogrp') {\r\n\t\t\tvar ops = _.map($XP(el, 'options'), function (op) {\r\n\t\t\t\treturn IX.inherit(op, {\r\n\t\t\t\t\tid : k + '_' + IX.id(),\r\n\t\t\t\t\tname : k,\r\n\t\t\t\t\tclz : 'col-sm-6'\r\n\t\t\t\t});\r\n\t\t\t});\r\n\t\t\tAccountEditFormElsHT.register(k, IX.inherit(el, {\r\n\t\t\t\tid : '',\r\n\t\t\t\toptions : ops,\r\n\t\t\t\tlabelClz : labelClz,\r\n\t\t\t\tclz : 'col-sm-5'\r\n\t\t\t}));\r\n\t\t} else {\r\n\t\t\tAccountEditFormElsHT.register(k, IX.inherit(el, {\r\n\t\t\t\tid : k + '_' + IX.id(),\r\n\t\t\t\tname : k,\r\n\t\t\t\tlabelClz : labelClz,\r\n\t\t\t\tclz : 'col-sm-5'\r\n\t\t\t}));\r\n\t\t}\r\n\t\t\r\n\t});\r\n\t\r\n\t// 结算账户编辑窗口\r\n\tvar AccountEditView = Stapes.subclass({\r\n\t\t/**\r\n\t\t * 结算账户编辑窗口构造器\r\n\t\t * @param  {Object} cfg {triggerEl, mode, model, parentView}\r\n\t\t * \t\t\t\t@param {jQueryObj} triggerEl 出发元素\r\n\t\t * \t\t\t\t@param {String} mode  操作模式add:添加账户模式；edit:编辑模式; read:只读模式\r\n\t\t * \t\t\t\t@param {Object} model 结算账户数据模型\r\n\t\t * \t\t\t\t@param {Object} parentView 父级View层\r\n\t\t * @return {Object}\t\t账户编辑实例\r\n\t\t */\r\n\t\tconstructor : function (cfg) {\r\n\t\t\tthis.$trigger = $XP(cfg, 'trigger', null);\r\n\t\t\tthis.mode = $XP(cfg, 'mode', 'edit');\r\n\t\t\tthis.model = $XP(cfg, 'model', null) || new Hualala.Account.BaseAccountModel();\r\n\t\t\tthis.parentView = $XP(cfg, 'parentView', null);\r\n\t\t\tthis.modal = null;\r\n\t\t\tthis.formKeys = 'settleUnitName,receiverType,receiverName,bankAccount,bankCode,bankName,remark,defaultAccount,receiverLinkman,receiverMobile,receiverEmail'.split(',');\r\n\t\t\tthis.loadTemplates();\r\n\t\t\tthis.initModal();\r\n\t\t\tthis.renderForm();\r\n\t\t\tthis.bindEvent();\r\n\t\t\tthis.resetBankCode();\r\n\t\t\tthis.emit('show');\r\n\t\t}\r\n\t});\r\n\tAccountEditView.proto({\r\n\t\tloadTemplates : function () {\r\n\t\t\tvar layoutTpl = Handlebars.compile(Hualala.TplLib.get('tpl_account_edit')),\r\n\t\t\t\tbtnTpl = Handlebars.compile(Hualala.TplLib.get('tpl_shop_modal_btns'));\r\n\t\t\tHandlebars.registerHelper('checkFormElementType', function (conditional, options) {\r\n\t\t\t\treturn (conditional == options.hash.type) ? options.fn(this) : options.inverse(this);\r\n\t\t\t});\r\n\t\t\tHandlebars.registerHelper('isInputGroup', function (prefix, surfix, options) {\r\n\t\t\t\treturn (!prefix && !surfix) ? options.inverse(this) : options.fn(this);\r\n\t\t\t});\r\n\t\t\tthis.set({\r\n\t\t\t\tlayoutTpl : layoutTpl,\r\n\t\t\t\tbtnTpl : btnTpl\r\n\t\t\t});\r\n\t\t},\r\n\t\tgetModalTitle : function () {\r\n\t\t\treturn (this.mode == 'edit' ?  '修改' : '增加') + '结算账户';\r\n\t\t},\r\n\t\tinitModal : function () {\r\n\t\t\tvar self = this;\r\n\t\t\tself.modal = new Hualala.UI.ModalDialog({\r\n\t\t\t\tid : 'account_edit',\r\n\t\t\t\tclz : 'account-modal',\r\n\t\t\t\ttitle : self.getModalTitle(),\r\n\t\t\t\tafterRemove : function () {\r\n\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t},\r\n\t\tmapFormElsData : function () {\r\n\t\t\tvar self = this,\r\n\t\t\t\tformKeys = self.formKeys;\r\n\t\t\tvar formEls = _.map(formKeys, function (key) {\r\n\t\t\t\tvar elCfg = AccountEditFormElsHT.get(key),\r\n\t\t\t\t\ttype = $XP(elCfg, 'type');\r\n\t\t\t\tif (type == 'combo') {\r\n\t\t\t\t\tvar v = self.model.get(key) || $XP(elCfg, 'defaultVal'),\r\n\t\t\t\t\t\toptions = _.map($XP(elCfg, 'options'), function (op) {\r\n\t\t\t\t\t\t\treturn IX.inherit(op, {\r\n\t\t\t\t\t\t\t\tselected : $XP(op, 'value') == v ? 'selected' : ''\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\treturn IX.inherit(elCfg, {\r\n\t\t\t\t\t\tvalue : v,\r\n\t\t\t\t\t\toptions : options\r\n\t\t\t\t\t});\r\n\t\t\t\t} else if (type == 'radiogrp') {\r\n\t\t\t\t\tvar v = self.model.get(key) || $XP(elCfg, 'defaultVal'),\r\n\t\t\t\t\t\toptions = _.map($XP(elCfg, 'options'), function (op) {\r\n\t\t\t\t\t\t\treturn IX.inherit(op, {\r\n\t\t\t\t\t\t\t\tchecked : $XP(op, 'value') == v ? 'checked' : ''\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\treturn IX.inherit(elCfg, {\r\n\t\t\t\t\t\tvalue : v,\r\n\t\t\t\t\t\toptions : options\r\n\t\t\t\t\t});\r\n\t\t\t\t} else if (type == 'switcher') {\r\n\t\t\t\t\treturn IX.inherit(elCfg, {\r\n\t\t\t\t\t\tchecked : self.model.get(key) == $XP(elCfg, 'defaultVal') ? 'checked' : ''\r\n\t\t\t\t\t});\r\n\t\t\t\t} else {\r\n\t\t\t\t\treturn IX.inherit(elCfg, {\r\n\t\t\t\t\t\tvalue : self.model.get(key) || $XP(elCfg, 'defaultVal')\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\treturn formEls;\r\n\t\t},\r\n\t\trenderForm : function () {\r\n\t\t\tvar self = this,\r\n\t\t\t\trenderData = self.mapFormElsData(),\r\n\t\t\t\ttpl = self.get('layoutTpl'),\r\n\t\t\t\tbtnTpl = self.get('btnTpl'),\r\n\t\t\t\thtm = tpl({\r\n\t\t\t\t\tformClz : 'account-form form-feedback-out',\r\n\t\t\t\t\titems : renderData\r\n\t\t\t\t});\r\n\t\t\tself.modal._.body.html(htm);\r\n\t\t\tself.modal._.footer.html(btnTpl({\r\n\t\t\t\tbtns : [\r\n\t\t\t\t\t{clz : 'btn-default', name : 'cancel', label : '取消'},\r\n\t\t\t\t\t{clz : 'btn-warning', name : 'submit', label : self.mode == 'edit' ? '保存' : '添加'}\r\n\t\t\t\t]\r\n\t\t\t}));\r\n\r\n\t\t\tself.initSwitcher(':checkbox[data-type=switcher]');\r\n\t\t},\r\n\t\tinitValidFieldOpts : function () {\r\n\t\t\tvar self = this,\r\n\t\t\t\tformKeys = self.formKeys,\r\n\t\t\t\tret = {};\r\n\t\t\t_.each(formKeys, function (key) {\r\n\t\t\t\tvar elCfg = AccountEditFormElsHT.get(key),\r\n\t\t\t\t\ttype = $XP(elCfg, 'type');\r\n\t\t\t\tif (type == 'section') {\r\n\t\t\t\t\tvar min = key + '_min', max = key + '_max';\r\n\t\t\t\t\tret[min] = $XP(elCfg, 'min.validCfg', {});\r\n\t\t\t\t\tret[max] = $XP(elCfg, 'max.validCfg', {});\r\n\t\t\t\t} else {\r\n\t\t\t\t\tret[key] = $XP(elCfg, 'validCfg', {});\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\treturn ret;\r\n\t\t},\r\n\t\tbindEvent : function () {\r\n\t\t\tvar self = this;\r\n\t\t\tvar fvOpts = self.initValidFieldOpts();\r\n\t\t\tthis.on({\r\n\t\t\t\tshow : function () {\r\n\t\t\t\t\tthis.modal.show();\r\n\t\t\t\t},\r\n\t\t\t\thide : function () {\r\n\t\t\t\t\tthis.modal.hide();\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\tself.modal._.dialog.find('.btn').on('click', function (e) {\r\n\t\t\t\tvar $btn = $(this),\r\n\t\t\t\t\tact = $btn.attr('name');\r\n\t\t\t\tif (act == 'cancel') {\r\n\t\t\t\t\tself.emit('hide');\r\n\t\t\t\t} else {\r\n\t\t\t\t\tvar bv = self.modal._.body.find('form').data('bootstrapValidator');\r\n\t\t\t\t\t$btn.button('提交中...');\r\n\t\t\t\t\tbv.validate();\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\tself.modal._.body.find('form [name=bankCode]').on('change', function (e) {\r\n\t\t\t\tvar $combo = $(this),\r\n\t\t\t\t\t$bankNameIcon = self.modal._.body.find('form .bank-name-icon'),\r\n\t\t\t\t\tval = $combo.val();\r\n\t\t\t\t$bankNameIcon.trigger('change', val);\r\n\t\t\t});\r\n\t\t\tself.modal._.body.find('form .bank-name-icon').on('change', function (e, v) {\r\n\t\t\t\tvar $bankNameIcon = $(this);\r\n\t\t\t\tvar bankInfo = Hualala.Common.mapBankInfo(v);\r\n\t\t\t\tIX.Debug.info(\"DEBUG: Account Bank Info : \");\r\n\t\t\t\tIX.Debug.info(bankInfo);\r\n\t\t\t\t$bankNameIcon.removeClass().addClass('bank-name-icon ' + $XP(bankInfo, 'icon_16', ''));\r\n\t\t\t});\r\n\t\t\tself.modal._.body.find('form').bootstrapValidator({\r\n\t\t\t\ttrigger : 'blur',\r\n\t\t\t\tfields : fvOpts\r\n\t\t\t}).on('error.field.bv', function (e, data) {\r\n\t\t\t\tvar $form = $(e.target),\r\n\t\t\t\t\tbv = $form.data('bootstrapValidator');\r\n\t\t\t}).on('success.form.bv', function (e, data) {\r\n\t\t\t\te.preventDefault();\r\n\t\t\t\tvar $form = $(e.target),\r\n\t\t\t\t\tbv = $form.data('bootstrapValidator');\r\n\t\t\t\tvar formParams = self.serializeForm();\r\n\t\t\t\tIX.Debug.info(\"DEBUG: Account Edit View Form Params : \");\r\n\t\t\t\tIX.Debug.info(formParams);\r\n\t\t\t\tself.model.emit(self.mode, {\r\n\t\t\t\t\tparams : formParams,\r\n\t\t\t\t\tfailFn : function () {\r\n\t\t\t\t\t\tself.modal._.footer.find('.btn[name=submit]').button('reset');\r\n\t\t\t\t\t},\r\n\t\t\t\t\tsuccessFn : function () {\r\n\t\t\t\t\t\tself.modal._.footer.find('.btn[name=submit]').button('reset');\r\n\t\t\t\t\t\tself.parentView && IX.isFn(self.parentView.refresh) && self.parentView.refresh();\r\n\t\t\t\t\t\tself.emit('hide');\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t});\r\n\t\t},\r\n\t\tresetBankCode : function () {\r\n\t\t\tvar self = this;\r\n\t\t\tvar bankCode = self.modal._.body.find('form [name=bankCode]').val();\r\n\t\t\tself.modal._.body.find('form .bank-name-icon').trigger('change', bankCode);\r\n\t\t},\r\n\t\tinitSwitcher : function (selector) {\r\n\t\t\tvar self = this;\r\n\t\t\tself.modal._.body.find(selector).each(function () {\r\n\t\t\t\tvar $el = $(this),\r\n\t\t\t\t\tonLabel = $el.attr('data-onLabel'),\r\n\t\t\t\t\toffLabel = $el.attr('data-offLabel');\r\n\t\t\t\t$el.bootstrapSwitch({\r\n\t\t\t\t\tsize : 'normal',\r\n\t\t\t\t\tonColor : 'primary',\r\n\t\t\t\t\toffColor : 'default',\r\n\t\t\t\t\tonText : onLabel,\r\n\t\t\t\t\toffText : offLabel\r\n\t\t\t\t});\r\n\t\t\t});\r\n\t\t},\r\n\t\tserializeForm : function () {\r\n\t\t\tvar self = this,\r\n\t\t\t\tformKeys = self.formKeys,\r\n\t\t\t\tret = {},\r\n\t\t\t\tformEls = _.map(formKeys, function (key) {\r\n\t\t\t\t\tvar elCfg = AccountEditFormElsHT.get(key),\r\n\t\t\t\t\t\ttype = $XP(elCfg, 'type');\r\n\t\t\t\t\tif (type == 'switcher') {\r\n\t\t\t\t\t\t// ret[key] = $('[name=' + key + ']').attr('checked') ? 1 : 0;\r\n\t\t\t\t\t\tret[key] = !$('[name=' + key + ']').data('bootstrapSwitch').options.state ? 0 : 1;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tret[key] = $('[name=' + key + ']').val();\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\treturn ret;\r\n\t\t}\r\n\t});\r\n\r\n\tHualala.Account.AccountEditView = AccountEditView;\r\n\r\n\tvar AccountQueryShopModal = Stapes.subclass({\r\n\t\tconstructor : function (cfg) {\r\n\t\t\tthis.$trigger = $XP(cfg, 'trigger', null);\r\n\t\t\tthis.model = $XP(cfg, 'model', null);\r\n\t\t\tthis.parentView = $XP(cfg, 'parentView', null);\r\n\t\t\tthis.modal = null;\r\n\t\t\tthis.$queryBox = null;\r\n\t\t\tthis.$resultBox = null;\r\n\t\t\tthis.queryCtrl = null;\r\n\t\t\tthis.set({\r\n\t\t\t\tsettleUnitID : this.model.get('settleUnitID'),\r\n\t\t\t\tsettleName : this.model.get('settleUnitName'),\r\n\t\t\t\tshopCount : this.model.get('shopCount'),\r\n\t\t\t});\r\n\r\n\t\t\tthis.loadTemplates();\r\n\t\t\tthis.initModal();\r\n\t\t\tthis.render();\r\n\t\t\tthis.bindEvent();\r\n\t\t\tthis.initQueryBox();\r\n\t\t\tthis.emit('show');\r\n\t\t}\r\n\t});\r\n\tAccountQueryShopModal.proto({\r\n\t\tloadTemplates : function () {\r\n\t\t\tvar layoutTpl = Handlebars.compile(Hualala.TplLib.get('tpl_account_query_shop')),\r\n\t\t\t\tbtnTpl = Handlebars.compile(Hualala.TplLib.get('tpl_shop_modal_btns'));\r\n\t\t\t\r\n\t\t\tthis.set({\r\n\t\t\t\tlayoutTpl : layoutTpl,\r\n\t\t\t\tbtnTpl : btnTpl\r\n\t\t\t});\r\n\t\t},\r\n\t\tinitModal : function () {\r\n\t\t\tvar self = this;\r\n\t\t\tself.modal = new Hualala.UI.ModalDialog({\r\n\t\t\t\tid : 'account_query_shop',\r\n\t\t\t\tclz : 'account-modal',\r\n\t\t\t\ttitle : \"结算账户关联店铺\",\r\n\t\t\t\tafterRemove : function () {\r\n\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t},\r\n\t\trender : function () {\r\n\t\t\tvar self = this,\r\n\t\t\t\tlayoutTpl = self.get('layoutTpl'),\r\n\t\t\t\tbtnTpl = self.get('btnTpl');\r\n\t\t\tvar settleUnitName = self.model.get('settleUnitName') || '',\r\n\t\t\t\tbtns = [{clz : 'btn-default', name : 'cancel', label : '关闭'}];\r\n\t\t\tvar htm = layoutTpl({\r\n\t\t\t\tclz : '',\r\n\t\t\t\ttitle : settleUnitName,\r\n\t\t\t\tlabel : \"结算账户名称\"\r\n\t\t\t});\r\n\t\t\tself.modal._.body.html(htm);\r\n\t\t\tself.modal._.footer.html(btnTpl({\r\n\t\t\t\tbtns : btns\r\n\t\t\t}));\r\n\t\t\tself.$queryBox = self.modal._.body.find('.query-box');\r\n\t\t\tself.$resultBox = self.modal._.body.find('.result-box');\r\n\t\t},\r\n\t\tbindEvent : function () {\r\n\t\t\tvar self = this;\r\n\t\t\tthis.on({\r\n\t\t\t\t\"show\" : function () {\r\n\t\t\t\t\tself.modal.show();\r\n\t\t\t\t},\r\n\t\t\t\t\"hide\" : function () {\r\n\t\t\t\t\tself.modal.hide();\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\tself.modal._.dialog.find('.btn').on('click', function (e) {\r\n\t\t\t\tvar $btn = $(this),\r\n\t\t\t\t\tact = $btn.attr('name');\r\n\t\t\t\tif (act == 'cancel') {\r\n\t\t\t\t\tself.emit('hide');\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t},\r\n\t\tinitQueryBox : function () {\r\n\t\t\tvar self = this;\r\n\t\t\tself.queryCtrl = new Hualala.Account.AccountQueryShopController({\r\n\t\t\t\tcontainer : self.$queryBox,\r\n\t\t\t\tresultContainer : self.$resultBox,\r\n\t\t\t\tsettleUnitID : self.get('settleUnitID'),\r\n\t\t\t\tsettleName : self.get('settleName'),\r\n\t\t\t\tshopCount : self.get('shopCount')\r\n\t\t\t\t// resultController : new Hualala.Account.AccountQueryShopResultController({\r\n\t\t\t\t// \tcontainer : self.$resultBox,\r\n\t\t\t\t// \tmodel : new Hualala.Account.AccountQueryShopResultModel(),\r\n\t\t\t\t// \tview : new Hualala.Account.AccountQueryShopResultView()\r\n\t\t\t\t// })\r\n\t\t\t});\r\n\t\t}\r\n\t});\r\n\tHualala.Account.AccountQueryShopModal = AccountQueryShopModal;\r\n\r\n\t// 结算账户交易明细\r\n\tvar PersonUnit = Hualala.Constants.PersonUnit,\r\n\t\tCashUnit = Hualala.Constants.CashUnit;\r\n\tvar getOrderSubTypeLabel = function (orderSubType) {\r\n\t\tif (IX.isEmpty(orderSubType)) return '';\r\n\t\tvar l = Hualala.TypeDef.ShopBusiness;\r\n\t\tvar m = _.find(l, function (el) {\r\n\t\t\tvar id = $XP(el, 'id');\r\n\t\t\treturn id == orderSubType;\r\n\t\t});\r\n\t\tif (!m) return '';\r\n\t\treturn $XP(m, 'label', '');\r\n\t};\r\n\tvar getGenderLabel = function (v) {\r\n\t\tif (IX.isEmpty(v)) return '';\r\n\t\tvar l = Hualala.TypeDef.GENDER;\r\n\t\tvar m = _.find(l, function (el) {\r\n\t\t\tvar id = $XP(el, 'value');\r\n\t\t\treturn id == v;\r\n\t\t});\r\n\t\tif (!m) return '';\r\n\t\treturn $XP(m, 'label', '');\r\n\t};\r\n\tvar mapUserFields = function (cfg, data) {\r\n\t\tvar label = $XP(cfg, 'label', ''), fieldType = $XP(cfg, 'fieldType', ''), fields = $XP(cfg, 'fields', []);\r\n\t\tvar userSex = $XP(data, 'userSex', '');\r\n\t\tuserSex = IX.isEmpty(userSex) ? '' : '(' + getGenderLabel(userSex) + ')';\r\n\t\tvar _fields = _.map(fields, function (key) {\r\n\t\t\tvar fieldLabelCfg = OrderPayFieldLabelLib[key], label = $XP(fieldLabelCfg, 'label', ''),\r\n\t\t\t\tunit = $XP(fieldLabelCfg, 'unit', ''), clz = $XP(fieldLabelCfg, 'clz', '');\r\n\t\t\tvar value = $XP(data, key, '');\r\n\t\t\tvalue += (key == 'userName') ? userSex : '';\r\n\t\t\tvalue += unit;\r\n\t\t\treturn {\r\n\t\t\t\tkey : key,\r\n\t\t\t\tclz : clz,\r\n\t\t\t\tlabel : label,\r\n\t\t\t\tvalue : value\r\n\t\t\t};\r\n\t\t});\r\n\t\treturn {\r\n\t\t\tlabel : label,\r\n\t\t\tfieldType : fieldType,\r\n\t\t\tfields : _fields\r\n\t\t};\r\n\t};\r\n\tvar mapOrderFields = function (cfg, data) {\r\n\t\tvar label = $XP(cfg, 'label', ''), fieldType = $XP(cfg, 'fieldType', ''), fields = $XP(cfg, 'fields', []);\r\n\t\tvar orderSubType = $XP(data, 'orderSubType', ''),\r\n\t\t\torderSubTypeLabel = getOrderSubTypeLabel(orderSubType);\r\n\t\torderSubTypeLabel = IX.isEmpty(orderSubTypeLabel) ? '' : '(' + orderSubTypeLabel + ')';\r\n\t\tvar _fields = _.map(fields, function (key) {\r\n\t\t\tvar fieldLabelCfg = OrderPayFieldLabelLib[key], label = $XP(fieldLabelCfg, 'label', ''),\r\n\t\t\t\tunit = $XP(fieldLabelCfg, 'unit', ''), clz = $XP(fieldLabelCfg, 'clz', '');\r\n\t\t\tvar value = $XP(data, key, '');\r\n\t\t\tswitch(key) {\r\n\t\t\t\tcase 'timeName':\r\n\t\t\t\tcase 'consumptionTypeName' :\r\n\t\t\t\tcase 'promotionDesc' :\r\n\t\t\t\tcase 'orderRemark':\r\n\t\t\t\t\tclz += IX.isEmpty(value) ? ' hidden' : '';\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'orderTime':\r\n\t\t\t\tcase 'orderCreateTime':\r\n\t\t\t\t\tvalue = IX.Date.getDateByFormat(Hualala.Common.formatDateTimeValue(value), 'yyyy/MM/dd HH:mm');\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'statusName':\r\n\t\t\t\t\tvar isAlreadyPaid = $XP(data, 'isAlreadyPaid', 0),\r\n\t\t\t\t\t\torderStatus = $XP(data, 'orderStatus', '');\r\n\t\t\t\t\tvar surfix = '';\r\n\t\t\t\t\tif (orderStatus >= 20 && isAlreadyPaid == 1) {\r\n\t\t\t\t\t\tsurfix = \"<span>线上付款</span>\";\r\n\t\t\t\t\t} else if (orderStatus >= 20 && isAlreadyPaid == 0) {\r\n\t\t\t\t\t\tsurfix = '<span color=\"red\">' + (orderStatus == 20 ? \"餐到付款\" : \"到店付款\") + \"</span>\";\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tsurfix = \"<span>未付款</span>\";\r\n\t\t\t\t\t}\r\n\t\t\t\t\tsurfix = '(' + surfix + ')';\r\n\t\t\t\t\tvalue = value + surfix;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'takeoutAddress' :\r\n\t\t\t\t\tclz += orderSubType == 20 || orderSubType == 21 ? '' : ' hidden';\r\n\t\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t\tvalue += unit;\r\n\t\t\treturn {\r\n\t\t\t\tkey : key,\r\n\t\t\t\tclz : clz,\r\n\t\t\t\tlabel : label,\r\n\t\t\t\tvalue : value\r\n\t\t\t};\r\n\t\t});\r\n\t\treturn {\r\n\t\t\tlabel : label,\r\n\t\t\torderSubTypeLabel : orderSubTypeLabel,\r\n\t\t\tfieldType : fieldType,\r\n\t\t\tfields : _fields\r\n\t\t};\r\n\t};\r\n\tvar mapPayFields = function (cfg, data) {\r\n\t\tvar label = $XP(cfg, 'label', ''), fieldType = $XP(cfg, 'fieldType', ''), fields = $XP(cfg, 'fields', []);\r\n\t\tvar orderSubType = $XP(data, 'orderSubType', '');\r\n\t\tvar _fields = _.map(fields, function (key) {\r\n\t\t\tvar fieldLabelCfg = OrderPayFieldLabelLib[key], label = $XP(fieldLabelCfg, 'label', ''),\r\n\t\t\t\tunit = $XP(fieldLabelCfg, 'unit', ''), clz = $XP(fieldLabelCfg, 'clz', '');\r\n\t\t\tvar value = $XP(data, key, '');\r\n\t\t\tswitch(key) {\r\n\t\t\t\tcase 'serviceAmount':\r\n\t\t\t\tcase 'discountAmount':\r\n\t\t\t\tcase 'freeAmount':\r\n\t\t\t\tcase 'giftAmount':\r\n\t\t\t\tcase 'cardDiscountAmount':\r\n\t\t\t\tcase 'pointBalance':\r\n\t\t\t\tcase 'moneyBalance':\r\n\t\t\t\tcase 'orderRefundAmount':\r\n\t\t\t\t\tclz += value == 0 ? ' hidden' : '';\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'presentInfo':\r\n\t\t\t\t\tclz += IX.isEmpty(value) ? ' hidden' : '';\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'takeoutPackagingAmount':\r\n\t\t\t\t\tclz += orderSubType == 20 || orderSubType == 21 ? '' : ' hidden';\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t}\r\n\t\t\tvalue += unit;\r\n\t\t\treturn {\r\n\t\t\t\tkey : key,\r\n\t\t\t\tclz : clz,\r\n\t\t\t\tlabel : label,\r\n\t\t\t\tvalue : value\r\n\t\t\t};\r\n\t\t});\r\n\t\treturn {\r\n\t\t\tlabel : label,\r\n\t\t\tfieldType : fieldType,\r\n\t\t\tfields : _fields\r\n\t\t};\r\n\t};\r\n\tvar mapFoodsFields = function (cfg, data) {\r\n\t\tvar label = $XP(cfg, 'label', ''), fieldType = $XP(cfg, 'fieldType', ''), fields = $XP(cfg, 'fields', []);\r\n\t\tvar dishes = $XP(data, 'records', []),\r\n\t\t\tcategories = _.groupBy(dishes, function (dish) {return $XP(dish, 'foodCategoryID');});\r\n\t\tcategories = _.map(categories, function (cate, key) {\r\n\t\t\tvar foodCategoryName = '';\r\n\t\t\tvar foodCategorySum = cate.length;\r\n\t\t\tvar _dishes = _.map(cate, function (dish) {\r\n\t\t\t\tvar _dish = {};\r\n\t\t\t\t_.each(fields, function (k) {\r\n\t\t\t\t\tvar v = $XP(dish, k, ''),\r\n\t\t\t\t\t\tunit = !IX.isEmpty(OrderPayFieldLabelLib[k]) && !IX.isEmpty(OrderPayFieldLabelLib[k]['unit']) ?\r\n\t\t\t\t\t\t\tOrderPayFieldLabelLib[k]['unit'] : '';\r\n\t\t\t\t\tif (k == 'foodCategoryName') {\r\n\t\t\t\t\t\tfoodCategoryName = v;\r\n\t\t\t\t\t}\r\n\t\t\t\t\t\r\n\t\t\t\t\t_dish[k] = v + unit;\r\n\t\t\t\t});\r\n\t\t\t\treturn _dish;\r\n\t\t\t});\r\n\t\t\treturn {\r\n\t\t\t\tfoodCategoryName : foodCategoryName,\r\n\t\t\t\tfoodCategorySum : '(' + foodCategorySum + ')',\r\n\t\t\t\tfoodCategoryID : key,\r\n\t\t\t\trows : _dishes\r\n\t\t\t}\r\n\t\t});\r\n\t\t\r\n\t\treturn {\r\n\t\t\tfieldType : fieldType,\r\n\t\t\tlabel : label,\r\n\t\t\tcategories : categories\r\n\t\t};\r\n\t};\r\n\tvar OrderPayFieldLabelLib = {\r\n\t\t\"userName\" : {label : \"姓名\", clz : \"col-xs-6\"},\r\n\t\t\"userLoginMobile\" : {label : \"手机\", clz : \"col-xs-6\"},\r\n\t\t\"orderID\" : {label : \"订单号\", clz : \"col-xs-6\"},\r\n\t\t\"orderCheckPWD\" : {label : \"消费密码\", clz : \"col-xs-6\"},\r\n\t\t\"person\" : {label : \"人数\", unit : PersonUnit, clz : \"col-xs-6\"},\r\n\t\t\"timeName\" : {label : \"餐段名称\", clz : \"col-xs-6\"},\r\n\t\t\"tableName\" : {label : \"桌台号\", clz : \"col-xs-6\"},\r\n\t\t\"shopOrderKey\" : {label : \"餐饮软件凭证号\", clz : \"col-xs-6\"},\r\n\t\t\"orderTime\" : {label : \"用餐时间\", clz : \"col-xs-12\"},\r\n\t\t\"orderCreateTime\" : {label : \"下单时间\", clz : \"col-xs-12\"},\r\n\t\t\"statusName\" : {label : \"订餐状态\", clz : \"col-xs-12\"},\r\n\t\t\"takeoutAddress\" : {label : \"外送地址\", clz : \"col-xs-6\"},\r\n\t\t\"consumptionTypeName\" : {label : \"用餐类型\", clz : \"col-xs-12\"},\r\n\t\t\"promotionDesc\" : {label : \"店家促销描述\", clz : \"col-xs-12\"},\r\n\t\t\"orderRemark\" : {label : \"订单备注\", clz : \"col-xs-12\"},\r\n\t\t\"foodAmount\" : {label : \"菜品金额\", unit : CashUnit, clz : \"col-xs-6\"},\r\n\t\t\"serviceAmount\" : {label : \"服务费\", unit : CashUnit, clz : \"col-xs-6\"},\r\n\t\t\"paidAmount\" : {label : \"买单前已付金额\", unit : CashUnit, clz : \"col-xs-6\"},\r\n\t\t\"promotionTotalAmount\" : {label : \"餐饮软件优惠金额\", unit : CashUnit, clz : \"col-xs-6\"},\r\n\t\t\"discountAmount\" : {label : \"商家折免\", unit : CashUnit, clz : \"col-xs-6\"},\r\n\t\t\"freeAmount\" : {label : \"商家减免\", unit : CashUnit, clz : \"col-xs-6\"},\r\n\t\t\"giftAmount\" : {label : \"商家代金券金额\", unit : CashUnit, clz : \"col-xs-6\"},\r\n\t\t\"presentInfo\" : {label : \"赠送\", clz : \"col-xs-6\"},\r\n\t\t\"cardDiscountAmount\" : {label : \"会员卡优惠\", unit : CashUnit, clz : \"col-xs-6\"},\r\n\t\t\"pointBalance\" : {label : \"积分抵扣\", unit : CashUnit, clz : \"col-xs-6\"},\r\n\t\t\"moneyBalance\" : {label : \"会员卡余额支付\", unit : CashUnit, clz : \"col-xs-6\"},\r\n\t\t\"takeoutPackagingAmount\" : {label : \"打包费\", unit : CashUnit, clz : \"col-xs-6\"},\r\n\t\t\"orderTotal\" : {label : \"订单金额\", unit : CashUnit, clz : \"col-xs-6\"},\r\n\t\t\"orderRefundAmount\" : {label : \"退款金额\", unit : CashUnit, clz : \"col-xs-6\"},\r\n\t\t\"shopName\" : {label : \"店铺名称\", clz : \"col-xs-6\"},\r\n\t\t\"shopTel\" : {label : \"电话\", clz : \"col-xs-6\"},\r\n\t\t\"foodPrice\" : {label : \"菜品价格\", unit : CashUnit}\r\n\t};\r\n\tvar OrderPayDetailElsCfg = {\r\n\t\tuserFields : {\r\n\t\t\tlabel : \"个人信息\",\r\n\t\t\tfieldType : \"list\",\r\n\t\t\tfields : [\"userName\",\"userLoginMobile\"],\r\n\t\t\tmapFn : mapUserFields\r\n\t\t},\r\n\t\torderFields : {\r\n\t\t\tlabel : \"订单信息\",\r\n\t\t\tfieldType : \"list\",\r\n\t\t\tfields : [\"orderID\",\"orderCheckPWD\",\"person\",\"timeName\",\"tableName\",\"shopOrderKey\",\"orderTime\",\"orderCreateTime\",\r\n\t\t\t\"statusName\",\"takeoutAddress\",\"consumptionTypeName\",\"promotionDesc\",\"orderRemark\"],\r\n\t\t\tmapFn : mapOrderFields\r\n\t\t},\r\n\t\tpayFields : {\r\n\t\t\tlabel : \"支付详情\",\r\n\t\t\tfieldType : \"list\",\r\n\t\t\tfields : [\"foodAmount\",\"serviceAmount\",\"paidAmount\",\"promotionTotalAmount\",\"discountAmount\",\r\n\t\t\t\"freeAmount\",\"giftAmount\",\"presentInfo\",\"cardDiscountAmount\",\"pointBalance\",\"moneyBalance\",\"takeoutPackagingAmount\",\r\n\t\t\t\"orderTotal\",\"orderRefundAmount\",\"shopName\",\"shopTel\"],\r\n\t\t\tmapFn : mapPayFields\r\n\t\t},\r\n\t\tfoodsFields : {\r\n\t\t\tlabel : \"菜品信息\",\r\n\t\t\tfieldType : \"table\",\r\n\t\t\tfields : [\"foodCategoryName\",\"foodCategoryID\",\"foodName\",\"foodUnit\",\"foodPrice\",\"foodAmount\"],\r\n\t\t\tmapFn : mapFoodsFields\r\n\t\t}\r\n\r\n\t};\r\n\t\r\n\tvar AccountTransDetailModal = Stapes.subclass({\r\n\t\t/**\r\n\t\t * 构造\r\n\t\t * @param  {Object} cfg {triggerEl, orderKey, orderID, transType, transID}\r\n\t\t * @return {Object}\r\n\t\t */\r\n\t\tconstructor : function (cfg) {\r\n\t\t\tthis.$trigger = $XP(cfg, 'triggerEl');\r\n\t\t\tthis.orderKey = $XP(cfg, 'orderKey', '');\r\n\t\t\tthis.orderID = $XP(cfg, 'orderID', '');\r\n\t\t\tthis.transType = $XP(cfg, 'transType', '');\r\n\t\t\tthis.transID = $XP(cfg, 'transID', '');\r\n\t\t\tthis.transTypes = Hualala.TypeDef.FSMTransType;\r\n\t\t\tthis.transTypeHT = new IX.IListManager();\r\n\t\t\tthis.initTransTypeLib();\r\n\t\t\tthis.modal = null;\r\n\t\t\tthis.tplName = $XP(this.transTypeHT.get(this.transType), 'tpl', null);\r\n\t\t\tthis.callServerName = $XP(this.transTypeHT.get(this.transType), 'queryCall', null);\r\n\t\t\tthis.callServer = null;\r\n\t\t\tif (IX.isFn(this.callServerName)) {\r\n\t\t\t\tthis.callServer = this.callServerName;\r\n\t\t\t} else if (!IX.isString(this.callServerName)) {\r\n\t\t\t\tthrow(\"Configuration failed : Invalid Page Initialized for \" + this.callServerName);\r\n\t\t\t\treturn false;\r\n\t\t\t} else if (IX.nsExisted(this.callServerName)) {\r\n\t\t\t\tthis.callServer = IX.getNS(this.callServerName);\r\n\t\t\t}\r\n\t\t\tthis.queryKeys = $XP(this.transTypeHT.get(this.transType), 'queryKeys', null);\r\n\t\t\tif (!this.tplName || !this.callServer) return null;\r\n\t\t\tthis.loadTemplates();\r\n\t\t\tthis.initModal();\r\n\t\t\tthis.bindEvent();\r\n\t\t\tthis.emit('load', this.mapQueryParams());\r\n\t\t}\r\n\t});\r\n\tAccountTransDetailModal.proto({\r\n\t\tinitTransTypeLib : function () {\r\n\t\t\tvar self = this;\r\n\t\t\t_.each(this.transTypes, function (el) {\r\n\t\t\t\tvar type = $XP(el, 'value', '').toString();\r\n\t\t\t\tif (type.length > 0) {\r\n\t\t\t\t\tself.transTypeHT.register(type, el);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t},\r\n\t\tloadTemplates : function () {\r\n\t\t\tvar self = this;\r\n\t\t\tvar layoutTpl = Handlebars.compile(Hualala.TplLib.get(self.tplName)),\r\n\t\t\t\tbtnTpl = Handlebars.compile(Hualala.TplLib.get('tpl_shop_modal_btns'));\r\n\t\t\tHandlebars.registerHelper('chkFieldType', function (conditional, options) {\r\n\t\t\t\treturn (conditional == options.hash.type) ? options.fn(this) : options.inverse(this);\r\n\t\t\t});\r\n\t\t\tthis.set({\r\n\t\t\t\tlayoutTpl : layoutTpl,\r\n\t\t\t\tbtnTpl : btnTpl\r\n\t\t\t});\r\n\t\t},\r\n\t\tinitModal : function () {\r\n\t\t\tvar self = this;\r\n\t\t\tself.modal = new Hualala.UI.ModalDialog({\r\n\t\t\t\tid : 'account_trans_detail',\r\n\t\t\t\tclz : 'account-modal',\r\n\t\t\t\tsizeCls : 'modal-lg',\r\n\t\t\t\ttitle : \"结算账户交易详情\",\r\n\t\t\t\tafterRemove : function () {\r\n\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t},\r\n\t\tbindEvent : function () {\r\n\t\t\tvar self = this;\r\n\t\t\tself.on({\r\n\t\t\t\t\"load\" : function (params) {\r\n\t\t\t\t\tself.callServer(params, function (res) {\r\n\t\t\t\t\t\tif (res.resultcode == '000') {\r\n\t\t\t\t\t\t\tself.render($XP(res, 'data', null));\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\ttoptip({\r\n\t\t\t\t\t\t\t\tmsg : $XP(res, 'resultmsg', ''),\r\n\t\t\t\t\t\t\t\ttype : 'danger'\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t},\r\n\t\t\t\t\"show\" : function () {\r\n\t\t\t\t\tself.modal.show();\r\n\t\t\t\t},\r\n\t\t\t\t\"hide\" : function () {\r\n\t\t\t\t\tself.modal.hide();\r\n\t\t\t\t}\r\n\t\t\t}, this);\r\n\t\t\tself.modal._.dialog.on('click', '.btn', function (e) {\r\n\t\t\t\tvar $btn = $(this),\r\n\t\t\t\t\tact = $btn.attr('name');\r\n\t\t\t\tif (act == 'cancel') {\r\n\t\t\t\t\tself.emit('hide');\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t},\r\n\t\tmapOrderPayDetail : function (data) {\r\n\t\t\tvar self = this;\r\n\t\t\tvar fieldsets = \"userFields,orderFields,payFields,foodsFields\".split(',');\r\n\t\t\tfieldsets = _.map(fieldsets, function (key, i) {\r\n\t\t\t\tvar fieldCfg = OrderPayDetailElsCfg[key];\r\n\t\t\t\tvar mapFn = $XF(fieldCfg, 'mapFn');\r\n\t\t\t\tvar cfg = _.pick(fieldCfg, 'label', 'fieldType', 'fields');\r\n\t\t\t\t// return mapFn(cfg, $XP(data, 'data', {}));\r\n\t\t\t\treturn mapFn(cfg, data);\r\n\t\t\t});\r\n\t\t\tIX.Debug.info(\"DEBUG: Account TransDetail Modal Order Pay Detail Fieldsets : \");\r\n\t\t\tIX.Debug.info(fieldsets);\r\n\t\t\tvar orderSubType = $XP(data, 'data.orderSubType', ''),\r\n\t\t\t\torderSubTypeLabel = getOrderSubTypeLabel(orderSubType);\r\n\t\t\torderSubTypeLabel = IX.isEmpty(orderSubTypeLabel) ? '' : '(' + orderSubTypeLabel + ')';\r\n\t\t\tvar printDetail = {\r\n\t\t\t\tlabel : \"订单打印内容\",\r\n\t\t\t\torderSubTypeLabel : orderSubTypeLabel,\r\n\t\t\t\tcontent : $XP(data, 'orderPrnStr', '').replace(/\\n/g, '<br/>')\r\n\t\t\t};\r\n\r\n\t\t\treturn {\r\n\t\t\t\tfieldsets : fieldsets,\r\n\t\t\t\tprintDetail : printDetail\r\n\t\t\t};\r\n\t\t},\r\n\t\tmapFsmCustomerDetail : function (data) {\r\n\t\t\tvar self = this;\r\n\t\t\tvar settleUnitDetail = $XP(data, 'settleUnitDetail', [])[0],\r\n\t\t\t\tcustomerCard = $XP(data, 'customerCard', [])[0];\r\n\t\t\tvar transType = $XP(settleUnitDetail, 'transType'),\r\n\t\t\t\ttransTypeLabel = $XP(self.transTypeHT.get(transType), 'label', '');\r\n\t\t\tsettleUnitDetail = IX.each(settleUnitDetail, {}, function (acc, el, k) {\r\n\t\t\t\tvar cashKeys = 'transAfterBalance,transAmount,transSalesCommission';\r\n\t\t\t\tif (cashKeys.indexOf(k) >= 0) {\r\n\t\t\t\t\tacc[k] = Hualala.Common.Math.prettyNumeric(Hualala.Common.Math.prettyPrice(el));\r\n\t\t\t\t} else if (k == 'transType') {\r\n\t\t\t\t\tacc = IX.inherit(acc, {\r\n\t\t\t\t\t\ttransType : el,\r\n\t\t\t\t\t\ttransTypeLabel : $XP(self.transTypeHT.get(el), 'label', '')\r\n\t\t\t\t\t});\r\n\t\t\t\t} else {\r\n\t\t\t\t\tacc[k] = el;\r\n\t\t\t\t}\r\n\t\t\t\treturn acc;\r\n\t\t\t});\r\n\t\t\tcustomerCard = IX.each(customerCard, {}, function (acc, el, k) {\r\n\t\t\t\tvar cashKeys = 'saveCashTotal,saveMoneyTotal,moneyBalance';\r\n\t\t\t\tif (cashKeys.indexOf(k) >= 0) {\r\n\t\t\t\t\tacc[k] = Hualala.Common.Math.prettyNumeric(Hualala.Common.Math.prettyPrice(el));\r\n\t\t\t\t} else {\r\n\t\t\t\t\tacc[k] = el;\r\n\t\t\t\t}\r\n\t\t\t\treturn acc;\r\n\t\t\t});\r\n\t\t\treturn {\r\n\t\t\t\tsettleUnitDetail : IX.inherit(settleUnitDetail, {\r\n\t\t\t\t\ttransTypeLabel : transTypeLabel\r\n\t\t\t\t}),\r\n\t\t\t\tcustomerCard : customerCard\r\n\t\t\t};\r\n\t\t},\r\n\t\tmapRenderData : function (data) {\r\n\t\t\tvar self = this;\r\n\t\t\tvar type = _.last(self.callServerName.split('.'));\r\n\t\t\tvar ret = null;\r\n\t\t\tswitch(type) {\r\n\t\t\t\tcase \"queryAccountOrderPayDetail\":\r\n\t\t\t\t\tret = self.mapOrderPayDetail(data);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase \"queryAccountFsmCustomerDetail\":\r\n\t\t\t\t\tret = self.mapFsmCustomerDetail(data);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tdefault : \r\n\t\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t\treturn ret;\r\n\t\t},\r\n\t\trender : function (data) {\r\n\t\t\tvar self = this;\r\n\t\t\tvar renderData = self.mapRenderData(data),\r\n\t\t\t\tlayoutTpl = self.get('layoutTpl'),\r\n\t\t\t\tbtnTpl = self.get('btnTpl');\r\n\t\t\tvar htm = layoutTpl(renderData);\r\n\t\t\tself.modal._.body.html(htm);\r\n\t\t\tself.modal._.footer.html(btnTpl({\r\n\t\t\t\tbtns : [\r\n\t\t\t\t\t{clz : 'btn-default', name : 'cancel', label : '关闭'}\r\n\t\t\t\t]\r\n\t\t\t}));\r\n\t\t\tself.emit('show');\r\n\t\t},\r\n\t\tmapQueryParams : function () {\r\n\t\t\tvar self = this;\r\n\t\t\tvar params = {};\r\n\t\t\t_.each(self.queryKeys.split(','), function (k) {\r\n\t\t\t\tvar _k = k == 'SUA_TransItemID' ? 'transID' : k;\r\n\t\t\t\tparams[k] = self[_k]; \r\n\t\t\t});\r\n\t\t\tIX.Debug.info('DEBUG: Account TransDetail Modal Query Params:');\r\n\t\t\tIX.Debug.info(params);\r\n\t\t\treturn params;\r\n\t\t}\r\n\t});\r\n\tHualala.Account.AccountTransDetailModal = AccountTransDetailModal;\r\n\r\n\t\r\n})(jQuery, window);;(function ($, window) {\r\n\tIX.ns(\"Hualala.Account\");\r\n\tvar initAccountListPage = function () {\r\n\t\tvar $body = $('#ix_wrapper > .ix-body > .container');\r\n\t\tvar accountListPanel = new Hualala.Account.AccountListController({\r\n\t\t\tcontainer : $body,\r\n\t\t\tview : new Hualala.Account.AccountListView(),\r\n\t\t\tmodel : new Hualala.Account.AccountListModel({\r\n\t\t\t\tcallServer : Hualala.Global.queryAccount\r\n\t\t\t})\r\n\t\t});\r\n\t\taccountListPanel.emit('load', {\r\n\t\t\tpageNo : 1,\r\n\t\t\tpageSize : 15\r\n\t\t});\r\n\t};\r\n\r\n\tvar initAccountMgrPage = function () {\r\n\t\tvar ctx = Hualala.PageRoute.getPageContextByPath();\r\n\t\tvar $body = $('#ix_wrapper > .ix-body > .container');\r\n\t\tvar accountMgrCtrl = new Hualala.Account.AccountMgrController({\r\n\t\t\tcontainer : $body,\r\n\t\t\tsettleUnitID : $XP(ctx, 'params', [])[0],\r\n\t\t\taccountModel : new Hualala.Account.BaseAccountModel(),\r\n\t\t\tmgrView : new Hualala.Account.AccountMgrView(),\r\n\t\t\ttransaDetailCtrl : new Hualala.Account.TransactionDetailController()\r\n\t\t});\r\n\t\t// $body.html(\"<h1>结算账户管理页面</h1>\");\r\n\t};\r\n\r\n\tHualala.Account.AccountMgrInit = initAccountMgrPage;\r\n\t\r\n\tHualala.Account.AccountListInit = initAccountListPage;\r\n})(jQuery, window);;(function ($, window) {\r\n\tIX.ns(\"Hualala.Order\");\r\n\tvar popoverMsg = Hualala.UI.PopoverMsgTip;\r\n\tvar toptip = Hualala.UI.TopTip;\r\n\r\n\tvar OrderQueryResultModel = Stapes.subclass({\r\n\t\t/**\r\n\t\t * 构造订单查询结果的数据模型 \r\n\t\t * @param  {Object} cfg\t配置信息\r\n\t\t * \t\t@param {Function} callServer 获取数据接口\r\n\t\t * \t\t@param {Array} queryKeys 搜索条件字段序列\r\n\t\t * \t\t@param {Array} cities 城市数据\r\n\t\t * \t\t@param {Function} initQueryParams 初始化搜索条件\r\n\t\t * \t\t@param {Boolean} hasPager 是否支持分页true:支持；false：不支持.default true\r\n\t\t * @return {Object}\r\n\t\t */\r\n\t\tconstructor : function (cfg) {\r\n\t\t\tthis.callServer = $XP(cfg, 'callServer', null);\r\n\t\t\tif (!this.callServer) {\r\n\t\t\t\tthrow(\"callServer is empty!\");\r\n\t\t\t\treturn ;\r\n\t\t\t}\r\n\t\t\tthis.cities = $XP(cfg, 'cities', []);\r\n\t\t\tthis.statisticKeys = 'count,foodAmount,giftAmountTotal,orderRefundAmount,orderRegAmount,orderTotal,orderAmount,shouldSettlementTotal,total';\r\n\t\t\tthis.queryKeys = $XP(cfg, 'queryKeys', []);\r\n\t\t\tthis.pagerKeys = 'pageCount,totalSize,pageNo,pageSize'.split(',');\r\n\t\t\tthis.queryParamsKeys = null;\r\n\t\t\tthis.hasPager = $XP(cfg, 'hasPager', true);\r\n\t\t\tthis.recordModel = $XP(cfg, 'recordModel', BaseOrderRecordModel);\r\n\t\t\tvar initQueryParams = $XF(cfg, 'initQueryParams');\r\n\t\t\tinitQueryParams.apply(this);\r\n\t\t}\r\n\t});\r\n\r\n\tOrderQueryResultModel.proto({\r\n\t\tinit : function (params, cities) {\r\n\t\t\tthis.cities = cities || this.cities;\r\n\t\t\tthis.set(IX.inherit({\r\n\t\t\t\tds_record : new IX.IListManager(),\r\n\t\t\t\tds_page : new IX.IListManager(),\r\n\t\t\t\tds_statistic : new IX.IListManager(),\r\n\t\t\t}, this.hasPager ? {\r\n\t\t\t\tpageCount : 0,\r\n\t\t\t\ttotalSize : 0,\r\n\t\t\t\tpageNo : $XP(params, 'pageNo', 1),\r\n\t\t\t\tpageSize : $XP(params, 'pageSize', 15)\r\n\t\t\t} : {}));\r\n\t\t\tthis.queryParamsKeys = !this.hasPager ? this.queryKeys : this.queryKeys.concat(this.pagerKeys);\r\n\t\t},\r\n\t\tupdatePagerParams : function (params) {\r\n\t\t\tvar self = this;\r\n\t\t\tvar queryParamsKeys = self.queryParamsKeys.join(',');\r\n\t\t\t_.each(params, function (v, k, l) {\r\n\t\t\t\tif (queryParamsKeys.indexOf(k) > -1) {\r\n\t\t\t\t\tself.set(k, v);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t},\r\n\t\tgetPagerParams : function () {\r\n\t\t\tvar self = this;\r\n\t\t\tvar ret = {};\r\n\t\t\t_.each(self.queryParamsKeys, function (k) {\r\n\t\t\t\tret[k] = self.get(k);\r\n\t\t\t});\r\n\t\t\treturn ret;\r\n\t\t},\r\n\t\tupdateDataStore : function (data, pageNo) {\r\n\t\t\tvar self = this,\r\n\t\t\t\trecordHT = self.get('ds_record'),\r\n\t\t\t\tpageHT = self.get('ds_page');\r\n\t\t\tpageNo = self.hasPager ? pageNo : 1;\r\n\t\t\tvar recordIDs = _.map(data, function (r, i, l) {\r\n\t\t\t\tvar id = pageNo + '_' + IX.id(),\r\n\t\t\t\t\tmRecord = new self.recordModel(IX.inherit(r, {\r\n\t\t\t\t\t\t'__id__' : id\r\n\t\t\t\t\t}));\r\n\t\t\t\trecordHT.register(id, mRecord);\r\n\t\t\t\treturn id;\r\n\t\t\t});\r\n\t\t\tpageHT.register(pageNo, recordIDs);\r\n\t\t},\r\n\t\tupdateStatisticDataStore : function (data) {\r\n\t\t\tvar self = this,\r\n\t\t\t\tstatisticHT = self.get('ds_statistic');\r\n\t\t\t_.each(self.statisticKeys.split(','), function (k) {\r\n\t\t\t\tvar v = $XP(data, k, '');\r\n\t\t\t\tstatisticHT.register(k, v);\r\n\t\t\t});\r\n\t\t},\r\n\t\tresetDataStore : function () {\r\n\t\t\tthis.recordHT.clear();\r\n\t\t\tthis.pageHT.clear();\r\n\t\t},\r\n\t\tload : function (params, cbFn) {\r\n\t\t\tvar self = this;\r\n\t\t\tself.updatePagerParams(params);\r\n\t\t\tself.callServer(self.getPagerParams(), function (res) {\r\n\t\t\t\tif (res.resultcode == '000') {\r\n\t\t\t\t\tself.updateDataStore($XP(res, 'data.records', []), $XP(res, 'data.page.pageNo'));\r\n\t\t\t\t\tself.updatePagerParams($XP(res, 'data.page', {}));\r\n\t\t\t\t\tself.updateStatisticDataStore($XP(res, 'data', {}));\r\n\t\t\t\t} else {\r\n\t\t\t\t\ttoptip({\r\n\t\t\t\t\t\tmsg : $XP(res, 'resultmsg', ''),\r\n\t\t\t\t\t\ttype : 'danger'\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t\tcbFn(self);\r\n\t\t\t});\r\n\t\t},\r\n\t\tgetRecordsByPageNo : function (pageNo) {\r\n\t\t\tvar self = this,\r\n\t\t\t\trecordHT = self.get('ds_record'),\r\n\t\t\t\tpageHT = self.get('ds_page');\r\n\t\t\tpageNo = !self.hasPager ? 1 : pageNo;\r\n\t\t\tvar ret = _.map(recordHT.getByKeys(pageHT.get(pageNo)), function (mRecord, i, l) {\r\n\t\t\t\treturn mRecord.getAll();\r\n\t\t\t});\r\n\t\t\tIX.Debug.info(\"DEBUG: Order Query Result Model PageData\");\r\n\t\t\tIX.Debug.info(ret);\r\n\t\t\treturn ret;\r\n\t\t},\r\n\t\tgetRecordModelByID : function (id) {\r\n\t\t\tvar self = this,\r\n\t\t\t\trecordHT = self.get('ds_record');\r\n\t\t\treturn recordHT.get(id);\r\n\t\t},\r\n\t\tgetCityByCityID : function (cityID) {\r\n\t\t\tif (IX.isEmpty(cityID)) return null;\r\n\t\t\tvar l = this.cities;\r\n\t\t\tvar m = _.find(l, function (el) {\r\n\t\t\t\treturn $XP(el, 'cityID') == cityID;\r\n\t\t\t});\r\n\t\t\treturn m;\r\n\t\t},\r\n\t\tgetStatisticData : function () {\r\n\t\t\tvar self = this,\r\n\t\t\t\tstatisticHT = self.get('ds_statistic'),\r\n\t\t\t\tret = {};\r\n\t\t\t_.each(self.statisticKeys.split(','), function(k) {\r\n\t\t\t\tret[k] = statisticHT.get(k);\r\n\t\t\t});\r\n\t\t\treturn ret;\r\n\t\t}\r\n\t});\r\n\r\n\tHualala.Order.OrderQueryResultModel = OrderQueryResultModel;\r\n\r\n\t/*订单查询结果基础数据模型 */\r\n\tvar BaseOrderRecordModel = Stapes.subclass({\r\n\t\tconstructor : function (order) {\r\n\t\t\tthis.set(order);\r\n\t\t}\r\n\t});\r\n\tBaseOrderRecordModel.proto({\r\n\r\n\t});\r\n\tHualala.Order.BaseOrderRecordModel = BaseOrderRecordModel;\r\n})(jQuery, window);;(function ($, window) {\r\n\tIX.ns(\"Hualala.Order\");\r\n\tvar popoverMsg = Hualala.UI.PopoverMsgTip;\r\n\tvar toptip = Hualala.UI.TopTip;\r\n\r\n\r\n\tvar OrderQueryTableHeaderCfg = [\r\n\t\t{key : \"cityID\", clz : \"\", label : \"城市\"},\r\n\t\t{key : \"shopName\", clz : \"\", label : \"店铺名称\"},\r\n\t\t{key : \"orderID\", clz : \"\", label : \"订单号\"},\r\n\t\t{key : \"userName\", clz : \"\", label : \"客户姓名\"},\r\n\t\t{key : \"orderTime\", clz : \"\", label : \"就餐时间\"},\r\n\t\t{key : \"orderStatus\", clz : \"\", label : \"订单状态\"},\r\n\t\t{key : \"orderTotal\", clz : \"\", label : \"应付金额\"},\r\n\t\t{key : \"moneyBalance\", clz : \"\", label : \"会员卡支付\"},\r\n\t\t{key : \"pointBalance\", clz : \"\", label : \"会员卡积分支付\"},\r\n\t\t{key : \"orderRefundAmount\", clz : \"\", label : \"退订/退款\"},\r\n\t\t{key : \"total\", clz : \"\", label : \"应结金额\"},\r\n\t\t{key : \"shouldSettlementTotal\", clz : \"\", label : \"结算金额\"},\r\n\t\t{key : \"rowControl\", clz : \"\", label : \"操作\"}\r\n\t];\r\n\tvar OrderQueryDuringTableHeaderCfg = [\r\n\t\t{key : \"cityID\", clz : \"\", label : \"城市\"},\r\n\t\t{key : \"billDate\", clz : \"\", label : \"日期\"},\r\n\t\t{key : \"count\", clz : \"\", label : \"订单数\"},\r\n\t\t{key : \"giftAmountTotal\", clz : \"\", label : \"代金券总金额\"},\r\n\t\t{key : \"orderTotal\", clz : \"\", label : \"订单支付金额\"},\r\n\t\t{key : \"orderWaitTotal\", clz : \"\", label : \"待消费订单金额\"},\r\n\t\t{key : \"orderRegAmount\", clz : \"\", label : \"退款金额\"},\r\n\t\t{key : \"orderRefundAmount\", clz : \"\", label : \"退订金额\"},\r\n\t\t{key : \"total\", clz : \"\", label : \"成交金额\"},\r\n\t\t{key : \"orderTotal\", clz : \"\", label : \"线下金额\"},\r\n\t\t{key : \"rowControl\", clz : \"\", label : \"操作\"}\r\n\t];\r\n\r\n\tvar OrderQueryDishHotTableHeaderCfg = [\r\n\t\t{key : \"index\", clz : \"\", label : \"序号\"},\r\n\t\t{key : \"foodName\", clz : \"\", label : \"菜品名称\"},\r\n\t\t{key : \"foodCategoryName\", clz : \"\", label : \"分类名称\"},\r\n\t\t{key : \"sumPrice\", clz : \"\", label : \"平均价格\"},\r\n\t\t{key : \"sumMaster\", clz : \"\", label : \"销售份数\"}\r\n\t];\r\n\r\n\tvar OrderQueryUserTableHeaderCfg = [\r\n\t\t{key : \"userName\", clz : \"\", label : \"姓名\"},\r\n\t\t{key : \"userSex\", clz : \"\", label : \"性别\"},\r\n\t\t{key : \"userLoginMobile\", clz : \"\", label : \"手机号\"},\r\n\t\t{key : \"sumRecord\", clz : \"\", label : \"订餐次数\"},\r\n\t\t{key : \"foodAmount\", clz : \"\", label : \"订餐金额\"},\r\n\t\t{key : \"minOrderTime\", clz : \"\", label : \"首次订餐时间\"},\r\n\t\t{key : \"maxOrderTime\", clz : \"\", label : \"最近订餐时间\"}\r\n\t];\r\n\r\n\tvar mapColItemRenderData = function (row, rowIdx, colKey) {\r\n\t\tvar self = this;\r\n\t\tvar ctx = Hualala.PageRoute.getPageContextByPath(), pageName = $XP(ctx, 'name'),\r\n\t\t\tpagerParams = self.model.getPagerParams(), queryKeys = self.model.queryKeys;\r\n\t\tvar r = {value : \"\", text : \"\"}, v = $XP(row, colKey, '');\r\n\t\tswitch(colKey) {\r\n\t\t\tcase \"cityID\":\r\n\t\t\t\tv = self.getCityByCityID(v);\r\n\t\t\t\tr.value = $XP(v, 'cityID', '');\r\n\t\t\t\tr.text = $XP(v, 'cityName', '');\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"userName\":\r\n\t\t\t\tvar m = $XP(row, 'userMobile', ''),\r\n\t\t\t\t\ts = Hualala.Common.getGender($XP(row, 'userSex', ''));\r\n\t\t\t\ts = IX.isEmpty(s) ? '' : '(' + $XP(s, 'label', '') + ')';\r\n\t\t\t\tm = IX.isEmpty(m) ? '' : '(' + m + ')';\r\n\t\t\t\tr.value = $XP(row, 'userID', '');\r\n\t\t\t\tr.text = v + s + m;\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"orderTime\":\r\n\t\t\tcase \"minOrderTime\":\r\n\t\t\tcase \"maxOrderTime\":\r\n\t\t\t\tr.value = v;\r\n\t\t\t\tr.text = IX.Date.getDateByFormat(Hualala.Common.formatDateTimeValue(v), 'yyyy/MM/dd HH:mm');\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"orderStatus\":\r\n\t\t\t\tv = Hualala.Common.getOrderStatus(v);\r\n\t\t\t\tr.value = $XP(v, 'value', '');\r\n\t\t\t\tr.text = $XP(v, 'label', '');\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"billDate\":\r\n\t\t\t\tr.value = v;\r\n\t\t\t\tr.text = IX.Date.getDateByFormat(Hualala.Common.formatDateTimeValue(v), 'yyyy/MM/dd');\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"index\" :\r\n\t\t\t\tr.value = rowIdx;\r\n\t\t\t\tr.text = rowIdx + 1;\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"sumMaster\":\r\n\t\t\t\tr.value = v;\r\n\t\t\t\tr.text = v + \"&nbsp;\" + $XP(row, 'foodUnit', '');\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"sumPrice\":\r\n\t\t\t\tr.value = v || 0;\r\n\t\t\t\tr.text = Hualala.Common.Math.prettyPrice(Hualala.Common.Math.div(r.value, $XP(row, 'sumMaster', 1)));\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"userSex\":\r\n\t\t\t\tr.value = v;\r\n\t\t\t\tr.text = $XP(Hualala.Common.getGender($XP(row, 'userSex', '')), 'label', '');\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"rowControl\" :\r\n\t\t\t\tif (pageName == 'orderQuery') {\r\n\t\t\t\t\tr = {\r\n\t\t\t\t\t\ttype : 'button',\r\n\t\t\t\t\t\tbtns : [\r\n\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\tlabel : '查看详情', \r\n\t\t\t\t\t\t\t\tlink : 'javascript:void(0);', \r\n\t\t\t\t\t\t\t\tclz : 'query-order-detail', \r\n\t\t\t\t\t\t\t\tid : $XP(row, 'orderID', ''),\r\n\t\t\t\t\t\t\t\tkey : $XP(row, 'orderKey', ''), \r\n\t\t\t\t\t\t\t\ttype : ''\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t]\r\n\t\t\t\t\t};\r\n\t\t\t\t} else if (pageName == 'orderQueryDay' || pageName == 'orderQueryDuring' ) {\r\n\t\t\t\t\tvar n = pageName == \"orderQueryDuring\" ? \"orderQueryDay\" : \"orderQuery\",\r\n\t\t\t\t\t\tparams = _.map(queryKeys, function (k) {\r\n\t\t\t\t\t\t\treturn $XP(pagerParams, k, '');\r\n\t\t\t\t\t\t}),\r\n\t\t\t\t\t\tlink = '';\r\n\t\t\t\t\t\tif (n == 'orderQuery') {\r\n\t\t\t\t\t\t\tparams = params.concat(['','','','']);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tlink = Hualala.PageRoute.createPath(n, params);\r\n\t\t\t\t\tr = {\r\n\t\t\t\t\t\ttype : 'button',\r\n\t\t\t\t\t\tbtns : [\r\n\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\tlabel : '查看详情', \r\n\t\t\t\t\t\t\t\tlink : link, \r\n\t\t\t\t\t\t\t\tclz : '', \r\n\t\t\t\t\t\t\t\tid : '', \r\n\t\t\t\t\t\t\t\ttype : ''\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t]\r\n\t\t\t\t\t};\r\n\t\t\t\t}\r\n\t\t\t\tbreak;\r\n\t\t\tdefault : \r\n\t\t\t\tr.value = r.text = $XP(row, colKey, '');\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\t\treturn r;\r\n\t};\r\n\r\n\t/**\r\n\t * 格式化需要渲染的结果数据\r\n\t * @param {Array|Object} records 搜索结果数据 \r\n\t * @return {Array|Obejct}\t格式化后的渲染数据\r\n\t */\r\n\tHualala.Order.mapQueryOrderResultRenderData = function (records) {\r\n\t\tvar self = this;\r\n\t\tvar clz = \"col-md-12\",\r\n\t\t\ttblClz = \"table-striped table-hover\",\r\n\t\t\ttblHeaders = OrderQueryTableHeaderCfg,\r\n\t\t\tstatisticData = self.model.getStatisticData();\r\n\t\tvar mapColsRenderData = function (row, idx) {\r\n\t\t\tvar colKeys = _.map(tblHeaders, function (el) {\r\n\t\t\t\treturn $XP(el, 'key', '');\r\n\t\t\t});\r\n\t\t\t// colKeys.push('rowControl');\r\n\t\t\tvar col = {clz : '', type : 'text'};\r\n\t\t\tvar cols = _.map(colKeys, function (k, i) {\r\n\t\t\t\tvar r = mapColItemRenderData.apply(self, [row, idx, k]);\r\n\t\t\t\treturn IX.inherit(col, r);\r\n\t\t\t});\r\n\t\t\treturn cols;\r\n\t\t};\r\n\t\tvar rows = _.map(records, function (row, idx) {\r\n\t\t\treturn {\r\n\t\t\t\tclz : '',\r\n\t\t\t\tcols : mapColsRenderData(row, idx)\r\n\t\t\t};\r\n\t\t});\r\n\t\tvar statisticKeys = 'orderTotal,orderRefundAmount,total,shouldSettlementTotal';\r\n\t\tvar ftCols = _.map(statisticKeys.split(','), function (k) {\r\n\t\t\tvar v = $XP(statisticData, k, 0), rowspan = 1, clz = '', \r\n\t\t\t\tcolspan = k == \"orderTotal\" ? 3 : 1;\r\n\r\n\t\t\treturn {\r\n\t\t\t\tclz : clz,\r\n\t\t\t\tcolspan : colspan,\r\n\t\t\t\trowspan : rowspan,\r\n\t\t\t\ttext : v,\r\n\t\t\t\tvalue : v\r\n\t\t\t};\r\n\t\t});\r\n\t\tftCols.unshift({\r\n\t\t\tclz : 'title', colspan : '6', rowspan : '1', value : '', text : '共计：'\r\n\t\t});\r\n\t\tvar tfoot = [{\r\n\t\t\tclz : '',\r\n\t\t\tcols : ftCols\r\n\t\t}];\r\n\t\treturn {\r\n\t\t\tclz : clz,\r\n\t\t\ttblClz : tblClz,\r\n\t\t\tisEmpty : !records || records.length == 0 ? true : false,\r\n\t\t\tcolCount : tblHeaders.length,\r\n\t\t\tthead : tblHeaders,\r\n\t\t\trows : rows,\r\n\t\t\ttfoot : tfoot\r\n\t\t};\r\n\t};\r\n\t/**\r\n\t * 格式化需要渲染的结果数据（区间汇总，日汇总 ）\r\n\t * @param  {[type]} records\r\n\t * @return {[type]}\r\n\t */\r\n\tHualala.Order.mapQueryOrderDuringRenderData = function (records) {\r\n\t\tvar self = this;\r\n\t\tvar ctx = Hualala.PageRoute.getPageContextByPath();\r\n\t\tvar pageName = $XP(ctx, 'name');\r\n\t\tvar pagerParams = self.model.getPagerParams();\r\n\t\tvar queryKeys = self.model.queryKeys;\r\n\t\tvar clz = \"col-md-12\",\r\n\t\t\ttblClz = \"table-striped table-hover\",\r\n\t\t\ttblHeaders = IX.clone(OrderQueryDuringTableHeaderCfg),\r\n\t\t\tstatisticData = self.model.getStatisticData();;\r\n\t\tif (pageName == 'orderQueryDuring') {\r\n\t\t\ttblHeaders = _.map(tblHeaders, function (el) {\r\n\t\t\t\tvar key = $XP(el, 'key', '');\r\n\t\t\t\tif (key == 'billDate') {\r\n\t\t\t\t\tel = IX.inherit(el, {\r\n\t\t\t\t\t\tkey : 'shopName', clz : \"\", label : \"店铺名称\"\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t\treturn el;\r\n\t\t\t});\r\n\t\t}\r\n\t\tvar mapColsRenderData = function (row, idx) {\r\n\t\t\tvar colKeys = _.map(tblHeaders, function (el) {\r\n\t\t\t\treturn $XP(el, 'key', '');\r\n\t\t\t});\r\n\t\t\t// colKeys.push('rowControl');\r\n\t\t\tvar col = {clz : '', type : 'text'};\r\n\t\t\tvar cols = _.map(colKeys, function (k, i) {\r\n\t\t\t\tvar r = mapColItemRenderData.apply(self, [row, idx, k]);\r\n\t\t\t\treturn IX.inherit(col, r);\r\n\t\t\t});\r\n\t\t\treturn cols;\r\n\t\t};\r\n\t\tvar rows = _.map(records, function (row, idx) {\r\n\t\t\treturn {\r\n\t\t\t\tclz : '',\r\n\t\t\t\tcols : mapColsRenderData(row, idx)\r\n\t\t\t};\r\n\t\t});\r\n\t\tvar statisticKeys = 'count,giftAmountTotal,orderTotal,orderWaitTotal,orderRegAmount,orderRefundAmount,total,orderAmount';\r\n\t\tvar ftCols = _.map(statisticKeys.split(','), function (k) {\r\n\t\t\tvar v = $XP(statisticData, k, 0), rowspan = 1, clz = '', \r\n\t\t\t\tcolspan = 1;\r\n\r\n\t\t\treturn {\r\n\t\t\t\tclz : clz,\r\n\t\t\t\tcolspan : colspan,\r\n\t\t\t\trowspan : rowspan,\r\n\t\t\t\ttext : v,\r\n\t\t\t\tvalue : v\r\n\t\t\t};\r\n\t\t});\r\n\t\tftCols.unshift({\r\n\t\t\tclz : 'title', colspan : '2', rowspan : '1', value : '', text : '共计：'\r\n\t\t});\r\n\t\tvar tfoot = [{\r\n\t\t\tclz : '',\r\n\t\t\tcols : ftCols\r\n\t\t}];\r\n\t\treturn {\r\n\t\t\tclz : clz,\r\n\t\t\tisEmpty : !records || records.length == 0 ? true : false,\r\n\t\t\tcolCount : tblHeaders.length,\r\n\t\t\ttblClz : tblClz,\r\n\t\t\tthead : tblHeaders,\r\n\t\t\trows : rows,\r\n\t\t\ttfoot : tfoot\r\n\t\t};\r\n\t};\r\n\t/**\r\n\t * 格式化菜品排行榜渲染数据\r\n\t * @param  {[type]} records\r\n\t * @return {[type]}\r\n\t */\r\n\tHualala.Order.mapQueryDishesHotRenderData = function (records) {\r\n\t\tvar self = this;\r\n\t\tvar clz = \"col-md-12\",\r\n\t\t\ttblClz = \"table-striped table-hover\",\r\n\t\t\ttblHeaders = OrderQueryDishHotTableHeaderCfg;\r\n\t\tvar mapColsRenderData = function (row, idx) {\r\n\t\t\tvar colKeys = _.map(tblHeaders, function (el) {\r\n\t\t\t\treturn $XP(el, 'key', '');\r\n\t\t\t});\r\n\t\t\t// colKeys.push('rowControl');\r\n\t\t\tvar col = {clz : '', type : 'text'};\r\n\t\t\tvar cols = _.map(colKeys, function (k, i) {\r\n\t\t\t\tvar r = mapColItemRenderData.apply(self, [row, idx, k]);\r\n\t\t\t\treturn IX.inherit(col, r);\r\n\t\t\t});\r\n\t\t\treturn cols;\r\n\t\t};\r\n\t\tvar rows = _.map(records, function (row, idx) {\r\n\t\t\treturn {\r\n\t\t\t\tclz : '',\r\n\t\t\t\tcols : mapColsRenderData(row, idx)\r\n\t\t\t};\r\n\t\t});\r\n\t\treturn {\r\n\t\t\tclz : clz,\r\n\t\t\ttblClz : tblClz,\r\n\t\t\tisEmpty : !records || records.length == 0 ? true : false,\r\n\t\t\tcolCount : tblHeaders.length,\r\n\t\t\tthead : tblHeaders,\r\n\t\t\trows : rows\r\n\t\t};\r\n\t};\r\n\r\n\t/**\r\n\t * 格式化用户统计排行榜渲染数据\r\n\t * @param  {[type]} records\r\n\t * @return {[type]}\r\n\t */\r\n\tHualala.Order.mapQueryUserRenderData = function (records) {\r\n\t\tvar self = this;\r\n\t\tvar clz = \"col-md-12\",\r\n\t\t\ttblClz = \"table-striped table-hover\",\r\n\t\t\ttblHeaders = OrderQueryUserTableHeaderCfg;\r\n\t\tvar mapColsRenderData = function (row, idx) {\r\n\t\t\tvar colKeys = _.map(tblHeaders, function (el) {\r\n\t\t\t\treturn $XP(el, 'key', '');\r\n\t\t\t});\r\n\t\t\t// colKeys.push('rowControl');\r\n\t\t\tvar col = {clz : '', type : 'text'};\r\n\t\t\tvar cols = _.map(colKeys, function (k, i) {\r\n\t\t\t\tvar r = mapColItemRenderData.apply(self, [row, idx, k]);\r\n\t\t\t\treturn IX.inherit(col, r);\r\n\t\t\t});\r\n\t\t\treturn cols;\r\n\t\t};\r\n\t\tvar rows = _.map(records, function (row, idx) {\r\n\t\t\treturn {\r\n\t\t\t\tclz : '',\r\n\t\t\t\tcols : mapColsRenderData(row, idx)\r\n\t\t\t};\r\n\t\t});\r\n\r\n\t\treturn {\r\n\t\t\tclz : clz,\r\n\t\t\ttblClz : tblClz,\r\n\t\t\tisEmpty : !records || records.length == 0 ? true : false,\r\n\t\t\tcolCount : tblHeaders.length,\r\n\t\t\tthead : tblHeaders,\r\n\t\t\trows : rows\r\n\t\t};\r\n\t};\r\n\r\n\t/**\r\n\t * 渲染结果页面\r\n\t * @param  {Array|Object} data \t需要渲染成页面的数据\r\n\t * @return {NULL}\r\n\t */\r\n\tHualala.Order.renderQueryOrderResult = function (data) {\r\n\t\tvar self = this;\r\n\t\tself.$result.empty();\r\n\t\tself.$result.html(self.get('resultTpl')(data));\r\n\t};\r\n\r\n\tvar OrderQueryResultView = Stapes.subclass({\r\n\t\t/**\r\n\t\t * 构造View层\r\n\t\t * @param  {Object} cfg\r\n\t\t * \t\t\t@param {Function} mapResultRenderData 格式化渲染数据\r\n\t\t * \t\t\t@param {Function} renderResult 渲染方法\r\n\t\t * @return {Object}\r\n\t\t */\r\n\t\tconstructor : function (cfg) {\r\n\t\t\tthis.$container = null;\r\n\t\t\tthis.$resultBox = null;\r\n\t\t\tthis.$result = null;\r\n\t\t\tthis.$pager = null;\r\n\t\t\tthis.set('mapResultRenderData', $XF(cfg, 'mapResultRenderData'));\r\n\t\t\tthis.set('renderResult', $XF(cfg, 'renderResult'));\r\n\t\t\tthis.loadTemplate();\r\n\t\t}\r\n\t});\r\n\tOrderQueryResultView.proto({\r\n\t\t/**\r\n\t\t * 初始化View层\r\n\t\t * @param  {Object} cfg\r\n\t\t * \t\t\t@param {jQueryObj} container 容器\r\n\t\t * \t\t\t@param {Object} model 搜索结果数据模型\r\n\t\t * @return \r\n\t\t */\r\n\t\tinit : function (cfg) {\r\n\t\t\tthis.$container = $XP(cfg, 'container', null);\r\n\t\t\tthis.model = $XP(cfg, 'model', null);\r\n\t\t\tif (!this.$container || !this.model) {\r\n\t\t\t\tthrow(\"Query Result View Init Faild!\");\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tthis.initLayout();\r\n\t\t},\r\n\t\tloadTemplate : function () {\r\n\t\t\tvar layoutTpl = Handlebars.compile(Hualala.TplLib.get('tpl_shop_list_layout')),\r\n\t\t\t\tresultTpl = Handlebars.compile(Hualala.TplLib.get('tpl_base_datagrid'));\r\n\t\t\tHandlebars.registerPartial(\"colBtns\", Hualala.TplLib.get('tpl_base_grid_colbtns'));\r\n\t\t\tHandlebars.registerHelper('chkColType', function (conditional, options) {\r\n\t\t\t\treturn (conditional == options.hash.type) ? options.fn(this) : options.inverse(this);\r\n\t\t\t});\r\n\t\t\tthis.set({\r\n\t\t\t\tlayoutTpl : layoutTpl,\r\n\t\t\t\tresultTpl : resultTpl\r\n\t\t\t});\r\n\t\t},\r\n\t\tinitLayout : function () {\r\n\t\t\tvar layoutTpl = this.get('layoutTpl');\r\n\t\t\tvar htm = layoutTpl();\r\n\t\t\tthis.$container.append(htm);\r\n\t\t\tthis.$resultBox = this.$container.find('.shop-list');\r\n\t\t\tthis.$result = this.$container.find('.shop-list-body');\r\n\t\t\tthis.$pager = this.$container.find('.page-selection');\r\n\t\t\tthis.initPager();\r\n\t\t\tthis.bindEvent();\r\n\t\t},\r\n\t\tinitPager : function (params) {\r\n\t\t\tvar self = this;\r\n\t\t\tif (!self.model.hasPager) return;\r\n\t\t\tvar baseCfg = {total : 0, page : 1, maxVisible : 10, leaps : true};\r\n\t\t\tthis.$pager.IXPager(IX.inherit(baseCfg, params));\r\n\t\t},\r\n\t\tbindEvent : function () {\r\n\t\t\tvar self = this;\r\n\t\t\tself.model.hasPager && self.$pager.on('page', function (e, pageNo) {\r\n\t\t\t\tvar params = self.model.getPagerParams();\r\n\t\t\t\tparams['pageNo'] = pageNo;\r\n\t\t\t\tself.model.emit('load', IX.inherit(params, {\r\n\t\t\t\t\tpageNo : $XP(params, 'pageNo', 1),\r\n\t\t\t\t\tpageSize : $XP(params, 'pageSize', 15)\r\n\t\t\t\t}));\r\n\t\t\t});\r\n\t\t\tself.$resultBox.on('click', 'a.query-order-detail', function (e) {\r\n\t\t\t\tvar $btn = $(this),\r\n\t\t\t\t\torderKey = $btn.attr('data-key'),\r\n\t\t\t\t\torderID = $btn.attr('data-id'),\r\n\t\t\t\t\ttransType = '101';\r\n\t\t\t\tvar detail = new Hualala.Account.AccountTransDetailModal({\r\n\t\t\t\t\ttriggerEl : $btn,\r\n\t\t\t\t\torderKey : orderKey,\r\n\t\t\t\t\torderID : orderID,\r\n\t\t\t\t\ttransType : transType,\r\n\t\t\t\t\ttransID : ''\r\n\t\t\t\t});\r\n\r\n\t\t\t});\r\n\t\t},\r\n\t\tmapRenderData : function (records) {\r\n\t\t\tvar mapFn = this.get('mapResultRenderData');\r\n\t\t\tvar ret = IX.isFn(mapFn) ? mapFn.apply(this, arguments) : null;\r\n\t\t\treturn ret;\r\n\t\t},\r\n\t\trenderRecords : function (data) {\r\n\t\t\tvar renderFn = this.get('renderResult');\r\n\t\t\tIX.isFn(renderFn) && renderFn.apply(this, arguments);\r\n\t\t},\r\n\t\trender : function () {\r\n\t\t\tvar self = this,\r\n\t\t\t\tmodel = self.model,\r\n\t\t\t\thasPager = model.hasPager,\r\n\t\t\t\tpagerParams = model.getPagerParams(),\r\n\t\t\t\tpageNo = $XP(pagerParams, 'pageNo', 1);\r\n\t\t\tvar records = model.getRecordsByPageNo(pageNo);\r\n\t\t\tvar renderData = self.mapRenderData(records);\r\n\t\t\tself.renderRecords(renderData);\r\n\t\t\thasPager && self.initPager({\r\n\t\t\t\ttotal : model.get('pageCount'),\r\n\t\t\t\tpage : model.get('pageNo'),\r\n\t\t\t\thref : 'javascript:void(0);'\r\n\t\t\t});\r\n\t\t},\r\n\t\tgetCityByCityID : function (cityID) {\r\n\t\t\tvar self = this;\r\n\t\t\tvar c = self.model.getCityByCityID(cityID);\r\n\t\t\treturn c;\r\n\t\t}\r\n\t});\r\n\r\n\tHualala.Order.OrderQueryResultView = OrderQueryResultView;\r\n})(jQuery, window);\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n;(function ($, window) {\r\n\tIX.ns(\"Hualala.Order\");\r\n\tvar popoverMsg = Hualala.UI.PopoverMsgTip;\r\n\tvar toptip = Hualala.UI.TopTip;\r\n\tvar LoadingModal = Hualala.UI.LoadingModal;\r\n\r\n\tvar OrderListController = Stapes.subclass({\r\n\t\t/**\r\n\t\t * 构造搜索结果控制器\r\n\t\t * @param  {Object} cfg\r\n\t\t * \t\t\t@param {Object} view View层实例\r\n\t\t * \t\t\t@param {Object} model Model层实例\r\n\t\t * \t\t\t@param {JQueryObj} container 容器\r\n\t\t * @return {[type]}\r\n\t\t */\r\n\t\tconstructor : function (cfg) {\r\n\t\t\tthis.set({\r\n\t\t\t\tsessionData : Hualala.getSessionData()\r\n\t\t\t});\r\n\t\t\tthis.container = $XP(cfg, 'container', null);\r\n\t\t\tthis.view = $XP(cfg, 'view', null);\r\n\t\t\tthis.model = $XP(cfg, 'model', null);\r\n\t\t\tif (!this.view || !this.model || !this.container) {\r\n\t\t\t\tthrow(\"Query Result init faild!\");\r\n\t\t\t}\r\n\t\t\tthis.isReady = false;\r\n\t\t\tthis.bindEvent();\r\n\t\t}\r\n\t});\r\n\tOrderListController.proto({\r\n\t\tinit : function (params) {\r\n\t\t\tthis.model.init($XP(params, 'params', {}), $XP(params, 'cities', null));\r\n\t\t\tthis.view.init({\r\n\t\t\t\tmodel : this.model,\r\n\t\t\t\tcontainer : this.container\r\n\t\t\t});\r\n\t\t\tthis.loadingModal = new LoadingModal({\r\n\t\t\t\tstart : 100\r\n\t\t\t});\r\n\t\t\tthis.isReady = true;\r\n\t\t},\r\n\t\thasReady : function () {return this.isReady;},\r\n\t\tbindEvent : function () {\r\n\t\t\tthis.on({\r\n\t\t\t\tload : function (params) {\r\n\t\t\t\t\tvar self = this;\r\n\t\t\t\t\tif (!self.hasReady()) {\r\n\t\t\t\t\t\tself.init(params);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tself.model.emit('load', $XP(params, 'params', {}));\r\n\t\t\t\t}\r\n\t\t\t}, this);\r\n\t\t\tthis.model.on({\r\n\t\t\t\tload : function (params) {\r\n\t\t\t\t\tvar self = this;\r\n\t\t\t\t\tvar cbFn = function () {\r\n\t\t\t\t\t\tself.view.emit('render');\r\n\t\t\t\t\t\tself.loadingModal.hide();\r\n\t\t\t\t\t};\r\n\t\t\t\t\tself.loadingModal.show();\r\n\t\t\t\t\tself.model.load(params, cbFn);\r\n\t\t\t\t}\r\n\t\t\t}, this);\r\n\t\t\tthis.view.on({\r\n\t\t\t\trender : function () {\r\n\t\t\t\t\tvar self = this;\r\n\t\t\t\t\tself.view.render();\r\n\t\t\t\t}\r\n\t\t\t}, this);\r\n\t\t}\r\n\t});\r\n\r\n\tHualala.Order.OrderListController = OrderListController;\r\n})(jQuery, window);;(function ($, window) {\r\n\tIX.ns(\"Hualala.Order\");\r\n\tvar popoverMsg = Hualala.UI.PopoverMsgTip;\r\n\tvar toptip = Hualala.UI.TopTip;\r\n\r\n\tHualala.Order.initQueryParams = function () {\r\n\t\tvar ctx = Hualala.PageRoute.getPageContextByPath();\r\n\t\tvar self = this;\r\n\t\tvar queryVals = $XP(ctx, 'params', []);\r\n\t\tvar queryKeys = self.queryKeys;\r\n\t\tvar params = _.object(queryKeys, queryVals);\r\n\t\tself.set(params);\r\n\t};\r\n\r\n\tvar QueryModel = Hualala.Shop.QueryModel.subclass({\r\n\t\t/**\r\n\t\t * 构造订单搜索数据模型\r\n\t\t * @param  {Object} cfg\r\n\t\t * \t\t\t@param {Array} queryKeys 搜索字段\r\n\t\t * \t\t\t@param {Function} initQueryParams 初始化搜索字段方法\r\n\t\t * \t\t\t\r\n\t\t * @return {Object}\r\n\t\t */\r\n\t\tconstructor : function (cfg) {\r\n\t\t\t// 原始数据\r\n\t\t\tthis.origCities = [];\r\n\t\t\tthis.origAreas = [];\r\n\t\t\tthis.origShops = [];\r\n\t\t\tthis.queryKeys = $XP(cfg, 'queryKeys', []);\r\n\t\t\t// 数据是否已经加载完毕\r\n\t\t\tthis.isReady = false;\r\n\t\t\tthis.callServer = Hualala.Global.getShopQuerySchema;\r\n\t\t\tvar initQueryParams = $XF(cfg, 'initQueryParams');\r\n\t\t\tinitQueryParams.apply(this);\r\n\t\t}\r\n\t});\r\n\tQueryModel.proto({\r\n\t\tgetQueryParams : function () {\r\n\t\t\tvar self = this;\r\n\t\t\tvar vals = _.map(self.queryKeys, function (k) {\r\n\t\t\t\treturn self.get(k);\r\n\t\t\t});\r\n\t\t\tvar params = _.object(self.queryKeys, vals);\r\n\t\t\tIX.Debug.info(\"DEBUG: Order Query Model Query Params :\");\r\n\t\t\tIX.Debug.info(params);\r\n\t\t\treturn params;\r\n\t\t}\r\n\t});\r\n\r\n\tHualala.Order.QueryModel = QueryModel;\r\n})(jQuery, window);;(function ($, window) {\r\n\tIX.ns(\"Hualala.Order\");\r\n\tvar popoverMsg = Hualala.UI.PopoverMsgTip;\r\n\tvar toptip = Hualala.UI.TopTip;\r\n\r\n\t/**\r\n\t * 查询条件表单元素配置信息 \r\n\t * @type {Object}\r\n\t */\r\n\tHualala.Order.QueryFormElsCfg = {\r\n\t\torderTime : {\r\n\t\t\ttype : 'section',\r\n\t\t\tlabel : '日期',\r\n\t\t\tmin : {\r\n\t\t\t\ttype : 'datetimepicker',\r\n\t\t\t\t// surfix : '<span class=\"glyphicon glyphicon-calendar\"></span>',\r\n\t\t\t\tdefaultVal : '',\r\n\t\t\t\tvalidCfg : {\r\n\t\t\t\t\tgroup : '.min-input',\r\n\t\t\t\t\tvalidators : {}\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tmax : {\r\n\t\t\t\ttype : 'datetimepicker',\r\n\t\t\t\t// surfix : '<span class=\"glyphicon glyphicon-calendar\"></span>',\r\n\t\t\t\tdefaultVal : '',\r\n\t\t\t\tvalidCfg : {\r\n\t\t\t\t\tgroup : '.max-input',\r\n\t\t\t\t\tvalidators : {}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\tcityID : {\r\n\t\t\ttype : 'combo',\r\n\t\t\tlabel : '城市',\r\n\t\t\tdefaultVal : '',\r\n\t\t\toptions : [],\r\n\t\t\tvalidCfg : {\r\n\t\t\t\tvalidators : {}\r\n\t\t\t}\r\n\t\t},\r\n\t\tshopID : {\r\n\t\t\ttype : 'combo',\r\n\t\t\tlabel : '店铺',\r\n\t\t\tdefaultVal : '',\r\n\t\t\toptions : [],\r\n\t\t\tvalidCfg : {\r\n\t\t\t\tvalidators : {}\r\n\t\t\t}\r\n\t\t},\r\n\t\torderStatus : {\r\n\t\t\ttype : 'combo',\r\n\t\t\tlabel : '状态',\r\n\t\t\tdefaultVal : '',\r\n\t\t\toptions : Hualala.TypeDef.OrderStatus,\r\n\t\t\tvalidCfg : {\r\n\t\t\t\tvalidators : {}\r\n\t\t\t}\r\n\t\t},\r\n\t\torderTotal : {\r\n\t\t\ttype : 'section',\r\n\t\t\tlabel : '金额',\r\n\t\t\tmin : {\r\n\t\t\t\ttype : 'text',\r\n\t\t\t\t// prefix : '￥',\r\n\t\t\t\t// surfix : '元',\r\n\t\t\t\tdefaultVal : '',\r\n\t\t\t\tvalidCfg : {\r\n\t\t\t\t\tvalidators : {\r\n\t\t\t\t\t\tnumeric : {\r\n\t\t\t\t\t\t\tmessage: \"金额必须为数字\"\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\tgreaterThan : {\r\n\t\t\t\t\t\t\tinclusive : true,\r\n\t\t\t\t\t\t\tvalue : 0,\r\n\t\t\t\t\t\t\tmessage : \"金额必须大于或等于0\"\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tmax : {\r\n\t\t\t\ttype : 'text',\r\n\t\t\t\t// prefix : '￥',\r\n\t\t\t\t// surfix : '元',\r\n\t\t\t\tdefaultVal : '',\r\n\t\t\t\tvalidCfg : {\r\n\t\t\t\t\tvalidators : {\r\n\t\t\t\t\t\tnumeric : {\r\n\t\t\t\t\t\t\tmessage: \"金额必须为数字\"\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\tgreaterThan : {\r\n\t\t\t\t\t\t\tinclusive : true,\r\n\t\t\t\t\t\t\tvalue : 0,\r\n\t\t\t\t\t\t\tmessage : \"金额必须大于或等于0\"\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\torderID : {\r\n\t\t\ttype : 'text',\r\n\t\t\tlabel : '订单号',\r\n\t\t\tdefaultVal : '',\r\n\t\t\tvalidCfg : {\r\n\t\t\t\tvalidators : {\r\n\t\t\t\t\tnumeric : {\r\n\t\t\t\t\t\tmessage: \"订单号必须为数字\"\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\tuserMobile : {\r\n\t\t\ttype : 'text',\r\n\t\t\tlabel : '手机号',\r\n\t\t\tdefaultVal : '',\r\n\t\t\tvalidCfg : {\r\n\t\t\t\tvalidators : {\r\n\t\t\t\t\tnumeric : {\r\n\t\t\t\t\t\tmessage: \"手机号码必须为数字\"\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\tuserLoginMobile : {\r\n\t\t\ttype : 'text',\r\n\t\t\tlabel : '手机号',\r\n\t\t\tdefaultVal : '',\r\n\t\t\tvalidCfg : {\r\n\t\t\t\tvalidators : {\r\n\t\t\t\t\tnumeric : {\r\n\t\t\t\t\t\tmessage: \"手机号码必须为数字\"\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\tfoodCategoryName : {\r\n\t\t\ttype : 'text',\r\n\t\t\tlabel : '分类名称',\r\n\t\t\tdefaultVal : '',\r\n\t\t\tvalidCfg : {\r\n\t\t\t\tvalidators : {}\r\n\t\t\t}\r\n\t\t},\r\n\t\tuserName : {\r\n\t\t\ttype : 'text',\r\n\t\t\tlabel : '订餐人',\r\n\t\t\tdefaultVal : '',\r\n\t\t\tvalidCfg : {\r\n\t\t\t\tvalidators : {}\r\n\t\t\t}\r\n\t\t},\r\n\t\tbutton : {\r\n\t\t\ttype : 'button',\r\n\t\t\tclz : 'btn btn-block btn-warning',\r\n\t\t\tlabel : '查询'\r\n\t\t}\r\n\t};\r\n\tvar QueryFormElsHT = new IX.IListManager();\r\n\t_.each(Hualala.Order.QueryFormElsCfg, function (el, k) {\r\n\t\tvar type = $XP(el, 'type');\r\n\t\tvar labelClz = 'col-xs-2 col-sm-2 col-md-4 control-label';\r\n\t\tif (type == 'section') {\r\n\t\t\tvar id = minID = k + '_min_' + IX.id(), maxID = k + '_max_' + IX.id(),\r\n\t\t\t\tminName = k == 'orderTime' ? 'startDate' : 's_orderTotal',\r\n\t\t\t\tmaxName = k == 'orderTime' ? 'endDate' : 'e_orderTotal',\r\n\t\t\t\tmin = IX.inherit($XP(el, 'min', {}), {\r\n\t\t\t\t\tid : minID, name : minName, clz : 'col-xs-5 col-sm-5 col-md-5',\r\n\t\t\t\t}), max = IX.inherit($XP(el, 'max', {}), {\r\n\t\t\t\t\tid : maxID, name : maxName, clz : 'col-xs-5 col-sm-5 col-md-5',\r\n\t\t\t\t});\r\n\t\t\tQueryFormElsHT.register(k, IX.inherit(el, {\r\n\t\t\t\tid : id,\r\n\t\t\t\tlabelClz : 'col-xs-2 col-sm-2 col-md-2 control-label',\r\n\t\t\t\tmin : min,\r\n\t\t\t\tmax : max\r\n\t\t\t}));\r\n\t\t} else {\r\n\t\t\tQueryFormElsHT.register(k, IX.inherit(el, {\r\n\t\t\t\tid : k + '_' + IX.id(),\r\n\t\t\t\tname : k,\r\n\t\t\t\tlabelClz : labelClz,\r\n\t\t\t}, $XP(el, 'type') !== 'button' ? {clz : 'col-xs-8 col-sm-8 col-md-8'} : null));\r\n\t\t}\r\n\t});\r\n\r\n\t/**\r\n\t * 格式化订单搜索页面，搜索表单数据\r\n\t * @return {Object}\r\n\t */\r\n\tHualala.Order.mapOrderQueryFormRenderData = function () {\r\n\t\tvar self = this;\r\n\t\tvar queryKeys = self.model.queryKeys;\r\n\t\tvar query = {cols : [\r\n\t\t\t{\r\n\t\t\t\tcolClz : 'col-md-4',\r\n\t\t\t\titems : QueryFormElsHT.getByKeys(['orderTime', 'orderTotal'])\r\n\t\t\t},\r\n\t\t\t{\r\n\t\t\t\tcolClz : 'col-md-2',\r\n\t\t\t\titems : QueryFormElsHT.getByKeys(['cityID', 'shopID'])\r\n\t\t\t},\r\n\t\t\t{\r\n\t\t\t\tcolClz : 'col-md-3',\r\n\t\t\t\titems : QueryFormElsHT.getByKeys(['orderStatus', 'orderID'])\r\n\t\t\t},\r\n\t\t\t{\r\n\t\t\t\tcolClz : 'col-md-3',\r\n\t\t\t\titems : QueryFormElsHT.getByKeys(['userMobile'])\r\n\t\t\t},\r\n\t\t\t{\r\n\t\t\t\tcolClz : 'col-md-offset-1 col-md-2',\r\n\t\t\t\titems : QueryFormElsHT.getByKeys(['button'])\r\n\t\t\t}\r\n\t\t]};\r\n\t\treturn {\r\n\t\t\tquery : query\r\n\t\t};\r\n\t};\r\n\r\n\t/**\r\n\t * 格式化订单日汇总,期间汇总搜索页面，搜索表单数据\r\n\t * @return {Object}\r\n\t */\r\n\tHualala.Order.mapOrderQueryBaseFormRenderData = function () {\r\n\t\tvar self = this;\r\n\t\tvar queryKeys = self.model.queryKeys;\r\n\t\tvar query = {cols : [\r\n\t\t\t{\r\n\t\t\t\tcolClz : 'col-md-4',\r\n\t\t\t\titems : QueryFormElsHT.getByKeys(['orderTime'])\r\n\t\t\t},\r\n\t\t\t{\r\n\t\t\t\tcolClz : 'col-md-2',\r\n\t\t\t\titems : QueryFormElsHT.getByKeys(['cityID'])\r\n\t\t\t},\r\n\t\t\t{\r\n\t\t\t\tcolClz : 'col-md-2',\r\n\t\t\t\titems : QueryFormElsHT.getByKeys(['shopID'])\r\n\t\t\t},\r\n\t\t\t{\r\n\t\t\t\tcolClz : 'col-md-2',\r\n\t\t\t\titems : QueryFormElsHT.getByKeys(['orderStatus'])\r\n\t\t\t},\r\n\t\t\t{\r\n\t\t\t\tcolClz : 'col-md-2',\r\n\t\t\t\titems : QueryFormElsHT.getByKeys(['button'])\r\n\t\t\t}\r\n\t\t]};\r\n\t\treturn {\r\n\t\t\tquery : query\r\n\t\t};\r\n\t};\r\n\r\n\t/**\r\n\t * 格式化菜品排行榜页面搜索表单数据\r\n\t * @return {Object}\r\n\t */\r\n\tHualala.Order.mapDishesHotQueryFormRenderData = function () {\r\n\t\tvar self = this;\r\n\t\tvar queryKeys = self.model.queryKeys;\r\n\t\tvar query = {cols : [\r\n\t\t\t{\r\n\t\t\t\tcolClz : 'col-md-2',\r\n\t\t\t\titems : QueryFormElsHT.getByKeys(['cityID'])\r\n\t\t\t},\r\n\t\t\t{\r\n\t\t\t\tcolClz : 'col-md-2',\r\n\t\t\t\titems : QueryFormElsHT.getByKeys(['shopID'])\r\n\t\t\t},\r\n\t\t\t{\r\n\t\t\t\tcolClz : 'col-md-4',\r\n\t\t\t\titems : QueryFormElsHT.getByKeys(['orderTime'])\r\n\t\t\t},\r\n\t\t\t{\r\n\t\t\t\tcolClz : 'col-md-2',\r\n\t\t\t\titems : QueryFormElsHT.getByKeys(['foodCategoryName'])\r\n\t\t\t},\r\n\t\t\t{\r\n\t\t\t\tcolClz : 'col-md-2',\r\n\t\t\t\titems : QueryFormElsHT.getByKeys(['button'])\r\n\t\t\t}\r\n\t\t]};\r\n\t\treturn {\r\n\t\t\tquery : query\r\n\t\t};\r\n\t};\r\n\r\n\t/**\r\n\t * 格式化用户统计页面搜索表单数据\r\n\t * @return {Object}\r\n\t */\r\n\tHualala.Order.mapUsersQueryFormRenderData = function () {\r\n\t\tvar self = this;\r\n\t\tvar queryKeys = self.model.queryKeys;\r\n\t\tvar query = {cols : [\r\n\t\t\t{\r\n\t\t\t\tcolClz : 'col-md-3',\r\n\t\t\t\titems : QueryFormElsHT.getByKeys(['cityID'])\r\n\t\t\t},\r\n\t\t\t{\r\n\t\t\t\tcolClz : 'col-md-3',\r\n\t\t\t\titems : QueryFormElsHT.getByKeys(['shopID'])\r\n\t\t\t},\r\n\t\t\t{\r\n\t\t\t\tcolClz : 'col-md-4',\r\n\t\t\t\titems : QueryFormElsHT.getByKeys(['orderTime'])\r\n\t\t\t},\r\n\t\t\t\r\n\t\t\t{\r\n\t\t\t\tcolClz : 'col-md-3',\r\n\t\t\t\titems : QueryFormElsHT.getByKeys(['userLoginMobile'])\r\n\t\t\t},\r\n\t\t\t{\r\n\t\t\t\tcolClz : 'col-md-3',\r\n\t\t\t\titems : QueryFormElsHT.getByKeys(['userName'])\r\n\t\t\t},\r\n\t\t\t{\r\n\t\t\t\tcolClz : 'col-md-offset-4 col-md-2',\r\n\t\t\t\titems : QueryFormElsHT.getByKeys(['button'])\r\n\t\t\t}\r\n\t\t]};\r\n\t\treturn {\r\n\t\t\tquery : query\r\n\t\t};\r\n\t};\r\n\r\n\tvar QueryView = Stapes.subclass({\r\n\t\t/**\r\n\t\t * 订单报表搜索View层构造\r\n\t\t * @param  {Object} cfg\r\n\t\t * \t\t\t@param {Function} mapRenderDataFn 整理渲染搜索表单数据\r\n\t\t * @return {Object}\r\n\t\t */\r\n\t\tconstructor : function (cfg) {\r\n\t\t\tthis.isReady = false;\r\n\t\t\tthis.$container = null;\r\n\t\t\tthis.$queryBox = null;\r\n\t\t\tthis.loadTemplates();\r\n\t\t\tthis.set('mapRenderDataFn', $XF(cfg, 'mapRenderDataFn'));\r\n\t\t}\r\n\t});\r\n\r\n\tQueryView.proto({\r\n\t\tinit : function (cfg) {\r\n\t\t\tthis.model = $XP(cfg, 'model', null);\r\n\t\t\tthis.$container = $XP(cfg, 'container', null);\r\n\t\t\tif (!this.model || !this.$container || this.$container.length == 0) {\r\n\t\t\t\tthrow(\"Init Query View Failed!!\");\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tthis.renderLayout();\r\n\t\t\tthis.bindEvent();\r\n\t\t\tthis.isReady = true;\r\n\t\t\tthis.emit('query', this.getQueryParams());\r\n\t\t},\r\n\t\t// 判断是否View初始化完毕\r\n\t\thasReady : function () {return this.isReady;},\r\n\t\tloadTemplates : function () {\r\n\t\t\tvar self = this;\r\n\t\t\tvar layoutTpl = Handlebars.compile(Hualala.TplLib.get('tpl_order_queryLayout')),\r\n\t\t\t\tcomboOptsTpl = Handlebars.compile(Hualala.TplLib.get('tpl_order_comboOpts'));\r\n\t\t\tHandlebars.registerPartial(\"orderQueryForm\", Hualala.TplLib.get('tpl_order_queryForm'));\r\n\t\t\tHandlebars.registerHelper('checkFormElementType', function (conditional, options) {\r\n\t\t\t\treturn (conditional == options.hash.type) ? options.fn(this) : options.inverse(this);\r\n\t\t\t});\r\n\t\t\tHandlebars.registerHelper('isInputGroup', function (prefix, surfix, options) {\r\n\t\t\t\treturn (!prefix && !surfix) ? options.inverse(this) : options.fn(this);\r\n\t\t\t});\r\n\t\t\tthis.set({\r\n\t\t\t\tlayoutTpl : layoutTpl,\r\n\t\t\t\tcomboOptsTpl : comboOptsTpl\r\n\t\t\t});\r\n\t\t},\r\n\t\tinitQueryFormEls : function () {\r\n\t\t\tvar self = this,\r\n\t\t\t\tels = self.model.getQueryParams(),\r\n\t\t\t\tcityID = $XP(els, 'cityID', ''),\r\n\t\t\t\tshopID = $XP(els, 'shopID', '');\r\n\t\t\tself.initCityComboOpts(cityID);\r\n\t\t\tself.initShopComboOpts(cityID, shopID);\r\n\t\t\t_.each(els, function (v, k) {\r\n\t\t\t\tif (k == 'startDate' || k == 'endDate') {\r\n\t\t\t\t\tv = IX.isEmpty(v) ? '' : IX.Date.getDateByFormat(Hualala.Common.formatDateTimeValue(v), 'yyyy/MM/dd');\r\n\t\t\t\t}\r\n\t\t\t\tself.$queryBox.find('[name=' + k + ']').val(v);\r\n\t\t\t});\r\n\t\t},\r\n\t\tinitCityComboOpts : function (curCityID) {\r\n\t\t\tvar self = this,\r\n\t\t\t\tcities = self.model.getCities();\r\n\t\t\tif (IX.isEmpty(cities)) return ;\r\n\t\t\tcities = _.map(cities, function (city) {\r\n\t\t\t\tvar id = $XP(city, 'cityID', ''), name = $XP(city, 'cityName', '');\r\n\t\t\t\treturn {\r\n\t\t\t\t\tvalue : id,\r\n\t\t\t\t\tlabel : name,\r\n\t\t\t\t\tselected : id == curCityID ? 'selected' : ''\r\n\t\t\t\t};\r\n\t\t\t});\r\n\t\t\tcities.unshift({\r\n\t\t\t\tvalue : '',\r\n\t\t\t\tlabel : '全部',\r\n\t\t\t\tselected : IX.isEmpty(curCityID) ? 'selected' : ''\r\n\t\t\t});\r\n\t\t\tvar optTpl = self.get('comboOptsTpl'),\r\n\t\t\t\thtm = optTpl({\r\n\t\t\t\t\topts : cities\r\n\t\t\t\t}),\r\n\t\t\t\t$select = self.$queryBox.find('select[name=cityID]');\r\n\t\t\t$select.html(htm);\r\n\t\t},\r\n\t\tinitShopComboOpts : function (curCityID, curShopID) {\r\n\t\t\tvar self = this,\r\n\t\t\t\tshops = IX.isEmpty(curCityID) ? self.model.getShops() : self.model.getShopsByCityID(curCityID);\r\n\t\t\tif (IX.isEmpty(shops)) return;\r\n\t\t\tshops = _.map(shops, function (shop) {\r\n\t\t\t\tvar id = $XP(shop, 'shopID', ''), name = $XP(shop, 'shopName', '');\r\n\t\t\t\treturn {\r\n\t\t\t\t\tvalue : id,\r\n\t\t\t\t\tlabel : name,\r\n\t\t\t\t\tselected : id == curShopID ? 'selected' : ''\r\n\t\t\t\t};\r\n\t\t\t});\r\n\t\t\tshops.unshift({\r\n\t\t\t\tvalue : '',\r\n\t\t\t\tlabel : '全部',\r\n\t\t\t\tselected : IX.isEmpty(curShopID) ? 'selected' : ''\r\n\t\t\t});\r\n\t\t\tvar optTpl = self.get('comboOptsTpl'),\r\n\t\t\t\thtm = optTpl({\r\n\t\t\t\t\topts : shops\r\n\t\t\t\t}),\r\n\t\t\t\t$select = self.$queryBox.find('select[name=shopID]');\r\n\t\t\t$select.html(htm);\r\n\t\t},\r\n\t\tinitQueryEls : function () {\r\n\t\t\tvar self = this;\r\n\t\t\tself.$queryBox.find('[data-type=datetimepicker]').datetimepicker({\r\n\t\t\t\tformat : 'yyyy/mm/dd',\r\n\t\t\t\tstartDate : '2010/01/01',\r\n\t\t\t\tautoclose : true,\r\n\t\t\t\tminView : 'month',\r\n\t\t\t\ttodayBtn : true,\r\n\t\t\t\ttodayHighlight : true,\r\n\t\t\t\tlanguage : 'zh-CN'\r\n\t\t\t});\r\n\t\t\tself.$queryBox.on('click', '.input-group-addon', function (e) {\r\n\t\t\t\tvar $this = $(this),\r\n\t\t\t\t\t$picker = $this.prev(':text[data-type=datetimepicker]');\r\n\t\t\t\tif ($picker.length > 0) {\r\n\t\t\t\t\t$picker.datetimepicker('show');\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t},\r\n\t\tmapRenderLayoutData : function () {\r\n\t\t\tvar mapFn = this.get('mapRenderDataFn');\r\n\t\t\treturn IX.isFn(mapFn) && mapFn.apply(this);\r\n\t\t},\r\n\t\trenderLayout : function () {\r\n\t\t\tvar self = this,\r\n\t\t\t\tlayoutTpl = self.get('layoutTpl'),\r\n\t\t\t\tmodel = self.model;\r\n\t\t\tvar renderData = self.mapRenderLayoutData();\r\n\t\t\tvar html = layoutTpl(renderData);\r\n\t\t\tself.$queryBox = $(html);\r\n\t\t\tself.$container.html(self.$queryBox);\r\n\t\t\tself.initQueryFormEls();\r\n\t\t\tself.initQueryEls();\r\n\t\t},\r\n\t\tbindEvent : function () {\r\n\t\t\tvar self = this;\r\n\t\t\tself.$queryBox.on('change', 'select', function (e) {\r\n\t\t\t\tvar $this = $(this),\r\n\t\t\t\t\tv = $this.val();\r\n\t\t\t\tself.initShopComboOpts(v, '');\r\n\t\t\t});\r\n\t\t\tself.$queryBox.on('click', '.btn.btn-warning', function (e) {\r\n\t\t\t\tvar $this = $(this);\r\n\t\t\t\tself.emit('query', self.getQueryParams());\r\n\t\t\t});\r\n\t\t},\r\n\t\tgetQueryParams : function () {\r\n\t\t\tvar self = this,\r\n\t\t\t\tkeys = self.model.queryKeys,\r\n\t\t\t\t$form = self.$queryBox.find('form'),\r\n\t\t\t\tels = $form.serializeArray();\r\n\t\t\tels = _.map(els, function (el) {\r\n\t\t\t\tvar n = $XP(el, 'name'), v = $XP(el, 'value', '');\r\n\t\t\t\tif (n == 'startDate' || n == 'endDate') {\r\n\t\t\t\t\tv = IX.isEmpty(v) ? '' : IX.Date.getDateByFormat(v, 'yyyyMMdd');\r\n\t\t\t\t\treturn {\r\n\t\t\t\t\t\tname : n,\r\n\t\t\t\t\t\tvalue : v\r\n\t\t\t\t\t};\r\n\t\t\t\t}\r\n\t\t\t\treturn el;\r\n\t\t\t});\r\n\t\t\tels = _.object(_.pluck(els, 'name'), _.pluck(els, 'value'));\r\n\t\t\tself.model.set(els);\r\n\t\t\treturn els;\r\n\t\t}\r\n\r\n\t});\r\n\r\n\tHualala.Order.QueryView = QueryView;\r\n})(jQuery, window);;(function ($, window) {\r\n\tIX.ns(\"Hualala.Order\");\r\n\tvar popoverMsg = Hualala.UI.PopoverMsgTip;\r\n\tvar toptip = Hualala.UI.TopTip;\r\n\t\r\n\tvar QueryController = Hualala.Shop.QueryController.subclass({\r\n\t\t/**\r\n\t\t * 订单报表查询控制器\r\n\t\t * @param  {Object} cfg \r\n\t\t * \t\t\t@param {JQueryObj} container 容器\r\n\t\t * \t\t\t@param {Object} resultController 结果输出控制器\r\n\t\t * \t\t\t@param {Object} model 查询数据模型\r\n\t\t * \t\t\t@param {Object} view 查询界面模型\r\n\t\t * @return {Object}\t查询控制模块实例\r\n\t\t */\r\n\t\tconstructor : function (cfg) {\r\n\t\t\tthis.set({\r\n\t\t\t\tsessionData : Hualala.getSessionData()\r\n\t\t\t});\r\n\t\t\tthis.container = $XP(cfg, 'container', null);\r\n\t\t\tthis.resultController = $XP(cfg, 'resultController', null);\r\n\t\t\tthis.model = $XP(cfg, 'model', null);\r\n\t\t\tthis.view = $XP(cfg, 'view', null);\r\n\t\t\tif (!this.container || !this.model || !this.view || !this.resultController) {\r\n\t\t\t\tthrow(\"QueryController init faild!\");\r\n\t\t\t}\r\n\t\t\tthis.init();\r\n\t\t}\r\n\t});\r\n\tQueryController.proto({\r\n\t\t// 绑定事件\r\n\t\tbindEvent : function () {\r\n\t\t\t// 控制器的事件绑定\r\n\t\t\tthis.on({\r\n\t\t\t\treload : function () {\r\n\t\t\t\t\tvar self = this;\r\n\t\t\t\t\tself.model.distory();\r\n\t\t\t\t\tself.view.distory();\r\n\t\t\t\t\tself.init();\r\n\t\t\t\t},\r\n\t\t\t\tquery : function (params) {\r\n\t\t\t\t\tvar self = this;\r\n\t\t\t\t\tvar cities = self.model.getCities();\r\n\t\t\t\t\tIX.Debug.info('DEBUG: Order Query Controller Query Params:');\r\n\t\t\t\t\tIX.Debug.info(params);\r\n\t\t\t\t\tself.resultController && self.resultController.emit('load', {\r\n\t\t\t\t\t\tparams : IX.inherit(params, {\r\n\t\t\t\t\t\t\tpageNo : 1,\r\n\t\t\t\t\t\t\tpageSize : 15\r\n\t\t\t\t\t\t}),\r\n\t\t\t\t\t\tcities : cities\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t}, this);\r\n\t\t\t// 模型的事件绑定\r\n\t\t\tthis.model.on({\r\n\t\t\t\tload : function (cbFn) {\r\n\t\t\t\t\tvar self = this,\r\n\t\t\t\t\t\tparams = $XP(self.get('sessionData'), 'user', {});\r\n\t\t\t\t\tself.model.init(params, cbFn);\r\n\t\t\t\t}\r\n\t\t\t}, this);\r\n\t\t\t// 视图事件绑定\r\n\t\t\tthis.view.on({\r\n\t\t\t\tinit : function () {\r\n\t\t\t\t\tvar self = this;\r\n\t\t\t\t\tself.view.init({\r\n\t\t\t\t\t\tmodel : self.model,\r\n\t\t\t\t\t\tneedShopCreate : self.needShopCreate,\r\n\t\t\t\t\t\tcontainer : self.container\r\n\t\t\t\t\t});\r\n\t\t\t\t},\r\n\t\t\t\t// 过滤操作，触发显示结果\r\n\t\t\t\tfilter : function (params) {\r\n\t\t\t\t\tvar self = this;\r\n\t\t\t\t\tself.emit('query', params);\r\n\t\t\t\t\t//TODO 重置Query的chosenPanel\r\n\t\t\t\t},\r\n\t\t\t\t// 搜索操作，触发显示结果\r\n\t\t\t\tquery : function (params) {\r\n\t\t\t\t\tvar self = this;\r\n\t\t\t\t\tself.emit('query', params);\r\n\t\t\t\t}\r\n\t\t\t}, this);\r\n\t\t}\r\n\t});\r\n\tHualala.Order.QueryController = QueryController;\r\n})(jQuery, window);;(function ($, window) {\r\n\tIX.ns(\"Hualala.Order\");\r\n\t/*订单模块子页面布局*/\r\n\tvar initOrderPageLayout = function () {\r\n\t\tvar ctx = Hualala.PageRoute.getPageContextByPath();\r\n\t\tvar $body = $('#ix_wrapper > .ix-body > .container');\r\n\t\t$body.empty();\r\n\t\tvar mapNavRenderData = function () {\r\n\t\t\tvar curDateStamp = IX.Date.getDateByFormat(new Hualala.Date((new Date()).getTime() / 1000).toText(), 'yyyyMMdd');\r\n\t\t\tvar navs = _.map(Hualala.TypeDef.OrderSubNavType, function (v, i, list) {\r\n\t\t\t\tvar params = _.map($XP(v, 'pkeys', []), function (v) {\r\n\t\t\t\t\tif (v == 'startDate' || v == 'endDate') {\r\n\t\t\t\t\t\treturn curDateStamp;\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn '';\r\n\t\t\t\t});\r\n\r\n\t\t\t\treturn {\r\n\t\t\t\t\tactive : $XP(ctx, 'name') == v.name ? 'active' : '',\r\n\t\t\t\t\tdisabled : '',\r\n\t\t\t\t\tpath : Hualala.PageRoute.createPath(v.name, params) || '#',\r\n\t\t\t\t\tname : v.name,\r\n\t\t\t\t\tlabel : v.label,\r\n\t\t\t\t};\r\n\t\t\t});\r\n\t\t\treturn {\r\n\t\t\t\ttoggle : {\r\n\t\t\t\t\ttarget : '#order_navbar'\r\n\t\t\t\t},\r\n\t\t\t\titems : navs\r\n\t\t\t};\r\n\t\t};\r\n\t\tvar navTpl = Handlebars.compile(Hualala.TplLib.get('tpl_order_subnav'));\r\n\t\tHandlebars.registerPartial(\"toggle\", Hualala.TplLib.get('tpl_site_navbarToggle'));\r\n\t\t$body.html('<div class=\"order-subnav clearfix\" /><div class=\"order-body\" ><div class=\"order-query-box\"></div><div class=\"order-result-box\"></div></div>');\r\n\t\tvar $navbar = $body.find('.order-subnav'),\r\n\t\t\t$pageBody = $body.find('.order-body');\r\n\t\t$navbar.html(navTpl(mapNavRenderData()));\r\n\t};\r\n\t/*订单报表概览页面*/\r\n\tvar initOrderChartPage = function () {\r\n\t\tvar ctx = Hualala.PageRoute.getPageContextByPath();\r\n\t\tvar $body = $('#ix_wrapper > .ix-body > .container');\r\n\t\tinitOrderPageLayout();\r\n\t\t// Note: 暂时屏蔽概览页面，第二版将开启\r\n\t\tvar curDateStamp = IX.Date.getDateByFormat(new Hualala.Date((new Date()).getTime() / 1000).toText(), 'yyyyMMdd');\r\n\t\tvar pageCfg = _.find(Hualala.TypeDef.OrderSubNavType, function (el) {return el.name == 'orderQuery'}),\r\n\t\t\tpkeys = $XP(pageCfg, 'pkeys', []);\r\n\t\tpkeys = _.map(pkeys, function (v) {\r\n\t\t\tif (v == 'startDate' || v == 'endDate') {\r\n\t\t\t\treturn curDateStamp;\r\n\t\t\t}\r\n\t\t\treturn '';\r\n\t\t});\r\n\t\tdocument.location.href = Hualala.PageRoute.createPath('orderQuery', pkeys);\r\n\t};\r\n\t/*订单查询页面*/\r\n\tvar initQueryOrderPage = function () {\r\n\t\tvar ctx = Hualala.PageRoute.getPageContextByPath();\r\n\t\tvar $body = $('#ix_wrapper > .ix-body > .container');\r\n\t\tinitOrderPageLayout();\r\n\t\tvar $pageBody = $body.find('.order-body');\r\n\t\tvar queryKeys = $XP(_.findWhere(Hualala.TypeDef.OrderSubNavType, {name : $XP(ctx, 'name')}), 'pkeys');\r\n\t\tvar queryPanel = new Hualala.Order.QueryController({\r\n\t\t\tcontainer : $pageBody,\r\n\t\t\tresultController : new Hualala.Order.OrderListController({\r\n\t\t\t\tcontainer : $pageBody,\r\n\t\t\t\tmodel : new Hualala.Order.OrderQueryResultModel({\r\n\t\t\t\t\tcallServer : Hualala.Global.queryOrderDetail,\r\n\t\t\t\t\tqueryKeys : queryKeys,\r\n\t\t\t\t\tinitQueryParams : Hualala.Order.initQueryParams\r\n\t\t\t\t}),\r\n\t\t\t\tview : new Hualala.Order.OrderQueryResultView({\r\n\t\t\t\t\tmapResultRenderData : Hualala.Order.mapQueryOrderResultRenderData,\r\n\t\t\t\t\trenderResult : Hualala.Order.renderQueryOrderResult\r\n\t\t\t\t})\r\n\t\t\t}),\r\n\t\t\tmodel : new Hualala.Order.QueryModel({\r\n\t\t\t\tqueryKeys : queryKeys,\r\n\t\t\t\tinitQueryParams : Hualala.Order.initQueryParams\r\n\t\t\t}),\r\n\t\t\tview : new Hualala.Order.QueryView({\r\n\t\t\t\tmapRenderDataFn : Hualala.Order.mapOrderQueryFormRenderData\r\n\t\t\t})\r\n\t\t});\r\n\t};\r\n\t/*订单日汇总页面*/\r\n\tvar initQueryOrderDayDetailPage = function () {\r\n\t\tvar ctx = Hualala.PageRoute.getPageContextByPath();\r\n\t\tvar $body = $('#ix_wrapper > .ix-body > .container');\r\n\t\tinitOrderPageLayout();\r\n\t\tvar $pageBody = $body.find('.order-body');\r\n\t\tvar queryKeys = $XP(_.findWhere(Hualala.TypeDef.OrderSubNavType, {name : $XP(ctx, 'name')}), 'pkeys');\r\n\t\tvar queryPanel = new Hualala.Order.QueryController({\r\n\t\t\tcontainer : $pageBody,\r\n\t\t\tresultController : new Hualala.Order.OrderListController({\r\n\t\t\t\tcontainer : $pageBody,\r\n\t\t\t\tmodel : new Hualala.Order.OrderQueryResultModel({\r\n\t\t\t\t\tcallServer : Hualala.Global.queryOrderDayDetail,\r\n\t\t\t\t\tqueryKeys : queryKeys,\r\n\t\t\t\t\tinitQueryParams : Hualala.Order.initQueryParams\r\n\t\t\t\t}),\r\n\t\t\t\tview : new Hualala.Order.OrderQueryResultView({\r\n\t\t\t\t\tmapResultRenderData : Hualala.Order.mapQueryOrderDuringRenderData,\r\n\t\t\t\t\trenderResult : Hualala.Order.renderQueryOrderResult\r\n\t\t\t\t})\r\n\t\t\t}),\r\n\t\t\tmodel : new Hualala.Order.QueryModel({\r\n\t\t\t\tqueryKeys : queryKeys,\r\n\t\t\t\tinitQueryParams : Hualala.Order.initQueryParams\r\n\t\t\t}),\r\n\t\t\tview : new Hualala.Order.QueryView({\r\n\t\t\t\tmapRenderDataFn : Hualala.Order.mapOrderQueryBaseFormRenderData\r\n\t\t\t})\r\n\t\t});\r\n\t};\r\n\t/*订单期间汇总页面*/\r\n\tvar initQueryOrderDuringDetailPage = function () {\r\n\t\tvar ctx = Hualala.PageRoute.getPageContextByPath();\r\n\t\tvar $body = $('#ix_wrapper > .ix-body > .container');\r\n\t\tinitOrderPageLayout();\r\n\t\tvar $pageBody = $body.find('.order-body');\r\n\t\tvar queryKeys = $XP(_.findWhere(Hualala.TypeDef.OrderSubNavType, {name : $XP(ctx, 'name')}), 'pkeys');\r\n\t\tvar queryPanel = new Hualala.Order.QueryController({\r\n\t\t\tcontainer : $pageBody,\r\n\t\t\tresultController : new Hualala.Order.OrderListController({\r\n\t\t\t\tcontainer : $pageBody,\r\n\t\t\t\tmodel : new Hualala.Order.OrderQueryResultModel({\r\n\t\t\t\t\tcallServer : Hualala.Global.queryOrderDuringDetail,\r\n\t\t\t\t\tqueryKeys : queryKeys,\r\n\t\t\t\t\tinitQueryParams : Hualala.Order.initQueryParams\r\n\t\t\t\t}),\r\n\t\t\t\tview : new Hualala.Order.OrderQueryResultView({\r\n\t\t\t\t\tmapResultRenderData : Hualala.Order.mapQueryOrderDuringRenderData,\r\n\t\t\t\t\trenderResult : Hualala.Order.renderQueryOrderResult\r\n\t\t\t\t})\r\n\t\t\t}),\r\n\t\t\tmodel : new Hualala.Order.QueryModel({\r\n\t\t\t\tqueryKeys : queryKeys,\r\n\t\t\t\tinitQueryParams : Hualala.Order.initQueryParams\r\n\t\t\t}),\r\n\t\t\tview : new Hualala.Order.QueryView({\r\n\t\t\t\tmapRenderDataFn : Hualala.Order.mapOrderQueryBaseFormRenderData\r\n\t\t\t})\r\n\t\t});\r\n\t};\r\n\t/*菜品销售排行页面*/\r\n\tvar initQueryOrderDishesHotPage = function () {\r\n\t\tvar ctx = Hualala.PageRoute.getPageContextByPath();\r\n\t\tvar $body = $('#ix_wrapper > .ix-body > .container');\r\n\t\tinitOrderPageLayout();\r\n\t\tvar $pageBody = $body.find('.order-body');\r\n\t\tvar queryKeys = $XP(_.findWhere(Hualala.TypeDef.OrderSubNavType, {name : $XP(ctx, 'name')}), 'pkeys');\r\n\t\tvar queryPanel = new Hualala.Order.QueryController({\r\n\t\t\tcontainer : $pageBody,\r\n\t\t\tresultController : new Hualala.Order.OrderListController({\r\n\t\t\t\tcontainer : $pageBody,\r\n\t\t\t\tmodel : new Hualala.Order.OrderQueryResultModel({\r\n\t\t\t\t\thasPager : false,\r\n\t\t\t\t\tcallServer : Hualala.Global.queryOrderDishesHot,\r\n\t\t\t\t\tqueryKeys : queryKeys,\r\n\t\t\t\t\tinitQueryParams : Hualala.Order.initQueryParams\r\n\t\t\t\t}),\r\n\t\t\t\tview : new Hualala.Order.OrderQueryResultView({\r\n\t\t\t\t\tmapResultRenderData : Hualala.Order.mapQueryDishesHotRenderData,\r\n\t\t\t\t\trenderResult : Hualala.Order.renderQueryOrderResult\r\n\t\t\t\t})\r\n\t\t\t}),\r\n\t\t\tmodel : new Hualala.Order.QueryModel({\r\n\t\t\t\tqueryKeys : queryKeys,\r\n\t\t\t\tinitQueryParams : Hualala.Order.initQueryParams\r\n\t\t\t}),\r\n\t\t\tview : new Hualala.Order.QueryView({\r\n\t\t\t\tmapRenderDataFn : Hualala.Order.mapDishesHotQueryFormRenderData\r\n\t\t\t})\r\n\t\t});\r\n\t};\r\n\t/*顾客统计页面*/\r\n\tvar initQueryOrderCustomerPage = function () {\r\n\t\tvar ctx = Hualala.PageRoute.getPageContextByPath();\r\n\t\tvar $body = $('#ix_wrapper > .ix-body > .container');\r\n\t\tinitOrderPageLayout();\r\n\t\tvar $pageBody = $body.find('.order-body');\r\n\t\tvar queryKeys = $XP(_.findWhere(Hualala.TypeDef.OrderSubNavType, {name : $XP(ctx, 'name')}), 'pkeys');\r\n\t\tvar queryPanel = new Hualala.Order.QueryController({\r\n\t\t\tcontainer : $pageBody,\r\n\t\t\tresultController : new Hualala.Order.OrderListController({\r\n\t\t\t\tcontainer : $pageBody,\r\n\t\t\t\tmodel : new Hualala.Order.OrderQueryResultModel({\r\n\t\t\t\t\thasPager : false,\r\n\t\t\t\t\tcallServer : Hualala.Global.queryUserOrderStatistic,\r\n\t\t\t\t\tqueryKeys : queryKeys,\r\n\t\t\t\t\tinitQueryParams : Hualala.Order.initQueryParams\r\n\t\t\t\t}),\r\n\t\t\t\tview : new Hualala.Order.OrderQueryResultView({\r\n\t\t\t\t\tmapResultRenderData : Hualala.Order.mapQueryUserRenderData,\r\n\t\t\t\t\trenderResult : Hualala.Order.renderQueryOrderResult\r\n\t\t\t\t}) \r\n\t\t\t}),\r\n\t\t\tmodel : new Hualala.Order.QueryModel({\r\n\t\t\t\tqueryKeys : queryKeys,\r\n\t\t\t\tinitQueryParams : Hualala.Order.initQueryParams\r\n\t\t\t}),\r\n\t\t\tview : new Hualala.Order.QueryView({\r\n\t\t\t\tmapRenderDataFn : Hualala.Order.mapUsersQueryFormRenderData\r\n\t\t\t})\r\n\t\t});\r\n\t};\r\n\r\n\r\n\tHualala.Order.OrderPageLayoutInit = initOrderPageLayout;\r\n\tHualala.Order.OrderChartInit = initOrderChartPage;\r\n\tHualala.Order.QueryOrderInit = initQueryOrderPage;\r\n\tHualala.Order.QueryOrderByDayDetailInit = initQueryOrderDayDetailPage;\r\n\tHualala.Order.QueryOrderByDuringDetailInit = initQueryOrderDuringDetailPage;\r\n\tHualala.Order.QueryOrderDishesHotInit = initQueryOrderDishesHotPage;\r\n\tHualala.Order.QueryOrderCustomerInit = initQueryOrderCustomerPage;\r\n\r\n})(jQuery, window);;(function ($, window) {\r\n\tIX.ns(\"Hualala.Common\");\r\n\tvar pageBrickConfigs = [\r\n\t\t{name : 'account', title : '结算', label : '提现.账户设置.结算报表', brickClz : 'home-brick-md-2', itemClz : 'brick-item brick-item-2', icon : 'icon-pay'},\r\n\t\t{name : 'order', title : '订单', label : '报表.菜品排行', brickClz : 'home-brick-md-3', itemClz : 'brick-item', icon : 'icon-order'},\r\n\t\t{name : 'shop', title : '店铺管理', label : '开店.信息.菜谱', brickClz : 'home-brick-md-1', itemClz : 'brick-item', icon : 'icon-home'},\r\n\t\t{name : 'pcclient', title : '下载哗啦啦', label : '', brickClz : 'home-brick-md-1', itemClz : 'brick-item', icon : 'icon-download'},\r\n\t\t// Note: 先屏蔽这个模块， 第二版本开启\r\n\t\t{name : 'user', title : '账号管理', label : '账号.权限', brickClz : 'home-brick-md-1 hidden', itemClz : 'brick-item', icon : 'icon-lock'},\r\n\t\t{name : 'setting', title : '业务设置', label : '开通业务.业务参数', brickClz : 'home-brick-md-3', itemClz : 'brick-item', icon : 'icon-setting'}\r\n\t];\r\n\tfunction isSupportedBrowser () {\r\n\t\tvar bd = Hualala.Common.Browser;\r\n\t\tvar isIE = !$XP(bd, 'ie', null) ? false : true,\r\n\t\t\tversion = parseInt($XP(bd, 'ie', 0));\r\n\t\tvar allowOldVersion = IX.Cookie.get('allowOldVersion') == 1 ? true : false;\r\n\t\tif (!isIE || allowOldVersion) return true;\r\n\t\tif (version > 8) return true;\r\n\t\tvar msg = version == 8 ? \r\n\t\t\t'您使用的IE浏览器版本过于陈旧，可能无法获得我们为您提供的良好的用户体验。<br/>我们建议您使用以下的浏览器或插件进行访问！' : \r\n\t\t\t'您使用的IE浏览器版本过于陈旧，无法使用我们为您提供的管理功能。<br/>请您使用以下提供的浏览器进行访问！';\r\n\t\tvar browserLib = [\r\n\t\t\t{\r\n\t\t\t\thref : 'http://www.microsoft.com/zh-cn/download/internet-explorer-9-details.aspx',\r\n\t\t\t\ticon : 'icon-ie9',\r\n\t\t\t\tname : 'IE9',\r\n\t\t\t\tdesc : 'IE9浏览器是微软公司在2009年推出的新一代浏览器，比IE8界面更简洁，采用硬件加速功能，使访问页面更稳定，部分支持HTML5，CSS3特性。'\r\n\t\t\t},\r\n\t\t\t{\r\n\t\t\t\thref : 'http://www.microsoft.com/zh-cn/download/internet-explorer-10-details.aspx',\r\n\t\t\t\ticon : 'icon-ie10',\r\n\t\t\t\tname : 'IE10',\r\n\t\t\t\tdesc : 'IE10浏览器是微软公司在2011年推出的IE9的下一代浏览器，在IE9的基础上增强了CSS3解析及硬件加速功能，并支持了HTML5。'\r\n\t\t\t},\r\n\t\t\t{\r\n\t\t\t\thref : 'http://www.google.cn/intl/zh-CN/chrome/',\r\n\t\t\t\ticon : 'icon-chrome',\r\n\t\t\t\tname : 'Chrome',\r\n\t\t\t\tdesc : 'Chrome浏览器是由著名的搜索引擎巨头--谷歌(google)公司推出的现代浏览器，访问网页速度更快，稳定性更强，更具安全性，使用界面更加简洁有效，并完全支持HTML5，CSS3标准的特性。'\r\n\t\t\t},\r\n\t\t\t{\r\n\t\t\t\thref : 'http://www.firefox.com.cn/download/',\r\n\t\t\t\ticon : 'icon-firefox',\r\n\t\t\t\tname : 'Firefox',\r\n\t\t\t\tdesc : 'FireFox是Mozilla推出的现代浏览器，全面支持HTML5，CSS3标准的特性。访问页面速度更快，更具安全性。'\r\n\t\t\t},\r\n\t\t\t{\r\n\t\t\t\thref : 'http://ie.sogou.com/',\r\n\t\t\t\ticon : 'icon-sogou',\r\n\t\t\t\tname : '搜狗浏览器',\r\n\t\t\t\tdesc : '搜狗浏览器是搜狐公司推出的双核告诉浏览器--可以切换为全球最快的Webkit内核(Chrome浏览器)同时也可以切换为使用最普遍的IE内核(IE浏览器)，保证良好的兼容性的同时极大的提升网页的浏览速度。'\r\n\t\t\t}\r\n\t\t];\r\n\t\tvar tpl = Handlebars.compile(Hualala.TplLib.get('tpl_site_browserSupport'));\r\n\t\tvar $jumbotron = $(tpl({msg : msg, items : browserLib}));\r\n\t\t$('body > #ix_wrapper').remove();\r\n\t\t$jumbotron.appendTo($('body'));\r\n\t\t$jumbotron.find('.btn').click(function (e) {\r\n\t\t\tIX.Cookie.set('allowOldVersion', 1);\r\n\t\t\tHualala.Router.check();\r\n\t\t});\r\n\t\treturn false;\r\n\t}\r\n\tfunction initPageLayout (pageCfg, pageType) {\r\n\t\tvar session = Hualala.getSessionData(),\r\n\t\t\tlayoutTpl = Handlebars.compile(Hualala.TplLib.get('tpl_site_layout'));\r\n\t\tvar isLogin = !$XP(Hualala.getSessionUser(), 'loginName', null) ? false : true,\r\n\t\t\tloginName = $XP(session, 'user.loginName', ''),\r\n\t\t\tgroupName = $XP(session, 'site.groupName', '');\r\n\t\tvar mapRanderData = function () {\r\n\t\t\tvar header = {\r\n\t\t\t\tpcClientPath : Hualala.PageRoute.createPath('pcclient'),\r\n\t\t\t\thualalaUrl : Hualala.Global.HualalaWebSite,\r\n\t\t\t\tloginName : loginName,\r\n\t\t\t\tmerchantRoot : Hualala.PageRoute.createPath('main'),\r\n\t\t\t\tgroupName : groupName,\r\n\t\t\t\t// isLogin : !isLogin ? 'hidden' : '',\r\n\t\t\t\tisLogin : isLogin,\r\n\t\t\t\tlogoutPath : Hualala.Global.getLogoutJumpToUrl(),\r\n\t\t\t\tlogo : Hualala.Global.getDefaultImage('logo'),\r\n\t\t\t},\r\n\t\t\tfooter = {\r\n\t\t\t\taboutPath : Hualala.PageRoute.createPath(\"about\") || '#',\r\n\t\t\t\tcontactPath : Hualala.PageRoute.createPath(\"contact\") || '#',\r\n\t\t\t\t// aboutPath : Hualala.Global.getAboutUsUrl() || '#',\r\n\t\t\t\t// contactPath : Hualala.Global.getContactUsUrl() || '#',\r\n\t\t\t\tgozapLogo : Hualala.Global.getDefaultImage('gozap')\r\n\t\t\t};\r\n\t\t\treturn {\r\n\t\t\t\theader : header,\r\n\t\t\t\tfooter : footer\r\n\t\t\t};\r\n\t\t};\r\n\t\tvar $wrapper = $(layoutTpl(mapRanderData()));\r\n\t\t$('body > #ix_wrapper').remove();\r\n\t\tif (isSupportedBrowser()) {\r\n\t\t\t$wrapper.appendTo($('body'));\r\n\t\t}\r\n\t\tif ($.fn.bootstrapValidator) {\r\n\t\t\t$.fn.bootstrapValidator.DEFAULT_OPTIONS = $.extend({}, $.fn.bootstrapValidator.DEFAULT_OPTIONS, {\r\n\t\t\t\tmessage: '您输入的数据有误，请核对后再次输入',\r\n                trigger: 'blur',\r\n\t\t\t\tfeedbackIcons : {\r\n\t\t\t\t\tvalid : 'glyphicon glyphicon-ok',\r\n\t\t\t\t\tinvalid : 'glyphicon glyphicon-remove',\r\n\t\t\t\t\tvalidating : 'glyphicon glyphicon-refresh'\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\t$.fn.bootstrapValidator.validators.accuracy = {\r\n\t\t\t\tvalidate : function (validator, $field, options) {\r\n\t\t\t\t\tvar accuracy = $XP(options, 'accuracy', null),\r\n\t\t\t\t\t\tmessage = $XP(options, 'message', '');\r\n\t\t\t\t\taccuracy = isNaN(accuracy) ? null : accuracy;\r\n\t\t\t\t\tvar value = $field.val();\r\n\t\t\t\t\tvar regxStr = (IX.isEmpty(accuracy) || accuracy == 0) ? \"^\\\\d+$\" : \"^\\\\d+(\\\\.\\\\d{1,\" + accuracy + \"})?$\",\r\n\t\t\t\t\t\tregX = null;\r\n\t\t\t\t\tregX = new RegExp(regxStr);\r\n\t\t\t\t\tif (isNaN(value)) {\r\n\t\t\t\t\t\treturn {\r\n\t\t\t\t\t\t\tvalid : false,\r\n\t\t\t\t\t\t\tmessage : \"只能是数字\"\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (!regX.test(value)) {\r\n\t\t\t\t\t\treturn {\r\n\t\t\t\t\t\t\tvalid : false,\r\n\t\t\t\t\t\t\tmessage : message\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn true;\r\n\t\t\t\t}\r\n\t\t\t};\r\n\t\t}\r\n\t}\r\n\r\n\tfunction initSiteNavBar (pageType) {\r\n\t\tvar session = Hualala.getSessionData(),\r\n\t\t\tnavTpl = Handlebars.compile(Hualala.TplLib.get('tpl_site_navbar')),\r\n\t\t\tnavToggleTpl = Handlebars.compile(Hualala.TplLib.get('tpl_site_navbarToggle'));\r\n\t\tvar mapRanderData = function () {\r\n\t\t\tvar navs = _.map(Hualala.TypeDef.SiteNavType, function (v, i, list) {\r\n\t\t\t\treturn {\r\n\t\t\t\t\tactive : !Hualala.Global.isCurrentPage(v.name) ? '' : 'active',\r\n\t\t\t\t\tdisabled : '',\r\n\t\t\t\t\tpath : Hualala.PageRoute.createPath(v.name) || '#',\r\n\t\t\t\t\tname : v.name,\r\n\t\t\t\t\tlabel : v.label,\r\n\t\t\t\t};\r\n\t\t\t});\r\n\t\t\treturn {items : navs};\r\n\t\t};\r\n\t\tvar $navbar = $(navTpl(mapRanderData())),\r\n\t\t\t$navToggle = $(navToggleTpl({target : '#site_navbar'})),\r\n\t\t\t$header = $('#ix_wrapper .ix-header');\r\n\t\t$header.find('> .container .navbar-collapse').remove();\r\n\t\t$header.find('> .container').append($navbar);\r\n\t\t$header.find('> .container > .navbar-header .navbar-toggle').remove();\r\n\t\t$header.find('> .container > .navbar-header').prepend($navToggle);\r\n\r\n\t}\r\n\r\n\tfunction initHomePage (pageType, params) {\r\n\t\tvar site = Hualala.getSessionSite(),\r\n\t\t\tuser = Hualala.getSessionUser(),\r\n\t\t\troles = Hualala.getSessionRoles(),\r\n\t\t\tpcclient = Hualala.getSessionPCClient(),\r\n\t\t\trights = Hualala.getSessionUserRight();\r\n\t\tvar $body = $('#ix_wrapper > .ix-body > .container');\r\n\t\tvar mapRanderData = function () {\r\n\t\t\tvar ht = new IX.IListManager();\r\n\t\t\tvar ret = null;\r\n\t\t\tIX.iterate(rights, function (el) {\r\n\t\t\t\tht.register(el.name, el);\r\n\t\t\t});\r\n\t\t\tret = _.map(pageBrickConfigs, function (el, i, l) {\r\n\t\t\t\tvar name = $XP(el, 'name');\r\n\t\t\t\tvar hasRight = !ht.get(name) ? false : true;\r\n\t\t\t\treturn IX.inherit(el, {\r\n\t\t\t\t\titemClz : ($XP(el, 'itemClz', '') + ' ' + (!hasRight ? 'disabled' : ''))\r\n\t\t\t\t});\r\n\t\t\t});\r\n\t\t\treturn ret;\r\n\t\t};\r\n\t\t// Home Page \r\n\t\tvar tpl = Handlebars.compile(Hualala.TplLib.get('tpl_site_homepage'));\r\n\t\tvar $bricks = $(tpl({bricks : mapRanderData()}));\r\n\t\t$body.html($bricks);\r\n\t\t$bricks.on('mouseenter mouseleave click', '.brick-item', function (e) {\r\n\t\t\tvar $this = $(this), pageName = $this.attr('data-pagename'),\r\n\t\t\t\teType = e.type;\r\n\t\t\tif ($this.hasClass('disabled')) return false;\r\n\t\t\tif (eType == 'click') {\r\n\t\t\t\t// console.info($this.attr('data-pagename'));\r\n\t\t\t\tdocument.location.href = Hualala.PageRoute.createPath(pageName);\r\n\t\t\t} else {\r\n\t\t\t\t$this.toggleClass('hover');\r\n\t\t\t}\r\n\t\t\t\r\n\t\t});\r\n\t}\r\n\r\n\tfunction initLoginPage (pageType, params) {\r\n\t\tvar tpl = Handlebars.compile(Hualala.TplLib.get('tpl_site_login'));\r\n\t\tvar $loginBox = $(tpl({\r\n\t\t\tbannerImg : Hualala.Global.getDefaultImage('loginBanner')\r\n\t\t}));\r\n\t\tvar $body = $('#ix_wrapper > .ix-body > .container');\r\n\t\t$body.html($loginBox);\r\n\t\tHualala.Entry.initLogin($loginBox);\r\n\t}\r\n\r\n\tfunction initAboutPage (pageType, params) {\r\n\t\tvar $body = $('#ix_wrapper > .ix-body');\r\n\t\tvar tpl = Handlebars.compile(Hualala.TplLib.get('tpl_site_about'));\r\n\t\tvar $page = $(tpl());\r\n\t\t$page.replaceAll($body);\r\n\t}\r\n\r\n\tfunction initContactPage (pageType, params) {\r\n\t\tvar $body = $('#ix_wrapper > .ix-body');\r\n\t\tvar tpl = Handlebars.compile(Hualala.TplLib.get('tpl_site_contact'));\r\n\t\tvar $page = $(tpl());\r\n\t\t$page.replaceAll($body);\r\n\t}\r\n\r\n\tfunction initPCClientDownloadPage () {\r\n\t\tvar $body = $('#ix_wrapper > .ix-body');\r\n\t\tvar tpl = Handlebars.compile(Hualala.TplLib.get('tpl_client_download'));\r\n\t\tvar sessionData = Hualala.getSessionData();\r\n\r\n\t\tvar $page = $(tpl({\r\n\t\t\thref : $XP(sessionData, 'pcClient.downloadClientAddress', '#'),\r\n\t\t\ttitle : $XP(sessionData, 'pcClient.version', ''),\r\n\t\t}));\r\n\t\t$page.replaceAll($body);\r\n\t}\r\n\r\n\r\n\tHualala.Common.LoginInit = initLoginPage;\r\n\tHualala.Common.initPageLayout = initPageLayout;\r\n\tHualala.Common.initSiteNavBar = initSiteNavBar;\r\n\tHualala.Common.HomePageInit = initHomePage;\r\n\tHualala.Common.AboutInit = initAboutPage;\r\n\tHualala.Common.ContactInit = initContactPage;\r\n\tHualala.Common.PCClientDownloadInit = initPCClientDownloadPage;\r\n\t\r\n\r\n\tHualala.Common.IndexInit = function () {\r\n\t\tdocument.location.href = Hualala.PageRoute.createPath(\"main\");\r\n\t}\r\n\t\r\n})(jQuery, window);;(function ($, window) {\r\n\tIX.ns(\"Hualala\");\r\n\tvar sessionData = null;\r\n\t// 获取SessionData\r\n\tHualala.getSessionData = function () {return sessionData;};\r\n\tHualala.getSessionSite = function () {return $XP(sessionData, 'site', null); };\r\n\tHualala.getSessionUser = function () {return $XP(sessionData, 'user', null); };\r\n\tHualala.getSessionRoles = function () {return $XP(sessionData, 'roles', []); };\r\n\tHualala.getSessionPCClient = function () {return $XP(sessionData, 'pcClient', null); };\r\n\tHualala.getSessionUserRight = function () {return $XP(sessionData, 'userRight', [])};\r\n\t// 判断指定用户是否为当前登录用户\r\n\tHualala.isSessionUser = function (groupLoginName, loginName) {\r\n\t\tvar _name = $XP(sessionData, 'user.groupLoginName') + $XP(sessionData, 'user.loginName');\r\n\t\treturn sessionData && _name == (groupLoginName + loginName);\r\n\t};\r\n\r\n\tfunction loadSession(appData, cbFn) {\r\n\t\tif (!$XP(appData, 'user', null)) {\r\n\t\t\tthrow(\"Permission Deny!!\");\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tsessionData = appData;\r\n\t\tcbFn();\r\n\t}\r\n\r\n\tfunction initMainPage(cbFn) {\r\n\t\tvar tick = IX.getTimeInMS();\r\n\t\tlog(\"Merchant Sys INIT : \" + tick);\r\n\t\tHualala.Global.loadAppData({}, function (appData) {\r\n\t\t\tlog(\"Load Merchant APP Data in (ms): \" + (IX.getTimeInMS() - tick));\r\n\t\t\tif ($XP(appData, 'resultcode') != 0) {\r\n\t\t\t\tdocument.location.href = Hualala.PageRoute.createPath('login');\r\n\t\t\t\tthrow(\"Session Data Load Faild!! resultcode = \" + $XP(appData, 'resultcode', '') + \"; resultMsg = \" + $XP(appData, 'resultmsg', ''));\r\n\t\t\t\treturn;\t\r\n\t\t\t}\r\n\t\t\tloadSession($XP(appData, 'data', {}), function () {\r\n\t\t\t\tlog(\"Merchant Sys INIT DONE in (ms): \" + (IX.getTimeInMS() - tick));\r\n\t\t\t\tcbFn();\r\n\t\t\t});\r\n\t\t}, function () {\r\n\t\t\tdocument.location.href = Hualala.PageRoute.createPath('login');\r\n\t\t\treturn ;\r\n\t\t});\r\n\t}\r\n\r\n\tfunction initRouteEngine () {\r\n\t\tif (!IX.nsExisted(\"Hualala.ajaxEngine.init\")) return;\r\n\t\t$.ajaxSetup({\r\n\t\t\tbeforeSend : function (xhr) {\r\n\t\t\t\txhr.setRequestHeader('X-CSRF-Token', $('meta[name=\"csrf-token\"]').attr('content'));\r\n\t\t\t}\r\n\t\t});\r\n\t\tHualala.ajaxEngine.init({\r\n\t\t\tajaxFn : jQuery.ajax,\r\n\t\t\tbaseUrl : Hualala.Global.HOME,\r\n\t\t\tcommonUrl : Hualala.Global.CommonSite,\r\n\t\t\timgUrl : Hualala.Global.IMAGE_ROOT\r\n\t\t});\r\n\t\t// Hualala.urlEngine would be initialized as ajaxEngine was initialized! ignore urlEngine's initializing.\r\n\t};\r\n\r\n\t\r\n\t/**\r\n\t * 商户系统整体加载\r\n\t * @param  {Object} cfg {config:{}, type : \"页面类型login|main|shop|setting|account|user...\"}\r\n\t * @return {NULL}     \r\n\t */\r\n\tvar APPInitialized = false, currentType;\r\n\t\r\n\tHualala.init = function () {\r\n\t\tif (!APPInitialized) {\r\n\t\t\tinitRouteEngine();\r\n\t\t\t\r\n\t\t\t// initMainPage(function () {\r\n\t\t\t// \tHualala.PageRoute.start(function (pageName) {\r\n\t\t\t// \t\tvar hasNoNavPages = 'main,pcclient,about,contact';\r\n\t\t\t// \t\tHualala.Common.initPageLayout({}, pageName);\r\n\t\t\t// \t\tif (hasNoNavPages.indexOf(pageName) < 0) {\r\n\t\t\t// \t\t\tHualala.Common.initSiteNavBar(pageName);\r\n\t\t\t// \t\t}\r\n\t\t\t// \t});\r\n\t\t\t// });\r\n\t\t\tHualala.PageRoute.start(function (pageName, pageParams, pageInitFn) {\r\n\t\t\t\tvar hasNoNavPages = 'main,pcclient,about,contact,login';\r\n\t\t\t\tvar commonPages = _.filter(hasNoNavPages.split(','), function (v) {return v != 'main'}).join(',');\r\n\t\t\t\tif (commonPages.indexOf(pageName) >= 0) {\r\n\t\t\t\t\tHualala.Common.initPageLayout({}, pageName);\r\n\t\t\t\t\tif (hasNoNavPages.indexOf(pageName) < 0) {\r\n\t\t\t\t\t\tHualala.Common.initSiteNavBar(pageName);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tpageInitFn && pageInitFn.apply(null, [pageName, pageParams]);\r\n\t\t\t\t\treturn ;\r\n\t\t\t\t}\r\n\t\t\t\tinitMainPage(function () {\r\n\t\t\t\t\tHualala.Common.initPageLayout({}, pageName);\r\n\t\t\t\t\tif (hasNoNavPages.indexOf(pageName) < 0) {\r\n\t\t\t\t\t\tHualala.Common.initSiteNavBar(pageName);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tpageInitFn && pageInitFn.apply(null, [pageName, pageParams]);\r\n\t\t\t\t});\r\n\t\t\t});\r\n\t\t\tAPPInitialized = true;\r\n\t\t}\r\n\t};\r\n\r\n})(jQuery, window);;(function ($, window) {\r\n\tIX.ns(\"Hualala.PageRoute\");\r\n\tvar Router = Hualala.Router,\r\n\t\troutes = Hualala.Global.Route;\r\n\tvar isInitialized = false,\r\n\t\tPageConfigurations = {},\r\n\t\tPath2NameMapping = {};\r\n\r\n\tfunction mappingRoute (_path, _name, _reg) {\r\n\t\tvar match = _path.match(_reg);\r\n\t\tif (!match) return;\r\n\t\tvar s = match.shift(),\r\n\t\t\tarr = s.split('/');\r\n\t\tarr = _.map(arr, function (v, i, l) {\r\n\t\t\tvar bingo = _.indexOf(s, v);\r\n\t\t\tif (bingo > -1) {\r\n\t\t\t\treturn '_';\r\n\t\t\t}\r\n\t\t\treturn v;\r\n\t\t});\r\n\t\tarr.push(\"\"); arr.unshift(\"\");\r\n\t\tvar _pattern = arr.join(\"_\");\r\n\t\tPath2NameMapping[_pattern] = _name;\r\n\t}\r\n\r\n\tvar detectPageInitializor = (function () {\r\n\t\tvar ht = new IX.I1ToNManager();\r\n\t\tvar fnames = [];\r\n\t\tfunction _checkItem(fname) {\r\n\t\t\tif (!IX.isFn(IX.getNS(fname)))\r\n\t\t\t\treturn false;\r\n\t\t\tvar _list = ht.get(fname),\r\n\t\t\t\t_fn = IX.getNS(fname);\r\n\t\t\tfor (var j = 0; j < _list.length; j++)\r\n\t\t\t\tPageConfigurations[_list[j]].init = _fn;\r\n\t\t\tht.remove(fname);\r\n\t\t\treturn true;\r\n\t\t}\r\n\r\n\t\tfunction _checking() {\r\n\t\t\tfnames = IX.loop(fnames, [], function (acc, fname) {\r\n\t\t\t\tif (!_checkItem(fname))\r\n\t\t\t\t\tacc.push(fname);\r\n\t\t\t\treturn acc;\r\n\t\t\t});\r\n\t\t\treturn fnames.length == 0;\r\n\t\t}\r\n\r\n\t\tfunction _check () {\r\n\t\t\tfnames = IX.Array.toSet(fnames);\r\n\t\t\tIX.checkReady(_checking, IX.emptyFn, 40, {\r\n\t\t\t\tmaxAge : 15000,\r\n\t\t\t\texpire : function () {\r\n\t\t\t\t\talert(\"Can't find page inializor : \\n\" + fnames.join(\"\\n\"));\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\t\t\r\n\t\tfunction _detect(name, fname) {\r\n\t\t\tvar _fn = null;\r\n\t\t\tif (IX.isFn(fname)) {\r\n\t\t\t\t_fn = fname;\r\n\t\t\t} else if (!IX.isString(fname)) {\r\n\t\t\t\tthrow(\"Configuration failed : Invalid Page Initialized for \" + name);\r\n\t\t\t\treturn false;\r\n\t\t\t} else if (IX.nsExisted(fname)) {\r\n\t\t\t\t_fn = IX.getNS(fname);\r\n\t\t\t}\r\n\t\t\tif (IX.isFn(_fn)) {\r\n\t\t\t\treturn PageConfigurations[name].init = _fn;\r\n\t\t\t}\r\n\t\t\tht.put(fname, name);\r\n\t\t\tfnames.push(fname);\r\n\t\t}\r\n\t\treturn {\r\n\t\t\tstart : function () {setTimeout(_check, 1);},\r\n\t\t\tdetect : _detect\r\n\t\t}\r\n\t})();\r\n\r\n\t/**\r\n\t * 获取路由路径\r\n\t * @param  {String} name   路由配置的名称\r\n\t * @param  {Array|NULL} params 组装路由需要的参数，按照路由规则按顺序给出参数\r\n\t * @return {String}        返回生成的路由\r\n\t */\r\n\tfunction getPathByName (name, params) {\r\n\t\tvar cfg = PageConfigurations[name];\r\n\t\tif (!cfg) \r\n\t\t\treturn console.err(\"Can't find route : \" + name);\r\n\t\tvar path = $XP(cfg, 'path'), reg = $XP(cfg, 'reg'),\r\n\t\t\tmatch = path.match(reg);\r\n\t\tvar genPath = function (p) {\r\n\t\t\treturn Hualala.Global.HOME + p;\r\n\t\t};\r\n\t\tif (!match || match.length < 1) {\r\n\t\t\treturn console.err(\"The Path of Route (\" + name + \") is wrong!!\");\r\n\t\t} else if (match.length == 1) {\r\n\t\t\treturn genPath(path);\r\n\t\t} else if (match.length > 1 && IX.isArray(params) && (match.length - 1) == params.length) {\r\n\t\t\tmatch.shift();\r\n\t\t\t_.each(match, function (v, i, m) {\r\n\t\t\t\tpath = path.replace(v, params[i]);\r\n\t\t\t});\r\n\t\t\treturn genPath(path);\r\n\t\t}\r\n\t}\r\n\t/**\r\n\t * pageConfig : {\r\n\t * \t\tname : \"\",\r\n\t * \t\tpath : \"\",\r\n\t * \t\treg : RegExp,\r\n\t * \t\tbodyClz : \"\", default \"\"\r\n\t * \t\tPageInitiator : \"Hualala.User.init\" or function (cfg) {}\r\n\t * }\r\n\t * @param  {[type]} cbFn [description]\r\n\t * @return {[type]}      [description]\r\n\t */\r\n\tvar pageConfigs = [\r\n\t\t// home page 主页\r\n\t\t// 登录\r\n\t\t{\r\n\t\t\tname : \"login\", path : \"/#login\", reg : /login$/, bodyClz : \"\",\r\n\t\t\tPageInitiator : \"Hualala.Common.LoginInit\", label : \"登录\"\r\n\t\t},\r\n\t\t// home page主页\r\n\t\t{\r\n\t\t\tname : \"main\", path : \"/#home\", reg : /home$/, bodyClz : \"\",\r\n\t\t\tPageInitiator : \"Hualala.Common.HomePageInit\", label : \"首页\"\r\n\t\t},\r\n\r\n\t\t// 店铺管理主页\t\t\r\n\t\t{\r\n\t\t\tname : \"shop\", path : \"/#shop\", reg : /shop$/, bodyClz : \"\",\r\n\t\t\tPageInitiator : \"Hualala.Shop.HomePageInit\", parentName : \"main\", label : \"店铺管理\"\r\n\t\t},\r\n\t\t// 创建店铺\r\n\t\t{\r\n\t\t\tname : \"shopCreate\", path : \"/#shop/create\", reg : /shop\\/create$/, bodyClz : \"\",\r\n\t\t\tPageInitiator : \"Hualala.Shop.CreateShopInit\", parentName : \"shop\", label : \"创建店铺\"\r\n\t\t},\r\n\t\t// 店铺信息管理\r\n\t\t{\r\n\t\t\tname : \"shopInfo\", path : \"/#shop/{id}/info\", reg : /shop\\/(.*)\\/info$/, bodyClz : \"\",\r\n\t\t\tPageInitiator : \"Hualala.Shop.BaseInfoMgrInit\", parentName : \"shop\", label : \"店铺信息\"\r\n\t\t},\r\n\t\t// 店铺菜单管理\r\n\t\t{\r\n\t\t\tname : \"shopMenu\", path : \"/#shop/{id}/menu\", reg : /shop\\/(.*)\\/menu$/, bodyClz : \"\",\r\n\t\t\tPageInitiator : \"Hualala.Shop.FoodMenuMgrInit\", parentName : \"shop\", label : \"菜单管理\"\r\n\t\t},\r\n\r\n\t\t// 店铺功能设置页面\r\n\t\t{\r\n\t\t\tname : \"setting\", path : \"/#setting\", reg : /setting$/, bodyClz : \"\",\r\n\t\t\tPageInitiator : \"Hualala.Setting.ShopMgrInit\", parentName : \"main\", label : \"业务设置\"\r\n\t\t},\r\n\r\n\t\t// 结算账户页面\r\n\t\t{\r\n\t\t\tname : \"account\", path : \"/#account\", reg : /account$/, bodyClz : \"\",\r\n\t\t\tPageInitiator : \"Hualala.Account.AccountListInit\", parentName : \"main\", label : \"账户结算\"\r\n\t\t},\r\n\t\t// 结算账户详情设置页面\r\n\t\t{\r\n\t\t\tname : \"accountDetail\", path : \"/#account/{id}/detail\", reg : /account\\/(.*)\\/detail$/, bodyClz : \"\",\r\n\t\t\tPageInitiator : \"Hualala.Account.AccountMgrInit\", parentName : \"account\", label : \"账户明细\"\r\n\t\t},\r\n\r\n\t\t// 账号管理页面\r\n\t\t// Note: 先屏蔽，第二版本开启\r\n\t\t// {\r\n\t\t// \tname : \"user\", path : \"/#user\", reg : /user$/, bodyClz : \"\",\r\n\t\t// \tPageInitiator : \"Hualala.User.UserListInit\", parentName : \"main\", label : \"账号管理\"\r\n\t\t// },\r\n\r\n\t\t// 订单报表页面\r\n\t\t{\r\n\t\t\tname : \"order\", path : \"/#order\", reg : /order$/, bodyClz : \"\",\r\n\t\t\tPageInitiator : \"Hualala.Order.OrderChartInit\", parentName : \"main\", label : \"订单报表\"\r\n\t\t},\r\n\r\n\t\t// 订单查询页面\r\n\t\t/*\r\n\t\t\tb : begin date(SecondTick)\r\n\t\t\te : end date(SecondTick)\r\n\t\t\tc : city ID\r\n\t\t\ts : order status ID\r\n\t\t\tn : shop ID\r\n\t\t\tm : mobile number\r\n\t\t\to : order key\r\n\t\t\ti : min amount\r\n\t\t\ta : max amount\r\n\r\n\t\t */\r\n\t\t{\r\n\t\t\tname : \"orderQuery\", path : \"/#order/query/b{begin}/e{end}/c{cityID}/n{shopID}/s{status}/m{mobile}/o{orderKey}/i{minAmount}/a{maxAmount}\", \r\n\t\t\treg : /order\\/query\\/b(.*)\\/e(.*)\\/c(.*)\\/n(.*)\\/s(.*)\\/m(.*)\\/o(.*)\\/i(.*)\\/a(.*)$/,\r\n\t\t\tbodyClz : \"\", PageInitiator : \"Hualala.Order.QueryOrderInit\", parentName : \"main\", label : \"订单查询\"\r\n\t\t},\r\n\r\n\t\t// 订单日汇总页面\r\n\t\t/*\r\n\t\t\tb : begin date(SecondTick)\r\n\t\t\te : end date(SecondTick)\r\n\t\t\tc : city ID\r\n\t\t\ts : order status ID\r\n\t\t\tn : shop ID\r\n\t\t */\r\n\t\t{\r\n\t\t\tname : \"orderQueryDay\", path : \"/#order/query/day/b{begin}/e{end}/c{cityID}/n{shopID}/s{status}\",\r\n\t\t\treg : /order\\/query\\/day\\/b(.*)\\/e(.*)\\/c(.*)\\/n(.*)\\/s(.*)/, bodyClz : \"\",\r\n\t\t\tPageInitiator : \"Hualala.Order.QueryOrderByDayDetailInit\", parentName : \"main\", label : \"订单日汇总\"\r\n\t\t},\r\n\r\n\t\t// 订单期间汇总页面\r\n\t\t/*\r\n\t\t\tb : begin date(SecondTick)\r\n\t\t\te : end date(SecondTick)\r\n\t\t\tc : city ID\r\n\t\t\ts : order status ID\r\n\t\t\tn : shop ID\r\n\t\t */\r\n\t\t{\r\n\t\t\tname : \"orderQueryDuring\", path : \"/#order/query/during/b{begin}/e{end}/c{cityID}/n{shopID}/s{status}\",\r\n\t\t\treg : /order\\/query\\/during\\/b(.*)\\/e(.*)\\/c(.*)\\/n(.*)\\/s(.*)/, bodyClz : \"\", \r\n\t\t\tPageInitiator : \"Hualala.Order.QueryOrderByDuringDetailInit\", parentName : \"main\", label : \"订单期间汇总\"\r\n\t\t},\r\n\r\n\t\t// 菜品销售排行页面\r\n\t\t/*\r\n\t\t\tb : begin date(SecondTick)\r\n\t\t\te : end date(SecondTick)\r\n\t\t\tc : city ID\r\n\t\t\tn : shopID\r\n\t\t\ts : foodCategoryName\r\n\t\t */\r\n\t\t{\r\n\t\t\tname : \"orderDishesHot\", path : \"/#order/dishes/hot/b{begin}/e{end}/c{cityID}/n{shopID}/s{foodCategoryName}\",\r\n\t\t\treg : /order\\/dishes\\/hot\\/b(.*)\\/e(.*)\\/c(.*)\\/n(.*)\\/s(.*)/, bodyClz : \"\",\r\n\t\t\tPageInitiator : \"Hualala.Order.QueryOrderDishesHotInit\", parentName : \"main\", label : \"菜品销量排行\"\r\n\t\t},\r\n\r\n\t\t// 订餐客户查询页面\r\n\t\t/*\r\n\t\t\tb : begin date(SecondTick)\r\n\t\t\te : end date(SecondTick)\r\n\t\t\tc : city ID\r\n\t\t\tn : shopID\r\n\t\t\tu : customerName\r\n\t\t\tm : mobile\r\n\t\t */\r\n\t\t{\r\n\t\t\tname : \"orderQueryCustomer\", path : \"/#order/customer/b{begin}/e{end}/c{cityID}/n{shopID}/m{mobile}/u{customerName}\",\r\n\t\t\treg : /order\\/customer\\/b(.*)\\/e(.*)\\/c(.*)\\/n(.*)\\/m(.*)\\/u(.*)/, bodyClz : \"\",\r\n\t\t\tPageInitiator : \"Hualala.Order.QueryOrderCustomerInit\", parentName : \"main\", label : \"顾客统计\"\r\n\t\t},\r\n\r\n\r\n\t\t// PC客户端下载页面\r\n\t\t{\r\n\t\t\tname : \"pcclient\", path : \"/#download\", reg : /download$/, bodyClz : \"\",\r\n\t\t\tPageInitiator : \"Hualala.Common.PCClientDownloadInit\", parentName : \"main\", label : \"客户端下载\"\r\n\t\t},\r\n\r\n\t\t// 关于商户中心\r\n\t\t{\r\n\t\t\tname : \"about\", path : \"/#about\", reg : /about$/, bodyClz : \"\",\r\n\t\t\tPageInitiator : \"Hualala.Common.AboutInit\", parentName : \"main\", label : \"关于\"\r\n\t\t},\r\n\r\n\t\t// 联系我们\r\n\t\t{\r\n\t\t\tname : \"contact\", path : \"/#contact\", reg : /contact$/, bodyClz : \"\",\r\n\t\t\tPageInitiator : \"Hualala.Common.ContactInit\", parentName : \"main\", label : \"联系我们\"\r\n\t\t},\r\n\t\t// 上面的path都匹配不到，需要自动跳转home\r\n\t\t{\r\n\t\t\tname : \"index\", path : \"\", reg : /(.*)$/, bodyClz : \"\",\r\n\t\t\tPageInitiator : \"Hualala.Common.IndexInit\"\r\n\t\t}\r\n\t];\r\n\tIX.iterate(pageConfigs, function (cfg) {\r\n\t\tvar _cfg = IX.inherit({\r\n\t\t\tbodyClz : \"ix-minor\",\r\n\t\t\tpath : \"\"\r\n\t\t}, cfg);\r\n\t\tvar _name = $XP(cfg, 'name'), _path = $XP(cfg, 'path'), _reg = $XP(cfg, 'reg');\r\n\t\tmappingRoute(_path, _name, _reg);\r\n\t\tPageConfigurations[_name] = {\r\n\t\t\tname : _name, bodyClz : $XP(_cfg, 'bodyClz', ''), path : _path, reg : $XP(_cfg, 'reg', null),\r\n\t\t\tparentName : $XP(cfg, 'parentName', null), label : $XP(cfg, 'label', '')\r\n\t\t};\r\n\t\tvar _pageInit = \"PageInitiator\" in _cfg ? _cfg.PageInitiator : null;\r\n\t\tif (!IX.isString(_pageInit) && !IX.isFn(_pageInit))\r\n\t\t\t_pageInit = IX.emptyFn;\r\n\t\tdetectPageInitializor.detect(_name, _pageInit);\r\n\t});\r\n\tdetectPageInitializor.start();\r\n\r\n\r\n\tHualala.PageRoute.start = function (cbFn) {\r\n\t\tisInitialized = true;\r\n\t\tRouter.flush().config({mode : 'history', root : Hualala.Global.HOME});\r\n\t\t// Router.flush().config({mode : 'history'});\r\n\t\t// IE Browser can not support this method ??\r\n\t\t_.each(PageConfigurations, function (route, name, l) {\r\n\t\t\tvar re = $XP(route, 'reg'), initFn = $XF(route, 'init'), handler = null;\r\n\t\t\t\r\n\t\t\thandler = function (params) {\r\n\t\t\t\tIX.Debug.info(\"INFO: Init Page : [\" + name + \"]\");\r\n\t\t\t\tIX.Debug.info(\"INFO: Page Arguments : [\" + params + \"]\");\r\n\t\t\t\tIX.isFn(cbFn) && cbFn(name, params, initFn);\r\n\t\t\t\t\r\n\t\t\t\t// initFn && initFn.apply(null, [name, params]);\r\n\t\t\t};\r\n\t\t\t\r\n\t\t\tRouter.add(re, handler);\r\n\t\t});\r\n\t\tRouter.listen().check();\r\n\t};\r\n\r\n\tHualala.PageRoute.createPath = getPathByName;\r\n\r\n\tHualala.PageRoute.getCurrentPath = function () {\r\n\t\treturn location.hash;\r\n\t};\r\n\r\n\tHualala.PageRoute.getPageContextByPath = function (path) {\r\n\t\tvar fragment = path || Hualala.Router.getFragment();\r\n\t\tvar match = _.filter(PageConfigurations, function (el, k, l) {\r\n\t\t\treturn !!fragment.match(el.reg);\r\n\t\t});\r\n\t\tvar params = null;\r\n\t\tif (match.length == 0) return null;\r\n\t\tif (match.length == 1) {\r\n\t\t\tparams = fragment.match(match[0]['reg']);\r\n\t\t\tparams.shift();\r\n\t\t\treturn IX.inherit({params : params}, match[0]);\r\n\t\t}\r\n\t\tmatch = _.filter(match, function (el, k, l) {\r\n\t\t\treturn el.name != 'index';\r\n\t\t});\r\n\t\tparams = fragment.match(match[match.length - 1]['reg']);\r\n\t\tparams.shift();\r\n\t\treturn IX.inherit({params : params}, match[match.length - 1]);\r\n\t};\r\n\r\n\tHualala.PageRoute.getParentNamesByPath = function (path) {\r\n\t\tvar curContext = Hualala.PageRoute.getPageContextByPath(path);\r\n\t\tvar curName = $XP(curContext, 'name', null);\r\n\t\tvar ret = [];\r\n\t\twhile(!IX.isEmpty(curName)) {\r\n\t\t\tret.unshift({\r\n\t\t\t\tname : curName,\r\n\t\t\t\tlabel : $XP(curContext, 'label', ''),\r\n                path: Hualala.PageRoute.createPath(curName, curContext.params)\r\n\t\t\t});\r\n\t\t\tvar parentName = $XP(curContext, 'parentName', null);\r\n\t\t\tcurContext = IX.isEmpty(parentName) ? null : $XP(PageConfigurations, parentName, null);\r\n\t\t\tcurName = $XP(curContext, 'name', null);\r\n\t\t}\r\n        ret[ret.length - 1].isLastNode = true;\r\n\t\treturn ret;\r\n\t};\r\n    \r\n    Hualala.PageRoute.getPageLabelByName = function (name) {\r\n        if(!name) return null;\r\n        var cfg = PageConfigurations[name];\r\n        if(!cfg) return null;\r\n        return cfg.label;\r\n    };\r\n    \r\n\r\n})(jQuery, window);"]}