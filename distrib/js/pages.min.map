{"version":3,"file":"pages.min.js","sources":["pages.js"],"names":["$","IX","ns","formFields","name","type","palceholder","clz","key","field","validators","notEmpty","message","callback","val","min","max","length","valid","AuthCode","cfg","container","$XP","$img","find","$progress","callServer","Hualala","Global","genAuthCode","toggleProgress","isShow","getAuthCode","cbFn","res","code","UI","TopTip","msg","setAuthCode","attr","setTimeout","bindEvent","delegate","e","target","init","genCode","Entry","initLogin","$container","console","err","loginCallServer","fvOpts","$subBtn","parent","$authCode","initValidFieldOpts","ret","_","each","f","getFormData","params","initLoginForm","bootstrapValidator","trigger","fields","on","$form","data","preventDefault","info","resultcode","document","location","href","PageRoute","createPath","bv","validate","jQuery","window","toptip","PopoverMsgTip","QueryModel","Stapes","subclass","constructor","this","origCities","origAreas","origShops","isReady","getShopQuerySchema","proto","self","initDataModel","cityHT","IListManager","areaHT","shopHT","c","cid","shopLst","filter","s","areaLst","a","pluck","register","inherit","aid","sid","set","ds_city","ds_area","ds_shop","hasReady","getCities","ids","isEmpty","isString","ds","get","getShops","getAreas","destroy","Shop","QueryView","needShopCreate","$queryBox","$filter","$query","loadTemplates","model","renderLayout","emit","getFilterParams","queryTpl","Handlebars","compile","TplLib","filterTpl","registerPartial","mapChosenShopData","cities","city","cityName","shops","push","items","map","shop","mapRenderLayoutData","filterCities","mapFilterData","focus","queryChosenShops","shopCity","toggle","optGrp","renderData","html","prepend","count","btn_all","focusClz","o","parseInt","unshift","renderAreaFilter","remove","append","$btn","cityID","removeClass","addClass","focusedBtn","areaID","keywordLst","getQueryParams","QueryController","sessionData","getSessionData","resultController","view","reload","distory","query","pageNo","pageSize","load","CardListModel","pageCount","totalSize","ds_page","updatePagerParams","pagerParamkeys","v","k","indexOf","getPagerParams","Page","updateDataStore","pageHT","shopIDs","shopID","mShop","BaseShopModel","resetDataStore","clear","getByKeys","getAll","getShopModelByShopID","updateShopStatus","status","failFn","updateShopBusinessStatus","id","switchShopStatusCallServer","switchShopStatus","switchShopBusinessStatusCallServer","switchShopServiceFeatureStatus","switchShopBusinessStatus","$XF","setServiceFeature","sName","serviceFeatures","split","el","join","serviceFeature","operation","switchBusinessStatus","setServiceParams","serviceID","successFn","strType","newData","CardListView","$resultBox","$list","$pager","initLayout","layoutTpl","htm","initPager","baseCfg","total","page","maxVisible","leaps","IXPager","tooltip","selector","path","listTpl","itemTpl","tagTpl","mapRenderData","getTags","tags","t","tag","address","byteLen","Common","strByteLength","slugAddr","substrByte","img","getSourceImage","width","height","quality","tel","infoHref","menuHref","checked","shopCard","list","initSwitcher","bootstrapSwitch","size","onColor","offColor","onText","offText","state","$chkbox","_shopID","render","pagerParams","empty","ShopListView","businessName","businessID","initBusinessModal","getShopBusiness","business","TypeDef","ShopBusiness","businessHT","businessCfg","item","switcherStatus","mapBusinessRenderData","icon","switcherName","open","label","desc","chkHasAccountRole","loginUsr","getSessionUser","usrRoles","roles","getSessionRoles","role","roleType","matchedID","shopName","hideAccount","settleName","shopOpen","shopItem","Setting","editServiceView","triggerEl","serviceName","ShopListController","ShopListModel","reloadPager","initCuisines","$cuisine1","$cuisine2","G","getCuisines","rsp","resultmsg","topTip","fillSelectBox","records","initAreas","$selectBox","initCities","isActive","value","initialValue","optionsHtml","i","getSelectText","$select","text","replace","U","initCreate","$wizard","bootstrapWizard","bsWizard","$step1","$step2","$step3","$city","$area","timepicker","minuteStep","showMeridian","disableFocus","showInputs","stringLength","telOrMobile","PCCL","numeric","operationMode","openingHoursStart","time","openingHoursEnd","startTimeField","cuisineID1","$uploadImg","imagePath","uploadImg","onSuccess","imgPath","$dlg","src","modal","dataStep1","$searchBox","$shopSettingLink","$curStep","activePane","is","isValid","parseForm","areaName","cuisineName1","cuisineName2","cuisineID2","openingHours","keywords","updateShopBaseInfo","createShop","next","isSearchMap","searchBox","lng","mapPoint","lat","mapInfo","mapLongitudeValue","mapLatitudeValue","mapLongitudeValueBaiDu","mapLatitudeValueBaiDu","setShopMap","initShopList","$body","queryShop","HomePageInit","initShopBaseInfoMgr","BaseInfoMgrInit","initFoodMenuMgr","FoodMenuMgrInit","initCreateShop","tpl","$shopCreateWizard","pcClientPath","CreateShopInit","ServiceFormElsCfg","advanceTime","defaultVal","prefix","surfix","options","MinuteIntervalOptions","validCfg","noticeTime","minAmount","greaterThan","inclusive","serviceAmount","freeServiceAmount","holidayFlag","HolidayFlagOptions","openDays","digits","servicePeriods","group","reserveTableTime","reserveTableDesc","takeawayDeliveryAgent","takeawayDeliveryTime","takeawayScope","takeawayScopeDesc","submitSMSTemplateID","checkSMSTemplateID","payMethod","PayMethodOptions","needInputTableName","onLabel","offLabel","supportInvoice","supportCommitToSoftware","payMethodAtShop","PayMethodAtShopOptions","payBeforeCommit","fetchFoodMode","FetchFoodModeOptions","ServiceFormElsHT","labelClz","minID","maxID","minName","maxName","$trigger","serviceList","serviceInfo","getServiceInfo","isFn","nsExisted","getNS","formParams","initModal","renderForm","btnTpl","registerHelper","conditional","hash","fn","inverse","ModalDialog","title","getModalTitle","afterRemove","body","$el","initTimePicker","showSeconds","show","hide","dialog","act","button","serializeForm","footer","decodeTimeStr","substr","encodeTimeStr","mapServiceFormElsData","formKeys","formEls","elCfg","op","selected","formClz","btns","initShopMgr","ShopMgrInit","isSupportedBrowser","bd","Browser","isIE","version","allowOldVersion","Cookie","browserLib","$jumbotron","appendTo","click","Router","check","initPageLayout","session","isLogin","loginName","groupName","mapRanderData","header","hualalaUrl","HualalaWebSite","merchantRoot","logoutPath","getLogoutJumpToUrl","logo","getDefaultImage","aboutPath","contactPath","gozapLogo","$wrapper","DEFAULT_OPTIONS","extend","feedbackIcons","invalid","validating","accuracy","validator","$field","isNaN","regxStr","regX","RegExp","test","initSiteNavBar","navTpl","navToggleTpl","navs","SiteNavType","active","isCurrentPage","disabled","$navbar","$navToggle","$header","initHomePage","rights","getSessionSite","getSessionPCClient","getSessionUserRight","ht","iterate","pageBrickConfigs","hasRight","itemClz","$bricks","bricks","$this","pageName","eType","hasClass","toggleClass","initLoginPage","$loginBox","bannerImg","brickClz","LoginInit","IndexInit","loadSession","appData","initMainPage","tick","getTimeInMS","log","loadAppData","initRouteEngine","ajaxSetup","beforeSend","xhr","setRequestHeader","ajaxEngine","ajaxFn","ajax","baseUrl","HOME","commonUrl","CommonSite","imgUrl","IMAGE_ROOT","isSessionUser","groupLoginName","_name","APPInitialized","start","hasNoNavPages","commonPages","mappingRoute","_path","_reg","match","shift","arr","bingo","_pattern","Path2NameMapping","getPathByName","PageConfigurations","reg","genPath","p","isArray","isInitialized","Route","detectPageInitializor","_checkItem","fname","_list","_fn","j","_checking","fnames","loop","acc","_check","Array","toSet","checkReady","emptyFn","maxAge","expire","alert","_detect","put","I1ToNManager","detect","pageConfigs","bodyClz","PageInitiator","_cfg","_pageInit","flush","config","mode","root","route","re","initFn","handler","apply","add","listen","getCurrentPath","getPageContextByPath","fragment","getFragment"],"mappings":"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","sourcesContent":["/** \r\n * -------------------------------------------------\r\n * Copyright (c) 2014, All rights reserved. \r\n * Hualala-Merchant-Management\r\n * \r\n * @version : 0.1.0\r\n * @author : HuHao\r\n * @description : Hualala Merchant Management System.  \r\n * -------------------------------------------------\r\n */ \r\n\r\n(function ($, window) {\r\n\tIX.ns('Hualala.Entry');\r\n\tvar formFields = [\r\n\t\t{\r\n\t\t\tname : 'group_name', type : 'text', palceholder : '', clz : 'form-control input-md',\r\n\t\t\tkey : 'groupName',\r\n\t\t\tfield : {\r\n\t\t\t\tvalidators : {\r\n\t\t\t\t\tnotEmpty : {\r\n\t\t\t\t\t\tmessage : \"\"\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\t{\r\n\t\t\tname : 'group_subname', type : 'text', palceholder : '', clz : 'form-control input-md',\r\n\t\t\tkey : 'childName',\r\n\t\t\tfield : {\r\n\t\t\t\tvalidators : {\r\n\t\t\t\t\t// notEmpty : {\r\n\t\t\t\t\t// \tmessage : \"\"\r\n\t\t\t\t\t// }\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\t{\r\n\t\t\tname : 'login_pwd', type : 'passowrd', palceholder : '', clz : 'form-control input-md',\r\n\t\t\tkey : 'password',\r\n\t\t\tfield : {\r\n\t\t\t\tvalidators : {\r\n\t\t\t\t\tnotEmpty : {\r\n\t\t\t\t\t\tmessage : \"\"\r\n\t\t\t\t\t},\r\n\t\t\t\t\tcallback : {\r\n\t\t\t\t\t\tcallback : function (val, validator, $field) {\r\n\t\t\t\t\t\t\tvar min = 6, max = 32;\r\n\t\t\t\t\t\t\tif (val.length < 6 || val.length > 32) {\r\n\t\t\t\t\t\t\t\treturn {\r\n\t\t\t\t\t\t\t\t\tvalid : false,\r\n\t\t\t\t\t\t\t\t\tmessage : '' + min + '' + max + ''\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\treturn {\r\n\t\t\t\t\t\t\t\tvalid : true\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\t{\r\n\t\t\tname : 'login_auth', type : 'text', palceholder : '', clz : 'form-control input-md',\r\n\t\t\tkey : 'authCode',\r\n\t\t\tfield : {\r\n\t\t\t\tvalidators : {\r\n\t\t\t\t\tnotEmpty : {\r\n\t\t\t\t\t\tmessage : \"\"\r\n\t\t\t\t\t}/*,\r\n\t\t\t\t\tcallback : function (val, validator, $field) {\r\n\t\t\t\t\t\tif (val != $('[name=auth_code]').val()) {\r\n\t\t\t\t\t\t\treturn {\r\n\t\t\t\t\t\t\t\tvalid : false,\r\n\t\t\t\t\t\t\t\tmessage : ''\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\treturn {valid : true};\r\n\t\t\t\t\t}*/\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t];\r\n\r\n\t/**\r\n\t * AuthCode\r\n\t * @param {Object} cfg {container}\r\n\t */\r\n\tvar AuthCode = function (cfg) {\r\n\t\tvar container = $($XP(cfg, 'container')),\r\n\t\t\t$img = container.find('.auth-img'),\r\n\t\t\t$progress = container.find('.progress');\r\n\t\tvar callServer = Hualala.Global.genAuthCode;\r\n\t\tvar toggleProgress = function (isShow) {\r\n\t\t\t$progress[isShow ? 'removeClass' : 'addClass']('hidden');\r\n\t\t\t$img[isShow ? 'addClass' : 'removeClass']('hidden');\r\n\t\t};\r\n\t\tvar getAuthCode = function (cbFn) {\r\n\t\t\ttoggleProgress(true);\r\n\t\t\tcallServer({}, function (res) {\r\n\t\t\t\tvar code = null;\r\n\t\t\t\tif ($XP(res, 'resultcode') == \"000\") {\r\n\t\t\t\t\tcode = $XP(res, 'data.code', null);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tHualala.UI.TopTip({\r\n\t\t\t\t\t\ttype : 'warning',\r\n\t\t\t\t\t\tmsg : \"\"\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t\ttoggleProgress();\r\n\t\t\t\t}\r\n\t\t\t\tcbFn(code);\r\n\t\t\t});\r\n\t\t};\r\n\t\tvar setAuthCode = function (code) {\r\n\t\t\tif (!code) {\r\n\t\t\t\tsetTimeout(function () {\r\n\t\t\t\t\tgetAuthCode(setAuthCode);\r\n\t\t\t\t}, 1000);\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\t$img.attr('src', code);\r\n\t\t\t// FOR TEST\r\n\t\t\tsetTimeout(function () {\r\n\t\t\t\ttoggleProgress();\r\n\t\t\t}, 500);\r\n\t\t};\r\n\t\tvar bindEvent = function () {\r\n\t\t\tcontainer.delegate('.auth-img', 'click', function (e) {\r\n\t\t\t\t$img = $(e.target);\r\n\t\t\t\tgetAuthCode(setAuthCode);\r\n\t\t\t});\r\n\t\t};\r\n\t\tvar init = function () {\r\n\t\t\tgetAuthCode(setAuthCode);\r\n\t\t\tbindEvent();\r\n\t\t};\r\n\t\tinit();\r\n\t\treturn {\r\n\t\t\tgenCode : function () {\r\n\t\t\t\tgetAuthCode(setAuthCode);\r\n\t\t\t}\r\n\t\t};\r\n\t};\r\n\r\n\tHualala.Entry.initLogin = function ($container) {\r\n\t\tif (!$container || $container.length == 0) {\r\n\t\t\tconsole.err(\"Login Form init failed!\");\r\n\t\t\treturn ;\r\n\t\t}\r\n\t\tvar callServer = Hualala.Global.loginCallServer;\r\n\t\tvar fvOpts = {},\r\n\t\t\t$subBtn = $container.find('#login_sub'),\r\n\t\t\t$progress = $subBtn.parent().find('.progress'),\r\n\t\t\t$authCode = $container.find('.ix-authcode'),\r\n\t\t\tauthCode = new AuthCode({\r\n\t\t\t\tcontainer : $authCode\r\n\t\t\t});\r\n\t\tvar toggleProgress = function (isShow) {\r\n\t\t\t$progress[isShow ? 'removeClass' : 'addClass']('hidden');\r\n\t\t\t$subBtn[isShow ? 'addClass' : 'removeClass']('hidden');\r\n\t\t};\r\n\t\tvar initValidFieldOpts = function () {\r\n\t\t\tvar ret = {};\r\n\t\t\t_.each(formFields, function (f, i, l) {\r\n\t\t\t\tvar key = $XP(f, 'name'), field = $XP(f, 'field');\r\n\t\t\t\tret[key] = field;\r\n\t\t\t});\r\n\t\t\treturn ret;\r\n\t\t};\r\n\t\tvar getFormData = function () {\r\n\t\t\tvar params = {};\r\n\t\t\t_.each(formFields, function (f, i, l) {\r\n\t\t\t\tvar name = $XP(f, 'name'), key = $XP(f, 'key'), \r\n\t\t\t\t\tval = $('[name=' + name + ']', $container).val();\r\n\t\t\t\tparams[key] = val;\r\n\t\t\t});\r\n\t\t\treturn params;\r\n\t\t};\r\n\t\tvar initLoginForm = function () {\r\n\t\t\tfvOpts = initValidFieldOpts();\r\n\t\t\t$container.bootstrapValidator({\r\n\t\t\t\ttrigger : 'blur',\r\n\t\t\t\tfields : fvOpts\r\n\t\t\t}).on('error.field.bv', function (e, data) {\r\n\t\t\t\tvar $form = $(e.target),\r\n\t\t\t\t\tbv = $form.data('bootstrapValidator');\r\n\t\t\t\ttoggleProgress();\r\n\t\t\t}).on('success.form.bv', function (e, data) {\r\n\t\t\t\te.preventDefault();\r\n\t\t\t\tvar $form = $(e.target),\r\n\t\t\t\t\tbv = $form.data('bootstrapValidator'),\r\n\t\t\t\t\tparams = getFormData();\r\n\t\t\t\t// TODO AJAX Submit Login Form\r\n\t\t\t\tconsole.info('login params : ');\r\n\t\t\t\tconsole.info(params);\r\n\t\t\t\t\r\n\t\t\t\tcallServer(params, function (res) {\r\n\t\t\t\t\tif (res.resultcode == 000) {\r\n\t\t\t\t\t\tdocument.location.href = Hualala.PageRoute.createPath('main'); \r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tHualala.UI.TopTip({\r\n\t\t\t\t\t\t\ttype : 'danger',\r\n\t\t\t\t\t\t\tmsg : $XP(res, 'resultmsg')\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\t\t\t\t\ttoggleProgress();\r\n\t\t\t\t});\r\n\t\t\t});\r\n\t\t\t$container.delegate('#login_sub', 'click', function (e) {\r\n\t\t\t\ttoggleProgress(true);\r\n\t\t\t\tvar bv = $container.data('bootstrapValidator');\r\n\t\t\t\tbv.validate();\r\n\t\t\t});\r\n\t\t};\r\n\r\n\t\tinitLoginForm();\r\n\t};\r\n})(jQuery, window);;(function ($, window) {\r\n\tIX.ns(\"Hualala.Shop\");\r\n\tvar popoverMsg = Hualala.UI.PopoverMsgTip;\r\n\tvar toptip = Hualala.UI.TopTip;\r\n\tvar QueryModel = Stapes.subclass({\r\n\t\tconstructor : function () {\r\n\t\t\t// \r\n\t\t\tthis.origCities = [];\r\n\t\t\tthis.origAreas = [];\r\n\t\t\tthis.origShops = [];\r\n\t\t\t// \r\n\t\t\tthis.isReady = false;\r\n\t\t\tthis.callServer = Hualala.Global.getShopQuerySchema;\r\n\t\t}\r\n\t});\r\n\tQueryModel.proto({\r\n\t\t// \r\n\t\tinit : function (params, cbFn) {\r\n\t\t\tvar self = this;\r\n\t\t\tself.isReady = false;\r\n\t\t\tself.callServer(params, function (res) {\r\n\t\t\t\tif (res.resultcode == '000') {\r\n\t\t\t\t\t// \r\n\t\t\t\t\tself.origCities = $XP(res, 'data.cities', []);\r\n\t\t\t\t\tself.origAreas = $XP(res, 'data.areas', []);\r\n\t\t\t\t\tself.origShops = $XP(res, 'data.shops', []);\r\n\t\t\t\t\tself.initDataModel();\r\n\t\t\t\t\tself.isReady = true;\r\n\t\t\t\t} else {\r\n\t\t\t\t\ttoptip({\r\n\t\t\t\t\t\tmsg : $XP(res, 'resultmsg', ''),\r\n\t\t\t\t\t\ttype : 'danger'\r\n\t\t\t\t\t});\r\n\t\t\t\t\tself.isReady = false;\r\n\t\t\t\t}\r\n\t\t\t\tcbFn(self);\r\n\t\t\t});\r\n\t\t},\r\n\t\t// \r\n\t\t// ds_city, ds_area, ds_shop\r\n\t\tinitDataModel : function () {\r\n\t\t\tvar self = this;\r\n\t\t\tvar cityHT = new IX.IListManager(),\r\n\t\t\t\tareaHT = new IX.IListManager(),\r\n\t\t\t\tshopHT = new IX.IListManager();\r\n\t\t\t_.each(this.origCities, function (c, i, l) {\r\n\t\t\t\tvar cid = $XP(c, 'cityID'), \r\n\t\t\t\t\tshopLst = _.filter(self.origShops, function (s) {\r\n\t\t\t\t\t\treturn $XP(s, 'cityID') == cid;\r\n\t\t\t\t\t}),\r\n\t\t\t\t\tareaLst = _.filter(self.origAreas, function (a) {\r\n\t\t\t\t\t\treturn $XP(a, 'cityID') == cid;\r\n\t\t\t\t\t});\r\n\t\t\t\tshopLst = _.pluck(shopLst, 'shopID');\r\n\t\t\t\tareaLst = _.pluck(areaLst, 'areaID');\r\n\t\t\t\tcityHT.register(cid, IX.inherit(c, {\r\n\t\t\t\t\tshopLst : shopLst,\r\n\t\t\t\t\tareaLst : areaLst\r\n\t\t\t\t}));\r\n\t\t\t});\r\n\t\t\t_.each(this.origAreas, function (a, i, l) {\r\n\t\t\t\tvar aid = $XP(a, 'areaID'),\r\n\t\t\t\t\tshopLst = _.filter(self.origShops, function (s) {\r\n\t\t\t\t\t\treturn $XP(s, 'areaID') == aid;\r\n\t\t\t\t\t});\r\n\t\t\t\tshopLst = _.pluck(shopLst, 'areaID');\r\n\t\t\t\tareaHT.register(aid, IX.inherit(a, {\r\n\t\t\t\t\tshopLst : shopLst\r\n\t\t\t\t}));\r\n\t\t\t});\r\n\t\t\t_.each(this.origShops, function (s, i, l) {\r\n\t\t\t\tvar sid = $XP(s, 'shopID');\r\n\t\t\t\tshopHT.register(sid, s);\r\n\t\t\t});\r\n\t\t\tself.set({\r\n\t\t\t\tds_city : cityHT,\r\n\t\t\t\tds_area : areaHT,\r\n\t\t\t\tds_shop : shopHT\r\n\t\t\t});\r\n\t\t},\r\n\t\t// \r\n\t\thasReady : function () {return this.isReady;},\r\n\t\t/**\r\n\t\t * cityIDs\r\n\t\t * @param  {String|Array|NULL} ids cityIDcityIDcityID\r\n\t\t * @return {Array|NULL}\tnull     \r\n\t\t */\r\n\t\tgetCities : function (ids) {\r\n\t\t\tids = IX.isEmpty(ids) ? null : (IX.isString(ids) ? [ids] : ids);\r\n\t\t\tvar ds = this.get('ds_city');\r\n\t\t\tvar ret = null;\r\n\t\t\tret = ds[!ids ? 'getAll' : 'getByKeys'](ids);\r\n\t\t\treturn ret;\r\n\t\t},\r\n\t\t/**\r\n\t\t * shopIDs\r\n\t\t * @param  {String|Array|NULL} ids shopIDshopIDshopID\r\n\t\t * @return {Array|NULL}\tnull     \r\n\t\t */\r\n\t\tgetShops : function (ids) {\r\n\t\t\tids = IX.isEmpty(ids) ? null : (IX.isString(ids) ? [ids] : ids);\r\n\t\t\tvar ds = this.get('ds_shop');\r\n\t\t\tvar ret = null;\r\n\t\t\tret = ds[!ids ? 'getAll' : 'getByKeys'](ids);\r\n\t\t\treturn ret;\r\n\t\t},\r\n\t\t/**\r\n\t\t * areaIDs\r\n\t\t * @param  {String|Array|NULL} ids areaIDareaIDareaID\r\n\t\t * @return {Array|NULL}\tnull     \r\n\t\t */\r\n\t\tgetAreas : function (ids) {\r\n\t\t\tids = IX.isEmpty(ids) ? null : (IX.isString(ids) ? [ids] : ids);\r\n\t\t\tvar ds = this.get('ds_area');\r\n\t\t\tvar ret = null;\r\n\t\t\tret = ds[!ids ? 'getAll' : 'getByKeys'](ids);\r\n\t\t\treturn ret;\r\n\t\t},\r\n\t\tdestroy : function () {\r\n\t\t\tthis.origCities = [];\r\n\t\t\tthis.origAreas = [];\r\n\t\t\tthis.origShops = [];\r\n\t\t\tthis.isReady = false;\r\n\t\t}\r\n\t});\r\n\tHualala.Shop.QueryModel = QueryModel;\r\n})(jQuery, window);;(function ($, window) {\r\n\tIX.ns(\"Hualala.Shop\");\r\n\tvar popoverMsg = Hualala.UI.PopoverMsgTip;\r\n\tvar toptip = Hualala.UI.TopTip;\r\n\tvar QueryView = Stapes.subclass({\r\n\t\tconstructor : function () {\r\n\t\t\t// View\r\n\t\t\tthis.isReady = false;\r\n\t\t\t// \r\n\t\t\tthis.needShopCreate = false;\r\n\t\t\t// View\r\n\t\t\tthis.$container = null;\r\n\t\t\tthis.$queryBox = null;\r\n\t\t\t// \r\n\t\t\tthis.$filter = null;\r\n\t\t\t// \r\n\t\t\tthis.$query = null;\r\n\t\t\tthis.loadTemplates();\r\n\t\t}\r\n\t});\r\n\tQueryView.proto({\r\n\t\t// View\r\n\t\tinit : function (cfg) {\r\n\t\t\tthis.model = $XP(cfg, 'model', null);\r\n\t\t\tthis.needShopCreate = $XP(cfg, 'needShopCreate', false);\r\n\t\t\tthis.$container = $XP(cfg, 'container', null);\r\n\t\t\tif (!this.model || !this.$container || this.$container.length == 0) {\r\n\t\t\t\tthrow(\"Init Query View Failed!!\");\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tthis.renderLayout();\r\n\t\t\tthis.bindEvent();\r\n\t\t\tthis.isReady = true;\r\n\t\t\tthis.emit('filter', this.getFilterParams());\r\n\r\n\t\t},\r\n\t\t// View\r\n\t\thasReady : function () {return this.isReady;},\r\n\t\t// View\r\n\t\tloadTemplates : function () {\r\n\t\t\tvar queryTpl = Handlebars.compile(Hualala.TplLib.get('tpl_shop_query')),\r\n\t\t\t\tfilterTpl = Handlebars.compile(Hualala.TplLib.get('tpl_shop_filter'));\r\n\t\t\t// \r\n\t\t\tHandlebars.registerPartial(\"shopCity\", Hualala.TplLib.get('tpl_shop_filter'));\r\n\t\t\tHandlebars.registerPartial(\"toggle\", Hualala.TplLib.get('tpl_site_navbarToggle'));\r\n\t\t\t// Handlebars.registerPartial(\"shopArea\", Hualala.TplLib.get('tpl_shop_filter'));\r\n\t\t\tthis.set({\r\n\t\t\t\tqueryTpl : queryTpl,\r\n\t\t\t\tfilterTpl : filterTpl\r\n\t\t\t});\r\n\t\t},\r\n\t\t// \r\n\t\tmapChosenShopData : function () {\r\n\t\t\tvar self = this;\r\n\t\t\tvar cities = this.model.getCities();\r\n\t\t\tvar ret = [];\r\n\t\t\t_.each(cities, function (city, i, l) {\r\n\t\t\t\tvar cityName = $XP(city, 'cityName', ''),\r\n\t\t\t\t\tcityID = $XP(city, 'cityID', ''),\r\n\t\t\t\t\tshopLst = $XP(city, 'shopLst');\r\n\t\t\t\tvar shops = self.model.getShops(shopLst);\r\n\t\t\t\tret.push({\r\n\t\t\t\t\tname : cityName,\r\n\t\t\t\t\titems : _.map(shops, function (shop, j, l) {\r\n\t\t\t\t\t\treturn {\r\n\t\t\t\t\t\t\tcode : $XP(shop, 'shopID'),\r\n\t\t\t\t\t\t\tname : $XP(shop, 'shopName')\r\n\t\t\t\t\t\t};\r\n\t\t\t\t\t})\r\n\t\t\t\t});\r\n\t\t\t});\r\n\t\t\treturn ret;\r\n\t\t},\r\n\t\t// \r\n\t\tmapRenderLayoutData : function () {\r\n\t\t\tvar cities = this.model.getCities(),\r\n\t\t\t\tshops = this.model.getShops();\r\n\t\t\tvar filterCities = this.mapFilterData({\r\n\t\t\t\t\ttype : 'city',\r\n\t\t\t\t\tname : '',\r\n\t\t\t\t\tfocus : 0,\r\n\t\t\t\t\tdata : cities\r\n\t\t\t\t}),\r\n\t\t\t\tqueryChosenShops = this.mapChosenShopData();\r\n\t\t\treturn {\r\n\t\t\t\tclz : '',\r\n\t\t\t\tshopCity : filterCities,\r\n\t\t\t\ttoggle : {target : '#shop_query'},\r\n\t\t\t\tneedShopCreate : this.needShopCreate,\r\n\t\t\t\toptGrp : queryChosenShops\r\n\t\t\t};\r\n\t\t},\r\n\t\t// query \r\n\t\trenderLayout : function () {\r\n\t\t\tvar self = this,\r\n\t\t\t\tqueryTpl = self.get('queryTpl'),\r\n\t\t\t\tmodel = self.model;\r\n\t\t\tvar renderData = self.mapRenderLayoutData();\r\n\t\t\tvar html = queryTpl(renderData);\r\n\t\t\tthis.$queryBox = $(html);\r\n\t\t\tthis.$container.prepend(this.$queryBox);\r\n\t\t\tthis.$filter = this.$queryBox.find('.filter');\r\n\t\t\tthis.$query = this.$queryBox.find('.query');\r\n\r\n\t\t},\r\n\t\t// \r\n\t\tmapFilterData : function (cfg) {\r\n\t\t\tvar data = $XP(cfg, 'data', []),\r\n\t\t\t\ttype = $XP(cfg, 'type'),\r\n\t\t\t\tname = $XP(cfg, 'name'),\r\n\t\t\t\tfocus = $XP(cfg, 'focus', 0),\r\n\t\t\t\tret = {\r\n\t\t\t\t\ttype : type,\r\n\t\t\t\t\tname : name,\r\n\t\t\t\t\titems : []\r\n\t\t\t\t},\r\n\t\t\t\tcount = 0;\r\n\t\t\tvar btn_all = {\r\n\t\t\t\tfocusClz : '',\r\n\t\t\t\ttype : type,\r\n\t\t\t\tcode : -1,\r\n\t\t\t\tname : '',\r\n\t\t\t\tcount : 0\r\n\t\t\t};\r\n\t\t\tret.items = _.map(data, function (o, i, l) {\r\n\t\t\t\tvar key = type + 'Count';\r\n\t\t\t\tvar c = parseInt($XP(o, key, 0));\r\n\t\t\t\tcount += c;\r\n\t\t\t\treturn {\r\n\t\t\t\t\tfocusClz : '',\r\n\t\t\t\t\ttype : type,\r\n\t\t\t\t\tcode : $XP(o, (type + 'ID'), ''),\r\n\t\t\t\t\tname : $XP(o, (type + 'Name'), ''),\r\n\t\t\t\t\tcount : c\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\tbtn_all = IX.inherit(btn_all, {\r\n\t\t\t\tcount : count,\r\n\t\t\t\tfocusClz : ''\r\n\t\t\t});\r\n\t\t\tret.items.unshift(btn_all);\r\n\t\t\tret.items[focus]['focusClz'] = 'disabled';\r\n\t\t\treturn ret;\r\n\t\t},\r\n\t\t// filter\r\n\t\trenderAreaFilter : function (data) {\r\n\t\t\tvar self = this,\r\n\t\t\t\tfilterTpl = self.get('filterTpl'),\r\n\t\t\t\tmodel = self.model;\r\n\t\t\tvar renderData = self.mapFilterData({\r\n\t\t\t\ttype : 'area',\r\n\t\t\t\tname : '',\r\n\t\t\t\tfocus : 0,\r\n\t\t\t\tdata : data\r\n\t\t\t});\r\n\t\t\tvar html = filterTpl(renderData);\r\n\t\t\tthis.$filter.find('.area').remove();\r\n\t\t\tthis.$filter.append(html);\r\n\t\t},\r\n\t\t// View\r\n\t\tbindEvent : function () {\r\n\t\t\tvar self = this;\r\n\t\t\tthis.$filter.on('click', '.btn-link[data-city]', function (e) {\r\n\t\t\t\tvar $btn = $(this);\r\n\t\t\t\tvar cityID = $btn.attr('data-city');\r\n\t\t\t\tvar data = null;\r\n\t\t\t\tif (cityID != -1) {\r\n\t\t\t\t\tdata = self.model.getCities(cityID);\r\n\t\t\t\t\tdata = $XP(data[0], 'areaLst', null);\r\n\t\t\t\t\tdata = self.model.getAreas(data);\r\n\t\t\t\t\tself.renderAreaFilter(data);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tself.$filter.find('.area').remove();\r\n\t\t\t\t}\r\n\t\t\t\tself.$filter.find('.btn-link[data-city]').removeClass('disabled');\r\n\t\t\t\t$btn.addClass('disabled');\r\n\t\t\t\tself.emit('filter', self.getFilterParams());\r\n\t\t\t});\r\n\t\t\tthis.$filter.on('click', '.btn-link[data-area]', function (e) {\r\n\t\t\t\tvar $btn = $(this);\r\n\t\t\t\tvar areaID = $btn.attr('data-area');\r\n\t\t\t\tself.$filter.find('.btn-link[data-area]').removeClass('disabled');\r\n\t\t\t\t$btn.addClass('disabled');\r\n\t\t\t\tself.emit('filter', self.getFilterParams());\r\n\t\t\t});\r\n\t\t\tthis.$query.on('click', '.create-shop', function (e) {\r\n\t\t\t\tvar $btn = $(this);\r\n\t\t\t\tdocument.location.href = Hualala.PageRoute.createPath('shopCreate');\r\n\t\t\t});\r\n\t\t},\r\n\t\tdestroy : function () {\r\n\t\t\tthis.isReady = false;\r\n\t\t\tthis.needShopCreate = false;\r\n\t\t\tthis.$container.find('.shop-query').remove();\r\n\t\t\tthis.$queryBox = null;\r\n\t\t\tthis.$filter = null;\r\n\t\t\tthis.$query = null;\r\n\t\t},\r\n\t\t// \r\n\t\tgetFilterParams : function () {\r\n\t\t\t// TODO\r\n\t\t\tvar self = this;\r\n\t\t\tvar focusedBtn = self.$filter.find('.btn-link.disabled');\r\n\t\t\tvar cityID = focusedBtn.filter('[data-city]').attr('data-city'),\r\n\t\t\t\tareaID = focusedBtn.filter('[data-area]').attr('data-area');\r\n\t\t\tcityID = (!cityID || cityID == -1) ? '' : cityID;\r\n\t\t\tareaID = (!areaID || areaID == -1) ? '' : areaID;\r\n\t\t\treturn {\r\n\t\t\t\tcityID : cityID,\r\n\t\t\t\tareaID : areaID,\r\n\t\t\t\tkeywordLst : ''\r\n\t\t\t};\r\n\t\t},\r\n\t\t// \r\n\t\tgetQueryParams : function () {\r\n\t\t\t// TODO\r\n\t\t\treturn {}\r\n\t\t}\r\n\r\n\t});\r\n\tHualala.Shop.QueryView = QueryView;\r\n})(jQuery, window);;(function ($, window) {\r\n\tIX.ns(\"Hualala.Shop\");\r\n\tvar popoverMsg = Hualala.UI.PopoverMsgTip;\r\n\tvar toptip = Hualala.UI.TopTip;\r\n\tvar QueryModel = Hualala.Shop.QueryModel;\r\n\tvar QueryView = Hualala.Shop.QueryView;\r\n\tvar QueryController = Stapes.subclass({\r\n\t\t/**\r\n\t\t * \r\n\t\t * @param  {Object} cfg \r\n\t\t *            @param {Boolean} cfg.needShopCreate \r\n\t\t *            @param {JQueryObj} container \r\n\t\t *            @param {Object} resultController \r\n\t\t * @return {Object}     \r\n\t\t */\r\n\t\tconstructor : function (cfg) {\r\n\t\t\tthis.set({\r\n\t\t\t\tsessionData : Hualala.getSessionData()\r\n\t\t\t});\r\n\t\t\tthis.container = $XP(cfg, 'container', null);\r\n\t\t\tthis.needShopCreate = $XP(cfg, 'needShopCreate', false);\r\n\t\t\tthis.resultController = $XP(cfg, 'resultController', null);\r\n\t\t\tthis.model = new QueryModel();\r\n\t\t\tthis.view = new QueryView();\r\n\t\t\tthis.init();\r\n\t\t}\r\n\t});\r\n\tQueryController.proto({\r\n\t\t// \r\n\t\tinit : function () {\r\n\t\t\tvar self = this;\r\n\t\t\tself.bindEvent();\r\n\t\t\tself.model.emit('load', function () {\r\n\t\t\t\tif (!self.model.hasReady()) {\r\n\t\t\t\t\tthrow(\"Shop Query Init Failed!!\");\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\t// View\r\n\t\t\t\tself.view.emit('init');\r\n\t\t\t});\r\n\t\t},\r\n\t\t// \r\n\t\tbindEvent : function () {\r\n\t\t\t// \r\n\t\t\tthis.on({\r\n\t\t\t\treload : function () {\r\n\t\t\t\t\tvar self = this;\r\n\t\t\t\t\tself.model.distory();\r\n\t\t\t\t\tself.view.distory();\r\n\t\t\t\t\tself.init();\r\n\t\t\t\t},\r\n\t\t\t\tquery : function (params) {\r\n\t\t\t\t\tvar self = this;\r\n\t\t\t\t\tconsole.info('query params:');\r\n\t\t\t\t\tconsole.info(params);\r\n\t\t\t\t\tself.resultController && self.resultController.emit('load', IX.inherit(params, {\r\n\t\t\t\t\t\tpageNo : 1,\r\n\t\t\t\t\t\tpageSize : 15\r\n\t\t\t\t\t}));\r\n\t\t\t\t}\r\n\t\t\t}, this);\r\n\t\t\t// \r\n\t\t\tthis.model.on({\r\n\t\t\t\tload : function (cbFn) {\r\n\t\t\t\t\tvar self = this,\r\n\t\t\t\t\t\tparams = $XP(self.get('sessionData'), 'user', {});\r\n\t\t\t\t\tself.model.init(params, cbFn);\r\n\t\t\t\t}\r\n\t\t\t}, this);\r\n\t\t\t// \r\n\t\t\tthis.view.on({\r\n\t\t\t\tinit : function () {\r\n\t\t\t\t\tvar self = this;\r\n\t\t\t\t\tself.view.init({\r\n\t\t\t\t\t\tmodel : self.model,\r\n\t\t\t\t\t\tneedShopCreate : self.needShopCreate,\r\n\t\t\t\t\t\tcontainer : self.container\r\n\t\t\t\t\t});\r\n\t\t\t\t},\r\n\t\t\t\t// \r\n\t\t\t\tfilter : function (params) {\r\n\t\t\t\t\tvar self = this;\r\n\t\t\t\t\tself.emit('query', params);\r\n\t\t\t\t\t//TODO QuerychosenPanel\r\n\t\t\t\t},\r\n\t\t\t\t// \r\n\t\t\t\tquery : function (params) {\r\n\t\t\t\t\tvar self = this;\r\n\t\t\t\t\tself.emit('query', params);\r\n\t\t\t\t}\r\n\t\t\t}, this);\r\n\t\t}\r\n\t});\r\n\tHualala.Shop.QueryController = QueryController;\r\n})(jQuery, window);;(function ($, window) {\r\n\tIX.ns(\"Hualala.Shop\");\r\n\tvar popoverMsg = Hualala.UI.PopoverMsgTip;\r\n\tvar toptip = Hualala.UI.TopTip;\r\n\tvar CardListModel = Stapes.subclass({\r\n\t\t/**\r\n\t\t * \r\n\t\t * @param  {Object} cfg \r\n\t\t *           @param {Function} callServer \r\n\t\t * @return {Object}     \r\n\t\t */\r\n\t\tconstructor : function (cfg) {\r\n\t\t\tthis.callServer = $XP(cfg, 'callServer', null);\r\n\t\t\tif (!this.callServer) {\r\n\t\t\t\tthrow(\"callServer is empty!\");\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t}\r\n\t});\r\n\tCardListModel.proto({\r\n\t\tinit : function (params) {\r\n\t\t\tthis.set({\r\n\t\t\t\tpageCount : 0,\r\n\t\t\t\ttotalSize : 0,\r\n\t\t\t\tpageNo : $XP(params, 'Page.pageNo', 1),\r\n\t\t\t\tpageSize : $XP(params, 'Page.pageSize', 15),\r\n\t\t\t\tcityID : $XP(params, 'cityID', ''),\r\n\t\t\t\tareaID : $XP(params, 'areaID', ''),\r\n\t\t\t\tkeywordLst : $XP(params, 'keywordLst', ''),\r\n\t\t\t\tds_shop : new IX.IListManager(),\r\n\t\t\t\tds_page : new IX.IListManager()\r\n\t\t\t});\r\n\t\t},\r\n\t\tupdatePagerParams : function (params) {\r\n\t\t\tvar self = this;\r\n\t\t\tvar pagerParamkeys = 'pageCount,totalSize,pageNo,pageSize,cityID,areaID,keywordLst';\r\n\t\t\t// _.each(pagerParamkeys.split(','), function (k, i, l) {\r\n\t\t\t// \tswitch(k) {\r\n\t\t\t// \t\tcase 'pageCount': \r\n\t\t\t// \t\tcase 'totalSize' :\r\n\t\t\t// \t\t\tself.set(k, $XP(params, k, 0));\r\n\t\t\t// \t\t\tbreak;\r\n\t\t\t// \t\tcase 'pageNo' : \r\n\t\t\t// \t\t\tself.set(k, $XP(params, k, 1));\r\n\t\t\t// \t\t\tbreak;\r\n\t\t\t// \t\tcase 'pageSize' :\r\n\t\t\t// \t\t\tself.set(k, $XP(params, k, 15));\r\n\t\t\t// \t\t\tbreak;\r\n\t\t\t// \t\tdefault:\r\n\t\t\t// \t\t\tself.set(k, $XP(params, k, ''));\r\n\t\t\t// \t\t\tbreak;\r\n\t\t\t// \t}\r\n\t\t\t// });\r\n\t\t\t_.each(params, function (v, k, l) {\r\n\t\t\t\tif (pagerParamkeys.indexOf(k) > -1) {\r\n\t\t\t\t\tself.set(k, v);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t},\r\n\t\tgetPagerParams : function () {\r\n\t\t\treturn {\r\n\t\t\t\tPage : {\r\n\t\t\t\t\tpageNo : this.get('pageNo'),\r\n\t\t\t\t\tpageSize : this.get('pageSize')\r\n\t\t\t\t},\r\n\t\t\t\tcityID : this.get('cityID'),\r\n\t\t\t\tareaID : this.get('areaID'),\r\n\t\t\t\tkeywordLst : this.get('keywordLst')\r\n\t\t\t};\r\n\t\t},\r\n\t\tupdateDataStore : function (data, pageNo) {\r\n\t\t\tvar self = this,\r\n\t\t\t\tshopHT = self.get('ds_shop'),\r\n\t\t\t\tpageHT = self.get('ds_page');\r\n\t\t\tvar shopIDs = _.map(data, function (shop, i, l) {\r\n\t\t\t\t// var shopID = $XP(shop, 'shopID');\r\n\t\t\t\t// shopHT.register(shopID, shop);\r\n\t\t\t\t// return shopID;\r\n\t\t\t\tvar shopID = $XP(shop, 'shopID'),\r\n\t\t\t\t\tmShop = new BaseShopModel(shop);\r\n\t\t\t\tshopHT.register(shopID, mShop);\r\n\t\t\t\treturn shopID;\r\n\t\t\t});\r\n\t\t\tpageHT.register(pageNo, shopIDs);\r\n\t\t},\r\n\t\tresetDataStore : function () {\r\n\t\t\tvar self = this,\r\n\t\t\t\tshopHT = self.get('ds_shop'),\r\n\t\t\t\tpageHT = self.get('ds_page');\r\n\t\t\tshopHT.clear();\r\n\t\t\tpageHT.clear();\r\n\t\t},\r\n\t\tload : function (params, cbFn) {\r\n\t\t\tvar self = this;\r\n\t\t\tself.updatePagerParams(params);\r\n\t\t\tself.callServer(self.getPagerParams(), function (res) {\r\n\t\t\t\tif (res.resultcode == '000') {\r\n\t\t\t\t\tself.updateDataStore($XP(res, 'data.records', []), $XP(res, 'data.pageNo'));\r\n\t\t\t\t\tself.updatePagerParams($XP(res, 'data', {}));\r\n\t\t\t\t} else {\r\n\t\t\t\t\ttoptip({\r\n\t\t\t\t\t\tmsg : $XP(res, 'resultmsg', ''),\r\n\t\t\t\t\t\ttype : 'danger'\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t\tcbFn(self);\r\n\t\t\t});\r\n\t\t},\r\n\t\tgetShops : function (pageNo) {\r\n\t\t\tvar self = this,\r\n\t\t\t\tshopHT = self.get('ds_shop'),\r\n\t\t\t\tpageHT = self.get('ds_page');\r\n\t\t\tvar ret = _.map(shopHT.getByKeys(pageHT.get(pageNo)), function (mShop, i, l) {\r\n\t\t\t\treturn mShop.getAll();\r\n\t\t\t});\r\n\t\t\tconsole.info(\"pageData:\");\r\n\t\t\tconsole.info(ret);\r\n\t\t\treturn ret;\r\n\t\t},\r\n\t\tgetShopModelByShopID : function (shopID) {\r\n\t\t\tvar self = this,\r\n\t\t\t\tshopHT = self.get('ds_shop');\r\n\t\t\treturn shopHT.get(shopID);\r\n\t\t},\r\n\t\t// \r\n\t\tupdateShopStatus : function (shopID, status, failFn) {\r\n\t\t\tvar self = this,\r\n\t\t\t\tshopHT = self.get('ds_shop');\r\n\t\t\tvar shop = shopHT.get(shopID);\r\n\t\t\t// shop = IX.inherit(shop, {\r\n\t\t\t// \tstatus : status\r\n\t\t\t// });\r\n\t\t\t// shopHT.register(shopID, shop);\r\n\t\t\t// shop.set('status', status);\r\n\t\t\tshop.emit('switchShopStatus', {\r\n\t\t\t\tstatus : status,\r\n\t\t\t\tfailFn : failFn\r\n\t\t\t});\r\n\t\t},\r\n\t\t// \r\n\t\tupdateShopBusinessStatus : function (params, failFn) {\r\n\t\t\tvar self = this,\r\n\t\t\t\tshopHT = self.get('ds_shop'),\r\n\t\t\t\tshopID = $XP(params, 'shopID'),\r\n\t\t\t\tshop = shopHT.get(shopID);\r\n\t\t\tshop.emit('switchBusinessStatus', {\r\n\t\t\t\tname : $XP(params, 'name'),\r\n\t\t\t\tid : $XP(params, 'id'),\r\n\t\t\t\tstatus : $XP(params, 'state'),\r\n\t\t\t\tfailFn : failFn\r\n\t\t\t});\r\n\r\n\t\t}\r\n\t});\r\n\r\n\r\n\tHualala.Shop.CardListModel = CardListModel;\r\n\r\n\tvar BaseShopModel = Stapes.subclass({\r\n\t\tconstructor : function (shop) {\r\n\t\t\tthis.switchShopStatusCallServer = Hualala.Global.switchShopStatus;\r\n\t\t\tthis.switchShopBusinessStatusCallServer = Hualala.Global.switchShopServiceFeatureStatus;\r\n\t\t\tthis.set(shop);\r\n\t\t\tthis.bindEvent();\r\n\t\t}\r\n\t});\r\n\tBaseShopModel.proto({\r\n\t\tswitchShopStatus : function (status, failFn) {\r\n\t\t\tvar self = this,\r\n\t\t\t\tshopID = self.get('shopID');\r\n\t\t\tself.set('status', status);\r\n\t\t\tconsole.info(\"Switch Shop [\" + self.get('shopID') + \"] status \" + status);\r\n\t\t\tthis.switchShopStatusCallServer({\r\n\t\t\t\tshopID : shopID,\r\n\t\t\t\tstatus : status\r\n\t\t\t}, function (res) {\r\n\t\t\t\tif (res.resultcode !== '000') {\r\n\t\t\t\t\t\r\n\t\t\t\t\ttoptip({\r\n\t\t\t\t\t\tmsg : $XP(res, 'resultmsg', ''),\r\n\t\t\t\t\t\ttype : 'danger'\r\n\t\t\t\t\t});\r\n\t\t\t\t\tself.set('status', !status ? 1 : 0);\r\n\t\t\t\t\tfailFn(shopID);\r\n\t\t\t\t\t\r\n\t\t\t\t} else {\r\n\t\t\t\t\ttoptip({\r\n\t\t\t\t\t\tmsg : '!',\r\n\t\t\t\t\t\ttype : 'success'\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t},\r\n\t\tswitchShopBusinessStatus : function (params) {\r\n\t\t\tvar self = this,\r\n\t\t\t\tshopID = self.get('shopID');\r\n\t\t\tvar failFn = $XF(params, 'failFn'),\r\n\t\t\t\tname = $XP(params, 'name'),\r\n\t\t\t\tid = $XP(params, 'id'),\r\n\t\t\t\tstatus = $XP(params, 'status');\r\n\t\t\tvar setServiceFeature = function (sName, s) {\r\n\t\t\t\tvar serviceFeatures = self.get('serviceFeatures').split(',');\r\n\t\t\t\t// serviceFeature\r\n\t\t\t\tif (s == 1) {\r\n\t\t\t\t\tserviceFeatures.push(sName);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tserviceFeatures = _.filter(serviceFeatures, function (el) {\r\n\t\t\t\t\t\treturn el !== sName;\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t\tself.set('serviceFeatures', serviceFeatures.join(','));\r\n\t\t\t};\r\n\t\t\tsetServiceFeature(name, status);\r\n\t\t\tconsole.info(\"Switch Shop [\" + self.get('shopID') + \"] ServiceFeature: \" + self.get('serviceFeatures'));\r\n\t\t\tthis.switchShopBusinessStatusCallServer({\r\n\t\t\t\tshopID : shopID,\r\n\t\t\t\tserviceFeature : name,\r\n\t\t\t\toperation : status\r\n\t\t\t}, function (res) {\r\n\t\t\t\tif (res.resultcode !== '000') {\r\n\t\t\t\t\ttoptip({\r\n\t\t\t\t\t\tmsg : $XP(res, 'resultmsg', ''),\r\n\t\t\t\t\t\ttype : 'danger'\r\n\t\t\t\t\t});\r\n\t\t\t\t\tsetServiceFeature(name, !status ? 1 : 0);\r\n\t\t\t\t\tfailFn({\r\n\t\t\t\t\t\tshopID : shopID,\r\n\t\t\t\t\t\tid : id\r\n\t\t\t\t\t});\r\n\t\t\t\t} else {\r\n\t\t\t\t\ttoptip({\r\n\t\t\t\t\t\tmsg : '!',\r\n\t\t\t\t\t\ttype : 'success'\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t},\r\n\t\tbindEvent : function () {\r\n\t\t\tvar self = this;\r\n\t\t\tthis.on({\r\n\t\t\t\t\"switchShopStatus\" : function (params) {\r\n\t\t\t\t\tvar status = $XP(params, 'status'),\r\n\t\t\t\t\t\tfailFn = $XF(params, 'failFn');\r\n\t\t\t\t\tthis.switchShopStatus(status, failFn);\r\n\t\t\t\t},\r\n\t\t\t\t\"switchBusinessStatus\" : function (params) {\r\n\t\t\t\t\tthis.switchShopBusinessStatus(params);\r\n\t\t\t\t},\r\n\t\t\t\t\"setServiceParams\" : function (cfg) {\r\n\t\t\t\t\tvar callServer = $XF(cfg, 'callServer'),\r\n\t\t\t\t\t\tparams = $XP(cfg, 'params', {}),\r\n\t\t\t\t\t\tserviceID = $XP(cfg, 'serviceID'),\r\n\t\t\t\t\t\tshopID = self.get('shopID'),\r\n\t\t\t\t\t\tfailFn = $XF(cfg, 'failFn'),\r\n\t\t\t\t\t\tsuccessFn = $XF(cfg, 'successFn');\r\n\t\t\t\t\tcallServer(IX.inherit(params, {\r\n\t\t\t\t\t\tshopID : shopID,\r\n\t\t\t\t\t\tstrType : serviceID\r\n\t\t\t\t\t}), function (res) {\r\n\t\t\t\t\t\tif (res.resultcode !== '000') {\r\n\t\t\t\t\t\t\ttoptip({\r\n\t\t\t\t\t\t\t\tmsg : $XP(res, 'resultmsg', ''),\r\n\t\t\t\t\t\t\t\ttype : 'danger'\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\tfailFn();\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tvar newData = {};\r\n\t\t\t\t\t\t\tnewData[serviceID] = params;\r\n\t\t\t\t\t\t\tself.set('revParamJson', IX.inherit(self.get('revParamJson'), newData));\r\n\t\t\t\t\t\t\tsuccessFn();\r\n\t\t\t\t\t\t\ttoptip({\r\n\t\t\t\t\t\t\t\tmsg : '!',\r\n\t\t\t\t\t\t\t\ttype : 'success'\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\t});\r\n})(jQuery, window);;(function ($, window) {\r\n\tIX.ns(\"Hualala.Shop\");\r\n\tvar popoverMsg = Hualala.UI.PopoverMsgTip;\r\n\tvar toptip = Hualala.UI.TopTip;\r\n\tvar CardListView = Stapes.subclass({\r\n\t\tconstructor : function () {\r\n\t\t\t// View\r\n\t\t\tthis.$container = null;\r\n\t\t\t// \r\n\t\t\tthis.$resultBox = null;\r\n\t\t\t// \r\n\t\t\tthis.$list = null;\r\n\t\t\t// \r\n\t\t\tthis.$pager = null;\r\n\t\t\tthis.loadTemplates();\r\n\t\t}\r\n\t});\r\n\tCardListView.proto({\r\n\t\tinit : function (cfg) {\r\n\t\t\tthis.$container = $XP(cfg, 'container', null);\r\n\t\t\tthis.model = $XP(cfg, 'model', null);\r\n\t\t\tif (!this.$container || !this.model) {\r\n\t\t\t\tthrow(\"CardList View Init Failed!\");\r\n\t\t\t\treturn ;\r\n\t\t\t}\r\n\t\t\tthis.initLayout();\r\n\t\t},\r\n\t\tinitLayout : function () {\r\n\t\t\tvar layoutTpl = this.get('layoutTpl');\r\n\t\t\tvar htm = layoutTpl();\r\n\t\t\tthis.$container.append(htm);\r\n\t\t\tthis.$resultBox = this.$container.find('.shop-list');\r\n\t\t\tthis.$list = this.$container.find('.shop-list-body');\r\n\t\t\tthis.$pager = this.$container.find('.page-selection');\r\n\t\t\tthis.initPager();\r\n\t\t\tthis.bindEvent();\r\n\t\t},\r\n\t\tinitPager : function (params) {\r\n\t\t\tvar baseCfg = {\r\n\t\t\t\ttotal : 0,\r\n\t\t\t\tpage : 1,\r\n\t\t\t\tmaxVisible : 10,\r\n\t\t\t\tleaps : true\r\n\t\t\t};\r\n\t\t\tthis.$pager.IXPager(IX.inherit(baseCfg, params));\r\n\t\t},\r\n\t\tbindEvent : function () {\r\n\t\t\tvar self = this;\r\n\t\t\tself.$list.tooltip({\r\n\t\t\t\tselector : '[title]'\r\n\t\t\t});\r\n\t\t\tself.$list.on('click', '.btn[data-href]', function (e) {\r\n\t\t\t\tvar $btn = $(this),\r\n\t\t\t\t\tpath = $btn.attr('data-href');\r\n\t\t\t\tdocument.location.href = path;\r\n\t\t\t});\r\n\t\t\tself.$pager.on('page', function (e, pageNo) {\r\n\t\t\t\tvar params = self.model.getPagerParams();\r\n\t\t\t\tparams['Page']['pageNo'] = pageNo;\r\n\t\t\t\tself.model.emit('load', IX.inherit(params, {\r\n\t\t\t\t\tpageNo : $XP(params, 'Page.pageNo', 1),\r\n\t\t\t\t\tpageSize : $XP(params, 'Page.pageSize', 15)\r\n\t\t\t\t}));\r\n\t\t\t});\r\n\t\t},\r\n\t\t// View\r\n\t\tloadTemplates : function () {\r\n\t\t\tvar layoutTpl = Handlebars.compile(Hualala.TplLib.get('tpl_shop_list_layout')),\r\n\t\t\t\tlistTpl = Handlebars.compile(Hualala.TplLib.get('tpl_shop_list')),\r\n\t\t\t\titemTpl = Handlebars.compile(Hualala.TplLib.get('tpl_shop_card')),\r\n\t\t\t\ttagTpl = Handlebars.compile(Hualala.TplLib.get('tpl_shop_tags'));\r\n\t\t\t// shopCard\r\n\t\t\tHandlebars.registerPartial(\"shopTag\", Hualala.TplLib.get('tpl_shop_tags'));\r\n\t\t\tHandlebars.registerPartial(\"shopCard\", Hualala.TplLib.get('tpl_shop_card'));\r\n\r\n\t\t\tthis.set({\r\n\t\t\t\tlayoutTpl : layoutTpl,\r\n\t\t\t\tlistTpl : listTpl,\r\n\t\t\t\titemTpl : itemTpl,\r\n\t\t\t\ttagTpl : tagTpl\r\n\t\t\t});\r\n\t\t},\r\n\t\t// \r\n\t\tmapRenderData : function (data) {\r\n\t\t\tvar self = this;\r\n\t\t\tvar getTags = function (tags) {\r\n\t\t\t\treturn _.map(tags, function (t, i, l) {\r\n\t\t\t\t\treturn {\r\n\t\t\t\t\t\tclz : 'label-info',\r\n\t\t\t\t\t\ttag : t\r\n\t\t\t\t\t};\r\n\t\t\t\t});\r\n\t\t\t};\r\n\t\t\tvar ret = _.map(data, function (shop, i, l) {\r\n\t\t\t\tvar address = $XP(shop, 'address', ''),\r\n\t\t\t\t\tbyteLen = Hualala.Common.strByteLength(address),\r\n\t\t\t\t\tslugAddr = '';\r\n\t\t\t\tslugAddr = byteLen < 72 ? address : (Hualala.Common.substrByte(address, 70) + '...');\r\n\t\t\t\treturn {\r\n\t\t\t\t\tclz : '',\r\n\t\t\t\t\tid : $XP(shop, 'shopID', ''),\r\n\t\t\t\t\tname : $XP(shop, 'shopName', ''),\r\n\t\t\t\t\timg : Hualala.Common.getSourceImage($XP(shop, 'imagePath', ''), {\r\n\t\t\t\t\t\twidth : 100,\r\n\t\t\t\t\t\theight : 100,\r\n\t\t\t\t\t\tquality : 50\r\n\t\t\t\t\t}),\r\n\t\t\t\t\ttags : getTags($XP(shop, 'tags', [])),\r\n\t\t\t\t\taddress : address,\r\n\t\t\t\t\tslugAddr : slugAddr,\r\n\t\t\t\t\ttel : $XP(shop, 'tel', ''),\r\n\t\t\t\t\tinfoHref : Hualala.PageRoute.createPath('shopInfo', [$XP(shop, 'shopID', '')]),\r\n\t\t\t\t\tmenuHref : Hualala.PageRoute.createPath('shopMenu', [$XP(shop, 'shopID', '')]),\r\n\t\t\t\t\tchecked : $XP(shop, 'status') == 1 ? 'checked' : ''\r\n\t\t\t\t};\r\n\t\t\t});\r\n\t\t\treturn {\r\n\t\t\t\tshopCard : {\r\n\t\t\t\t\tlist : ret\r\n\t\t\t\t}\r\n\t\t\t};\r\n\t\t},\r\n\t\t// \r\n\t\tinitSwitcher : function (selector) {\r\n\t\t\tvar self = this;\r\n\t\t\tself.$list.find(selector).bootstrapSwitch({\r\n\t\t\t\t// baseClass : 'ix-bs-switch',\r\n\t\t\t\t// wrapperClass : 'ix-bs-switch-wrapper',\r\n\t\t\t\tsize : 'normal',\r\n\t\t\t\tonColor : 'success',\r\n\t\t\t\toffColor : 'default',\r\n\t\t\t\tonText : '',\r\n\t\t\t\toffText : ''\r\n\t\t\t});\r\n\t\t\t// \r\n\t\t\tself.$list.find(selector).on('switchChange.bootstrapSwitch', function (e, state) {\r\n\t\t\t\tvar $chkbox = $(this),\r\n\t\t\t\t\tshopID = $chkbox.attr('data-shop'),\r\n\t\t\t\t\tstate = !state ? 0 : 1;\r\n\t\t\t\tself.model.updateShopStatus(shopID, state, function (_shopID) {\r\n\t\t\t\t\tself.$list.find(selector).filter('[data-shop=' + _shopID + ']').bootstrapSwitch('toggleState', true);\r\n\t\t\t\t});\r\n\t\t\t});\r\n\t\t},\r\n\t\t// view\r\n\t\trender : function () {\r\n\t\t\tvar self = this,\r\n\t\t\t\tmodel = self.model,\r\n\t\t\t\tpagerParams = model.getPagerParams(),\r\n\t\t\t\tpageNo = $XP(pagerParams, 'Page.pageNo');\r\n\t\t\tvar shops = model.getShops(pageNo);\r\n\t\t\tvar renderData = self.mapRenderData(shops);\r\n\t\t\tvar listTpl = self.get('listTpl');\r\n\t\t\tvar html = listTpl(renderData);\r\n\t\t\tself.$list.empty();\r\n\t\t\tself.$list.html(html);\r\n\t\t\tself.initPager({\r\n\t\t\t\ttotal : model.get('pageCount'),\r\n\t\t\t\tpage : model.get('pageNo'),\r\n\t\t\t\thref : 'javascript:void(0);'\r\n\t\t\t});\r\n\t\t\t// self.$list.find(':checkbox[name*=switcher_]').bootstrapSwitch();\r\n\t\t\tself.initSwitcher(':checkbox[name=switcher]');\r\n\t\t}\r\n\t});\r\n\r\n\tHualala.Shop.CardListView = CardListView;\r\n\r\n\tvar ShopListView = CardListView.subclass({\r\n\t\tconstructor : function () {\r\n\t\t\t// View\r\n\t\t\tthis.$container = null;\r\n\t\t\t// \r\n\t\t\tthis.$resultBox = null;\r\n\t\t\t// \r\n\t\t\tthis.$list = null;\r\n\t\t\t// \r\n\t\t\tthis.$pager = null;\r\n\t\t\tthis.loadTemplates();\r\n\t\t}\r\n\t});\r\n\tShopListView.proto({\r\n\t\tbindEvent : function () {\r\n\t\t\tvar self = this;\r\n\t\t\tself.$list.tooltip({\r\n\t\t\t\tselector : '[title]'\r\n\t\t\t});\r\n\t\t\tself.$pager.on('page', function (e, pageNo) {\r\n\t\t\t\tvar params = self.model.getPagerParams();\r\n\t\t\t\tparams['Page']['pageNo'] = pageNo;\r\n\t\t\t\tself.model.emit('load', IX.inherit(params, {\r\n\t\t\t\t\tpageNo : $XP(params, 'Page.pageNo', 1),\r\n\t\t\t\t\tpageSize : $XP(params, 'Page.pageSize', 15)\r\n\t\t\t\t}));\r\n\t\t\t});\r\n\t\t\t// \r\n\t\t\tself.$list.on('click', '.btn[data-business]', function (e) {\r\n\t\t\t\tvar $btn = $(this),\r\n\t\t\t\t\tshopID = $btn.attr('data-shop'),\r\n\t\t\t\t\tbusinessName = $btn.attr('data-business'),\r\n\t\t\t\t\tbusinessID = $btn.attr('data-business-id');\r\n\t\t\t\tself.initBusinessModal($btn, shopID, businessName, businessID);\r\n\t\t\t});\r\n\t\t},\r\n\t\t// View\r\n\t\tloadTemplates : function () {\r\n\t\t\tvar layoutTpl = Handlebars.compile(Hualala.TplLib.get('tpl_shop_list_layout')),\r\n\t\t\t\tlistTpl = Handlebars.compile(Hualala.TplLib.get('tpl_shop_list')),\r\n\t\t\t\titemTpl = Handlebars.compile(Hualala.TplLib.get('tpl_shop_list_item')),\r\n\t\t\t\ttagTpl = Handlebars.compile(Hualala.TplLib.get('tpl_shop_tags'));\r\n\t\t\t// shopCard\r\n\t\t\tHandlebars.registerPartial(\"shopTag\", Hualala.TplLib.get('tpl_shop_tags'));\r\n\t\t\tHandlebars.registerPartial(\"shopItem\", Hualala.TplLib.get('tpl_shop_list_item'));\r\n\r\n\t\t\tthis.set({\r\n\t\t\t\tlayoutTpl : layoutTpl,\r\n\t\t\t\tlistTpl : listTpl,\r\n\t\t\t\titemTpl : itemTpl,\r\n\t\t\t\ttagTpl : tagTpl\r\n\t\t\t});\r\n\t\t},\r\n\t\t// \r\n\t\tgetShopBusiness : function (shop) {\r\n\t\t\tvar business = Hualala.TypeDef.ShopBusiness,\r\n\t\t\t\tbusinessHT = new IX.IListManager(),\r\n\t\t\t\tserviceFeatures = $XP(shop, 'serviceFeatures', ''),\r\n\t\t\t\tbusinessCfg = $XP(shop, 'revParamJson', {});\r\n\t\t\tvar ret = null;\r\n\t\t\t_.each(business, function (item, i, l) {\r\n\t\t\t\tvar id = $XP(item, 'id'), name = $XP(item, 'name')\r\n\t\t\t\t\tswitcherStatus = serviceFeatures.indexOf(name) >= 0 ? 1 : 0;\r\n\t\t\t\tvar ret = IX.inherit(item, $XP(businessCfg, 'id'), {\r\n\t\t\t\t\tswitcherStatus : switcherStatus,\r\n\t\t\t\t\tshopID : $XP(shop, 'shopID')\r\n\t\t\t\t});\r\n\t\t\t\tbusinessHT.register(name, ret);\r\n\t\t\t});\r\n\t\t\tret = _.filter(businessHT.getAll(), function (el) {\r\n\t\t\t\treturn $XP(el, 'businessIsSupported', false) == true;\r\n\t\t\t});\r\n\t\t\treturn ret;\r\n\t\t},\r\n\t\t// \r\n\t\tmapBusinessRenderData : function (shop) {\r\n\t\t\tvar self = this,\r\n\t\t\t\tdata = self.getShopBusiness(shop);\r\n\t\t\treturn _.map(data, function (el) {\r\n\t\t\t\tvar name = $XP(el, 'name'),\r\n\t\t\t\t\ticon = 'icon-' + name,\r\n\t\t\t\t\tswitcherName = 'switcher_business',\r\n\t\t\t\t\topen = $XP(el, 'switcherStatus') == 1 ? 'checked' : '';\r\n\t\t\t\treturn {\r\n\t\t\t\t\ticon : icon,\r\n\t\t\t\t\tlabel : $XP(el, 'label'),\r\n\t\t\t\t\tswitcherName : switcherName,\r\n\t\t\t\t\tshopID : $XP(el, 'shopID'),\r\n\t\t\t\t\ttype : name,\r\n\t\t\t\t\tid : $XP(el, 'id'),\r\n\t\t\t\t\topen : open,\r\n\t\t\t\t\tdesc : ''\r\n\t\t\t\t};\r\n\t\t\t});\r\n\t\t},\r\n\t\t// \r\n\t\tchkHasAccountRole : function () {\r\n\t\t\tvar loginUsr = Hualala.getSessionUser(),\r\n\t\t\t\tusrRoles = $XP(loginUsr, 'role');\r\n\t\t\t\troles = Hualala.getSessionRoles();\r\n\t\t\tvar ret = _.find(roles, function (role) {\r\n\t\t\t\tvar roleType = $XP(role, 'roleType');\r\n\t\t\t\tvar matchedID = _.find(usrRoles, function (v) {\r\n\t\t\t\t\treturn $XP(role, 'id') == v;\r\n\t\t\t\t});\r\n\t\t\t\treturn !!matchedID && (roleType == 'account' || roleType == 'all');\r\n\t\t\t});\r\n\t\t\treturn !!ret;\r\n\t\t},\r\n\t\t// \r\n\t\tmapRenderData : function (data) {\r\n\t\t\tvar self = this;\r\n\t\t\tvar ret = _.map(data, function (shop, i, l) {\r\n\t\t\t\treturn {\r\n\t\t\t\t\tclz : '',\r\n\t\t\t\t\tshopID : $XP(shop, 'shopID', ''),\r\n\t\t\t\t\tshopName : $XP(shop, 'shopName', ''),\r\n\t\t\t\t\thideAccount : !self.chkHasAccountRole() ? 'hidden' : '',\r\n\t\t\t\t\tsettleName : $XP(shop, 'settleName', ''),\r\n\t\t\t\t\tswitcherName : 'switcher_status',\r\n\t\t\t\t\tshopOpen : $XP(shop, 'status') == 1 ? 'checked' : '',\r\n\t\t\t\t\tbusiness : self.mapBusinessRenderData(shop)\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\treturn {\r\n\t\t\t\tshopItem : {\r\n\t\t\t\t\tlist : ret\r\n\t\t\t\t}\r\n\t\t\t};\r\n\t\t},\r\n\t\t// \r\n\t\tinitSwitcher : function (selector) {\r\n\t\t\tvar self = this;\r\n\t\t\tself.$list.find(selector).bootstrapSwitch({\r\n\t\t\t\t// baseClass : 'ix-bs-switch',\r\n\t\t\t\t// wrapperClass : 'ix-bs-switch-wrapper',\r\n\t\t\t\tsize : 'normal',\r\n\t\t\t\tonColor : selector == ':checkbox[name=switcher_business]' ? 'primary' : 'success',\r\n\t\t\t\toffColor : 'default',\r\n\t\t\t\tonText : '',\r\n\t\t\t\toffText : ''\r\n\t\t\t});\r\n\t\t\t// \r\n\t\t\tself.$list.find(selector).on('switchChange.bootstrapSwitch', function (e, state) {\r\n\t\t\t\tvar $chkbox = $(this),\r\n\t\t\t\t\tname = $chkbox.attr('name'),\r\n\t\t\t\t\tshopID = $chkbox.attr('data-shop'),\r\n\t\t\t\t\tstate = !state ? 0 : 1,\r\n\t\t\t\t\tbusiness = $chkbox.attr('data-business'),\r\n\t\t\t\t\tbusinessID = $chkbox.attr('data-business-id');\r\n\t\t\t\tif (name == 'switcher_status') {\r\n\t\t\t\t\tself.model.updateShopStatus(shopID, state, function (_shopID) {\r\n\t\t\t\t\t\tself.$list.find(selector).filter('[data-shop=' + _shopID + ']').bootstrapSwitch('toggleState', true);\r\n\t\t\t\t\t});\r\n\t\t\t\t} else {\r\n\t\t\t\t\tself.model.updateShopBusinessStatus({\r\n\t\t\t\t\t\tshopID : shopID,\r\n\t\t\t\t\t\tname : business,\r\n\t\t\t\t\t\tid : businessID,\r\n\t\t\t\t\t\tstatus : state\r\n\t\t\t\t\t}, function (params) {\r\n\t\t\t\t\t\tself.$list.find(selector).filter('[data-shop=' + $XP(params, 'shopID') + '][data-business-id=' + $XP(params, 'id') + ']')\r\n\t\t\t\t\t\t\t.bootstrapSwitch('toggleState', true);\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t});\r\n\t\t},\r\n\t\t// view\r\n\t\trender : function () {\r\n\t\t\tvar self = this,\r\n\t\t\t\tmodel = self.model,\r\n\t\t\t\tpagerParams = model.getPagerParams(),\r\n\t\t\t\tpageNo = $XP(pagerParams, 'Page.pageNo');\r\n\t\t\tvar shops = model.getShops(pageNo);\r\n\t\t\tvar renderData = self.mapRenderData(shops);\r\n\t\t\tvar listTpl = self.get('listTpl');\r\n\t\t\tvar html = listTpl(renderData);\r\n\t\t\tself.$list.empty();\r\n\t\t\tself.$list.html(html);\r\n\t\t\tself.initPager({\r\n\t\t\t\ttotal : model.get('pageCount'),\r\n\t\t\t\tpage : model.get('pageNo'),\r\n\t\t\t\thref : 'javascript:void(0);'\r\n\t\t\t});\r\n\t\t\t// self.$list.find(':checkbox[name*=switcher_]').bootstrapSwitch();\r\n\t\t\tself.initSwitcher(':checkbox[name=switcher_business]');\r\n\t\t\tself.initSwitcher(':checkbox[name=switcher_status]');\r\n\t\t},\r\n\t\t// \r\n\t\tinitBusinessModal : function (trigger, shopID, name, id) {\r\n\t\t\tvar self = this;\r\n\t\t\tvar editView = new Hualala.Setting.editServiceView({\r\n\t\t\t\ttriggerEl : trigger,\r\n\t\t\t\tserviceID : id,\r\n\t\t\t\tserviceName : name,\r\n\t\t\t\tmodel : self.model.getShopModelByShopID(shopID)\r\n\t\t\t});\r\n\t\t}\r\n\t});\r\n\tHualala.Shop.ShopListView = ShopListView;\r\n})(jQuery, window);;(function ($, window) {\r\n\tIX.ns(\"Hualala.Shop\");\r\n\tvar popoverMsg = Hualala.UI.PopoverMsgTip;\r\n\tvar toptip = Hualala.UI.TopTip;\r\n\tvar ShopListModel = Hualala.Shop.ShopListModel;\r\n\tvar ShopListView = Hualala.Shop.ShopListView;\r\n\tvar ShopListController = Stapes.subclass({\r\n\t\t/**\r\n\t\t * \r\n\t\t * @param  {Object} cfg \r\n\t\t *          @param {JQueryObj} container \r\n\t\t *          @param {Object} view  View\r\n\t\t *          @param {Object} model \r\n\t\t * @return {Object}     \r\n\t\t */\r\n\t\tconstructor : function (cfg) {\r\n\t\t\tthis.set({\r\n\t\t\t\tsessionData : Hualala.getSessionData()\r\n\t\t\t});\r\n\t\t\tthis.container = $XP(cfg, 'container', null);\r\n\t\t\tthis.view = $XP(cfg, 'view', null),\r\n\t\t\tthis.model = $XP(cfg, 'model', null);\r\n\t\t\tif (!this.view || !this.model || !this.container) {\r\n\t\t\t\tthrow(\"Shop List init faild!!\");\r\n\t\t\t}\r\n\t\t\tthis.isReady = false;\r\n\t\t\tthis.bindEvent();\r\n\t\t}\r\n\t});\r\n\tShopListController.proto({\r\n\t\tinit : function (params) {\r\n\t\t\tthis.model.init(params);\r\n\t\t\tthis.view.init({\r\n\t\t\t\tmodel : this.model,\r\n\t\t\t\tcontainer : this.container\r\n\t\t\t});\r\n\t\t\tthis.isReady = true;\r\n\t\t},\r\n\t\thasReady : function () {return this.isReady;},\r\n\t\tbindEvent : function () {\r\n\t\t\tthis.on({\r\n\t\t\t\tload : function (params) {\r\n\t\t\t\t\tvar self = this;\r\n\t\t\t\t\tif (!self.hasReady()) {\r\n\t\t\t\t\t\tself.init(params);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tself.model.emit('load', params);\r\n\t\t\t\t}\r\n\t\t\t}, this);\r\n\t\t\tthis.model.on({\r\n\t\t\t\tload : function (params) {\r\n\t\t\t\t\tvar self = this;\r\n\t\t\t\t\tvar cbFn = function () {\r\n\t\t\t\t\t\tself.view.emit('render');\r\n\t\t\t\t\t};\r\n\t\t\t\t\tself.model.load(params, cbFn);\r\n\t\t\t\t},\r\n\t\t\t\t// \"update:totalSize\" : function (v) {\r\n\t\t\t\t// \tvar self = this;\r\n\t\t\t\t// \tself.view.initPager({\r\n\t\t\t\t// \t\ttotal : self.get('totalSize'),\r\n\t\t\t\t// \t\tpage : self.get('pageNo')\r\n\t\t\t\t// \t});\r\n\t\t\t\t// }\r\n\t\t\t}, this);\r\n\t\t\tthis.view.on({\r\n\t\t\t\trender : function () {\r\n\t\t\t\t\tvar self = this;\r\n\t\t\t\t\tself.view.render();\r\n\t\t\t\t},\r\n\t\t\t\treloadPager : function (params) {\r\n\t\t\t\t\tvar self = this;\r\n\t\t\t\t\tself.view.initPager(params);\r\n\t\t\t\t}\r\n\t\t\t}, this);\r\n\t\t}\r\n\t});\r\n\tHualala.Shop.ShopListController = ShopListController;\r\n})(jQuery, window);;(function ($, window) {\r\nIX.ns('Hualala.Shop');\r\nvar G = Hualala.Global,\r\n    U = Hualala.UI,\r\n    topTip = U.TopTip; \r\n// \r\nHualala.Shop.initCreate = function ($wizard)\r\n{\r\n    //\r\n    $wizard.bootstrapWizard();\r\n    var bsWizard = $wizard.data('bootstrapWizard'),\r\n        $step1 = $wizard.find('#tab1'),\r\n        $step2 = $wizard.find('#tab2'),\r\n        $step3 = $wizard.find('#tab3'),\r\n        $city = $step1.find('#cityID'),\r\n        $area = $step1.find('#areaID'),\r\n        $cuisine1 = $step1.find('#cuisineID1'),\r\n        $cuisine2 = $step1.find('#cuisineID2');\r\n    // \r\n    initCities($city);\r\n    // \r\n    $city.on('change', function ()\r\n    {\r\n        var cityID = $(this).val();\r\n        if(!cityID) return;\r\n        \r\n        initAreas($area, cityID);\r\n        initCuisines($cuisine1, $cuisine2, cityID);\r\n        \r\n    });\r\n    // timepicker\r\n    $step1.find('#openingHoursStart, #openingHoursEnd').timepicker({\r\n        minuteStep: 1,\r\n        showMeridian: false,\r\n        disableFocus : true,\r\n        showInputs : false\r\n    });\r\n    // \r\n    $step1.bootstrapValidator({\r\n        fields: {\r\n            shopName: {\r\n                message: '',\r\n                validators: {\r\n                    notEmpty: {\r\n                        message: ''\r\n                    },\r\n                    stringLength: {\r\n                        min: 2,\r\n                        max: 100,\r\n                        message: '2100'\r\n                    }\r\n                }\r\n            },\r\n            cityID: {\r\n                validators: { notEmpty: { message: '' } }\r\n            },\r\n            tel: {\r\n                validators: {\r\n                    notEmpty: { message: '' },\r\n                    telOrMobile: { message: '' }\r\n                }\r\n            },\r\n            address: {\r\n                validators: {\r\n                    notEmpty: { message: '' },\r\n                    stringLength: {\r\n                        min: 6,\r\n                        max: 100,\r\n                        message: '6100'\r\n                    }\r\n                }\r\n            },\r\n            PCCL: {\r\n                validators: {\r\n                    notEmpty: { message: '' },\r\n                    numeric: { message: '' }\r\n                }\r\n            },\r\n            operationMode: {\r\n                validators: {\r\n                    notEmpty: { message: '' }\r\n                }\r\n            },\r\n            openingHoursStart: {\r\n                validators: {\r\n                    notEmpty: { message: '' },\r\n                    time: { message: '' }\r\n                }\r\n            },\r\n            openingHoursEnd: {\r\n                validators: {\r\n                    notEmpty: { message: '' },\r\n                    time: {\r\n                        message: '',\r\n                        startTimeField: 'openingHoursStart'\r\n                    }\r\n                }\r\n            },\r\n            areaID: {\r\n                validators: {\r\n                    notEmpty: { message: '' }\r\n                }\r\n            },\r\n            cuisineID1: {\r\n                validators: {\r\n                    notEmpty: { message: '1' }\r\n                }\r\n            }\r\n        }\r\n    });\r\n    \r\n    var $uploadImg = $step1.find('#uploadImg'),\r\n        imagePath = ''; // \r\n    // \r\n    $uploadImg.find('button, img').on('click', function()\r\n    {\r\n        U.uploadImg({\r\n            onSuccess: function (imgPath, $dlg)\r\n            {\r\n                var src = 'http://res.hualala.com/' + imgPath;\r\n                imagePath = imgPath;\r\n                $uploadImg.find('img').attr('src', src);\r\n                $dlg.modal('hide');\r\n            }\r\n        });\r\n    });\r\n    //bsWizard.show(2);\r\n    var dataStep1 = null, // \r\n        map = null, // \r\n        shopID = '',\r\n        $searchBox = $step2.find('.map-search-box'),\r\n        $shopSettingLink = $step3.find('#shopSettingLink');\r\n    // \r\n    $wizard.find('#nextStep').on('click', function()\r\n    {\r\n        var $curStep = bsWizard.activePane();\r\n        // \r\n        if($curStep.is('#tab1'))\r\n        {\r\n            if(!$step1.data('bootstrapValidator').validate().isValid()) return;\r\n            // \r\n            dataStep1 = Hualala.Common.parseForm($step1);\r\n            dataStep1.shopID = shopID;\r\n            dataStep1.shopName = dataStep1.shopName.replace('', '(').replace('', ')');\r\n            dataStep1.areaName = getSelectText($area);\r\n            dataStep1.cuisineName1 = getSelectText($cuisine1);\r\n            dataStep1.cuisineName2 = dataStep1.cuisineID2 ? getSelectText($cuisine2) : '';\r\n            dataStep1.imagePath = imagePath;\r\n            dataStep1.openingHours = dataStep1.openingHoursStart + '-' + dataStep1.openingHoursEnd;\r\n            var keywords = [dataStep1.shopName, dataStep1.address, dataStep1.cuisineName1];\r\n            dataStep1.cuisineName2 && keywords.push(dataStep1.cuisineName2);\r\n            keywords.push(dataStep1.areaName);\r\n            dataStep1.keywordLst = keywords.join(' | ');\r\n            // \r\n            var callServer = shopID ? G.updateShopBaseInfo : G.createShop;\r\n            callServer(dataStep1, function(rsp)\r\n            {\r\n                if(rsp.resultcode != '000')\r\n                {\r\n                    rsp.resultmsg && topTip(rsp.resultmsg, 'danger');\r\n                    return;\r\n                }\r\n                shopID = shopID || rsp.data.records[0].shopID;\r\n                $shopSettingLink.attr('href', Hualala.PageRoute.createPath('setting'));\r\n                // \r\n                bsWizard.next();\r\n                // \r\n                map = Hualala.Shop.map({data: {\r\n                    isSearchMap: true,\r\n                    shopName: dataStep1.shopName,\r\n                    tel: dataStep1.tel,\r\n                    address: dataStep1.address\r\n                }, searchBox: $searchBox});\r\n                \r\n            });\r\n            \r\n            return;\r\n        }\r\n        // \r\n        if($curStep.is('#tab2'))\r\n        {\r\n            var lng = map.mapPoint.lng, lat = map.mapPoint.lat,\r\n                mapInfo = {\r\n                    shopID: shopID,\r\n                    mapLongitudeValue: lng,\r\n                    mapLatitudeValue: lat,\r\n                    mapLongitudeValueBaiDu: lng,\r\n                    mapLatitudeValueBaiDu: lat\r\n                };\r\n            var callServer = G.setShopMap;\r\n            callServer(mapInfo, function(rsp)\r\n            {\r\n                if(rsp.resultcode != '000')\r\n                {\r\n                    rsp.resultmsg && topTip(rsp.resultmsg, 'danger');\r\n                    return;\r\n                }\r\n            });\r\n        }\r\n        bsWizard.next();\r\n    });\r\n    \r\n}\r\n// \r\nfunction initCuisines($cuisine1, $cuisine2, cityID)\r\n{\r\n    var callServer = G.getCuisines;\r\n    callServer({cityID: cityID}, function(rsp)\r\n    {\r\n        if(rsp.resultcode != '000')\r\n        {\r\n            rsp.resultmsg && topTip(rsp.resultmsg, 'danger');\r\n            return;\r\n        }\r\n        \r\n        fillSelectBox($cuisine1, rsp.data.records, 'cuisineID', 'cuisineName');\r\n        fillSelectBox($cuisine2, rsp.data.records, 'cuisineID', 'cuisineName', '----');\r\n    });\r\n    \r\n}\r\n// \r\nfunction initAreas($selectBox, cityID)\r\n{\r\n    var callServer = G.getAreas;\r\n    callServer({cityID: cityID}, function(rsp)\r\n    {\r\n        if(rsp.resultcode != '000')\r\n        {\r\n            rsp.resultmsg && topTip(rsp.resultmsg, 'danger');\r\n            return;\r\n        }\r\n        \r\n        fillSelectBox($selectBox, rsp.data.records, 'areaID', 'areaName');\r\n    });\r\n    \r\n}\r\n// \r\nfunction initCities($selectBox)\r\n{\r\n    var callServer = G.getCities;\r\n    callServer({isActive: 1}, function(rsp)\r\n    {\r\n        if(rsp.resultcode != '000')\r\n        {\r\n            rsp.resultmsg && topTip(rsp.resultmsg, 'danger');\r\n            return;\r\n        }\r\n        \r\n        fillSelectBox($selectBox, rsp.data.records, 'cityID', 'cityName');\r\n    });\r\n    \r\n}\r\n// \r\nfunction fillSelectBox($selectBox, data, key, value, initialValue)\r\n{\r\n    var optionsHtml = '<option value=\"\">' + \r\n                      (initialValue || '----') + \r\n                      '</option>';\r\n    $.each(data, function (i, o)\r\n    {\r\n        optionsHtml += '<option value=\"' + \r\n                       o[key] + '\">' + \r\n                       o[value] + \r\n                       '</option>';\r\n    });\r\n        \r\n    $selectBox.empty().html(optionsHtml);\r\n}\r\n// \r\nfunction getSelectText($select)\r\n{\r\n    return $select.find('option:selected').text().replace(/-/g, '');\r\n}\r\n\r\n})(jQuery, window);\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n;(function ($, window) {\r\n\tIX.ns(\"Hualala.Shop\");\r\n\tvar initShopList = function (pageType, params) {\r\n\t\tvar $body = $('#ix_wrapper > .ix-body > .container');\r\n\t\tvar queryPanel = new Hualala.Shop.QueryController({\r\n\t\t\tneedShopCreate : true,\r\n\t\t\tcontainer : $body,\r\n\t\t\tresultController : new Hualala.Shop.ShopListController({\r\n\t\t\t\tcontainer : $body,\r\n\t\t\t\tmodel : new Hualala.Shop.CardListModel({callServer : Hualala.Global.queryShop}),\r\n\t\t\t\tview : new Hualala.Shop.CardListView()\r\n\t\t\t})\r\n\t\t});\r\n\t\t// TODO \r\n\t};\r\n\tHualala.Shop.HomePageInit = initShopList;\r\n\r\n\tvar initShopBaseInfoMgr = function (pageType, params) {\r\n\t\tvar $body = $('#ix_wrapper > .ix-body > .container');\r\n\t\t$body.html(\r\n\t\t\t'<div class=\"jumbotron\">'+\r\n\t\t\t\t'<h1></h1>' +\r\n\t\t\t\t'<p></p>' +\r\n\t\t\t\t\r\n\t\t\t'</div>'\r\n\t\t\t);\r\n\t\t// TODO \r\n\t};\r\n\tHualala.Shop.BaseInfoMgrInit = initShopBaseInfoMgr;\r\n\r\n\tvar initFoodMenuMgr = function (pageType, params) {\r\n\t\tvar $body = $('#ix_wrapper > .ix-body > .container');\r\n\t\t$body.html(\r\n\t\t\t'<div class=\"jumbotron\">'+\r\n\t\t\t\t'<h1></h1>' +\r\n\t\t\t\t'<p></p>' +\r\n\t\t\t\t\r\n\t\t\t'</div>'\r\n\t\t\t);\r\n\t\t// TODO \r\n\t};\r\n\tHualala.Shop.FoodMenuMgrInit = initFoodMenuMgr;\r\n\r\n\tvar initCreateShop = function (pageType, params) {\r\n\t\tvar $body = $('#ix_wrapper > .ix-body > .container'),\r\n            tpl = Handlebars.compile(Hualala.TplLib.get('tpl_shop_create')),\r\n            $shopCreateWizard = $(tpl({\r\n                pcClientPath: Hualala.PageRoute.createPath('pcclient')\r\n            }));\r\n\t\t$body.append($shopCreateWizard);\r\n        Hualala.Shop.initCreate($shopCreateWizard);\r\n\t\t\r\n\t};\r\n\tHualala.Shop.CreateShopInit = initCreateShop;\r\n\r\n\t\r\n})(jQuery, window);;(function ($, window) {\r\n\tIX.ns(\"Hualala.Setting\");\r\n\tvar popoverMsg = Hualala.UI.PopoverMsgTip;\r\n\tvar toptip = Hualala.UI.TopTip;\r\n\tvar ServiceFormElsCfg = {\r\n\t\tadvanceTime : {\r\n\t\t\ttype : 'combo',\r\n\t\t\tlabel : '',\r\n\t\t\tdefaultVal : 0,\r\n\t\t\tprefix : '$',\r\n\t\t\tsurfix : '',\r\n\t\t\toptions : Hualala.TypeDef.MinuteIntervalOptions(),\r\n\t\t\tvalidCfg : {\r\n\t\t\t\tvalidators : {\r\n\t\t\t\t\tnotEmpty : {\r\n\t\t\t\t\t\tmessage : \"\"\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\tnoticeTime : {\r\n\t\t\ttype : 'combo',\r\n\t\t\tlabel : '',\r\n\t\t\tdefaultVal : 0,\r\n\t\t\toptions : Hualala.TypeDef.MinuteIntervalOptions(),\r\n\t\t\tvalidCfg : {\r\n\t\t\t\tvalidators : {\r\n\t\t\t\t\tnotEmpty : {\r\n\t\t\t\t\t\tmessage : \"\"\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\tminAmount : {\r\n\t\t\ttype : 'text',\r\n\t\t\tlabel : '',\r\n\t\t\tprefix : '',\r\n\t\t\tsurfix : '',\r\n\t\t\tdefaultVal : 0,\r\n\t\t\tvalidCfg : {\r\n\t\t\t\tvalidators : {\r\n\t\t\t\t\tnotEmpty : {\r\n\t\t\t\t\t\tmessage : \"\"\r\n\t\t\t\t\t},\r\n\t\t\t\t\tnumeric : {\r\n\t\t\t\t\t\tmessage: \"\"\r\n\t\t\t\t\t},\r\n\t\t\t\t\tgreaterThan : {\r\n\t\t\t\t\t\tinclusive : true,\r\n\t\t\t\t\t\tvalue : 0,\r\n\t\t\t\t\t\tmessage : \"0\"\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\tserviceAmount : {\r\n\t\t\ttype : 'text',\r\n\t\t\tlabel : '',\r\n\t\t\tprefix : '',\r\n\t\t\tsurfix : '',\r\n\t\t\tdefaultVal : 0,\r\n\t\t\tvalidCfg : {\r\n\t\t\t\tvalidators : {\r\n\t\t\t\t\tnumeric : {\r\n\t\t\t\t\t\tmessage: \"\"\r\n\t\t\t\t\t},\r\n\t\t\t\t\tgreaterThan : {\r\n\t\t\t\t\t\tinclusive : true,\r\n\t\t\t\t\t\tvalue : 0,\r\n\t\t\t\t\t\tmessage : \"0\"\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\tfreeServiceAmount : {\r\n\t\t\ttype : 'text',\r\n\t\t\tlabel : '',\r\n\t\t\tprefix : '',\r\n\t\t\tsurfix : '',\r\n\t\t\tdefaultVal : 0,\r\n\t\t\tvalidCfg : {\r\n\t\t\t\tvalidators : {\r\n\t\t\t\t\tnumeric : {\r\n\t\t\t\t\t\tmessage: \"\"\r\n\t\t\t\t\t},\r\n\t\t\t\t\tgreaterThan : {\r\n\t\t\t\t\t\tinclusive : true,\r\n\t\t\t\t\t\tvalue : 0,\r\n\t\t\t\t\t\tmessage : \"0\"\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\tholidayFlag : {\r\n\t\t\ttype : 'combo',\r\n\t\t\tlabel : '',\r\n\t\t\tdefaultVal : 0,\r\n\t\t\toptions : Hualala.TypeDef.HolidayFlagOptions,\r\n\t\t\tvalidCfg : {\r\n\t\t\t\tvalidators : {\r\n\t\t\t\t\tnotEmpty : {\r\n\t\t\t\t\t\tmessage : \"\"\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\topenDays : {\r\n\t\t\ttype : 'text',\r\n\t\t\tlabel : '',\r\n\t\t\tsurfix : '',\r\n\t\t\tdefaultVal : '',\r\n\t\t\tvalidCfg : {\r\n\t\t\t\tvalidators : {\r\n\t\t\t\t\tnotEmpty : {\r\n\t\t\t\t\t\tmessage : \"\"\r\n\t\t\t\t\t},\r\n\t\t\t\t\tdigits : {\r\n\t\t\t\t\t\tmessage: \"\"\r\n\t\t\t\t\t},\r\n\t\t\t\t\tgreaterThan : {\r\n\t\t\t\t\t\tinclusive : true,\r\n\t\t\t\t\t\tvalue : 0,\r\n\t\t\t\t\t\tmessage : \"0\"\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\tservicePeriods : {\r\n\t\t\ttype : 'section',\r\n\t\t\tlabel : '',\r\n\t\t\tmin : {\r\n\t\t\t\ttype : 'timepicker',\r\n\t\t\t\tsurfix : '<span class=\"glyphicon glyphicon-time\"></span>',\r\n\t\t\t\tdefaultVal : '',\r\n\t\t\t\tvalidCfg : {\r\n\t\t\t\t\tgroup : '.min-input',\r\n\t\t\t\t\tvalidators : {\r\n\t\t\t\t\t\tnotEmpty : {\r\n\t\t\t\t\t\t\tmessage : \"\"\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tmax : {\r\n\t\t\t\ttype : 'timepicker',\r\n\t\t\t\tsurfix : '<span class=\"glyphicon glyphicon-time\"></span>',\r\n\t\t\t\tdefaultVal : '',\r\n\t\t\t\tvalidCfg : {\r\n\t\t\t\t\tgroup : '.max-input',\r\n\t\t\t\t\tvalidators : {\r\n\t\t\t\t\t\tnotEmpty : {\r\n\t\t\t\t\t\t\tmessage : \"\"\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\treserveTableTime : {\r\n\t\t\ttype : 'combo',\r\n\t\t\tlabel : '',\r\n\t\t\tdefaultVal : 0,\r\n\t\t\toptions : Hualala.TypeDef.MinuteIntervalOptions(60),\r\n\t\t\tvalidCfg : {\r\n\t\t\t\tvalidators : {\r\n\t\t\t\t\tnotEmpty : {\r\n\t\t\t\t\t\tmessage : \"\"\r\n\t\t\t\t\t},\r\n\t\t\t\t\tnumeric : {\r\n\t\t\t\t\t\tmessage: \"\"\r\n\t\t\t\t\t},\r\n\t\t\t\t\tgreaterThan : {\r\n\t\t\t\t\t\tinclusive : true,\r\n\t\t\t\t\t\tvalue : 0,\r\n\t\t\t\t\t\tmessage : \"0\"\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\treserveTableDesc : {\r\n\t\t\ttype : 'text',\r\n\t\t\tlabel : '',\r\n\t\t\tdefaultVal : '',\r\n\t\t\tvalidCfg : {\r\n\t\t\t\tvalidators : {\r\n\t\t\t\t\tstringLength : {\r\n\t\t\t\t\t\tmax : 40,\r\n\t\t\t\t\t\tmessage : '40'\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\ttakeawayDeliveryAgent : {\r\n\t\t\ttype : 'text',\r\n\t\t\tlabel : '',\r\n\t\t\tdefaultVal : '',\r\n\t\t\tvalidCfg : {}\r\n\t\t},\r\n\t\ttakeawayDeliveryTime : {\r\n\t\t\ttype : 'text',\r\n\t\t\tlabel : '',\r\n\t\t\tsurfix : '',\r\n\t\t\tdefaultVal : '',\r\n\t\t\tvalidCfg : {\r\n\t\t\t\tvalidators : {\r\n\t\t\t\t\tnotEmpty : {\r\n\t\t\t\t\t\tmessage : \"\"\r\n\t\t\t\t\t},\r\n\t\t\t\t\tnumeric : {\r\n\t\t\t\t\t\tmessage: \"\"\r\n\t\t\t\t\t},\r\n\t\t\t\t\tgreaterThan : {\r\n\t\t\t\t\t\tinclusive : true,\r\n\t\t\t\t\t\tvalue : 0,\r\n\t\t\t\t\t\tmessage : \"0\"\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\ttakeawayScope : {\r\n\t\t\ttype : 'text',\r\n\t\t\tlabel : '',\r\n\t\t\tsurfix : '',\r\n\t\t\tdefaultVal : '',\r\n\t\t\tvalidCfg : {\r\n\t\t\t\tvalidators : {\r\n\t\t\t\t\tnotEmpty : {\r\n\t\t\t\t\t\tmessage : \"\"\r\n\t\t\t\t\t},\r\n\t\t\t\t\tnumeric : {\r\n\t\t\t\t\t\tmessage: \"\"\r\n\t\t\t\t\t},\r\n\t\t\t\t\tgreaterThan : {\r\n\t\t\t\t\t\tinclusive : true,\r\n\t\t\t\t\t\tvalue : 0,\r\n\t\t\t\t\t\tmessage : \"0\"\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\ttakeawayScopeDesc : {\r\n\t\t\ttype : 'text',\r\n\t\t\tlabel : '',\r\n\t\t\tdefaultVal : '',\r\n\t\t\tvalidCfg : {\r\n\t\t\t\tvalidators : {\r\n\t\t\t\t\tstringLength : {\r\n\t\t\t\t\t\tmax : 200,\r\n\t\t\t\t\t\tmessage : '200'\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\tsubmitSMSTemplateID : {\r\n\t\t\ttype : 'hidden',\r\n\t\t\tdefaultVal : ''\r\n\t\t},\r\n\t\tcheckSMSTemplateID : {\r\n\t\t\ttype : 'hidden',\r\n\t\t\tdefaultVal : ''\r\n\t\t},\r\n\t\tpayMethod : {\r\n\t\t\ttype : 'combo',\r\n\t\t\tlabel : '',\r\n\t\t\tdefaultVal : 0,\r\n\t\t\toptions : Hualala.TypeDef.PayMethodOptions,\r\n\t\t\tvalidCfg : {\r\n\t\t\t\tvalidators : {\r\n\t\t\t\t\tnotEmpty : {\r\n\t\t\t\t\t\tmessage : \"\"\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\tneedInputTableName : {\r\n\t\t\ttype : 'switcher',\r\n\t\t\tlabel : '',\r\n\t\t\tdefaultVal : 1,\r\n\t\t\tonLabel : '',\r\n\t\t\toffLabel : '',\r\n\t\t\tvalidCfg : {\r\n\t\t\t\tvalidators : {\r\n\t\t\t\t\tnotEmpty : {\r\n\t\t\t\t\t\tmessage : \"\"\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t}\r\n\t\t},\r\n\t\tsupportInvoice : {\r\n\t\t\ttype : 'switcher',\r\n\t\t\tlabel : '',\r\n\t\t\tdefaultVal : 1,\r\n\t\t\tonLabel : '',\r\n\t\t\toffLabel : '',\r\n\t\t\tvalidCfg : {\r\n\t\t\t\tvalidators : {\r\n\t\t\t\t\tnotEmpty : {\r\n\t\t\t\t\t\tmessage : \"\"\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t\r\n\t\t},\r\n\t\tsupportCommitToSoftware : {\r\n\t\t\ttype : 'switcher',\r\n\t\t\tlabel : '',\r\n\t\t\tdefaultVal : 1,\r\n\t\t\tonLabel : '',\r\n\t\t\toffLabel : '',\r\n\t\t\tvalidCfg : {\r\n\t\t\t\tvalidators : {\r\n\t\t\t\t\tnotEmpty : {\r\n\t\t\t\t\t\tmessage : \"\"\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\tpayMethodAtShop : {\r\n\t\t\ttype : 'combo',\r\n\t\t\tlabel : '',\r\n\t\t\tdefaultVal : 0,\r\n\t\t\toptions : Hualala.TypeDef.PayMethodAtShopOptions,\r\n\t\t\tvalidCfg : {\r\n\t\t\t\tvalidators : {\r\n\t\t\t\t\tnotEmpty : {\r\n\t\t\t\t\t\tmessage : \"\"\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\tpayBeforeCommit : {\r\n\t\t\ttype : 'switcher',\r\n\t\t\tlabel : '',\r\n\t\t\tdefaultVal : 1,\r\n\t\t\tonLabel : '',\r\n\t\t\toffLabel : '',\r\n\t\t\tvalidCfg : {\r\n\t\t\t\tvalidators : {\r\n\t\t\t\t\tnotEmpty : {\r\n\t\t\t\t\t\tmessage : \"\"\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t\r\n\t\t},\r\n\t\tfetchFoodMode : {\r\n\t\t\ttype : 'combo',\r\n\t\t\tlabel : '',\r\n\t\t\tdefaultVal : 0,\r\n\t\t\toptions : Hualala.TypeDef.FetchFoodModeOptions,\r\n\t\t\tvalidCfg : {\r\n\t\t\t\tvalidators : {\r\n\t\t\t\t\tnotEmpty : {\r\n\t\t\t\t\t\tmessage : \"\"\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n\tvar ServiceFormElsHT = new IX.IListManager();\r\n\t_.each(ServiceFormElsCfg, function (el, k) {\r\n\t\tvar type = $XP(el, 'type');\r\n\t\tvar labelClz = 'col-sm-offset-1 col-sm-3 control-label';\r\n\t\tif (type == 'section') {\r\n\t\t\tvar id = minID = k + '_min_' + IX.id(), maxID = k + '_max_' + IX.id(),\r\n\t\t\t\tminName = k + '_min', maxName = k + '_max',\r\n\t\t\t\tmin = IX.inherit($XP(el, 'min', {}), {\r\n\t\t\t\t\tid : minID, name : minName, clz : 'col-sm-3',\r\n\t\t\t\t}), max = IX.inherit($XP(el, 'max', {}), {\r\n\t\t\t\t\tid : maxID, name : maxName, clz : 'col-sm-3',\r\n\t\t\t\t});\r\n\t\t\tServiceFormElsHT.register(k, IX.inherit(el, {\r\n\t\t\t\tid : id,\r\n\t\t\t\tlabelClz : labelClz,\r\n\t\t\t\tmin : min,\r\n\t\t\t\tmax : max\r\n\t\t\t}));\r\n\t\t} else {\r\n\t\t\tServiceFormElsHT.register(k, IX.inherit(el, {\r\n\t\t\t\tid : k + '_' + IX.id(),\r\n\t\t\t\tname : k,\r\n\t\t\t\tlabelClz : labelClz,\r\n\t\t\t\tclz : 'col-sm-5'\r\n\t\t\t}));\r\n\t\t}\r\n\t});\r\n\t\r\n\tvar editServiceView = Stapes.subclass({\r\n\t\t/**\r\n\t\t * \r\n\t\t * @param  {Object} cfg {triggerEl, serviceID, serviceName, model}\r\n\t\t *              @param {jQueryObj} triggerEl  \r\n\t\t *              @param {String} serviceID ID\r\n\t\t *              @param {String} serviceName \r\n\t\t *              @param {Object} model \r\n\t\t * @return {NULL}    \r\n\t\t */\r\n\t\tconstructor : function (cfg) {\r\n\t\t\tthis.$trigger = $XP(cfg, 'triggerEl');\r\n\t\t\tthis.serviceID = $XP(cfg, 'serviceID', null);\r\n\t\t\tthis.serviceName = $XP(cfg, 'serviceName', null);\r\n\t\t\tthis.model = $XP(cfg, 'model', null);\r\n\t\t\tthis.serviceList = Hualala.TypeDef.ShopBusiness;\r\n\t\t\tthis.modal = null;\r\n\t\t\tif (!this.serviceID || !this.serviceName || !this.model) {\r\n\t\t\t\tthrow(\"Service View init failed!\");\r\n\t\t\t}\r\n\t\t\tthis.loadTemplates();\r\n\t\t\tthis.serviceInfo = this.getServiceInfo('id', this.serviceID);\r\n\t\t\tthis.callServer = $XP(this.serviceInfo, 'callServer', '');\r\n\t\t\tif (IX.isFn(this.callServer)) {\r\n\t\t\t\tthis.callServer = this.callServer;\r\n\t\t\t} else if (!IX.isString(this.callServer)) {\r\n\t\t\t\tthrow(\"Configuration failed : Invalid Page Initialized for \" + name);\r\n\t\t\t\treturn false;\r\n\t\t\t} else if (IX.nsExisted(this.callServer)) {\r\n\t\t\t\tthis.callServer = IX.getNS(this.callServer);\r\n\t\t\t}\r\n\t\t\tthis.formParams = $XP(this.model.get('revParamJson'), this.serviceID);\r\n\t\t\tthis.initModal();\r\n\t\t\tthis.renderForm();\r\n\t\t\tthis.bindEvent();\r\n\t\t\tthis.emit('show');\r\n\t\t}\r\n\t});\r\n\teditServiceView.proto({\r\n\t\tloadTemplates : function () {\r\n\t\t\tvar layoutTpl = Handlebars.compile(Hualala.TplLib.get('tpl_shop_service_form_layout')),\r\n\t\t\t\tbtnTpl = Handlebars.compile(Hualala.TplLib.get('tpl_shop_modal_btns'));\r\n\t\t\tHandlebars.registerHelper('checkFormElementType', function (conditional, options) {\r\n\t\t\t\treturn (conditional == options.hash.type) ? options.fn(this) : options.inverse(this);\r\n\t\t\t});\r\n\t\t\tHandlebars.registerHelper('isInputGroup', function (prefix, surfix, options) {\r\n\t\t\t\treturn (!prefix && !surfix) ? options.inverse(this) : options.fn(this);\r\n\t\t\t});\r\n\t\t\tthis.set({\r\n\t\t\t\tlayoutTpl : layoutTpl,\r\n\t\t\t\tbtnTpl : btnTpl\r\n\t\t\t});\r\n\t\t},\t\r\n\t\tinitModal : function () {\r\n\t\t\tvar self = this;\r\n\t\t\tself.modal = new Hualala.UI.ModalDialog({\r\n\t\t\t\tid : 'service_edit',\r\n\t\t\t\tclz : 'service-modal',\r\n\t\t\t\ttitle : self.getModalTitle(),\r\n\t\t\t\tafterRemove : function () {\r\n\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t},\r\n\t\tinitSwitcher : function (selector) {\r\n\t\t\tvar self = this;\r\n\t\t\tself.modal._.body.find(selector).each(function () {\r\n\t\t\t\tvar $el = $(this),\r\n\t\t\t\t\tonLabel = $el.attr('data-onLabel'),\r\n\t\t\t\t\toffLabel = $el.attr('data-offLabel');\r\n\t\t\t\t$el.bootstrapSwitch({\r\n\t\t\t\t\tsize : 'normal',\r\n\t\t\t\t\tonColor : 'primary',\r\n\t\t\t\t\toffColor : 'default',\r\n\t\t\t\t\tonText : onLabel,\r\n\t\t\t\t\toffText : offLabel\r\n\t\t\t\t});\r\n\t\t\t});\r\n\t\t},\r\n\t\tinitTimePicker : function (selector) {\r\n\t\t\tvar self = this;\r\n\t\t\tself.modal._.body.find(selector).timepicker({\r\n\t\t\t\tminuteStep : 30,\r\n\t\t\t\tshowSeconds : false,\r\n\t\t\t\tshowMeridian :  false,\r\n\t\t\t\tdisableFocus : true,\r\n\t\t\t\tshowInputs : false\r\n\t\t\t});\r\n\t\t},\r\n\t\tgetServiceInfo : function (key, val) {\r\n\t\t\treturn _.find(this.serviceList, function (v) {return v[key] == val});\r\n\t\t},\r\n\t\tgetModalTitle : function () {\r\n\t\t\treturn $XP(this.serviceInfo, 'label') + '';\r\n\t\t},\r\n\t\tbindEvent : function () {\r\n\t\t\tvar self = this;\r\n\t\t\tvar fvOpts = self.initValidFieldOpts();\r\n\t\t\tthis.on({\r\n\t\t\t\tshow : function () {\r\n\t\t\t\t\tthis.modal.show();\r\n\t\t\t\t},\r\n\t\t\t\thide : function () {\r\n\t\t\t\t\tthis.modal.hide();\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\tself.modal._.dialog.find('.btn').on('click', function (e) {\r\n\t\t\t\tvar $btn = $(this),\r\n\t\t\t\t\tact = $btn.attr('name');\r\n\t\t\t\tif (act == 'cancel') {\r\n\t\t\t\t\tself.emit('hide');\r\n\t\t\t\t} else {\r\n\t\t\t\t\tvar bv = self.modal._.body.find('form').data('bootstrapValidator');\r\n\t\t\t\t\t$btn.button('...');\r\n\t\t\t\t\tbv.validate();\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\tself.modal._.body.find('form').bootstrapValidator({\r\n\t\t\t\ttrigger : 'blur',\r\n\t\t\t\tfields : fvOpts\r\n\t\t\t}).on('error.field.bv', function (e, data) {\r\n\t\t\t\tvar $form = $(e.target),\r\n\t\t\t\t\tbv = $form.data('bootstrapValidator');\r\n\t\t\t}).on('success.form.bv', function (e, data) {\r\n\t\t\t\te.preventDefault();\r\n\t\t\t\tvar $form = $(e.target),\r\n\t\t\t\t\tbv = $form.data('bootstrapValidator');\r\n\t\t\t\tvar formParams = self.serializeForm();\r\n\t\t\t\tconsole.info(formParams);\r\n\t\t\t\tself.model.emit('setServiceParams', {\r\n\t\t\t\t\tcallServer : self.callServer,\r\n\t\t\t\t\tparams : formParams,\r\n\t\t\t\t\tserviceID : self.serviceID,\r\n\t\t\t\t\tfailFn : function () {\r\n\t\t\t\t\t\tself.modal._.footer.find('.btn[name=submit]').button('reset');\r\n\t\t\t\t\t},\r\n\t\t\t\t\tsuccessFn : function () {\r\n\t\t\t\t\t\tself.modal._.footer.find('.btn[name=submit]').button('reset');\r\n\t\t\t\t\t\tself.emit('hide');\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t});;\r\n\t\t},\r\n\t\tdecodeTimeStr : function (t) {\r\n\t\t\tif (t.length == 0) return '';\r\n\t\t\treturn t.substr(0,2) + ':' + t.substr(2);\r\n\t\t},\r\n\t\tencodeTimeStr : function (min, max) {\r\n\t\t\treturn (min + ',' + max).replace(/\\:/g, '');\r\n\t\t},\r\n\t\t// \r\n\t\tmapServiceFormElsData : function () {\r\n\t\t\tvar self = this,\r\n\t\t\t\tformKeys = $XP(self.serviceInfo, 'formKeys', '').split(','),\r\n\t\t\t\tformEls = _.map(formKeys, function (key) {\r\n\t\t\t\t\tvar elCfg = ServiceFormElsHT.get(key),\r\n\t\t\t\t\t\ttype = $XP(elCfg, 'type');\r\n\t\t\t\t\tif (type == 'section' && key == 'servicePeriods') {\r\n\t\t\t\t\t\tvar v = $XP(self.formParams, key, '').split(',');\r\n\t\t\t\t\t\tv = _.map(v, function (t) {\r\n\t\t\t\t\t\t\treturn self.decodeTimeStr(t);\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t\treturn IX.inherit(elCfg, {\r\n\t\t\t\t\t\t\tmin : IX.inherit($XP(elCfg, 'min'), {\r\n\t\t\t\t\t\t\t\tvalue : v[0] || $XP(elCfg, 'min.defaultVal')\r\n\t\t\t\t\t\t\t}),\r\n\t\t\t\t\t\t\tmax : IX.inherit($XP(elCfg, 'max'), {\r\n\t\t\t\t\t\t\t\tvalue : v[1] || $XP(elCfg, 'max.defaultVal')\r\n\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t} else if (type == 'combo') {\r\n\t\t\t\t\t\tvar v = $XP(self.formParams, key, $XP(elCfg, 'defaultVal')),\r\n\t\t\t\t\t\t\toptions = _.map($XP(elCfg, 'options'), function (op) {\r\n\t\t\t\t\t\t\t\treturn IX.inherit(op, {\r\n\t\t\t\t\t\t\t\t\tselected : $XP(op, 'value') == v ? 'selected' : ''\r\n\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\treturn IX.inherit(elCfg, {\r\n\t\t\t\t\t\t\tvalue : $XP(self.formParams, key, $XP(elCfg, 'defaultVal')),\r\n\t\t\t\t\t\t\toptions : options\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t} else if (type == 'switcher') {\r\n\t\t\t\t\t\treturn IX.inherit(elCfg, {\r\n\t\t\t\t\t\t\tchecked : $XP(self.formParams, key) == $XP(elCfg, 'defaultVal') ? 'checked' : ''\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\treturn IX.inherit(elCfg, {\r\n\t\t\t\t\t\t\tvalue : $XP(self.formParams, key, $XP(elCfg, 'defaultVal'))\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\tconsole.info(formEls);\r\n\t\t\treturn formEls;\r\n\t\t},\r\n\t\t// \r\n\t\trenderForm : function () {\r\n\t\t\tvar self = this,\r\n\t\t\t\tfvOpts = self.initValidFieldOpts(),\r\n\t\t\t\trenderData = self.mapServiceFormElsData(),\r\n\t\t\t\ttpl = self.get('layoutTpl'),\r\n\t\t\t\tbtnTpl = self.get('btnTpl'),\r\n\t\t\t\thtm = tpl({\r\n\t\t\t\t\tformClz : 'shop-service-form',\r\n\t\t\t\t\titems : renderData\r\n\t\t\t\t});\r\n\t\t\tself.modal._.body.html(htm);\r\n\t\t\tself.modal._.footer.html(btnTpl({\r\n\t\t\t\tbtns : [\r\n\t\t\t\t\t{clz : 'btn-default', name : 'cancel', label : ''},\r\n\t\t\t\t\t{clz : 'btn-warning', name : 'submit', label : ''}\r\n\t\t\t\t]\r\n\t\t\t}));\r\n\r\n\t\t\tself.initSwitcher(':checkbox[data-type=switcher]');\r\n\t\t\tself.initTimePicker('[data-type=timepicker]');\r\n\r\n\t\t},\r\n\t\t// \r\n\t\tserializeForm : function () {\r\n\t\t\tvar self = this,\r\n\t\t\t\tformKeys = $XP(self.serviceInfo, 'formKeys', '').split(','),\r\n\t\t\t\tret = {},\r\n\t\t\t\tformEls = _.map(formKeys, function (key) {\r\n\t\t\t\t\tvar elCfg = ServiceFormElsHT.get(key),\r\n\t\t\t\t\t\ttype = $XP(elCfg, 'type');\r\n\t\t\t\t\tif (type == 'section' && key == 'servicePeriods') {\r\n\t\t\t\t\t\tvar min = $('[name=' + key + '_min]').val(),\r\n\t\t\t\t\t\t\tmax = $('[name=' + key + '_max]').val();\r\n\t\t\t\t\t\tret[key] = self.encodeTimeStr(min, max);\r\n\t\t\t\t\t} else if (type == 'switcher') {\r\n\t\t\t\t\t\tret[key] = $('[name=' + key + ']').attr('checked') ? 1 : 0;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tret[key] = $('[name=' + key + ']').val();\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\treturn ret;\r\n\t\t},\r\n\t\t// \r\n\t\tinitValidFieldOpts : function () {\r\n\t\t\tvar self = this,\r\n\t\t\t\tformKeys = $XP(self.serviceInfo, 'formKeys', '').split(','),\r\n\t\t\t\tret = {};\r\n\t\t\t_.each(formKeys, function (key) {\r\n\t\t\t\tvar elCfg = ServiceFormElsHT.get(key),\r\n\t\t\t\t\ttype = $XP(elCfg, 'type');\r\n\t\t\t\tif (type == 'section') {\r\n\t\t\t\t\tvar min = key + '_min', max = key + '_max';\r\n\t\t\t\t\tret[min] = $XP(elCfg, 'min.validCfg', {});\r\n\t\t\t\t\tret[max] = $XP(elCfg, 'max.validCfg', {});\r\n\t\t\t\t} else {\r\n\t\t\t\t\tret[key] = $XP(elCfg, 'validCfg', {});\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\treturn ret;\r\n\t\t}\r\n\t});\r\n\tHualala.Setting.editServiceView = editServiceView;\r\n})(jQuery, window);;(function ($, window) {\r\n\tIX.ns(\"Hualala.Setting\");\r\n\tvar initShopMgr = function (pageType, params) {\r\n\t\tvar $body = $('#ix_wrapper > .ix-body > .container');\r\n\t\tvar queryPanel = new Hualala.Shop.QueryController({\r\n\t\t\tneedShopCreate : false,\r\n\t\t\tcontainer : $body,\r\n\t\t\tresultController : new Hualala.Shop.ShopListController({\r\n\t\t\t\tcontainer : $body,\r\n\t\t\t\tmodel : new Hualala.Shop.CardListModel({callServer : Hualala.Global.queryShop}),\r\n\t\t\t\tview : new Hualala.Shop.ShopListView()\r\n\t\t\t})\r\n\t\t});\r\n\t};\r\n\tHualala.Setting.ShopMgrInit = initShopMgr;\r\n})(jQuery, window);;(function ($, window) {\r\n\tIX.ns(\"Hualala.Common\");\r\n\tvar pageBrickConfigs = [\r\n\t\t{name : 'account', title : '', label : '..', brickClz : 'home-brick-md-2', itemClz : 'brick-item brick-item-2', icon : 'icon-pay'},\r\n\t\t{name : 'order', title : '', label : '.', brickClz : 'home-brick-md-3', itemClz : 'brick-item', icon : 'icon-order'},\r\n\t\t{name : 'shop', title : '', label : '..', brickClz : 'home-brick-md-1', itemClz : 'brick-item', icon : 'icon-home'},\r\n\t\t{name : 'pcclient', title : '', label : '', brickClz : 'home-brick-md-1', itemClz : 'brick-item', icon : 'icon-download'},\r\n\t\t{name : 'user', title : '', label : '.', brickClz : 'home-brick-md-1', itemClz : 'brick-item', icon : 'icon-lock'},\r\n\t\t{name : 'setting', title : '', label : '.', brickClz : 'home-brick-md-2', itemClz : 'brick-item', icon : 'icon-setting'}\r\n\t];\r\n\tfunction isSupportedBrowser () {\r\n\t\tvar bd = Hualala.Common.Browser;\r\n\t\tvar isIE = !$XP(bd, 'ie', null) ? false : true,\r\n\t\t\tversion = parseInt($XP(bd, 'ie', 0));\r\n\t\tvar allowOldVersion = IX.Cookie.get('allowOldVersion') == 1 ? true : false;\r\n\t\tif (!isIE || allowOldVersion) return true;\r\n\t\tif (version > 8) return true;\r\n\t\tvar msg = version == 8 ? \r\n\t\t\t'IE<br/>' : \r\n\t\t\t'IE<br/>';\r\n\t\tvar browserLib = [\r\n\t\t\t{\r\n\t\t\t\thref : '',\r\n\t\t\t\ticon : '',\r\n\t\t\t\tname : 'IE10',\r\n\t\t\t\tdesc : 'IE10HTML5CSS3'\r\n\t\t\t},\r\n\t\t\t{\r\n\t\t\t\thref : '',\r\n\t\t\t\ticon : '',\r\n\t\t\t\tname : 'IE11',\r\n\t\t\t\tdesc : 'IE11HTML5CSS3'\r\n\t\t\t},\r\n\t\t\t{\r\n\t\t\t\thref : '',\r\n\t\t\t\ticon : '',\r\n\t\t\t\tname : 'Chrome',\r\n\t\t\t\tdesc : 'ChromeHTML5CSS3'\r\n\t\t\t},\r\n\t\t\t{\r\n\t\t\t\thref : '',\r\n\t\t\t\ticon : '',\r\n\t\t\t\tname : 'Firefox',\r\n\t\t\t\tdesc : 'FireFoxMozillaHTML5CSS3'\r\n\t\t\t}\r\n\t\t];\r\n\t\tvar tpl = Handlebars.compile(Hualala.TplLib.get('tpl_site_browserSupport'));\r\n\t\tvar $jumbotron = $(tpl({msg : msg, items : browserLib}));\r\n\t\t$('body > #ix_wrapper').remove();\r\n\t\t$jumbotron.appendTo($('body'));\r\n\t\t$jumbotron.find('.btn').click(function (e) {\r\n\t\t\tIX.Cookie.set('allowOldVersion', 1);\r\n\t\t\tHualala.Router.check();\r\n\t\t});\r\n\t\treturn false;\r\n\t}\r\n\tfunction initPageLayout (pageCfg, pageType) {\r\n\t\tvar session = Hualala.getSessionData(),\r\n\t\t\tlayoutTpl = Handlebars.compile(Hualala.TplLib.get('tpl_site_layout'));\r\n\t\tvar isLogin = !$XP(Hualala.getSessionUser(), 'loginName', null) ? false : true,\r\n\t\t\tloginName = $XP(session, 'user.loginName', ''),\r\n\t\t\tgroupName = $XP(session, 'site.groupName', '');\r\n\t\tvar mapRanderData = function () {\r\n\t\t\tvar header = {\r\n\t\t\t\tpcClientPath : Hualala.PageRoute.createPath('pcclient'),\r\n\t\t\t\thualalaUrl : Hualala.Global.HualalaWebSite,\r\n\t\t\t\tloginName : loginName,\r\n\t\t\t\tmerchantRoot : Hualala.PageRoute.createPath('main'),\r\n\t\t\t\tgroupName : groupName,\r\n\t\t\t\t// isLogin : !isLogin ? 'hidden' : '',\r\n\t\t\t\tisLogin : isLogin,\r\n\t\t\t\tlogoutPath : Hualala.Global.getLogoutJumpToUrl(),\r\n\t\t\t\tlogo : Hualala.Global.getDefaultImage('logo'),\r\n\t\t\t},\r\n\t\t\tfooter = {\r\n\t\t\t\taboutPath : Hualala.PageRoute.createPath(\"about\") || '#',\r\n\t\t\t\tcontactPath : Hualala.PageRoute.createPath(\"contact\") || '#',\r\n\t\t\t\tgozapLogo : Hualala.Global.getDefaultImage('gozap')\r\n\t\t\t};\r\n\t\t\treturn {\r\n\t\t\t\theader : header,\r\n\t\t\t\tfooter : footer\r\n\t\t\t};\r\n\t\t};\r\n\t\tvar $wrapper = $(layoutTpl(mapRanderData()));\r\n\t\t$('body > #ix_wrapper').remove();\r\n\t\tif (isSupportedBrowser()) {\r\n\t\t\t$wrapper.appendTo($('body'));\r\n\t\t}\r\n\t\tif ($.fn.bootstrapValidator) {\r\n\t\t\t$.fn.bootstrapValidator.DEFAULT_OPTIONS = $.extend({}, $.fn.bootstrapValidator.DEFAULT_OPTIONS, {\r\n\t\t\t\tmessage: '',\r\n                trigger: 'blur',\r\n\t\t\t\tfeedbackIcons : {\r\n\t\t\t\t\tvalid : 'glyphicon glyphicon-ok',\r\n\t\t\t\t\tinvalid : 'glyphicon glyphicon-remove',\r\n\t\t\t\t\tvalidating : 'glyphicon glyphicon-refresh'\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\t$.fn.bootstrapValidator.validators.accuracy = {\r\n\t\t\t\tvalidate : function (validator, $field, options) {\r\n\t\t\t\t\tvar accuracy = $XP(options, 'accuracy', null),\r\n\t\t\t\t\t\tmessage = $XP(options, 'message', '');\r\n\t\t\t\t\taccuracy = isNaN(accuracy) ? null : accuracy;\r\n\t\t\t\t\tvar value = $field.val();\r\n\t\t\t\t\tvar regxStr = (IX.isEmpty(accuracy) || accuracy == 0) ? \"^\\\\d+$\" : \"^\\\\d+(\\\\.\\\\d{1,\" + accuracy + \"})?$\",\r\n\t\t\t\t\t\tregX = null;\r\n\t\t\t\t\tregX = new RegExp(regxStr);\r\n\t\t\t\t\tif (isNaN(value)) {\r\n\t\t\t\t\t\treturn {\r\n\t\t\t\t\t\t\tvalid : false,\r\n\t\t\t\t\t\t\tmessage : \"\"\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (!regX.test(value)) {\r\n\t\t\t\t\t\treturn {\r\n\t\t\t\t\t\t\tvalid : false,\r\n\t\t\t\t\t\t\tmessage : message\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn true;\r\n\t\t\t\t}\r\n\t\t\t};\r\n\t\t}\r\n\t}\r\n\r\n\tfunction initSiteNavBar (pageType) {\r\n\t\tvar session = Hualala.getSessionData(),\r\n\t\t\tnavTpl = Handlebars.compile(Hualala.TplLib.get('tpl_site_navbar')),\r\n\t\t\tnavToggleTpl = Handlebars.compile(Hualala.TplLib.get('tpl_site_navbarToggle'));\r\n\t\tvar mapRanderData = function () {\r\n\t\t\tvar navs = _.map(Hualala.TypeDef.SiteNavType, function (v, i, list) {\r\n\t\t\t\treturn {\r\n\t\t\t\t\tactive : !Hualala.Global.isCurrentPage(v.name) ? '' : 'active',\r\n\t\t\t\t\tdisabled : '',\r\n\t\t\t\t\tpath : Hualala.PageRoute.createPath(v.name) || '#',\r\n\t\t\t\t\tname : v.name,\r\n\t\t\t\t\tlabel : v.label,\r\n\t\t\t\t};\r\n\t\t\t});\r\n\t\t\treturn {items : navs};\r\n\t\t};\r\n\t\tvar $navbar = $(navTpl(mapRanderData())),\r\n\t\t\t$navToggle = $(navToggleTpl({target : '#site_navbar'})),\r\n\t\t\t$header = $('#ix_wrapper .ix-header');\r\n\t\t$header.find('> .container .navbar-collapse').remove();\r\n\t\t$header.find('> .container').append($navbar);\r\n\t\t$header.find('> .container > .navbar-header .navbar-toggle').remove();\r\n\t\t$header.find('> .container > .navbar-header').prepend($navToggle);\r\n\r\n\t}\r\n\r\n\tfunction initHomePage (pageType, params) {\r\n\t\tvar site = Hualala.getSessionSite(),\r\n\t\t\tuser = Hualala.getSessionUser(),\r\n\t\t\troles = Hualala.getSessionRoles(),\r\n\t\t\tpcclient = Hualala.getSessionPCClient(),\r\n\t\t\trights = Hualala.getSessionUserRight();\r\n\t\tvar $body = $('#ix_wrapper > .ix-body > .container');\r\n\t\tvar mapRanderData = function () {\r\n\t\t\tvar ht = new IX.IListManager();\r\n\t\t\tvar ret = null;\r\n\t\t\tIX.iterate(rights, function (el) {\r\n\t\t\t\tht.register(el.name, el);\r\n\t\t\t});\r\n\t\t\tret = _.map(pageBrickConfigs, function (el, i, l) {\r\n\t\t\t\tvar name = $XP(el, 'name');\r\n\t\t\t\tvar hasRight = !ht.get(name) ? false : true;\r\n\t\t\t\treturn IX.inherit(el, {\r\n\t\t\t\t\titemClz : ($XP(el, 'itemClz', '') + ' ' + (!hasRight ? 'disabled' : ''))\r\n\t\t\t\t});\r\n\t\t\t});\r\n\t\t\treturn ret;\r\n\t\t};\r\n\t\t// Home Page \r\n\t\tvar tpl = Handlebars.compile(Hualala.TplLib.get('tpl_site_homepage'));\r\n\t\tvar $bricks = $(tpl({bricks : mapRanderData()}));\r\n\t\t$body.html($bricks);\r\n\t\t$bricks.on('mouseenter mouseleave click', '.brick-item', function (e) {\r\n\t\t\tvar $this = $(this), pageName = $this.attr('data-pagename'),\r\n\t\t\t\teType = e.type;\r\n\t\t\tif ($this.hasClass('disabled')) return false;\r\n\t\t\tif (eType == 'click') {\r\n\t\t\t\t// console.info($this.attr('data-pagename'));\r\n\t\t\t\tdocument.location.href = Hualala.PageRoute.createPath(pageName);\r\n\t\t\t} else {\r\n\t\t\t\t$this.toggleClass('hover');\r\n\t\t\t}\r\n\t\t\t\r\n\t\t});\r\n\t}\r\n\r\n\tfunction initLoginPage (pageType, params) {\r\n\t\tvar tpl = Handlebars.compile(Hualala.TplLib.get('tpl_site_login'));\r\n\t\tvar $loginBox = $(tpl({\r\n\t\t\tbannerImg : Hualala.Global.getDefaultImage('loginBanner')\r\n\t\t}));\r\n\t\tvar $body = $('#ix_wrapper > .ix-body > .container');\r\n\t\t$body.html($loginBox);\r\n\t\tHualala.Entry.initLogin($loginBox);\r\n\t}\r\n\r\n\r\n\tHualala.Common.LoginInit = initLoginPage;\r\n\tHualala.Common.initPageLayout = initPageLayout;\r\n\tHualala.Common.initSiteNavBar = initSiteNavBar;\r\n\tHualala.Common.HomePageInit = initHomePage;\r\n\r\n\tHualala.Common.IndexInit = function () {\r\n\t\tdocument.location.href = Hualala.PageRoute.createPath(\"main\");\r\n\t}\r\n\t\r\n})(jQuery, window);;(function ($, window) {\r\n\tIX.ns(\"Hualala\");\r\n\tvar sessionData = null;\r\n\t// SessionData\r\n\tHualala.getSessionData = function () {return sessionData;};\r\n\tHualala.getSessionSite = function () {return $XP(sessionData, 'site', null); };\r\n\tHualala.getSessionUser = function () {return $XP(sessionData, 'user', null); };\r\n\tHualala.getSessionRoles = function () {return $XP(sessionData, 'roles', []); };\r\n\tHualala.getSessionPCClient = function () {return $XP(sessionData, 'pcClient', null); };\r\n\tHualala.getSessionUserRight = function () {return $XP(sessionData, 'userRight', [])};\r\n\t// \r\n\tHualala.isSessionUser = function (groupLoginName, loginName) {\r\n\t\tvar _name = $XP(sessionData, 'user.groupLoginName') + $XP(sessionData, 'user.loginName');\r\n\t\treturn sessionData && _name == (groupLoginName + loginName);\r\n\t};\r\n\r\n\tfunction loadSession(appData, cbFn) {\r\n\t\tif (!$XP(appData, 'user', null)) {\r\n\t\t\tthrow(\"Permission Deny!!\");\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tsessionData = appData;\r\n\t\tcbFn();\r\n\t}\r\n\r\n\tfunction initMainPage(cbFn) {\r\n\t\tvar tick = IX.getTimeInMS();\r\n\t\tlog(\"Merchant Sys INIT : \" + tick);\r\n\t\tHualala.Global.loadAppData({}, function (appData) {\r\n\t\t\tlog(\"Load Merchant APP Data in (ms): \" + (IX.getTimeInMS() - tick));\r\n\t\t\tif ($XP(appData, 'resultcode') != 0) {\r\n\t\t\t\tdocument.location.href = Hualala.PageRoute.createPath('login');\r\n\t\t\t\tthrow(\"Session Data Load Faild!! resultcode = \" + $XP(appData, 'resultcode', '') + \"; resultMsg = \" + $XP(appData, 'resultmsg', ''));\r\n\t\t\t\treturn;\t\r\n\t\t\t}\r\n\t\t\tloadSession($XP(appData, 'data', {}), function () {\r\n\t\t\t\tlog(\"Merchant Sys INIT DONE in (ms): \" + (IX.getTimeInMS() - tick));\r\n\t\t\t\tcbFn();\r\n\t\t\t});\r\n\t\t}, function () {\r\n\t\t\tdocument.location.href = Hualala.PageRoute.createPath('login');\r\n\t\t\treturn ;\r\n\t\t});\r\n\t}\r\n\r\n\tfunction initRouteEngine () {\r\n\t\tif (!IX.nsExisted(\"Hualala.ajaxEngine.init\")) return;\r\n\t\t$.ajaxSetup({\r\n\t\t\tbeforeSend : function (xhr) {\r\n\t\t\t\txhr.setRequestHeader('X-CSRF-Token', $('meta[name=\"csrf-token\"]').attr('content'));\r\n\t\t\t}\r\n\t\t});\r\n\t\tHualala.ajaxEngine.init({\r\n\t\t\tajaxFn : jQuery.ajax,\r\n\t\t\tbaseUrl : Hualala.Global.HOME,\r\n\t\t\tcommonUrl : Hualala.Global.CommonSite,\r\n\t\t\timgUrl : Hualala.Global.IMAGE_ROOT\r\n\t\t});\r\n\t\t// Hualala.urlEngine would be initialized as ajaxEngine was initialized! ignore urlEngine's initializing.\r\n\t};\r\n\r\n\t\r\n\t/**\r\n\t * \r\n\t * @param  {Object} cfg {config:{}, type : \"login|main|shop|setting|account|user...\"}\r\n\t * @return {NULL}     \r\n\t */\r\n\tvar APPInitialized = false, currentType;\r\n\t\r\n\tHualala.init = function () {\r\n\t\tif (!APPInitialized) {\r\n\t\t\tinitRouteEngine();\r\n\t\t\t\r\n\t\t\t// initMainPage(function () {\r\n\t\t\t// \tHualala.PageRoute.start(function (pageName) {\r\n\t\t\t// \t\tvar hasNoNavPages = 'main,pcclient,about,contact';\r\n\t\t\t// \t\tHualala.Common.initPageLayout({}, pageName);\r\n\t\t\t// \t\tif (hasNoNavPages.indexOf(pageName) < 0) {\r\n\t\t\t// \t\t\tHualala.Common.initSiteNavBar(pageName);\r\n\t\t\t// \t\t}\r\n\t\t\t// \t});\r\n\t\t\t// });\r\n\t\t\tHualala.PageRoute.start(function (pageName) {\r\n\t\t\t\tvar hasNoNavPages = 'main,pcclient,about,contact,login';\r\n\t\t\t\tvar commonPages = _.filter(hasNoNavPages.split(','), function (v) {return v != 'main'}).join(',');\r\n\t\t\t\tif (commonPages.indexOf(pageName) >= 0) {\r\n\t\t\t\t\tHualala.Common.initPageLayout({}, pageName);\r\n\t\t\t\t\tif (hasNoNavPages.indexOf(pageName) < 0) {\r\n\t\t\t\t\t\tHualala.Common.initSiteNavBar(pageName);\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn ;\r\n\t\t\t\t}\r\n\t\t\t\tinitMainPage(function () {\r\n\t\t\t\t\tHualala.Common.initPageLayout({}, pageName);\r\n\t\t\t\t\tif (hasNoNavPages.indexOf(pageName) < 0) {\r\n\t\t\t\t\t\tHualala.Common.initSiteNavBar(pageName);\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t});\r\n\t\t\tAPPInitialized = true;\r\n\t\t}\r\n\t};\r\n\r\n})(jQuery, window);;(function ($, window) {\r\n\tIX.ns(\"Hualala.PageRoute\");\r\n\tvar Router = Hualala.Router,\r\n\t\troutes = Hualala.Global.Route;\r\n\tvar isInitialized = false,\r\n\t\tPageConfigurations = {},\r\n\t\tPath2NameMapping = {};\r\n\r\n\tfunction mappingRoute (_path, _name, _reg) {\r\n\t\tvar match = _path.match(_reg);\r\n\t\tif (!match) return;\r\n\t\tvar s = match.shift(),\r\n\t\t\tarr = s.split('/');\r\n\t\tarr = _.map(arr, function (v, i, l) {\r\n\t\t\tvar bingo = _.indexOf(s, v);\r\n\t\t\tif (bingo > -1) {\r\n\t\t\t\treturn '_';\r\n\t\t\t}\r\n\t\t\treturn v;\r\n\t\t});\r\n\t\tarr.push(\"\"); arr.unshift(\"\");\r\n\t\tvar _pattern = arr.join(\"_\");\r\n\t\tPath2NameMapping[_pattern] = _name;\r\n\t}\r\n\r\n\tvar detectPageInitializor = (function () {\r\n\t\tvar ht = new IX.I1ToNManager();\r\n\t\tvar fnames = [];\r\n\t\tfunction _checkItem(fname) {\r\n\t\t\tif (!IX.isFn(IX.getNS(fname)))\r\n\t\t\t\treturn false;\r\n\t\t\tvar _list = ht.get(fname),\r\n\t\t\t\t_fn = IX.getNS(fname);\r\n\t\t\tfor (var j = 0; j < _list.length; j++)\r\n\t\t\t\tPageConfigurations[_list[j]].init = _fn;\r\n\t\t\tht.remove(fname);\r\n\t\t\treturn true;\r\n\t\t}\r\n\r\n\t\tfunction _checking() {\r\n\t\t\tfnames = IX.loop(fnames, [], function (acc, fname) {\r\n\t\t\t\tif (!_checkItem(fname))\r\n\t\t\t\t\tacc.push(fname);\r\n\t\t\t\treturn acc;\r\n\t\t\t});\r\n\t\t\treturn fnames.length == 0;\r\n\t\t}\r\n\r\n\t\tfunction _check () {\r\n\t\t\tfnames = IX.Array.toSet(fnames);\r\n\t\t\tIX.checkReady(_checking, IX.emptyFn, 40, {\r\n\t\t\t\tmaxAge : 15000,\r\n\t\t\t\texpire : function () {\r\n\t\t\t\t\talert(\"Can't find page inializor : \\n\" + fnames.join(\"\\n\"));\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\t\t\r\n\t\tfunction _detect(name, fname) {\r\n\t\t\tvar _fn = null;\r\n\t\t\tif (IX.isFn(fname)) {\r\n\t\t\t\t_fn = fname;\r\n\t\t\t} else if (!IX.isString(fname)) {\r\n\t\t\t\tthrow(\"Configuration failed : Invalid Page Initialized for \" + name);\r\n\t\t\t\treturn false;\r\n\t\t\t} else if (IX.nsExisted(fname)) {\r\n\t\t\t\t_fn = IX.getNS(fname);\r\n\t\t\t}\r\n\t\t\tif (IX.isFn(_fn)) {\r\n\t\t\t\treturn PageConfigurations[name].init = _fn;\r\n\t\t\t}\r\n\t\t\tht.put(fname, name);\r\n\t\t\tfnames.push(fname);\r\n\t\t}\r\n\t\treturn {\r\n\t\t\tstart : function () {setTimeout(_check, 1);},\r\n\t\t\tdetect : _detect\r\n\t\t}\r\n\t})();\r\n\r\n\t/**\r\n\t * \r\n\t * @param  {String} name   \r\n\t * @param  {Array|NULL} params \r\n\t * @return {String}        \r\n\t */\r\n\tfunction getPathByName (name, params) {\r\n\t\tvar cfg = PageConfigurations[name];\r\n\t\tif (!cfg) \r\n\t\t\treturn console.err(\"Can't find route : \" + name);\r\n\t\tvar path = $XP(cfg, 'path'), reg = $XP(cfg, 'reg'),\r\n\t\t\tmatch = path.match(reg);\r\n\t\tvar genPath = function (p) {\r\n\t\t\treturn Hualala.Global.HOME + p;\r\n\t\t};\r\n\t\tif (!match || match.length < 1) {\r\n\t\t\treturn console.err(\"The Path of Route (\" + name + \") is wrong!!\");\r\n\t\t} else if (match.length == 1) {\r\n\t\t\treturn genPath(path);\r\n\t\t} else if (match.length > 1 && IX.isArray(params) && (match.length - 1) == params.length) {\r\n\t\t\tmatch.shift();\r\n\t\t\t_.each(match, function (v, i, m) {\r\n\t\t\t\tpath = path.replace(v, params[i]);\r\n\t\t\t});\r\n\t\t\treturn genPath(path);\r\n\t\t}\r\n\t}\r\n\t/**\r\n\t * pageConfig : {\r\n\t * \t\tname : \"\",\r\n\t * \t\tpath : \"\",\r\n\t * \t\treg : RegExp,\r\n\t * \t\tbodyClz : \"\", default \"\"\r\n\t * \t\tPageInitiator : \"Hualala.User.init\" or function (cfg) {}\r\n\t * }\r\n\t * @param  {[type]} cbFn [description]\r\n\t * @return {[type]}      [description]\r\n\t */\r\n\tvar pageConfigs = [\r\n\t\t// home page \r\n\t\t// \r\n\t\t{\r\n\t\t\tname : \"login\", path : \"/#login\", reg : /login$/, bodyClz : \"\",\r\n\t\t\tPageInitiator : \"Hualala.Common.LoginInit\"\r\n\t\t},\r\n\t\t// home page\r\n\t\t{\r\n\t\t\tname : \"main\", path : \"/#home\", reg : /home$/, bodyClz : \"\",\r\n\t\t\tPageInitiator : \"Hualala.Common.HomePageInit\"\r\n\t\t},\r\n\r\n\t\t// \t\t\r\n\t\t{\r\n\t\t\tname : \"shop\", path : \"/#shop\", reg : /shop$/, bodyClz : \"\",\r\n\t\t\tPageInitiator : \"Hualala.Shop.HomePageInit\"\r\n\t\t},\r\n\t\t// \r\n\t\t{\r\n\t\t\tname : \"shopCreate\", path : \"/#shop/create\", reg : /shop\\/create$/, bodyClz : \"\",\r\n\t\t\tPageInitiator : \"Hualala.Shop.CreateShopInit\"\r\n\t\t},\r\n\t\t// \r\n\t\t{\r\n\t\t\tname : \"shopInfo\", path : \"/#shop/{id}/info\", reg : /shop\\/(.*)\\/info$/, bodyClz : \"\",\r\n\t\t\tPageInitiator : \"Hualala.Shop.BaseInfoMgrInit\"\r\n\t\t},\r\n\t\t// \r\n\t\t{\r\n\t\t\tname : \"shopMenu\", path : \"/#shop/{id}/menu\", reg : /shop\\/(.*)\\/menu$/, bodyClz : \"\",\r\n\t\t\tPageInitiator : \"Hualala.Shop.FoodMenuMgrInit\"\r\n\t\t},\r\n\r\n\t\t// \r\n\t\t{\r\n\t\t\tname : \"setting\", path : \"/#setting\", reg : /setting$/, bodyClz : \"\",\r\n\t\t\tPageInitiator : \"Hualala.Setting.ShopMgrInit\"\r\n\t\t},\r\n\r\n\t\t// \r\n\t\t{\r\n\t\t\tname : \"account\", path : \"/#account\", reg : /account$/, bodyClz : \"\",\r\n\t\t\tPageInitiator : \"Hualala.Account.AccountListInit\"\r\n\t\t},\r\n\t\t// \r\n\t\t{\r\n\t\t\tname : \"accountDetail\", path : \"/#account/{id}/detail\", reg : /account\\/(.*)\\/detail$/, bodyClz : \"\",\r\n\t\t\tPageInitiator : \"Hualala.Account.AccountMgrInit\"\r\n\t\t},\r\n\r\n\t\t// \r\n\t\t{\r\n\t\t\tname : \"user\", path : \"/#user\", reg : /user$/, bodyClz : \"\",\r\n\t\t\tPageInitiator : \"Hualala.User.UserListInit\"\r\n\t\t},\r\n\r\n\t\t// \r\n\t\t{\r\n\t\t\tname : \"order\", path : \"/#order\", reg : /order$/, bodyClz : \"\",\r\n\t\t\tPageInitiator : \"Hualala.Order.OrderChartInit\"\r\n\t\t},\r\n\r\n\t\t// PC\r\n\t\t{\r\n\t\t\tname : \"pcclient\", path : \"/#download\", reg : /download$/, bodyClz : \"\",\r\n\t\t\tPageInitiator : \"Hualala.Common.PCClientDownloadInit\"\r\n\t\t},\r\n\r\n\t\t// \r\n\t\t{\r\n\t\t\tname : \"about\", path : \"/#about\", reg : /about$/, bodyClz : \"\",\r\n\t\t\tPageInitiator : \"Hualala.Common.AboutInit\"\r\n\t\t},\r\n\r\n\t\t// \r\n\t\t{\r\n\t\t\tname : \"contact\", path : \"/#contact\", reg : /contact$/, bodyClz : \"\",\r\n\t\t\tPageInitiator : \"Hualala.Common.ContactInit\"\r\n\t\t},\r\n\t\t// pathhome\r\n\t\t{\r\n\t\t\tname : \"index\", path : \"\", reg : /(.*)$/, bodyClz : \"\",\r\n\t\t\tPageInitiator : \"Hualala.Common.IndexInit\"\r\n\t\t}\r\n\t];\r\n\tIX.iterate(pageConfigs, function (cfg) {\r\n\t\tvar _cfg = IX.inherit({\r\n\t\t\tbodyClz : \"ix-minor\",\r\n\t\t\tpath : \"\"\r\n\t\t}, cfg);\r\n\t\tvar _name = $XP(cfg, 'name'), _path = $XP(cfg, 'path'), _reg = $XP(cfg, 'reg');\r\n\t\tmappingRoute(_path, _name, _reg);\r\n\t\tPageConfigurations[_name] = {\r\n\t\t\tname : _name, bodyClz : $XP(_cfg, 'bodyClz', ''), path : _path, reg : $XP(_cfg, 'reg', null)\r\n\t\t};\r\n\t\tvar _pageInit = \"PageInitiator\" in _cfg ? _cfg.PageInitiator : null;\r\n\t\tif (!IX.isString(_pageInit) && !IX.isFn(_pageInit))\r\n\t\t\t_pageInit = IX.emptyFn;\r\n\t\tdetectPageInitializor.detect(_name, _pageInit);\r\n\t});\r\n\tdetectPageInitializor.start();\r\n\r\n\r\n\tHualala.PageRoute.start = function (cbFn) {\r\n\t\tisInitialized = true;\r\n\t\tRouter.flush().config({mode : 'history', root : Hualala.Global.HOME});\r\n\t\t// Router.flush().config({mode : 'history'});\r\n\t\t// IE Browser can not support this method ??\r\n\t\t_.each(PageConfigurations, function (route, name, l) {\r\n\t\t\tvar re = $XP(route, 'reg'), initFn = $XF(route, 'init'), handler = null;\r\n\t\t\t\r\n\t\t\thandler = function (params) {\r\n\t\t\t\tconsole.info(\"INFO: Init Page :\" + name);\r\n\t\t\t\tIX.isFn(cbFn) && cbFn(name);\r\n\t\t\t\tconsole.info(\"Load Page :\" + name);\r\n\t\t\t\tconsole.info(\"arguments is :\" + params);\r\n\t\t\t\tinitFn && initFn.apply(null, [name, params]);\r\n\t\t\t};\r\n\t\t\t\r\n\t\t\tRouter.add(re, handler);\r\n\t\t});\r\n\t\tRouter.listen().check();\r\n\t};\r\n\r\n\tHualala.PageRoute.createPath = getPathByName;\r\n\r\n\tHualala.PageRoute.getCurrentPath = function () {\r\n\t\treturn location.hash;\r\n\t};\r\n\r\n\tHualala.PageRoute.getPageContextByPath = function (path) {\r\n\t\tvar fragment = path || Hualala.Router.getFragment();\r\n\t\tvar match = _.filter(PageConfigurations, function (el, k, l) {\r\n\t\t\treturn !!fragment.match(el.reg);\r\n\t\t});\r\n\t\tvar params = null;\r\n\t\tif (match.length == 0) return null;\r\n\t\tif (match.length == 1) {\r\n\t\t\tparams = fragment.match(match[0]['reg']);\r\n\t\t\tparams.shift();\r\n\t\t\treturn IX.inherit({params : params}, match[0]);\r\n\t\t}\r\n\t\tmatch = _.filter(match, function (el, k, l) {\r\n\t\t\treturn el.name != 'index';\r\n\t\t});\r\n\t\tparams = fragment.match(match[match.length - 1]['reg']);\r\n\t\tparams.shift();\r\n\t\treturn IX.inherit({params : params}, match[match.length - 1]);\r\n\t};\r\n\r\n})(jQuery, window);"]}