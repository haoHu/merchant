{"version":3,"file":"pages.min.js","sources":["pages.js"],"names":["$","IX","ns","formFields","name","type","palceholder","clz","key","field","validators","notEmpty","message","callback","val","min","max","length","valid","AuthCode","cfg","container","$XP","$img","find","$progress","callServer","Hualala","Global","genAuthCode","toggleProgress","isShow","getAuthCode","cbFn","res","code","UI","TopTip","msg","setAuthCode","attr","setTimeout","bindEvent","delegate","e","target","init","genCode","Entry","initLogin","$container","console","err","loginCallServer","fvOpts","$subBtn","parent","$authCode","initValidFieldOpts","ret","_","each","f","getFormData","params","initLoginForm","bootstrapValidator","trigger","fields","on","$form","data","preventDefault","info","resultcode","document","location","href","PageRoute","createPath","bv","validate","jQuery","window","toptip","PopoverMsgTip","QueryModel","Stapes","subclass","constructor","this","origCities","origAreas","origShops","isReady","getShopQuerySchema","proto","self","initDataModel","cityHT","IListManager","areaHT","shopHT","c","cid","shopLst","filter","s","areaLst","a","pluck","register","inherit","aid","sid","set","ds_city","ds_area","ds_shop","hasReady","getCities","ids","isEmpty","isString","ds","get","getShops","getShopsByAreaID","areaID","getAll","getShopsByCityID","cityID","getAreas","destroy","Shop","QueryView","needShopCreate","$queryBox","$filter","$query","loadTemplates","model","renderLayout","emit","getFilterParams","queryTpl","Handlebars","compile","TplLib","filterTpl","registerPartial","mapChosenShopData","cities","city","cityName","shops","push","items","map","shop","mapRenderLayoutData","filterCities","mapFilterData","focus","queryChosenShops","shopCity","toggle","optGrp","renderData","html","prepend","count","btn_all","focusClz","o","parseInt","unshift","renderAreaFilter","remove","append","$btn","removeClass","addClass","focusedBtn","keywordLst","getQueryParams","QueryController","sessionData","getSessionData","resultController","view","reload","distory","query","pageNo","pageSize","load","CardListModel","pageCount","totalSize","ds_page","updatePagerParams","pagerParamkeys","v","k","indexOf","getPagerParams","updateDataStore","pageHT","shopIDs","shopID","mShop","BaseShopModel","resetDataStore","clear","getByKeys","getShopModelByShopID","updateShopStatus","status","failFn","updateShopBusinessStatus","id","switchShopStatusCallServer","switchShopStatus","switchShopBusinessStatusCallServer","switchShopServiceFeatureStatus","switchShopBusinessStatus","$XF","setServiceFeature","sName","serviceFeatures","split","el","join","serviceFeature","operation","switchBusinessStatus","setServiceParams","serviceID","successFn","strType","newData","CardListView","$resultBox","$list","$pager","initLayout","layoutTpl","htm","initPager","baseCfg","total","page","maxVisible","leaps","IXPager","tooltip","selector","path","listTpl","itemTpl","tagTpl","mapTags","d","tagKeys","tags","t","mapRenderData","getTags","tag","address","byteLen","Common","strByteLength","slugAddr","substrByte","img","getSourceImage","width","height","quality","tel","infoHref","menuHref","checked","shopCard","list","initSwitcher","bootstrapSwitch","size","onColor","offColor","onText","offText","state","$chkbox","_shopID","render","pagerParams","empty","ShopListView","businessName","businessID","initBusinessModal","getShopBusiness","business","TypeDef","ShopBusiness","businessHT","businessCfg","item","switcherStatus","mapBusinessRenderData","icon","switcherName","open","label","desc","chkHasAccountRole","loginUsr","getSessionUser","usrRoles","roles","getSessionRoles","role","roleType","matchedID","shopName","hideAccount","settleName","shopOpen","shopItem","Setting","editServiceView","triggerEl","serviceName","ShopListController","ShopListModel","reloadPager","initCuisines","$cuisine1","$cuisine2","G","getCuisines","rsp","resultmsg","topTip","fillSelectBox","records","initAreas","$selectBox","initCities","isActive","value","initialValue","optionsHtml","i","getSelectText","$select","text","replace","U","initCreate","$wizard","bootstrapWizard","bsWizard","$step1","$step2","$step3","$city","$area","timepicker","minuteStep","showMeridian","disableFocus","showInputs","stringLength","telOrMobile","PCCL","numeric","operationMode","openingHoursStart","time","openingHoursEnd","startTimeField","cuisineID1","$uploadImg","imagePath","IMAGE_ROOT","uploadImg","onSuccess","imgPath","$dlg","src","IMAGE_RESOURCE_DOMAIN","modal","dataStep1","$searchBox","$shopSettingLink","$curStep","activePane","is","isValid","parseForm","areaName","cuisineName1","cuisineName2","cuisineID2","openingHours","keywords","updateShopBaseInfo","createShop","next","isSearchMap","searchBox","lng","mapPoint","lat","mapInfo","mapLongitudeValue","mapLatitudeValue","mapLongitudeValueBaiDu","mapLatitudeValueBaiDu","setShopMap","updateReadMode","not","$this","$p","siblings","shopInfo","S","initMap","initInfo","pageType","$shopFuncNav","createShopFuncNav","imgHost","getShopInfo","createShopInfoHead","$shopInfoHead","before","openTime","operationModeName","tpl","appendTo","$target","isValidField","coords","formData","shopData","initMenu","renderFoods","foods","filterFoods","$foodCount","$foods","foodTpl","lazyload","result","foodClass","classifiedFoods","foodCategoryID","apply","p","searchParams","grep","food","classifyFoods","foodsData","l","foodCategoryName","foodID","imgePath","hwp","imageHWP","w","Math","round","h","imgSrc","imgRoot","discountIco","isDiscount","takeawayIco","takeawayTag","activeIco","foodIsActive","takeoutPackagingFee","parseFloat","prePrice","price","vipPrice","cfs","unit","idx","inAarry","units","arr","obj","$menu","$foodClass","$foodSearch","$takeawayTag","$foodName","$chekbox","getShopMenu","log","$foodClassBox","category","prop","$checked","trim","foodName","isHasImage","ShopMap","options","extend","defaults","sContent","$mapResult","mapResult","searchArea","keyword","area","mapCanvasId","serach","prototype","mapParams","BMap","Map","addControl","NavigationControl","enableScrollWheelZoom","$keyword","$searchBtn","searchMap","loadMap","centerAndZoom","Point","marker","Marker","enableMassClear","raiseOnDrag","enableDragging","addOverlay","openInfoWindow","InfoWindow","addEventListener","setResult","point","local","LocalSearch","renderOptions","pageCapacity","onInfoHtmlSet","poi","onMarkersSet","search","setSearchCompleteCallback","getStatus","BMAP_STATUS_SUCCESS","setMarkersSetCallback","pois","pos","getPosition","fn","tplData","shopUrl","getShopUrl","shopListLink","resetPwdTpl","$resetPwdForm","ModalDialog","title","sizeCls","hideCloseBtn","show","$feedback","$feedbackIcon","$errMsg","$pwd","toggleClass","change","footer","setShopClientPwd","hLLAgentLoginPWD","hide","isPlainObject","currentPageName","shopFuncs","R","$ul","shopFunc","getPageLabelByName","initShopList","$body","queryShop","HomePageInit","initShopBaseInfoMgr","BreadCrumb","hideRoot","nodes","getParentNamesByPath","BaseInfoMgrInit","initFoodMenuMgr","FoodMenuMgrInit","initCreateShop","$shopCreateWizard","pcClientPath","CreateShopInit","ServiceFormElsCfg","advanceTime","defaultVal","prefix","surfix","MinuteIntervalOptions","validCfg","noticeTime","minAmount","greaterThan","inclusive","serviceAmount","freeServiceAmount","holidayFlag","HolidayFlagOptions","openDays","digits","servicePeriods","group","reserveTableTime","reserveTableDesc","takeawayDeliveryAgent","takeawayDeliveryTime","takeawayScope","takeawayScopeDesc","submitSMSTemplateID","checkSMSTemplateID","payMethod","PayMethodOptions","needInputTableName","onLabel","offLabel","supportInvoice","supportCommitToSoftware","payMethodAtShop","PayMethodAtShopOptions","payBeforeCommit","fetchFoodMode","FetchFoodModeOptions","ServiceFormElsHT","labelClz","minID","maxID","minName","maxName","$trigger","serviceList","serviceInfo","getServiceInfo","isFn","nsExisted","getNS","formParams","initModal","renderForm","btnTpl","registerHelper","conditional","hash","inverse","getModalTitle","afterRemove","body","$el","initTimePicker","showSeconds","servData","formKeys","dialog","act","button","serializeForm","decodeTimeStr","substr","encodeTimeStr","mapServiceFormElsData","formEls","elCfg","op","selected","formClz","btns","initShopMgr","ShopMgrInit","AccountListModel","transCreateBeginTime","transCreateEndTime","settleUnitID","transStatus","transType","groupID","minTransAmount","maxTransAmount","ds_account","accountHT","accountIDs","account","mAccount","BaseAccountModel","getAccounts","getAccountModelByID","accountID","Account","queryAccount","getSessionSite","withdrawCash","transAmount","settleBalance","newSettleBalance","sub","delete","deleteAccount","edit","editAccount","add","addAccount","AccountTransListModel","queryAccountTransDetail","ds_trans","transHT","transIDs","trans","transID","mTrans","BaseTransactionModel","getDataByPageNo","getModelByID","AccountQueryShopModel","AccountQueryShopResultModel","origData","dataStore","initDataStore","start","end","_shop","ceil","AccountListView","bindCardEvent","settleAccountID","parents","WithdrawCashView","parentView","AccountEditView","mode","updateSettleBalance","hasDefault","bankInfo","mapBankInfo","bankAccountStr","codeMask","settleUnitName","bankIcon","bankComName","shopCount","accountCard","accounts","refresh","mapFormElsData","accountInfoKeys","accountInfo","lessThan","accuracy","QueryTransFormElsCfg","transCreateTime","FSMTransStatus","FSMTransType","QueryTransFormElsHT","TransResultCols","AccountTransListView","$queryForm","tableTpl","tblClz","tblHeaders","cols","colClz","thead","rows","initQueryEls","bindQueryEvent","datetimepicker","format","startDate","autoclose","minView","todayBtn","todayHighlight","language","$picker","prev","orderKey","orderID","AccountTransDetailModal","getQueryFormParams","serializeArray","Date","getDateByFormat","mapTimeData","r","s1","mapTransStatus","m","mapTransType","types","mapCashData","prettyNumeric","mapTransChanged","transSalesCommission","transPoundage","transChanged","mapColsRenderData","row","colKeys","col","hideBtnTransType","btnClz","SUATransItemID","results","AccountQueryShopView","AccountQueryShopResultView","shopTable","AccountListController","AccountQueryShopController","resultContainer","AccountQueryShopResultController","AccountMgrController","transaDetailCtrl","TransactionDetailController","AccountActs","AccountMgrView","$nav","breadCrumbs","$schema","$detail","initBreadCrumbs","parentNames","clickFn","isLastNode","shift","schemaTpl","withDrawTpl","withdraw","queryShops","AccountQueryShopModal","Confirm","okLabel","okFn","acts","acts1","clone","isDetail","isFirst","AccountEditFormElsCfg","receiverType","AccountReceiverTypes","receiverName","bankAccount","bankCode","BankOptions","bankName","remark","defaultAccount","receiverLinkman","receiverMobile","receiverEmail","AccountEditFormElsHT","ops","queryCtrl","initQueryBox","PersonUnit","Constants","CashUnit","getOrderSubTypeLabel","orderSubType","getGenderLabel","GENDER","mapUserFields","fieldType","userSex","_fields","fieldLabelCfg","OrderPayFieldLabelLib","mapOrderFields","orderSubTypeLabel","formatDateTimeValue","isAlreadyPaid","orderStatus","mapPayFields","mapFoodsFields","dishes","categories","groupBy","dish","cate","foodCategorySum","_dishes","_dish","userName","userLoginMobile","orderCheckPWD","person","timeName","tableName","shopOrderKey","orderTime","orderCreateTime","statusName","takeoutAddress","consumptionTypeName","promotionDesc","orderRemark","foodAmount","paidAmount","promotionTotalAmount","discountAmount","freeAmount","giftAmount","presentInfo","cardDiscountAmount","pointBalance","moneyBalance","takeoutPackagingAmount","orderTotal","orderRefundAmount","shopTel","foodPrice","OrderPayDetailElsCfg","userFields","mapFn","orderFields","payFields","foodsFields","transTypes","transTypeHT","initTransTypeLib","tplName","callServerName","queryKeys","mapQueryParams","toString","mapOrderPayDetail","fieldsets","fieldCfg","pick","printDetail","content","mapFsmCustomerDetail","settleUnitDetail","customerCard","transTypeLabel","acc","cashKeys","prettyPrice","last","_k","initAccountListPage","accountListPanel","initAccountMgrPage","ctx","getPageContextByPath","accountModel","mgrView","AccountMgrInit","AccountListInit","OrderQueryResultModel","pagerKeys","queryParamsKeys","hasPager","recordModel","BaseOrderRecordModel","initQueryParams","ds_record","concat","recordHT","recordIDs","mRecord","__id__","getRecordsByPageNo","getRecordModelByID","getCityByCityID","Order","order","OrderQueryTableHeaderCfg","OrderQueryDuringTableHeaderCfg","OrderQueryDishHotTableHeaderCfg","OrderQueryUserTableHeaderCfg","mapColItemRenderData","rowIdx","colKey","pageName","getGender","getOrderStatus","div","link","n","mapQueryOrderResultRenderData","mapQueryOrderDuringRenderData","mapQueryDishesHotRenderData","mapQueryUserRenderData","renderQueryOrderResult","$result","OrderQueryResultView","loadTemplate","resultTpl","arguments","renderRecords","renderFn","OrderListController","queryVals","object","vals","QueryFormElsCfg","OrderStatus","userMobile","QueryFormElsHT","mapOrderQueryFormRenderData","mapOrderQueryBaseFormRenderData","mapDishesHotQueryFormRenderData","mapUsersQueryFormRenderData","comboOptsTpl","initQueryFormEls","els","initCityComboOpts","initShopComboOpts","curCityID","optTpl","opts","curShopID","initOrderPageLayout","mapNavRenderData","navs","OrderSubNavType","active","disabled","navTpl","$navbar","initOrderChartPage","initQueryOrderPage","$pageBody","findWhere","queryOrderDetail","mapResultRenderData","renderResult","mapRenderDataFn","initQueryOrderDayDetailPage","queryOrderDayDetail","initQueryOrderDuringDetailPage","queryOrderDuringDetail","initQueryOrderDishesHotPage","queryOrderDishesHot","initQueryOrderCustomerPage","queryUserOrderStatistic","OrderPageLayoutInit","OrderChartInit","QueryOrderInit","QueryOrderByDayDetailInit","QueryOrderByDuringDetailInit","QueryOrderDishesHotInit","QueryOrderCustomerInit","isSupportedBrowser","bd","Browser","isIE","version","allowOldVersion","Cookie","browserLib","$jumbotron","click","Router","check","initPageLayout","session","isLogin","loginName","groupName","mapRanderData","header","hualalaUrl","HualalaWebSite","merchantRoot","logoutPath","getLogoutJumpToUrl","logo","getDefaultImage","aboutPath","contactPath","gozapLogo","$wrapper","DEFAULT_OPTIONS","feedbackIcons","invalid","validating","validator","$field","isNaN","regxStr","regX","RegExp","test","initSiteNavBar","navToggleTpl","SiteNavType","isCurrentPage","$navToggle","$header","initHomePage","rights","getSessionPCClient","getSessionUserRight","ht","iterate","pageBrickConfigs","hasRight","itemClz","$bricks","bricks","eType","hasClass","initLoginPage","$loginBox","bannerImg","brickClz","LoginInit","IndexInit","loadSession","appData","initMainPage","tick","getTimeInMS","loadAppData","initRouteEngine","ajaxSetup","beforeSend","xhr","setRequestHeader","ajaxEngine","ajaxFn","ajax","baseUrl","HOME","commonUrl","CommonSite","imgUrl","isSessionUser","groupLoginName","_name","APPInitialized","pageParams","pageInitFn","hasNoNavPages","commonPages","mappingRoute","_path","_reg","match","bingo","_pattern","Path2NameMapping","getPathByName","PageConfigurations","reg","genPath","isArray","isInitialized","Route","detectPageInitializor","_checkItem","fname","_list","_fn","j","_checking","fnames","loop","_check","Array","toSet","checkReady","emptyFn","maxAge","expire","alert","_detect","put","I1ToNManager","detect","pageConfigs","bodyClz","PageInitiator","parentName","_cfg","_pageInit","flush","config","root","route","re","initFn","handler","listen","getCurrentPath","fragment","getFragment","curContext","curName"],"mappings":";;CAWA,SAAWA,GACVC,GAAGC,GAAG,gBACN,IAAIC,KAEFC,KAAO,aAAcC,KAAO,OAAQC,YAAc,WAAYC,IAAM,wBACpEC,IAAM,YACNC,OACCC,YACCC,UACCC,QAAU,iBAMbR,KAAO,gBAAiBC,KAAO,OAAQC,YAAc,WAAYC,IAAM,wBACvEC,IAAM,YACNC,OACCC,iBAQDN,KAAO,YAAaC,KAAO,WAAYC,YAAc,UAAWC,IAAM,wBACtEC,IAAM,WACNC,OACCC,YACCC,UACCC,QAAU,UAEXC,UACCA,SAAW,SAAUC,GACpB,GAAIC,GAAM,EAAGC,EAAM,EACnB,OAAIF,GAAIG,OAAS,GAAKH,EAAIG,OAAS,IAEjCC,OAAQ,EACRN,QAAU,UAAYG,EAAM,KAAOC,EAAM,QAI1CE,OAAQ,SAQbd,KAAO,aAAcC,KAAO,OAAQC,YAAc,SAAUC,IAAM,wBAClEC,IAAM,WACNC,OACCC,YACCC,UACCC,QAAU,eAoBXO,EAAW,SAAUC,GACxB,GAAIC,GAAYrB,EAAEsB,IAAIF,EAAK,cAC1BG,EAAOF,EAAUG,KAAK,aACtBC,EAAYJ,EAAUG,KAAK,aACxBE,EAAaC,QAAQC,OAAOC,YAC5BC,EAAiB,SAAUC,GAC9BN,EAAUM,EAAS,cAAgB,YAAY,UAC/CR,EAAKQ,EAAS,WAAa,eAAe,WAEvCC,EAAc,SAAUC,GAC3BH,GAAe,GACfJ,KAAe,SAAUQ,GACxB,GAAIC,GAAO,IACmB,QAA1Bb,IAAIY,EAAK,cACZC,EAAOb,IAAIY,EAAK,YAAa,OAE7BP,QAAQS,GAAGC,QACVhC,KAAO,UACPiC,IAAM,YAGPR,KAEDG,EAAKE,MAGHI,EAAc,SAAUJ,GAC3B,MAAKA,IAMLZ,EAAKiB,KAAK,MAAOL,OAEjBM,YAAW,WACVX,KACE,UATFW,YAAW,WACVT,EAAYO,IACV,MASDG,EAAY,WACfrB,EAAUsB,SAAS,YAAa,QAAS,SAAUC,GAClDrB,EAAOvB,EAAE4C,EAAEC,QACXb,EAAYO,MAGVO,EAAO,WACVd,EAAYO,GACZG,IAGD,OADAI,MAECC,QAAU,WACTf,EAAYO,KAKfZ,SAAQqB,MAAMC,UAAY,SAAUC,GACnC,IAAKA,GAAmC,GAArBA,EAAWjC,OAE7B,WADAkC,SAAQC,IAAI,0BAGb,IAAI1B,GAAaC,QAAQC,OAAOyB,gBAC5BC,KACHC,EAAUL,EAAW1B,KAAK,cAC1BC,EAAY8B,EAAQC,SAAShC,KAAK,aAClCiC,EAAYP,EAAW1B,KAAK,gBAIzBM,GAHQ,GAAIX,IACdE,UAAYoC,IAEO,SAAU1B,GAC9BN,EAAUM,EAAS,cAAgB,YAAY,UAC/CwB,EAAQxB,EAAS,WAAa,eAAe,YAE1C2B,EAAqB,WACxB,GAAIC,KAKJ,OAJAC,GAAEC,KAAK1D,EAAY,SAAU2D,GAC5B,GAAItD,GAAMc,IAAIwC,EAAG,QAASrD,EAAQa,IAAIwC,EAAG,QACzCH,GAAInD,GAAOC,IAELkD,GAEJI,EAAc,WACjB,GAAIC,KAMJ,OALAJ,GAAEC,KAAK1D,EAAY,SAAU2D,GAC5B,GAAI1D,GAAOkB,IAAIwC,EAAG,QAAStD,EAAMc,IAAIwC,EAAG,OACvChD,EAAMd,EAAE,SAAWI,EAAO,IAAK8C,GAAYpC,KAC5CkD,GAAOxD,GAAOM,IAERkD,GAEJC,EAAgB,WACnBX,EAASI,IACTR,EAAWgB,oBACVC,QAAU,OACVC,OAASd,IACPe,GAAG,iBAAkB,SAAUzB,GACjC,CAAA,GAAI0B,GAAQtE,EAAE4C,EAAEC,OACVyB,GAAMC,KAAK,sBACjBzC,MACEuC,GAAG,kBAAmB,SAAUzB,GAClCA,EAAE4B,gBACF,IAAIF,GAAQtE,EAAE4C,EAAEC,QAEfmB,GADKM,EAAMC,KAAK,sBACPR,IAEVZ,SAAQsB,KAAK,mBACbtB,QAAQsB,KAAKT,GAEbtC,EAAWsC,EAAQ,SAAU9B,GACN,GAAlBA,EAAIwC,WACPC,SAASC,SAASC,KAAOlD,QAAQmD,UAAUC,WAAW,QAEtDpD,QAAQS,GAAGC,QACVhC,KAAO,SACPiC,IAAMhB,IAAIY,EAAK,eAGjBJ,QAGFoB,EAAWP,SAAS,aAAc,QAAS,WAC1Cb,GAAe,EACf,IAAIkD,GAAK9B,EAAWqB,KAAK,qBACzBS,GAAGC,aAILhB,OAECiB,OAAQC,QAAS,WACnBlF,GAAGC,GAAG,eACN,IACIkF,IADazD,QAAQS,GAAGiD,cACf1D,QAAQS,GAAGC,QACpBiD,EAAaC,OAAOC,UACvBC,YAAc,WAEbC,KAAKC,cACLD,KAAKE,aACLF,KAAKG,aAELH,KAAKI,SAAU,EACfJ,KAAKhE,WAAaC,QAAQC,OAAOmE,qBAGnCT,GAAWU,OAEVlD,KAAO,SAAUkB,EAAQ/B,GACxB,GAAIgE,GAAOP,IACXO,GAAKH,SAAU,EACfG,EAAKvE,WAAWsC,EAAQ,SAAU9B,GACX,OAAlBA,EAAIwC,YAEPuB,EAAKN,WAAarE,IAAIY,EAAK,kBAC3B+D,EAAKL,UAAYtE,IAAIY,EAAK,iBAC1B+D,EAAKJ,UAAYvE,IAAIY,EAAK,iBAC1B+D,EAAKC,gBACLD,EAAKH,SAAU,IAEfV,GACC9C,IAAMhB,IAAIY,EAAK,YAAa,IAC5B7B,KAAO,WAER4F,EAAKH,SAAU,GAEhB7D,EAAKgE,MAKPC,cAAgB,WACf,GAAID,GAAOP,KACPS,EAAS,GAAIlG,IAAGmG,aACnBC,EAAS,GAAIpG,IAAGmG,aAChBE,EAAS,GAAIrG,IAAGmG,YACjBxC,GAAEC,KAAK6B,KAAKC,WAAY,SAAUY,GACjC,GAAIC,GAAMlF,IAAIiF,EAAG,UAChBE,EAAU7C,EAAE8C,OAAOT,EAAKJ,UAAW,SAAUc,GAC5C,MAAOrF,KAAIqF,EAAG,WAAaH,IAE5BI,EAAUhD,EAAE8C,OAAOT,EAAKL,UAAW,SAAUiB,GAC5C,MAAOvF,KAAIuF,EAAG,WAAaL,GAE7BC,GAAU7C,EAAEkD,MAAML,EAAS,UAC3BG,EAAUhD,EAAEkD,MAAMF,EAAS,UAC3BT,EAAOY,SAASP,EAAKvG,GAAG+G,QAAQT,GAC/BE,QAAUA,EACVG,QAAUA,OAGZhD,EAAEC,KAAK6B,KAAKE,UAAW,SAAUiB,GAChC,GAAII,GAAM3F,IAAIuF,EAAG,UAChBJ,EAAU7C,EAAE8C,OAAOT,EAAKJ,UAAW,SAAUc,GAC5C,MAAOrF,KAAIqF,EAAG,WAAaM,GAE7BR,GAAU7C,EAAEkD,MAAML,EAAS,UAC3BJ,EAAOU,SAASE,EAAKhH,GAAG+G,QAAQH,GAC/BJ,QAAUA,OAGZ7C,EAAEC,KAAK6B,KAAKG,UAAW,SAAUc,GAChC,GAAIO,GAAM5F,IAAIqF,EAAG,SACjBL,GAAOS,SAASG,EAAKP,KAEtBV,EAAKkB,KACJC,QAAUjB,EACVkB,QAAUhB,EACViB,QAAUhB,KAIZiB,SAAW,WAAa,MAAO7B,MAAKI,SAMpC0B,UAAY,SAAUC,GACrBA,EAAMxH,GAAGyH,QAAQD,GAAO,KAAQxH,GAAG0H,SAASF,IAAQA,GAAOA,CAC3D,IAAIG,GAAKlC,KAAKmC,IAAI,WACdlE,EAAM,IAEV,OADAA,GAAMiE,EAAIH,EAAiB,YAAX,UAAwBA,IAQzCK,SAAW,SAAUL,GACpBA,EAAMxH,GAAGyH,QAAQD,GAAO,KAAQxH,GAAG0H,SAASF,IAAQA,GAAOA,CAC3D,IAAIG,GAAKlC,KAAKmC,IAAI,WACdlE,EAAM,IAEV,OADAA,GAAMiE,EAAIH,EAAiB,YAAX,UAAwBA,IAQzCM,iBAAmB,SAAUC,GAC5B,IAAKA,EAAQ,MAAO,KACpB,IAAIJ,GAAKlC,KAAKmC,IAAI,WACdlE,EAAMC,EAAE8C,OAAOkB,EAAGK,SAAU,SAAUtB,GACzC,GAAIM,GAAM3F,IAAIqF,EAAG,SACjB,OAAOqB,IAAUf,GAElB,OAAqB,IAAdtD,EAAI1C,OAAc,KAAO0C,GAOjCuE,iBAAmB,SAAUC,GAC5B,IAAKA,EAAQ,MAAO,KACpB,IAAIP,GAAKlC,KAAKmC,IAAI,WACdlE,EAAMC,EAAE8C,OAAOkB,EAAGK,SAAU,SAAUtB,GACzC,GAAIH,GAAMlF,IAAIqF,EAAG,SACjB,OAAOwB,IAAU3B,GAElB,OAAqB,IAAd7C,EAAI1C,OAAc,KAAO0C,GAOjCyE,SAAW,SAAUX,GACpBA,EAAMxH,GAAGyH,QAAQD,GAAO,KAAQxH,GAAG0H,SAASF,IAAQA,GAAOA,CAC3D,IAAIG,GAAKlC,KAAKmC,IAAI,WACdlE,EAAM,IAEV,OADAA,GAAMiE,EAAIH,EAAiB,YAAX,UAAwBA,IAGzCY,QAAU,WACT3C,KAAKC,cACLD,KAAKE,aACLF,KAAKG,aACLH,KAAKI,SAAU,KAGjBnE,QAAQ2G,KAAKhD,WAAaA,GACxBJ,OAAQC,QAAS,SAAWnF,GAC9BC,GAAGC,GAAG,eACN,IAEIqI,IAFa5G,QAAQS,GAAGiD,cACf1D,QAAQS,GAAGC,OACRkD,OAAOC,UACtBC,YAAc,WAEbC,KAAKI,SAAU,EAEfJ,KAAK8C,gBAAiB,EAEtB9C,KAAKxC,WAAa,KAClBwC,KAAK+C,UAAY,KAEjB/C,KAAKgD,QAAU,KAEfhD,KAAKiD,OAAS,KACdjD,KAAKkD,mBAGPL,GAAUvC,OAETlD,KAAO,SAAU1B,GAIhB,GAHAsE,KAAKmD,MAAQvH,IAAIF,EAAK,QAAS,MAC/BsE,KAAK8C,eAAiBlH,IAAIF,EAAK,kBAAkB,GACjDsE,KAAKxC,WAAa5B,IAAIF,EAAK,YAAa,OACnCsE,KAAKmD,QAAUnD,KAAKxC,YAAwC,GAA1BwC,KAAKxC,WAAWjC,OACtD,KAAK,0BAGNyE,MAAKoD,eACLpD,KAAKhD,YACLgD,KAAKI,SAAU,EACfJ,KAAKqD,KAAK,SAAUrD,KAAKsD,oBAI1BzB,SAAW,WAAa,MAAO7B,MAAKI,SAEpC8C,cAAgB,WACf,GAAIK,GAAWC,WAAWC,QAAQxH,QAAQyH,OAAOvB,IAAI,mBACpDwB,EAAYH,WAAWC,QAAQxH,QAAQyH,OAAOvB,IAAI,mBAEnDqB,YAAWI,gBAAgB,WAAY3H,QAAQyH,OAAOvB,IAAI,oBAC1DqB,WAAWI,gBAAgB,SAAU3H,QAAQyH,OAAOvB,IAAI,0BAExDnC,KAAKyB,KACJ8B,SAAWA,EACXI,UAAYA,KAIdE,kBAAoB,WACnB,GAAItD,GAAOP,KACP8D,EAAS9D,KAAKmD,MAAMrB,YACpB7D,IAgBJ,OAfAC,GAAEC,KAAK2F,EAAQ,SAAUC,GACxB,GAAIC,GAAWpI,IAAImI,EAAM,WAAY,IAEpChD,GADSnF,IAAImI,EAAM,SAAU,IACnBnI,IAAImI,EAAM,YACjBE,EAAQ1D,EAAK4C,MAAMf,SAASrB,EAChC9C,GAAIiG,MACHxJ,KAAOsJ,EACPG,MAAQjG,EAAEkG,IAAIH,EAAO,SAAUI,GAC9B,OACC5H,KAAOb,IAAIyI,EAAM,UACjB3J,KAAOkB,IAAIyI,EAAM,mBAKdpG,GAGRqG,oBAAsB,WACrB,GAAIR,GAAS9D,KAAKmD,MAAMrB,YAEpByC,GADKvE,KAAKmD,MAAMf,WACDpC,KAAKwE,eACtB7J,KAAO,OACPD,KAAO,MACP+J,MAAQ,EACR5F,KAAOiF,KAERY,EAAmB1E,KAAK6D,mBACzB,QACChJ,IAAM,GACN8J,SAAWJ,EACXK,QAAUzH,OAAS,eACnB2F,eAAiB9C,KAAK8C,eACtB+B,OAASH,IAIXtB,aAAe,WACd,GAAI7C,GAAOP,KACVuD,EAAWhD,EAAK4B,IAAI,YAEjB2C,GADKvE,EAAK4C,MACG5C,EAAK+D,uBAClBS,EAAOxB,EAASuB,EACpB9E,MAAK+C,UAAYzI,EAAEyK,GACnB/E,KAAKxC,WAAWwH,QAAQhF,KAAK+C,WAC7B/C,KAAKgD,QAAUhD,KAAK+C,UAAUjH,KAAK,WACnCkE,KAAKiD,OAASjD,KAAK+C,UAAUjH,KAAK,WAInC0I,cAAgB,SAAU9I,GACzB,GAAImD,GAAOjD,IAAIF,EAAK,WACnBf,EAAOiB,IAAIF,EAAK,QAChBhB,EAAOkB,IAAIF,EAAK,QAChB+I,EAAQ7I,IAAIF,EAAK,QAAS,GAC1BuC,GACCtD,KAAOA,EACPD,KAAOA,EACPyJ,UAEDc,EAAQ,EACLC,GACHC,SAAW,GACXxK,KAAOA,EACP8B,KAAO,GACP/B,KAAO,KACPuK,MAAQ,EAoBT,OAlBAhH,GAAIkG,MAAQjG,EAAEkG,IAAIvF,EAAM,SAAUuG,GACjC,GAAItK,GAAMH,EAAO,QACbkG,EAAIwE,SAASzJ,IAAIwJ,EAAGtK,EAAK,GAE7B,OADAmK,IAASpE,GAERsE,SAAW,GACXxK,KAAOA,EACP8B,KAAOb,IAAIwJ,EAAIzK,EAAO,KAAO,IAC7BD,KAAOkB,IAAIwJ,EAAIzK,EAAO,OAAS,IAC/BsK,MAAQpE,KAGVqE,EAAU3K,GAAG+G,QAAQ4D,GACpBD,MAAQA,EACRE,SAAW,KAEZlH,EAAIkG,MAAMmB,QAAQJ,GAClBjH,EAAIkG,MAAMM,GAAiB,SAAI,WACxBxG,GAGRsH,iBAAmB,SAAU1G,GAC5B,GAAI0B,GAAOP,KACV2D,EAAYpD,EAAK4B,IAAI,aAElB2C,GADKvE,EAAK4C,MACG5C,EAAKiE,eACrB7J,KAAO,OACPD,KAAO,MACP+J,MAAQ,EACR5F,KAAOA,KAEJkG,EAAOpB,EAAUmB,EACrB9E,MAAKgD,QAAQlH,KAAK,SAAS0J,SAC3BxF,KAAKgD,QAAQyC,OAAOV,IAGrB/H,UAAY,WACX,GAAIuD,GAAOP,IACXA,MAAKgD,QAAQrE,GAAG,QAAS,uBAAwB,WAChD,GAAI+G,GAAOpL,EAAE0F,MACTyC,EAASiD,EAAK5I,KAAK,aACnB+B,EAAO,IACG,KAAV4D,GACH5D,EAAO0B,EAAK4C,MAAMrB,UAAUW,GAC5B5D,EAAOjD,IAAIiD,EAAK,GAAI,UAAW,MAC/BA,EAAO0B,EAAK4C,MAAMT,SAAS7D,GAC3B0B,EAAKgF,iBAAiB1G,IAEtB0B,EAAKyC,QAAQlH,KAAK,SAAS0J,SAE5BjF,EAAKyC,QAAQlH,KAAK,wBAAwB6J,YAAY,YACtDD,EAAKE,SAAS,YACdrF,EAAK8C,KAAK,SAAU9C,EAAK+C,qBAE1BtD,KAAKgD,QAAQrE,GAAG,QAAS,uBAAwB,WAChD,CAAA,GAAI+G,GAAOpL,EAAE0F,KACA0F,GAAK5I,KAAK,aACvByD,EAAKyC,QAAQlH,KAAK,wBAAwB6J,YAAY,YACtDD,EAAKE,SAAS,YACdrF,EAAK8C,KAAK,SAAU9C,EAAK+C,qBAE1BtD,KAAKiD,OAAOtE,GAAG,QAAS,eAAgB,WAC5BrE,EAAE0F,KACbf,UAASC,SAASC,KAAOlD,QAAQmD,UAAUC,WAAW,iBAGxDsD,QAAU,WACT3C,KAAKI,SAAU,EACfJ,KAAK8C,gBAAiB,EACtB9C,KAAKxC,WAAW1B,KAAK,eAAe0J,SACpCxF,KAAK+C,UAAY,KACjB/C,KAAKgD,QAAU,KACfhD,KAAKiD,OAAS,MAGfK,gBAAkB,WAEjB,GAAI/C,GAAOP,KACP6F,EAAatF,EAAKyC,QAAQlH,KAAK,sBAC/B2G,EAASoD,EAAW7E,OAAO,eAAelE,KAAK,aAClDwF,EAASuD,EAAW7E,OAAO,eAAelE,KAAK,YAGhD,OAFA2F,GAAWA,GAAoB,IAAVA,EAAqBA,EAAL,GACrCH,EAAWA,GAAoB,IAAVA,EAAqBA,EAAL,IAEpCG,OAASA,EACTH,OAASA,EACTwD,WAAa,KAIfC,eAAiB,WAEhB,YAIF9J,QAAQ2G,KAAKC,UAAYA,GACvBrD,OAAQC,QAAS,WACnBlF,GAAGC,GAAG,eACN,IAEIoF,IAFa3D,QAAQS,GAAGiD,cACf1D,QAAQS,GAAGC,OACPV,QAAQ2G,KAAKhD,YAC1BiD,EAAY5G,QAAQ2G,KAAKC,UACzBmD,EAAkBnG,OAAOC,UAS5BC,YAAc,SAAUrE,GACvBsE,KAAKyB,KACJwE,YAAchK,QAAQiK,mBAEvBlG,KAAKrE,UAAYC,IAAIF,EAAK,YAAa,MACvCsE,KAAK8C,eAAiBlH,IAAIF,EAAK,kBAAkB,GACjDsE,KAAKmG,iBAAmBvK,IAAIF,EAAK,mBAAoB,MACrDsE,KAAKmD,MAAQ,GAAIvD,GACjBI,KAAKoG,KAAO,GAAIvD,GAChB7C,KAAK5C,SAGP4I,GAAgB1F,OAEflD,KAAO,WACN,GAAImD,GAAOP,IACXO,GAAKvD,YACLuD,EAAK4C,MAAME,KAAK,OAAQ,WACvB,IAAK9C,EAAK4C,MAAMtB,WACf,KAAK,0BAINtB,GAAK6F,KAAK/C,KAAK,WAIjBrG,UAAY,WAEXgD,KAAKrB,IACJ0H,OAAS,WACR,GAAI9F,GAAOP,IACXO,GAAK4C,MAAMmD,UACX/F,EAAK6F,KAAKE,UACV/F,EAAKnD,QAENmJ,MAAQ,SAAUjI,GACjB,GAAIiC,GAAOP,IACXvC,SAAQsB,KAAK,iBACbtB,QAAQsB,KAAKT,GACbiC,EAAK4F,kBAAoB5F,EAAK4F,iBAAiB9C,KAAK,OAAQ9I,GAAG+G,QAAQhD,GACtEkI,OAAS,EACTC,SAAW,QAGXzG,MAEHA,KAAKmD,MAAMxE,IACV+H,KAAO,SAAUnK,GAChB,GAAIgE,GAAOP,KACV1B,EAAS1C,IAAI2E,EAAK4B,IAAI,eAAgB,UACvC5B,GAAK4C,MAAM/F,KAAKkB,EAAQ/B,KAEvByD,MAEHA,KAAKoG,KAAKzH,IACTvB,KAAO,WACN,GAAImD,GAAOP,IACXO,GAAK6F,KAAKhJ,MACT+F,MAAQ5C,EAAK4C,MACbL,eAAiBvC,EAAKuC,eACtBnH,UAAY4E,EAAK5E,aAInBqF,OAAS,SAAU1C,GAClB,GAAIiC,GAAOP,IACXO,GAAK8C,KAAK,QAAS/E,IAIpBiI,MAAQ,SAAUjI,GACjB,GAAIiC,GAAOP,IACXO,GAAK8C,KAAK,QAAS/E,KAElB0B,SAGL/D,QAAQ2G,KAAKoD,gBAAkBA,GAC7BxG,OAAQC,QAAS,WACnBlF,GAAGC,GAAG,eACN,IACIkF,IADazD,QAAQS,GAAGiD,cACf1D,QAAQS,GAAGC,QACpBgK,EAAgB9G,OAAOC,UAO1BC,YAAc,SAAUrE,GAEvB,GADAsE,KAAKhE,WAAaJ,IAAIF,EAAK,aAAc,OACpCsE,KAAKhE,WACT,KAAK,yBAKR2K,GAAcrG,OACblD,KAAO,SAAUkB,GAChB0B,KAAKyB,KACJmF,UAAY,EACZC,UAAY,EACZL,OAAS5K,IAAI0C,EAAQ,SAAU,GAC/BmI,SAAW7K,IAAI0C,EAAQ,WAAY,IACnCmE,OAAS7G,IAAI0C,EAAQ,SAAU,IAC/BgE,OAAS1G,IAAI0C,EAAQ,SAAU,IAC/BwH,WAAalK,IAAI0C,EAAQ,aAAc,IACvCsD,QAAU,GAAIrH,IAAGmG,aACjBoG,QAAU,GAAIvM,IAAGmG,gBAGnBqG,kBAAoB,SAAUzI,GAC7B,GAAIiC,GAAOP,KACPgH,EAAiB,8DAkBrB9I,GAAEC,KAAKG,EAAQ,SAAU2I,EAAGC,GACvBF,EAAeG,QAAQD,GAAK,IAC/B3G,EAAKkB,IAAIyF,EAAGD,MAIfG,eAAiB,WAUhB,OACCZ,OAASxG,KAAKmC,IAAI,UAClBsE,SAAWzG,KAAKmC,IAAI,YACpBM,OAASzC,KAAKmC,IAAI,UAClBG,OAAStC,KAAKmC,IAAI,UAClB2D,WAAa9F,KAAKmC,IAAI,gBAGxBkF,gBAAkB,SAAUxI,EAAM2H,GACjC,GAAIjG,GAAOP,KACVY,EAASL,EAAK4B,IAAI,WAClBmF,EAAS/G,EAAK4B,IAAI,WACfoF,EAAUrJ,EAAEkG,IAAIvF,EAAM,SAAUwF,GAInC,GAAImD,GAAS5L,IAAIyI,EAAM,UACtBoD,EAAQ,GAAIC,GAAcrD,EAE3B,OADAzD,GAAOS,SAASmG,EAAQC,GACjBD,GAERF,GAAOjG,SAASmF,EAAQe,IAEzBI,eAAiB,WAChB,GAAIpH,GAAOP,KACVY,EAASL,EAAK4B,IAAI,WAClBmF,EAAS/G,EAAK4B,IAAI,UACnBvB,GAAOgH,QACPN,EAAOM,SAERlB,KAAO,SAAUpI,EAAQ/B,GACxB,GAAIgE,GAAOP,IACXO,GAAKwG,kBAAkBzI,GACvBiC,EAAKvE,WAAWuE,EAAK6G,iBAAkB,SAAU5K,GAC1B,OAAlBA,EAAIwC,YACPuB,EAAK8G,gBAAgBzL,IAAIY,EAAK,mBAAqBZ,IAAIY,EAAK,qBAC5D+D,EAAKwG,kBAAkBnL,IAAIY,EAAK,kBAEhCkD,GACC9C,IAAMhB,IAAIY,EAAK,YAAa,IAC5B7B,KAAO,WAGT4B,EAAKgE,MAGP6B,SAAW,SAAUoE,GACpB,GAAIjG,GAAOP,KACVY,EAASL,EAAK4B,IAAI,WAClBmF,EAAS/G,EAAK4B,IAAI,WACflE,EAAMC,EAAEkG,IAAIxD,EAAOiH,UAAUP,EAAOnF,IAAIqE,IAAU,SAAUiB,GAC/D,MAAOA,GAAMlF,UAId,OAFA9E,SAAQsB,KAAK,aACbtB,QAAQsB,KAAKd,GACNA,GAER6J,qBAAuB,SAAUN,GAChC,GAAIjH,GAAOP,KACVY,EAASL,EAAK4B,IAAI,UACnB,OAAOvB,GAAOuB,IAAIqF,IAGnBO,iBAAmB,SAAUP,EAAQQ,EAAQC,GAC5C,GAAI1H,GAAOP,KACVY,EAASL,EAAK4B,IAAI,WACfkC,EAAOzD,EAAOuB,IAAIqF,EAMtBnD,GAAKhB,KAAK,oBACT2E,OAASA,EACTC,OAASA,KAIXC,yBAA2B,SAAU5J,EAAQ2J,GAC5C,GAAI1H,GAAOP,KACVY,EAASL,EAAK4B,IAAI,WAClBqF,EAAS5L,IAAI0C,EAAQ,UACrB+F,EAAOzD,EAAOuB,IAAIqF,EACnBnD,GAAKhB,KAAK,wBACT3I,KAAOkB,IAAI0C,EAAQ,QACnB6J,GAAKvM,IAAI0C,EAAQ,MACjB0J,OAASpM,IAAI0C,EAAQ,SACrB2J,OAASA,OAOZhM,QAAQ2G,KAAK+D,cAAgBA,CAE7B,IAAIe,GAAgB7H,OAAOC,UAC1BC,YAAc,SAAUsE,GACvBrE,KAAKoI,2BAA6BnM,QAAQC,OAAOmM,iBACjDrI,KAAKsI,mCAAqCrM,QAAQC,OAAOqM,+BACzDvI,KAAKyB,IAAI4C,GACTrE,KAAKhD,cAGP0K,GAAcpH,OACb+H,iBAAmB,SAAUL,EAAQC,GACpC,GAAI1H,GAAOP,KACVwH,EAASjH,EAAK4B,IAAI,SACnB5B,GAAKkB,IAAI,SAAUuG,GACnBvK,QAAQsB,KAAK,gBAAkBwB,EAAK4B,IAAI,UAAY,YAAc6F,GAClEhI,KAAKoI,4BACJZ,OAASA,EACTQ,OAASA,GACP,SAAUxL,GACW,QAAnBA,EAAIwC,YAEPU,GACC9C,IAAMhB,IAAIY,EAAK,YAAa,IAC5B7B,KAAO,WAER4F,EAAKkB,IAAI,SAAWuG,EAAa,EAAJ,GAC7BC,EAAOT,IAGP9H,GACC9C,IAAM,QACNjC,KAAO,eAKX6N,yBAA2B,SAAUlK,GACpC,GAAIiC,GAAOP,KACVwH,EAASjH,EAAK4B,IAAI,UACf8F,EAASQ,IAAInK,EAAQ,UACxB5D,EAAOkB,IAAI0C,EAAQ,QACnB6J,EAAKvM,IAAI0C,EAAQ,MACjB0J,EAASpM,IAAI0C,EAAQ,UAClBoK,EAAoB,SAAUC,EAAO1H,GACxC,GAAI2H,GAAkBrI,EAAK4B,IAAI,mBAAmB0G,MAAM,IAE/C,IAAL5H,EACH2H,EAAgB1E,KAAKyE,GAErBC,EAAkB1K,EAAE8C,OAAO4H,EAAiB,SAAUE,GACrD,MAAOA,KAAOH,IAGhBpI,EAAKkB,IAAI,kBAAmBmH,EAAgBG,KAAK,MAElDL,GAAkBhO,EAAMsN,GACxBvK,QAAQsB,KAAK,gBAAkBwB,EAAK4B,IAAI,UAAY,qBAAuB5B,EAAK4B,IAAI,oBACpFnC,KAAKsI,oCACJd,OAASA,EACTwB,eAAiBtO,EACjBuO,UAAYjB,GACV,SAAUxL,GACW,QAAnBA,EAAIwC,YACPU,GACC9C,IAAMhB,IAAIY,EAAK,YAAa,IAC5B7B,KAAO,WAER+N,EAAkBhO,EAAOsN,EAAa,EAAJ,GAClCC,GACCT,OAASA,EACTW,GAAKA,KAGNzI,GACC9C,IAAM,QACNjC,KAAO,eAKXqC,UAAY,WACX,GAAIuD,GAAOP,IACXA,MAAKrB,IACJ0J,iBAAqB,SAAU/J,GAC9B,GAAI0J,GAASpM,IAAI0C,EAAQ,UACxB2J,EAASQ,IAAInK,EAAQ,SACtB0B,MAAKqI,iBAAiBL,EAAQC,IAE/BiB,qBAAyB,SAAU5K,GAClC0B,KAAKwI,yBAAyBlK,IAE/B6K,iBAAqB,SAAUzN,GAC9B,GAAIM,GAAayM,IAAI/M,EAAK,cACzB4C,EAAS1C,IAAIF,EAAK,aAClB0N,EAAYxN,IAAIF,EAAK,aACrB8L,EAASjH,EAAK4B,IAAI,UAClB8F,EAASQ,IAAI/M,EAAK,UAClB2N,EAAYZ,IAAI/M,EAAK,YACtBM,GAAWzB,GAAG+G,QAAQhD,GACrBkJ,OAASA,EACT8B,QAAUF,IACP,SAAU5M,GACb,GAAuB,QAAnBA,EAAIwC,WACPU,GACC9C,IAAMhB,IAAIY,EAAK,YAAa,IAC5B7B,KAAO,WAERsN,QACM,CACN,GAAIsB,KACJA,GAAQH,GAAa9K,EACrBiC,EAAKkB,IAAI,eAAgBlH,GAAG+G,QAAQf,EAAK4B,IAAI,gBAAiBoH,IAC9DF,IACA3J,GACC9C,IAAM,QACNjC,KAAO,sBAQZ6E,OAAQC,QAAS,SAAWnF,GAC9BC,GAAGC,GAAG,eACN,IAEIgP,IAFavN,QAAQS,GAAGiD,cACf1D,QAAQS,GAAGC,OACLkD,OAAOC,UACzBC,YAAc,WAEbC,KAAKxC,WAAa,KAElBwC,KAAKyJ,WAAa,KAElBzJ,KAAK0J,MAAQ,KAEb1J,KAAK2J,OAAS,KACd3J,KAAKkD,mBAGPsG,GAAalJ,OACZlD,KAAO,SAAU1B,GAGhB,GAFAsE,KAAKxC,WAAa5B,IAAIF,EAAK,YAAa,MACxCsE,KAAKmD,MAAQvH,IAAIF,EAAK,QAAS,OAC1BsE,KAAKxC,aAAewC,KAAKmD,MAC7B,KAAK,4BAGNnD,MAAK4J,cAENA,WAAa,WACZ,GAAIC,GAAY7J,KAAKmC,IAAI,aACrB2H,EAAMD,GACV7J,MAAKxC,WAAWiI,OAAOqE,GACvB9J,KAAKyJ,WAAazJ,KAAKxC,WAAW1B,KAAK,cACvCkE,KAAK0J,MAAQ1J,KAAKxC,WAAW1B,KAAK,mBAClCkE,KAAK2J,OAAS3J,KAAKxC,WAAW1B,KAAK,mBACnCkE,KAAK+J,YACL/J,KAAKhD,aAEN+M,UAAY,SAAUzL,GACrB,GAAI0L,IACHC,MAAQ,EACRC,KAAO,EACPC,WAAa,GACbC,OAAQ,EAETpK,MAAK2J,OAAOU,QAAQ9P,GAAG+G,QAAQ0I,EAAS1L,KAEzCtB,UAAY,WACX,GAAIuD,GAAOP,IACXO,GAAKmJ,MAAMY,SACVC,SAAW,YAEZhK,EAAKmJ,MAAM/K,GAAG,QAAS,kBAAmB,WACzC,GAAI+G,GAAOpL,EAAE0F,MACZwK,EAAO9E,EAAK5I,KAAK,YAClBmC,UAASC,SAASC,KAAOqL,IAE1BjK,EAAKoJ,OAAOhL,GAAG,OAAQ,SAAUzB,EAAGsJ,GACnC,GAAIlI,GAASiC,EAAK4C,MAAMiE,gBACxB9I,GAAe,OAAIkI,EACnBjG,EAAK4C,MAAME,KAAK,OAAQ9I,GAAG+G,QAAQhD,GAClCkI,OAAS5K,IAAI0C,EAAQ,SAAU,GAC/BmI,SAAW7K,IAAI0C,EAAQ,WAAY,UAKtC4E,cAAgB,WACf,GAAI2G,GAAYrG,WAAWC,QAAQxH,QAAQyH,OAAOvB,IAAI,yBACrDsI,EAAUjH,WAAWC,QAAQxH,QAAQyH,OAAOvB,IAAI,kBAChDuI,EAAUlH,WAAWC,QAAQxH,QAAQyH,OAAOvB,IAAI,kBAChDwI,EAASnH,WAAWC,QAAQxH,QAAQyH,OAAOvB,IAAI,iBAEhDqB,YAAWI,gBAAgB,UAAW3H,QAAQyH,OAAOvB,IAAI,kBACzDqB,WAAWI,gBAAgB,WAAY3H,QAAQyH,OAAOvB,IAAI,kBAE1DnC,KAAKyB,KACJoI,UAAYA,EACZY,QAAUA,EACVC,QAAUA,EACVC,OAASA,KAIXC,QAAU,SAAUC,GACnB,GACCC,GAAU,qCAAqCjC,MAAM,KAClDkC,EAAO7M,EAAEkG,IAAI0G,EAAS,SAAU5D,GACnC,MAAOtL,KAAIiP,EAAG3D,EAAG,OAElB,OAAOhJ,GAAE8C,OAAO+J,EAAM,SAAUC,GAC/B,OAAQzQ,GAAGyH,QAAQgJ,MAIrBC,cAAgB,SAAUpM,GACzB,GAAI0B,GAAOP,KACPkL,EAAU,SAAUH,GACvB,MAAO7M,GAAEkG,IAAI2G,EAAM,SAAUC,GAC5B,OACCnQ,IAAM,aACNsQ,IAAMH,MAIL/M,EAAMC,EAAEkG,IAAIvF,EAAM,SAAUwF,GAC/B,GAAI+G,GAAUxP,IAAIyI,EAAM,UAAW,IAClCgH,EAAUpP,QAAQqP,OAAOC,cAAcH,GACvCI,EAAW,EAEZ,OADAA,GAAqB,GAAVH,EAAeD,EAAWnP,QAAQqP,OAAOG,WAAWL,EAAS,IAAM,OAE7EvQ,IAAM,GACNsN,GAAKvM,IAAIyI,EAAM,SAAU,IACzB3J,KAAOkB,IAAIyI,EAAM,WAAY,IAC7BqH,IAAMzP,QAAQqP,OAAOK,eAAe/P,IAAIyI,EAAM,YAAa,KAC1DuH,MAAQ,IACRC,OAAS,IACTC,QAAU,KAGXf,KAAOG,EAAQ3K,EAAKqK,QAAQvG,IAC5B+G,QAAUA,EACVI,SAAWA,EACXO,IAAMnQ,IAAIyI,EAAM,MAAO,IACvB2H,SAAW/P,QAAQmD,UAAUC,WAAW,YAAazD,IAAIyI,EAAM,SAAU,MACzE4H,SAAWhQ,QAAQmD,UAAUC,WAAW,YAAazD,IAAIyI,EAAM,SAAU,MACzE6H,QAAiC,GAAvBtQ,IAAIyI,EAAM,UAAiB,UAAY,KAGnD,QACC8H,UACCC,KAAOnO,KAKVoO,aAAe,SAAU9B,GACxB,GAAIhK,GAAOP,IACXO,GAAKmJ,MAAM5N,KAAKyO,GAAU+B,iBAGzBC,KAAO,SACPC,QAAU,UACVC,SAAW,UACXC,OAAS,MACTC,QAAU,QAGXpM,EAAKmJ,MAAM5N,KAAKyO,GAAU5L,GAAG,+BAAgC,SAAUzB,EAAG0P,GACzE,GAAIC,GAAUvS,EAAE0F,MACfwH,EAASqF,EAAQ/P,KAAK,aACtB8P,EAASA,EAAY,EAAJ,CAClBrM,GAAK4C,MAAM4E,iBAAiBP,EAAQoF,EAAO,SAAUE,GACpDvM,EAAKmJ,MAAM5N,KAAKyO,GAAUvJ,OAAO,cAAgB8L,EAAU,KAAKR,gBAAgB,eAAe,QAKlGS,OAAS,WACR,GAAIxM,GAAOP,KACVmD,EAAQ5C,EAAK4C,MACb6J,EAAc7J,EAAMiE,iBACpBZ,EAAS5K,IAAIoR,EAAa,UACvB/I,EAAQd,EAAMf,SAASoE,GACvB1B,EAAavE,EAAK0K,cAAchH,GAChCwG,EAAUlK,EAAK4B,IAAI,WACnB4C,EAAO0F,EAAQ3F,EACnBvE,GAAKmJ,MAAMuD,QACX1M,EAAKmJ,MAAM3E,KAAKA,GAChBxE,EAAKwJ,WACJE,MAAQ9G,EAAMhB,IAAI,aAClB+H,KAAO/G,EAAMhB,IAAI,UACjBhD,KAAO,wBAGRoB,EAAK8L,aAAa,+BAIpBpQ,QAAQ2G,KAAK4G,aAAeA,CAE5B,IAAI0D,GAAe1D,EAAa1J,UAC/BC,YAAc,WAEbC,KAAKxC,WAAa,KAElBwC,KAAKyJ,WAAa,KAElBzJ,KAAK0J,MAAQ,KAEb1J,KAAK2J,OAAS,KACd3J,KAAKkD,kBAGPgK,GAAa5M,OACZtD,UAAY,WACX,GAAIuD,GAAOP,IACXO,GAAKmJ,MAAMY,SACVC,SAAW,YAEZhK,EAAKoJ,OAAOhL,GAAG,OAAQ,SAAUzB,EAAGsJ,GACnC,GAAIlI,GAASiC,EAAK4C,MAAMiE,gBACxB9I,GAAe,OAAIkI,EACnBjG,EAAK4C,MAAME,KAAK,OAAQ9I,GAAG+G,QAAQhD,GAClCkI,OAAS5K,IAAI0C,EAAQ,SAAU,GAC/BmI,SAAW7K,IAAI0C,EAAQ,WAAY,SAIrCiC,EAAKmJ,MAAM/K,GAAG,QAAS,sBAAuB,WAC7C,GAAI+G,GAAOpL,EAAE0F,MACZwH,EAAS9B,EAAK5I,KAAK,aACnBqQ,EAAezH,EAAK5I,KAAK,iBACzBsQ,EAAa1H,EAAK5I,KAAK,mBACxByD,GAAK8M,kBAAkB3H,EAAM8B,EAAQ2F,EAAcC,MAIrDlK,cAAgB,WACf,GAAI2G,GAAYrG,WAAWC,QAAQxH,QAAQyH,OAAOvB,IAAI,yBACrDsI,EAAUjH,WAAWC,QAAQxH,QAAQyH,OAAOvB,IAAI,kBAChDuI,EAAUlH,WAAWC,QAAQxH,QAAQyH,OAAOvB,IAAI,uBAChDwI,EAASnH,WAAWC,QAAQxH,QAAQyH,OAAOvB,IAAI,iBAEhDqB,YAAWI,gBAAgB,UAAW3H,QAAQyH,OAAOvB,IAAI,kBACzDqB,WAAWI,gBAAgB,WAAY3H,QAAQyH,OAAOvB,IAAI,uBAE1DnC,KAAKyB,KACJoI,UAAYA,EACZY,QAAUA,EACVC,QAAUA,EACVC,OAASA,KAIX2C,gBAAkB,SAAUjJ,GAC3B,GAAIkJ,GAAWtR,QAAQuR,QAAQC,aAC9BC,EAAa,GAAInT,IAAGmG,aACpBkI,EAAkBhN,IAAIyI,EAAM,kBAAmB,IAC/CsJ,EAAc/R,IAAIyI,EAAM,mBACrBpG,EAAM,IAaV,OAZAC,GAAEC,KAAKoP,EAAU,SAAUK,GAC1B,GAA0BlT,IAAjBkB,IAAIgS,EAAM,MAAchS,IAAIgS,EAAM,QAC1CC,gBAAiBjF,EAAgBzB,QAAQzM,IAAS,EAAI,EAAI,CAC3D,IAAIuD,GAAM1D,GAAG+G,QAAQsM,EAAMhS,IAAI+R,EAAa,OAC3CE,eAAiBA,eACjBrG,OAAS5L,IAAIyI,EAAM,WAEpBqJ,GAAWrM,SAAS3G,EAAMuD,KAE3BA,EAAMC,EAAE8C,OAAO0M,EAAWnL,SAAU,SAAUuG,GAC7C,MAAgD,IAAzClN,IAAIkN,EAAI,uBAAuB,MAKxCgF,sBAAwB,SAAUzJ,GACjC,GAAI9D,GAAOP,KACVnB,EAAO0B,EAAK+M,gBAAgBjJ,EAC7B,OAAOnG,GAAEkG,IAAIvF,EAAM,SAAUiK,GAC5B,GAAIpO,GAAOkB,IAAIkN,EAAI,QAClBiF,EAAO,QAAUrT,EACjBsT,EAAe,oBACfC,EAAoC,GAA7BrS,IAAIkN,EAAI,kBAAyB,UAAY,EACrD,QACCiF,KAAOA,EACPG,MAAQtS,IAAIkN,EAAI,SAChBkF,aAAeA,EACfxG,OAAS5L,IAAIkN,EAAI,UACjBnO,KAAOD,EACPyN,GAAKvM,IAAIkN,EAAI,MACbmF,KAAOA,EACPE,KAAO,OAKVC,kBAAoB,WACnB,GAAIC,GAAWpS,QAAQqS,iBACtBC,EAAW3S,IAAIyS,EAAU,OACzBG,OAAQvS,QAAQwS,iBACjB,IAAIxQ,GAAMC,EAAEpC,KAAK0S,MAAO,SAAUE,GACjC,GAAIC,GAAW/S,IAAI8S,EAAM,YACrBE,EAAY1Q,EAAEpC,KAAKyS,EAAU,SAAUtH,GAC1C,MAAOrL,KAAI8S,EAAM,OAASzH,GAE3B,SAAS2H,IAA0B,WAAZD,GAAqC,OAAZA,IAEjD,SAAS1Q,GAGVgN,cAAgB,SAAUpM,GACzB,GAAI0B,GAAOP,KACP/B,EAAMC,EAAEkG,IAAIvF,EAAM,SAAUwF,GAC/B,OACCxJ,IAAM,GACN2M,OAAS5L,IAAIyI,EAAM,SAAU,IAC7BwK,SAAWjT,IAAIyI,EAAM,WAAY,IACjCyK,YAAevO,EAAK6N,oBAAiC,GAAX,SAC1CW,WAAanT,IAAIyI,EAAM,aAAc,IACrC2J,aAAe,kBACfgB,SAAkC,GAAvBpT,IAAIyI,EAAM,UAAiB,UAAY,GAClDkJ,SAAWhN,EAAKuN,sBAAsBzJ,KAGxC,QACC4K,UACC7C,KAAOnO,KAKVoO,aAAe,SAAU9B,GACxB,GAAIhK,GAAOP,IACXO,GAAKmJ,MAAM5N,KAAKyO,GAAU+B,iBAGzBC,KAAO,SACPC,QAAsB,qCAAZjC,EAAkD,UAAY,UACxEkC,SAAW,UACXC,OAAS,MACTC,QAAU,QAGXpM,EAAKmJ,MAAM5N,KAAKyO,GAAU5L,GAAG,+BAAgC,SAAUzB,EAAG0P,GACzE,GAAIC,GAAUvS,EAAE0F,MACftF,EAAOmS,EAAQ/P,KAAK,QACpB0K,EAASqF,EAAQ/P,KAAK,aACtB8P,EAASA,EAAY,EAAJ,EACjBW,EAAWV,EAAQ/P,KAAK,iBACxBsQ,EAAaP,EAAQ/P,KAAK,mBACf,oBAARpC,EACH6F,EAAK4C,MAAM4E,iBAAiBP,EAAQoF,EAAO,SAAUE,GACpDvM,EAAKmJ,MAAM5N,KAAKyO,GAAUvJ,OAAO,cAAgB8L,EAAU,KAAKR,gBAAgB,eAAe,KAGhG/L,EAAK4C,MAAM+E,0BACVV,OAASA,EACT9M,KAAO6S,EACPpF,GAAKiF,EACLpF,OAAS4E,GACP,SAAUtO,GACZiC,EAAKmJ,MAAM5N,KAAKyO,GAAUvJ,OAAO,cAAgBpF,IAAI0C,EAAQ,UAAY,sBAAwB1C,IAAI0C,EAAQ,MAAQ,KACnHgO,gBAAgB,eAAe,QAOrCS,OAAS,WACR,GAAIxM,GAAOP,KACVmD,EAAQ5C,EAAK4C,MACb6J,EAAc7J,EAAMiE,iBACpBZ,EAAS5K,IAAIoR,EAAa,UACvB/I,EAAQd,EAAMf,SAASoE,GACvB1B,EAAavE,EAAK0K,cAAchH,GAChCwG,EAAUlK,EAAK4B,IAAI,WACnB4C,EAAO0F,EAAQ3F,EACnBvE,GAAKmJ,MAAMuD,QACX1M,EAAKmJ,MAAM3E,KAAKA,GAChBxE,EAAKwJ,WACJE,MAAQ9G,EAAMhB,IAAI,aAClB+H,KAAO/G,EAAMhB,IAAI,UACjBhD,KAAO,wBAGRoB,EAAK8L,aAAa,qCAClB9L,EAAK8L,aAAa,oCAGnBgB,kBAAoB,SAAU5O,EAAS+I,EAAQ9M,EAAMyN,GACpD,CAAA,GAAI5H,GAAOP,IACI,IAAI/D,SAAQiT,QAAQC,iBAClCC,UAAY3Q,EACZ2K,UAAYjB,EACZkH,YAAc3U,EACdyI,MAAQ5C,EAAK4C,MAAM2E,qBAAqBN,SAI3CvL,QAAQ2G,KAAKsK,aAAeA,GAC1B1N,OAAQC,QAAS,WACnBlF,GAAGC,GAAG,eACN,IAII8U,IAJarT,QAAQS,GAAGiD,cACf1D,QAAQS,GAAGC,OACJV,QAAQ2G,KAAK2M,cACdtT,QAAQ2G,KAAKsK,aACPrN,OAAOC,UAS/BC,YAAc,SAAUrE,GAOvB,GANAsE,KAAKyB,KACJwE,YAAchK,QAAQiK,mBAEvBlG,KAAKrE,UAAYC,IAAIF,EAAK,YAAa,MACvCsE,KAAKoG,KAAOxK,IAAIF,EAAK,OAAQ,MAC7BsE,KAAKmD,MAAQvH,IAAIF,EAAK,QAAS,OAC1BsE,KAAKoG,OAASpG,KAAKmD,QAAUnD,KAAKrE,UACtC,KAAK,wBAENqE,MAAKI,SAAU,EACfJ,KAAKhD,eAGPsS,GAAmBhP,OAClBlD,KAAO,SAAUkB,GAChB0B,KAAKmD,MAAM/F,KAAKkB,GAChB0B,KAAKoG,KAAKhJ,MACT+F,MAAQnD,KAAKmD,MACbxH,UAAYqE,KAAKrE,YAElBqE,KAAKI,SAAU,GAEhByB,SAAW,WAAa,MAAO7B,MAAKI,SACpCpD,UAAY,WACXgD,KAAKrB,IACJ+H,KAAO,SAAUpI,GAChB,GAAIiC,GAAOP,IACNO,GAAKsB,YACTtB,EAAKnD,KAAKkB,GAEXiC,EAAK4C,MAAME,KAAK,OAAQ/E,KAEvB0B,MACHA,KAAKmD,MAAMxE,IACV+H,KAAO,SAAUpI,GAChB,GAAIiC,GAAOP,KACPzD,EAAO,WACVgE,EAAK6F,KAAK/C,KAAK,UAEhB9C,GAAK4C,MAAMuD,KAAKpI,EAAQ/B,KASvByD,MACHA,KAAKoG,KAAKzH,IACToO,OAAS,WACR,GAAIxM,GAAOP,IACXO,GAAK6F,KAAK2G,UAEXyC,YAAc,SAAUlR,GACvB,GAAIiC,GAAOP,IACXO,GAAK6F,KAAK2D,UAAUzL,KAEnB0B,SAGL/D,QAAQ2G,KAAK0M,mBAAqBA,GAChC9P,OAAQC,QAAS,SAAWnF,GA6M/B,QAASmV,GAAaC,EAAWC,EAAWlN,GAExC,GAAIzG,GAAa4T,EAAEC,WACnB7T,IAAYyG,OAAQA,GAAS,SAASqN,GAElC,MAAqB,OAAlBA,EAAI9Q,gBAEH8Q,EAAIC,WAAaC,GAAQpT,IAAKkT,EAAIC,UAAWpV,KAAM,aAIvDsV,EAAcP,EAAWI,EAAIjR,KAAKqR,QAAS,YAAa,mBACxDD,GAAcN,EAAWG,EAAIjR,KAAKqR,QAAS,YAAa,cAAe,aAK/E,QAASC,GAAUC,EAAY3N,GAE3B,GAAIzG,GAAa4T,EAAElN,QACnB1G,IAAYyG,OAAQA,GAAS,SAASqN,GAElC,MAAqB,OAAlBA,EAAI9Q,gBAEH8Q,EAAIC,WAAaC,GAAQpT,IAAKkT,EAAIC,UAAWpV,KAAM,gBAIvDsV,GAAcG,EAAYN,EAAIjR,KAAKqR,QAAS,SAAU,cAK9D,QAASG,GAAWD,GAEhB,GAAIpU,GAAa4T,EAAE9N,SACnB9F,IAAYsU,SAAU,GAAI,SAASR,GAE/B,MAAqB,OAAlBA,EAAI9Q,gBAEH8Q,EAAIC,WAAaC,GAAQpT,IAAKkT,EAAIC,UAAWpV,KAAM,gBAIvDsV,GAAcG,EAAYN,EAAIjR,KAAKqR,QAAS,SAAU,cAK9D,QAASD,GAAcG,EAAYvR,EAAM/D,EAAKyV,EAAOC,GAEjD,GAAIC,GAAc,qBACCD,GAAgB,WACjB,WAClBlW,GAAE6D,KAAKU,EAAM,SAAU6R,EAAGtL,GAEtBqL,GAAe,kBACArL,EAAEtK,GAAO,KACTsK,EAAEmL,GACF,cAGnBH,EAAWnD,QAAQlI,KAAK0L,GAG5B,QAASE,GAAcC,GAEnB,MAAOA,GAAQ9U,KAAK,mBAAmB+U,OAAOC,QAAQ,KAAM,IA/QhEvW,GAAGC,GAAG,eACN,IAAIoV,GAAI3T,QAAQC,OACZ6U,EAAI9U,QAAQS,GACZsT,EAASe,EAAEpU,MAEfV,SAAQ2G,KAAKoO,WAAa,SAAUC,GAGhCA,EAAQC,iBACR,IAAIC,GAAWF,EAAQpS,KAAK,mBACxBuS,EAASH,EAAQnV,KAAK,SACtBuV,EAASJ,EAAQnV,KAAK,SACtBwV,EAASL,EAAQnV,KAAK,SACtByV,EAAQH,EAAOtV,KAAK,WACpB0V,EAAQJ,EAAOtV,KAAK,WACpB4T,EAAY0B,EAAOtV,KAAK,eACxB6T,EAAYyB,EAAOtV,KAAK,cAE5BuU,GAAWkB,GAEXA,EAAM5S,GAAG,SAAU,WAEf,GAAI8D,GAASnI,EAAE0F,MAAM5E,KACjBqH,KAEJ0N,EAAUqB,EAAO/O,GACjBgN,EAAaC,EAAWC,EAAWlN,MAIvC2O,EAAOtV,KAAK,wCAAwC2V,YAChDC,WAAY,EACZC,cAAc,EACdC,cAAe,EACfC,YAAa,IAGjBT,EAAO5S,oBACHE,QACImQ,UACI3T,QAAS,QACTF,YACIC,UACIC,QAAS,WAEb4W,cACIzW,IAAK,EACLC,IAAK,IACLJ,QAAS,wBAIrBuH,QACIzH,YAAcC,UAAYC,QAAS,eAEvC6Q,KACI/Q,YACIC,UAAYC,QAAS,YACrB6W,aAAe7W,QAAS,MAGhCkQ,SACIpQ,YACIC,UAAYC,QAAS,YACrB4W,cACIzW,IAAK,EACLC,IAAK,IACLJ,QAAS,uBAIrB8W,MACIhX,YACIC,UAAYC,QAAS,YACrB+W,SAAW/W,QAAS,iBAG5BgX,eACIlX,YACIC,UAAYC,QAAS,eAG7BiX,mBACInX,YACIC,UAAYC,QAAS,eACrBkX,MAAQlX,QAAS,MAGzBmX,iBACIrX,YACIC,UAAYC,QAAS,eACrBkX,MACIlX,QAAS,GACToX,eAAgB,uBAI5BhQ,QACItH,YACIC,UAAYC,QAAS,eAG7BqX,YACIvX,YACIC,UAAYC,QAAS,cAMrC,IAAIsX,GAAapB,EAAOtV,KAAK,cACzB2W,EAAY,EAChBD,GAAW1W,KAAK,OAAOgB,KAAK,MAAO8S,EAAE8C,WAAa,8BAElDF,EAAW1W,KAAK,eAAe6C,GAAG,QAAS,WAEvCoS,EAAE4B,WACEC,UAAW,SAAUC,EAASC,GAE1B,GAAIC,GAAMnD,EAAEoD,sBAAwB,IAAMH,CAC1CJ,GAAYI,EACZL,EAAW1W,KAAK,OAAOgB,KAAK,MAAOiW,GACnCD,EAAKG,MAAM,YAKvB,IAAIC,GAAY,KACZ9O,EAAM,KACNoD,EAAS,GACT2L,EAAa9B,EAAOvV,KAAK,mBACzBsX,EAAmB9B,EAAOxV,KAAK,mBAEnCmV,GAAQnV,KAAK,aAAa6C,GAAG,QAAS,WAElC,GAAI0U,GAAWlC,EAASmC,YAExB,IAAGD,EAASE,GAAG,SACf,CACI,IAAInC,EAAOvS,KAAK,sBAAsBU,WAAWiU,UAAW,MAE5DN,GAAYjX,QAAQqP,OAAOmI,UAAUrC,GACrC8B,EAAU1L,OAASA,EACnB0L,EAAUrE,SAAWqE,EAAUrE,SAASiC,QAAQ,IAAK,KAAKA,QAAQ,IAAK,KACvEoC,EAAUQ,SAAW/C,EAAca,GACnC0B,EAAUS,aAAehD,EAAcjB,GACvCwD,EAAUU,aAAeV,EAAUW,WAAalD,EAAchB,GAAa,GAC3EuD,EAAUT,UAAYA,EACtBS,EAAUY,aAAeZ,EAAUf,kBAAoB,IAAMe,EAAUb,eACvE,IAAI0B,IAAYb,EAAUrE,SAAUqE,EAAU9H,QAAS8H,EAAUS,aACjET,GAAUU,cAAgBG,EAAS7P,KAAKgP,EAAUU,cAClDG,EAAS7P,KAAKgP,EAAUQ,UACxBR,EAAUpN,WAAaiO,EAAShL,KAAK,MAErC,IAAI/M,GAAawL,EAASoI,EAAEoE,mBAAqBpE,EAAEqE,UAsBnD,YArBAjY,GAAWkX,EAAW,SAASpD,GAE3B,MAAqB,OAAlBA,EAAI9Q,gBAEH8Q,EAAIC,WAAaC,GAAQpT,IAAKkT,EAAIC,UAAWpV,KAAM,aAGvD6M,EAASA,GAAUsI,EAAIjR,KAAKqR,QAAQ,GAAG1I,OACvC4L,EAAiBtW,KAAK,OAAQb,QAAQmD,UAAUC,WAAW,YAE3D8R,EAAS+C,YAET9P,EAAMnI,QAAQ2G,KAAKwB,KAAKvF,MACpBsV,aAAa,EACbtF,SAAUqE,EAAUrE,SACpB9C,IAAKmH,EAAUnH,IACfX,QAAS8H,EAAU9H,SACpBgJ,UAAWjB,QAOtB,GAAGE,EAASE,GAAG,SACf,CACI,GAAIc,GAAMjQ,EAAIkQ,SAASD,IAAKE,EAAMnQ,EAAIkQ,SAASC,IAC3CC,GACIhN,OAAQA,EACRiN,kBAAmBJ,EACnBK,iBAAkBH,EAClBI,uBAAwBN,EACxBO,sBAAuBL,GAE3BvY,EAAa4T,EAAEiF,UACnB7Y,GAAWwY,EAAS,SAAS1E,GAEzB,MAAqB,OAAlBA,EAAI9Q,gBAEH8Q,EAAIC,WAAaC,GAAQpT,IAAKkT,EAAIC,UAAWpV,KAAM,YAFvD,SAORwW,EAAS+C,WA2Ed1U,OAAQC,QAWV,SAAWnF,GAkQZ,QAASwa,GAAelW,EAAOC,GAE3BD,EAAM9C,KAAK,iBAAiBiZ,IAAI,kCAAkC5W,KAAK,WAEnE,GAAI6W,GAAQ1a,EAAE0F,MACViV,EAAKD,EAAME,SAAS,IAEpBD,GAAGpE,KADJmE,EAAMzB,GAAG,sBACA1U,EAAKiV,aACTkB,EAAMzB,GAAG,UACL5C,EAAcqE,GAEdA,EAAM5Z,SAI1B,QAASqU,GAAaC,EAAWC,EAAWlN,EAAQ8P,EAAYsB,GAE5D,GAAI7X,GAAa4T,EAAEC,WACnB7T,IAAYyG,OAAQA,GAAS,SAASqN,GAElC,MAAqB,OAAlBA,EAAI9Q,gBAEH8Q,EAAIC,WAAaC,GAAQpT,IAAKkT,EAAIC,UAAWpV,KAAM,aAIvDsV,EAAcP,EAAWI,EAAIjR,KAAKqR,QAAS,YAAa,eACxDD,EAAcN,EAAWG,EAAIjR,KAAKqR,QAAS,YAAa,cAAe,UACvEqC,GAAc7C,EAAUtU,IAAImX,QAC5BsB,GAAclE,EAAUvU,IAAIyY,OAKpC,QAAS1D,GAAUqB,EAAO/O,EAAQH,GAE9B,GAAItG,GAAa4T,EAAElN,QACnB1G,IAAYyG,OAAQA,GAAS,SAASqN,GAElC,MAAqB,OAAlBA,EAAI9Q,gBAEH8Q,EAAIC,WAAaC,GAAQpT,IAAKkT,EAAIC,UAAWpV,KAAM,aAIvDsV,EAAcuB,EAAO1B,EAAIjR,KAAKqR,QAAS,SAAU,iBACjD5N,GAAUkP,EAAMpW,IAAIkH,OAK5B,QAAS+N,GAAWkB,EAAO4D,GAEvB,GAAInZ,GAAa4T,EAAE9N,SACnB9F,IAAYsU,SAAU,GAAI,SAASR,GAE/B,MAAqB,OAAlBA,EAAI9Q,gBAEH8Q,EAAIC,WAAaC,GAAQpT,IAAKkT,EAAIC,UAAWpV,KAAM,aAIvDsV,EAAcsB,EAAOzB,EAAIjR,KAAKqR,QAAS,SAAU,gBACjDqB,GAAMnW,IAAI+Z,EAAS1S,QAAQhE,QAAQ,UAAW0W,EAAS7S,OAAQ6S,EAAS5C,WAAY4C,EAAStB,gBAKrG,QAAS5D,GAAcG,EAAYvR,EAAM/D,EAAKyV,EAAOC,GAEjD,GAAIC,GAAc,qBACCD,GAAgB,WACjB,WAClBlW,GAAE6D,KAAKU,EAAM,SAAU6R,EAAGtL,GAEtBqL,GAAe,kBACArL,EAAEtK,GAAO,KACTsK,EAAEmL,GACF,cAGnBH,EAAWnD,QAAQlI,KAAK0L,GAG5B,QAASE,GAAcC,GAEnB,MAAOA,GAAQ9U,KAAK,mBAAmB+U,OAAOC,QAAQ,KAAM,IAvVhEvW,GAAGC,GAAG,eACN,IAAIoV,GAAI3T,QAAQC,OACZ6U,EAAI9U,QAAQS,GACZ0Y,EAAInZ,QAAQ2G,KACZoN,EAASe,EAAEpU,OACX8W,EAAYxX,QAAQqP,OAAOmI,UAC3B4B,EAAUpZ,QAAQ2G,KAAKwB,GAE3BgR,GAAEE,SAAW,SAAU9X,EAAY+X,EAAUjX,GAEzC,GAAIA,EAAJ,CAEA,GAAIkX,GAAeJ,EAAEK,kBAAkBF,EAAUjX,EAAQd,GAErDgK,EAASlJ,EAAQ6W,EAAW,KAC5BvW,EAAQ,KAAM2S,EAAQ,KAAMC,EAAQ,KACpC9B,EAAY,KAAMC,EAAY,KAC9B8C,EAAY,GAAI5W,EAAO,KACvB6Z,EAAU9F,EAAEoD,sBAAwB,IACpC1T,EAAK,KAAM8E,EAAM,IAErBwL,GAAE+F,aAAanO,OAASA,GAAS,SAAUsI,GAEvC,GAAqB,OAAlBA,EAAI9Q,WAGH,YADA8Q,EAAIC,WAAaC,GAAQpT,IAAKkT,EAAIC,UAAWpV,KAAM,WAGvDwa,GAAWrF,EAAIjR,KAAKqR,QAAQ,GAG5BkF,EAAEQ,mBAAmBT,EAAU3X,EAAY,SAASqY,GAEhDL,EAAaM,OAAOD,IAGxB,IAAIE,GAAWZ,EAASrB,aAAajL,MAAM,IAC3CsM,GAAShD,kBAAoB4D,EAAS,GACtCZ,EAAS9C,gBAAkB0D,EAAS,GACpCZ,EAASa,kBAA8C,KAA1Bb,EAASjD,cAAuB,KAAO,IAEpE,IAAI+D,GAAMzS,WAAWC,QAAQxH,QAAQyH,OAAOvB,IAAI,iBAChDvD,GAAQtE,EAAE2b,EAAId,IAAWe,SAAS1Y,GAClC+T,EAAQ3S,EAAM9C,KAAK,WACnB0V,EAAQ5S,EAAM9C,KAAK,WACnB4T,EAAY9Q,EAAM9C,KAAK,eACvB6T,EAAY/Q,EAAM9C,KAAK,eAGvByV,EAAM5S,GAAG,SAAU,SAAUzB,EAAGoF,EAAQiQ,EAAYsB,GAEhD,GAAIpR,GAASnI,EAAE0F,MAAM5E,KACjBqH,KAEJ0N,EAAUqB,EAAO/O,EAAQH,GACzBmN,EAAaC,EAAWC,EAAWlN,EAAQ8P,EAAYsB,MAG3DxD,EAAWkB,EAAO4D,GAIlBvW,EAAM9C,KAAK,wCAAwC2V,YAC/CC,WAAY,EACZC,cAAc,EACdC,cAAe,EACfC,YAAa,IAGjBjT,EAAMJ,oBACFE,QACImQ,UACI3T,QAAS,QACTF,YACIC,UACIC,QAAS,WAEb4W,cACIzW,IAAK,EACLC,IAAK,IACLJ,QAAS,wBAIrBuH,QACIzH,YAAcC,UAAYC,QAAS,eAEvC6Q,KACI/Q,YACIC,UAAYC,QAAS,YACrB6W,aAAe7W,QAAS,MAGhCkQ,SACIpQ,YACIC,UAAYC,QAAS,YACrB4W,cACIzW,IAAK,EACLC,IAAK,IACLJ,QAAS,uBAIrB8W,MACIhX,YACIC,UAAYC,QAAS,YACrB+W,SAAW/W,QAAS,iBAG5BgX,eACIlX,YACIC,UAAYC,QAAS,eAG7BiX,mBACInX,YACIC,UAAYC,QAAS,eACrBkX,MAAQlX,QAAS,MAGzBmX,iBACIrX,YACIC,UAAYC,QAAS,eACrBkX,MACIlX,QAAS,GACToX,eAAgB,uBAI5BhQ,QACItH,YACIC,UAAYC,QAAS,eAG7BqX,YACIvX,YACIC,UAAYC,QAAS,eAKrCoE,EAAKV,EAAMC,KAAK,qBAEhB,IAAI2T,GAAa5T,EAAM9C,KAAK,aAC5BD,GAAO2W,EAAW1W,KAAK,OAAOgB,KAAK,MAAO8S,EAAE8C,WAAa,8BACzDD,EAAY0C,EAAS1C,UACrBA,GAAa5W,EAAKiB,KAAK,MAAO4Y,EAAUjD,GAExCrO,EAAMiR,GAASxW,MACXsV,aAAa,EACbtF,SAAUsG,EAAStG,SACnB9C,IAAKoJ,EAASpJ,IACdX,QAAS+J,EAAS/J,QAClBiJ,IAAKc,EAASR,uBACdJ,IAAKY,EAASP,2BAKtBpX,EAAWmB,GAAG,QAAS,SAASzB,GAE5B,GAAIiZ,GAAU7b,EAAE4C,EAAEC,OAclB,IAZGgZ,EAAQ5C,GAAG,iCAEVxC,EAAE4B,WACEC,UAAW,SAAUC,EAASC,GAE1BL,EAAYI,EACZhX,EAAKiB,KAAK,MAAO4Y,EAAU7C,GAC3BC,EAAKG,MAAM,WAKpBkD,EAAQ5C,GAAG,cAEV,GAAGjU,EAAG8W,aAAa,aAAe9W,EAAG8W,aAAa,QAAU9W,EAAG8W,aAAa,WAC5E,CACI,GAAIC,GAASjS,EAAIkQ,SACbgC,EAAW7C,EAAU7U,EACzBwF,GAAMiR,GAASxW,MACXsV,aAAa,EACbtF,SAAUyH,EAASzH,SACnB9C,IAAKuK,EAASvK,IACdX,QAASkL,EAASlL,QAClBiJ,IAAKgC,EAAOhC,IACZE,IAAK8B,EAAO9B,MAGhB,IAAIC,IACIhN,OAAQA,EACRiN,kBAAmB4B,EAAOhC,IAC1BK,iBAAkB2B,EAAO9B,IACzBI,uBAAwB0B,EAAOhC,IAC/BO,sBAAuByB,EAAO9B,IAGtC3E,GAAEiF,WAAWL,EAAS,SAAS1E,GAE3B,MAAqB,OAAlBA,EAAI9Q,gBAEH8Q,EAAIC,WAAaC,GAAQpT,IAAKkT,EAAIC,UAAWpV,KAAM,gBAIvDqV,IAAQpT,IAAK,YAAajC,KAAM,kBAOpCqV,IAAQpT,IAAK,cAAejC,KAAM,UAU1C,IALGwb,EAAQ5C,GAAG,aAEV3U,EAAM+G,YAAY,aAAaC,SAAS,aAGzCuQ,EAAQ5C,GAAG,YACd,CACI,IAAIjU,EAAGC,WAAWiU,UAAW,MAE7B,IAAI+C,GAAW9C,EAAU7U,EACzB2X,GAAS/O,OAASA,EAClB+O,EAAS1H,SAAW0H,EAAS1H,SAASiC,QAAQ,IAAK,KAAKA,QAAQ,IAAK,KACrEyF,EAAS7C,SAAW/C,EAAca,GAClC+E,EAAS5C,aAAehD,EAAcjB,GACtC6G,EAAS3C,aAAe2C,EAAS1C,WAAalD,EAAchB,GAAa,GACzE4G,EAAS9D,UAAYA,EACrB8D,EAASzC,aAAeyC,EAASpE,kBAAoB,IAAMoE,EAASlE,eACpE,IAAI0B,IAAYwC,EAAS1H,SAAU0H,EAASnL,QAASmL,EAAS5C,aAC9D4C,GAAS3C,cAAgBG,EAAS7P,KAAKqS,EAAS3C,cAChDG,EAAS7P,KAAKqS,EAAS7C,UACvB6C,EAASzQ,WAAaiO,EAAShL,KAAK,OAEpC6G,EAAEoE,mBAAmBuC,EAAU,SAASzG,GAEpC,MAAqB,OAAlBA,EAAI9Q,gBAEH8Q,EAAIC,WAAaC,GAAQpT,IAAKkT,EAAIC,UAAWpV,KAAM,aAIvDiE,EAAM+G,YAAY,aAAaC,SAAS,aACxCoK,GAAQpT,IAAK,QAASjC,KAAM,gBAC5Bma,GAAelW,EAAO2X,YAgGnC/W,OAAQC,QAWV,SAAWnF,GACZC,GAAGC,GAAG,gBAGNyB,QAAQ2G,KAAK4T,SAAW,SAAUhZ,EAAY+X,EAAUjX,GAwFpD,QAASmY,KAELC,EAAQC,IACRC,EAAW/F,KAAK6F,EAAMnb,QACtBsb,EAAO9R,KAAK+R,GAASJ,MAAOA,KAC5BG,EAAO/a,KAAK,OAAOib,WAGvB,QAASJ,KAEL,GAAIK,KACJ,IAAIC,EASAD,EAASE,EAAgBD,GAAWP,UAPpC,KAAI,GAAIS,KAAkBD,GAEtBF,EAAO9S,KAAKkT,MAAMJ,EAAQE,EAAgBC,GAAgBT,MAQlE,KAAIW,IAAKC,GAELN,EAAS1c,EAAEid,KAAKP,EAAQ,SAAUQ,GAE9B,MAAY,YAALH,EAAkBG,EAAKH,GAAGlQ,QAAQmQ,EAAaD,IAAM,GAAKG,EAAKH,IAAMC,EAAaD,IAIjG,OAAOL,GAGX,QAASS,GAAcC,GAEnB,GAAIV,KACJ,KAAItG,EAAI,EAAGiH,EAAID,EAAUnc,OAAYoc,EAAJjH,EAAOA,IACxC,CACI,GAAI8G,GAAOE,EAAUhH,GAAI5P,EAAM0W,EAAKL,cAIpC,IAFAH,EAAOlW,GAAOkW,EAAOlW,KAAS4V,SAAWkB,iBAAkBJ,EAAKI,kBAE5DJ,EAAKK,OAAT,CAEA,GAAIrN,GAAOgN,EAAKM,QAChB,IAAGtN,EACH,CACI,GAAIuN,GAAMP,EAAKQ,SAAU3c,EAAM,GAC3B4c,EAAIF,EAAM,EAAI1c,EAAM6c,KAAKC,MAAM9c,EAAM0c,GACrCK,EAAIL,EAAM,EAAIG,KAAKC,MAAM9c,EAAM0c,GAAO1c,CAC1Cmc,GAAKa,OAAS3C,QAAUlL,EAAKsG,QAAQ,SAAU,IAAMsH,EAAI,IAAMH,EAAI,qBAGnET,GAAKa,OAASC,QAAU,YAE5Bd,GAAKe,YAAiC,GAAnBf,EAAKgB,WAAkB,SAAW,SACrDhB,EAAKiB,YAAcjB,EAAKkB,YAAc,EAAI,SAAW,SACrDlB,EAAKmB,UAAiC,GAArBnB,EAAKoB,aAAoB,SAAW,SACrDpB,EAAKqB,oBAAsBrB,EAAKqB,oBAAsB,EAAIC,WAAWtB,EAAKqB,qBAAuB,IAE7E,IAAjBrB,EAAKuB,UAAkBvB,EAAKuB,UAAYvB,EAAKwB,SAE5CxB,EAAKuB,SAAWvB,EAAKwB,MACrBxB,EAAKwB,MAAQ,KAEG,IAAjBxB,EAAKyB,UAAkBzB,EAAKyB,UAAYzB,EAAKuB,YAE5CvB,EAAKyB,SAAW,IAEpBzB,EAAKwB,MAAQxB,EAAKwB,OAAS,GAC3BxB,EAAKuB,SAAWvB,EAAKuB,UAAY,GACjCvB,EAAKyB,SAAWzB,EAAKyB,UAAY,EAEjC,IAAIC,GAAMlC,EAAOlW,GAAK4V,MAClByC,GACIA,KAAM3B,EAAK2B,KAAO3B,EAAK2B,KAAO,IAAM,GACpCH,MAAOxB,EAAKwB,MAAQ,IAAMF,WAAWtB,EAAKwB,OAAS,GACnDD,SAAUvB,EAAKuB,SAAW,IAAMD,WAAWtB,EAAKuB,UAAY,GAC5DE,SAAUzB,EAAKyB,SAAW,IAAMH,WAAWtB,EAAKyB,UAAY,IAEhEG,EAAMC,EAAQH,EAAK1B,EAAM,SAEnB,KAAP4B,GAEC5B,EAAK8B,OAASH,GACdD,EAAIhV,KAAKsT,IAIT0B,EAAIE,GAAKE,MAAMpV,KAAKiV,IAI5B,MAAOnC,GAGX,QAASqC,GAAQE,EAAKC,EAAK1e,GAEvB,IAAI,GAAI4V,GAAI,EAAGiH,EAAI4B,EAAIhe,OAAYoc,EAAJjH,EAAOA,IAElC,GAAG6I,EAAI7I,GAAG5V,IAAQ0e,EAAI1e,GAAM,MAAO4V,EAEvC,OAAO,GA7LX,GAAIpS,EAAJ,CAEA,GAAIsR,GAAI3T,QAAQC,OACZ6U,EAAI9U,QAAQS,GACZsT,EAASe,EAAEpU,OAGX6K,GAFYvL,QAAQqP,OAAOmI,UAElBnV,EACToX,SAAU9F,EAAEoD,sBAAwB,IACpCsF,QAAU1I,EAAE8C,WAAa,GAE7B,IAAIwE,GAAkB,KAClBD,EAAY,GACZP,EAAQ,KACRY,EAAe,KAEfR,EAAUtT,WAAWC,QAAQxH,QAAQyH,OAAOvB,IAAI,aAChDsX,EAAQnf,EAAE2B,QAAQyH,OAAOvB,IAAI,kBAC7BuX,EAAa,KACbC,EAAcF,EAAM3d,KAAK,eACzB8d,EAAeD,EAAY7d,KAAK,gBAChC+d,EAAYF,EAAY7d,KAAK,aAC7Bge,EAAWH,EAAY7d,KAAK,wBAE5B8a,GADW6C,EAAM3d,KAAK,oBACT2d,EAAM3d,KAAK,yBACxB+a,EAAS4C,EAAM3d,KAAK,mBAExB8T,GAAEmK,aAAavS,OAASA,GAAS,SAAUsI,GAEvC,GAAqB,OAAlBA,EAAI9Q,WAGH,YADA8Q,EAAIC,WAAaC,GAAQpT,IAAKkT,EAAIC,UAAWpV,KAAM,WAIvDuc,GAAkBO,EAAc3H,EAAIjR,KAAKqR,SACzCuG,IAAehZ,QAAQuc,IAAItD,EAC3B,IAAIuD,GAAgBR,EAAM3d,KAAK,iBAAiB2J,OAAOnL,EAAE,4CAA4CuW,KAAK,SAAW6F,EAAMnb,OAAS,KAEpI,KAAI,GAAI4M,KAAM+O,GACd,CACI,GAAIgD,GAAWhD,EAAgB/O,EAC/B7N,GAAE,iBAAiBuE,KAAK,KAAMsJ,GAAI0I,KAAKqJ,EAAStC,iBAAmB,KAAOsC,EAASxD,MAAMnb,OAAS,KAAK2a,SAAS+D,GAEpHP,EAAaO,EAAcne,KAAK,QAChC2d,EAAMvD,SAAS1Y;GAGnBic,EAAM9a,GAAG,QAAS,SAASzB,GAEvB,GAAIiZ,GAAU7b,EAAE4C,EAAEC,OAalB,IAZGgZ,EAAQ5C,GAAG,wBAEVmG,EAAW/T,YAAY,sBACvBwQ,EAAQvQ,SAAS,sBACjBqR,EAAYd,EAAQtX,KAAK,MACzB+a,EAAaxe,IAAI,IACjBye,EAAUze,IAAI,IACd0e,EAASK,KAAK,WAAW,GACzB7C,EAAe,KACfb,KAGDN,EAAQ5C,GAAG,kBACd,CACI,GAAI6G,GAAWN,EAAS9Y,OAAO,YAC3B0X,EAAcpe,EAAE+f,KAAKT,EAAaxe,OAClCkf,EAAWhgB,EAAE+f,KAAKR,EAAUze,QAC7Bsd,GAAe4B,GAAYF,EAAS7e,UAEnC+b,KACGoB,IAAapB,EAAaoB,YAAcA,GACxC4B,IAAUhD,EAAagD,SAAWA,GACrCF,EAASjc,KAAK,WAEI,cAAX6B,KAAKmI,GACJmP,EAAaiD,WAAa,IAE1BjD,EAAatX,KAAKmI,IAAM,MAGhCsO,WAiHbjX,OAAQC,QAYT,SAASnF,GAqBV,QAASkgB,GAAQC,GAEVza,KAAKtE,IAAMpB,EAAEogB,UAAWC,EAAUF,GAElCza,KAAK4a,SAAW,GAChB5a,KAAKmT,WAAa7Y,EAAE0F,KAAKtE,IAAI0Y,WAC7BpU,KAAK6a,WAAavgB,EAAE0F,KAAKtE,IAAIof,WAC7B9a,KAAKoE,IAAM,GACXpE,KAAK+a,YAAa,EAClB/a,KAAKsU,YA5BZ,GAAIqG,IACO9b,MACIsV,aAAa,EACb6G,QAAS,GACTnM,SAAU,GACV9C,IAAK,GACLX,QAAS,GACTrH,KAAM,GACNkX,KAAM,GACN5G,IAAK,GACLE,IAAK,IAETH,UAAW,cACX0G,UAAW,cAEXI,YAAa,YACbxU,KAAM,aACNyU,OAAQ,aAcnBX,GAAQY,WAEDhe,KAAM,WAEF,GAAImD,GAAOP,KAEPqb,EAAY9a,EAAK7E,IAAImD,IAiBzB,IAhBA0B,EAAK6D,IAAM,GAAIkX,MAAKC,IAAIhb,EAAK7E,IAAIwf,aAEjC3a,EAAK6D,IAAIoX,WAAW,GAAIF,MAAKG,mBAC7Blb,EAAK6D,IAAIsX,wBACTnb,EAAKqa,UACD,6BACI,OAASS,EAAUxM,SAAW,QAC9B,OACI,sBAAwBwM,EAAUtP,IAAM,OACxC,sBAAwBsP,EAAUjQ,QAAU,OAChD,QACJ,SACFrC,KAAK,IAEPxI,IAAM8a,EAAUlH,aAAgBkH,EAAUhH,KAAQgH,EAAU9G,IAAiB,OAAX,UAAqB,OAAO8G,GAE3F9a,EAAK4S,WAAW,GACnB,CACI,GAAIwI,GAAWpb,EAAK4S,WAAWrX,KAAK,gBAChC8f,EAAarb,EAAK4S,WAAWrX,KAAK,mBAClCwb,EAAehd,EAAEogB,UAAWna,EAAK7E,IAAImD,KACzC+c,GAAWjd,GAAG,QAAS,WAEnB2Y,EAAa0D,QAAU1gB,EAAE+f,KAAKsB,EAASvgB,OACvCmF,EAAKsb,UAAUvE,KAKvB,MAAOtX,OAEX8b,QAAS,SAASjd,GAEd,GAAI0B,GAAOP,IACXnB,GAAOA,GAAQ0B,EAAKA,KAAK7E,IAAImD,KAC7B0B,EAAK6D,IAAI2X,cAAc,GAAIT,MAAKU,MAAMnd,EAAKwV,IAAKxV,EAAK0V,KAAM,IAC3DhU,EAAK6D,IAAIsX,uBAET,IAAIO,GAAS,GAAIX,MAAKY,OAAO,GAAIZ,MAAKU,MAAMnd,EAAKwV,IAAKxV,EAAK0V,MAEnD4H,iBAAiB,EACjBC,aAAa,GAErBH,GAAOI,iBACP9b,EAAK6D,IAAIkY,WAAWL,GACpBA,EAAOM,eAAe,GAAIjB,MAAKkB,WAAWjc,EAAKqa,WAU/CqB,EAAOQ,iBAAiB,QAAS,WAE5BR,EAAOM,eAAe,GAAIjB,MAAKkB,WAAWjc,EAAKqa,aAEpDqB,EAAOQ,iBAAiB,UAAW,SAASvf,GAExCqD,EAAKmc,UAAUxf,EAAEyf,MAAMtI,IAAKnX,EAAEyf,MAAMpI,OAExChU,EAAKmc,UAAU7d,EAAKwV,IAAKxV,EAAK0V,MAElCsH,UAAY,SAAUhd,GAElB,GAAI0B,GAAOP,IACXnB,GAAOA,GAAQ0B,EAAK7E,IAAImD,IAIxB,IAAI+d,GAAQ,GAAItB,MAAKuB,YAAYtc,EAAK6D,KAClC0Y,eAAgB1Y,IAAK7D,EAAK6D,KAC1B2Y,aAAc,EACdC,cAAgB,SAAUC,GACtBA,EAAIhB,OAAOM,eAAe,GAAIjB,MAAKkB,WAAWjc,EAAKqa,YAGvDsC,aAAe,cAInBN,GAAMO,OAAOte,EAAKmc,SAAWnc,EAAKuM,SAAWvM,EAAKoc,MAAQpc,EAAKkF,MAE/D6Y,EAAMQ,0BAA0B,WAEzBR,EAAMS,cAAgBC,sBAElB/c,EAAKwa,YAEJ6B,EAAMO,OAAOte,EAAKoc,MAClB1a,EAAKwa,YAAa,GAGlB6B,EAAMO,OAAOte,EAAKkF,SAO9B6Y,EAAMW,sBAAsB,SAASC,GAEjC,IAAI,GAAI9M,GAAI8M,EAAKjiB,OAAQmV,KACzB,CACI,GAAIuL,GAASuB,EAAK9M,GAAGuL,MACrBA,GAAOI,iBACP9b,EAAKmc,UAAUT,EAAOU,MAAMtI,IAAK4H,EAAOU,MAAMpI,KAQ9C0H,EAAOM,eAAe,GAAIjB,MAAKkB,WAAWjc,EAAKqa,WAC/CqB,EAAOQ,iBAAiB,QAAS,WAG7B,GAAIgB,GAAMzd,KAAK0d,aACfnd,GAAKmc,UAAUe,EAAIpJ,IAAKoJ,EAAIlJ,OAEhC0H,EAAOQ,iBAAiB,UAAW,SAASvf,GAExCqD,EAAKmc,UAAUxf,EAAEyf,MAAMtI,IAAKnX,EAAEyf,MAAMpI,WAYpDmI,UAAW,SAAUrI,EAAKE,GAEtB,GAAIhU,GAAOP,IACXO,GAAK+T,UAAaD,IAAKA,EAAKE,IAAKA,GACjChU,EAAKsa,WAAW,IAAMta,EAAKsa,WAAW9V,KAAK,UAAYsP,EAAM,WAAaE,KAGlFha,GAAGC,GAAG,gBACNyB,QAAQ2G,KAAKwB,IAAM,SAASqW,GAExB,MAAO,IAAID,GAAQC,GAASrd,SAElCoC,QAOD,aAEEA,OAAQC,QAAS,SAAWnF,GAC9BC,GAAGC,GAAG,gBAQHyB,QAAQ2G,KAAKgT,mBAAqB,SAAST,EAAUxZ,EAAWR,GAE5D,GAAIqC,GAAa7B,GAAarB,EAAE,uCAC5Bub,EAAgBvb,EAAE,kDACrBa,GAAY0a,EAAcK,SAAS1Y,EAEpC,IAAImgB,GAAK,SAAUxI,GAEf,GAAIyI,IACI/O,SAAUsG,EAAStG,SACnBgP,QAAS5hB,QAAQqP,OAAOwS,WAAW3I,EAAS3N,QAC5CuW,aAAc9hB,QAAQmD,UAAUC,WAAW,QAC3C6M,QAA4B,GAAnBiJ,EAASnN,OAAc,UAAY,IAGhDiO,EAAMzS,WAAWC,QAAQxH,QAAQyH,OAAOvB,IAAI,sBAEhD0T,GAAcpQ,OAAOnL,EAAE2b,EAAI2H,KAAW9hB,KAAK,SAASwQ,iBAChDE,QAAU,UACVE,OAAS,MACTC,QAAU,QACXhO,GAAG,+BAAgC,SAAUzB,EAAG0P,GAE/C,GAAIC,GAAUvS,EAAE0F,KAChB/D,SAAQC,OAAOmM,kBAAkBb,OAAQ2N,EAAS3N,OAAQQ,OAAQ4E,GAAQ,SAAUkD,GAEhF,MAAqB,OAAlBA,EAAI9Q,YAEH6N,EAAQP,gBAAgB,eAAe,QACvCwD,EAAIC,WAAa9T,QAAQS,GAAGC,QAAQC,IAAKkT,EAAIC,UAAWpV,KAAM,aAHlE,WASRkb,EAAc/Z,KAAK,aAAa6C,GAAG,QAAS,WAExC,GAAIqf,GAAcxa,WAAWC,QAAQxH,QAAQyH,OAAOvB,IAAI,4BACpD8b,EAAgB3jB,EAAE0jB,EAAY7I,IAE9BlC,EAAQ,GAAIhX,SAAQS,GAAGwhB,aACvB/V,GAAI,iBACJgW,MAAO,UACPpZ,KAAMkZ,EACNG,QAAS,WACTC,cAAc,IACfC,OACCC,EAAYN,EAAcniB,KAAK,iBAC/B0iB,EAAgBD,EAAUziB,KAAK,0BAC/B2iB,EAAUF,EAAUziB,KAAK,SACzB4iB,EAAOT,EAAcniB,KAAK,kBAAkB+C,KAAK,YAAY,GAAOF,GAAG,OAAQ,WAE/E,GAAIqW,GAAQ1a,EAAE0F,MACV2X,EAAIrd,EAAE+f,KAAKrF,EAAM5Z,OAAOG,MAC5ByZ,GAAMnW,KAAK,YAAY,GACnB8Y,EAEQ,EAAJA,GAASA,EAAI,GACjB8G,EAAQ5N,KAAK,qBAGb4N,EAAQ5N,KAAK,IACbmE,EAAMnW,KAAK,YAAY,IANvB4f,EAAQ5N,KAAK,SASjB,IAAI2C,GAAUwB,EAAMnW,KAAK,WACzB0f,GAAUI,YAAY,cAAenL,GAASmL,YAAY,aAAcnL,GACxEgL,EAAcG,YAAY,eAAgBnL,GAASmL,YAAY,oBAAqBnL,IAGxFyK,GAAcniB,KAAK,YAAY8iB,OAAO,WAElCF,EAAK5hB,KAAK,OAAQkD,KAAKkM,QAAU,OAAS,cAG9C+G,EAAM/U,EAAE2gB,OAAO/iB,KAAK,WAAW6C,GAAG,QAAS,WAEnC+f,EAAKjgB,QAAQ,QAAQI,KAAK,aAE9B5C,QAAQC,OAAO4iB,kBAAkBtX,OAAQ2N,EAAS3N,OAAQuX,iBAAkBL,EAAKtjB,OAAQ,SAAU0U,GAE/F,MAAqB,OAAlBA,EAAI9Q,gBAEH8Q,EAAIC,WAAa9T,QAAQS,GAAGC,QAAQC,IAAKkT,EAAIC,UAAWpV,KAAM,aAGlEsY,EAAM+L,WACN/iB,SAAQS,GAAGC,QAAQC,IAAK,aAAcjC,KAAM,mBAOxDQ,GAAYA,EAAS0a,GAGzB,OAAGvb,GAAE2kB,cAAc9J,OAEfwI,GAAGxI,OAIPlZ,SAAQC,OAAOyZ,aAAanO,OAAQ2N,GAAW,SAAUrF,GAErD,GAAqB,OAAlBA,EAAI9Q,WAGH,YADA8Q,EAAIC,WAAa9T,QAAQS,GAAGC,QAAQC,IAAKkT,EAAIC,UAAWpV,KAAM,WAGlE,IAAIwa,GAAWrF,EAAIjR,KAAKqR,QAAQ,EAChCyN,GAAGxI,MAMXlZ,QAAQ2G,KAAK6S,kBAAoB,SAAUyJ,EAAiB1X,EAAQ7L,GAEhE,GAAIwjB,IAAa,WAAY,YACzBC,EAAInjB,QAAQmD,UACZigB,EAAM/kB,EAAE,oCACRkD,EAAa7B,GAAarB,EAAE,sCAEhC,KAAIoW,EAAI,EAAGiH,EAAIwH,EAAU5jB,OAAYoc,EAAJjH,EAAOA,IACxC,CACI,GAAI4O,GAAWH,EAAUzO,GACrBJ,EAAWgP,GAAYJ,EACvB1U,EAAO8F,EAAW,eAAiB8O,EAAE/f,WAAWigB,GAAW9X,IAC3D0G,EAAQkR,EAAEG,mBAAmBD,EAEjChlB,GAAE,aAAaqkB,YAAY,SAAUrO,GAAU7K,OAAOnL,EAAE,WAAWwC,KAAK,OAAQ0N,GAAMqG,KAAK3C,IAAQgI,SAASmJ,GAGhH,MAAO/kB,GAAE,2DAA2DmL,OAAO4Z,GAAKnJ,SAAS1Y,GAGhG,IAAIgiB,GAAe,WACZ,CAAA,GAAIC,GAAQnlB,EAAE,sCACH,IAAI2B,SAAQ2G,KAAKoD,iBACjClD,gBAAiB,EACjBnH,UAAY8jB,EACZtZ,iBAAmB,GAAIlK,SAAQ2G,KAAK0M,oBACnC3T,UAAY8jB,EACZtc,MAAQ,GAAIlH,SAAQ2G,KAAK+D,eAAe3K,WAAaC,QAAQC,OAAOwjB,YACpEtZ,KAAO,GAAInK,SAAQ2G,KAAK4G,kBAK3BvN,SAAQ2G,KAAK+c,aAAeH,CAE5B,IAAII,GAAsB,SAAUrK,EAAUjX,GACvC,GAAImhB,GAAQnlB,EAAE,sCACd2B,SAAQS,GAAGmjB,YACPlkB,UAAW8jB,EACXK,UAAU,EACVC,MAAO9jB,QAAQmD,UAAU4gB,yBAEnC/jB,QAAQ2G,KAAK0S,SAASmK,EAAOlK,EAAUjX,GAExCrC,SAAQ2G,KAAKqd,gBAAkBL,CAE/B,IAAIM,GAAkB,SAAU3K,EAAUjX,GACzC,GAAImhB,GAAQnlB,EAAE,sCACd2B,SAAQS,GAAGmjB,YACDlkB,UAAW8jB,EACXK,UAAU,EACVC,MAAO9jB,QAAQmD,UAAU4gB,yBAE7B/jB,QAAQ2G,KAAKgT,mBAAmBtX,EAAQmhB,GACxCxjB,QAAQ2G,KAAK6S,kBAAkBF,EAAUjX,EAAQmhB,GACjDxjB,QAAQ2G,KAAK4T,SAASiJ,EAAOlK,EAAUjX,GAE9CrC,SAAQ2G,KAAKud,gBAAkBD,CAE/B,IAAIE,GAAiB,WACpB,GAAIX,GAAQnlB,EAAE,sCACR2B,SAAQS,GAAGmjB,YACPlkB,UAAW8jB,EACXK,UAAU,EACVC,MAAO9jB,QAAQmD,UAAU4gB,wBAE7B,IAAI/J,GAAMzS,WAAWC,QAAQxH,QAAQyH,OAAOvB,IAAI,oBAC5Cke,EAAoB/lB,EAAE2b,GAClBqK,aAAcrkB,QAAQmD,UAAUC,WAAW,cAEzDogB,GAAMha,OAAO4a,GACPpkB,QAAQ2G,KAAKoO,WAAWqP,GAG/BpkB,SAAQ2G,KAAK2d,eAAiBH,GAG5B5gB,OAAQC,QAAS,SAAWnF,GAC9BC,GAAGC,GAAG,kBACN,IAEIgmB,IAFavkB,QAAQS,GAAGiD,cACf1D,QAAQS,GAAGC,QAEvB8jB,aACC9lB,KAAO,QACPuT,MAAQ,WACRwS,WAAa,EACbC,OAAS,IACTC,OAAS,IACTnG,QAAUxe,QAAQuR,QAAQqT,wBAC1BC,UACC9lB,YACCC,UACCC,QAAU,mBAKd6lB,YACCpmB,KAAO,QACPuT,MAAQ,WACRwS,WAAa,EACbjG,QAAUxe,QAAQuR,QAAQqT,wBAC1BC,UACC9lB,YACCC,UACCC,QAAU,mBAKd8lB,WACCrmB,KAAO,OACPuT,MAAQ,SACRyS,OAAS,IACTC,OAAS,IACTF,WAAa,EACbI,UACC9lB,YACCC,UACCC,QAAU,cAEX+W,SACC/W,QAAS,eAEV+lB,aACCC,WAAY,EACZ3Q,MAAQ,EACRrV,QAAU,qBAKdimB,eACCxmB,KAAO,OACPuT,MAAQ,MACRyS,OAAS,IACTC,OAAS,IACTF,WAAa,EACbI,UACC9lB,YACCiX,SACC/W,QAAS,YAEV+lB,aACCC,WAAY,EACZ3Q,MAAQ,EACRrV,QAAU,kBAKdkmB,mBACCzmB,KAAO,OACPuT,MAAQ,WACRyS,OAAS,IACTC,OAAS,IACTF,WAAa,EACbI,UACC9lB,YACCiX,SACC/W,QAAS,iBAEV+lB,aACCC,WAAY,EACZ3Q,MAAQ,EACRrV,QAAU,uBAKdmmB,aACC1mB,KAAO,QACPuT,MAAQ,QACRwS,WAAa,EACbjG,QAAUxe,QAAQuR,QAAQ8T,mBAC1BR,UACC9lB,YACCC,UACCC,QAAU,gBAKdqmB,UACC5mB,KAAO,OACPuT,MAAQ,SACR0S,OAAS,IACTF,WAAa,GACbI,UACC9lB,YACCC,UACCC,QAAU,cAEXsmB,QACCtmB,QAAS,eAEV+lB,aACCC,WAAY,EACZ3Q,MAAQ,EACRrV,QAAU,qBAKdumB,gBACC9mB,KAAO,UACPuT,MAAQ,OACR7S,KACCV,KAAO,aACPimB,OAAS,iDACTF,WAAa,GACbI,UACCY,MAAQ,aACR1mB,YACCC,UACCC,QAAU,eAKdI,KACCX,KAAO,aACPimB,OAAS,iDACTF,WAAa,GACbI,UACCY,MAAQ,aACR1mB,YACCC,UACCC,QAAU,gBAMfymB,kBACChnB,KAAO,QACPuT,MAAQ,OACRwS,WAAa,EACbjG,QAAUxe,QAAQuR,QAAQqT,sBAAsB,IAChDC,UACC9lB,YACCC,UACCC,QAAU,YAEX+W,SACC/W,QAAS,aAEV+lB,aACCC,WAAY,EACZ3Q,MAAQ,EACRrV,QAAU,mBAKd0mB,kBACCjnB,KAAO,OACPuT,MAAQ,SACRwS,WAAa,GACbI,UACC9lB,YACC8W,cACCxW,IAAM,GACNJ,QAAU,qBAKd2mB,uBACClnB,KAAO,OACPuT,MAAQ,OACRwS,WAAa,OACbI,aAEDgB,sBACCnnB,KAAO,OACPuT,MAAQ,WACR0S,OAAS,KACTF,WAAa,GACbI,UACC9lB,YACCC,UACCC,QAAU,gBAEX+W,SACC/W,QAAS,iBAEV+lB,aACCC,WAAY,EACZ3Q,MAAQ,EACRrV,QAAU,uBAKd6mB,eACCpnB,KAAO,OACPuT,MAAQ,OACR0S,OAAS,KACTF,WAAa,GACbI,UACC9lB,YACCC,UACCC,QAAU,YAEX+W,SACC/W,QAAS,aAEV+lB,aACCC,WAAY,EACZ3Q,MAAQ,EACRrV,QAAU,mBAKd8mB,mBACCrnB,KAAO,OACPuT,MAAQ,SACRwS,WAAa,GACbI,UACC9lB,YACC8W,cACCxW,IAAM,IACNJ,QAAU,sBAKd+mB,qBACCtnB,KAAO,SACP+lB,WAAa,IAEdwB,oBACCvnB,KAAO,SACP+lB,WAAa,IAEdyB,WACCxnB,KAAO,QACPuT,MAAQ,SACRwS,WAAa,EACbjG,QAAUxe,QAAQuR,QAAQ4U,iBAC1BtB,UACC9lB,YACCC,UACCC,QAAU,iBAKdmnB,oBACC1nB,KAAO,WACPuT,MAAQ,UACRwS,WAAa,EACb4B,QAAU,KACVC,SAAW,MACXzB,UACC9lB,gBAKFwnB,gBACC7nB,KAAO,WACPuT,MAAQ,OACRwS,WAAa,EACb4B,QAAU,KACVC,SAAW,MACXzB,UACC9lB,gBAKFynB,yBACC9nB,KAAO,WACPuT,MAAQ,UACRwS,WAAa,EACb4B,QAAU,KACVC,SAAW,MACXzB,UACC9lB,gBAIF0nB,iBACC/nB,KAAO,QACPuT,MAAQ,SACRwS,WAAa,EACbjG,QAAUxe,QAAQuR,QAAQmV,uBAC1B7B,UACC9lB,YACCC,UACCC,QAAU,iBAKd0nB,iBACCjoB,KAAO,WACPuT,MAAQ,WACRwS,WAAa,EACb4B,QAAU,KACVC,SAAW,MACXzB,UACC9lB,gBAKF6nB,eACCloB,KAAO,QACPuT,MAAQ,OACRwS,WAAa,EACbjG,QAAUxe,QAAQuR,QAAQsV,qBAC1BhC,UACC9lB,YACCC,UACCC,QAAU,iBAOX6nB,EAAmB,GAAIxoB,IAAGmG,YAC9BxC,GAAEC,KAAKqiB,EAAmB,SAAU1X,EAAI5B,GACvC,GAAIvM,GAAOiB,IAAIkN,EAAI,QACfka,EAAW,wCACf,IAAY,WAARroB,EAAmB,CACtB,GAAIwN,GAAK8a,MAAQ/b,EAAI,QAAU3M,GAAG4N,KAAM+a,EAAQhc,EAAI,QAAU3M,GAAG4N,KAChEgb,EAAUjc,EAAI,OAAQkc,EAAUlc,EAAI,OACpC7L,EAAMd,GAAG+G,QAAQ1F,IAAIkN,EAAI,WACxBX,GAAK8a,MAAOvoB,KAAOyoB,EAAStoB,IAAM,aAC/BS,EAAMf,GAAG+G,QAAQ1F,IAAIkN,EAAI,WAC5BX,GAAK+a,EAAOxoB,KAAO0oB,EAASvoB,IAAM,YAEpCkoB,GAAiB1hB,SAAS6F,EAAG3M,GAAG+G,QAAQwH,GACvCX,GAAKA,EACL6a,SAAWA,EACX3nB,IAAMA,EACNC,IAAMA,SAGPynB,GAAiB1hB,SAAS6F,EAAG3M,GAAG+G,QAAQwH,GACvCX,GAAKjB,EAAI,IAAM3M,GAAG4N,KAClBzN,KAAOwM,EACP8b,SAAWA,EACXnoB,IAAM,eAKT,IAAIsU,GAAkBtP,OAAOC,UAU5BC,YAAc,SAAUrE,GAOvB,GANAsE,KAAKqjB,SAAWznB,IAAIF,EAAK,aACzBsE,KAAKoJ,UAAYxN,IAAIF,EAAK,YAAa,MACvCsE,KAAKqP,YAAczT,IAAIF,EAAK,cAAe,MAC3CsE,KAAKmD,MAAQvH,IAAIF,EAAK,QAAS,MAC/BsE,KAAKsjB,YAAcrnB,QAAQuR,QAAQC,aACnCzN,KAAKiT,MAAQ,MACRjT,KAAKoJ,YAAcpJ,KAAKqP,cAAgBrP,KAAKmD,MACjD,KAAK,2BAKN,IAHAnD,KAAKkD,gBACLlD,KAAKujB,YAAcvjB,KAAKwjB,eAAe,KAAMxjB,KAAKoJ,WAClDpJ,KAAKhE,WAAaJ,IAAIoE,KAAKujB,YAAa,aAAc,IAClDhpB,GAAGkpB,KAAKzjB,KAAKhE,YAChBgE,KAAKhE,WAAagE,KAAKhE,eACjB,CAAA,IAAKzB,GAAG0H,SAASjC,KAAKhE,YAC5B,KAAM,uDAAyDgE,KAAKhE,UAE1DzB,IAAGmpB,UAAU1jB,KAAKhE,cAC5BgE,KAAKhE,WAAazB,GAAGopB,MAAM3jB,KAAKhE,aAEjCgE,KAAK4jB,WAAahoB,IAAIoE,KAAKmD,MAAMhB,IAAI,gBAAiBnC,KAAKoJ,WAC3DpJ,KAAK6jB,YACL7jB,KAAK8jB,aACL9jB,KAAKhD,YACLgD,KAAKqD,KAAK,UAGZ8L,GAAgB7O,OACf4C,cAAgB,WACf,GAAI2G,GAAYrG,WAAWC,QAAQxH,QAAQyH,OAAOvB,IAAI,iCACrD4hB,EAASvgB,WAAWC,QAAQxH,QAAQyH,OAAOvB,IAAI,uBAChDqB,YAAWwgB,eAAe,uBAAwB,SAAUC,EAAaxJ,GACxE,MAAQwJ,IAAexJ,EAAQyJ,KAAKvpB,KAAQ8f,EAAQkD,GAAG3d,MAAQya,EAAQ0J,QAAQnkB,QAEhFwD,WAAWwgB,eAAe,eAAgB,SAAUrD,EAAQC,EAAQnG,GACnE,MAASkG,IAAWC,EAAkCnG,EAAQkD,GAAG3d,MAAnCya,EAAQ0J,QAAQnkB,QAE/CA,KAAKyB,KACJoI,UAAYA,EACZka,OAASA,KAGXF,UAAY,WACX,GAAItjB,GAAOP,IACXO,GAAK0S,MAAQ,GAAIhX,SAAQS,GAAGwhB,aAC3B/V,GAAK,eACLtN,IAAM,gBACNsjB,MAAQ5d,EAAK6jB,gBACbC,YAAc,gBAKhBhY,aAAe,SAAU9B,GACxB,GAAIhK,GAAOP,IACXO,GAAK0S,MAAM/U,EAAEomB,KAAKxoB,KAAKyO,GAAUpM,KAAK,WACrC,GAAIomB,GAAMjqB,EAAE0F,MACXsiB,EAAUiC,EAAIznB,KAAK,gBACnBylB,EAAWgC,EAAIznB,KAAK,gBACrBynB,GAAIjY,iBACHC,KAAO,SACPC,QAAU,UACVC,SAAW,UACXC,OAAS4V,EACT3V,QAAU4V,OAIbiC,eAAiB,SAAUja,GAC1B,GAAIhK,GAAOP,IACXO,GAAK0S,MAAM/U,EAAEomB,KAAKxoB,KAAKyO,GAAUkH,YAChCC,WAAa,GACb+S,aAAc,EACd9S,cAAgB,EAChBC,cAAe,EACfC,YAAa,KAGf2R,eAAiB,SAAU1oB,EAAKM,GAC/B,GAAImF,GAAOP,KACPkS,EAAgB3R,EAAK4C,MAAMhB,IAAI,iBAC/BuiB,EAAWnqB,GAAG+G,WAAYpD,EAAEpC,KAAKkE,KAAKsjB,YAAa,SAAUrc,GAAI,MAAOA,GAAEnM,IAAQM,IAMtF,OALKb,IAAGyH,QAAQpG,IAAI8oB,EAAU,oBAC7BA,EAAWnqB,GAAG+G,QAAQojB,GACrBC,SAAW/oB,IAAI8oB,EAAU,iBAAmBxS,MAGvCwS,GAERN,cAAgB,WACf,MAAOxoB,KAAIoE,KAAKujB,YAAa,SAAW,MAEzCvmB,UAAY,WACX,GAAIuD,GAAOP,KACPpC,EAAS2C,EAAKvC,oBAClBgC,MAAKrB,IACJ2f,KAAO,WACNte,KAAKiT,MAAMqL,QAEZU,KAAO,WACNhf,KAAKiT,MAAM+L,UAGbze,EAAK0S,MAAM/U,EAAE0mB,OAAO9oB,KAAK,QAAQ6C,GAAG,QAAS,WAC5C,GAAI+G,GAAOpL,EAAE0F,MACZ6kB,EAAMnf,EAAK5I,KAAK,OACjB,IAAW,UAAP+nB,EACHtkB,EAAK8C,KAAK,YACJ,CACN,GAAI/D,GAAKiB,EAAK0S,MAAM/U,EAAEomB,KAAKxoB,KAAK,QAAQ+C,KAAK,qBAC7C6G,GAAKof,OAAO,UACZxlB,EAAGC,cAGLgB,EAAK0S,MAAM/U,EAAEomB,KAAKxoB,KAAK,QAAQ0C,oBAC9BC,QAAU,OACVC,OAASd,IACPe,GAAG,iBAAkB,SAAUzB,GACjC,CAAA,GAAI0B,GAAQtE,EAAE4C,EAAEC,OACVyB,GAAMC,KAAK,yBACfF,GAAG,kBAAmB,SAAUzB,GAClCA,EAAE4B,gBACF,IAAIF,GAAQtE,EAAE4C,EAAEC,QAEZymB,GADEhlB,EAAMC,KAAK,sBACA0B,EAAKwkB,gBACtBtnB,SAAQsB,KAAK6kB,GACbrjB,EAAK4C,MAAME,KAAK,oBACfrH,WAAauE,EAAKvE,WAClBsC,OAASslB,EACTxa,UAAY7I,EAAK6I,UACjBnB,OAAS,WACR1H,EAAK0S,MAAM/U,EAAE2gB,OAAO/iB,KAAK,qBAAqBgpB,OAAO,UAEtDzb,UAAY,WACX9I,EAAK0S,MAAM/U,EAAE2gB,OAAO/iB,KAAK,qBAAqBgpB,OAAO,SACrDvkB,EAAK8C,KAAK,cAKd2hB,cAAgB,SAAUha,GACzB,MAAgB,IAAZA,EAAEzP,OAAoB,GACnByP,EAAEia,OAAO,EAAE,GAAK,IAAMja,EAAEia,OAAO,IAEvCC,cAAgB,SAAU7pB,EAAKC,GAC9B,OAAQD,EAAM,IAAMC,GAAKwV,QAAQ,MAAO,KAGzCqU,sBAAwB,WACvB,GAAI5kB,GAAOP,KACV2kB,EAAW/oB,IAAI2E,EAAKgjB,YAAa,WAAY,IAAI1a,MAAM,KACvDuc,EAAUlnB,EAAEkG,IAAIugB,EAAU,SAAU7pB,GACnC,GAAIuqB,GAAQtC,EAAiB5gB,IAAIrH,GAChCH,EAAOiB,IAAIypB,EAAO,OACnB,IAAY,WAAR1qB,GAA4B,kBAAPG,EAAyB,CACjD,GAAImM,GAAIrL,IAAI2E,EAAKqjB,WAAY9oB,EAAK,IAAI+N,MAAM,IAI5C,OAHA5B,GAAI/I,EAAEkG,IAAI6C,EAAG,SAAU+D,GACtB,MAAOzK,GAAKykB,cAAcha,KAEpBzQ,GAAG+G,QAAQ+jB,GACjBhqB,IAAMd,GAAG+G,QAAQ1F,IAAIypB,EAAO,QAC3B9U,MAAQtJ,EAAE,IAAMrL,IAAIypB,EAAO,oBAE5B/pB,IAAMf,GAAG+G,QAAQ1F,IAAIypB,EAAO,QAC3B9U,MAAQtJ,EAAE,IAAMrL,IAAIypB,EAAO,sBAGvB,GAAY,SAAR1qB,EAAiB,CAC3B,GAAIsM,GAAIrL,IAAI2E,EAAKqjB,WAAY9oB,EAAKc,IAAIypB,EAAO,eAC5C5K,EAAUvc,EAAEkG,IAAIxI,IAAIypB,EAAO,WAAY,SAAUC,GAChD,MAAO/qB,IAAG+G,QAAQgkB,GACjBC,SAAW3pB,IAAI0pB,EAAI,UAAYre,EAAI,WAAa,MAGnD,OAAO1M,IAAG+G,QAAQ+jB,GACjB9U,MAAQ3U,IAAI2E,EAAKqjB,WAAY9oB,EAAKc,IAAIypB,EAAO,eAC7C5K,QAAUA,IAEL,MAAY,YAAR9f,EACHJ,GAAG+G,QAAQ+jB,GACjBnZ,QAAUtQ,IAAI2E,EAAKqjB,WAAY9oB,IAAQc,IAAIypB,EAAO,cAAgB,UAAY,KAGxE9qB,GAAG+G,QAAQ+jB,GACjB9U,MAAQ3U,IAAI2E,EAAKqjB,WAAY9oB,EAAKc,IAAIypB,EAAO,kBAKjD,OADA5nB,SAAQsB,KAAKqmB,GACNA,GAGRtB,WAAa,WACZ,GAAIvjB,GAAOP,KAEV8E,GADSvE,EAAKvC,qBACDuC,EAAK4kB,yBAClBlP,EAAM1V,EAAK4B,IAAI,aACf4hB,EAASxjB,EAAK4B,IAAI,UAClB2H,EAAMmM,GACLuP,QAAU,oBACVrhB,MAAQW,GAEVvE,GAAK0S,MAAM/U,EAAEomB,KAAKvf,KAAK+E,GACvBvJ,EAAK0S,MAAM/U,EAAE2gB,OAAO9Z,KAAKgf,GACxB0B,OACE5qB,IAAM,cAAeH,KAAO,SAAUwT,MAAQ,OAC9CrT,IAAM,cAAeH,KAAO,SAAUwT,MAAQ,UAIjD3N,EAAK8L,aAAa,iCAClB9L,EAAKikB,eAAe,2BAIrBO,cAAgB,WACf,CAAA,GAAIxkB,GAAOP,KACV2kB,EAAW/oB,IAAI2E,EAAKgjB,YAAa,WAAY,IAAI1a,MAAM,KACvD5K,IACUC,GAAEkG,IAAIugB,EAAU,SAAU7pB,GACnC,GAAIuqB,GAAQtC,EAAiB5gB,IAAIrH,GAChCH,EAAOiB,IAAIypB,EAAO,OACnB,IAAY,WAAR1qB,GAA4B,kBAAPG,EAAyB,CACjD,GAAIO,GAAMf,EAAE,SAAWQ,EAAM,SAASM,MACrCE,EAAMhB,EAAE,SAAWQ,EAAM,SAASM,KACnC6C,GAAInD,GAAOyF,EAAK2kB,cAAc7pB,EAAKC,OAGnC2C,GAAInD,GAFc,YAARH,EAEEL,EAAE,SAAWQ,EAAM,KAAK+D,KAAK,mBAAmB4b,QAAQ7N,MAAY,EAAJ,EAEjEtS,EAAE,SAAWQ,EAAM,KAAKM,QAGtC,MAAO6C,IAGRD,mBAAqB,WACpB,GAAIuC,GAAOP,KACV2kB,EAAW/oB,IAAI2E,EAAKgjB,YAAa,WAAY,IAAI1a,MAAM,KACvD5K,IAYD,OAXAC,GAAEC,KAAKwmB,EAAU,SAAU7pB,GAC1B,GAAIuqB,GAAQtC,EAAiB5gB,IAAIrH,GAChCH,EAAOiB,IAAIypB,EAAO,OACnB,IAAY,WAAR1qB,EAAmB,CACtB,GAAIU,GAAMP,EAAM,OAAQQ,EAAMR,EAAM,MACpCmD,GAAI5C,GAAOO,IAAIypB,EAAO,mBACtBpnB,EAAI3C,GAAOM,IAAIypB,EAAO,uBAEtBpnB,GAAInD,GAAOc,IAAIypB,EAAO,iBAGjBpnB,KAGThC,QAAQiT,QAAQC,gBAAkBA,GAChC3P,OAAQC,QAAS,SAAWnF,GAC9BC,GAAGC,GAAG,kBACN,IAAIkrB,GAAc,WACjB,CAAA,GAAIjG,GAAQnlB,EAAE,sCACG,IAAI2B,SAAQ2G,KAAKoD,iBACjClD,gBAAiB,EACjBnH,UAAY8jB,EACZtZ,iBAAmB,GAAIlK,SAAQ2G,KAAK0M,oBACnC3T,UAAY8jB,EACZtc,MAAQ,GAAIlH,SAAQ2G,KAAK+D,eAAe3K,WAAaC,QAAQC,OAAOwjB,YACpEtZ,KAAO,GAAInK,SAAQ2G,KAAKsK,kBAI3BjR,SAAQiT,QAAQyW,YAAcD,GAC5BlmB,OAAQC,QAAS,WACnBlF,GAAGC,GAAG,kBACN,IACIkF,IADazD,QAAQS,GAAGiD,cACf1D,QAAQS,GAAGC,QACpBgK,EAAgB1K,QAAQ2G,KAAK+D,cAC7Bif,EAAmBjf,EAAc7G,UACpCC,YAAc4G,EAAcyU,UAAUrb,aAEvC6lB,GAAiBtlB,OAChBlD,KAAO,SAAUkB,GAChB0B,KAAKyB,KACJmF,UAAY,EACZC,UAAY,EACZL,OAAS5K,IAAI0C,EAAQ,SAAU,GAC/BmI,SAAW7K,IAAI0C,EAAQ,WAAY,IACnCunB,qBAAuBjqB,IAAI0C,EAAQ,uBAAwB,IAC3DwnB,mBAAqBlqB,IAAI0C,EAAQ,qBAAsB,IACvDynB,aAAenqB,IAAI0C,EAAQ,eAAgB,IAC3C0nB,YAAcpqB,IAAI0C,EAAQ,cAAe,IACzC2nB,UAAYrqB,IAAI0C,EAAQ,YAAa,IACrC4nB,QAAUtqB,IAAI0C,EAAQ,UAAW,IACjC6nB,eAAiBvqB,IAAI0C,EAAQ,iBAAkB,IAC/C8nB,eAAiBxqB,IAAI0C,EAAQ,iBAAkB,IAC/C+nB,WAAa,GAAI9rB,IAAGmG,aACpBoG,QAAU,GAAIvM,IAAGmG,gBAGnBqG,kBAAoB,SAAUzI,GAC7B,GAAIiC,GAAOP,KACPgH,EAAiB,sJACrB9I,GAAEC,KAAKG,EAAQ,SAAU2I,EAAGC,GACvBF,EAAeG,QAAQD,GAAK,IAC/B3G,EAAKkB,IAAIyF,EAAGD,MAIfG,eAAiB,WAehB,OACCZ,OAASxG,KAAKmC,IAAI,UAClBsE,SAAWzG,KAAKmC,IAAI,YACpB4jB,aAAe/lB,KAAKmC,IAAI,gBACxB0jB,qBAAuB7lB,KAAKmC,IAAI,wBAChC2jB,mBAAqB9lB,KAAKmC,IAAI,sBAC9B6jB,YAAchmB,KAAKmC,IAAI,eACvB8jB,UAAYjmB,KAAKmC,IAAI,aACrB+jB,QAAUlmB,KAAKmC,IAAI,WACnBgkB,eAAiBnmB,KAAKmC,IAAI,kBAC1BikB,eAAiBpmB,KAAKmC,IAAI,oBAG5BkF,gBAAkB,SAAUxI,EAAM2H,GACjC,GAAIjG,GAAOP,KACVsmB,EAAY/lB,EAAK4B,IAAI,cACrBmF,EAAS/G,EAAK4B,IAAI,WACfokB,EAAaroB,EAAEkG,IAAIvF,EAAM,SAAU2nB,GACtC,GAAIT,GAAenqB,IAAI4qB,EAAS,gBAC/BC,EAAW,GAAIC,GAAiBF,EAEjC,OADAF,GAAUjlB,SAAS0kB,EAAcU,GAC1BV,GAERze,GAAOjG,SAASmF,EAAQ+f,IAEzB5e,eAAiB,WAChB,GAAIpH,GAAOP,KACVsmB,EAAY/lB,EAAK4B,IAAI,cACrBmF,EAAS/G,EAAK4B,IAAI,UACnBmkB,GAAU1e,QACVN,EAAOM,SAERlB,KAAO,SAAUpI,EAAQ/B,GACxB,GAAIgE,GAAOP,IACXO,GAAKwG,kBAAkBzI,GACvBiC,EAAKvE,WAAWuE,EAAK6G,iBAAkB,SAAU5K,GAC1B,OAAlBA,EAAIwC,YACPuB,EAAK8G,gBAAgBzL,IAAIY,EAAK,mBAAqBZ,IAAIY,EAAK,qBAC5D+D,EAAKwG,kBAAkBxM,GAAG+G,QAAQ1F,IAAIY,EAAK,WAAaZ,IAAIY,EAAK,mBAEjEkD,GACC9C,IAAMhB,IAAIY,EAAK,YAAa,IAC5B7B,KAAO,WAGT4B,EAAKgE,MAGPomB,YAAc,SAAUngB,GACvB,GAAIjG,GAAOP,KACVsmB,EAAY/lB,EAAK4B,IAAI,cACrBmF,EAAS/G,EAAK4B,IAAI,WACflE,EAAMC,EAAEkG,IAAIkiB,EAAUze,UAAUP,EAAOnF,IAAIqE,IAAU,SAAUigB,GAClE,MAAOA,GAASlkB,UAIjB,OAFA9E,SAAQsB,KAAK,cACbtB,QAAQsB,KAAKd,GACNA,GAER2oB,oBAAsB,SAAUC,GAC/B,GAAItmB,GAAOP,KACVsmB,EAAY/lB,EAAK4B,IAAI,aACtB,OAAOmkB,GAAUnkB,IAAI0kB,MAKvB5qB,QAAQ6qB,QAAQlB,iBAAmBA,CAEnC,IAAIc,GAAmB7mB,OAAOC,UAC7BC,YAAc,SAAUymB,IACtBjsB,GAAGyH,QAAQwkB,IAAYxmB,KAAKyB,IAAI+kB,GACjCxmB,KAAKhD,cAGP0pB,GAAiBpmB,OAChBtD,UAAY,WACX,GAAIuD,GAAOP,IACXO,GAAK5B,IACJ+H,KAAS,SAAUpI,GAClB,GAAIynB,GAAenqB,IAAI0C,EAAQ,gBAC9B/B,EAAOkM,IAAInK,EAAQ,QAChBtC,EAAaC,QAAQC,OAAO6qB,aAC/Bb,EAAUtqB,IAAIK,QAAQ+qB,iBAAkB,UAAW,GACpDhrB,IACC+pB,aAAeA,EACfG,QAAUA,GACR,SAAU1pB,GACZ,GAAI0T,GAAUtU,IAAIY,EAAK,kBACvB,IAAsB,GAAlB0T,EAAQ3U,OACX,KAAM,qBAAuBwqB,EAAe,WAG7CxlB,GAAKkB,IAAIyO,EAAQ,IACjB3T,OAIF0qB,aAAiB,SAAUvrB,GAC1B,GAAIM,GAAaC,QAAQC,OAAO+qB,aAC/B3oB,EAAS1C,IAAIF,EAAK,aAClBqqB,EAAexlB,EAAK4B,IAAI,gBACxB8F,EAASQ,IAAI/M,EAAK,UAClB2N,EAAYZ,IAAI/M,EAAK,YACtBM,GAAWzB,GAAG+G,QAAQhD,GACrBynB,aAAeA,IACZ,SAAUvpB,GACb,GAAuB,QAAnBA,EAAIwC,WACPU,GACC9C,IAAMhB,IAAIY,EAAK,YAAa,IAC5B7B,KAAO,WAERsN,QACM,CACN,GAAIif,GAActrB,IAAI0C,EAAQ,cAAe,GAC5C6oB,EAAgB5mB,EAAK4B,IAAI,kBAAoB,EAC7CilB,EAAmBnrB,QAAQqP,OAAO4M,KAAKmP,IAAIF,EAAgBD,EAC5D3mB,GAAKkB,IAAI,gBAAiB2lB,GAE1B/d,IACA3J,GACC9C,IAAM,QACNjC,KAAO,gBAMX2sB,SAAW,SAAU5rB,GACpB,GAAIM,GAAaC,QAAQC,OAAOqrB,cAC/BxB,EAAexlB,EAAK4B,IAAI,gBACxB+jB,EAAUtqB,IAAIK,QAAQ+qB,iBAAkB,UAAW,IACnD/e,EAASQ,IAAI/M,EAAK,UAClB2N,EAAYZ,IAAI/M,EAAK,YACtBM,IACC+pB,aAAeA,EACfG,QAAUA,GACR,SAAU1pB,GACW,QAAnBA,EAAIwC,YACPU,GACC9C,IAAMhB,IAAIY,EAAK,YAAa,IAC5B7B,KAAO,WAERsN,EAAO8d,KAEPrmB,GACC9C,IAAM,QACNjC,KAAO,YAGR0O,EAAU0c,OAKbyB,KAAS,SAAU9rB,GAClB,GAAIM,GAAaC,QAAQC,OAAOurB,YAC/B1B,EAAexlB,EAAK4B,IAAI,gBACxB+jB,EAAUtqB,IAAIK,QAAQ+qB,iBAAkB,UAAW,IACnD/e,EAASQ,IAAI/M,EAAK,UAClB2N,EAAYZ,IAAI/M,EAAK,YACtBM,GAAWzB,GAAG+G,QAAQ1F,IAAIF,EAAK,cAC9BwqB,QAAUA,EACVH,aAAeA,IACZ,SAAUvpB,GACU,QAAnBA,EAAIwC,YACPU,GACC9C,IAAMhB,IAAIY,EAAK,YAAa,IAC5B7B,KAAO,WAERsN,EAAO8d,KAEPrmB,GACC9C,IAAM,QACNjC,KAAO,YAGR4F,EAAKkB,IAAI7F,IAAIF,EAAK,cAClB2N,EAAU0c,OAKb2B,IAAQ,SAAUhsB,GACjB,GAAIM,GAAaC,QAAQC,OAAOyrB,WAC/BzB,EAAUtqB,IAAIK,QAAQ+qB,iBAAkB,UAAW,IACnD/e,EAASQ,IAAI/M,EAAK,UAClB2N,EAAYZ,IAAI/M,EAAK,YACtBM,GAAWzB,GAAG+G,QAAQ1F,IAAIF,EAAK,cAC9BwqB,QAAUA,IACP,SAAU1pB,GACU,QAAnBA,EAAIwC,YACPU,GACC9C,IAAMhB,IAAIY,EAAK,YAAa,IAC5B7B,KAAO,WAERsN,MAEAvI,GACC9C,IAAM,QACNjC,KAAO,YAGR4F,EAAKkB,IAAI7F,IAAIF,EAAK,cAClB2N,aAQNpN,QAAQ6qB,QAAQJ,iBAAmBA,CAEnC,IAAIkB,GAAwBhC,EAAiB9lB,UAC5CC,YAAc,WACbC,KAAKhE,WAAaC,QAAQC,OAAO2rB,0BAGnCD,GAAsBtnB,OACrBlD,KAAO,SAAUkB,GAChB0B,KAAKyB,KACJmF,UAAY,EACZC,UAAY,EACZL,OAAS5K,IAAI0C,EAAQ,SAAU,GAC/BmI,SAAW7K,IAAI0C,EAAQ,WAAY,IACnCunB,qBAAuBjqB,IAAI0C,EAAQ,uBAAwB,IAC3DwnB,mBAAqBlqB,IAAI0C,EAAQ,qBAAsB,IACvDynB,aAAenqB,IAAI0C,EAAQ,eAAgB,IAC3C0nB,YAAcpqB,IAAI0C,EAAQ,cAAe,IACzC2nB,UAAYrqB,IAAI0C,EAAQ,YAAa,IACrC4nB,QAAUtqB,IAAI0C,EAAQ,UAAW,IACjC6nB,eAAiBvqB,IAAI0C,EAAQ,iBAAkB,IAC/C8nB,eAAiBxqB,IAAI0C,EAAQ,iBAAkB,IAC/CwpB,SAAW,GAAIvtB,IAAGmG,aAClBoG,QAAU,GAAIvM,IAAGmG,gBAGnB2G,gBAAkB,SAAUxI,EAAM2H,GACjC,GAAIjG,GAAOP,KACV+nB,EAAUxnB,EAAK4B,IAAI,YACnBmF,EAAS/G,EAAK4B,IAAI,WACf6lB,EAAW9pB,EAAEkG,IAAIvF,EAAM,SAAUopB,GACpC,GAAIC,GAAUtsB,IAAIqsB,EAAO,kBACxBE,EAAS,GAAIC,GAAqBH,EAEnC,OADAF,GAAQ1mB,SAAS6mB,EAASC,GACnBD,GAER5gB,GAAOjG,SAASmF,EAAQwhB,IAEzBrgB,eAAiB,WAChB,GAAIpH,GAAOP,KACV+nB,EAAUxnB,EAAK4B,IAAI,YACnBmF,EAAS/G,EAAK4B,IAAI,UACnB4lB,GAAQngB,QACRN,EAAOM,SAERlB,KAAO,SAAUpI,EAAQ/B,GACxB,GAAIgE,GAAOP,IACXO,GAAKwG,kBAAkBzI,GACvBiC,EAAKvE,WAAWuE,EAAK6G,iBAAkB,SAAU5K,GAC1B,OAAlBA,EAAIwC,YACPuB,EAAK8G,gBAAgBzL,IAAIY,EAAK,mBAAqBZ,IAAIY,EAAK,qBAC5D+D,EAAKwG,kBAAkBxM,GAAG+G,QAAQ1F,IAAIY,EAAK,WAAaZ,IAAIY,EAAK,mBAEjEkD,GACC9C,IAAMhB,IAAIY,EAAK,YAAa,IAC5B7B,KAAO,WAGT4B,EAAKgE,MAGP8nB,gBAAkB,SAAU7hB,GAC3B,GAAIjG,GAAOP,KACV+nB,EAAUxnB,EAAK4B,IAAI,YACnBmF,EAAS/G,EAAK4B,IAAI,WACflE,EAAMC,EAAEkG,IAAI2jB,EAAQlgB,UAAUP,EAAOnF,IAAIqE,IAAU,SAAU2hB,GAChE,MAAOA,GAAO5lB,UAIf,OAFA9E,SAAQsB,KAAK,cACbtB,QAAQsB,KAAKd,GACNA,GAERqqB,aAAe,SAAUJ,GACxB,GAAI3nB,GAAOP,KACV+nB,EAAUxnB,EAAK4B,IAAI,WACpB,OAAO4lB,GAAQ5lB,IAAI+lB,MAIrBjsB,QAAQ6qB,QAAQc,sBAAwBA,CAExC,IAAIQ,GAAuB1B,EAAiB5mB,UAC3CC,YAAc2mB,EAAiBtL,UAAUrb,aAE1CqoB,GAAqB9nB,OACpBtD,UAAY,eAMbf,QAAQ6qB,QAAQsB,qBAAuBA,CAEvC,IAAIG,GAAwBtsB,QAAQ2G,KAAKhD,WAAWE,UACnDC,YAAc,WAEbC,KAAKC,cACLD,KAAKE,aACLF,KAAKG,aAELH,KAAKI,SAAU,EACfJ,KAAKhE,WAAaC,QAAQC,OAAOmE,qBAKnCpE,SAAQ6qB,QAAQyB,sBAAwBA,CAExC,IAAIC,GAA8BvsB,QAAQ2G,KAAK+D,cAAc7G,UAC5DC,YAAc,WACbC,KAAKyoB,SAAW,KAEhBzoB,KAAK0oB,UAAY,GAAInuB,IAAGmG,eAG1B8nB,GAA4BloB,OAC3BqoB,cAAgB,SAAU9pB,GACzB,GAAI0B,GAAOP,IACXO,GAAKkoB,SAAW5pB,EAChBX,EAAEC,KAAKoC,EAAKkoB,SAAU,SAAUpkB,GAC/B9D,EAAKmoB,UAAUrnB,SAASzF,IAAIyI,EAAM,UAAWA,MAG/CqC,KAAO,SAAUpI,EAAQ/B,GACxB,GAAIgE,GAAOP,IACXO,GAAKwG,kBAAkBzI,EACvB,IAAIkI,GAASjG,EAAK4B,IAAI,UACrBsE,EAAWlG,EAAK4B,IAAI,YACpBM,EAASlC,EAAK4B,IAAI,UAClBG,EAAS/B,EAAK4B,IAAI,UAClB2D,EAAavF,EAAK4B,IAAI,cACtB0E,EAAY,EACZ+hB,GAASpiB,EAAS,GAAKC,EACvBoiB,EAAMpiB,EAAWD,EACjBI,EAAY,EACT3C,IACJA,GAAQ3B,EAAO/G,OAAS,EAAI2C,EAAE8C,OAAOT,EAAKkoB,SAAU,SAAUK,GAC7D,MAAOltB,KAAIktB,EAAO,WAAaxmB,IAC3B/B,EAAKkoB,SACVxkB,EAAQxB,EAAOlH,OAAS,EAAI2C,EAAE8C,OAAOiD,EAAO,SAAU6kB,GACrD,MAAOltB,KAAIktB,EAAO,WAAarmB,IAC3BwB,EACLA,EAAQ6B,EAAWvK,OAAS,EAAI2C,EAAE8C,OAAOiD,EAAO,SAAU6kB,GACzD,MAAOltB,KAAIktB,EAAO,aAAehjB,IAC7B7B,EACL4C,EAAY5C,EAAM1I,OAClBqL,EAAYsR,KAAK6Q,KAAKliB,EAAYJ,GAClCxC,EAAQ/F,EAAE8C,OAAOiD,EAAO,SAAU6kB,EAAO1P,GACxC,MAAOA,IAAOwP,GAAeC,EAANzP,IAExB7Y,EAAK8G,gBAAgBpD,EAAOuC,GAC5BjG,EAAKwG,mBACJH,UAAYA,EACZC,UAAYA,EACZL,OAASA,EACTC,SAAWA,IAEZlK,EAAKgE,MAIPtE,QAAQ6qB,QAAQ0B,4BAA8BA,GAa5ChpB,OAAQC,QAAS,SAAWnF,GAC9BC,GAAGC,GAAG,kBACN,IAEIgP,IAFavN,QAAQS,GAAGiD,cACf1D,QAAQS,GAAGC,OACLV,QAAQ2G,KAAK4G,cAC5Bwf,EAAkBxf,EAAa1J,UAClCC,YAAcyJ,EAAa4R,UAAUrb,aAEtCipB,GAAgB1oB,OAGf4C,cAAgB,WACf,CAAA,GAAI2G,GAAYrG,WAAWC,QAAQxH,QAAQyH,OAAOvB,IAAI,4BACrDsI,EAAUjH,WAAWC,QAAQxH,QAAQyH,OAAOvB,IAAI,qBAChDuI,EAAUlH,WAAWC,QAAQxH,QAAQyH,OAAOvB,IAAI,oBAChCqB,YAAWC,QAAQxH,QAAQyH,OAAOvB,IAAI,wBAEvDqB,WAAWI,gBAAgB,cAAe3H,QAAQyH,OAAOvB,IAAI,qBAC7DqB,WAAWI,gBAAgB,iBAAkB3H,QAAQyH,OAAOvB,IAAI,wBAEhEnC,KAAKyB,KACJoI,UAAYA,EACZY,QAAUA,EACVC,QAAUA,KAIZd,WAAa,WACZ,GAAIC,GAAY7J,KAAKmC,IAAI,aACrB2H,EAAMD,GACV7J,MAAKxC,WAAWiI,OAAOqE,GACvB9J,KAAKyJ,WAAazJ,KAAKxC,WAAW1B,KAAK,iBACvCkE,KAAK0J,MAAQ1J,KAAKxC,WAAW1B,KAAK,sBAClCkE,KAAK2J,OAAS3J,KAAKxC,WAAW1B,KAAK,mBACnCkE,KAAK+J,YACL/J,KAAKhD,YACLgD,KAAKipB,iBAENA,cAAgB,WACf,GAAI1oB,GAAOP,IACXO,GAAKmJ,MAAM/K,GAAG,QAAS,gBAAiB,WACvC,CAAA,GAAI+G,GAAOpL,EAAE0F,MACTkpB,EAAkBxjB,EAAKyjB,QAAQ,cAAcrsB,KAAK,UAE1C,IAAIssB,IACfha,UAAY1J,EACZqgB,aAAemD,EACf/lB,MAAQ5C,EAAK4C,MAAMyjB,oBAAoBsC,GACvCG,WAAa9oB,OAGfA,EAAKmJ,MAAM/K,GAAG,QAAS,kBAAmB,WACzC,CAAA,GAAI+G,GAAOpL,EAAE0F,KAEK,IAAI/D,SAAQ6qB,QAAQwC,iBACrCla,UAAY1J,EACZ6jB,KAAO,MACPpmB,MAAQ,KACRkmB,WAAa9oB,OAGfA,EAAK5B,IACJ6qB,oBAAwB,SAAU/C,GACjC,GAAIV,GAAeU,EAAStkB,IAAI,gBAC/BglB,EAAgBV,EAAStkB,IAAI,gBAC9B5B,GAAK/C,WAAW1B,KAAK,YAAciqB,EAAe,oBAAoBhhB,KAAKoiB,OAK9Elc,cAAgB,SAAUpM,GACzB,GACIZ,GAAMC,EAAEkG,IAAIvF,EAAM,SAAU2nB,GAC/B,GAAIT,GAAenqB,IAAI4qB,EAAS,gBAC/BiD,EAAkD,GAArC7tB,IAAI4qB,EAAS,iBAAkB,IAAU,GAAQ,EAC9DkD,EAAWztB,QAAQqP,OAAOqe,YAAY/tB,IAAI4qB,EAAS,aACnDoD,EAAiB3tB,QAAQqP,OAAOue,SAASjuB,IAAI4qB,EAAS,cAAe,IAAK,EAAG,GAE9E,QACCT,aAAeA,EACf0D,WAAaA,EACbK,eAAiBluB,IAAI4qB,EAAS,iBAAkB,IAChDW,cAAgBrO,WAAWld,IAAI4qB,EAAS,gBAAiB,IACzDuD,SAAWnuB,IAAI8tB,EAAU,UAAW,IACpCM,YAAcpuB,IAAI8tB,EAAU,OAAQ,IACpCE,eAAiBhuB,IAAIguB,EAAgB,MAAO,IAAI9Y,QAAQ,eAAgB,OAAOA,QAAQ,SAAU,mBACjGmZ,UAAY5kB,SAASzJ,IAAI4qB,EAAS,YAAa,IAC/Chc,KAAOvO,QAAQmD,UAAUC,WAAW,iBAAkB0mB,MAGxD,QACCmE,aACC9d,KAAOnO,KAKV8O,OAAS,WACR,GAAIxM,GAAOP,KACVmD,EAAQ5C,EAAK4C,MACb6J,EAAc7J,EAAMiE,iBACpBZ,EAAS5K,IAAIoR,EAAa,UACvBmd,EAAWhnB,EAAMwjB,YAAYngB,GAC7B1B,EAAavE,EAAK0K,cAAckf,GAChC1f,EAAUlK,EAAK4B,IAAI,WACnB4C,EAAO0F,EAAQ3F,EACnBvE,GAAKmJ,MAAMuD,QACX1M,EAAKmJ,MAAM3E,KAAKA,GAChBxE,EAAKwJ,WACJE,MAAQ9G,EAAMhB,IAAI,aAClB+H,KAAO/G,EAAMhB,IAAI,UACjBhD,KAAO,yBAGTirB,QAAU,WACT,GAAI7pB,GAAOP,IACXO,GAAKwM,YAKP9Q,QAAQ6qB,QAAQkC,gBAAkBA,CAElC,IAAII,GAAmBvpB,OAAOC,UAU7BC,YAAc,SAAUrE,GAMvB,GALAsE,KAAKqjB,SAAWznB,IAAIF,EAAK,aACzBsE,KAAK+lB,aAAenqB,IAAIF,EAAK,eAAgB,MAC7CsE,KAAKmD,MAAQvH,IAAIF,EAAK,QAAS,MAC/BsE,KAAKqpB,WAAaztB,IAAIF,EAAK,aAAc,MACzCsE,KAAKiT,MAAQ,MACRjT,KAAK+lB,eAAiB/lB,KAAKmD,MAC/B,KAAK,iCAENnD,MAAKkD,gBACLlD,KAAK6jB,YACL7jB,KAAK8jB,aACL9jB,KAAKhD,YACLgD,KAAKqD,KAAK,UAIZ+lB,GAAiB9oB,OAChB4C,cAAgB,WACf,GAAI2G,GAAYrG,WAAWC,QAAQxH,QAAQyH,OAAOvB,IAAI,sBACrD4hB,EAASvgB,WAAWC,QAAQxH,QAAQyH,OAAOvB,IAAI,uBAChDnC,MAAKyB,KACJoI,UAAYA,EACZka,OAASA,KAGXF,UAAY,WACX,GAAItjB,GAAOP,IACXO,GAAK0S,MAAQ,GAAIhX,SAAQS,GAAGwhB,aAC3B/V,GAAK,mBACLtN,IAAM,gBACNsjB,MAAQ,SACRkG,YAAc,gBAKhBgG,eAAiB,WAChB,GAAI9pB,GAAOP,KACVsqB,IACExvB,IAAM,iBAAkBoT,MAAQ,WAChCpT,IAAM,eAAgBoT,MAAQ,QAC9BpT,IAAM,WAAYoT,MAAQ,QAC1BpT,IAAM,cAAeoT,MAAQ,OAC7BpT,IAAM,gBAAiBoT,MAAQ,SAEjCqc,EAAcrsB,EAAEkG,IAAIkmB,EAAiB,SAAUxhB,GAC9C,GAAI5B,GAAItL,IAAIkN,EAAI,MAChB,QACCoF,MAAQtS,IAAIkN,EAAI,QAAS,IACzByH,MAAa,iBAALrJ,EAAwB,WAAa3G,EAAK4C,MAAMhB,IAAI+E,GAAK,aAAgB3G,EAAK4C,MAAMhB,IAAI+E,KAGnG,QACCqjB,YAAcA,EACd/E,QAAU,wBACVxC,SAAW,yBACXnoB,IAAM,WACNsN,GAAK,cACL+F,MAAQ,UACRxT,KAAO,cACP6V,MAAQhQ,EAAK4C,MAAMhB,IAAI,mBAGzB2hB,WAAa,WACZ,GAAIvjB,GAAOP,KACV8E,EAAavE,EAAK8pB,iBAClBpU,EAAM1V,EAAK4B,IAAI,aACf4hB,EAASxjB,EAAK4B,IAAI,UAClB2H,EAAMmM,EAAInR,EACXvE,GAAK0S,MAAM/U,EAAEomB,KAAKvf,KAAK+E,GACvBvJ,EAAK0S,MAAM/U,EAAE2gB,OAAO9Z,KAAKgf,GACxB0B,OACE5qB,IAAM,cAAeH,KAAO,SAAUwT,MAAQ,OAC9CrT,IAAM,cAAeH,KAAO,SAAUwT,MAAQ,aAIlDlR,UAAY,WACX,GAAIuD,GAAOP,IACXA,MAAKrB,IACJ2f,KAAO,WACNte,KAAKiT,MAAMqL,QAEZU,KAAO,WACNhf,KAAKiT,MAAM+L,OACXhf,KAAKqpB,WAAWhmB,KAAK,sBAAuB9C,EAAK4C,UAGnD5C,EAAK0S,MAAM/U,EAAE0mB,OAAO9oB,KAAK,QAAQ6C,GAAG,QAAS,WAC5C,GAAI+G,GAAOpL,EAAE0F,MACZ6kB,EAAMnf,EAAK5I,KAAK,OACjB,IAAW,UAAP+nB,EACHtkB,EAAK8C,KAAK,YACJ,CACN,GAAI/D,GAAKiB,EAAK0S,MAAM/U,EAAEomB,KAAKxoB,KAAK,QAAQ+C,KAAK,qBAC7C6G,GAAKof,OAAO,UACZxlB,EAAGC,cAGLgB,EAAK0S,MAAM/U,EAAEomB,KAAKxoB,KAAK,QAAQ0C,oBAC9BC,QAAU,OACVC,QACCwoB,aACClsB,YACCC,UACCC,QAAU,YAEX+W,SACC/W,QAAS,aAEV+lB,aACCC,WAAY,EACZ3Q,MAAQ,EACRrV,QAAU,aAEXsvB,UACCtJ,WAAY,EACZ3Q,MAAQhQ,EAAK4C,MAAMhB,IAAI,kBAExBsoB,UACCA,SAAW,EACXvvB,QAAU,wBAKZyD,GAAG,iBAAkB,SAAUzB,GACjC,CAAA,GAAI0B,GAAQtE,EAAE4C,EAAEC,OACVyB,GAAMC,KAAK,yBACfF,GAAG,kBAAmB,SAAUzB,GAClCA,EAAE4B,gBACF,IAAIF,GAAQtE,EAAE4C,EAAEC,QAEZymB,GADEhlB,EAAMC,KAAK,sBACA0B,EAAKwkB,gBACtBxkB,GAAK4C,MAAME,KAAK,gBACf/E,OAASslB,EACT3b,OAAS,WACR1H,EAAK0S,MAAM/U,EAAE2gB,OAAO/iB,KAAK,qBAAqBgpB,OAAO,UAEtDzb,UAAY,WACX9I,EAAK0S,MAAM/U,EAAE2gB,OAAO/iB,KAAK,qBAAqBgpB,OAAO,SACrDvkB,EAAK8C,KAAK,cAKd0hB,cAAgB,WACf,GAAIxkB,GAAOP,KACVyf,EAAQlf,EAAK0S,MAAM/U,EAAEomB,IACtB,QACC4C,YAAczH,EAAM3jB,KAAK,gBAAgBV,UAM5Ca,QAAQ6qB,QAAQsC,iBAAmBA,CAEnC,IAAIsB,IACHC,iBACChwB,KAAO,UACPuT,MAAQ,KACR7S,KACCV,KAAO,iBACPimB,OAAS,qDACTF,WAAa,GACbI,UACCY,MAAQ,aACR1mB,gBAGFM,KACCX,KAAO,iBACPimB,OAAS,qDACTF,WAAa,GACbI,UACCY,MAAQ,aACR1mB,iBAIHksB,aACCvsB,KAAO,UACPuT,MAAQ,KACR7S,KACCV,KAAO,OACPgmB,OAAS,IACTC,OAAS,IACTF,WAAa,GACbI,UACC9lB,YACCiX,SACC/W,QAAS,WAEV+lB,aACCC,WAAY,EACZ3Q,MAAQ,EACRrV,QAAU,iBAKdI,KACCX,KAAO,OACPgmB,OAAS,IACTC,OAAS,IACTF,WAAa,GACbI,UACC9lB,YACCiX,SACC/W,QAAS,WAEV+lB,aACCC,WAAY,EACZ3Q,MAAQ,EACRrV,QAAU,kBAMf8qB,aACCrrB,KAAO,QACPuT,MAAQ,KACRwS,WAAa,GACbjG,QAAUxe,QAAQuR,QAAQod,eAC1B9J,UACC9lB,gBAKFirB,WACCtrB,KAAO,QACPuT,MAAQ,KACRwS,WAAa,GACbjG,QAAUxe,QAAQuR,QAAQqd,aAC1B/J,UACC9lB,gBAKF8pB,QACCnqB,KAAO,SACPE,IAAM,4BACNqT,MAAQ,OAGN4c,EAAsB,GAAIvwB,IAAGmG,YACjCxC,GAAEC,KAAKusB,EAAsB,SAAU5hB,EAAI5B,GAC1C,GAAIvM,GAAOiB,IAAIkN,EAAI,QACfka,EAAW,0CACf,IAAY,WAARroB,EAAmB,CACtB,GAAIwN,GAAK8a,MAAQ/b,EAAI,QAAU3M,GAAG4N,KAAM+a,EAAQhc,EAAI,QAAU3M,GAAG4N,KAChEgb,EAAe,mBAALjc,EAAyB,uBAAyB,iBAC5Dkc,EAAe,mBAALlc,EAAyB,qBAAuB,iBAC1D7L,EAAMd,GAAG+G,QAAQ1F,IAAIkN,EAAI,WACxBX,GAAK8a,MAAOvoB,KAAOyoB,EAAStoB,IAAM,+BAC/BS,EAAMf,GAAG+G,QAAQ1F,IAAIkN,EAAI,WAC5BX,GAAK+a,EAAOxoB,KAAO0oB,EAASvoB,IAAM,8BAEpCiwB,GAAoBzpB,SAAS6F,EAAG3M,GAAG+G,QAAQwH,GAC1CX,GAAKA,EACL6a,SAAWA,EACX3nB,IAAMA,EACNC,IAAMA,SAGPwvB,GAAoBzpB,SAAS6F,EAAG3M,GAAG+G,QAAQwH,GAC1CX,GAAKjB,EAAI,IAAM3M,GAAG4N,KAClBzN,KAAOwM,EACP8b,SAAWA,GACW,WAApBpnB,IAAIkN,EAAI,SAAwBjO,IAAM,8BAAgC,QAG3E,IAAIkwB,KACFlwB,IAAM,GAAIqT,MAAQ,OAClBrT,IAAM,GAAIqT,MAAQ,QAClBrT,IAAM,GAAIqT,MAAQ,SAClBrT,IAAM,GAAIqT,MAAQ,SAClBrT,IAAM,GAAIqT,MAAQ,SAClBrT,IAAM,GAAIqT,MAAQ,OAClBrT,IAAM,GAAIqT,MAAQ,QAClBrT,IAAM,GAAIqT,MAAQ,SAClBrT,IAAM,GAAIqT,MAAQ,UAClBrT,IAAM,GAAIqT,MAAQ,OAGhB8c,EAAuBxhB,EAAa1J,UACvCC,YAAc,WAEbC,KAAKxC,WAAa,KAElBwC,KAAKirB,WAAa,KAElBjrB,KAAKyJ,WAAa,KAElBzJ,KAAK2J,OAAS,KACd3J,KAAKkD,kBAGP8nB,GAAqB1qB,OACpB4C,cAAgB,WACf,GAAI2G,GAAYrG,WAAWC,QAAQxH,QAAQyH,OAAOvB,IAAI,uBACrD+oB,EAAW1nB,WAAWC,QAAQxH,QAAQyH,OAAOvB,IAAI,0BAClDqB,YAAWI,gBAAgB,kBAAmB3H,QAAQyH,OAAOvB,IAAI,yBACjEqB,WAAWI,gBAAgB,oBAAqB3H,QAAQyH,OAAOvB,IAAI,2BACnEqB,WAAWwgB,eAAe,uBAAwB,SAAUC,EAAaxJ,GACxE,MAAQwJ,IAAexJ,EAAQyJ,KAAKvpB,KAAQ8f,EAAQkD,GAAG3d,MAAQya,EAAQ0J,QAAQnkB,QAEhFwD,WAAWwgB,eAAe,aAAc,SAAUC,EAAaxJ,GAC9D,MAAQwJ,IAAexJ,EAAQyJ,KAAKvpB,KAAQ8f,EAAQkD,GAAG3d,MAAQya,EAAQ0J,QAAQnkB,QAEhFA,KAAKyB,KACJoI,UAAYA,EACZqhB,SAAWA,KAGbthB,WAAa,WACZ,GAAIC,GAAY7J,KAAKmC,IAAI,aACrB6U,KACHmU,EAAS,4BACTC,EAAaL,EACbxkB,GAAS8kB,OAEPC,OAAS,WACTnnB,MAAQ2mB,EAAoBjjB,WAAW,kBAAmB,kBAG1DyjB,OAAS,WACTnnB,MAAQ2mB,EAAoBjjB,WAAW,YAAa,kBAGpDyjB,OAAS,WACTnnB,MAAQ2mB,EAAoBjjB,WAAW,cAGtCiC,EAAMD,GACTtD,MAAQA,EACRyQ,QACCnc,IAAMswB,EACNI,MAAQH,EACRI,KAAOxU,IAGThX,MAAKxC,WAAWuH,KAAK+E,GACrB9J,KAAKirB,WAAajrB,KAAKxC,WAAW1B,KAAK,eACvCkE,KAAKyJ,WAAazJ,KAAKxC,WAAW1B,KAAK,iBACvCkE,KAAK2J,OAAS3J,KAAKxC,WAAW1B,KAAK,mBACnCkE,KAAK+M,SACL/M,KAAK+J,YACL/J,KAAKyrB,eACLzrB,KAAKhD,YACLgD,KAAK0rB;EAEND,aAAe,WACd,GAAIlrB,GAAOP,IACXO,GAAK0qB,WAAWnvB,KAAK,8BAA8B6vB,gBAClDC,OAAS,aACTC,UAAY,aACZC,WAAY,EACZC,QAAU,QACVC,UAAW,EACXC,gBAAiB,EACjBC,SAAW,UAEZ3rB,EAAK0qB,WAAWtsB,GAAG,QAAS,qBAAsB,WACjD,GAAIqW,GAAQ1a,EAAE0F,MACbmsB,EAAUnX,EAAMoX,KAAK,kCAClBD,GAAQ5wB,OAAS,GACpB4wB,EAAQR,eAAe,WAI1B3uB,UAAY,WACX,GAAIuD,GAAOP,IACXO,GAAKkJ,WAAWa,SACfC,SAAW,YAEZhK,EAAKkJ,WAAW9K,GAAG,QAAS,kBAAmB,WAC9C,GAAI+G,GAAOpL,EAAE0F,MACZwK,EAAO9E,EAAK5I,KAAK,YAClBmC,UAASC,SAASC,KAAOqL,IAE1BjK,EAAKoJ,OAAOhL,GAAG,OAAQ,SAAUzB,EAAGsJ,GACnC,GAAIlI,GAASiC,EAAK4C,MAAMiE,gBACxB9I,GAAe,OAAIkI,EACnBjG,EAAK4C,MAAME,KAAK,OAAQ9I,GAAG+G,QAAQhD,GAClCkI,OAAS5K,IAAI0C,EAAQ,SAAU,GAC/BmI,SAAW7K,IAAI0C,EAAQ,WAAY,UAItCotB,eAAiB,WAChB,GAAInrB,GAAOP,IACXO,GAAKkJ,WAAW9K,GAAG,QAAS,mBAAoB,WAC/C,CAAA,GAAI+G,GAAOpL,EAAE0F,MACZqsB,EAAW3mB,EAAK5I,KAAK,kBAAoB,GACzCmpB,EAAYvgB,EAAK5I,KAAK,cAAgB,GACtCorB,EAAUxiB,EAAK5I,KAAK,YAAc,GAClCwvB,EAAU5mB,EAAK5I,KAAK,iBAAmB,EAE3B,IAAIb,SAAQ6qB,QAAQyF,yBAChCnd,UAAY1J,EACZ2mB,SAAWA,EACXC,QAAUA,EACVrG,UAAYA,EACZiC,QAAUA,OAGZ3nB,EAAK0qB,WAAWtsB,GAAG,QAAS,OAAQ,WAEnC,GAAIL,GAASiC,EAAKisB,oBAClBjsB,GAAK4C,MAAME,KAAK,OAAQ/E,MAG1BkuB,mBAAqB,WACpB,GAAIjsB,GAAOP,KAEP1B,EAASiC,EAAK0qB,WAAWnvB,KAAK,SAAS2wB,iBACvCxuB,IAmBJ,OAlBAC,GAAEC,KAAKG,EAAQ,SAAUwK,GACxB,GAAI5B,GAAItL,IAAIkN,EAAI,QAAS7B,EAAIrL,IAAIkN,EAAI,QAAS,GAC9C,QAAO5B,GACN,IAAK,uBACL,IAAK,qBAEHD,EADG1M,GAAGyH,QAAQiF,GACV,GAEA1M,GAAGmyB,KAAKC,gBAAgB1lB,EAAG,iBAEhC,MACD,SACCA,EAAI1M,GAAGyH,QAAQiF,GAAK,GAAKA,EAG3BhJ,EAAIiJ,GAAKD,IAEVxJ,QAAQsB,KAAKd,GACNA,GAER2uB,YAAc,SAAU3rB,GACvB,GAAI4rB,IAAKtc,MAAQ,GAAIM,KAAO,IACxBic,EAAK,EAMT,OALIvyB,IAAG0H,SAAShB,IAAMA,EAAE1F,OAAS,IAChCuxB,EAAK7rB,EAAE6P,QAAQ,0DAA2D,qBAC1Egc,EAAKvyB,GAAGmyB,KAAKC,gBAAgBG,EAAI,oBACjCD,EAAItyB,GAAG+G,SAASiP,MAAQtP,EAAG4P,KAAOic,KAE5BD,GAERE,eAAiB,SAAU9rB,GAC1BA,EAAKA,EAAI,IAAO,EAChB,IAAI+G,GAAS/L,QAAQuR,QAAQod,eACzBoC,EAAI9uB,EAAE8C,OAAOgH,EAAQ,SAAUc,GAClC,MAAOlN,KAAIkN,EAAI,QAAS,KAAO7H,GAEhC,OAAgB,IAAZA,EAAE1F,QAA2B,GAAZyxB,EAAEzxB,QACdsV,KAAO,GAAIN,MAAQ,KAEpBM,KAAOjV,IAAIoxB,EAAE,GAAI,QAAS,IAAKzc,MAAQ3U,IAAIoxB,EAAE,GAAI,QAAS,MAEnEC,aAAe,SAAUhsB,GACxBA,EAAIA,GAAK,EACT,IAAIisB,GAAQjxB,QAAQuR,QAAQqd,aACxBmC,EAAI9uB,EAAE8C,OAAOksB,EAAO,SAAUpkB,GACjC,MAAOlN,KAAIkN,EAAI,QAAS,KAAO7H,GAEhC,OAAgB,IAAZA,EAAE1F,QAA2B,GAAZyxB,EAAEzxB,QACdsV,KAAO,GAAIN,MAAQ,KAEpBM,KAAOjV,IAAIoxB,EAAE,GAAI,QAAS,IAAKzc,MAAQ3U,IAAIoxB,EAAE,GAAI,QAAS,MAEnEG,YAAc,SAAUlsB,GACvB,OAAQ4P,KAAO5U,QAAQqP,OAAO4M,KAAKkV,cAAcnsB,GAAIsP,MAAQtP,IAE9DosB,gBAAkB,SAAUR,GAC3B,GAAI3F,GAActrB,IAAIixB,EAAG,cAAe,GACvCS,EAAuB1xB,IAAIixB,EAAG,uBAAwB,GACtDU,EAAgB3xB,IAAIixB,EAAG,gBAAiB,GACxCW,EAAetG,EAAcoG,EAAuBC,CACrD,QAAQhd,MAAQid,EAAc3c,KAAO2c,IAEtCC,kBAAoB,SAAUC,GAC7B,GAAIntB,GAAOP,KACP2tB,EAAU,gJACVC,GAAO/yB,IAAM,GAAIF,KAAO,QAExB0wB,EAAOntB,EAAEkG,IAAIupB,EAAQ9kB,MAAM,KAAM,SAAU3B,GAC9C,GAAI2lB,GAAI,IACR,QAAO3lB,GACN,IAAK,kBACJ2lB,EAAItsB,EAAKqsB,YAAYhxB,IAAI8xB,EAAKxmB,EAAG,IACjC,MACD,KAAK,iBACJ2lB,GAAKtc,MAAQ3U,IAAI8xB,EAAKxmB,EAAG,IAAK2J,KAAOjV,IAAI8xB,EAAKxmB,EAAG,IACjD,MACD,KAAK,cACJ2lB,EAAItsB,EAAKwsB,eAAenxB,IAAI8xB,EAAKxmB,EAAG,IACpC,MACD,KAAK,YACJ2lB,EAAItsB,EAAK0sB,aAAarxB,IAAI8xB,EAAKxmB,EAAG,IAClC,MACD,KAAK,cACL,IAAK,uBACL,IAAK,gBACL,IAAK,oBACJ2lB,EAAItsB,EAAK4sB,YAAYvxB,IAAI8xB,EAAKxmB,EAAG,IACjC,MACD,KAAK,eACJ2lB,EAAItsB,EAAK8sB,gBAAgBK,EACzB,MACD,KAAK,aACJ,GAAIzH,GAAYrqB,IAAI8xB,EAAK,YAAa,IACrC1H,EAAcpqB,IAAI8xB,EAAK,cAAe,IACnCG,EAAmB,6BACvBhB,IACClyB,KAAO,SACPmzB,OAAUD,EAAiB1mB,QAAQ8e,IAAc,GAAmB,OAAbA,GAAoC,EAAdD,EAAoB,SAAW,GAC5G9X,MAAQ,KACR6f,eAAiBnyB,IAAI8xB,EAAK,iBAAkB,IAC5CzH,UAAYA,EACZoG,SAAWzwB,IAAI8xB,EAAK,WAAY,IAChCpB,QAAU1wB,IAAI8xB,EAAK,UAAW,KAIjC,MAAOnzB,IAAG+G,QAAQssB,EAAKf,IAExB,OAAOxB,IAERpgB,cAAgB,SAAUpM,GACzB,GAAI0B,GAAOP,KACPmrB,EAAS,4BACZC,EAAaL,EACVS,EAAOttB,EAAEkG,IAAIvF,EAAM,SAAU6uB,GAChC,OACC7yB,IAAM,GACNwwB,KAAO9qB,EAAKktB,kBAAkBC,KAGhC,QACC7yB,IAAMswB,EACNI,MAAQH,EACRI,KAAOA,IAGTze,OAAS,WACR,GAAIxM,GAAOP,KACVmD,EAAQ5C,EAAK4C,MACb6J,EAAc7J,EAAMiE,iBACpBZ,EAAS5K,IAAIoR,EAAa,UACvBghB,EAAU7qB,EAAMklB,gBAAgB7hB,GAChC1B,EAAavE,EAAK0K,cAAc+iB,GAChC9C,EAAW3qB,EAAK4B,IAAI,YACpB4C,EAAOmmB,EAASpmB,EACpBvE,GAAKkJ,WAAWwD,QAChB1M,EAAKkJ,WAAW1E,KAAKA,GACrBxE,EAAKwJ,WACJE,MAAQ9G,EAAMhB,IAAI,aAClB+H,KAAO/G,EAAMhB,IAAI,UACjBhD,KAAO,2BAIVlD,QAAQ6qB,QAAQkE,qBAAuBA,CAEvC,IAAIiD,GAAuBhyB,QAAQ2G,KAAKC,UAAU/C,UACjDC,YAAc9D,QAAQ2G,KAAKC,UAAUuY,UAAUrb,aAEhD9D,SAAQ6qB,QAAQmH,qBAAuBA,CAEvC,IAAIC,GAA6B1kB,EAAa1J,UAC7CC,YAAcyJ,EAAa4R,UAAUrb,aAEtCmuB,GAA2B5tB,OAC1B4C,cAAgB,WACf,GAAI2G,GAAYrG,WAAWC,QAAQxH,QAAQyH,OAAOvB,IAAI,yBACrDsI,EAAUjH,WAAWC,QAAQxH,QAAQyH,OAAOvB,IAAI,kBAChDuI,EAAUlH,WAAWC,QAAQxH,QAAQyH,OAAOvB,IAAI,kBAEjDqB,YAAWI,gBAAgB,YAAa3H,QAAQyH,OAAOvB,IAAI,mBAE3DnC,KAAKyB,KACJoI,UAAYA,EACZY,QAAUA,EACVC,QAAUA,KAIZO,cAAgB,SAAUpM,GACzB,GAEIZ,GAAMC,EAAEkG,IAAIvF,EAAM,SAAUwF,GAC/B,OACCxJ,IAAM,GACNsN,GAAKvM,IAAIyI,EAAM,SAAU,IACzB3J,KAAOkB,IAAIyI,EAAM,WAAY,IAC7BN,KAAOnI,IAAIyI,EAAM,WAAY,MAG/B,QACC8pB,WACC3C,KAAOvtB,KAIV8O,OAAS,WACR,GAAIxM,GAAOP,KACVmD,EAAQ5C,EAAK4C,MACb6J,EAAc7J,EAAMiE,iBACpBZ,EAAS5K,IAAIoR,EAAa,UACvB/I,EAAQd,EAAMf,SAASoE,GACvB1B,EAAavE,EAAK0K,cAAchH,GAChCwG,EAAUlK,EAAK4B,IAAI,WACnB4C,EAAO0F,EAAQ3F,EACnBvE,GAAKmJ,MAAMuD,QACX1M,EAAKmJ,MAAM3E,KAAKA,GAChBxE,EAAKwJ,WACJE,MAAQ9G,EAAMhB,IAAI,aAClB+H,KAAO/G,EAAMhB,IAAI,UACjBhD,KAAO,2BAIVlD,QAAQ6qB,QAAQoH,2BAA6BA,GAC3C1uB,OAAQC,QAAS,WACnBlF,GAAGC,GAAG,kBACN,IAII8U,IAJarT,QAAQS,GAAGiD,cACf1D,QAAQS,GAAGC,OACDV,QAAQ6qB,QAAQlB,iBACjB3pB,QAAQ6qB,QAAQkC,gBACb/sB,QAAQ2G,KAAK0M,oBAIlCtJ,GAFa/J,QAAQ2G,KAAKhD,WACd3D,QAAQ2G,KAAKC,UACP5G,QAAQ2G,KAAKoD,iBAE/BooB,EAAwB9e,EAAmBxP,UAS9CC,YAAcuP,EAAmB8L,UAAUrb,aAI5C9D,SAAQ6qB,QAAQsH,sBAAwBA,CAExC,IAAIC,GAA6BroB,EAAgBlG,UAChDC,YAAc,SAAUrE,GACvBsE,KAAKyB,KACJwE,YAAchK,QAAQiK,mBAEvBlG,KAAK+lB,aAAenqB,IAAIF,EAAK,eAAgB,IAC7CsE,KAAK+O,WAAanT,IAAIF,EAAK,aAAc,IACzCsE,KAAKiqB,UAAYruB,IAAIF,EAAK,YAAa,IACvCsE,KAAKrE,UAAYC,IAAIF,EAAK,YAAa,MACvCsE,KAAK8C,gBAAiB,EACtB9C,KAAKmD,MAAQ,GAAIlH,SAAQ6qB,QAAQyB,sBACjCvoB,KAAKoG,KAAO,GAAInK,SAAQ6qB,QAAQmH,qBAChCjuB,KAAKsuB,gBAAkB1yB,IAAIF,EAAK,kBAAmB,MACnDsE,KAAKmG,iBAAmB,GAAIlK,SAAQ6qB,QAAQyH,kCAC3C5yB,UAAYqE,KAAKsuB,gBACjBnrB,MAAQ,GAAIlH,SAAQ6qB,QAAQ0B,4BAC5BpiB,KAAO,GAAInK,SAAQ6qB,QAAQoH,6BAE5BluB,KAAK5C,SAGPixB,GAA2B/tB,OAC1BlD,KAAO,WACN,GAAImD,GAAOP,IACXO,GAAKvD,YACLuD,EAAK4C,MAAME,KAAK,OAAQ,WACvB,IAAK9C,EAAK4C,MAAMtB,WACf,KAAK,0BAGNtB,GAAK4F,iBAAiBwiB,cAAcpoB,EAAK4C,MAAMf,YAE/C7B,EAAK6F,KAAK/C,KAAK,WAKjBrG,UAAY,WAEXgD,KAAKrB,IACJ0H,OAAS,WACR,GAAI9F,GAAOP,IACXO,GAAK4C,MAAMmD,UACX/F,EAAK6F,KAAKE,UACV/F,EAAKnD,QAENmJ,MAAQ,SAAUjI,GACjB,GAAIiC,GAAOP,IACXvC,SAAQsB,KAAK,iBACbtB,QAAQsB,KAAKT,GACbiC,EAAK4F,kBAAoB5F,EAAK4F,iBAAiB9C,KAAK,OAAQ9I,GAAG+G,QAAQhD,GACtEkI,OAAS,EACTC,SAAW,QAGXzG,MAEHA,KAAKmD,MAAMxE,IACV+H,KAAO,SAAUnK,GAChB,GAAIgE,GAAOP,KACV1B,GACCynB,aAAexlB,EAAKwlB,aACpBhX,WAAaxO,EAAKwO,WAClBkb,UAAY1pB,EAAK0pB,UAGnB1pB,GAAK4C,MAAM/F,KAAKkB,EAAQ/B,KAEvByD,MAEHA,KAAKoG,KAAKzH,IACTvB,KAAO,WACN,GAAImD,GAAOP,IACXO,GAAK6F,KAAKhJ,MACT+F,MAAQ5C,EAAK4C,MACbL,eAAiBvC,EAAKuC,eACtBnH,UAAY4E,EAAK5E,aAInBqF,OAAS,SAAU1C,GAClB,GAAIiC,GAAOP,IACXO,GAAK8C,KAAK,QAAS/E,IAIpBiI,MAAQ,SAAUjI,GACjB,GAAIiC,GAAOP,IACXO,GAAK8C,KAAK,QAAS/E,KAElB0B,SAGL/D,QAAQ6qB,QAAQuH,2BAA6BA,CAE7C,IAAIE,GAAmCtyB,QAAQ2G,KAAK0M,mBAAmBxP,UACtEC,YAAc9D,QAAQ2G,KAAK0M,mBAAmB8L,UAAUrb,aAEzDwuB,GAAiCjuB,OAChCqoB,cAAgB,SAAU9pB,GACzBmB,KAAKmD,MAAMwlB,cAAc9pB,IAE1B7B,UAAY,WACXgD,KAAKrB,IACJ+H,KAAO,SAAUpI,GAChB,GAAIiC,GAAOP,IACNO,GAAKsB,YACTtB,EAAKnD,KAAKkB,GAEXiC,EAAK4C,MAAME,KAAK,OAAQ/E,KAEvB0B,MACHA,KAAKmD,MAAMxE,IACV+H,KAAO,SAAUpI,GAChB,GAAIiC,GAAOP,KACPzD,EAAO,WACVgE,EAAK6F,KAAK/C,KAAK,UAEhB9C,GAAK4C,MAAMuD,KAAKpI,EAAQ/B,KAEvByD,MACHA,KAAKoG,KAAKzH,IACToO,OAAS,WACR,GAAIxM,GAAOP,IACXO,GAAK6F,KAAK2G,UAEXyC,YAAc,WACb,GAAIjP,GAAOP,IACXO,GAAK6F,KAAK2D,UAAUzL,UAEnB0B,SAGL/D,QAAQ6qB,QAAQyH,iCAAmCA,GAEjD/uB,OAAQC,QAAS,WACnBlF,GAAGC,GAAG,kBACN,IAKIg0B,IALavyB,QAAQS,GAAGiD,cACf1D,QAAQS,GAAGC,OACDV,QAAQ6qB,QAAQJ,iBAGZ7mB,OAAOC,UAMjCC,YAAc,SAAUrE,GAMvB,GALAsE,KAAKrE,UAAYC,IAAIF,EAAK,YAAa,MACvCsE,KAAK+lB,aAAenqB,IAAIF,EAAK,eAAgB,MAC7CsE,KAAKmD,MAAQvH,IAAIF,EAAK,eAAgB,MACtCsE,KAAKoG,KAAOxK,IAAIF,EAAK,UAAW,MAChCsE,KAAKyuB,iBAAmB7yB,IAAIF,EAAK,mBAAoB,QAChDsE,KAAKrE,WAAcqE,KAAKmD,OAAUnD,KAAKoG,MAASpG,KAAKyuB,kBACzD,KAAK,kCAGNzuB,MAAK5C,UAGPoxB,GAAqBluB,OAEpBlD,KAAO,WACN,GAAImD,GAAOP,IACXO,GAAKvD,YACLuD,EAAK4C,MAAME,KAAK,QACf0iB,aAAexlB,EAAKwlB,aACpBxpB,KAAO,WACNgE,EAAK6F,KAAK/C,KAAK,QACdF,MAAQ5C,EAAK4C,MACbxH,UAAY4E,EAAK5E,YAElB4E,EAAK6F,KAAK/C,KAAK,cAKlBrG,UAAY,WACXgD,KAAKrB,IAEJ4H,MAAQ,cAINvG,MAEHA,KAAKoG,KAAKzH,IACTvB,KAAO,SAAUkB,GAChB,GAAIiC,GAAOP,IACXO,GAAK6F,KAAKhJ,KAAKkB,GACfiC,EAAKkuB,iBAAiBrxB,MACrBzB,UAAY4E,EAAK5E,UAAUG,KAAK,uBAChCiqB,aAAexlB,EAAKwlB,gBAGtBhZ,OAAS,WACR,GAAIxM,GAAOP,IACXO,GAAK6F,KAAK2G,WAET/M,SAIL/D,QAAQ6qB,QAAQ0H,qBAAuBA,CAGvC,IAAIE,GAA8B7uB,OAAOC,UACxCC,YAAa,WACZC,KAAKyB,KACJwE,YAAchK,QAAQiK,mBAEvBlG,KAAKrE,UAAY,KACjBqE,KAAK+lB,aAAe,KACpB/lB,KAAKmD,MAAQ,GAAIlH,SAAQ6qB,QAAQc,sBACjC5nB,KAAKoG,KAAO,GAAInK,SAAQ6qB,QAAQkE,uBAIlC0D,GAA4BpuB,OAC3BlD,KAAO,SAAU1B,GAChB,GAAI6E,GAAOP,IAGX,IAFAO,EAAK5E,UAAYC,IAAIF,EAAK,YAAa,MACvC6E,EAAKwlB,aAAenqB,IAAIF,EAAK,eAAgB,KACxCsE,KAAKrE,YAAcqE,KAAKmD,QAAUnD,KAAKoG,KAC3C,KAAK,8CAGN7F,GAAKvD,YACLuD,EAAK4C,MAAM/F,MAEV8oB,QAAUtqB,IAAI2E,EAAK4B,IAAI,eAAgB,gBACvC4jB,aAAexlB,EAAKwlB,eAErBxlB,EAAK4C,MAAME,KAAK,QACfmD,OAAS,EAAGC,SAAW,GACvBlK,KAAO,SAAU4G,GAChB5C,EAAK6F,KAAK/C,KAAK,QACd1H,UAAY4E,EAAK5E,UACjBwH,MAAQA,QAKZnG,UAAY,WACXgD,KAAKmD,MAAMxE,IACV+H,KAAO,SAAUpI,GAChB,GAAIiC,GAAOP,KACPzD,EAAOX,IAAI0C,EAAQ,OAAQ,WAC9BiC,EAAK6F,KAAK/C,KAAK,WAEhBrD,MAAKmD,MAAMuD,KAAKpI,EAAQ/B,KAEvByD,MACHA,KAAKoG,KAAKzH,IACTvB,KAAO,SAAU1B,GAChBsE,KAAKoG,KAAKhJ,KAAK1B,IAEhBqR,OAAS,WACR/M,KAAKoG,KAAK2G,WAET/M,SAGL/D,QAAQ6qB,QAAQ4H,4BAA8BA,GAC5ClvB,OAAQC,QACV,SAAWnF,GACXC,GAAGC,GAAG,kBACN,IACIkF,IADazD,QAAQS,GAAGiD,cACf1D,QAAQS,GAAGC,QAEpBgyB,IACF9zB,IAAM,uBAAwBgqB,IAAM,WAAY3W,MAAQ,OACxDrT,IAAM,WAAYgqB,IAAM,OAAQ3W,MAAQ,UACxCrT,IAAM,WAAYgqB,IAAM,aAAc3W,MAAQ,WAC9CrT,IAAM,WAAYgqB,IAAM,SAAU3W,MAAQ,UAGxC0gB,EAAiB/uB,OAAOC,UAC3BC,YAAc,WAEbC,KAAKxC,WAAa,KAElBwC,KAAK6uB,KAAO,KACZ7uB,KAAK8uB,YAAc,KAEnB9uB,KAAK+uB,QAAU,KAEf/uB,KAAKgvB,QAAU,KAEfhvB,KAAKmD,MAAQ,KAEbnD,KAAKkD,kBAIP0rB,GAAetuB,OAOdlD,KAAO,SAAU1B,GAGhB,GAFAsE,KAAKxC,WAAa5B,IAAIF,EAAK,YAAa,MACxCsE,KAAKmD,MAAQvH,IAAIF,EAAK,QAAS,OAC1BsE,KAAKxC,aAAewC,KAAKmD,MAC7B,KAAK,kCAGNnD,MAAK4J,cAENA,WAAa,WACZ,GAAIC,GAAY7J,KAAKmC,IAAI,aACrB2H,EAAMD,GACV7J,MAAKxC,WAAWuH,KAAK+E,GACrB9J,KAAK6uB,KAAO7uB,KAAKxC,WAAW1B,KAAK,gBACjCkE,KAAK+uB,QAAU/uB,KAAKxC,WAAW1B,KAAK,uBACpCkE,KAAKgvB,QAAUhvB,KAAKxC,WAAW1B,KAAK,uBACpCkE,KAAKhD,aAENiyB,gBAAkB,WACjB,GAAI1uB,GAAOP,KACV6uB,EAAOtuB,EAAKsuB,KACZK,EAAcjzB,QAAQmD,UAAU4gB,sBACjCzf,GAAKuuB,YAAc,GAAI7yB,SAAQS,GAAGmjB,YACjClkB,UAAYkzB,EACZ/O,UAAW,EACXC,MAAQmP,EACRr0B,IAAM,iBACNs0B,QAAU,WACT,GAAIna,GAAQ1a,EAAE0F,KACdf,UAASC,SAASC,KAAO6V,EAAMlY,KAAK,cAErCmO,cAAgB,SAAUpM,EAAMihB,EAAUjlB,GACzC,GAAIuR,GAAOlO,EAAEkG,IAAIvF,EAAM,SAAUiK,EAAIsQ,GACpC,GAAIlL,GAAQtS,IAAIkN,EAAI,QAAS,IAC5BpO,EAAOkB,IAAIkN,EAAI,OAAQ,IACvB0B,EAAOvO,QAAQmD,UAAUC,WAAW3E,GAAO6F,EAAK4C,MAAMhB,IAAI,iBAC3D,QACCtH,IAAM,QACNqT,MAAQA,EACR1D,KAAOA,EACP9P,KAAOA,EACP00B,WAAcvwB,EAAKtD,OAAS,GAAK6d,GAAO,GAAO,IAIjD,OADA0G,MAAa,GAAQ1T,EAAKijB,SAEzBx0B,IAAMA,EACNsJ,MAAQiI,OAOZlJ,cAAgB,WACf,GAAI2G,GAAYrG,WAAWC,QAAQxH,QAAQyH,OAAOvB,IAAI,0BACrDmtB,EAAY9rB,WAAWC,QAAQxH,QAAQyH,OAAOvB,IAAI,uBAClDotB,EAAc/rB,WAAWC,QAAQxH,QAAQyH,OAAOvB,IAAI,qBAErDqB,YAAWI,gBAAgB,cAAe3H,QAAQyH,OAAOvB,IAAI,qBAC7DnC,KAAKyB,KACJoI,UAAYA,EACZylB,UAAYA,EACZC,YAAcA,KAGhBvyB,UAAY,WACX,GAAIuD,GAAOP,IACXO,GAAKwuB,QAAQpwB,GAAG,QAAS,gBAAiB,WACzC4B,EAAKivB,SAASl1B,EAAE0F,SAEjBO,EAAKwuB,QAAQpwB,GAAG,QAAS,aAAc,WACtC,GAAIkmB,GAAMvqB,EAAE0F,MAAMlD,KAAK,YACnB4I,EAAOpL,EAAE0F,KACb,QAAO6kB,GACN,IAAK,OACJtkB,EAAKknB,YAAY/hB,EACjB,MACD,KAAK,aACJnF,EAAKkvB,YACL,MACD,KAAK,SACJlvB,EAAKgnB,mBAKRhnB,EAAK5B,IACJ6qB,oBAAwB,SAAU/C,GACjC,GAAIV,GAAeU,EAAStkB,IAAI,gBAC/BglB,EAAgBlrB,QAAQqP,OAAO4M,KAAKkV,cAAc3G,EAAStkB,IAAI,iBAChE5B,GAAK/C,WAAW1B,KAAK,YAAciqB,EAAe,oBAAoBhhB,KAAKoiB,OAI9EM,YAAc,SAAUpE,GACvB5lB,QAAQsB,KAAK,cAEK,IAAIuqB,IACrBla,UAAYiU,EACZkG,KAAO,OACPpmB,MAAQnD,KAAKmD,MACbkmB,WAAarpB,QAGfwvB,SAAW,SAAUnM,GACpB,CAAA,GAAI9iB,GAAOP,IAGC,IAAI/D,SAAQ6qB,QAAQsC,kBAC/Bha,UAAYiU,EACZ0C,aAAexlB,EAAK4C,MAAMhB,IAAI,gBAC9BgB,MAAQ5C,EAAK4C,MACbkmB,WAAa9oB,MAGfkvB,WAAa,SAAUpM,GACtB,CAAA,GAAI9iB,GAAOP,IACC,IAAI/D,SAAQ6qB,QAAQ4I,uBAC/BtgB,UAAYiU,EACZ0C,aAAexlB,EAAK4C,MAAMhB,IAAI,gBAC9BgB,MAAQ5C,EAAK4C,MACbkmB,WAAa9oB,IAEd9C,QAAQsB,KAAK,eAEdwoB,cAAgB,WAEf,GAAIhnB,GAAOP,IACX/D,SAAQS,GAAGizB,SACVxR,MAAQ,SACRvhB,IAAM,WACNgzB,QAAU,KACVC,KAAO,WACNtvB,EAAK4C,MAAME,KAAK,UACfgG,UAAY,SAAU0c,GACrB9mB,SAASC,SAASC,KAAOlD,QAAQmD,UAAUC,WAAW,WAAY0mB,WAOvE9a,cAAgB,WACf,GAAI1K,GAAOP,KACVmD,EAAQ5C,EAAK4C,MACb2sB,EAAOnB,EACPoB,EAAQ7xB,EAAE8C,OAAOzG,GAAGy1B,MAAMF,GAAO,SAAUhnB,GAC1C,MAAyB,YAAlBlN,IAAIkN,EAAI,SAEhBohB,EAAc,KACXnE,EAAe5iB,EAAMhB,IAAI,iBAAmB,GAC/CsnB,EAA4C,GAA/BtmB,EAAMhB,IAAI,mBAAyB,GAAQ,EACxDunB,EAAWztB,QAAQqP,OAAOqe,YAAYxmB,EAAMhB,IAAI,aAChDynB,EAAiB3tB,QAAQqP,OAAOue,SAAU1mB,EAAMhB,IAAI,gBAAkB,GAAK,EAAG,GAoB/E,OAlBA+nB,IACCrvB,IAAM,YACNkrB,aAAeA,EACf0D,WAAaA,EACbK,eAAiB3mB,EAAMhB,IAAI,mBAAqB,GAChDglB,cAAgBrO,WAAW3V,EAAMhB,IAAI,kBAAoB,GACzD4nB,SAAWnuB,IAAI8tB,EAAU,UAAW,IACpCM,YAAcpuB,IAAI8tB,EAAU,OAAQ,IACpCE,eAAiBhuB,IAAIguB,EAAgB,MAAO,IAAI9Y,QAAQ,eAAgB,OAAOA,QAAQ,SAAU,mBACjGmZ,UAAY5kB,SAASlC,EAAMhB,IAAI,cAAgB,GAC/CqI,KAAOvO,QAAQmD,UAAUC,WAAW,iBAAkB0mB,IACtDkK,UAAW,EACXH,KAAOv1B,GAAG6J,IAAI2rB,EAAO,SAAUjnB,EAAI4H,GAClC,MAAOnW,IAAG+G,QAAQwH,GACjBonB,QAAe,GAALxf,GAAS,GAAO,QAK5BwZ,YAAcA,EACd4F,KAAO5xB,EAAEkG,IAAI0rB,EAAM,SAAUhnB,GAC5B,MAAsB,cAAlBlN,IAAIkN,EAAI,OACJvO,GAAG+G,QAAQwH,GACjBoF,MAAQtS,IAAIkN,EAAI,QAAS,IAAM,IAAMzD,SAASlC,EAAMhB,IAAI,cAAgB,GAAK,MAGxE2G,MAIViE,OAAS,WACR,GAAIxM,GAAOP,KAEV8E,GADQvE,EAAK4C,MACA5C,EAAK0K,iBAClBgL,EAAM1V,EAAK4B,IAAI,aACZ2H,EAAMmM,EAAInR,EACdvE,GAAK0uB,kBACL1uB,EAAKwuB,QAAQhqB,KAAK+E,IAEnBsgB,QAAU,WACTpqB,KAAK+M,YAIP9Q,QAAQ6qB,QAAQ8H,eAAiBA,CAIjC,IAAIuB,IACHC,cACCz1B,KAAO,WACPuT,MAAQ,QACRwS,WAAa,EACbjG,QAAUxe,QAAQuR,QAAQ6iB,qBAC1BvP,UACC9lB,gBAGFs1B,cACC31B,KAAO,OACPuT,MAAQ,UACRwS,WAAa,GACbI,UACC9lB,YACCC,UACCC,QAAU,eAEX4W,cACCxW,IAAM,GACNJ,QAAU,sBAKd4uB,gBACCnvB,KAAO,OACPuT,MAAQ,SACRwS,WAAa,GACbI,UACC9lB,YACCC,UACCC,QAAU,cAEX4W,cACCxW,IAAM,GACNJ,QAAU,qBAKdq1B,aACC51B,KAAO,OACPuT,MAAQ,OACRwS,WAAa,GACbI,UACC9lB,YACCC,UACCC,QAAU,YAEX4W,cACCxW,IAAM,GACNJ,QAAU,mBAKds1B,UACC71B,KAAO,QACPuT,MAAQ,OACRwS,WAAa,MACbjG,QAAUxe,QAAQuR,QAAQijB,YAC1B3P,UACC9lB,YACCC,UACCC,QAAU,eAKdw1B,UACC/1B,KAAO,OACPuT,MAAQ,OACRwS,WAAa,GACbC,OAAS,oCACTG,UACC9lB,YACCC,UACCC,QAAU,YAEX4W,cACCxW,IAAM,GACNJ,QAAU,mBAKdy1B,QACCh2B,KAAO,OACPuT,MAAQ,KACRwS,WAAa,GACbI,UACC9lB,YACC8W,cACCxW,IAAM,IACNJ,QAAU,kBAKd01B,gBACCj2B,KAAO,WACPuT,MAAQ,SACRwS,WAAa,EACb4B,QAAU,KACVC,SAAW,KACXzB,UACC9lB,gBAGF61B,iBACCl2B,KAAO,OACPuT,MAAQ,KACRwS,WAAa,GACbC,OAAS,iDACTG,UACC9lB,YACCC,UACCC,QAAU,UAEX4W,cACCxW,IAAM,GACNJ,QAAU,iBAKd41B,gBACCn2B,KAAO,OACPuT,MAAQ,KACRwS,WAAa,GACbC,OAAS,kDACTG,UACC9lB,YACCC,UACCC,QAAU,UAEX4W,cACCxW,IAAM,GACNJ,QAAU,kBAKd61B,eACCp2B,KAAO,OACPuT,MAAQ,KACRwS,WAAa,GACbC,OAAS,qDACTG,UACC9lB,YACC8W,cACCxW,IAAM,GACNJ,QAAU,mBAMX81B,EAAuB,GAAIz2B,IAAGmG,YAClCxC,GAAEC,KAAKgyB,EAAuB,SAAUrnB,EAAI5B,GAC3C,GAAIvM,GAAOiB,IAAIkN,EAAI,QACfka,EAAW,wCACf,IAAY,YAARroB,EAAoB,CACvB,GAAIs2B,GAAM/yB,EAAEkG,IAAIxI,IAAIkN,EAAI,WAAY,SAAUwc,GAC7C,MAAO/qB,IAAG+G,QAAQgkB,GACjBnd,GAAKjB,EAAI,IAAM3M,GAAG4N,KAClBzN,KAAOwM,EACPrM,IAAM,cAGRm2B,GAAqB3vB,SAAS6F,EAAG3M,GAAG+G,QAAQwH,GAC3CX,GAAK,GACLsS,QAAUwW,EACVjO,SAAWA,EACXnoB,IAAM,kBAGPm2B,GAAqB3vB,SAAS6F,EAAG3M,GAAG+G,QAAQwH,GAC3CX,GAAKjB,EAAI,IAAM3M,GAAG4N,KAClBzN,KAAOwM,EACP8b,SAAWA,EACXnoB,IAAM,eAOT,IAAIyuB,GAAkBzpB,OAAOC,UAU5BC,YAAc,SAAUrE,GACvBsE,KAAKqjB,SAAWznB,IAAIF,EAAK,UAAW,MACpCsE,KAAKupB,KAAO3tB,IAAIF,EAAK,OAAQ,QAC7BsE,KAAKmD,MAAQvH,IAAIF,EAAK,QAAS,OAAS,GAAIO,SAAQ6qB,QAAQJ,iBAC5D1mB,KAAKqpB,WAAaztB,IAAIF,EAAK,aAAc,MACzCsE,KAAKiT,MAAQ,KACbjT,KAAK2kB,SAAW,4IAA4I9b,MAAM,KAClK7I,KAAKkD,gBACLlD,KAAK6jB,YACL7jB,KAAK8jB,aACL9jB,KAAKhD,YACLgD,KAAKqD,KAAK,UAGZimB,GAAgBhpB,OACf4C,cAAgB,WACf,GAAI2G,GAAYrG,WAAWC,QAAQxH,QAAQyH,OAAOvB,IAAI,qBACrD4hB,EAASvgB,WAAWC,QAAQxH,QAAQyH,OAAOvB,IAAI,uBAChDqB,YAAWwgB,eAAe,uBAAwB,SAAUC,EAAaxJ,GACxE,MAAQwJ,IAAexJ,EAAQyJ,KAAKvpB,KAAQ8f,EAAQkD,GAAG3d,MAAQya,EAAQ0J,QAAQnkB,QAEhFwD,WAAWwgB,eAAe,eAAgB,SAAUrD,EAAQC,EAAQnG,GACnE,MAASkG,IAAWC,EAAkCnG,EAAQkD,GAAG3d,MAAnCya,EAAQ0J,QAAQnkB,QAE/CA,KAAKyB,KACJoI,UAAYA,EACZka,OAASA,KAGXK,cAAgB,WACf,OAAqB,QAAbpkB,KAAKupB,KAAkB,KAAO,MAAQ,QAE/C1F,UAAY,WACX,GAAItjB,GAAOP,IACXO,GAAK0S,MAAQ,GAAIhX,SAAQS,GAAGwhB,aAC3B/V,GAAK,eACLtN,IAAM,gBACNsjB,MAAQ5d,EAAK6jB,gBACbC,YAAc,gBAKhBgG,eAAiB,WAChB,GAAI9pB,GAAOP,KACV2kB,EAAWpkB,EAAKokB,SACbS,EAAUlnB,EAAEkG,IAAIugB,EAAU,SAAU7pB,GACvC,GAAIuqB,GAAQ2L,EAAqB7uB,IAAIrH,GACpCH,EAAOiB,IAAIypB,EAAO,OACnB,IAAY,SAAR1qB,EAAiB,CACpB,GAAIsM,GAAI1G,EAAK4C,MAAMhB,IAAIrH,IAAQc,IAAIypB,EAAO,cACzC5K,EAAUvc,EAAEkG,IAAIxI,IAAIypB,EAAO,WAAY,SAAUC,GAChD,MAAO/qB,IAAG+G,QAAQgkB,GACjBC,SAAW3pB,IAAI0pB,EAAI,UAAYre,EAAI,WAAa,MAGnD,OAAO1M,IAAG+G,QAAQ+jB,GACjB9U,MAAQtJ,EACRwT,QAAUA,IAEL,GAAY,YAAR9f,EAAoB,CAC9B,GAAIsM,GAAI1G,EAAK4C,MAAMhB,IAAIrH,IAAQc,IAAIypB,EAAO,cACzC5K,EAAUvc,EAAEkG,IAAIxI,IAAIypB,EAAO,WAAY,SAAUC,GAChD,MAAO/qB,IAAG+G,QAAQgkB,GACjBpZ,QAAUtQ,IAAI0pB,EAAI,UAAYre,EAAI,UAAY,MAGjD,OAAO1M,IAAG+G,QAAQ+jB,GACjB9U,MAAQtJ,EACRwT,QAAUA,IAEL,MAAY,YAAR9f,EACHJ,GAAG+G,QAAQ+jB,GACjBnZ,QAAU3L,EAAK4C,MAAMhB,IAAIrH,IAAQc,IAAIypB,EAAO,cAAgB,UAAY,KAGlE9qB,GAAG+G,QAAQ+jB,GACjB9U,MAAQhQ,EAAK4C,MAAMhB,IAAIrH,IAAQc,IAAIypB,EAAO,iBAI7C,OAAOD,IAERtB,WAAa,WACZ,GAAIvjB,GAAOP,KACV8E,EAAavE,EAAK8pB,iBAClBpU,EAAM1V,EAAK4B,IAAI,aACf4hB,EAASxjB,EAAK4B,IAAI,UAClB2H,EAAMmM,GACLuP,QAAU,eACVrhB,MAAQW,GAEVvE,GAAK0S,MAAM/U,EAAEomB,KAAKvf,KAAK+E,GACvBvJ,EAAK0S,MAAM/U,EAAE2gB,OAAO9Z,KAAKgf,GACxB0B,OACE5qB,IAAM,cAAeH,KAAO,SAAUwT,MAAQ,OAC9CrT,IAAM,cAAeH,KAAO,SAAUwT,MAAqB,QAAb3N,EAAKgpB,KAAiB,KAAO,UAI9EhpB,EAAK8L,aAAa,kCAEnBrO,mBAAqB,WACpB,GAAIuC,GAAOP,KACV2kB,EAAWpkB,EAAKokB,SAChB1mB,IAYD,OAXAC,GAAEC,KAAKwmB,EAAU,SAAU7pB,GAC1B,GAAIuqB,GAAQ2L,EAAqB7uB,IAAIrH,GACpCH,EAAOiB,IAAIypB,EAAO,OACnB,IAAY,WAAR1qB,EAAmB,CACtB,GAAIU,GAAMP,EAAM,OAAQQ,EAAMR,EAAM,MACpCmD,GAAI5C,GAAOO,IAAIypB,EAAO,mBACtBpnB,EAAI3C,GAAOM,IAAIypB,EAAO,uBAEtBpnB,GAAInD,GAAOc,IAAIypB,EAAO,iBAGjBpnB,GAERjB,UAAY,WACX,GAAIuD,GAAOP,KACPpC,EAAS2C,EAAKvC,oBAClBgC,MAAKrB,IACJ2f,KAAO,WACNte,KAAKiT,MAAMqL,QAEZU,KAAO,WACNhf,KAAKiT,MAAM+L,UAGbze,EAAK0S,MAAM/U,EAAE0mB,OAAO9oB,KAAK,QAAQ6C,GAAG,QAAS,WAC5C,GAAI+G,GAAOpL,EAAE0F,MACZ6kB,EAAMnf,EAAK5I,KAAK,OACjB,IAAW,UAAP+nB,EACHtkB,EAAK8C,KAAK,YACJ,CACN,GAAI/D,GAAKiB,EAAK0S,MAAM/U,EAAEomB,KAAKxoB,KAAK,QAAQ+C,KAAK,qBAC7C6G,GAAKof,OAAO,UACZxlB,EAAGC,cAGLgB,EAAK0S,MAAM/U,EAAEomB,KAAKxoB,KAAK,QAAQ0C,oBAC9BC,QAAU,OACVC,OAASd,IACPe,GAAG,iBAAkB,SAAUzB,GACjC,CAAA,GAAI0B,GAAQtE,EAAE4C,EAAEC,OACVyB,GAAMC,KAAK,yBACfF,GAAG,kBAAmB,SAAUzB,GAClCA,EAAE4B,gBACF,IAAIF,GAAQtE,EAAE4C,EAAEC,QAEZymB,GADEhlB,EAAMC,KAAK,sBACA0B,EAAKwkB,gBACtBtnB,SAAQsB,KAAK6kB,GACbrjB,EAAK4C,MAAME,KAAK9C,EAAKgpB,MACpBjrB,OAASslB,EACT3b,OAAS,WACR1H,EAAK0S,MAAM/U,EAAE2gB,OAAO/iB,KAAK,qBAAqBgpB,OAAO,UAEtDzb,UAAY,WACX9I,EAAK0S,MAAM/U,EAAE2gB,OAAO/iB,KAAK,qBAAqBgpB,OAAO,SACrDvkB,EAAK8oB,YAAc9uB,GAAGkpB,KAAKljB,EAAK8oB,WAAWe,UAAY7pB,EAAK8oB,WAAWe,UACvE7pB,EAAK8C,KAAK,cAKdgJ,aAAe,SAAU9B,GACxB,GAAIhK,GAAOP,IACXO,GAAK0S,MAAM/U,EAAEomB,KAAKxoB,KAAKyO,GAAUpM,KAAK,WACrC,GAAIomB,GAAMjqB,EAAE0F,MACXsiB,EAAUiC,EAAIznB,KAAK,gBACnBylB,EAAWgC,EAAIznB,KAAK,gBACrBynB,GAAIjY,iBACHC,KAAO,SACPC,QAAU,UACVC,SAAW,UACXC,OAAS4V,EACT3V,QAAU4V,OAIbwC,cAAgB,WACf,CAAA,GAAIxkB,GAAOP,KACV2kB,EAAWpkB,EAAKokB,SAChB1mB,IACUC,GAAEkG,IAAIugB,EAAU,SAAU7pB,GACnC,GAAIuqB,GAAQ2L,EAAqB7uB,IAAIrH,GACpCH,EAAOiB,IAAIypB,EAAO,OAGlBpnB,GAAInD,GAFO,YAARH,EAESL,EAAE,SAAWQ,EAAM,KAAK+D,KAAK,mBAAmB4b,QAAQ7N,MAAY,EAAJ,EAEjEtS,EAAE,SAAWQ,EAAM,KAAKM,QAGtC,MAAO6C,MAIThC,QAAQ6qB,QAAQwC,gBAAkBA,CAElC,IAAIoG,GAAwB7vB,OAAOC,UAClCC,YAAc,SAAUrE,GACvBsE,KAAKqjB,SAAWznB,IAAIF,EAAK,UAAW,MACpCsE,KAAKmD,MAAQvH,IAAIF,EAAK,QAAS,MAC/BsE,KAAKqpB,WAAaztB,IAAIF,EAAK,aAAc,MACzCsE,KAAKiT,MAAQ,KACbjT,KAAK+C,UAAY,KACjB/C,KAAKyJ,WAAa,KAClBzJ,KAAKkxB,UAAY,KACjBlxB,KAAKyB,KACJskB,aAAe/lB,KAAKmD,MAAMhB,IAAI,gBAC9B4M,WAAa/O,KAAKmD,MAAMhB,IAAI,kBAC5B8nB,UAAYjqB,KAAKmD,MAAMhB,IAAI,eAG5BnC,KAAKkD,gBACLlD,KAAK6jB,YACL7jB,KAAK+M,SACL/M,KAAKhD,YACLgD,KAAKmxB,eACLnxB,KAAKqD,KAAK,UAGZqsB,GAAsBpvB,OACrB4C,cAAgB,WACf,GAAI2G,GAAYrG,WAAWC,QAAQxH,QAAQyH,OAAOvB,IAAI,2BACrD4hB,EAASvgB,WAAWC,QAAQxH,QAAQyH,OAAOvB,IAAI,uBAEhDnC,MAAKyB,KACJoI,UAAYA,EACZka,OAASA,KAGXF,UAAY,WACX,GAAItjB,GAAOP,IACXO,GAAK0S,MAAQ,GAAIhX,SAAQS,GAAGwhB,aAC3B/V,GAAK,qBACLtN,IAAM,gBACNsjB,MAAQ,WACRkG,YAAc,gBAKhBtX,OAAS,WACR,GAAIxM,GAAOP,KACV6J,EAAYtJ,EAAK4B,IAAI,aACrB4hB,EAASxjB,EAAK4B,IAAI,UACf2nB,EAAiBvpB,EAAK4C,MAAMhB,IAAI,mBAAqB,GACxDsjB,IAAS5qB,IAAM,cAAeH,KAAO,SAAUwT,MAAQ,OACpDpE,EAAMD,GACThP,IAAM,GACNsjB,MAAQ2L,EACR5b,MAAQ,UAET3N,GAAK0S,MAAM/U,EAAEomB,KAAKvf,KAAK+E,GACvBvJ,EAAK0S,MAAM/U,EAAE2gB,OAAO9Z,KAAKgf,GACxB0B,KAAOA,KAERllB,EAAKwC,UAAYxC,EAAK0S,MAAM/U,EAAEomB,KAAKxoB,KAAK,cACxCyE,EAAKkJ,WAAalJ,EAAK0S,MAAM/U,EAAEomB,KAAKxoB,KAAK,gBAE1CkB,UAAY,WACX,GAAIuD,GAAOP,IACXA,MAAKrB,IACJ2f,KAAS,WACR/d,EAAK0S,MAAMqL,QAEZU,KAAS,WACRze,EAAK0S,MAAM+L,UAGbze,EAAK0S,MAAM/U,EAAE0mB,OAAO9oB,KAAK,QAAQ6C,GAAG,QAAS,WAC5C,GAAI+G,GAAOpL,EAAE0F,MACZ6kB,EAAMnf,EAAK5I,KAAK,OACN,WAAP+nB,GACHtkB,EAAK8C,KAAK,WAIb8tB,aAAe,WACd,GAAI5wB,GAAOP,IACXO,GAAK2wB,UAAY,GAAIj1B,SAAQ6qB,QAAQuH,4BACpC1yB,UAAY4E,EAAKwC,UACjBurB,gBAAkB/tB,EAAKkJ,WACvBsc,aAAexlB,EAAK4B,IAAI,gBACxB4M,WAAaxO,EAAK4B,IAAI,cACtB8nB,UAAY1pB,EAAK4B,IAAI,kBASxBlG,QAAQ6qB,QAAQ4I,sBAAwBA,CAGxC,IAAI0B,GAAan1B,QAAQo1B,UAAUD,WAClCE,EAAWr1B,QAAQo1B,UAAUC,SAC1BC,EAAuB,SAAUC,GACpC,GAAIj3B,GAAGyH,QAAQwvB,GAAe,MAAO,EACrC,IAAI7Z,GAAI1b,QAAQuR,QAAQC,aACpBuf,EAAI9uB,EAAEpC,KAAK6b,EAAG,SAAU7O,GAC3B,GAAIX,GAAKvM,IAAIkN,EAAI,KACjB,OAAOX,IAAMqpB,GAEd,OAAKxE,GACEpxB,IAAIoxB,EAAG,QAAS,IADR,IAGZyE,EAAiB,SAAUxqB,GAC9B,GAAI1M,GAAGyH,QAAQiF,GAAI,MAAO,EAC1B,IAAI0Q,GAAI1b,QAAQuR,QAAQkkB,OACpB1E,EAAI9uB,EAAEpC,KAAK6b,EAAG,SAAU7O,GAC3B,GAAIX,GAAKvM,IAAIkN,EAAI,QACjB,OAAOX,IAAMlB,GAEd,OAAK+lB,GACEpxB,IAAIoxB,EAAG,QAAS,IADR,IAGZ2E,EAAgB,SAAUj2B,EAAKmD,GAClC,GAAIqP,GAAQtS,IAAIF,EAAK,QAAS,IAAKk2B,EAAYh2B,IAAIF,EAAK,YAAa,IAAKgD,EAAS9C,IAAIF,EAAK,aACxFm2B,EAAUj2B,IAAIiD,EAAM,UAAW,GACnCgzB,GAAUt3B,GAAGyH,QAAQ6vB,GAAW,GAAK,IAAMJ,EAAeI,GAAW,GACrE,IAAIC,GAAU5zB,EAAEkG,IAAI1F,EAAQ,SAAU5D,GACrC,GAAIi3B,GAAgBC,EAAsBl3B,GAAMoT,EAAQtS,IAAIm2B,EAAe,QAAS,IACnF5Y,EAAOvd,IAAIm2B,EAAe,OAAQ,IAAKl3B,EAAMe,IAAIm2B,EAAe,MAAO,IACpExhB,EAAQ3U,IAAIiD,EAAM/D,EAAK,GAG3B,OAFAyV,IAAiB,YAAPzV,EAAqB+2B,EAAU,GACzCthB,GAAS4I,GAERre,IAAMA,EACND,IAAMA,EACNqT,MAAQA,EACRqC,MAAQA,IAGV,QACCrC,MAAQA,EACR0jB,UAAYA,EACZlzB,OAASozB,IAGPG,EAAiB,SAAUv2B,EAAKmD,GACnC,GAAIqP,GAAQtS,IAAIF,EAAK,QAAS,IAAKk2B,EAAYh2B,IAAIF,EAAK,YAAa,IAAKgD,EAAS9C,IAAIF,EAAK,aACxF81B,EAAe51B,IAAIiD,EAAM,eAAgB,IAC5CqzB,EAAoBX,EAAqBC,EAC1CU,GAAoB33B,GAAGyH,QAAQkwB,GAAqB,GAAK,IAAMA,EAAoB,GACnF,IAAIJ,GAAU5zB,EAAEkG,IAAI1F,EAAQ,SAAU5D,GACrC,GAAIi3B,GAAgBC,EAAsBl3B,GAAMoT,EAAQtS,IAAIm2B,EAAe,QAAS,IACnF5Y,EAAOvd,IAAIm2B,EAAe,OAAQ,IAAKl3B,EAAMe,IAAIm2B,EAAe,MAAO,IACpExhB,EAAQ3U,IAAIiD,EAAM/D,EAAK,GAC3B,QAAOA,GACN,IAAK,WACL,IAAK,sBACL,IAAK,gBACL,IAAK,cACJD,GAAON,GAAGyH,QAAQuO,GAAS,UAAY,EACvC,MACD,KAAK,YACL,IAAK,kBACJA,EAAQhW,GAAGmyB,KAAKC,gBAAgB1wB,QAAQqP,OAAO6mB,oBAAoB5hB,GAAQ,mBAC3E,MACD,KAAK,aACJ,GAAI6hB,GAAgBx2B,IAAIiD,EAAM,gBAAiB,GAC9CwzB,EAAcz2B,IAAIiD,EAAM,cAAe,IACpC+hB,EAAS,EAEZA,GADGyR,GAAe,IAAuB,GAAjBD,EACf,oBACCC,GAAe,IAAuB,GAAjBD,EACtB,sBAAuC,IAAfC,EAAoB,OAAS,QAAU,UAE/D,mBAEVzR,EAAS,IAAMA,EAAS,IACxBrQ,GAAgBqQ,CAChB,MACD,KAAK,iBACJ/lB,GAAuB,IAAhB22B,GAAsC,IAAhBA,EAAqB,GAAK,UAIzD,MADAjhB,IAAS4I,GAERre,IAAMA,EACND,IAAMA,EACNqT,MAAQA,EACRqC,MAAQA,IAGV,QACCrC,MAAQA,EACRgkB,kBAAoBA,EACpBN,UAAYA,EACZlzB,OAASozB,IAGPQ,EAAe,SAAU52B,EAAKmD,GACjC,GAAIqP,GAAQtS,IAAIF,EAAK,QAAS,IAAKk2B,EAAYh2B,IAAIF,EAAK,YAAa,IAAKgD,EAAS9C,IAAIF,EAAK,aACxF81B,EAAe51B,IAAIiD,EAAM,eAAgB,IACzCizB,EAAU5zB,EAAEkG,IAAI1F,EAAQ,SAAU5D,GACrC,GAAIi3B,GAAgBC,EAAsBl3B,GAAMoT,EAAQtS,IAAIm2B,EAAe,QAAS,IACnF5Y,EAAOvd,IAAIm2B,EAAe,OAAQ,IAAKl3B,EAAMe,IAAIm2B,EAAe,MAAO,IACpExhB,EAAQ3U,IAAIiD,EAAM/D,EAAK,GAC3B,QAAOA,GACN,IAAK,gBACL,IAAK,iBACL,IAAK,aACL,IAAK,aACL,IAAK,qBACL,IAAK,eACL,IAAK,eACL,IAAK,oBACJD,GAAgB,GAAT0V,EAAa,UAAY,EAChC,MACD,KAAK,cACJ1V,GAAON,GAAGyH,QAAQuO,GAAS,UAAY,EACvC,MACD,KAAK,yBACJ1V,GAAuB,IAAhB22B,GAAsC,IAAhBA,EAAqB,GAAK,UAKzD,MADAjhB,IAAS4I,GAERre,IAAMA,EACND,IAAMA,EACNqT,MAAQA,EACRqC,MAAQA,IAGV,QACCrC,MAAQA,EACR0jB,UAAYA,EACZlzB,OAASozB,IAGPS,EAAiB,SAAU72B,EAAKmD,GACnC,GAAIqP,GAAQtS,IAAIF,EAAK,QAAS,IAAKk2B,EAAYh2B,IAAIF,EAAK,YAAa,IAAKgD,EAAS9C,IAAIF,EAAK,aACxF82B,EAAS52B,IAAIiD,EAAM,cACtB4zB,EAAav0B,EAAEw0B,QAAQF,EAAQ,SAAUG,GAAO,MAAO/2B,KAAI+2B,EAAM,mBA0BlE,OAzBAF,GAAav0B,EAAEkG,IAAIquB,EAAY,SAAUG,EAAM93B,GAC9C,GAAI8c,GAAmB,GACnBib,EAAkBD,EAAKr3B,OACvBu3B,EAAU50B,EAAEkG,IAAIwuB,EAAM,SAAUD,GACnC,GAAII,KAWJ,OAVA70B,GAAEC,KAAKO,EAAQ,SAAUwI,GACxB,GAAID,GAAIrL,IAAI+2B,EAAMzrB,EAAG,IACpBiS,EAAQ5e,GAAGyH,QAAQgwB,EAAsB9qB,KAAQ3M,GAAGyH,QAAQgwB,EAAsB9qB,GAAS,MACvD,GAAnC8qB,EAAsB9qB,GAAS,IACxB,qBAALA,IACH0Q,EAAmB3Q,GAGpB8rB,EAAM7rB,GAAKD,EAAIkS,IAET4Z,GAER,QACCnb,iBAAmBA,EACnBib,gBAAkB,IAAMA,EAAkB,IAC1C1b,eAAiBrc,EACjB0wB,KAAOsH,MAKRlB,UAAYA,EACZ1jB,MAAQA,EACRukB,WAAaA,IAGXT,GACHgB,UAAc9kB,MAAQ,KAAMrT,IAAM,YAClCo4B,iBAAqB/kB,MAAQ,KAAMrT,IAAM,YACzCyxB,SAAape,MAAQ,MAAOrT,IAAM,YAClCq4B,eAAmBhlB,MAAQ,OAAQrT,IAAM,YACzCs4B,QAAYjlB,MAAQ,KAAMiL,KAAOiY,EAAYv2B,IAAM,YACnDu4B,UAAcllB,MAAQ,OAAQrT,IAAM,YACpCw4B,WAAenlB,MAAQ,MAAOrT,IAAM,YACpCy4B,cAAkBplB,MAAQ,UAAWrT,IAAM,YAC3C04B,WAAerlB,MAAQ,OAAQrT,IAAM,aACrC24B,iBAAqBtlB,MAAQ,OAAQrT,IAAM,aAC3C44B,YAAgBvlB,MAAQ,OAAQrT,IAAM,aACtC64B,gBAAoBxlB,MAAQ,OAAQrT,IAAM,YAC1C84B,qBAAyBzlB,MAAQ,OAAQrT,IAAM,aAC/C+4B,eAAmB1lB,MAAQ,SAAUrT,IAAM,aAC3Cg5B,aAAiB3lB,MAAQ,OAAQrT,IAAM,aACvCi5B,YAAgB5lB,MAAQ,OAAQiL,KAAOmY,EAAUz2B,IAAM,YACvDsmB,eAAmBjT,MAAQ,MAAOiL,KAAOmY,EAAUz2B,IAAM,YACzDk5B,YAAgB7lB,MAAQ,UAAWiL,KAAOmY,EAAUz2B,IAAM,YAC1Dm5B,sBAA0B9lB,MAAQ,WAAYiL,KAAOmY,EAAUz2B,IAAM,YACrEo5B,gBAAoB/lB,MAAQ,OAAQiL,KAAOmY,EAAUz2B,IAAM,YAC3Dq5B,YAAgBhmB,MAAQ,OAAQiL,KAAOmY,EAAUz2B,IAAM,YACvDs5B,YAAgBjmB,MAAQ,UAAWiL,KAAOmY,EAAUz2B,IAAM,YAC1Du5B,aAAiBlmB,MAAQ,KAAMrT,IAAM,YACrCw5B,oBAAwBnmB,MAAQ,QAASiL,KAAOmY,EAAUz2B,IAAM,YAChEy5B,cAAkBpmB,MAAQ,OAAQiL,KAAOmY,EAAUz2B,IAAM,YACzD05B,cAAkBrmB,MAAQ,UAAWiL,KAAOmY,EAAUz2B,IAAM,YAC5D25B,wBAA4BtmB,MAAQ,MAAOiL,KAAOmY,EAAUz2B,IAAM,YAClE45B,YAAgBvmB,MAAQ,OAAQiL,KAAOmY,EAAUz2B,IAAM,YACvD65B,mBAAuBxmB,MAAQ,OAAQiL,KAAOmY,EAAUz2B,IAAM,YAC9DgU,UAAcX,MAAQ,OAAQrT,IAAM,YACpC85B,SAAazmB,MAAQ,KAAMrT,IAAM,YACjC+5B,WAAe1mB,MAAQ,OAAQiL,KAAOmY,IAEnCuD,GACHC,YACC5mB,MAAQ,OACR0jB,UAAY,OACZlzB,QAAU,WAAW,mBACrBq2B,MAAQpD,GAETqD,aACC9mB,MAAQ,OACR0jB,UAAY,OACZlzB,QAAU,UAAU,gBAAgB,SAAS,WAAW,YAAY,eAAe,YAAY,kBAC/F,aAAa,iBAAiB,sBAAsB,gBAAgB,eACpEq2B,MAAQ9C,GAETgD,WACC/mB,MAAQ,OACR0jB,UAAY,OACZlzB,QAAU,aAAa,gBAAgB,aAAa,uBAAuB,iBAC3E,aAAa,aAAa,cAAc,qBAAqB,eAAe,eAAe,yBAC3F,aAAa,oBAAoB,WAAW,WAC5Cq2B,MAAQzC,GAET4C,aACChnB,MAAQ,OACR0jB,UAAY,QACZlzB,QAAU,mBAAmB,iBAAiB,WAAW,WAAW,YAAY,cAChFq2B,MAAQxC,IAKNhG,EAA0B1sB,OAAOC,UAMpCC,YAAc,SAAUrE,GAavB,GAZAsE,KAAKqjB,SAAWznB,IAAIF,EAAK,aACzBsE,KAAKqsB,SAAWzwB,IAAIF,EAAK,WAAY,IACrCsE,KAAKssB,QAAU1wB,IAAIF,EAAK,UAAW,IACnCsE,KAAKimB,UAAYrqB,IAAIF,EAAK,YAAa,IACvCsE,KAAKkoB,QAAUtsB,IAAIF,EAAK,UAAW,IACnCsE,KAAKm1B,WAAal5B,QAAQuR,QAAQqd,aAClC7qB,KAAKo1B,YAAc,GAAI76B,IAAGmG,aAC1BV,KAAKq1B,mBACLr1B,KAAKiT,MAAQ,KACbjT,KAAKs1B,QAAU15B,IAAIoE,KAAKo1B,YAAYjzB,IAAInC,KAAKimB,WAAY,MAAO,MAChEjmB,KAAKu1B,eAAiB35B,IAAIoE,KAAKo1B,YAAYjzB,IAAInC,KAAKimB,WAAY,YAAa,MAC7EjmB,KAAKhE,WAAa,KACdzB,GAAGkpB,KAAKzjB,KAAKu1B,gBAChBv1B,KAAKhE,WAAagE,KAAKu1B,mBACjB,CAAA,IAAKh7B,GAAG0H,SAASjC,KAAKu1B,gBAC5B,KAAM,uDAAyDv1B,KAAKu1B,cAE1Dh7B,IAAGmpB,UAAU1jB,KAAKu1B,kBAC5Bv1B,KAAKhE,WAAazB,GAAGopB,MAAM3jB,KAAKu1B,iBAGjC,MADAv1B,MAAKw1B,UAAY55B,IAAIoE,KAAKo1B,YAAYjzB,IAAInC,KAAKimB,WAAY,YAAa,MACnEjmB,KAAKs1B,SAAYt1B,KAAKhE,YAC3BgE,KAAKkD,gBACLlD,KAAK6jB,YACL7jB,KAAKhD,gBACLgD,MAAKqD,KAAK,OAAQrD,KAAKy1B,mBAJuB,OAOhDlJ,GAAwBjsB,OACvB+0B,iBAAmB,WAClB,GAAI90B,GAAOP,IACX9B,GAAEC,KAAK6B,KAAKm1B,WAAY,SAAUrsB,GACjC,GAAInO,GAAOiB,IAAIkN,EAAI,QAAS,IAAI4sB,UAC5B/6B,GAAKY,OAAS,GACjBgF,EAAK60B,YAAY/zB,SAAS1G,EAAMmO,MAInC5F,cAAgB,WACf,GAAI3C,GAAOP,KACP6J,EAAYrG,WAAWC,QAAQxH,QAAQyH,OAAOvB,IAAI5B,EAAK+0B,UAC1DvR,EAASvgB,WAAWC,QAAQxH,QAAQyH,OAAOvB,IAAI,uBAChDqB,YAAWwgB,eAAe,eAAgB,SAAUC,EAAaxJ,GAChE,MAAQwJ,IAAexJ,EAAQyJ,KAAKvpB,KAAQ8f,EAAQkD,GAAG3d,MAAQya,EAAQ0J,QAAQnkB,QAEhFA,KAAKyB,KACJoI,UAAYA,EACZka,OAASA,KAGXF,UAAY,WACX,GAAItjB,GAAOP,IACXO,GAAK0S,MAAQ,GAAIhX,SAAQS,GAAGwhB,aAC3B/V,GAAK,uBACLtN,IAAM,gBACNujB,QAAU,WACVD,MAAQ,WACRkG,YAAc,gBAKhBrnB,UAAY,WACX,GAAIuD,GAAOP,IACXO,GAAK5B,IACJ+H,KAAS,SAAUpI,GAClBiC,EAAKvE,WAAWsC,EAAQ,SAAU9B,GACX,OAAlBA,EAAIwC,WACPuB,EAAKwM,OAAOnR,IAAIY,EAAK,OAAQ,OAE7BkD,GACC9C,IAAMhB,IAAIY,EAAK,YAAa,IAC5B7B,KAAO,cAKX2jB,KAAS,WACR/d,EAAK0S,MAAMqL,QAEZU,KAAS,WACRze,EAAK0S,MAAM+L,SAEVhf,MACHO,EAAK0S,MAAM/U,EAAE0mB,OAAOjmB,GAAG,QAAS,OAAQ,WACvC,GAAI+G,GAAOpL,EAAE0F,MACZ6kB,EAAMnf,EAAK5I,KAAK,OACN,WAAP+nB,GACHtkB,EAAK8C,KAAK,WAIbsyB,kBAAoB,SAAU92B,GAC7B,GACI+2B,GAAY,+CAA+C/sB,MAAM,IACrE+sB,GAAY13B,EAAEkG,IAAIwxB,EAAW,SAAU96B,GACtC,GAAI+6B,GAAWhB,EAAqB/5B,GAChCi6B,EAAQtsB,IAAIotB,EAAU,SACtBn6B,EAAMwC,EAAE43B,KAAKD,EAAU,QAAS,YAAa,SACjD,OAAOd,GAAMr5B,EAAKE,IAAIiD,EAAM,cAE7BpB,QAAQsB,KAAK62B,EACb,IAAIpE,GAAe51B,IAAIiD,EAAM,oBAAqB,IACjDqzB,EAAoBX,EAAqBC,EAC1CU,GAAoB33B,GAAGyH,QAAQkwB,GAAqB,GAAK,IAAMA,EAAoB,GACnF,IAAI6D,IACH7nB,MAAQ,SACRgkB,kBAAoBA,EACpB8D,QAAUp6B,IAAIiD,EAAM,mBAAoB,IAAIiS,QAAQ,MAAO,SAG5D,QACC8kB,UAAYA,EACZG,YAAcA,IAGhBE,qBAAuB,SAAUp3B,GAChC,GAAI0B,GAAOP,KACPk2B,EAAmBt6B,IAAIiD,EAAM,uBAAwB,GACxDs3B,EAAev6B,IAAIiD,EAAM,mBAAoB,GAC1ConB,EAAYrqB,IAAIs6B,EAAkB,aACrCE,EAAiBx6B,IAAI2E,EAAK60B,YAAYjzB,IAAI8jB,GAAY,QAAS,GAwBhE,OAvBAiQ,GAAmB37B,GAAG4D,KAAK+3B,KAAsB,SAAUG,EAAKvtB,EAAI5B,GACnE,GAAIovB,GAAW,oDAWf,OAVIA,GAASnvB,QAAQD,IAAM,EAC1BmvB,EAAInvB,GAAKjL,QAAQqP,OAAO4M,KAAKkV,cAAcnxB,QAAQqP,OAAO4M,KAAKqe,YAAYztB,IAC5D,aAAL5B,EACVmvB,EAAM97B,GAAG+G,QAAQ+0B,GAChBpQ,UAAYnd,EACZstB,eAAiBx6B,IAAI2E,EAAK60B,YAAYjzB,IAAI2G,GAAK,QAAS,MAGzDutB,EAAInvB,GAAK4B,EAEHutB,IAERF,EAAe57B,GAAG4D,KAAKg4B,KAAkB,SAAUE,EAAKvtB,EAAI5B,GAC3D,GAAIovB,GAAW,2CAMf,OAJCD,GAAInvB,GADDovB,EAASnvB,QAAQD,IAAM,EACjBjL,QAAQqP,OAAO4M,KAAKkV,cAAcnxB,QAAQqP,OAAO4M,KAAKqe,YAAYztB,IAElEA,EAEHutB,KAGPH,iBAAmB37B,GAAG+G,QAAQ40B,GAC7BE,eAAiBA,IAElBD,aAAeA,IAGjBlrB,cAAgB,SAAUpM,GACzB,GAAI0B,GAAOP,KACPrF,EAAOuD,EAAEs4B,KAAKj2B,EAAKg1B,eAAe1sB,MAAM,MACxC5K,EAAM,IACV,QAAOtD,GACN,IAAK,6BACJsD,EAAMsC,EAAKo1B,kBAAkB92B,EAC7B,MACD,KAAK,gCACJZ,EAAMsC,EAAK01B,qBAAqBp3B,GAKlC,MAAOZ,IAER8O,OAAS,SAAUlO,GAClB,GAAI0B,GAAOP,KACP8E,EAAavE,EAAK0K,cAAcpM,GACnCgL,EAAYtJ,EAAK4B,IAAI,aACrB4hB,EAASxjB,EAAK4B,IAAI,UACf2H,EAAMD,EAAU/E,EACpBvE,GAAK0S,MAAM/U,EAAEomB,KAAKvf,KAAK+E,GACvBvJ,EAAK0S,MAAM/U,EAAE2gB,OAAO9Z,KAAKgf,GACxB0B,OACE5qB,IAAM,cAAeH,KAAO,SAAUwT,MAAQ,UAGjD3N,EAAK8C,KAAK,SAEXoyB,eAAiB,WAChB,GAAIl1B,GAAOP,KACP1B,IAOJ,OANAJ,GAAEC,KAAKoC,EAAKi1B,UAAU3sB,MAAM,KAAM,SAAU3B,GAC3C,GAAIuvB,GAAU,mBAALvvB,EAAyB,UAAYA,CAC9C5I,GAAO4I,GAAK3G,EAAKk2B,KAElBh5B,QAAQsB,KAAK,gBACbtB,QAAQsB,KAAKT,GACNA,KAGTrC,QAAQ6qB,QAAQyF,wBAA0BA,GAGxC/sB,OAAQC,QAAS,SAAWnF,GAC9BC,GAAGC,GAAG,kBACN,IAAIk8B,GAAsB,WACzB,GAAIjX,GAAQnlB,EAAE,uCACVq8B,EAAmB,GAAI16B,SAAQ6qB,QAAQsH,uBAC1CzyB,UAAY8jB,EACZrZ,KAAO,GAAInK,SAAQ6qB,QAAQkC,gBAC3B7lB,MAAQ,GAAIlH,SAAQ6qB,QAAQlB,kBAC3B5pB,WAAaC,QAAQC,OAAO6qB,gBAG9B4P,GAAiBtzB,KAAK,QACrBmD,OAAS,EACTC,SAAW,MAITmwB,EAAqB,WACxB,CAAA,GAAIC,GAAM56B,QAAQmD,UAAU03B,uBACxBrX,EAAQnlB,EAAE,sCACO,IAAI2B,SAAQ6qB,QAAQ0H,sBACxC7yB,UAAY8jB,EACZsG,aAAenqB,IAAIi7B,EAAK,aAAc,GACtCE,aAAe,GAAI96B,SAAQ6qB,QAAQJ,iBACnCsQ,QAAU,GAAI/6B,SAAQ6qB,QAAQ8H,eAC9BH,iBAAmB,GAAIxyB,SAAQ6qB,QAAQ4H,+BAKzCzyB,SAAQ6qB,QAAQmQ,eAAiBL,EAEjC36B,QAAQ6qB,QAAQoQ,gBAAkBR,GAChCl3B,OAAQC,QAAS,WACnBlF,GAAGC,GAAG,gBACN,IACIkF,IADazD,QAAQS,GAAGiD,cACf1D,QAAQS,GAAGC,QAEpBw6B,EAAwBt3B,OAAOC,UAWlCC,YAAc,SAAUrE,GAEvB,GADAsE,KAAKhE,WAAaJ,IAAIF,EAAK,aAAc,OACpCsE,KAAKhE,WACT,KAAK,sBAGNgE,MAAK8D,OAASlI,IAAIF,EAAK,aACvBsE,KAAKw1B,UAAY55B,IAAIF,EAAK,gBAC1BsE,KAAKo3B,UAAY,sCAAsCvuB,MAAM,KAC7D7I,KAAKq3B,gBAAkB,KACvBr3B,KAAKs3B,SAAW17B,IAAIF,EAAK,YAAY,GACrCsE,KAAKu3B,YAAc37B,IAAIF,EAAK,cAAe87B,EAC3C,IAAIC,GAAkBhvB,IAAI/M,EAAK,kBAC/B+7B,GAAgBrgB,MAAMpX,QAIxBm3B,GAAsB72B,OACrBlD,KAAO,SAAUkB,EAAQwF,GACxB9D,KAAK8D,OAASA,GAAU9D,KAAK8D,OAC7B9D,KAAKyB,IAAIlH,GAAG+G,SACXo2B,UAAY,GAAIn9B,IAAGmG,aACnBoG,QAAU,GAAIvM,IAAGmG,cACfV,KAAKs3B,UACP1wB,UAAY,EACZC,UAAY,EACZL,OAAS5K,IAAI0C,EAAQ,SAAU,GAC/BmI,SAAW7K,IAAI0C,EAAQ,WAAY,UAEpC0B,KAAKq3B,gBAAmBr3B,KAAKs3B,SAA4Bt3B,KAAKw1B,UAAUmC,OAAO33B,KAAKo3B,WAA5Cp3B,KAAKw1B,WAE9CzuB,kBAAoB,SAAUzI,GAC7B,GAAIiC,GAAOP,KACPq3B,EAAkB92B,EAAK82B,gBAAgBtuB,KAAK,IAChD7K,GAAEC,KAAKG,EAAQ,SAAU2I,EAAGC,GACvBmwB,EAAgBlwB,QAAQD,GAAK,IAChC3G,EAAKkB,IAAIyF,EAAGD,MAIfG,eAAiB,WAChB,GAAI7G,GAAOP,KACP/B,IAIJ,OAHAC,GAAEC,KAAKoC,EAAK82B,gBAAiB,SAAUnwB,GACtCjJ,EAAIiJ,GAAK3G,EAAK4B,IAAI+E,KAEZjJ,GAERoJ,gBAAkB,SAAUxI,EAAM2H,GACjC,GAAIjG,GAAOP,KACV43B,EAAWr3B,EAAK4B,IAAI,aACpBmF,EAAS/G,EAAK4B,IAAI,UACnBqE;EAASjG,EAAK+2B,SAAW9wB,EAAS,CAClC,IAAIqxB,GAAY35B,EAAEkG,IAAIvF,EAAM,SAAUguB,GACrC,GAAI1kB,GAAK3B,EAAS,IAAMjM,GAAG4N,KAC1B2vB,EAAU,GAAIv3B,GAAKg3B,YAAYh9B,GAAG+G,QAAQurB,GACzCkL,OAAW5vB,IAGb,OADAyvB,GAASv2B,SAAS8G,EAAI2vB,GACf3vB,GAERb,GAAOjG,SAASmF,EAAQqxB,IAEzBlwB,eAAiB,WAChB3H,KAAK43B,SAAShwB,QACd5H,KAAKsH,OAAOM,SAEblB,KAAO,SAAUpI,EAAQ/B,GACxB,GAAIgE,GAAOP,IACXO,GAAKwG,kBAAkBzI,GACvBiC,EAAKvE,WAAWuE,EAAK6G,iBAAkB,SAAU5K,GAC1B,OAAlBA,EAAIwC,YACPuB,EAAK8G,gBAAgBzL,IAAIY,EAAK,mBAAqBZ,IAAIY,EAAK,qBAC5D+D,EAAKwG,kBAAkBnL,IAAIY,EAAK,kBAEhCkD,GACC9C,IAAMhB,IAAIY,EAAK,YAAa,IAC5B7B,KAAO,WAGT4B,EAAKgE,MAGPy3B,mBAAqB,SAAUxxB,GAC9B,GAAIjG,GAAOP,KACV43B,EAAWr3B,EAAK4B,IAAI,aACpBmF,EAAS/G,EAAK4B,IAAI,UACnBqE,GAAUjG,EAAK+2B,SAAe9wB,EAAJ,CAC1B,IAAIvI,GAAMC,EAAEkG,IAAIwzB,EAAS/vB,UAAUP,EAAOnF,IAAIqE,IAAU,SAAUsxB,GACjE,MAAOA,GAAQv1B,UAIhB,OAFA9E,SAAQsB,KAAK,YACbtB,QAAQsB,KAAKd,GACNA,GAERg6B,mBAAqB,SAAU9vB,GAC9B,GAAI5H,GAAOP,KACV43B,EAAWr3B,EAAK4B,IAAI,YACrB,OAAOy1B,GAASz1B,IAAIgG,IAErB+vB,gBAAkB,SAAUz1B,GAC3B,GAAIlI,GAAGyH,QAAQS,GAAS,MAAO,KAC/B,IAAIkV,GAAI3X,KAAK8D,OACTkpB,EAAI9uB,EAAEpC,KAAK6b,EAAG,SAAU7O,GAC3B,MAAOlN,KAAIkN,EAAI,WAAarG,GAE7B,OAAOuqB,MAIT/wB,QAAQk8B,MAAMhB,sBAAwBA,CAGtC,IAAIK,GAAuB33B,OAAOC,UACjCC,YAAc,SAAUq4B,GACvBp4B,KAAKyB,IAAI22B,KAGXZ,GAAqBl3B,UAGrBrE,QAAQk8B,MAAMX,qBAAuBA,GACnCh4B,OAAQC,QAAS,WACnBlF,GAAGC,GAAG,gBACN,IAII69B,IAJap8B,QAAQS,GAAGiD,cACf1D,QAAQS,GAAGC,SAItB7B,IAAM,SAAUD,IAAM,GAAIqT,MAAQ,OAClCpT,IAAM,WAAYD,IAAM,GAAIqT,MAAQ,SACpCpT,IAAM,UAAWD,IAAM,GAAIqT,MAAQ,QACnCpT,IAAM,WAAYD,IAAM,GAAIqT,MAAQ,SACpCpT,IAAM,YAAaD,IAAM,GAAIqT,MAAQ,SACrCpT,IAAM,cAAeD,IAAM,GAAIqT,MAAQ,SACvCpT,IAAM,aAAcD,IAAM,GAAIqT,MAAQ,SACtCpT,IAAM,eAAgBD,IAAM,GAAIqT,MAAQ,UACxCpT,IAAM,eAAgBD,IAAM,GAAIqT,MAAQ,YACxCpT,IAAM,oBAAqBD,IAAM,GAAIqT,MAAQ,UAC7CpT,IAAM,QAASD,IAAM,GAAIqT,MAAQ,SACjCpT,IAAM,wBAAyBD,IAAM,GAAIqT,MAAQ,SACjDpT,IAAM,aAAcD,IAAM,GAAIqT,MAAQ,QAEpCoqB,IACFx9B,IAAM,SAAUD,IAAM,GAAIqT,MAAQ,OAClCpT,IAAM,WAAYD,IAAM,GAAIqT,MAAQ,OACpCpT,IAAM,QAASD,IAAM,GAAIqT,MAAQ,QACjCpT,IAAM,kBAAmBD,IAAM,GAAIqT,MAAQ,WAC3CpT,IAAM,aAAcD,IAAM,GAAIqT,MAAQ,WACtCpT,IAAM,iBAAkBD,IAAM,GAAIqT,MAAQ,YAC1CpT,IAAM,iBAAkBD,IAAM,GAAIqT,MAAQ,SAC1CpT,IAAM,oBAAqBD,IAAM,GAAIqT,MAAQ,SAC7CpT,IAAM,QAASD,IAAM,GAAIqT,MAAQ,SACjCpT,IAAM,aAAcD,IAAM,GAAIqT,MAAQ,SACtCpT,IAAM,aAAcD,IAAM,GAAIqT,MAAQ,OAGpCqqB,IACFz9B,IAAM,QAASD,IAAM,GAAIqT,MAAQ,OACjCpT,IAAM,WAAYD,IAAM,GAAIqT,MAAQ,SACpCpT,IAAM,mBAAoBD,IAAM,GAAIqT,MAAQ,SAC5CpT,IAAM,WAAYD,IAAM,GAAIqT,MAAQ,SACpCpT,IAAM,YAAaD,IAAM,GAAIqT,MAAQ,SAGnCsqB,IACF19B,IAAM,WAAYD,IAAM,GAAIqT,MAAQ,OACpCpT,IAAM,UAAWD,IAAM,GAAIqT,MAAQ,OACnCpT,IAAM,kBAAmBD,IAAM,GAAIqT,MAAQ,QAC3CpT,IAAM,YAAaD,IAAM,GAAIqT,MAAQ,SACrCpT,IAAM,aAAcD,IAAM,GAAIqT,MAAQ,SACtCpT,IAAM,eAAgBD,IAAM,GAAIqT,MAAQ,WACxCpT,IAAM,eAAgBD,IAAM,GAAIqT,MAAQ,WAGtCuqB,EAAuB,SAAU/K,EAAKgL,EAAQC,GACjD,GAAIp4B,GAAOP,KACP62B,EAAM56B,QAAQmD,UAAU03B,uBAAwB8B,EAAWh9B,IAAIi7B,EAAK,QACvE7pB,EAAczM,EAAK4C,MAAMiE,iBAAkBouB,EAAYj1B,EAAK4C,MAAMqyB,UAC/D3I,GAAKtc,MAAQ,GAAIM,KAAO,IAAK5J,EAAIrL,IAAI8xB,EAAKiL,EAAQ,GACtD,QAAOA,GACN,IAAK,SACJ1xB,EAAI1G,EAAK23B,gBAAgBjxB,GACzB4lB,EAAEtc,MAAQ3U,IAAIqL,EAAG,SAAU,IAC3B4lB,EAAEhc,KAAOjV,IAAIqL,EAAG,WAAY,GAC5B,MACD,KAAK,WACJ,GAAI+lB,GAAIpxB,IAAI8xB,EAAK,aAAc,IAC9BzsB,EAAIhF,QAAQqP,OAAOutB,UAAUj9B,IAAI8xB,EAAK,UAAW,IAClDzsB,GAAI1G,GAAGyH,QAAQf,GAAK,GAAK,IAAMrF,IAAIqF,EAAG,QAAS,IAAM,IACrD+rB,EAAIzyB,GAAGyH,QAAQgrB,GAAK,GAAK,IAAMA,EAAI,IACnCH,EAAEtc,MAAQ3U,IAAI8xB,EAAK,SAAU,IAC7Bb,EAAEhc,KAAO5J,EAAIhG,EAAI+rB,CACjB,MACD,KAAK,YACL,IAAK,eACL,IAAK,eACJH,EAAEtc,MAAQtJ,EACV4lB,EAAEhc,KAAOtW,GAAGmyB,KAAKC,gBAAgB1wB,QAAQqP,OAAO6mB,oBAAoBlrB,GAAI,mBACxE,MACD,KAAK,cACJA,EAAIhL,QAAQqP,OAAOwtB,eAAe7xB,GAClC4lB,EAAEtc,MAAQ3U,IAAIqL,EAAG,QAAS,IAC1B4lB,EAAEhc,KAAOjV,IAAIqL,EAAG,QAAS,GACzB,MACD,KAAK,WACJ4lB,EAAEtc,MAAQtJ,EACV4lB,EAAEhc,KAAOtW,GAAGmyB,KAAKC,gBAAgB1wB,QAAQqP,OAAO6mB,oBAAoBlrB,GAAI,aACxE,MACD,KAAK,QACJ4lB,EAAEtc,MAAQmoB,EACV7L,EAAEhc,KAAO6nB,EAAS,CAClB,MACD,KAAK,YACJ7L,EAAEtc,MAAQtJ,EACV4lB,EAAEhc,KAAO5J,EAAI,SAAWrL,IAAI8xB,EAAK,WAAY,GAC7C,MACD,KAAK,WACJb,EAAEtc,MAAQtJ,GAAK,EACf4lB,EAAEhc,KAAO5U,QAAQqP,OAAO4M,KAAKqe,YAAYt6B,QAAQqP,OAAO4M,KAAK6gB,IAAIlM,EAAEtc,MAAO3U,IAAI8xB,EAAK,YAAa,IAChG,MACD,KAAK,UACJb,EAAEtc,MAAQtJ,EACV4lB,EAAEhc,KAAOjV,IAAIK,QAAQqP,OAAOutB,UAAUj9B,IAAI8xB,EAAK,UAAW,KAAM,QAAS,GACzE,MACD,KAAK,aACJ,GAAgB,cAAZkL,EACH/L,GACClyB,KAAO,SACP8qB,OAEEvX,MAAQ,OACR8qB,KAAO,sBACPn+B,IAAM,GACNsN,GAAKvM,IAAI8xB,EAAK,WAAY,IAC1B/yB,KAAO,UAIJ,IAAgB,iBAAZi+B,GAA2C,oBAAZA,EAAiC,CAC1E,GAAIK,GAAgB,oBAAZL,EAAiC,gBAAkB,aAC1Dt6B,EAASJ,EAAEkG,IAAIoxB,EAAW,SAAUtuB,GACnC,MAAOtL,KAAIoR,EAAa9F,EAAG,MAE5B8xB,EAAO,EACE,eAALC,IACH36B,EAASA,EAAOq5B,QAAQ,GAAG,GAAG,GAAG,MAElCqB,EAAO/8B,QAAQmD,UAAUC,WAAW45B,EAAG36B,GACxCuuB,GACClyB,KAAO,SACP8qB,OAEEvX,MAAQ,OACR8qB,KAAOA,EACPn+B,IAAM,GACNsN,GAAK,GACLxN,KAAO,MAKX,KACD,SACCkyB,EAAEtc,MAAQsc,EAAEhc,KAAOjV,IAAI8xB,EAAKiL,EAAQ,IAGtC,MAAO9L,GAQR5wB,SAAQk8B,MAAMe,8BAAgC,SAAUhpB,GACvD,GAAI3P,GAAOP,KACPnF,EAAM,YACTswB,EAAS,4BACTC,EAAaiN,EACV5K,EAAoB,SAAUC,EAAKtU,GACtC,GAAIuU,GAAUzvB,EAAEkG,IAAIgnB,EAAY,SAAUtiB,GACzC,MAAOlN,KAAIkN,EAAI,MAAO,MAGnB8kB,GAAO/yB,IAAM,GAAIF,KAAO,QACxB0wB,EAAOntB,EAAEkG,IAAIupB,EAAS,SAAUzmB,GACnC,GAAI2lB,GAAI4L,EAAqBrhB,MAAM7W,GAAOmtB,EAAKtU,EAAKlS,GACpD,OAAO3M,IAAG+G,QAAQssB,EAAKf,IAExB,OAAOxB,IAEJG,EAAOttB,EAAEkG,IAAI8L,EAAS,SAAUwd,EAAKtU,GACxC,OACCve,IAAM,GACNwwB,KAAOoC,EAAkBC,EAAKtU,KAGhC,QACCve,IAAMA,EACNswB,OAASA,EACTI,MAAQH,EACRI,KAAOA,IAQTvvB,QAAQk8B,MAAMgB,8BAAgC,SAAUjpB,GACvD,GAAI3P,GAAOP,KACP62B,EAAM56B,QAAQmD,UAAU03B,uBACxB8B,EAAWh9B,IAAIi7B,EAAK,QAGpBh8B,GAFc0F,EAAK4C,MAAMiE,iBACb7G,EAAK4C,MAAMqyB,UACjB,aACTrK,EAAS,4BACTC,EAAa7wB,GAAGy1B,MAAMsI,EACP,qBAAZM,IACHxN,EAAaltB,EAAEkG,IAAIgnB,EAAY,SAAUtiB,GACxC,GAAIhO,GAAMc,IAAIkN,EAAI,MAAO,GAMzB,OALW,YAAPhO,IACHgO,EAAKvO,GAAG+G,QAAQwH,GACfhO,IAAM,WAAYD,IAAM,GAAIqT,MAAQ,UAG/BpF,IAGT,IAAI2kB,GAAoB,SAAUC,EAAKtU,GACtC,GAAIuU,GAAUzvB,EAAEkG,IAAIgnB,EAAY,SAAUtiB,GACzC,MAAOlN,KAAIkN,EAAI,MAAO,MAGnB8kB,GAAO/yB,IAAM,GAAIF,KAAO,QACxB0wB,EAAOntB,EAAEkG,IAAIupB,EAAS,SAAUzmB,GACnC,GAAI2lB,GAAI4L,EAAqBrhB,MAAM7W,GAAOmtB,EAAKtU,EAAKlS,GACpD,OAAO3M,IAAG+G,QAAQssB,EAAKf,IAExB,OAAOxB,IAEJG,EAAOttB,EAAEkG,IAAI8L,EAAS,SAAUwd,EAAKtU,GACxC,OACCve,IAAM,GACNwwB,KAAOoC,EAAkBC,EAAKtU,KAGhC,QACCve,IAAMA,EACNswB,OAASA,EACTI,MAAQH,EACRI,KAAOA,IAQTvvB,QAAQk8B,MAAMiB,4BAA8B,SAAUlpB,GACrD,GAAI3P,GAAOP,KACPnF,EAAM,YACTswB,EAAS,4BACTC,EAAamN,EACV9K,EAAoB,SAAUC,EAAKtU,GACtC,GAAIuU,GAAUzvB,EAAEkG,IAAIgnB,EAAY,SAAUtiB,GACzC,MAAOlN,KAAIkN,EAAI,MAAO,MAGnB8kB,GAAO/yB,IAAM,GAAIF,KAAO,QACxB0wB,EAAOntB,EAAEkG,IAAIupB,EAAS,SAAUzmB,GACnC,GAAI2lB,GAAI4L,EAAqBrhB,MAAM7W,GAAOmtB,EAAKtU,EAAKlS,GACpD,OAAO3M,IAAG+G,QAAQssB,EAAKf,IAExB,OAAOxB,IAEJG,EAAOttB,EAAEkG,IAAI8L,EAAS,SAAUwd,EAAKtU,GACxC,OACCve,IAAM,GACNwwB,KAAOoC,EAAkBC,EAAKtU,KAGhC,QACCve,IAAMA,EACNswB,OAASA,EACTI,MAAQH,EACRI,KAAOA,IASTvvB,QAAQk8B,MAAMkB,uBAAyB,SAAUnpB,GAChD,GAAI3P,GAAOP,KACPnF,EAAM,YACTswB,EAAS,4BACTC,EAAaoN,EACV/K,EAAoB,SAAUC,EAAKtU,GACtC,GAAIuU,GAAUzvB,EAAEkG,IAAIgnB,EAAY,SAAUtiB,GACzC,MAAOlN,KAAIkN,EAAI,MAAO,MAGnB8kB,GAAO/yB,IAAM,GAAIF,KAAO,QACxB0wB,EAAOntB,EAAEkG,IAAIupB,EAAS,SAAUzmB,GACnC,GAAI2lB,GAAI4L,EAAqBrhB,MAAM7W,GAAOmtB,EAAKtU,EAAKlS,GACpD,OAAO3M,IAAG+G,QAAQssB,EAAKf,IAExB,OAAOxB,IAEJG,EAAOttB,EAAEkG,IAAI8L,EAAS,SAAUwd,EAAKtU,GACxC,OACCve,IAAM,GACNwwB,KAAOoC,EAAkBC,EAAKtU,KAGhC,QACCve,IAAMA,EACNswB,OAASA,EACTI,MAAQH,EACRI,KAAOA,IASTvvB,QAAQk8B,MAAMmB,uBAAyB,SAAUz6B,GAChD,GAAI0B,GAAOP,IACXO,GAAKg5B,QAAQtsB,QACb1M,EAAKg5B,QAAQx0B,KAAKxE,EAAK4B,IAAI,aAAatD,IAGzC,IAAI26B,GAAuB35B,OAAOC,UAQjCC,YAAc,SAAUrE,GACvBsE,KAAKxC,WAAa,KAClBwC,KAAKyJ,WAAa,KAClBzJ,KAAKu5B,QAAU,KACfv5B,KAAK2J,OAAS,KACd3J,KAAKyB,IAAI,sBAAuBgH,IAAI/M,EAAK,wBACzCsE,KAAKyB,IAAI,eAAgBgH,IAAI/M,EAAK,iBAClCsE,KAAKy5B,iBAGPD,GAAqBl5B,OAQpBlD,KAAO,SAAU1B,GAGhB,GAFAsE,KAAKxC,WAAa5B,IAAIF,EAAK,YAAa,MACxCsE,KAAKmD,MAAQvH,IAAIF,EAAK,QAAS,OAC1BsE,KAAKxC,aAAewC,KAAKmD,MAC7B,KAAK,+BAGNnD,MAAK4J,cAEN6vB,aAAe,WACd,GAAI5vB,GAAYrG,WAAWC,QAAQxH,QAAQyH,OAAOvB,IAAI,yBACrDu3B,EAAYl2B,WAAWC,QAAQxH,QAAQyH,OAAOvB,IAAI,qBACnDqB,YAAWI,gBAAgB,UAAW3H,QAAQyH,OAAOvB,IAAI,0BACzDqB,WAAWwgB,eAAe,aAAc,SAAUC,EAAaxJ,GAC9D,MAAQwJ,IAAexJ,EAAQyJ,KAAKvpB,KAAQ8f,EAAQkD,GAAG3d,MAAQya,EAAQ0J,QAAQnkB,QAEhFA,KAAKyB,KACJoI,UAAYA,EACZ6vB,UAAYA,KAGd9vB,WAAa,WACZ,GAAIC,GAAY7J,KAAKmC,IAAI,aACrB2H,EAAMD,GACV7J,MAAKxC,WAAWiI,OAAOqE,GACvB9J,KAAKyJ,WAAazJ,KAAKxC,WAAW1B,KAAK,cACvCkE,KAAKu5B,QAAUv5B,KAAKxC,WAAW1B,KAAK,mBACpCkE,KAAK2J,OAAS3J,KAAKxC,WAAW1B,KAAK,mBACnCkE,KAAK+J,YACL/J,KAAKhD,aAEN+M,UAAY,SAAUzL,GACrB,GAAIiC,GAAOP,IACX,IAAKO,EAAK4C,MAAMm0B,SAAhB,CACA,GAAIttB,IAAWC,MAAQ,EAAGC,KAAO,EAAGC,WAAa,GAAIC,OAAQ,EAC7DpK,MAAK2J,OAAOU,QAAQ9P,GAAG+G,QAAQ0I,EAAS1L,MAEzCtB,UAAY,WACX,GAAIuD,GAAOP,IACXO,GAAK4C,MAAMm0B,UAAY/2B,EAAKoJ,OAAOhL,GAAG,OAAQ,SAAUzB,EAAGsJ,GAC1D,GAAIlI,GAASiC,EAAK4C,MAAMiE,gBACxB9I,GAAe,OAAIkI,EACnBjG,EAAK4C,MAAME,KAAK,OAAQ9I,GAAG+G,QAAQhD,GAClCkI,OAAS5K,IAAI0C,EAAQ,SAAU,GAC/BmI,SAAW7K,IAAI0C,EAAQ,WAAY,UAItC2M,cAAgB,WACf,GAAI8pB,GAAQ/0B,KAAKmC,IAAI,uBACjBlE,EAAM1D,GAAGkpB,KAAKsR,GAASA,EAAM3d,MAAMpX,KAAM25B,WAAa,IAC1D,OAAO17B,IAER27B,cAAgB,WACf,GAAIC,GAAW75B,KAAKmC,IAAI,eACxB5H,IAAGkpB,KAAKoW,IAAaA,EAASziB,MAAMpX,KAAM25B,YAE3C5sB,OAAS,WACR,GAAIxM,GAAOP,KACVmD,EAAQ5C,EAAK4C,MACbm0B,EAAWn0B,EAAMm0B,SACjBtqB,EAAc7J,EAAMiE,iBACpBZ,EAAS5K,IAAIoR,EAAa,SAAU,GACjCkD,EAAU/M,EAAM60B,mBAAmBxxB,GACnC1B,EAAavE,EAAK0K,cAAciF,EACpC3P,GAAKq5B,cAAc90B,GACnBwyB,GAAY/2B,EAAKwJ,WAChBE,MAAQ9G,EAAMhB,IAAI,aAClB+H,KAAO/G,EAAMhB,IAAI,UACjBhD,KAAO,yBAGT+4B,gBAAkB,SAAUz1B,GAC3B,GAAIlC,GAAOP,KACPa,EAAIN,EAAK4C,MAAM+0B,gBAAgBz1B,EACnC,OAAO5B,MAIT5E,QAAQk8B,MAAMqB,qBAAuBA,GACnCh6B,OAAQC,QAiCV,WACAlF,GAAGC,GAAG,gBACN,IAGIs/B,IAHa79B,QAAQS,GAAGiD,cACf1D,QAAQS,GAAGC,OAEEkD,OAAOC,UAShCC,YAAc,SAAUrE,GAOvB,GANAsE,KAAKyB,KACJwE,YAAchK,QAAQiK,mBAEvBlG,KAAKrE,UAAYC,IAAIF,EAAK,YAAa,MACvCsE,KAAKoG,KAAOxK,IAAIF,EAAK,OAAQ,MAC7BsE,KAAKmD,MAAQvH,IAAIF,EAAK,QAAS,OAC1BsE,KAAKoG,OAASpG,KAAKmD,QAAUnD,KAAKrE,UACtC,KAAK,0BAENqE,MAAKI,SAAU,EACfJ,KAAKhD,eAGP88B,GAAoBx5B,OACnBlD,KAAO,SAAUkB,GAChB0B,KAAKmD,MAAM/F,KAAKxB,IAAI0C,EAAQ,aAAe1C,IAAI0C,EAAQ,SAAU,OACjE0B,KAAKoG,KAAKhJ,MACT+F,MAAQnD,KAAKmD,MACbxH,UAAYqE,KAAKrE,YAElBqE,KAAKI,SAAU,GAEhByB,SAAW,WAAa,MAAO7B,MAAKI,SACpCpD,UAAY,WACXgD,KAAKrB,IACJ+H,KAAO,SAAUpI,GAChB,GAAIiC,GAAOP,IACNO,GAAKsB,YACTtB,EAAKnD,KAAKkB,GAEXiC,EAAK4C,MAAME,KAAK,OAAQzH,IAAI0C,EAAQ,gBAEnC0B,MACHA,KAAKmD,MAAMxE,IACV+H,KAAO,SAAUpI,GAChB,GAAIiC,GAAOP,KACPzD,EAAO,WACVgE,EAAK6F,KAAK/C,KAAK,UAEhB9C,GAAK4C,MAAMuD,KAAKpI,EAAQ/B,KAEvByD,MACHA,KAAKoG,KAAKzH,IACToO,OAAS,WACR,GAAIxM,GAAOP,IACXO,GAAK6F,KAAK2G,WAET/M,SAIL/D,QAAQk8B,MAAM2B,oBAAsBA,GAClCt6B,OAAQC,QAAS,WACnBlF,GAAGC,GAAG,gBACWyB,SAAQS,GAAGiD,cACf1D,QAAQS,GAAGC,MAExBV,SAAQk8B,MAAMV,gBAAkB,WAC/B,GAAIZ,GAAM56B,QAAQmD,UAAU03B,uBACxBv2B,EAAOP,KACP+5B,EAAYn+B,IAAIi7B,EAAK,aACrBrB,EAAYj1B,EAAKi1B,UACjBl3B,EAASJ,EAAE87B,OAAOxE,EAAWuE,EACjCx5B,GAAKkB,IAAInD,GAGV,IAAIsB,GAAa3D,QAAQ2G,KAAKhD,WAAWE,UASxCC,YAAc,SAAUrE,GAEvBsE,KAAKC,cACLD,KAAKE,aACLF,KAAKG,aACLH,KAAKw1B,UAAY55B,IAAIF,EAAK,gBAE1BsE,KAAKI,SAAU,EACfJ,KAAKhE,WAAaC,QAAQC,OAAOmE,kBACjC,IAAIo3B,GAAkBhvB,IAAI/M,EAAK,kBAC/B+7B,GAAgBrgB,MAAMpX,QAGxBJ,GAAWU,OACVyF,eAAiB,WAChB,GAAIxF,GAAOP,KACPi6B,EAAO/7B,EAAEkG,IAAI7D,EAAKi1B,UAAW,SAAUtuB,GAC1C,MAAO3G,GAAK4B,IAAI+E,KAEb5I,EAASJ,EAAE87B,OAAOz5B,EAAKi1B,UAAWyE,EAGtC,OAFAx8B,SAAQsB,KAAK,2BACbtB,QAAQsB,KAAKT,GACNA,KAITrC,QAAQk8B,MAAMv4B,WAAaA,GACzBJ,OAAQC,QAAS,SAAWnF,GAC9BC,GAAGC,GAAG,gBACWyB,SAAQS,GAAGiD,cACf1D,QAAQS,GAAGC,MAMxBV,SAAQk8B,MAAM+B,iBACb3G,WACC54B,KAAO,UACPuT,MAAQ,KACR7S,KACCV,KAAO,iBAEP+lB,WAAa,GACbI,UACCY,MAAQ,aACR1mB,gBAGFM,KACCX,KAAO,iBAEP+lB,WAAa,GACbI,UACCY,MAAQ,aACR1mB,iBAIHyH,QACC9H,KAAO,QACPuT,MAAQ,KACRwS,WAAa,GACbjG,WACAqG,UACC9lB,gBAGFwM,QACC7M,KAAO,QACPuT,MAAQ,KACRwS,WAAa,GACbjG,WACAqG,UACC9lB,gBAGFq3B,aACC13B,KAAO,QACPuT,MAAQ,KACRwS,WAAa,GACbjG,QAAUxe,QAAQuR,QAAQ2sB,YAC1BrZ,UACC9lB,gBAGFy5B,YACC95B,KAAO,UACPuT,MAAQ,KACR7S,KACCV,KAAO,OAGP+lB,WAAa,GACbI,UACC9lB,YACCiX,SACC/W,QAAS,WAEV+lB,aACCC,WAAY,EACZ3Q,MAAQ,EACRrV,QAAU,iBAKdI,KACCX,KAAO,OAGP+lB,WAAa,GACbI,UACC9lB,YACCiX,SACC/W,QAAS,WAEV+lB,aACCC,WAAY,EACZ3Q,MAAQ,EACRrV,QAAU,kBAMfoxB,SACC3xB,KAAO,OACPuT,MAAQ,MACRwS,WAAa,GACbI,UACC9lB,YACCiX,SACC/W,QAAS,eAKbk/B,YACCz/B,KAAO,OACPuT,MAAQ,MACRwS,WAAa,GACbI,UACC9lB,YACCiX,SACC/W,QAAS,gBAKb+3B,iBACCt4B,KAAO,OACPuT,MAAQ,MACRwS,WAAa,GACbI,UACC9lB,YACCiX,SACC/W,QAAS,gBAKb0c,kBACCjd,KAAO,OACPuT,MAAQ,OACRwS,WAAa,GACbI,UACC9lB,gBAGFg4B,UACCr4B,KAAO,OACPuT,MAAQ,MACRwS,WAAa,GACbI,UACC9lB,gBAGF8pB,QACCnqB,KAAO,SACPE,IAAM,4BACNqT,MAAQ,MAGV,IAAImsB,GAAiB,GAAI9/B,IAAGmG,YAC5BxC,GAAEC,KAAKlC,QAAQk8B,MAAM+B,gBAAiB,SAAUpxB,EAAI5B,GACnD,GAAIvM,GAAOiB,IAAIkN,EAAI,QACfka,EAAW,0CACf,IAAY,WAARroB,EAAmB,CACtB,GAAIwN,GAAK8a,MAAQ/b,EAAI,QAAU3M,GAAG4N,KAAM+a,EAAQhc,EAAI,QAAU3M,GAAG4N,KAChEgb,EAAe,aAALjc,EAAmB,YAAc,eAC3Ckc,EAAe,aAALlc,EAAmB,UAAY,eACzC7L,EAAMd,GAAG+G,QAAQ1F,IAAIkN,EAAI,WACxBX,GAAK8a,MAAOvoB,KAAOyoB,EAAStoB,IAAM,+BAC/BS,EAAMf,GAAG+G,QAAQ1F,IAAIkN,EAAI,WAC5BX,GAAK+a,EAAOxoB,KAAO0oB,EAASvoB,IAAM,8BAEpCw/B,GAAeh5B,SAAS6F,EAAG3M,GAAG+G,QAAQwH,GACrCX,GAAKA,EACL6a,SAAW,2CACX3nB,IAAMA,EACNC,IAAMA,SAGP++B,GAAeh5B,SAAS6F,EAAG3M,GAAG+G,QAAQwH,GACrCX,GAAKjB,EAAI,IAAM3M,GAAG4N,KAClBzN,KAAOwM,EACP8b,SAAWA,GACW,WAApBpnB,IAAIkN,EAAI,SAAwBjO,IAAM,8BAAgC,SAQ3EoB,QAAQk8B,MAAMmC,4BAA8B,WAC3C,GAAI/5B,GAAOP,KAEPuG,GADYhG,EAAK4C,MAAMqyB,WACdnK,OAEXC,OAAS,WACTnnB,MAAQk2B,EAAexyB,WAAW,YAAa,iBAG/CyjB,OAAS,WACTnnB,MAAQk2B,EAAexyB,WAAW,SAAU,aAG5CyjB,OAAS,WACTnnB,MAAQk2B,EAAexyB,WAAW,cAAe,cAGjDyjB,OAAS,WACTnnB,MAAQk2B,EAAexyB,WAAW,iBAGlCyjB,OAAS,2BACTnnB,MAAQk2B,EAAexyB,WAAW,cAGpC,QACCtB,MAAQA,IAQVtK,QAAQk8B,MAAMoC,gCAAkC,WAC/C,GAAIh6B,GAAOP,KAEPuG,GADYhG,EAAK4C,MAAMqyB,WACdnK,OAEXC,OAAS,WACTnnB,MAAQk2B,EAAexyB,WAAW,gBAGlCyjB,OAAS,WACTnnB,MAAQk2B,EAAexyB,WAAW,aAGlCyjB,OAAS,WACTnnB,MAAQk2B,EAAexyB,WAAW,aAGlCyjB,OAAS,WACTnnB,MAAQk2B,EAAexyB,WAAW,kBAGlCyjB,OAAS,WACTnnB,MAAQk2B,EAAexyB,WAAW,cAGpC,QACCtB,MAAQA,IAQVtK,QAAQk8B,MAAMqC,gCAAkC,WAC/C,GAAIj6B,GAAOP,KAEPuG,GADYhG,EAAK4C,MAAMqyB,WACdnK,OAEXC,OAAS,WACTnnB,MAAQk2B,EAAexyB,WAAW,aAGlCyjB,OAAS,WACTnnB,MAAQk2B,EAAexyB,WAAW,aAGlCyjB,OAAS,WACTnnB,MAAQk2B,EAAexyB,WAAW,gBAGlCyjB,OAAS,WACTnnB,MAAQk2B,EAAexyB,WAAW,uBAGlCyjB,OAAS,WACTnnB,MAAQk2B,EAAexyB,WAAW,cAGpC,QACCtB,MAAQA,IAQVtK,QAAQk8B,MAAMsC,4BAA8B,WAC3C,GAAIl6B,GAAOP,KAEPuG,GADYhG,EAAK4C,MAAMqyB,WACdnK,OAEXC,OAAS,WACTnnB,MAAQk2B,EAAexyB,WAAW,aAGlCyjB,OAAS,WACTnnB,MAAQk2B,EAAexyB,WAAW,aAGlCyjB,OAAS,WACTnnB,MAAQk2B,EAAexyB,WAAW,gBAIlCyjB,OAAS,WACTnnB,MAAQk2B,EAAexyB,WAAW,sBAGlCyjB,OAAS,WACTnnB,MAAQk2B,EAAexyB,WAAW,eAGlCyjB,OAAS,2BACTnnB,MAAQk2B,EAAexyB,WAAW,cAGpC,QACCtB,MAAQA,GAIV,IAAI1D,GAAYhD,OAAOC,UAOtBC,YAAc,SAAUrE,GACvBsE,KAAKI,SAAU,EACfJ,KAAKxC,WAAa,KAClBwC,KAAK+C,UAAY,KACjB/C,KAAKkD,gBACLlD,KAAKyB,IAAI,kBAAmBgH,IAAI/M,EAAK,sBAIvCmH,GAAUvC,OACTlD,KAAO,SAAU1B,GAGhB,GAFAsE,KAAKmD,MAAQvH,IAAIF,EAAK,QAAS,MAC/BsE,KAAKxC,WAAa5B,IAAIF,EAAK,YAAa,OACnCsE,KAAKmD,QAAUnD,KAAKxC,YAAwC,GAA1BwC,KAAKxC,WAAWjC,OACtD,KAAK,0BAGNyE,MAAKoD,eACLpD,KAAKhD,YACLgD,KAAKI,SAAU,EACfJ,KAAKqD,KAAK,QAASrD,KAAK+F,mBAGzBlE,SAAW,WAAa,MAAO7B,MAAKI,SACpC8C,cAAgB,WACf,GACI2G,GAAYrG,WAAWC,QAAQxH,QAAQyH,OAAOvB,IAAI,0BACrDu4B,EAAel3B,WAAWC,QAAQxH,QAAQyH,OAAOvB,IAAI,uBACtDqB,YAAWI,gBAAgB,iBAAkB3H,QAAQyH,OAAOvB,IAAI,wBAChEqB,WAAWwgB,eAAe,uBAAwB,SAAUC,EAAaxJ,GACxE,MAAQwJ,IAAexJ,EAAQyJ,KAAKvpB,KAAQ8f,EAAQkD,GAAG3d,MAAQya,EAAQ0J,QAAQnkB,QAEhFwD,WAAWwgB,eAAe,eAAgB,SAAUrD,EAAQC,EAAQnG,GACnE,MAASkG,IAAWC,EAAkCnG,EAAQkD,GAAG3d,MAAnCya,EAAQ0J,QAAQnkB,QAE/CA,KAAKyB,KACJoI,UAAYA,EACZ6wB,aAAeA,KAGjBC,iBAAmB,WAClB,GAAIp6B,GAAOP,KACV46B,EAAMr6B,EAAK4C,MAAM4C,iBACjBtD,EAAS7G,IAAIg/B,EAAK,SAAU,IAC5BpzB,EAAS5L,IAAIg/B,EAAK,SAAU,GAC7Br6B,GAAKs6B,kBAAkBp4B,GACvBlC,EAAKu6B,kBAAkBr4B,EAAQ+E,GAC/BtJ,EAAEC,KAAKy8B,EAAK,SAAU3zB,EAAGC,IACf,aAALA,GAAyB,WAALA,KACvBD,EAAI1M,GAAGyH,QAAQiF,GAAK,GAAK1M,GAAGmyB,KAAKC,gBAAgB1wB,QAAQqP,OAAO6mB,oBAAoBlrB,GAAI,eAEzF1G,EAAKwC,UAAUjH,KAAK,SAAWoL,EAAI,KAAK9L,IAAI6L,MAG9C4zB,kBAAoB,SAAUE,GAC7B,GAAIx6B,GAAOP,KACV8D,EAASvD,EAAK4C,MAAMrB,WACrB,KAAIvH,GAAGyH,QAAQ8B,GAAf,CACAA,EAAS5F,EAAEkG,IAAIN,EAAQ,SAAUC,GAChC,GAAIoE,GAAKvM,IAAImI,EAAM,SAAU,IAAKrJ,EAAOkB,IAAImI,EAAM,WAAY,GAC/D,QACCwM,MAAQpI,EACR+F,MAAQxT,EACR6qB,SAAWpd,GAAM4yB,EAAY,WAAa,MAG5Cj3B,EAAOwB,SACNiL,MAAQ,GACRrC,MAAQ,KACRqX,SAAWhrB,GAAGyH,QAAQ+4B,GAAa,WAAa,IAEjD,IAAIC,GAASz6B,EAAK4B,IAAI,gBACrB2H,EAAMkxB,GACLC,KAAOn3B,IAER8M,EAAUrQ,EAAKwC,UAAUjH,KAAK,sBAC/B8U,GAAQ7L,KAAK+E,KAEdgxB,kBAAoB,SAAUC,EAAWG,GACxC,GAAI36B,GAAOP,KACViE,EAAQ1J,GAAGyH,QAAQ+4B,GAAax6B,EAAK4C,MAAMf,WAAa7B,EAAK4C,MAAMX,iBAAiBu4B,EACrF,KAAIxgC,GAAGyH,QAAQiC,GAAf,CACAA,EAAQ/F,EAAEkG,IAAIH,EAAO,SAAUI,GAC9B,GAAI8D,GAAKvM,IAAIyI,EAAM,SAAU,IAAK3J,EAAOkB,IAAIyI,EAAM,WAAY,GAC/D,QACCkM,MAAQpI,EACR+F,MAAQxT,EACR6qB,SAAWpd,GAAM+yB,EAAY,WAAa,MAG5Cj3B,EAAMqB,SACLiL,MAAQ,GACRrC,MAAQ,KACRqX,SAAWhrB,GAAGyH,QAAQk5B,GAAa,WAAa,IAEjD,IAAIF,GAASz6B,EAAK4B,IAAI,gBACrB2H,EAAMkxB,GACLC,KAAOh3B,IAER2M,EAAUrQ,EAAKwC,UAAUjH,KAAK,sBAC/B8U,GAAQ7L,KAAK+E,KAEd2hB,aAAe,WACd,GAAIlrB,GAAOP,IACXO,GAAKwC,UAAUjH,KAAK,8BAA8B6vB,gBACjDC,OAAS,aACTC,UAAY,aACZC,WAAY,EACZC,QAAU,QACVC,UAAW,EACXC,gBAAiB,EACjBC,SAAW,UAEZ3rB,EAAKwC,UAAUpE,GAAG,QAAS,qBAAsB,WAChD,GAAIqW,GAAQ1a,EAAE0F,MACbmsB,EAAUnX,EAAMoX,KAAK,kCAClBD,GAAQ5wB,OAAS,GACpB4wB,EAAQR,eAAe,WAI1BrnB,oBAAsB,WACrB,GAAIywB,GAAQ/0B,KAAKmC,IAAI,kBACrB,OAAO5H,IAAGkpB,KAAKsR,IAAUA,EAAM3d,MAAMpX,OAEtCoD,aAAe,WACd,GAAI7C,GAAOP,KACV6J,EAAYtJ,EAAK4B,IAAI,aAElB2C,GADKvE,EAAK4C,MACG5C,EAAK+D,uBAClBS,EAAO8E,EAAU/E,EACrBvE,GAAKwC,UAAYzI,EAAEyK,GACnBxE,EAAK/C,WAAWuH,KAAKxE,EAAKwC,WAC1BxC,EAAKo6B,mBACLp6B,EAAKkrB,gBAENzuB,UAAY,WACX,GAAIuD,GAAOP,IACXO,GAAKwC,UAAUpE,GAAG,SAAU,SAAU,WACrC,GAAIqW,GAAQ1a,EAAE0F,MACbiH,EAAI+N,EAAM5Z,KACXmF,GAAKu6B,kBAAkB7zB,EAAG,MAE3B1G,EAAKwC,UAAUpE,GAAG,QAAS,mBAAoB,WAClCrE,EAAE0F,KACdO,GAAK8C,KAAK,QAAS9C,EAAKwF,qBAG1BA,eAAiB,WAChB,GAAIxF,GAAOP,KAEVpB,GADO2B,EAAK4C,MAAMqyB,UACVj1B,EAAKwC,UAAUjH,KAAK,SAC5B8+B,EAAMh8B,EAAM6tB,gBAcb,OAbAmO,GAAM18B,EAAEkG,IAAIw2B,EAAK,SAAU9xB,GAC1B,GAAImwB,GAAIr9B,IAAIkN,EAAI,QAAS7B,EAAIrL,IAAIkN,EAAI,QAAS,GAC9C,OAAS,aAALmwB,GAAyB,WAALA,GACvBhyB,EAAI1M,GAAGyH,QAAQiF,GAAK,GAAK1M,GAAGmyB,KAAKC,gBAAgB1lB,EAAG,mBAEnDvM,KAAOu+B,EACP1oB,MAAQtJ,IAGH6B,IAER8xB,EAAM18B,EAAE87B,OAAO97B,EAAEkD,MAAMw5B,EAAK,QAAS18B,EAAEkD,MAAMw5B,EAAK,UAClDr6B,EAAK4C,MAAM1B,IAAIm5B,GACRA,KAKT3+B,QAAQk8B,MAAMt1B,UAAYA,GACxBrD,OAAQC,QAAS,WACnBlF,GAAGC,GAAG,gBACN,IAGIwL,IAHa/J,QAAQS,GAAGiD,cACf1D,QAAQS,GAAGC,OAEFV,QAAQ2G,KAAKoD,gBAAgBlG,UAUlDC,YAAc,SAAUrE,GAQvB,GAPAsE,KAAKyB,KACJwE,YAAchK,QAAQiK,mBAEvBlG,KAAKrE,UAAYC,IAAIF,EAAK,YAAa,MACvCsE,KAAKmG,iBAAmBvK,IAAIF,EAAK,mBAAoB,MACrDsE,KAAKmD,MAAQvH,IAAIF,EAAK,QAAS,MAC/BsE,KAAKoG,KAAOxK,IAAIF,EAAK,OAAQ,QACxBsE,KAAKrE,WAAcqE,KAAKmD,OAAUnD,KAAKoG,MAASpG,KAAKmG,kBACzD,KAAK,6BAENnG,MAAK5C,UAGP4I,GAAgB1F,OAEftD,UAAY,WAEXgD,KAAKrB,IACJ0H,OAAS,WACR,GAAI9F,GAAOP,IACXO,GAAK4C,MAAMmD,UACX/F,EAAK6F,KAAKE,UACV/F,EAAKnD,QAENmJ,MAAQ,SAAUjI,GACjB,GAAIiC,GAAOP,KACP8D,EAASvD,EAAK4C,MAAMrB,WACxBrE,SAAQsB,KAAK,iBACbtB,QAAQsB,KAAKT,GACbiC,EAAK4F,kBAAoB5F,EAAK4F,iBAAiB9C,KAAK,QACnD/E,OAAS/D,GAAG+G,QAAQhD,GACnBkI,OAAS,EACTC,SAAW,KAEZ3C,OAASA,MAGT9D,MAEHA,KAAKmD,MAAMxE,IACV+H,KAAO,SAAUnK,GAChB,GAAIgE,GAAOP,KACV1B,EAAS1C,IAAI2E,EAAK4B,IAAI,eAAgB,UACvC5B,GAAK4C,MAAM/F,KAAKkB,EAAQ/B,KAEvByD,MAEHA,KAAKoG,KAAKzH,IACTvB,KAAO,WACN,GAAImD,GAAOP,IACXO,GAAK6F,KAAKhJ,MACT+F,MAAQ5C,EAAK4C,MACbL,eAAiBvC,EAAKuC,eACtBnH,UAAY4E,EAAK5E,aAInBqF,OAAS,SAAU1C,GAClB,GAAIiC,GAAOP,IACXO,GAAK8C,KAAK,QAAS/E,IAIpBiI,MAAQ,SAAUjI,GACjB,GAAIiC,GAAOP,IACXO,GAAK8C,KAAK,QAAS/E,KAElB0B,SAGL/D,QAAQk8B,MAAMnyB,gBAAkBA,GAC9BxG,OAAQC,QAAS,SAAWnF,GAC9BC,GAAGC,GAAG,gBAEN,IAAI2gC,GAAsB,WACzB,GAAItE,GAAM56B,QAAQmD,UAAU03B,uBACxBrX,EAAQnlB,EAAE,sCACdmlB,GAAMxS,OACN,IAAImuB,GAAmB,WACtB,GAAIC,GAAOn9B,EAAEkG,IAAInI,QAAQuR,QAAQ8tB,gBAAiB,SAAUr0B,GAC3D,GAAI3I,GAASJ,EAAEkG,IAAIxI,IAAIqL,EAAG,YAAc,WACvC,MAAO,IAGR,QACCs0B,OAAS3/B,IAAIi7B,EAAK,SAAW5vB,EAAEvM,KAAO,SAAW,GACjD8gC,SAAW,GACXhxB,KAAOvO,QAAQmD,UAAUC,WAAW4H,EAAEvM,KAAM4D,IAAW,IACvD5D,KAAOuM,EAAEvM,KACTwT,MAAQjH,EAAEiH,QAGZ,QACCtJ,QACCzH,OAAS,iBAEVgH,MAAQk3B,IAGNI,EAASj4B,WAAWC,QAAQxH,QAAQyH,OAAOvB,IAAI,oBACnDqB,YAAWI,gBAAgB,SAAU3H,QAAQyH,OAAOvB,IAAI,0BACxDsd,EAAM1a,KAAK,8IACX,EAAA,GAAI22B,GAAUjc,EAAM3jB,KAAK,gBACZ2jB,GAAM3jB,KAAK,eACxB4/B,EAAQ32B,KAAK02B,EAAOL,OAGjBO,EAAqB,WACd1/B,QAAQmD,UAAU03B,uBAChBx8B,EAAE,sCACd6gC,MAIGS,EAAqB,WACxB,GAAI/E,GAAM56B,QAAQmD,UAAU03B,uBACxBrX,EAAQnlB,EAAE,sCACd6gC,IACA,EAAA,GAAIU,GAAYpc,EAAM3jB,KAAK,eACvB05B,EAAY55B,IAAIsC,EAAE49B,UAAU7/B,QAAQuR,QAAQ8tB,iBAAkB5gC,KAAOkB,IAAIi7B,EAAK,UAAW,QAC5E,IAAI56B,SAAQk8B,MAAMnyB,iBAClCrK,UAAYkgC,EACZ11B,iBAAmB,GAAIlK,SAAQk8B,MAAM2B,qBACpCn+B,UAAYkgC,EACZ14B,MAAQ,GAAIlH,SAAQk8B,MAAMhB,uBACzBn7B,WAAaC,QAAQC,OAAO6/B,iBAC5BvG,UAAYA,EACZiC,gBAAkBx7B,QAAQk8B,MAAMV,kBAEjCrxB,KAAO,GAAInK,SAAQk8B,MAAMqB,sBACxBwC,oBAAsB//B,QAAQk8B,MAAMe,8BACpC+C,aAAehgC,QAAQk8B,MAAMmB,2BAG/Bn2B,MAAQ,GAAIlH,SAAQk8B,MAAMv4B,YACzB41B,UAAYA,EACZiC,gBAAkBx7B,QAAQk8B,MAAMV,kBAEjCrxB,KAAO,GAAInK,SAAQk8B,MAAMt1B,WACxBq5B,gBAAkBjgC,QAAQk8B,MAAMmC,kCAK/B6B,EAA8B,WACjC,GAAItF,GAAM56B,QAAQmD,UAAU03B,uBACxBrX,EAAQnlB,EAAE,sCACd6gC,IACA,EAAA,GAAIU,GAAYpc,EAAM3jB,KAAK,eACvB05B,EAAY55B,IAAIsC,EAAE49B,UAAU7/B,QAAQuR,QAAQ8tB,iBAAkB5gC,KAAOkB,IAAIi7B,EAAK,UAAW,QAC5E,IAAI56B,SAAQk8B,MAAMnyB,iBAClCrK,UAAYkgC,EACZ11B,iBAAmB,GAAIlK,SAAQk8B,MAAM2B,qBACpCn+B,UAAYkgC,EACZ14B,MAAQ,GAAIlH,SAAQk8B,MAAMhB,uBACzBn7B,WAAaC,QAAQC,OAAOkgC,oBAC5B5G,UAAYA,EACZiC,gBAAkBx7B,QAAQk8B,MAAMV,kBAEjCrxB,KAAO,GAAInK,SAAQk8B,MAAMqB,sBACxBwC,oBAAsB//B,QAAQk8B,MAAMgB,8BACpC8C,aAAehgC,QAAQk8B,MAAMmB,2BAG/Bn2B,MAAQ,GAAIlH,SAAQk8B,MAAMv4B,YACzB41B,UAAYA,EACZiC,gBAAkBx7B,QAAQk8B,MAAMV,kBAEjCrxB,KAAO,GAAInK,SAAQk8B,MAAMt1B,WACxBq5B,gBAAkBjgC,QAAQk8B,MAAMoC,sCAK/B8B,EAAiC,WACpC,GAAIxF,GAAM56B,QAAQmD,UAAU03B,uBACxBrX,EAAQnlB,EAAE,sCACd6gC,IACA,EAAA,GAAIU,GAAYpc,EAAM3jB,KAAK,eACvB05B,EAAY55B,IAAIsC,EAAE49B,UAAU7/B,QAAQuR,QAAQ8tB,iBAAkB5gC,KAAOkB,IAAIi7B,EAAK,UAAW,QAC5E,IAAI56B,SAAQk8B,MAAMnyB,iBAClCrK,UAAYkgC,EACZ11B,iBAAmB,GAAIlK,SAAQk8B,MAAM2B,qBACpCn+B,UAAYkgC,EACZ14B,MAAQ,GAAIlH,SAAQk8B,MAAMhB,uBACzBn7B,WAAaC,QAAQC,OAAOogC,uBAC5B9G,UAAYA,EACZiC,gBAAkBx7B,QAAQk8B,MAAMV,kBAEjCrxB,KAAO,GAAInK,SAAQk8B,MAAMqB,sBACxBwC,oBAAsB//B,QAAQk8B,MAAMgB,8BACpC8C,aAAehgC,QAAQk8B,MAAMmB,2BAG/Bn2B,MAAQ,GAAIlH,SAAQk8B,MAAMv4B,YACzB41B,UAAYA,EACZiC,gBAAkBx7B,QAAQk8B,MAAMV,kBAEjCrxB,KAAO,GAAInK,SAAQk8B,MAAMt1B,WACxBq5B,gBAAkBjgC,QAAQk8B,MAAMoC,sCAK/BgC,EAA8B,WACjC,GAAI1F,GAAM56B,QAAQmD,UAAU03B,uBACxBrX,EAAQnlB,EAAE,sCACd6gC,IACA,EAAA,GAAIU,GAAYpc,EAAM3jB,KAAK,eACvB05B,EAAY55B,IAAIsC,EAAE49B,UAAU7/B,QAAQuR,QAAQ8tB,iBAAkB5gC,KAAOkB,IAAIi7B,EAAK,UAAW,QAC5E,IAAI56B,SAAQk8B,MAAMnyB,iBAClCrK,UAAYkgC,EACZ11B,iBAAmB,GAAIlK,SAAQk8B,MAAM2B,qBACpCn+B,UAAYkgC,EACZ14B,MAAQ,GAAIlH,SAAQk8B,MAAMhB,uBACzBG,UAAW,EACXt7B,WAAaC,QAAQC,OAAOsgC,oBAC5BhH,UAAYA,EACZiC,gBAAkBx7B,QAAQk8B,MAAMV,kBAEjCrxB,KAAO,GAAInK,SAAQk8B,MAAMqB,sBACxBwC,oBAAsB//B,QAAQk8B,MAAMiB,4BACpC6C,aAAehgC,QAAQk8B,MAAMmB,2BAG/Bn2B,MAAQ,GAAIlH,SAAQk8B,MAAMv4B,YACzB41B,UAAYA,EACZiC,gBAAkBx7B,QAAQk8B,MAAMV,kBAEjCrxB,KAAO,GAAInK,SAAQk8B,MAAMt1B,WACxBq5B,gBAAkBjgC,QAAQk8B,MAAMqC,sCAK/BiC,EAA6B,WAChC,GAAI5F,GAAM56B,QAAQmD,UAAU03B,uBACxBrX,EAAQnlB,EAAE,sCACd6gC,IACA,EAAA,GAAIU,GAAYpc,EAAM3jB,KAAK,eACvB05B,EAAY55B,IAAIsC,EAAE49B,UAAU7/B,QAAQuR,QAAQ8tB,iBAAkB5gC,KAAOkB,IAAIi7B,EAAK,UAAW,QAC5E,IAAI56B,SAAQk8B,MAAMnyB,iBAClCrK,UAAYkgC,EACZ11B,iBAAmB,GAAIlK,SAAQk8B,MAAM2B,qBACpCn+B,UAAYkgC,EACZ14B,MAAQ,GAAIlH,SAAQk8B,MAAMhB,uBACzBG,UAAW,EACXt7B,WAAaC,QAAQC,OAAOwgC,wBAC5BlH,UAAYA,EACZiC,gBAAkBx7B,QAAQk8B,MAAMV,kBAEjCrxB,KAAO,GAAInK,SAAQk8B,MAAMqB,sBACxBwC,oBAAsB//B,QAAQk8B,MAAMkB,uBACpC4C,aAAehgC,QAAQk8B,MAAMmB,2BAG/Bn2B,MAAQ,GAAIlH,SAAQk8B,MAAMv4B,YACzB41B,UAAYA,EACZiC,gBAAkBx7B,QAAQk8B,MAAMV,kBAEjCrxB,KAAO,GAAInK,SAAQk8B,MAAMt1B,WACxBq5B,gBAAkBjgC,QAAQk8B,MAAMsC,iCAMnCx+B,SAAQk8B,MAAMwE,oBAAsBxB,EACpCl/B,QAAQk8B,MAAMyE,eAAiBjB,EAC/B1/B,QAAQk8B,MAAM0E,eAAiBjB,EAC/B3/B,QAAQk8B,MAAM2E,0BAA4BX,EAC1ClgC,QAAQk8B,MAAM4E,6BAA+BV,EAC7CpgC,QAAQk8B,MAAM6E,wBAA0BT,EACxCtgC,QAAQk8B,MAAM8E,uBAAyBR,GAErCj9B,OAAQC,QAAS,SAAWnF,GAU9B,QAAS4iC,KACR,GAAIC,GAAKlhC,QAAQqP,OAAO8xB,QACpBC,EAAQzhC,IAAIuhC,EAAI,KAAM,OAAgB,GAAR,EACjCG,EAAUj4B,SAASzJ,IAAIuhC,EAAI,KAAM,IAC9BI,EAAsD,GAApChjC,GAAGijC,OAAOr7B,IAAI,oBAA0B,GAAO,CACrE,KAAKk7B,GAAQE,EAAiB,OAAO,CACrC,IAAID,EAAU,EAAG,OAAO,CACxB,IAAI1gC,GAAiB,GAAX0gC,EACT,kEACA,yDACGG,IAEFt+B,KAAO,GACP4O,KAAO,GACPrT,KAAO,OACPyT,KAAO,6CAGPhP,KAAO,GACP4O,KAAO,GACPrT,KAAO,OACPyT,KAAO,8CAGPhP,KAAO,GACP4O,KAAO,GACPrT,KAAO,SACPyT,KAAO,4DAGPhP,KAAO,GACP4O,KAAO,GACPrT,KAAO,UACPyT,KAAO,iDAGL8H,EAAMzS,WAAWC,QAAQxH,QAAQyH,OAAOvB,IAAI,4BAC5Cu7B,EAAapjC,EAAE2b,GAAKrZ,IAAMA,EAAKuH,MAAQs5B,IAO3C,OANAnjC,GAAE,sBAAsBkL,SACxBk4B,EAAWxnB,SAAS5b,EAAE,SACtBojC,EAAW5hC,KAAK,QAAQ6hC,MAAM,WAC7BpjC,GAAGijC,OAAO/7B,IAAI,kBAAmB,GACjCxF,QAAQ2hC,OAAOC,WAET,EAER,QAASC,KACR,GAAIC,GAAU9hC,QAAQiK,iBACrB2D,EAAYrG,WAAWC,QAAQxH,QAAQyH,OAAOvB,IAAI,oBAC/C67B,EAAWpiC,IAAIK,QAAQqS,iBAAkB,YAAa,OAAgB,GAAR,EACjE2vB,EAAYriC,IAAImiC,EAAS,iBAAkB,IAC3CG,EAAYtiC,IAAImiC,EAAS,iBAAkB,IACxCI,EAAgB,WACnB,GAAIC,IACH9d,aAAerkB,QAAQmD,UAAUC,WAAW,YAC5Cg/B,WAAapiC,QAAQC,OAAOoiC,eAC5BL,UAAYA,EACZM,aAAetiC,QAAQmD,UAAUC,WAAW,QAC5C6+B,UAAYA,EAEZF,QAAUA,EACVQ,WAAaviC,QAAQC,OAAOuiC,qBAC5BC,KAAOziC,QAAQC,OAAOyiC,gBAAgB,SAEvC9f,GACC+f,UAAY3iC,QAAQmD,UAAUC,WAAW,UAAY,IACrDw/B,YAAc5iC,QAAQmD,UAAUC,WAAW,YAAc,IACzDy/B,UAAY7iC,QAAQC,OAAOyiC,gBAAgB,SAE5C,QACCP,OAASA,EACTvf,OAASA,IAGPkgB,EAAWzkC,EAAEuP,EAAUs0B,KAC3B7jC,GAAE,sBAAsBkL,SACpB03B,KACH6B,EAAS7oB,SAAS5b,EAAE,SAEjBA,EAAEqjB,GAAGnf,qBACRlE,EAAEqjB,GAAGnf,mBAAmBwgC,gBAAkB1kC,EAAEogB,UAAWpgB,EAAEqjB,GAAGnf,mBAAmBwgC,iBAC9E9jC,QAAS,oBACGuD,QAAS,OACrBwgC,eACCzjC,MAAQ,yBACR0jC,QAAU,6BACVC,WAAa,iCAGf7kC,EAAEqjB,GAAGnf,mBAAmBxD,WAAWyvB,UAClClrB,SAAW,SAAU6/B,EAAWC,EAAQ5kB,GACvC,GAAIgQ,GAAW7uB,IAAI6e,EAAS,WAAY,MACvCvf,EAAUU,IAAI6e,EAAS,UAAW,GACnCgQ,GAAW6U,MAAM7U,GAAY,KAAOA,CACpC,IAAIla,GAAQ8uB,EAAOjkC,MACfmkC,EAAWhlC,GAAGyH,QAAQyoB,IAAyB,GAAZA,EAAiB,SAAW,kBAAoBA,EAAW,OACjG+U,EAAO,IAER,OADAA,GAAO,GAAIC,QAAOF,GACdD,MAAM/uB,IAER/U,OAAQ,EACRN,QAAU,SAGPskC,EAAKE,KAAKnvB,IAMR,GAJL/U,OAAQ,EACRN,QAAUA,MAShB,QAASykC,KACR,GACClE,IADax/B,QAAQiK,iBACZ1C,WAAWC,QAAQxH,QAAQyH,OAAOvB,IAAI,qBAC/Cy9B,EAAep8B,WAAWC,QAAQxH,QAAQyH,OAAOvB,IAAI,0BAClDg8B,EAAgB,WACnB,GAAI9C,GAAOn9B,EAAEkG,IAAInI,QAAQuR,QAAQqyB,YAAa,SAAU54B,GACvD,OACCs0B,OAAUt/B,QAAQC,OAAO4jC,cAAc74B,EAAEvM,MAAa,SAAL,GACjD8gC,SAAW,GACXhxB,KAAOvO,QAAQmD,UAAUC,WAAW4H,EAAEvM,OAAS,IAC/CA,KAAOuM,EAAEvM,KACTwT,MAAQjH,EAAEiH,QAGZ,QAAQ/J,MAAQk3B,IAEbK,EAAUphC,EAAEmhC,EAAO0C,MACtB4B,EAAazlC,EAAEslC,GAAcziC,OAAS,kBACtC6iC,EAAU1lC,EAAE,yBACb0lC,GAAQlkC,KAAK,iCAAiC0J,SAC9Cw6B,EAAQlkC,KAAK,gBAAgB2J,OAAOi2B,GACpCsE,EAAQlkC,KAAK,gDAAgD0J,SAC7Dw6B,EAAQlkC,KAAK,iCAAiCkJ,QAAQ+6B,GAIvD,QAASE,KACR,GAICC,IAJUjkC,QAAQ+qB,iBACX/qB,QAAQqS,iBACPrS,QAAQwS,kBACLxS,QAAQkkC,qBACVlkC,QAAQmkC,uBACd3gB,EAAQnlB,EAAE,uCACV6jC,EAAgB,WACnB,GAAIkC,GAAK,GAAI9lC,IAAGmG,aACZzC,EAAM,IAWV,OAVA1D,IAAG+lC,QAAQJ,EAAQ,SAAUp3B,GAC5Bu3B,EAAGh/B,SAASyH,EAAGpO,KAAMoO,KAEtB7K,EAAMC,EAAEkG,IAAIm8B,EAAkB,SAAUz3B,GACvC,GAAIpO,GAAOkB,IAAIkN,EAAI,QACf03B,EAAYH,EAAGl+B,IAAIzH,IAAgB,GAAR,CAC/B,OAAOH,IAAG+G,QAAQwH,GACjB23B,QAAW7kC,IAAIkN,EAAI,UAAW,IAAM,KAAQ03B,EAAwB,GAAb,iBAMtDvqB,EAAMzS,WAAWC,QAAQxH,QAAQyH,OAAOvB,IAAI,sBAC5Cu+B,EAAUpmC,EAAE2b,GAAK0qB,OAASxC,MAC9B1e,GAAM1a,KAAK27B,GACXA,EAAQ/hC,GAAG,8BAA+B,cAAe,SAAUzB,GAClE,GAAI8X,GAAQ1a,EAAE0F,MAAO44B,EAAW5jB,EAAMlY,KAAK,iBAC1C8jC,EAAQ1jC,EAAEvC,IACX,OAAIqa,GAAM6rB,SAAS,aAAoB,OAC1B,SAATD,EAEH3hC,SAASC,SAASC,KAAOlD,QAAQmD,UAAUC,WAAWu5B,GAEtD5jB,EAAM2J,YAAY,YAMrB,QAASmiB,KACR,GAAI7qB,GAAMzS,WAAWC,QAAQxH,QAAQyH,OAAOvB,IAAI,mBAC5C4+B,EAAYzmC,EAAE2b,GACjB+qB,UAAY/kC,QAAQC,OAAOyiC,gBAAgB,kBAExClf,EAAQnlB,EAAE,sCACdmlB,GAAM1a,KAAKg8B,GACX9kC,QAAQqB,MAAMC,UAAUwjC,GAtMzBxmC,GAAGC,GAAG,iBACN,IAAI+lC,KACF7lC,KAAO,UAAWyjB,MAAQ,KAAMjQ,MAAQ,eAAgB+yB,SAAW,kBAAmBR,QAAU,0BAA2B1yB,KAAO,aAClIrT,KAAO,QAASyjB,MAAQ,KAAMjQ,MAAQ,UAAW+yB,SAAW,kBAAmBR,QAAU,aAAc1yB,KAAO,eAC9GrT,KAAO,OAAQyjB,MAAQ,OAAQjQ,MAAQ,WAAY+yB,SAAW,kBAAmBR,QAAU,aAAc1yB,KAAO,cAChHrT,KAAO,WAAYyjB,MAAQ,QAASjQ,MAAQ,GAAI+yB,SAAW,kBAAmBR,QAAU,aAAc1yB,KAAO,kBAC7GrT,KAAO,OAAQyjB,MAAQ,OAAQjQ,MAAQ,QAAS+yB,SAAW,kBAAmBR,QAAU,aAAc1yB,KAAO,cAC7GrT,KAAO,UAAWyjB,MAAQ,OAAQjQ,MAAQ,YAAa+yB,SAAW,kBAAmBR,QAAU,aAAc1yB,KAAO,gBAmMtH9R,SAAQqP,OAAO41B,UAAYJ,EAC3B7kC,QAAQqP,OAAOwyB,eAAiBA,EAChC7hC,QAAQqP,OAAOq0B,eAAiBA,EAChC1jC,QAAQqP,OAAOqU,aAAesgB,EAE9BhkC,QAAQqP,OAAO61B,UAAY,WAC1BliC,SAASC,SAASC,KAAOlD,QAAQmD,UAAUC,WAAW,UAGrDG,OAAQC,QAAS,SAAWnF,GAgB9B,QAAS8mC,GAAYC,EAAS9kC,GAC7B,IAAKX,IAAIylC,EAAS,OAAQ,MACzB,KAAK,mBAGNp7B,GAAco7B,EACd9kC,IAGD,QAAS+kC,GAAa/kC,GACrB,GAAIglC,GAAOhnC,GAAGinC,aACdxnB,KAAI,uBAAyBunB,GAC7BtlC,QAAQC,OAAOulC,eAAgB,SAAUJ,GAExC,GADArnB,IAAI,oCAAsCzf,GAAGinC,cAAgBD,IAC3B,GAA9B3lC,IAAIylC,EAAS,cAEhB,KADApiC,UAASC,SAASC,KAAOlD,QAAQmD,UAAUC,WAAW,SAChD,0CAA4CzD,IAAIylC,EAAS,aAAc,IAAM,iBAAmBzlC,IAAIylC,EAAS,YAAa,GAGjID,GAAYxlC,IAAIylC,EAAS,WAAa,WACrCrnB,IAAI,oCAAsCzf,GAAGinC,cAAgBD,IAC7DhlC,OAEC,WACF0C,SAASC,SAASC,KAAOlD,QAAQmD,UAAUC,WAAW,WAKxD,QAASqiC,KACHnnC,GAAGmpB,UAAU,6BAClBppB,EAAEqnC,WACDC,WAAa,SAAUC,GACtBA,EAAIC,iBAAiB,eAAgBxnC,EAAE,2BAA2BwC,KAAK,eAGzEb,QAAQ8lC,WAAW3kC,MAClB4kC,OAASxiC,OAAOyiC,KAChBC,QAAUjmC,QAAQC,OAAOimC,KACzBC,UAAYnmC,QAAQC,OAAOmmC,WAC3BC,OAASrmC,QAAQC,OAAOwW,cAvD1BnY,GAAGC,GAAG,UACN,IAAIyL,GAAc,IAElBhK,SAAQiK,eAAiB,WAAa,MAAOD,IAC7ChK,QAAQ+qB,eAAiB,WAAa,MAAOprB,KAAIqK,EAAa,OAAQ,OACtEhK,QAAQqS,eAAiB,WAAa,MAAO1S,KAAIqK,EAAa,OAAQ,OACtEhK,QAAQwS,gBAAkB,WAAa,MAAO7S,KAAIqK,EAAa,aAC/DhK,QAAQkkC,mBAAqB,WAAa,MAAOvkC,KAAIqK,EAAa,WAAY,OAC9EhK,QAAQmkC,oBAAsB,WAAa,MAAOxkC,KAAIqK,EAAa,iBAEnEhK,QAAQsmC,cAAgB,SAAUC,EAAgBvE,GACjD,GAAIwE,GAAQ7mC,IAAIqK,EAAa,uBAAyBrK,IAAIqK,EAAa,iBACvE,OAAOA,IAAew8B,GAAUD,EAAiBvE,EAsDlD,IAAIyE,IAAiB,CAErBzmC,SAAQmB,KAAO,WACTslC,IACJhB,IAWAzlC,QAAQmD,UAAUwpB,MAAM,SAAUgQ,EAAU+J,EAAYC,GACvD,GAAIC,GAAgB,oCAChBC,EAAc5kC,EAAE8C,OAAO6hC,EAAch6B,MAAM,KAAM,SAAU5B,GAAI,MAAY,QAALA,IAAc8B,KAAK,IAC7F,OAAI+5B,GAAY37B,QAAQyxB,IAAa,GACpC38B,QAAQqP,OAAOwyB,kBAAmBlF,GAC9BiK,EAAc17B,QAAQyxB,GAAY,GACrC38B,QAAQqP,OAAOq0B,eAAe/G,QAE/BgK,GAAcA,EAAWxrB,MAAM,MAAOwhB,EAAU+J,UAGjDrB,GAAa,WACZrlC,QAAQqP,OAAOwyB,kBAAmBlF,GAC9BiK,EAAc17B,QAAQyxB,GAAY,GACrC38B,QAAQqP,OAAOq0B,eAAe/G,GAG/BgK,GAAcA,EAAWxrB,MAAM,MAAOwhB,EAAU+J,QAGlDD,GAAiB,KAIjBljC,OAAQC,QAAS,WAQnB,QAASsjC,GAAcC,EAAOP,EAAOQ,GACpC,GAAIC,GAAQF,EAAME,MAAMD,EACxB,IAAKC,EAAL,CACA,GAAIjiC,GAAIiiC,EAAM7T,QACb9V,EAAMtY,EAAE4H,MAAM,IACf0Q,GAAMrb,EAAEkG,IAAImV,EAAK,SAAUtS,GAC1B,GAAIk8B,GAAQjlC,EAAEiJ,QAAQlG,EAAGgG,EACzB,OAAIk8B,GAAQ,GACJ,IAEDl8B,IAERsS,EAAIrV,KAAK,IAAKqV,EAAIjU,QAAQ,GAC1B,IAAI89B,GAAW7pB,EAAIxQ,KAAK,IACxBs6B,GAAiBD,GAAYX,GAgE9B,QAASa,GAAe5oC,EAAM4D,GAC7B,GAAI5C,GAAM6nC,EAAmB7oC,EAC7B,KAAKgB,EACJ,MAAO+B,SAAQC,IAAI,sBAAwBhD,EAC5C,IAAI8P,GAAO5O,IAAIF,EAAK,QAAS8nC,EAAM5nC,IAAIF,EAAK,OAC3CwnC,EAAQ14B,EAAK04B,MAAMM,GAChBC,EAAU,SAAUpsB,GACvB,MAAOpb,SAAQC,OAAOimC,KAAO9qB,EAE9B,QAAK6rB,GAASA,EAAM3nC,OAAS,EACrBkC,QAAQC,IAAI,sBAAwBhD,EAAO,gBACxB,GAAhBwoC,EAAM3nC,OACTkoC,EAAQj5B,GACL04B,EAAM3nC,OAAS,GAAKhB,GAAGmpC,QAAQplC,IAAY4kC,EAAM3nC,OAAS,GAAM+C,EAAO/C,QACjF2nC,EAAM7T,QACNnxB,EAAEC,KAAK+kC,EAAO,SAAUj8B,EAAGyJ,GAC1BlG,EAAOA,EAAKsG,QAAQ7J,EAAG3I,EAAOoS,MAExB+yB,EAAQj5B,IALT,OAlGRjQ,GAAGC,GAAG,oBACN,IAAIojC,GAAS3hC,QAAQ2hC,OAEjB+F,GADM1nC,QAAQC,OAAO0nC,OACL,GACnBL,KACAF,KAmBGQ,EAAwB,WAG3B,QAASC,GAAWC,GACnB,IAAKxpC,GAAGkpB,KAAKlpB,GAAGopB,MAAMogB,IACrB,OAAO,CAGR,KAAK,GAFDC,GAAQ3D,EAAGl+B,IAAI4hC,GAClBE,EAAM1pC,GAAGopB,MAAMogB,GACPG,EAAI,EAAGA,EAAIF,EAAMzoC,OAAQ2oC,IACjCX,EAAmBS,EAAME,IAAI9mC,KAAO6mC,CAErC,OADA5D,GAAG76B,OAAOu+B,IACH,EAGR,QAASI,KAMR,MALAC,GAAS7pC,GAAG8pC,KAAKD,KAAY,SAAU/N,EAAK0N,GAG3C,MAFKD,GAAWC,IACf1N,EAAInyB,KAAK6/B,GACH1N,IAEgB,GAAjB+N,EAAO7oC,OAGf,QAAS+oC,KACRF,EAAS7pC,GAAGgqC,MAAMC,MAAMJ,GACxB7pC,GAAGkqC,WAAWN,EAAW5pC,GAAGmqC,QAAS,IACpCC,OAAS,KACTC,OAAS,WACRC,MAAM,iCAAmCT,EAAOr7B,KAAK,UAKxD,QAAS+7B,GAAQpqC,EAAMqpC,GACtB,GAAIE,GAAM,IACV,IAAI1pC,GAAGkpB,KAAKsgB,GACXE,EAAMF,MACA,CAAA,IAAKxpC,GAAG0H,SAAS8hC,GACvB,KAAM,uDAAyDrpC,CAErDH,IAAGmpB,UAAUqgB,KACvBE,EAAM1pC,GAAGopB,MAAMogB,IAEhB,MAAIxpC,IAAGkpB,KAAKwgB,GACJV,EAAmB7oC,GAAM0C,KAAO6mC,GAExC5D,EAAG0E,IAAIhB,EAAOrpC,OACd0pC,GAAOlgC,KAAK6/B,IA9Cb,GAAI1D,GAAK,GAAI9lC,IAAGyqC,aACZZ,IA+CJ,QACCxb,MAAQ,WAAa7rB,WAAWunC,EAAQ,IACxCW,OAASH,MA0CPI,IAIFxqC,KAAO,QAAS8P,KAAO,UAAWg5B,IAAM,SAAU2B,QAAU,GAC5DC,cAAgB,2BAA4Bl3B,MAAQ,OAIpDxT,KAAO,OAAQ8P,KAAO,SAAUg5B,IAAM,QAAS2B,QAAU,GACzDC,cAAgB,8BAA+Bl3B,MAAQ,OAKvDxT,KAAO,OAAQ8P,KAAO,SAAUg5B,IAAM,QAAS2B,QAAU,GACzDC,cAAgB,4BAA6BC,WAAa,OAAQn3B,MAAQ,SAI1ExT,KAAO,aAAc8P,KAAO,gBAAiBg5B,IAAM,gBAAiB2B,QAAU,GAC9EC,cAAgB,8BAA+BC,WAAa,OAAQn3B,MAAQ,SAI5ExT,KAAO,WAAY8P,KAAO,mBAAoBg5B,IAAM,oBAAqB2B,QAAU,GACnFC,cAAgB,+BAAgCC,WAAa,OAAQn3B,MAAQ,SAI7ExT,KAAO,WAAY8P,KAAO,mBAAoBg5B,IAAM,oBAAqB2B,QAAU,GACnFC,cAAgB,+BAAgCC,WAAa,OAAQn3B,MAAQ,SAK7ExT,KAAO,UAAW8P,KAAO,YAAag5B,IAAM,WAAY2B,QAAU,GAClEC,cAAgB,8BAA+BC,WAAa,OAAQn3B,MAAQ,SAK5ExT,KAAO,UAAW8P,KAAO,YAAag5B,IAAM,WAAY2B,QAAU,GAClEC,cAAgB,kCAAmCC,WAAa,OAAQn3B,MAAQ,SAIhFxT,KAAO,gBAAiB8P,KAAO,wBAAyBg5B,IAAM,yBAA0B2B,QAAU,GAClGC,cAAgB,iCAAkCC,WAAa,UAAWn3B,MAAQ,SAKlFxT,KAAO,OAAQ8P,KAAO,SAAUg5B,IAAM,QAAS2B,QAAU,GACzDC,cAAgB,4BAA6BC,WAAa,OAAQn3B,MAAQ,SAK1ExT,KAAO,QAAS8P,KAAO,UAAWg5B,IAAM,SAAU2B,QAAU,GAC5DC,cAAgB,+BAAgCC,WAAa,OAAQn3B,MAAQ,SAiB7ExT,KAAO,aAAc8P,KAAO,8GAC5Bg5B,IAAM,+EACN2B,QAAU,GAAIC,cAAgB,+BAAgCC,WAAa,OAAQn3B,MAAQ,SAY3FxT,KAAO,gBAAiB8P,KAAO,kEAC/Bg5B,IAAM,uDAAwD2B,QAAU,GACxEC,cAAgB,0CAA2CC,WAAa,OAAQn3B,MAAQ,UAYxFxT,KAAO,mBAAoB8P,KAAO,qEAClCg5B,IAAM,0DAA2D2B,QAAU,GAC3EC,cAAgB,6CAA8CC,WAAa,OAAQn3B,MAAQ,WAY3FxT,KAAO,iBAAkB8P,KAAO,6EAChCg5B,IAAM,wDAAyD2B,QAAU,GACzEC,cAAgB,wCAAyCC,WAAa,OAAQn3B,MAAQ,YAatFxT,KAAO,qBAAsB8P,KAAO,iFACpCg5B,IAAM,4DAA6D2B,QAAU,GAC7EC,cAAgB,uCAAwCC,WAAa,OAAQn3B,MAAQ,SAMrFxT,KAAO,WAAY8P,KAAO,aAAcg5B,IAAM,YAAa2B,QAAU,GACrEC,cAAgB,sCAAuCC,WAAa,OAAQn3B,MAAQ,UAKpFxT,KAAO,QAAS8P,KAAO,UAAWg5B,IAAM,SAAU2B,QAAU,GAC5DC,cAAgB,2BAA4BC,WAAa,OAAQn3B,MAAQ,OAKzExT,KAAO,UAAW8P,KAAO,YAAag5B,IAAM,WAAY2B,QAAU,GAClEC,cAAgB,6BAA8BC,WAAa,OAAQn3B,MAAQ,SAI3ExT,KAAO,QAAS8P,KAAO,GAAIg5B,IAAM,QAAS2B,QAAU,GACpDC,cAAgB,4BAGlB7qC;GAAG+lC,QAAQ4E,EAAa,SAAUxpC,GACjC,GAAI4pC,GAAO/qC,GAAG+G,SACb6jC,QAAU,WACV36B,KAAO,IACL9O,GACC+mC,EAAQ7mC,IAAIF,EAAK,QAASsnC,EAAQpnC,IAAIF,EAAK,QAASunC,EAAOrnC,IAAIF,EAAK,MACxEqnC,GAAaC,EAAOP,EAAOQ,GAC3BM,EAAmBd,IAClB/nC,KAAO+nC,EAAO0C,QAAUvpC,IAAI0pC,EAAM,UAAW,IAAK96B,KAAOw4B,EAAOQ,IAAM5nC,IAAI0pC,EAAM,MAAO,MACvFD,WAAazpC,IAAIF,EAAK,aAAc,MAAOwS,MAAQtS,IAAIF,EAAK,QAAS,IAEtE,IAAI6pC,GAAY,iBAAmBD,GAAOA,EAAKF,cAAgB,IAC1D7qC,IAAG0H,SAASsjC,IAAehrC,GAAGkpB,KAAK8hB,KACvCA,EAAYhrC,GAAGmqC,SAChBb,EAAsBoB,OAAOxC,EAAO8C,KAErC1B,EAAsBjb,QAGtB3sB,QAAQmD,UAAUwpB,MAAQ,SAAUrsB,GACnConC,GAAgB,EAChB/F,EAAO4H,QAAQC,QAAQlc,KAAO,UAAWmc,KAAOzpC,QAAQC,OAAOimC,OAG/DjkC,EAAEC,KAAKolC,EAAoB,SAAUoC,EAAOjrC,GAC3C,GAAIkrC,GAAKhqC,IAAI+pC,EAAO,OAAQE,EAASp9B,IAAIk9B,EAAO,QAASG,EAAU,IAEnEA,GAAU,SAAUxnC,GACnBb,QAAQsB,KAAK,oBAAsBrE,GACnC+C,QAAQsB,KAAK,cAAgBrE,GAC7B+C,QAAQsB,KAAK,iBAAmBT,GAChC/D,GAAGkpB,KAAKlnB,IAASA,EAAK7B,EAAM4D,EAAQunC,IAKrCjI,EAAOlW,IAAIke,EAAIE,KAEhBlI,EAAOmI,SAASlI,SAGjB5hC,QAAQmD,UAAUC,WAAaikC,EAE/BrnC,QAAQmD,UAAU4mC,eAAiB,WAClC,MAAO9mC,UAASglB,MAGjBjoB,QAAQmD,UAAU03B,qBAAuB,SAAUtsB,GAClD,GAAIy7B,GAAWz7B,GAAQvO,QAAQ2hC,OAAOsI,cAClChD,EAAQhlC,EAAE8C,OAAOuiC,EAAoB,SAAUz6B,GAClD,QAASm9B,EAAS/C,MAAMp6B,EAAG06B,OAExBllC,EAAS,IACb,OAAoB,IAAhB4kC,EAAM3nC,OAAoB,KACV,GAAhB2nC,EAAM3nC,QACT+C,EAAS2nC,EAAS/C,MAAMA,EAAM,GAAQ,KACtC5kC,EAAO+wB,QACA90B,GAAG+G,SAAShD,OAASA,GAAS4kC,EAAM,MAE5CA,EAAQhlC,EAAE8C,OAAOkiC,EAAO,SAAUp6B,GACjC,MAAkB,SAAXA,EAAGpO,OAEX4D,EAAS2nC,EAAS/C,MAAMA,EAAMA,EAAM3nC,OAAS,GAAQ,KACrD+C,EAAO+wB,QACA90B,GAAG+G,SAAShD,OAASA,GAAS4kC,EAAMA,EAAM3nC,OAAS,MAG3DU,QAAQmD,UAAU4gB,qBAAuB,SAAUxV,GAIlD,IAHA,GAAI27B,GAAalqC,QAAQmD,UAAU03B,qBAAqBtsB,GACpD47B,EAAUxqC,IAAIuqC,EAAY,OAAQ,MAClCloC,MACG1D,GAAGyH,QAAQokC,IAAU,CAC3BnoC,EAAIqH,SACH5K,KAAO0rC,EACPl4B,MAAQtS,IAAIuqC,EAAY,QAAS,IACrB37B,KAAMvO,QAAQmD,UAAUC,WAAW+mC,EAASD,EAAW7nC,SAEpE,IAAI+mC,GAAazpC,IAAIuqC,EAAY,aAAc,KAC/CA,GAAa5rC,GAAGyH,QAAQqjC,GAAc,KAAOzpC,IAAI2nC,EAAoB8B,EAAY,MACjFe,EAAUxqC,IAAIuqC,EAAY,OAAQ,MAGnC,MADMloC,GAAIA,EAAI1C,OAAS,GAAG6zB,YAAa,EAChCnxB,GAGLhC,QAAQmD,UAAUmgB,mBAAqB,SAAU7kB,GAC7C,IAAIA,EAAM,MAAO,KACjB,IAAIgB,GAAM6nC,EAAmB7oC,EAC7B,OAAIgB,GACGA,EAAIwS,MADK,OAKrB1O,OAAQC","sourcesContent":["/** \r\n * -------------------------------------------------\r\n * Copyright (c) 2014, All rights reserved. \r\n * Hualala-Merchant-Management\r\n * \r\n * @version : 0.1.0\r\n * @author : HuHao\r\n * @description : Hualala Merchant Management System.  \r\n * -------------------------------------------------\r\n */ \r\n\r\n(function ($, window) {\r\n\tIX.ns('Hualala.Entry');\r\n\tvar formFields = [\r\n\t\t{\r\n\t\t\tname : 'group_name', type : 'text', palceholder : '', clz : 'form-control input-md',\r\n\t\t\tkey : 'groupName',\r\n\t\t\tfield : {\r\n\t\t\t\tvalidators : {\r\n\t\t\t\t\tnotEmpty : {\r\n\t\t\t\t\t\tmessage : \"\"\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\t{\r\n\t\t\tname : 'group_subname', type : 'text', palceholder : '', clz : 'form-control input-md',\r\n\t\t\tkey : 'childName',\r\n\t\t\tfield : {\r\n\t\t\t\tvalidators : {\r\n\t\t\t\t\t// notEmpty : {\r\n\t\t\t\t\t// \tmessage : \"\"\r\n\t\t\t\t\t// }\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\t{\r\n\t\t\tname : 'login_pwd', type : 'passowrd', palceholder : '', clz : 'form-control input-md',\r\n\t\t\tkey : 'password',\r\n\t\t\tfield : {\r\n\t\t\t\tvalidators : {\r\n\t\t\t\t\tnotEmpty : {\r\n\t\t\t\t\t\tmessage : \"\"\r\n\t\t\t\t\t},\r\n\t\t\t\t\tcallback : {\r\n\t\t\t\t\t\tcallback : function (val, validator, $field) {\r\n\t\t\t\t\t\t\tvar min = 6, max = 32;\r\n\t\t\t\t\t\t\tif (val.length < 6 || val.length > 32) {\r\n\t\t\t\t\t\t\t\treturn {\r\n\t\t\t\t\t\t\t\t\tvalid : false,\r\n\t\t\t\t\t\t\t\t\tmessage : '' + min + '' + max + ''\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\treturn {\r\n\t\t\t\t\t\t\t\tvalid : true\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\t{\r\n\t\t\tname : 'login_auth', type : 'text', palceholder : '', clz : 'form-control input-md',\r\n\t\t\tkey : 'authCode',\r\n\t\t\tfield : {\r\n\t\t\t\tvalidators : {\r\n\t\t\t\t\tnotEmpty : {\r\n\t\t\t\t\t\tmessage : \"\"\r\n\t\t\t\t\t}/*,\r\n\t\t\t\t\tcallback : function (val, validator, $field) {\r\n\t\t\t\t\t\tif (val != $('[name=auth_code]').val()) {\r\n\t\t\t\t\t\t\treturn {\r\n\t\t\t\t\t\t\t\tvalid : false,\r\n\t\t\t\t\t\t\t\tmessage : ''\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\treturn {valid : true};\r\n\t\t\t\t\t}*/\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t];\r\n\r\n\t/**\r\n\t * AuthCode\r\n\t * @param {Object} cfg {container}\r\n\t */\r\n\tvar AuthCode = function (cfg) {\r\n\t\tvar container = $($XP(cfg, 'container')),\r\n\t\t\t$img = container.find('.auth-img'),\r\n\t\t\t$progress = container.find('.progress');\r\n\t\tvar callServer = Hualala.Global.genAuthCode;\r\n\t\tvar toggleProgress = function (isShow) {\r\n\t\t\t$progress[isShow ? 'removeClass' : 'addClass']('hidden');\r\n\t\t\t$img[isShow ? 'addClass' : 'removeClass']('hidden');\r\n\t\t};\r\n\t\tvar getAuthCode = function (cbFn) {\r\n\t\t\ttoggleProgress(true);\r\n\t\t\tcallServer({}, function (res) {\r\n\t\t\t\tvar code = null;\r\n\t\t\t\tif ($XP(res, 'resultcode') == \"000\") {\r\n\t\t\t\t\tcode = $XP(res, 'data.code', null);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tHualala.UI.TopTip({\r\n\t\t\t\t\t\ttype : 'warning',\r\n\t\t\t\t\t\tmsg : \"\"\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t\ttoggleProgress();\r\n\t\t\t\t}\r\n\t\t\t\tcbFn(code);\r\n\t\t\t});\r\n\t\t};\r\n\t\tvar setAuthCode = function (code) {\r\n\t\t\tif (!code) {\r\n\t\t\t\tsetTimeout(function () {\r\n\t\t\t\t\tgetAuthCode(setAuthCode);\r\n\t\t\t\t}, 1000);\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\t$img.attr('src', code);\r\n\t\t\t// FOR TEST\r\n\t\t\tsetTimeout(function () {\r\n\t\t\t\ttoggleProgress();\r\n\t\t\t}, 500);\r\n\t\t};\r\n\t\tvar bindEvent = function () {\r\n\t\t\tcontainer.delegate('.auth-img', 'click', function (e) {\r\n\t\t\t\t$img = $(e.target);\r\n\t\t\t\tgetAuthCode(setAuthCode);\r\n\t\t\t});\r\n\t\t};\r\n\t\tvar init = function () {\r\n\t\t\tgetAuthCode(setAuthCode);\r\n\t\t\tbindEvent();\r\n\t\t};\r\n\t\tinit();\r\n\t\treturn {\r\n\t\t\tgenCode : function () {\r\n\t\t\t\tgetAuthCode(setAuthCode);\r\n\t\t\t}\r\n\t\t};\r\n\t};\r\n\r\n\tHualala.Entry.initLogin = function ($container) {\r\n\t\tif (!$container || $container.length == 0) {\r\n\t\t\tconsole.err(\"Login Form init failed!\");\r\n\t\t\treturn ;\r\n\t\t}\r\n\t\tvar callServer = Hualala.Global.loginCallServer;\r\n\t\tvar fvOpts = {},\r\n\t\t\t$subBtn = $container.find('#login_sub'),\r\n\t\t\t$progress = $subBtn.parent().find('.progress'),\r\n\t\t\t$authCode = $container.find('.ix-authcode'),\r\n\t\t\tauthCode = new AuthCode({\r\n\t\t\t\tcontainer : $authCode\r\n\t\t\t});\r\n\t\tvar toggleProgress = function (isShow) {\r\n\t\t\t$progress[isShow ? 'removeClass' : 'addClass']('hidden');\r\n\t\t\t$subBtn[isShow ? 'addClass' : 'removeClass']('hidden');\r\n\t\t};\r\n\t\tvar initValidFieldOpts = function () {\r\n\t\t\tvar ret = {};\r\n\t\t\t_.each(formFields, function (f, i, l) {\r\n\t\t\t\tvar key = $XP(f, 'name'), field = $XP(f, 'field');\r\n\t\t\t\tret[key] = field;\r\n\t\t\t});\r\n\t\t\treturn ret;\r\n\t\t};\r\n\t\tvar getFormData = function () {\r\n\t\t\tvar params = {};\r\n\t\t\t_.each(formFields, function (f, i, l) {\r\n\t\t\t\tvar name = $XP(f, 'name'), key = $XP(f, 'key'), \r\n\t\t\t\t\tval = $('[name=' + name + ']', $container).val();\r\n\t\t\t\tparams[key] = val;\r\n\t\t\t});\r\n\t\t\treturn params;\r\n\t\t};\r\n\t\tvar initLoginForm = function () {\r\n\t\t\tfvOpts = initValidFieldOpts();\r\n\t\t\t$container.bootstrapValidator({\r\n\t\t\t\ttrigger : 'blur',\r\n\t\t\t\tfields : fvOpts\r\n\t\t\t}).on('error.field.bv', function (e, data) {\r\n\t\t\t\tvar $form = $(e.target),\r\n\t\t\t\t\tbv = $form.data('bootstrapValidator');\r\n\t\t\t\ttoggleProgress();\r\n\t\t\t}).on('success.form.bv', function (e, data) {\r\n\t\t\t\te.preventDefault();\r\n\t\t\t\tvar $form = $(e.target),\r\n\t\t\t\t\tbv = $form.data('bootstrapValidator'),\r\n\t\t\t\t\tparams = getFormData();\r\n\t\t\t\t// TODO AJAX Submit Login Form\r\n\t\t\t\tconsole.info('login params : ');\r\n\t\t\t\tconsole.info(params);\r\n\t\t\t\t\r\n\t\t\t\tcallServer(params, function (res) {\r\n\t\t\t\t\tif (res.resultcode == 000) {\r\n\t\t\t\t\t\tdocument.location.href = Hualala.PageRoute.createPath('main'); \r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tHualala.UI.TopTip({\r\n\t\t\t\t\t\t\ttype : 'danger',\r\n\t\t\t\t\t\t\tmsg : $XP(res, 'resultmsg')\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\t\t\t\t\ttoggleProgress();\r\n\t\t\t\t});\r\n\t\t\t});\r\n\t\t\t$container.delegate('#login_sub', 'click', function (e) {\r\n\t\t\t\ttoggleProgress(true);\r\n\t\t\t\tvar bv = $container.data('bootstrapValidator');\r\n\t\t\t\tbv.validate();\r\n\t\t\t});\r\n\t\t};\r\n\r\n\t\tinitLoginForm();\r\n\t};\r\n})(jQuery, window);;(function ($, window) {\r\n\tIX.ns(\"Hualala.Shop\");\r\n\tvar popoverMsg = Hualala.UI.PopoverMsgTip;\r\n\tvar toptip = Hualala.UI.TopTip;\r\n\tvar QueryModel = Stapes.subclass({\r\n\t\tconstructor : function () {\r\n\t\t\t// \r\n\t\t\tthis.origCities = [];\r\n\t\t\tthis.origAreas = [];\r\n\t\t\tthis.origShops = [];\r\n\t\t\t// \r\n\t\t\tthis.isReady = false;\r\n\t\t\tthis.callServer = Hualala.Global.getShopQuerySchema;\r\n\t\t}\r\n\t});\r\n\tQueryModel.proto({\r\n\t\t// \r\n\t\tinit : function (params, cbFn) {\r\n\t\t\tvar self = this;\r\n\t\t\tself.isReady = false;\r\n\t\t\tself.callServer(params, function (res) {\r\n\t\t\t\tif (res.resultcode == '000') {\r\n\t\t\t\t\t// \r\n\t\t\t\t\tself.origCities = $XP(res, 'data.cities', []);\r\n\t\t\t\t\tself.origAreas = $XP(res, 'data.areas', []);\r\n\t\t\t\t\tself.origShops = $XP(res, 'data.shops', []);\r\n\t\t\t\t\tself.initDataModel();\r\n\t\t\t\t\tself.isReady = true;\r\n\t\t\t\t} else {\r\n\t\t\t\t\ttoptip({\r\n\t\t\t\t\t\tmsg : $XP(res, 'resultmsg', ''),\r\n\t\t\t\t\t\ttype : 'danger'\r\n\t\t\t\t\t});\r\n\t\t\t\t\tself.isReady = false;\r\n\t\t\t\t}\r\n\t\t\t\tcbFn(self);\r\n\t\t\t});\r\n\t\t},\r\n\t\t// \r\n\t\t// ds_city, ds_area, ds_shop\r\n\t\tinitDataModel : function () {\r\n\t\t\tvar self = this;\r\n\t\t\tvar cityHT = new IX.IListManager(),\r\n\t\t\t\tareaHT = new IX.IListManager(),\r\n\t\t\t\tshopHT = new IX.IListManager();\r\n\t\t\t_.each(this.origCities, function (c, i, l) {\r\n\t\t\t\tvar cid = $XP(c, 'cityID'), \r\n\t\t\t\t\tshopLst = _.filter(self.origShops, function (s) {\r\n\t\t\t\t\t\treturn $XP(s, 'cityID') == cid;\r\n\t\t\t\t\t}),\r\n\t\t\t\t\tareaLst = _.filter(self.origAreas, function (a) {\r\n\t\t\t\t\t\treturn $XP(a, 'cityID') == cid;\r\n\t\t\t\t\t});\r\n\t\t\t\tshopLst = _.pluck(shopLst, 'shopID');\r\n\t\t\t\tareaLst = _.pluck(areaLst, 'areaID');\r\n\t\t\t\tcityHT.register(cid, IX.inherit(c, {\r\n\t\t\t\t\tshopLst : shopLst,\r\n\t\t\t\t\tareaLst : areaLst\r\n\t\t\t\t}));\r\n\t\t\t});\r\n\t\t\t_.each(this.origAreas, function (a, i, l) {\r\n\t\t\t\tvar aid = $XP(a, 'areaID'),\r\n\t\t\t\t\tshopLst = _.filter(self.origShops, function (s) {\r\n\t\t\t\t\t\treturn $XP(s, 'areaID') == aid;\r\n\t\t\t\t\t});\r\n\t\t\t\tshopLst = _.pluck(shopLst, 'areaID');\r\n\t\t\t\tareaHT.register(aid, IX.inherit(a, {\r\n\t\t\t\t\tshopLst : shopLst\r\n\t\t\t\t}));\r\n\t\t\t});\r\n\t\t\t_.each(this.origShops, function (s, i, l) {\r\n\t\t\t\tvar sid = $XP(s, 'shopID');\r\n\t\t\t\tshopHT.register(sid, s);\r\n\t\t\t});\r\n\t\t\tself.set({\r\n\t\t\t\tds_city : cityHT,\r\n\t\t\t\tds_area : areaHT,\r\n\t\t\t\tds_shop : shopHT\r\n\t\t\t});\r\n\t\t},\r\n\t\t// \r\n\t\thasReady : function () {return this.isReady;},\r\n\t\t/**\r\n\t\t * cityIDs\r\n\t\t * @param  {String|Array|NULL} ids cityIDcityIDcityID\r\n\t\t * @return {Array|NULL}\tnull     \r\n\t\t */\r\n\t\tgetCities : function (ids) {\r\n\t\t\tids = IX.isEmpty(ids) ? null : (IX.isString(ids) ? [ids] : ids);\r\n\t\t\tvar ds = this.get('ds_city');\r\n\t\t\tvar ret = null;\r\n\t\t\tret = ds[!ids ? 'getAll' : 'getByKeys'](ids);\r\n\t\t\treturn ret;\r\n\t\t},\r\n\t\t/**\r\n\t\t * shopIDs\r\n\t\t * @param  {String|Array|NULL} ids shopIDshopIDshopID\r\n\t\t * @return {Array|NULL}\tnull     \r\n\t\t */\r\n\t\tgetShops : function (ids) {\r\n\t\t\tids = IX.isEmpty(ids) ? null : (IX.isString(ids) ? [ids] : ids);\r\n\t\t\tvar ds = this.get('ds_shop');\r\n\t\t\tvar ret = null;\r\n\t\t\tret = ds[!ids ? 'getAll' : 'getByKeys'](ids);\r\n\t\t\treturn ret;\r\n\t\t},\r\n\t\t/**\r\n\t\t * \r\n\t\t * @param  {String} areaID ID\r\n\t\t * @return {Array|NULL} null\r\n\t\t */\r\n\t\tgetShopsByAreaID : function (areaID) {\r\n\t\t\tif (!areaID) return null;\r\n\t\t\tvar ds = this.get('ds_shop');\r\n\t\t\tvar ret = _.filter(ds.getAll(), function (s, idx) {\r\n\t\t\t\tvar aid = $XP(s, 'areaID');\r\n\t\t\t\treturn areaID == aid;\r\n\t\t\t});\r\n\t\t\treturn ret.length == 0 ? null : ret;\r\n\t\t},\r\n\t\t/**\r\n\t\t * \r\n\t\t * @param  {String} cityID ID\r\n\t\t * @return {Array|NULL} null\r\n\t\t */\r\n\t\tgetShopsByCityID : function (cityID) {\r\n\t\t\tif (!cityID) return null;\r\n\t\t\tvar ds = this.get('ds_shop');\r\n\t\t\tvar ret = _.filter(ds.getAll(), function (s, idx) {\r\n\t\t\t\tvar cid = $XP(s, 'cityID');\r\n\t\t\t\treturn cityID == cid;\r\n\t\t\t});\r\n\t\t\treturn ret.length == 0 ? null : ret;\r\n\t\t},\r\n\t\t/**\r\n\t\t * areaIDs\r\n\t\t * @param  {String|Array|NULL} ids areaIDareaIDareaID\r\n\t\t * @return {Array|NULL}\tnull     \r\n\t\t */\r\n\t\tgetAreas : function (ids) {\r\n\t\t\tids = IX.isEmpty(ids) ? null : (IX.isString(ids) ? [ids] : ids);\r\n\t\t\tvar ds = this.get('ds_area');\r\n\t\t\tvar ret = null;\r\n\t\t\tret = ds[!ids ? 'getAll' : 'getByKeys'](ids);\r\n\t\t\treturn ret;\r\n\t\t},\r\n\t\tdestroy : function () {\r\n\t\t\tthis.origCities = [];\r\n\t\t\tthis.origAreas = [];\r\n\t\t\tthis.origShops = [];\r\n\t\t\tthis.isReady = false;\r\n\t\t}\r\n\t});\r\n\tHualala.Shop.QueryModel = QueryModel;\r\n})(jQuery, window);;(function ($, window) {\r\n\tIX.ns(\"Hualala.Shop\");\r\n\tvar popoverMsg = Hualala.UI.PopoverMsgTip;\r\n\tvar toptip = Hualala.UI.TopTip;\r\n\tvar QueryView = Stapes.subclass({\r\n\t\tconstructor : function () {\r\n\t\t\t// View\r\n\t\t\tthis.isReady = false;\r\n\t\t\t// \r\n\t\t\tthis.needShopCreate = false;\r\n\t\t\t// View\r\n\t\t\tthis.$container = null;\r\n\t\t\tthis.$queryBox = null;\r\n\t\t\t// \r\n\t\t\tthis.$filter = null;\r\n\t\t\t// \r\n\t\t\tthis.$query = null;\r\n\t\t\tthis.loadTemplates();\r\n\t\t}\r\n\t});\r\n\tQueryView.proto({\r\n\t\t// View\r\n\t\tinit : function (cfg) {\r\n\t\t\tthis.model = $XP(cfg, 'model', null);\r\n\t\t\tthis.needShopCreate = $XP(cfg, 'needShopCreate', false);\r\n\t\t\tthis.$container = $XP(cfg, 'container', null);\r\n\t\t\tif (!this.model || !this.$container || this.$container.length == 0) {\r\n\t\t\t\tthrow(\"Init Query View Failed!!\");\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tthis.renderLayout();\r\n\t\t\tthis.bindEvent();\r\n\t\t\tthis.isReady = true;\r\n\t\t\tthis.emit('filter', this.getFilterParams());\r\n\r\n\t\t},\r\n\t\t// View\r\n\t\thasReady : function () {return this.isReady;},\r\n\t\t// View\r\n\t\tloadTemplates : function () {\r\n\t\t\tvar queryTpl = Handlebars.compile(Hualala.TplLib.get('tpl_shop_query')),\r\n\t\t\t\tfilterTpl = Handlebars.compile(Hualala.TplLib.get('tpl_shop_filter'));\r\n\t\t\t// \r\n\t\t\tHandlebars.registerPartial(\"shopCity\", Hualala.TplLib.get('tpl_shop_filter'));\r\n\t\t\tHandlebars.registerPartial(\"toggle\", Hualala.TplLib.get('tpl_site_navbarToggle'));\r\n\t\t\t// Handlebars.registerPartial(\"shopArea\", Hualala.TplLib.get('tpl_shop_filter'));\r\n\t\t\tthis.set({\r\n\t\t\t\tqueryTpl : queryTpl,\r\n\t\t\t\tfilterTpl : filterTpl\r\n\t\t\t});\r\n\t\t},\r\n\t\t// \r\n\t\tmapChosenShopData : function () {\r\n\t\t\tvar self = this;\r\n\t\t\tvar cities = this.model.getCities();\r\n\t\t\tvar ret = [];\r\n\t\t\t_.each(cities, function (city, i, l) {\r\n\t\t\t\tvar cityName = $XP(city, 'cityName', ''),\r\n\t\t\t\t\tcityID = $XP(city, 'cityID', ''),\r\n\t\t\t\t\tshopLst = $XP(city, 'shopLst');\r\n\t\t\t\tvar shops = self.model.getShops(shopLst);\r\n\t\t\t\tret.push({\r\n\t\t\t\t\tname : cityName,\r\n\t\t\t\t\titems : _.map(shops, function (shop, j, l) {\r\n\t\t\t\t\t\treturn {\r\n\t\t\t\t\t\t\tcode : $XP(shop, 'shopID'),\r\n\t\t\t\t\t\t\tname : $XP(shop, 'shopName')\r\n\t\t\t\t\t\t};\r\n\t\t\t\t\t})\r\n\t\t\t\t});\r\n\t\t\t});\r\n\t\t\treturn ret;\r\n\t\t},\r\n\t\t// \r\n\t\tmapRenderLayoutData : function () {\r\n\t\t\tvar cities = this.model.getCities(),\r\n\t\t\t\tshops = this.model.getShops();\r\n\t\t\tvar filterCities = this.mapFilterData({\r\n\t\t\t\t\ttype : 'city',\r\n\t\t\t\t\tname : '',\r\n\t\t\t\t\tfocus : 0,\r\n\t\t\t\t\tdata : cities\r\n\t\t\t\t}),\r\n\t\t\t\tqueryChosenShops = this.mapChosenShopData();\r\n\t\t\treturn {\r\n\t\t\t\tclz : '',\r\n\t\t\t\tshopCity : filterCities,\r\n\t\t\t\ttoggle : {target : '#shop_query'},\r\n\t\t\t\tneedShopCreate : this.needShopCreate,\r\n\t\t\t\toptGrp : queryChosenShops\r\n\t\t\t};\r\n\t\t},\r\n\t\t// query \r\n\t\trenderLayout : function () {\r\n\t\t\tvar self = this,\r\n\t\t\t\tqueryTpl = self.get('queryTpl'),\r\n\t\t\t\tmodel = self.model;\r\n\t\t\tvar renderData = self.mapRenderLayoutData();\r\n\t\t\tvar html = queryTpl(renderData);\r\n\t\t\tthis.$queryBox = $(html);\r\n\t\t\tthis.$container.prepend(this.$queryBox);\r\n\t\t\tthis.$filter = this.$queryBox.find('.filter');\r\n\t\t\tthis.$query = this.$queryBox.find('.query');\r\n\r\n\t\t},\r\n\t\t// \r\n\t\tmapFilterData : function (cfg) {\r\n\t\t\tvar data = $XP(cfg, 'data', []),\r\n\t\t\t\ttype = $XP(cfg, 'type'),\r\n\t\t\t\tname = $XP(cfg, 'name'),\r\n\t\t\t\tfocus = $XP(cfg, 'focus', 0),\r\n\t\t\t\tret = {\r\n\t\t\t\t\ttype : type,\r\n\t\t\t\t\tname : name,\r\n\t\t\t\t\titems : []\r\n\t\t\t\t},\r\n\t\t\t\tcount = 0;\r\n\t\t\tvar btn_all = {\r\n\t\t\t\tfocusClz : '',\r\n\t\t\t\ttype : type,\r\n\t\t\t\tcode : -1,\r\n\t\t\t\tname : '',\r\n\t\t\t\tcount : 0\r\n\t\t\t};\r\n\t\t\tret.items = _.map(data, function (o, i, l) {\r\n\t\t\t\tvar key = type + 'Count';\r\n\t\t\t\tvar c = parseInt($XP(o, key, 0));\r\n\t\t\t\tcount += c;\r\n\t\t\t\treturn {\r\n\t\t\t\t\tfocusClz : '',\r\n\t\t\t\t\ttype : type,\r\n\t\t\t\t\tcode : $XP(o, (type + 'ID'), ''),\r\n\t\t\t\t\tname : $XP(o, (type + 'Name'), ''),\r\n\t\t\t\t\tcount : c\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\tbtn_all = IX.inherit(btn_all, {\r\n\t\t\t\tcount : count,\r\n\t\t\t\tfocusClz : ''\r\n\t\t\t});\r\n\t\t\tret.items.unshift(btn_all);\r\n\t\t\tret.items[focus]['focusClz'] = 'disabled';\r\n\t\t\treturn ret;\r\n\t\t},\r\n\t\t// filter\r\n\t\trenderAreaFilter : function (data) {\r\n\t\t\tvar self = this,\r\n\t\t\t\tfilterTpl = self.get('filterTpl'),\r\n\t\t\t\tmodel = self.model;\r\n\t\t\tvar renderData = self.mapFilterData({\r\n\t\t\t\ttype : 'area',\r\n\t\t\t\tname : '',\r\n\t\t\t\tfocus : 0,\r\n\t\t\t\tdata : data\r\n\t\t\t});\r\n\t\t\tvar html = filterTpl(renderData);\r\n\t\t\tthis.$filter.find('.area').remove();\r\n\t\t\tthis.$filter.append(html);\r\n\t\t},\r\n\t\t// View\r\n\t\tbindEvent : function () {\r\n\t\t\tvar self = this;\r\n\t\t\tthis.$filter.on('click', '.btn-link[data-city]', function (e) {\r\n\t\t\t\tvar $btn = $(this);\r\n\t\t\t\tvar cityID = $btn.attr('data-city');\r\n\t\t\t\tvar data = null;\r\n\t\t\t\tif (cityID != -1) {\r\n\t\t\t\t\tdata = self.model.getCities(cityID);\r\n\t\t\t\t\tdata = $XP(data[0], 'areaLst', null);\r\n\t\t\t\t\tdata = self.model.getAreas(data);\r\n\t\t\t\t\tself.renderAreaFilter(data);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tself.$filter.find('.area').remove();\r\n\t\t\t\t}\r\n\t\t\t\tself.$filter.find('.btn-link[data-city]').removeClass('disabled');\r\n\t\t\t\t$btn.addClass('disabled');\r\n\t\t\t\tself.emit('filter', self.getFilterParams());\r\n\t\t\t});\r\n\t\t\tthis.$filter.on('click', '.btn-link[data-area]', function (e) {\r\n\t\t\t\tvar $btn = $(this);\r\n\t\t\t\tvar areaID = $btn.attr('data-area');\r\n\t\t\t\tself.$filter.find('.btn-link[data-area]').removeClass('disabled');\r\n\t\t\t\t$btn.addClass('disabled');\r\n\t\t\t\tself.emit('filter', self.getFilterParams());\r\n\t\t\t});\r\n\t\t\tthis.$query.on('click', '.create-shop', function (e) {\r\n\t\t\t\tvar $btn = $(this);\r\n\t\t\t\tdocument.location.href = Hualala.PageRoute.createPath('shopCreate');\r\n\t\t\t});\r\n\t\t},\r\n\t\tdestroy : function () {\r\n\t\t\tthis.isReady = false;\r\n\t\t\tthis.needShopCreate = false;\r\n\t\t\tthis.$container.find('.shop-query').remove();\r\n\t\t\tthis.$queryBox = null;\r\n\t\t\tthis.$filter = null;\r\n\t\t\tthis.$query = null;\r\n\t\t},\r\n\t\t// \r\n\t\tgetFilterParams : function () {\r\n\t\t\t// TODO\r\n\t\t\tvar self = this;\r\n\t\t\tvar focusedBtn = self.$filter.find('.btn-link.disabled');\r\n\t\t\tvar cityID = focusedBtn.filter('[data-city]').attr('data-city'),\r\n\t\t\t\tareaID = focusedBtn.filter('[data-area]').attr('data-area');\r\n\t\t\tcityID = (!cityID || cityID == -1) ? '' : cityID;\r\n\t\t\tareaID = (!areaID || areaID == -1) ? '' : areaID;\r\n\t\t\treturn {\r\n\t\t\t\tcityID : cityID,\r\n\t\t\t\tareaID : areaID,\r\n\t\t\t\tkeywordLst : ''\r\n\t\t\t};\r\n\t\t},\r\n\t\t// \r\n\t\tgetQueryParams : function () {\r\n\t\t\t// TODO\r\n\t\t\treturn {}\r\n\t\t}\r\n\r\n\t});\r\n\tHualala.Shop.QueryView = QueryView;\r\n})(jQuery, window);;(function ($, window) {\r\n\tIX.ns(\"Hualala.Shop\");\r\n\tvar popoverMsg = Hualala.UI.PopoverMsgTip;\r\n\tvar toptip = Hualala.UI.TopTip;\r\n\tvar QueryModel = Hualala.Shop.QueryModel;\r\n\tvar QueryView = Hualala.Shop.QueryView;\r\n\tvar QueryController = Stapes.subclass({\r\n\t\t/**\r\n\t\t * \r\n\t\t * @param  {Object} cfg \r\n\t\t *            @param {Boolean} cfg.needShopCreate \r\n\t\t *            @param {JQueryObj} container \r\n\t\t *            @param {Object} resultController \r\n\t\t * @return {Object}     \r\n\t\t */\r\n\t\tconstructor : function (cfg) {\r\n\t\t\tthis.set({\r\n\t\t\t\tsessionData : Hualala.getSessionData()\r\n\t\t\t});\r\n\t\t\tthis.container = $XP(cfg, 'container', null);\r\n\t\t\tthis.needShopCreate = $XP(cfg, 'needShopCreate', false);\r\n\t\t\tthis.resultController = $XP(cfg, 'resultController', null);\r\n\t\t\tthis.model = new QueryModel();\r\n\t\t\tthis.view = new QueryView();\r\n\t\t\tthis.init();\r\n\t\t}\r\n\t});\r\n\tQueryController.proto({\r\n\t\t// \r\n\t\tinit : function () {\r\n\t\t\tvar self = this;\r\n\t\t\tself.bindEvent();\r\n\t\t\tself.model.emit('load', function () {\r\n\t\t\t\tif (!self.model.hasReady()) {\r\n\t\t\t\t\tthrow(\"Shop Query Init Failed!!\");\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\t// View\r\n\t\t\t\tself.view.emit('init');\r\n\t\t\t});\r\n\t\t},\r\n\t\t// \r\n\t\tbindEvent : function () {\r\n\t\t\t// \r\n\t\t\tthis.on({\r\n\t\t\t\treload : function () {\r\n\t\t\t\t\tvar self = this;\r\n\t\t\t\t\tself.model.distory();\r\n\t\t\t\t\tself.view.distory();\r\n\t\t\t\t\tself.init();\r\n\t\t\t\t},\r\n\t\t\t\tquery : function (params) {\r\n\t\t\t\t\tvar self = this;\r\n\t\t\t\t\tconsole.info('query params:');\r\n\t\t\t\t\tconsole.info(params);\r\n\t\t\t\t\tself.resultController && self.resultController.emit('load', IX.inherit(params, {\r\n\t\t\t\t\t\tpageNo : 1,\r\n\t\t\t\t\t\tpageSize : 15\r\n\t\t\t\t\t}));\r\n\t\t\t\t}\r\n\t\t\t}, this);\r\n\t\t\t// \r\n\t\t\tthis.model.on({\r\n\t\t\t\tload : function (cbFn) {\r\n\t\t\t\t\tvar self = this,\r\n\t\t\t\t\t\tparams = $XP(self.get('sessionData'), 'user', {});\r\n\t\t\t\t\tself.model.init(params, cbFn);\r\n\t\t\t\t}\r\n\t\t\t}, this);\r\n\t\t\t// \r\n\t\t\tthis.view.on({\r\n\t\t\t\tinit : function () {\r\n\t\t\t\t\tvar self = this;\r\n\t\t\t\t\tself.view.init({\r\n\t\t\t\t\t\tmodel : self.model,\r\n\t\t\t\t\t\tneedShopCreate : self.needShopCreate,\r\n\t\t\t\t\t\tcontainer : self.container\r\n\t\t\t\t\t});\r\n\t\t\t\t},\r\n\t\t\t\t// \r\n\t\t\t\tfilter : function (params) {\r\n\t\t\t\t\tvar self = this;\r\n\t\t\t\t\tself.emit('query', params);\r\n\t\t\t\t\t//TODO QuerychosenPanel\r\n\t\t\t\t},\r\n\t\t\t\t// \r\n\t\t\t\tquery : function (params) {\r\n\t\t\t\t\tvar self = this;\r\n\t\t\t\t\tself.emit('query', params);\r\n\t\t\t\t}\r\n\t\t\t}, this);\r\n\t\t}\r\n\t});\r\n\tHualala.Shop.QueryController = QueryController;\r\n})(jQuery, window);;(function ($, window) {\r\n\tIX.ns(\"Hualala.Shop\");\r\n\tvar popoverMsg = Hualala.UI.PopoverMsgTip;\r\n\tvar toptip = Hualala.UI.TopTip;\r\n\tvar CardListModel = Stapes.subclass({\r\n\t\t/**\r\n\t\t * \r\n\t\t * @param  {Object} cfg \r\n\t\t *           @param {Function} callServer \r\n\t\t * @return {Object}     \r\n\t\t */\r\n\t\tconstructor : function (cfg) {\r\n\t\t\tthis.callServer = $XP(cfg, 'callServer', null);\r\n\t\t\tif (!this.callServer) {\r\n\t\t\t\tthrow(\"callServer is empty!\");\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t}\r\n\t});\r\n\tCardListModel.proto({\r\n\t\tinit : function (params) {\r\n\t\t\tthis.set({\r\n\t\t\t\tpageCount : 0,\r\n\t\t\t\ttotalSize : 0,\r\n\t\t\t\tpageNo : $XP(params, 'pageNo', 1),\r\n\t\t\t\tpageSize : $XP(params, 'pageSize', 15),\r\n\t\t\t\tcityID : $XP(params, 'cityID', ''),\r\n\t\t\t\tareaID : $XP(params, 'areaID', ''),\r\n\t\t\t\tkeywordLst : $XP(params, 'keywordLst', ''),\r\n\t\t\t\tds_shop : new IX.IListManager(),\r\n\t\t\t\tds_page : new IX.IListManager()\r\n\t\t\t});\r\n\t\t},\r\n\t\tupdatePagerParams : function (params) {\r\n\t\t\tvar self = this;\r\n\t\t\tvar pagerParamkeys = 'pageCount,totalSize,pageNo,pageSize,cityID,areaID,keywordLst';\r\n\t\t\t// _.each(pagerParamkeys.split(','), function (k, i, l) {\r\n\t\t\t// \tswitch(k) {\r\n\t\t\t// \t\tcase 'pageCount': \r\n\t\t\t// \t\tcase 'totalSize' :\r\n\t\t\t// \t\t\tself.set(k, $XP(params, k, 0));\r\n\t\t\t// \t\t\tbreak;\r\n\t\t\t// \t\tcase 'pageNo' : \r\n\t\t\t// \t\t\tself.set(k, $XP(params, k, 1));\r\n\t\t\t// \t\t\tbreak;\r\n\t\t\t// \t\tcase 'pageSize' :\r\n\t\t\t// \t\t\tself.set(k, $XP(params, k, 15));\r\n\t\t\t// \t\t\tbreak;\r\n\t\t\t// \t\tdefault:\r\n\t\t\t// \t\t\tself.set(k, $XP(params, k, ''));\r\n\t\t\t// \t\t\tbreak;\r\n\t\t\t// \t}\r\n\t\t\t// });\r\n\t\t\t_.each(params, function (v, k, l) {\r\n\t\t\t\tif (pagerParamkeys.indexOf(k) > -1) {\r\n\t\t\t\t\tself.set(k, v);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t},\r\n\t\tgetPagerParams : function () {\r\n\t\t\t// return {\r\n\t\t\t// \tPage : {\r\n\t\t\t// \t\tpageNo : this.get('pageNo'),\r\n\t\t\t// \t\tpageSize : this.get('pageSize')\r\n\t\t\t// \t},\r\n\t\t\t// \tcityID : this.get('cityID'),\r\n\t\t\t// \tareaID : this.get('areaID'),\r\n\t\t\t// \tkeywordLst : this.get('keywordLst')\r\n\t\t\t// };\r\n\t\t\treturn {\r\n\t\t\t\tpageNo : this.get('pageNo'),\r\n\t\t\t\tpageSize : this.get('pageSize'),\r\n\t\t\t\tcityID : this.get('cityID'),\r\n\t\t\t\tareaID : this.get('areaID'),\r\n\t\t\t\tkeywordLst : this.get('keywordLst')\r\n\t\t\t};\r\n\t\t},\r\n\t\tupdateDataStore : function (data, pageNo) {\r\n\t\t\tvar self = this,\r\n\t\t\t\tshopHT = self.get('ds_shop'),\r\n\t\t\t\tpageHT = self.get('ds_page');\r\n\t\t\tvar shopIDs = _.map(data, function (shop, i, l) {\r\n\t\t\t\t// var shopID = $XP(shop, 'shopID');\r\n\t\t\t\t// shopHT.register(shopID, shop);\r\n\t\t\t\t// return shopID;\r\n\t\t\t\tvar shopID = $XP(shop, 'shopID'),\r\n\t\t\t\t\tmShop = new BaseShopModel(shop);\r\n\t\t\t\tshopHT.register(shopID, mShop);\r\n\t\t\t\treturn shopID;\r\n\t\t\t});\r\n\t\t\tpageHT.register(pageNo, shopIDs);\r\n\t\t},\r\n\t\tresetDataStore : function () {\r\n\t\t\tvar self = this,\r\n\t\t\t\tshopHT = self.get('ds_shop'),\r\n\t\t\t\tpageHT = self.get('ds_page');\r\n\t\t\tshopHT.clear();\r\n\t\t\tpageHT.clear();\r\n\t\t},\r\n\t\tload : function (params, cbFn) {\r\n\t\t\tvar self = this;\r\n\t\t\tself.updatePagerParams(params);\r\n\t\t\tself.callServer(self.getPagerParams(), function (res) {\r\n\t\t\t\tif (res.resultcode == '000') {\r\n\t\t\t\t\tself.updateDataStore($XP(res, 'data.records', []), $XP(res, 'data.page.pageNo'));\r\n\t\t\t\t\tself.updatePagerParams($XP(res, 'data.page', {}));\r\n\t\t\t\t} else {\r\n\t\t\t\t\ttoptip({\r\n\t\t\t\t\t\tmsg : $XP(res, 'resultmsg', ''),\r\n\t\t\t\t\t\ttype : 'danger'\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t\tcbFn(self);\r\n\t\t\t});\r\n\t\t},\r\n\t\tgetShops : function (pageNo) {\r\n\t\t\tvar self = this,\r\n\t\t\t\tshopHT = self.get('ds_shop'),\r\n\t\t\t\tpageHT = self.get('ds_page');\r\n\t\t\tvar ret = _.map(shopHT.getByKeys(pageHT.get(pageNo)), function (mShop, i, l) {\r\n\t\t\t\treturn mShop.getAll();\r\n\t\t\t});\r\n\t\t\tconsole.info(\"pageData:\");\r\n\t\t\tconsole.info(ret);\r\n\t\t\treturn ret;\r\n\t\t},\r\n\t\tgetShopModelByShopID : function (shopID) {\r\n\t\t\tvar self = this,\r\n\t\t\t\tshopHT = self.get('ds_shop');\r\n\t\t\treturn shopHT.get(shopID);\r\n\t\t},\r\n\t\t// \r\n\t\tupdateShopStatus : function (shopID, status, failFn) {\r\n\t\t\tvar self = this,\r\n\t\t\t\tshopHT = self.get('ds_shop');\r\n\t\t\tvar shop = shopHT.get(shopID);\r\n\t\t\t// shop = IX.inherit(shop, {\r\n\t\t\t// \tstatus : status\r\n\t\t\t// });\r\n\t\t\t// shopHT.register(shopID, shop);\r\n\t\t\t// shop.set('status', status);\r\n\t\t\tshop.emit('switchShopStatus', {\r\n\t\t\t\tstatus : status,\r\n\t\t\t\tfailFn : failFn\r\n\t\t\t});\r\n\t\t},\r\n\t\t// \r\n\t\tupdateShopBusinessStatus : function (params, failFn) {\r\n\t\t\tvar self = this,\r\n\t\t\t\tshopHT = self.get('ds_shop'),\r\n\t\t\t\tshopID = $XP(params, 'shopID'),\r\n\t\t\t\tshop = shopHT.get(shopID);\r\n\t\t\tshop.emit('switchBusinessStatus', {\r\n\t\t\t\tname : $XP(params, 'name'),\r\n\t\t\t\tid : $XP(params, 'id'),\r\n\t\t\t\tstatus : $XP(params, 'state'),\r\n\t\t\t\tfailFn : failFn\r\n\t\t\t});\r\n\r\n\t\t}\r\n\t});\r\n\r\n\r\n\tHualala.Shop.CardListModel = CardListModel;\r\n\r\n\tvar BaseShopModel = Stapes.subclass({\r\n\t\tconstructor : function (shop) {\r\n\t\t\tthis.switchShopStatusCallServer = Hualala.Global.switchShopStatus;\r\n\t\t\tthis.switchShopBusinessStatusCallServer = Hualala.Global.switchShopServiceFeatureStatus;\r\n\t\t\tthis.set(shop);\r\n\t\t\tthis.bindEvent();\r\n\t\t}\r\n\t});\r\n\tBaseShopModel.proto({\r\n\t\tswitchShopStatus : function (status, failFn) {\r\n\t\t\tvar self = this,\r\n\t\t\t\tshopID = self.get('shopID');\r\n\t\t\tself.set('status', status);\r\n\t\t\tconsole.info(\"Switch Shop [\" + self.get('shopID') + \"] status \" + status);\r\n\t\t\tthis.switchShopStatusCallServer({\r\n\t\t\t\tshopID : shopID,\r\n\t\t\t\tstatus : status\r\n\t\t\t}, function (res) {\r\n\t\t\t\tif (res.resultcode !== '000') {\r\n\t\t\t\t\t\r\n\t\t\t\t\ttoptip({\r\n\t\t\t\t\t\tmsg : $XP(res, 'resultmsg', ''),\r\n\t\t\t\t\t\ttype : 'danger'\r\n\t\t\t\t\t});\r\n\t\t\t\t\tself.set('status', !status ? 1 : 0);\r\n\t\t\t\t\tfailFn(shopID);\r\n\t\t\t\t\t\r\n\t\t\t\t} else {\r\n\t\t\t\t\ttoptip({\r\n\t\t\t\t\t\tmsg : '!',\r\n\t\t\t\t\t\ttype : 'success'\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t},\r\n\t\tswitchShopBusinessStatus : function (params) {\r\n\t\t\tvar self = this,\r\n\t\t\t\tshopID = self.get('shopID');\r\n\t\t\tvar failFn = $XF(params, 'failFn'),\r\n\t\t\t\tname = $XP(params, 'name'),\r\n\t\t\t\tid = $XP(params, 'id'),\r\n\t\t\t\tstatus = $XP(params, 'status');\r\n\t\t\tvar setServiceFeature = function (sName, s) {\r\n\t\t\t\tvar serviceFeatures = self.get('serviceFeatures').split(',');\r\n\t\t\t\t// serviceFeature\r\n\t\t\t\tif (s == 1) {\r\n\t\t\t\t\tserviceFeatures.push(sName);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tserviceFeatures = _.filter(serviceFeatures, function (el) {\r\n\t\t\t\t\t\treturn el !== sName;\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t\tself.set('serviceFeatures', serviceFeatures.join(','));\r\n\t\t\t};\r\n\t\t\tsetServiceFeature(name, status);\r\n\t\t\tconsole.info(\"Switch Shop [\" + self.get('shopID') + \"] ServiceFeature: \" + self.get('serviceFeatures'));\r\n\t\t\tthis.switchShopBusinessStatusCallServer({\r\n\t\t\t\tshopID : shopID,\r\n\t\t\t\tserviceFeature : name,\r\n\t\t\t\toperation : status\r\n\t\t\t}, function (res) {\r\n\t\t\t\tif (res.resultcode !== '000') {\r\n\t\t\t\t\ttoptip({\r\n\t\t\t\t\t\tmsg : $XP(res, 'resultmsg', ''),\r\n\t\t\t\t\t\ttype : 'danger'\r\n\t\t\t\t\t});\r\n\t\t\t\t\tsetServiceFeature(name, !status ? 1 : 0);\r\n\t\t\t\t\tfailFn({\r\n\t\t\t\t\t\tshopID : shopID,\r\n\t\t\t\t\t\tid : id\r\n\t\t\t\t\t});\r\n\t\t\t\t} else {\r\n\t\t\t\t\ttoptip({\r\n\t\t\t\t\t\tmsg : '!',\r\n\t\t\t\t\t\ttype : 'success'\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t},\r\n\t\tbindEvent : function () {\r\n\t\t\tvar self = this;\r\n\t\t\tthis.on({\r\n\t\t\t\t\"switchShopStatus\" : function (params) {\r\n\t\t\t\t\tvar status = $XP(params, 'status'),\r\n\t\t\t\t\t\tfailFn = $XF(params, 'failFn');\r\n\t\t\t\t\tthis.switchShopStatus(status, failFn);\r\n\t\t\t\t},\r\n\t\t\t\t\"switchBusinessStatus\" : function (params) {\r\n\t\t\t\t\tthis.switchShopBusinessStatus(params);\r\n\t\t\t\t},\r\n\t\t\t\t\"setServiceParams\" : function (cfg) {\r\n\t\t\t\t\tvar callServer = $XF(cfg, 'callServer'),\r\n\t\t\t\t\t\tparams = $XP(cfg, 'params', {}),\r\n\t\t\t\t\t\tserviceID = $XP(cfg, 'serviceID'),\r\n\t\t\t\t\t\tshopID = self.get('shopID'),\r\n\t\t\t\t\t\tfailFn = $XF(cfg, 'failFn'),\r\n\t\t\t\t\t\tsuccessFn = $XF(cfg, 'successFn');\r\n\t\t\t\t\tcallServer(IX.inherit(params, {\r\n\t\t\t\t\t\tshopID : shopID,\r\n\t\t\t\t\t\tstrType : serviceID\r\n\t\t\t\t\t}), function (res) {\r\n\t\t\t\t\t\tif (res.resultcode !== '000') {\r\n\t\t\t\t\t\t\ttoptip({\r\n\t\t\t\t\t\t\t\tmsg : $XP(res, 'resultmsg', ''),\r\n\t\t\t\t\t\t\t\ttype : 'danger'\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\tfailFn();\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tvar newData = {};\r\n\t\t\t\t\t\t\tnewData[serviceID] = params;\r\n\t\t\t\t\t\t\tself.set('revParamJson', IX.inherit(self.get('revParamJson'), newData));\r\n\t\t\t\t\t\t\tsuccessFn();\r\n\t\t\t\t\t\t\ttoptip({\r\n\t\t\t\t\t\t\t\tmsg : '!',\r\n\t\t\t\t\t\t\t\ttype : 'success'\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\t});\r\n})(jQuery, window);;(function ($, window) {\r\n\tIX.ns(\"Hualala.Shop\");\r\n\tvar popoverMsg = Hualala.UI.PopoverMsgTip;\r\n\tvar toptip = Hualala.UI.TopTip;\r\n\tvar CardListView = Stapes.subclass({\r\n\t\tconstructor : function () {\r\n\t\t\t// View\r\n\t\t\tthis.$container = null;\r\n\t\t\t// \r\n\t\t\tthis.$resultBox = null;\r\n\t\t\t// \r\n\t\t\tthis.$list = null;\r\n\t\t\t// \r\n\t\t\tthis.$pager = null;\r\n\t\t\tthis.loadTemplates();\r\n\t\t}\r\n\t});\r\n\tCardListView.proto({\r\n\t\tinit : function (cfg) {\r\n\t\t\tthis.$container = $XP(cfg, 'container', null);\r\n\t\t\tthis.model = $XP(cfg, 'model', null);\r\n\t\t\tif (!this.$container || !this.model) {\r\n\t\t\t\tthrow(\"CardList View Init Failed!\");\r\n\t\t\t\treturn ;\r\n\t\t\t}\r\n\t\t\tthis.initLayout();\r\n\t\t},\r\n\t\tinitLayout : function () {\r\n\t\t\tvar layoutTpl = this.get('layoutTpl');\r\n\t\t\tvar htm = layoutTpl();\r\n\t\t\tthis.$container.append(htm);\r\n\t\t\tthis.$resultBox = this.$container.find('.shop-list');\r\n\t\t\tthis.$list = this.$container.find('.shop-list-body');\r\n\t\t\tthis.$pager = this.$container.find('.page-selection');\r\n\t\t\tthis.initPager();\r\n\t\t\tthis.bindEvent();\r\n\t\t},\r\n\t\tinitPager : function (params) {\r\n\t\t\tvar baseCfg = {\r\n\t\t\t\ttotal : 0,\r\n\t\t\t\tpage : 1,\r\n\t\t\t\tmaxVisible : 10,\r\n\t\t\t\tleaps : true\r\n\t\t\t};\r\n\t\t\tthis.$pager.IXPager(IX.inherit(baseCfg, params));\r\n\t\t},\r\n\t\tbindEvent : function () {\r\n\t\t\tvar self = this;\r\n\t\t\tself.$list.tooltip({\r\n\t\t\t\tselector : '[title]'\r\n\t\t\t});\r\n\t\t\tself.$list.on('click', '.btn[data-href]', function (e) {\r\n\t\t\t\tvar $btn = $(this),\r\n\t\t\t\t\tpath = $btn.attr('data-href');\r\n\t\t\t\tdocument.location.href = path;\r\n\t\t\t});\r\n\t\t\tself.$pager.on('page', function (e, pageNo) {\r\n\t\t\t\tvar params = self.model.getPagerParams();\r\n\t\t\t\tparams['pageNo'] = pageNo;\r\n\t\t\t\tself.model.emit('load', IX.inherit(params, {\r\n\t\t\t\t\tpageNo : $XP(params, 'pageNo', 1),\r\n\t\t\t\t\tpageSize : $XP(params, 'pageSize', 15)\r\n\t\t\t\t}));\r\n\t\t\t});\r\n\t\t},\r\n\t\t// View\r\n\t\tloadTemplates : function () {\r\n\t\t\tvar layoutTpl = Handlebars.compile(Hualala.TplLib.get('tpl_shop_list_layout')),\r\n\t\t\t\tlistTpl = Handlebars.compile(Hualala.TplLib.get('tpl_shop_list')),\r\n\t\t\t\titemTpl = Handlebars.compile(Hualala.TplLib.get('tpl_shop_card')),\r\n\t\t\t\ttagTpl = Handlebars.compile(Hualala.TplLib.get('tpl_shop_tags'));\r\n\t\t\t// shopCard\r\n\t\t\tHandlebars.registerPartial(\"shopTag\", Hualala.TplLib.get('tpl_shop_tags'));\r\n\t\t\tHandlebars.registerPartial(\"shopCard\", Hualala.TplLib.get('tpl_shop_card'));\r\n\r\n\t\t\tthis.set({\r\n\t\t\t\tlayoutTpl : layoutTpl,\r\n\t\t\t\tlistTpl : listTpl,\r\n\t\t\t\titemTpl : itemTpl,\r\n\t\t\t\ttagTpl : tagTpl\r\n\t\t\t});\r\n\t\t},\r\n\t\t// \r\n\t\tmapTags : function (d) {\r\n\t\t\tvar self = this,\r\n\t\t\t\ttagKeys = 'areaName,cuisineName1,cuisineName2'.split(',');\r\n\t\t\tvar tags = _.map(tagKeys, function (k) {\r\n\t\t\t\treturn $XP(d, k, null);\r\n\t\t\t});\r\n\t\t\treturn _.filter(tags, function (t) {\r\n\t\t\t\treturn !IX.isEmpty(t);\r\n\t\t\t});\r\n\t\t},\r\n\t\t// \r\n\t\tmapRenderData : function (data) {\r\n\t\t\tvar self = this;\r\n\t\t\tvar getTags = function (tags) {\r\n\t\t\t\treturn _.map(tags, function (t, i, l) {\r\n\t\t\t\t\treturn {\r\n\t\t\t\t\t\tclz : 'label-info',\r\n\t\t\t\t\t\ttag : t\r\n\t\t\t\t\t};\r\n\t\t\t\t});\r\n\t\t\t};\r\n\t\t\tvar ret = _.map(data, function (shop, i, l) {\r\n\t\t\t\tvar address = $XP(shop, 'address', ''),\r\n\t\t\t\t\tbyteLen = Hualala.Common.strByteLength(address),\r\n\t\t\t\t\tslugAddr = '';\r\n\t\t\t\tslugAddr = byteLen < 72 ? address : (Hualala.Common.substrByte(address, 70) + '...');\r\n\t\t\t\treturn {\r\n\t\t\t\t\tclz : '',\r\n\t\t\t\t\tid : $XP(shop, 'shopID', ''),\r\n\t\t\t\t\tname : $XP(shop, 'shopName', ''),\r\n\t\t\t\t\timg : Hualala.Common.getSourceImage($XP(shop, 'imagePath', ''), {\r\n\t\t\t\t\t\twidth : 100,\r\n\t\t\t\t\t\theight : 100,\r\n\t\t\t\t\t\tquality : 50\r\n\t\t\t\t\t}),\r\n\t\t\t\t\t// tags : getTags($XP(shop, 'tags', [])),\r\n\t\t\t\t\ttags : getTags(self.mapTags(shop)),\r\n\t\t\t\t\taddress : address,\r\n\t\t\t\t\tslugAddr : slugAddr,\r\n\t\t\t\t\ttel : $XP(shop, 'tel', ''),\r\n\t\t\t\t\tinfoHref : Hualala.PageRoute.createPath('shopInfo', [$XP(shop, 'shopID', '')]),\r\n\t\t\t\t\tmenuHref : Hualala.PageRoute.createPath('shopMenu', [$XP(shop, 'shopID', '')]),\r\n\t\t\t\t\tchecked : $XP(shop, 'status') == 1 ? 'checked' : ''\r\n\t\t\t\t};\r\n\t\t\t});\r\n\t\t\treturn {\r\n\t\t\t\tshopCard : {\r\n\t\t\t\t\tlist : ret\r\n\t\t\t\t}\r\n\t\t\t};\r\n\t\t},\r\n\t\t// \r\n\t\tinitSwitcher : function (selector) {\r\n\t\t\tvar self = this;\r\n\t\t\tself.$list.find(selector).bootstrapSwitch({\r\n\t\t\t\t// baseClass : 'ix-bs-switch',\r\n\t\t\t\t// wrapperClass : 'ix-bs-switch-wrapper',\r\n\t\t\t\tsize : 'normal',\r\n\t\t\t\tonColor : 'success',\r\n\t\t\t\toffColor : 'default',\r\n\t\t\t\tonText : '',\r\n\t\t\t\toffText : ''\r\n\t\t\t});\r\n\t\t\t// \r\n\t\t\tself.$list.find(selector).on('switchChange.bootstrapSwitch', function (e, state) {\r\n\t\t\t\tvar $chkbox = $(this),\r\n\t\t\t\t\tshopID = $chkbox.attr('data-shop'),\r\n\t\t\t\t\tstate = !state ? 0 : 1;\r\n\t\t\t\tself.model.updateShopStatus(shopID, state, function (_shopID) {\r\n\t\t\t\t\tself.$list.find(selector).filter('[data-shop=' + _shopID + ']').bootstrapSwitch('toggleState', true);\r\n\t\t\t\t});\r\n\t\t\t});\r\n\t\t},\r\n\t\t// view\r\n\t\trender : function () {\r\n\t\t\tvar self = this,\r\n\t\t\t\tmodel = self.model,\r\n\t\t\t\tpagerParams = model.getPagerParams(),\r\n\t\t\t\tpageNo = $XP(pagerParams, 'pageNo');\r\n\t\t\tvar shops = model.getShops(pageNo);\r\n\t\t\tvar renderData = self.mapRenderData(shops);\r\n\t\t\tvar listTpl = self.get('listTpl');\r\n\t\t\tvar html = listTpl(renderData);\r\n\t\t\tself.$list.empty();\r\n\t\t\tself.$list.html(html);\r\n\t\t\tself.initPager({\r\n\t\t\t\ttotal : model.get('pageCount'),\r\n\t\t\t\tpage : model.get('pageNo'),\r\n\t\t\t\thref : 'javascript:void(0);'\r\n\t\t\t});\r\n\t\t\t// self.$list.find(':checkbox[name*=switcher_]').bootstrapSwitch();\r\n\t\t\tself.initSwitcher(':checkbox[name=switcher]');\r\n\t\t}\r\n\t});\r\n\r\n\tHualala.Shop.CardListView = CardListView;\r\n\r\n\tvar ShopListView = CardListView.subclass({\r\n\t\tconstructor : function () {\r\n\t\t\t// View\r\n\t\t\tthis.$container = null;\r\n\t\t\t// \r\n\t\t\tthis.$resultBox = null;\r\n\t\t\t// \r\n\t\t\tthis.$list = null;\r\n\t\t\t// \r\n\t\t\tthis.$pager = null;\r\n\t\t\tthis.loadTemplates();\r\n\t\t}\r\n\t});\r\n\tShopListView.proto({\r\n\t\tbindEvent : function () {\r\n\t\t\tvar self = this;\r\n\t\t\tself.$list.tooltip({\r\n\t\t\t\tselector : '[title]'\r\n\t\t\t});\r\n\t\t\tself.$pager.on('page', function (e, pageNo) {\r\n\t\t\t\tvar params = self.model.getPagerParams();\r\n\t\t\t\tparams['pageNo'] = pageNo;\r\n\t\t\t\tself.model.emit('load', IX.inherit(params, {\r\n\t\t\t\t\tpageNo : $XP(params, 'pageNo', 1),\r\n\t\t\t\t\tpageSize : $XP(params, 'pageSize', 15)\r\n\t\t\t\t}));\r\n\t\t\t});\r\n\t\t\t// \r\n\t\t\tself.$list.on('click', '.btn[data-business]', function (e) {\r\n\t\t\t\tvar $btn = $(this),\r\n\t\t\t\t\tshopID = $btn.attr('data-shop'),\r\n\t\t\t\t\tbusinessName = $btn.attr('data-business'),\r\n\t\t\t\t\tbusinessID = $btn.attr('data-business-id');\r\n\t\t\t\tself.initBusinessModal($btn, shopID, businessName, businessID);\r\n\t\t\t});\r\n\t\t},\r\n\t\t// View\r\n\t\tloadTemplates : function () {\r\n\t\t\tvar layoutTpl = Handlebars.compile(Hualala.TplLib.get('tpl_shop_list_layout')),\r\n\t\t\t\tlistTpl = Handlebars.compile(Hualala.TplLib.get('tpl_shop_list')),\r\n\t\t\t\titemTpl = Handlebars.compile(Hualala.TplLib.get('tpl_shop_list_item')),\r\n\t\t\t\ttagTpl = Handlebars.compile(Hualala.TplLib.get('tpl_shop_tags'));\r\n\t\t\t// shopCard\r\n\t\t\tHandlebars.registerPartial(\"shopTag\", Hualala.TplLib.get('tpl_shop_tags'));\r\n\t\t\tHandlebars.registerPartial(\"shopItem\", Hualala.TplLib.get('tpl_shop_list_item'));\r\n\r\n\t\t\tthis.set({\r\n\t\t\t\tlayoutTpl : layoutTpl,\r\n\t\t\t\tlistTpl : listTpl,\r\n\t\t\t\titemTpl : itemTpl,\r\n\t\t\t\ttagTpl : tagTpl\r\n\t\t\t});\r\n\t\t},\r\n\t\t// \r\n\t\tgetShopBusiness : function (shop) {\r\n\t\t\tvar business = Hualala.TypeDef.ShopBusiness,\r\n\t\t\t\tbusinessHT = new IX.IListManager(),\r\n\t\t\t\tserviceFeatures = $XP(shop, 'serviceFeatures', ''),\r\n\t\t\t\tbusinessCfg = $XP(shop, 'revParamJson', {});\r\n\t\t\tvar ret = null;\r\n\t\t\t_.each(business, function (item, i, l) {\r\n\t\t\t\tvar id = $XP(item, 'id'), name = $XP(item, 'name')\r\n\t\t\t\t\tswitcherStatus = serviceFeatures.indexOf(name) >= 0 ? 1 : 0;\r\n\t\t\t\tvar ret = IX.inherit(item, $XP(businessCfg, 'id'), {\r\n\t\t\t\t\tswitcherStatus : switcherStatus,\r\n\t\t\t\t\tshopID : $XP(shop, 'shopID')\r\n\t\t\t\t});\r\n\t\t\t\tbusinessHT.register(name, ret);\r\n\t\t\t});\r\n\t\t\tret = _.filter(businessHT.getAll(), function (el) {\r\n\t\t\t\treturn $XP(el, 'businessIsSupported', false) == true;\r\n\t\t\t});\r\n\t\t\treturn ret;\r\n\t\t},\r\n\t\t// \r\n\t\tmapBusinessRenderData : function (shop) {\r\n\t\t\tvar self = this,\r\n\t\t\t\tdata = self.getShopBusiness(shop);\r\n\t\t\treturn _.map(data, function (el) {\r\n\t\t\t\tvar name = $XP(el, 'name'),\r\n\t\t\t\t\ticon = 'icon-' + name,\r\n\t\t\t\t\tswitcherName = 'switcher_business',\r\n\t\t\t\t\topen = $XP(el, 'switcherStatus') == 1 ? 'checked' : '';\r\n\t\t\t\treturn {\r\n\t\t\t\t\ticon : icon,\r\n\t\t\t\t\tlabel : $XP(el, 'label'),\r\n\t\t\t\t\tswitcherName : switcherName,\r\n\t\t\t\t\tshopID : $XP(el, 'shopID'),\r\n\t\t\t\t\ttype : name,\r\n\t\t\t\t\tid : $XP(el, 'id'),\r\n\t\t\t\t\topen : open,\r\n\t\t\t\t\tdesc : ''\r\n\t\t\t\t};\r\n\t\t\t});\r\n\t\t},\r\n\t\t// \r\n\t\tchkHasAccountRole : function () {\r\n\t\t\tvar loginUsr = Hualala.getSessionUser(),\r\n\t\t\t\tusrRoles = $XP(loginUsr, 'role');\r\n\t\t\t\troles = Hualala.getSessionRoles();\r\n\t\t\tvar ret = _.find(roles, function (role) {\r\n\t\t\t\tvar roleType = $XP(role, 'roleType');\r\n\t\t\t\tvar matchedID = _.find(usrRoles, function (v) {\r\n\t\t\t\t\treturn $XP(role, 'id') == v;\r\n\t\t\t\t});\r\n\t\t\t\treturn !!matchedID && (roleType == 'account' || roleType == 'all');\r\n\t\t\t});\r\n\t\t\treturn !!ret;\r\n\t\t},\r\n\t\t// \r\n\t\tmapRenderData : function (data) {\r\n\t\t\tvar self = this;\r\n\t\t\tvar ret = _.map(data, function (shop, i, l) {\r\n\t\t\t\treturn {\r\n\t\t\t\t\tclz : '',\r\n\t\t\t\t\tshopID : $XP(shop, 'shopID', ''),\r\n\t\t\t\t\tshopName : $XP(shop, 'shopName', ''),\r\n\t\t\t\t\thideAccount : !self.chkHasAccountRole() ? 'hidden' : '',\r\n\t\t\t\t\tsettleName : $XP(shop, 'settleName', ''),\r\n\t\t\t\t\tswitcherName : 'switcher_status',\r\n\t\t\t\t\tshopOpen : $XP(shop, 'status') == 1 ? 'checked' : '',\r\n\t\t\t\t\tbusiness : self.mapBusinessRenderData(shop)\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\treturn {\r\n\t\t\t\tshopItem : {\r\n\t\t\t\t\tlist : ret\r\n\t\t\t\t}\r\n\t\t\t};\r\n\t\t},\r\n\t\t// \r\n\t\tinitSwitcher : function (selector) {\r\n\t\t\tvar self = this;\r\n\t\t\tself.$list.find(selector).bootstrapSwitch({\r\n\t\t\t\t// baseClass : 'ix-bs-switch',\r\n\t\t\t\t// wrapperClass : 'ix-bs-switch-wrapper',\r\n\t\t\t\tsize : 'normal',\r\n\t\t\t\tonColor : selector == ':checkbox[name=switcher_business]' ? 'primary' : 'success',\r\n\t\t\t\toffColor : 'default',\r\n\t\t\t\tonText : '',\r\n\t\t\t\toffText : ''\r\n\t\t\t});\r\n\t\t\t// \r\n\t\t\tself.$list.find(selector).on('switchChange.bootstrapSwitch', function (e, state) {\r\n\t\t\t\tvar $chkbox = $(this),\r\n\t\t\t\t\tname = $chkbox.attr('name'),\r\n\t\t\t\t\tshopID = $chkbox.attr('data-shop'),\r\n\t\t\t\t\tstate = !state ? 0 : 1,\r\n\t\t\t\t\tbusiness = $chkbox.attr('data-business'),\r\n\t\t\t\t\tbusinessID = $chkbox.attr('data-business-id');\r\n\t\t\t\tif (name == 'switcher_status') {\r\n\t\t\t\t\tself.model.updateShopStatus(shopID, state, function (_shopID) {\r\n\t\t\t\t\t\tself.$list.find(selector).filter('[data-shop=' + _shopID + ']').bootstrapSwitch('toggleState', true);\r\n\t\t\t\t\t});\r\n\t\t\t\t} else {\r\n\t\t\t\t\tself.model.updateShopBusinessStatus({\r\n\t\t\t\t\t\tshopID : shopID,\r\n\t\t\t\t\t\tname : business,\r\n\t\t\t\t\t\tid : businessID,\r\n\t\t\t\t\t\tstatus : state\r\n\t\t\t\t\t}, function (params) {\r\n\t\t\t\t\t\tself.$list.find(selector).filter('[data-shop=' + $XP(params, 'shopID') + '][data-business-id=' + $XP(params, 'id') + ']')\r\n\t\t\t\t\t\t\t.bootstrapSwitch('toggleState', true);\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t});\r\n\t\t},\r\n\t\t// view\r\n\t\trender : function () {\r\n\t\t\tvar self = this,\r\n\t\t\t\tmodel = self.model,\r\n\t\t\t\tpagerParams = model.getPagerParams(),\r\n\t\t\t\tpageNo = $XP(pagerParams, 'pageNo');\r\n\t\t\tvar shops = model.getShops(pageNo);\r\n\t\t\tvar renderData = self.mapRenderData(shops);\r\n\t\t\tvar listTpl = self.get('listTpl');\r\n\t\t\tvar html = listTpl(renderData);\r\n\t\t\tself.$list.empty();\r\n\t\t\tself.$list.html(html);\r\n\t\t\tself.initPager({\r\n\t\t\t\ttotal : model.get('pageCount'),\r\n\t\t\t\tpage : model.get('pageNo'),\r\n\t\t\t\thref : 'javascript:void(0);'\r\n\t\t\t});\r\n\t\t\t// self.$list.find(':checkbox[name*=switcher_]').bootstrapSwitch();\r\n\t\t\tself.initSwitcher(':checkbox[name=switcher_business]');\r\n\t\t\tself.initSwitcher(':checkbox[name=switcher_status]');\r\n\t\t},\r\n\t\t// \r\n\t\tinitBusinessModal : function (trigger, shopID, name, id) {\r\n\t\t\tvar self = this;\r\n\t\t\tvar editView = new Hualala.Setting.editServiceView({\r\n\t\t\t\ttriggerEl : trigger,\r\n\t\t\t\tserviceID : id,\r\n\t\t\t\tserviceName : name,\r\n\t\t\t\tmodel : self.model.getShopModelByShopID(shopID)\r\n\t\t\t});\r\n\t\t}\r\n\t});\r\n\tHualala.Shop.ShopListView = ShopListView;\r\n})(jQuery, window);;(function ($, window) {\r\n\tIX.ns(\"Hualala.Shop\");\r\n\tvar popoverMsg = Hualala.UI.PopoverMsgTip;\r\n\tvar toptip = Hualala.UI.TopTip;\r\n\tvar ShopListModel = Hualala.Shop.ShopListModel;\r\n\tvar ShopListView = Hualala.Shop.ShopListView;\r\n\tvar ShopListController = Stapes.subclass({\r\n\t\t/**\r\n\t\t * \r\n\t\t * @param  {Object} cfg \r\n\t\t *          @param {JQueryObj} container \r\n\t\t *          @param {Object} view  View\r\n\t\t *          @param {Object} model \r\n\t\t * @return {Object}     \r\n\t\t */\r\n\t\tconstructor : function (cfg) {\r\n\t\t\tthis.set({\r\n\t\t\t\tsessionData : Hualala.getSessionData()\r\n\t\t\t});\r\n\t\t\tthis.container = $XP(cfg, 'container', null);\r\n\t\t\tthis.view = $XP(cfg, 'view', null),\r\n\t\t\tthis.model = $XP(cfg, 'model', null);\r\n\t\t\tif (!this.view || !this.model || !this.container) {\r\n\t\t\t\tthrow(\"Shop List init faild!!\");\r\n\t\t\t}\r\n\t\t\tthis.isReady = false;\r\n\t\t\tthis.bindEvent();\r\n\t\t}\r\n\t});\r\n\tShopListController.proto({\r\n\t\tinit : function (params) {\r\n\t\t\tthis.model.init(params);\r\n\t\t\tthis.view.init({\r\n\t\t\t\tmodel : this.model,\r\n\t\t\t\tcontainer : this.container\r\n\t\t\t});\r\n\t\t\tthis.isReady = true;\r\n\t\t},\r\n\t\thasReady : function () {return this.isReady;},\r\n\t\tbindEvent : function () {\r\n\t\t\tthis.on({\r\n\t\t\t\tload : function (params) {\r\n\t\t\t\t\tvar self = this;\r\n\t\t\t\t\tif (!self.hasReady()) {\r\n\t\t\t\t\t\tself.init(params);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tself.model.emit('load', params);\r\n\t\t\t\t}\r\n\t\t\t}, this);\r\n\t\t\tthis.model.on({\r\n\t\t\t\tload : function (params) {\r\n\t\t\t\t\tvar self = this;\r\n\t\t\t\t\tvar cbFn = function () {\r\n\t\t\t\t\t\tself.view.emit('render');\r\n\t\t\t\t\t};\r\n\t\t\t\t\tself.model.load(params, cbFn);\r\n\t\t\t\t},\r\n\t\t\t\t// \"update:totalSize\" : function (v) {\r\n\t\t\t\t// \tvar self = this;\r\n\t\t\t\t// \tself.view.initPager({\r\n\t\t\t\t// \t\ttotal : self.get('totalSize'),\r\n\t\t\t\t// \t\tpage : self.get('pageNo')\r\n\t\t\t\t// \t});\r\n\t\t\t\t// }\r\n\t\t\t}, this);\r\n\t\t\tthis.view.on({\r\n\t\t\t\trender : function () {\r\n\t\t\t\t\tvar self = this;\r\n\t\t\t\t\tself.view.render();\r\n\t\t\t\t},\r\n\t\t\t\treloadPager : function (params) {\r\n\t\t\t\t\tvar self = this;\r\n\t\t\t\t\tself.view.initPager(params);\r\n\t\t\t\t}\r\n\t\t\t}, this);\r\n\t\t}\r\n\t});\r\n\tHualala.Shop.ShopListController = ShopListController;\r\n})(jQuery, window);;(function ($, window) {\r\nIX.ns('Hualala.Shop');\r\nvar G = Hualala.Global,\r\n    U = Hualala.UI,\r\n    topTip = U.TopTip; \r\n// \r\nHualala.Shop.initCreate = function ($wizard)\r\n{\r\n    //\r\n    $wizard.bootstrapWizard();\r\n    var bsWizard = $wizard.data('bootstrapWizard'),\r\n        $step1 = $wizard.find('#tab1'),\r\n        $step2 = $wizard.find('#tab2'),\r\n        $step3 = $wizard.find('#tab3'),\r\n        $city = $step1.find('#cityID'),\r\n        $area = $step1.find('#areaID'),\r\n        $cuisine1 = $step1.find('#cuisineID1'),\r\n        $cuisine2 = $step1.find('#cuisineID2');\r\n    // \r\n    initCities($city);\r\n    // \r\n    $city.on('change', function ()\r\n    {\r\n        var cityID = $(this).val();\r\n        if(!cityID) return;\r\n        \r\n        initAreas($area, cityID);\r\n        initCuisines($cuisine1, $cuisine2, cityID);\r\n        \r\n    });\r\n    // timepicker\r\n    $step1.find('#openingHoursStart, #openingHoursEnd').timepicker({\r\n        minuteStep: 1,\r\n        showMeridian: false,\r\n        disableFocus : true,\r\n        showInputs : false\r\n    });\r\n    // \r\n    $step1.bootstrapValidator({\r\n        fields: {\r\n            shopName: {\r\n                message: '',\r\n                validators: {\r\n                    notEmpty: {\r\n                        message: ''\r\n                    },\r\n                    stringLength: {\r\n                        min: 2,\r\n                        max: 100,\r\n                        message: '2100'\r\n                    }\r\n                }\r\n            },\r\n            cityID: {\r\n                validators: { notEmpty: { message: '' } }\r\n            },\r\n            tel: {\r\n                validators: {\r\n                    notEmpty: { message: '' },\r\n                    telOrMobile: { message: '' }\r\n                }\r\n            },\r\n            address: {\r\n                validators: {\r\n                    notEmpty: { message: '' },\r\n                    stringLength: {\r\n                        min: 6,\r\n                        max: 100,\r\n                        message: '6100'\r\n                    }\r\n                }\r\n            },\r\n            PCCL: {\r\n                validators: {\r\n                    notEmpty: { message: '' },\r\n                    numeric: { message: '' }\r\n                }\r\n            },\r\n            operationMode: {\r\n                validators: {\r\n                    notEmpty: { message: '' }\r\n                }\r\n            },\r\n            openingHoursStart: {\r\n                validators: {\r\n                    notEmpty: { message: '' },\r\n                    time: { message: '' }\r\n                }\r\n            },\r\n            openingHoursEnd: {\r\n                validators: {\r\n                    notEmpty: { message: '' },\r\n                    time: {\r\n                        message: '',\r\n                        startTimeField: 'openingHoursStart'\r\n                    }\r\n                }\r\n            },\r\n            areaID: {\r\n                validators: {\r\n                    notEmpty: { message: '' }\r\n                }\r\n            },\r\n            cuisineID1: {\r\n                validators: {\r\n                    notEmpty: { message: '1' }\r\n                }\r\n            }\r\n        }\r\n    });\r\n    \r\n    var $uploadImg = $step1.find('#uploadImg'),\r\n        imagePath = ''; // \r\n    $uploadImg.find('img').attr('src', G.IMAGE_ROOT + '/shop_head_img_default.png');\r\n    // \r\n    $uploadImg.find('button, img').on('click', function()\r\n    {\r\n        U.uploadImg({\r\n            onSuccess: function (imgPath, $dlg)\r\n            {\r\n                var src = G.IMAGE_RESOURCE_DOMAIN + '/' + imgPath;\r\n                imagePath = imgPath;\r\n                $uploadImg.find('img').attr('src', src);\r\n                $dlg.modal('hide');\r\n            }\r\n        });\r\n    });\r\n    //bsWizard.show(1);\r\n    var dataStep1 = null, // \r\n        map = null, // \r\n        shopID = '',\r\n        $searchBox = $step2.find('.map-search-box'),\r\n        $shopSettingLink = $step3.find('#shopSettingLink');\r\n    // \r\n    $wizard.find('#nextStep').on('click', function()\r\n    {\r\n        var $curStep = bsWizard.activePane();\r\n        // \r\n        if($curStep.is('#tab1'))\r\n        {\r\n            if(!$step1.data('bootstrapValidator').validate().isValid()) return;\r\n            // \r\n            dataStep1 = Hualala.Common.parseForm($step1);\r\n            dataStep1.shopID = shopID;\r\n            dataStep1.shopName = dataStep1.shopName.replace('', '(').replace('', ')');\r\n            dataStep1.areaName = getSelectText($area);\r\n            dataStep1.cuisineName1 = getSelectText($cuisine1);\r\n            dataStep1.cuisineName2 = dataStep1.cuisineID2 ? getSelectText($cuisine2) : '';\r\n            dataStep1.imagePath = imagePath;\r\n            dataStep1.openingHours = dataStep1.openingHoursStart + '-' + dataStep1.openingHoursEnd;\r\n            var keywords = [dataStep1.shopName, dataStep1.address, dataStep1.cuisineName1];\r\n            dataStep1.cuisineName2 && keywords.push(dataStep1.cuisineName2);\r\n            keywords.push(dataStep1.areaName);\r\n            dataStep1.keywordLst = keywords.join(' | ');\r\n            // \r\n            var callServer = shopID ? G.updateShopBaseInfo : G.createShop;\r\n            callServer(dataStep1, function(rsp)\r\n            {\r\n                if(rsp.resultcode != '000')\r\n                {\r\n                    rsp.resultmsg && topTip({msg: rsp.resultmsg, type: 'danger'});\r\n                    return;\r\n                }\r\n                shopID = shopID || rsp.data.records[0].shopID;\r\n                $shopSettingLink.attr('href', Hualala.PageRoute.createPath('setting'));\r\n                // \r\n                bsWizard.next();\r\n                // \r\n                map = Hualala.Shop.map({data: {\r\n                    isSearchMap: true,\r\n                    shopName: dataStep1.shopName,\r\n                    tel: dataStep1.tel,\r\n                    address: dataStep1.address\r\n                }, searchBox: $searchBox});\r\n                \r\n            });\r\n            \r\n            return;\r\n        }\r\n        // \r\n        if($curStep.is('#tab2'))\r\n        {\r\n            var lng = map.mapPoint.lng, lat = map.mapPoint.lat,\r\n                mapInfo = {\r\n                    shopID: shopID,\r\n                    mapLongitudeValue: lng,\r\n                    mapLatitudeValue: lat,\r\n                    mapLongitudeValueBaiDu: lng,\r\n                    mapLatitudeValueBaiDu: lat\r\n                };\r\n            var callServer = G.setShopMap;\r\n            callServer(mapInfo, function(rsp)\r\n            {\r\n                if(rsp.resultcode != '000')\r\n                {\r\n                    rsp.resultmsg && topTip({msg: rsp.resultmsg, type: 'danger'});\r\n                    return;\r\n                }\r\n            });\r\n        }\r\n        bsWizard.next();\r\n    });\r\n    \r\n}\r\n// \r\nfunction initCuisines($cuisine1, $cuisine2, cityID)\r\n{\r\n    var callServer = G.getCuisines;\r\n    callServer({cityID: cityID}, function(rsp)\r\n    {\r\n        if(rsp.resultcode != '000')\r\n        {\r\n            rsp.resultmsg && topTip({msg: rsp.resultmsg, type: 'danger'});\r\n            return;\r\n        }\r\n        \r\n        fillSelectBox($cuisine1, rsp.data.records, 'cuisineID', 'cuisineName');\r\n        fillSelectBox($cuisine2, rsp.data.records, 'cuisineID', 'cuisineName', '----');\r\n    });\r\n    \r\n}\r\n// \r\nfunction initAreas($selectBox, cityID)\r\n{\r\n    var callServer = G.getAreas;\r\n    callServer({cityID: cityID}, function(rsp)\r\n    {\r\n        if(rsp.resultcode != '000')\r\n        {\r\n            rsp.resultmsg && topTip({msg: rsp.resultmsg, type: 'danger'});\r\n            return;\r\n        }\r\n        \r\n        fillSelectBox($selectBox, rsp.data.records, 'areaID', 'areaName');\r\n    });\r\n    \r\n}\r\n// \r\nfunction initCities($selectBox)\r\n{\r\n    var callServer = G.getCities;\r\n    callServer({isActive: 1}, function(rsp)\r\n    {\r\n        if(rsp.resultcode != '000')\r\n        {\r\n            rsp.resultmsg && topTip({msg: rsp.resultmsg, type: 'danger'});\r\n            return;\r\n        }\r\n        \r\n        fillSelectBox($selectBox, rsp.data.records, 'cityID', 'cityName');\r\n    });\r\n    \r\n}\r\n// \r\nfunction fillSelectBox($selectBox, data, key, value, initialValue)\r\n{\r\n    var optionsHtml = '<option value=\"\">' + \r\n                      (initialValue || '----') + \r\n                      '</option>';\r\n    $.each(data, function (i, o)\r\n    {\r\n        optionsHtml += '<option value=\"' + \r\n                       o[key] + '\">' + \r\n                       o[value] + \r\n                       '</option>';\r\n    });\r\n        \r\n    $selectBox.empty().html(optionsHtml);\r\n}\r\n// \r\nfunction getSelectText($select)\r\n{\r\n    return $select.find('option:selected').text().replace(/-/g, '');\r\n}\r\n\r\n})(jQuery, window);\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n;(function ($, window) {\r\nIX.ns('Hualala.Shop');\r\nvar G = Hualala.Global,\r\n    U = Hualala.UI,\r\n    S = Hualala.Shop,\r\n    topTip = U.TopTip,\r\n    parseForm = Hualala.Common.parseForm,\r\n    initMap = Hualala.Shop.map;\r\n// \r\nS.initInfo = function ($container, pageType, params)\r\n{\r\n    if(!params) return;\r\n    // \r\n    var $shopFuncNav = S.createShopFuncNav(pageType, params, $container);\r\n    \r\n    var shopID = params, shopInfo = null,\r\n        $form = null, $city = null, $area = null, \r\n        $cuisine1 = null, $cuisine2 = null,\r\n        imagePath = '', $img = null,\r\n        imgHost = G.IMAGE_RESOURCE_DOMAIN + '/',\r\n        bv = null, map = null;\r\n    \r\n    G.getShopInfo({shopID : shopID}, function (rsp)\r\n    {\r\n        if(rsp.resultcode != '000')\r\n        {\r\n            rsp.resultmsg && topTip({msg: rsp.resultmsg, type: 'danger'});\r\n            return;\r\n        }\r\n        shopInfo = rsp.data.records[0];\r\n        \r\n        // \r\n        S.createShopInfoHead(shopInfo, $container, function($shopInfoHead)\r\n        {\r\n            $shopFuncNav.before($shopInfoHead);\r\n        });\r\n        \r\n        var openTime = shopInfo.openingHours.split('-');\r\n        shopInfo.openingHoursStart = openTime[0];\r\n        shopInfo.openingHoursEnd = openTime[1];\r\n        shopInfo.operationModeName = shopInfo.operationMode == '1' ? '' : '';\r\n        \r\n        var tpl = Handlebars.compile(Hualala.TplLib.get('tpl_shop_info'));\r\n        $form = $(tpl(shopInfo)).appendTo($container);\r\n        $city = $form.find('#cityID'),\r\n        $area = $form.find('#areaID'),\r\n        $cuisine1 = $form.find('#cuisineID1'),\r\n        $cuisine2 = $form.find('#cuisineID2');\r\n        \r\n        // \r\n        $city.on('change', function (e, areaID, cuisineID1, cuisineID2)\r\n        {\r\n            var cityID = $(this).val();\r\n            if(!cityID) return;\r\n            \r\n            initAreas($area, cityID, areaID);\r\n            initCuisines($cuisine1, $cuisine2, cityID, cuisineID1, cuisineID2);\r\n            \r\n        });\r\n        initCities($city, shopInfo);\r\n        // \r\n        \r\n        // timepicker\r\n        $form.find('#openingHoursStart, #openingHoursEnd').timepicker({\r\n            minuteStep: 1,\r\n            showMeridian: false,\r\n            disableFocus : true,\r\n            showInputs : false\r\n        });\r\n        // \r\n        $form.bootstrapValidator({\r\n            fields: {\r\n                shopName: {\r\n                    message: '',\r\n                    validators: {\r\n                        notEmpty: {\r\n                            message: ''\r\n                        },\r\n                        stringLength: {\r\n                            min: 2,\r\n                            max: 100,\r\n                            message: '2100'\r\n                        }\r\n                    }\r\n                },\r\n                cityID: {\r\n                    validators: { notEmpty: { message: '' } }\r\n                },\r\n                tel: {\r\n                    validators: {\r\n                        notEmpty: { message: '' },\r\n                        telOrMobile: { message: '' }\r\n                    }\r\n                },\r\n                address: {\r\n                    validators: {\r\n                        notEmpty: { message: '' },\r\n                        stringLength: {\r\n                            min: 6,\r\n                            max: 100,\r\n                            message: '6100'\r\n                        }\r\n                    }\r\n                },\r\n                PCCL: {\r\n                    validators: {\r\n                        notEmpty: { message: '' },\r\n                        numeric: { message: '' }\r\n                    }\r\n                },\r\n                operationMode: {\r\n                    validators: {\r\n                        notEmpty: { message: '' }\r\n                    }\r\n                },\r\n                openingHoursStart: {\r\n                    validators: {\r\n                        notEmpty: { message: '' },\r\n                        time: { message: '' }\r\n                    }\r\n                },\r\n                openingHoursEnd: {\r\n                    validators: {\r\n                        notEmpty: { message: '' },\r\n                        time: {\r\n                            message: '',\r\n                            startTimeField: 'openingHoursStart'\r\n                        }\r\n                    }\r\n                },\r\n                areaID: {\r\n                    validators: {\r\n                        notEmpty: { message: '' }\r\n                    }\r\n                },\r\n                cuisineID1: {\r\n                    validators: {\r\n                        notEmpty: { message: '1' }\r\n                    }\r\n                }\r\n            }\r\n        });\r\n        bv = $form.data('bootstrapValidator');\r\n        \r\n        var $uploadImg = $form.find('#uploadImg');\r\n        $img = $uploadImg.find('img').attr('src', G.IMAGE_ROOT + '/shop_head_img_default.png');\r\n        imagePath = shopInfo.imagePath;\r\n        imagePath && $img.attr('src', imgHost + imagePath);\r\n        \r\n        map = initMap({data: {\r\n            isSearchMap: false,\r\n            shopName: shopInfo.shopName,\r\n            tel: shopInfo.tel,\r\n            address: shopInfo.address,\r\n            lng: shopInfo.mapLongitudeValueBaiDu,\r\n            lat: shopInfo.mapLatitudeValueBaiDu\r\n        }});\r\n        \r\n    });\r\n    // click  delegate\r\n    $container.on('click', function(e)\r\n    {\r\n        var $target = $(e.target);\r\n        // \r\n        if($target.is('#uploadImg img, #uploadImg a'))\r\n        {\r\n            U.uploadImg({\r\n                onSuccess: function (imgPath, $dlg)\r\n                {\r\n                    imagePath = imgPath;\r\n                    $img.attr('src', imgHost + imgPath);\r\n                    $dlg.modal('hide');\r\n                }\r\n            });\r\n        }\r\n        // \r\n        if($target.is('#remarkMap'))\r\n        {\r\n            if(bv.isValidField('shopName') && bv.isValidField('tel') && bv.isValidField('address'))\r\n            {\r\n                var coords = map.mapPoint,\r\n                    formData = parseForm($form);\r\n                map = initMap({data: {\r\n                    isSearchMap: false,\r\n                    shopName: formData.shopName,\r\n                    tel: formData.tel,\r\n                    address: formData.address,\r\n                    lng: coords.lng,\r\n                    lat: coords.lat\r\n                }});\r\n                \r\n                var mapInfo = {\r\n                        shopID: shopID,\r\n                        mapLongitudeValue: coords.lng,\r\n                        mapLatitudeValue: coords.lat,\r\n                        mapLongitudeValueBaiDu: coords.lng,\r\n                        mapLatitudeValueBaiDu: coords.lat\r\n                    };\r\n                // callServer\r\n                G.setShopMap(mapInfo, function(rsp)\r\n                {\r\n                    if(rsp.resultcode != '000')\r\n                    {\r\n                        rsp.resultmsg && topTip({msg: rsp.resultmsg, type: 'danger'});\r\n                        return;\r\n                    }\r\n                    \r\n                    topTip({msg: '', type: 'success'});\r\n                    \r\n                });\r\n                \r\n            }\r\n            else\r\n            {\r\n                topTip({msg: '', type: 'danger'});\r\n            }\r\n            \r\n        }\r\n        // \r\n        if($target.is('#editBtn'))\r\n        {\r\n            $form.removeClass('read-mode').addClass('edit-mode');\r\n        }\r\n        // \r\n        if($target.is('#saveBtn'))\r\n        {\r\n            if(!bv.validate().isValid()) return;\r\n            // \r\n            var shopData = parseForm($form);\r\n            shopData.shopID = shopID;\r\n            shopData.shopName = shopData.shopName.replace('', '(').replace('', ')');\r\n            shopData.areaName = getSelectText($area);\r\n            shopData.cuisineName1 = getSelectText($cuisine1);\r\n            shopData.cuisineName2 = shopData.cuisineID2 ? getSelectText($cuisine2) : '';\r\n            shopData.imagePath = imagePath;\r\n            shopData.openingHours = shopData.openingHoursStart + '-' + shopData.openingHoursEnd;\r\n            var keywords = [shopData.shopName, shopData.address, shopData.cuisineName1];\r\n            shopData.cuisineName2 && keywords.push(shopData.cuisineName2);\r\n            keywords.push(shopData.areaName);\r\n            shopData.keywordLst = keywords.join(' | ');\r\n            // callServer\r\n            G.updateShopBaseInfo(shopData, function(rsp)\r\n            {\r\n                if(rsp.resultcode != '000')\r\n                {\r\n                    rsp.resultmsg && topTip({msg: rsp.resultmsg, type: 'danger'});\r\n                    return;\r\n                }\r\n                \r\n                $form.removeClass('edit-mode').addClass('read-mode');\r\n                topTip({msg: '', type: 'success'});\r\n                updateReadMode($form, shopData);\r\n            });\r\n        }\r\n    });\r\n    \r\n}\r\n// \r\nfunction updateReadMode($form, data)\r\n{\r\n    $form.find('input, select').not('.map-keyword, #openingHoursEnd').each(function ()\r\n    {\r\n        var $this = $(this),\r\n            $p = $this.siblings('p');\r\n        if($this.is('#openingHoursStart'))\r\n            $p.text(data.openingHours);\r\n        else if($this.is('select'))\r\n            $p.text(getSelectText($this));\r\n        else\r\n            $p.text($this.val());\r\n    });\r\n}\r\n// \r\nfunction initCuisines($cuisine1, $cuisine2, cityID, cuisineID1, cuisineID2)\r\n{\r\n    var callServer = G.getCuisines;\r\n    callServer({cityID: cityID}, function(rsp)\r\n    {\r\n        if(rsp.resultcode != '000')\r\n        {\r\n            rsp.resultmsg && topTip({msg: rsp.resultmsg, type: 'danger'});\r\n            return;\r\n        }\r\n        \r\n        fillSelectBox($cuisine1, rsp.data.records, 'cuisineID', 'cuisineName');\r\n        fillSelectBox($cuisine2, rsp.data.records, 'cuisineID', 'cuisineName', '----');\r\n        cuisineID1 && $cuisine1.val(cuisineID1);\r\n        cuisineID2 && $cuisine2.val(cuisineID2);\r\n    });\r\n    \r\n}\r\n// \r\nfunction initAreas($area, cityID, areaID)\r\n{\r\n    var callServer = G.getAreas;\r\n    callServer({cityID: cityID}, function(rsp)\r\n    {\r\n        if(rsp.resultcode != '000')\r\n        {\r\n            rsp.resultmsg && topTip({msg: rsp.resultmsg, type: 'danger'});\r\n            return;\r\n        }\r\n        \r\n        fillSelectBox($area, rsp.data.records, 'areaID', 'areaName');\r\n        areaID && $area.val(areaID);\r\n    });\r\n    \r\n}\r\n// \r\nfunction initCities($city, shopInfo)\r\n{\r\n    var callServer = G.getCities;\r\n    callServer({isActive: 1}, function(rsp)\r\n    {\r\n        if(rsp.resultcode != '000')\r\n        {\r\n            rsp.resultmsg && topTip({msg: rsp.resultmsg, type: 'danger'});\r\n            return;\r\n        }\r\n        \r\n        fillSelectBox($city, rsp.data.records, 'cityID', 'cityName');\r\n        $city.val(shopInfo.cityID).trigger('change', [shopInfo.areaID, shopInfo.cuisineID1, shopInfo.cuisineID2]);\r\n    });\r\n    \r\n}\r\n// \r\nfunction fillSelectBox($selectBox, data, key, value, initialValue)\r\n{\r\n    var optionsHtml = '<option value=\"\">' + \r\n                      (initialValue || '----') + \r\n                      '</option>';\r\n    $.each(data, function (i, o)\r\n    {\r\n        optionsHtml += '<option value=\"' + \r\n                       o[key] + '\">' + \r\n                       o[value] + \r\n                       '</option>';\r\n    });\r\n        \r\n    $selectBox.empty().html(optionsHtml);\r\n}\r\n// \r\nfunction getSelectText($select)\r\n{\r\n    return $select.find('option:selected').text().replace(/-/g, '');\r\n}\r\n\r\n})(jQuery, window);\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n;(function ($, window) {\r\nIX.ns('Hualala.Shop');\r\n\r\n// \r\nHualala.Shop.initMenu = function ($container, pageType, params)\r\n{\r\n    if(!params) return;\r\n    \r\n    var G = Hualala.Global,\r\n        U = Hualala.UI,\r\n        topTip = U.TopTip,\r\n        parseForm = Hualala.Common.parseForm;\r\n    \r\n    var shopID = params;\r\n        imgHost = G.IMAGE_RESOURCE_DOMAIN + '/',\r\n        imgRoot = G.IMAGE_ROOT + '/';\r\n\r\n    var classifiedFoods = null,\r\n        foodClass = '',\r\n        foods = null,\r\n        searchParams = null;\r\n    \r\n    var foodTpl = Handlebars.compile(Hualala.TplLib.get('tpl_food'));\r\n    var $menu = $(Hualala.TplLib.get('tpl_shop_menu')),\r\n        $foodClass = null,\r\n        $foodSearch = $menu.find('#foodSearch'),\r\n        $takeawayTag = $foodSearch.find('#takeawayTag'),\r\n        $foodName = $foodSearch.find('#foodName'),\r\n        $chekbox = $foodSearch.find('input[type=checkbox]'),\r\n        $tblHead = $menu.find('.tbl-foods thead'),\r\n        $foodCount = $menu.find('#foodSearchInfo span'),\r\n        $foods = $menu.find('.tbl-foods tbody');\r\n    \r\n    G.getShopMenu({shopID : shopID}, function (rsp)\r\n    {\r\n        if(rsp.resultcode != '000')\r\n        {\r\n            rsp.resultmsg && topTip({msg: rsp.resultmsg, type: 'danger'});\r\n            return;\r\n        }\r\n        \r\n        classifiedFoods = classifyFoods(rsp.data.records);\r\n        renderFoods(); console.log(foods);\r\n        var $foodClassBox = $menu.find('#foodClassBox').append($('<span class=\"current-food-class\"></span>').text(' (' + foods.length + ')'));\r\n        \r\n        for(var id in classifiedFoods)\r\n        {\r\n            var category = classifiedFoods[id]; \r\n            $('<span></span>').data('id', id).text(category.foodCategoryName + ' (' + category.foods.length + ')').appendTo($foodClassBox);\r\n        }\r\n        $foodClass = $foodClassBox.find('span');\r\n        $menu.appendTo($container);\r\n    });\r\n    \r\n    $menu.on('click', function(e)\r\n    {\r\n        var $target = $(e.target);\r\n        if($target.is('#foodClassBox span'))\r\n        {\r\n            $foodClass.removeClass('current-food-class');\r\n            $target.addClass('current-food-class');\r\n            foodClass = $target.data('id');\r\n            $takeawayTag.val('');\r\n            $foodName.val('');\r\n            $chekbox.prop('checked', false);\r\n            searchParams = null;\r\n            renderFoods();\r\n        }\r\n        \r\n        if($target.is('#btnSearchFood'))\r\n        {\r\n            var $checked = $chekbox.filter(':checked'),\r\n                takeawayTag = $.trim($takeawayTag.val()),\r\n                foodName = $.trim($foodName.val());\r\n            if(takeawayTag || foodName || $checked.length)\r\n            {\r\n                searchParams = {};\r\n                if(takeawayTag) searchParams.takeawayTag = takeawayTag;\r\n                if(foodName) searchParams.foodName = foodName;\r\n                $checked.each(function ()\r\n                {\r\n                    if(this.id == 'isHasImage')\r\n                        searchParams.isHasImage = '0';\r\n                    else\r\n                        searchParams[this.id] = '1';\r\n                });\r\n                //console.log(searchParams);\r\n                renderFoods();\r\n            }\r\n        }\r\n    });\r\n    \r\n    function renderFoods()\r\n    {\r\n        foods = filterFoods();\r\n        $foodCount.text(foods.length);\r\n        $foods.html(foodTpl({foods: foods}));\r\n        $foods.find('img').lazyload();\r\n    }\r\n    \r\n    function filterFoods()\r\n    {\r\n        var result = [];\r\n        if(!foodClass)\r\n        {\r\n            for(var foodCategoryID in classifiedFoods)\r\n            {\r\n                result.push.apply(result, classifiedFoods[foodCategoryID].foods);\r\n            }\r\n        }\r\n        else\r\n        {\r\n            result = classifiedFoods[foodClass].foods;\r\n        }\r\n        \r\n        for(p in searchParams)\r\n        {\r\n            result = $.grep(result, function (food)\r\n            {\r\n                return p == 'foodName' ? food[p].indexOf(searchParams[p]) > -1 : food[p] == searchParams[p];\r\n            });\r\n        }\r\n        \r\n        return result;\r\n    }\r\n    //\r\n    function classifyFoods(foodsData)\r\n    {\r\n        var result = {};\r\n        for(i = 0, l = foodsData.length; i < l; i++)\r\n        {\r\n            var food = foodsData[i], cid = food.foodCategoryID;\r\n            //foodCategoryID\r\n            result[cid] = result[cid] || {foods: [], foodCategoryName: food.foodCategoryName};\r\n            //foodID\r\n            if(!food.foodID) continue;\r\n            \r\n            var path = food.imgePath;\r\n            if(path)\r\n            {\r\n                var hwp = food.imageHWP, min = 92,\r\n                    w = hwp > 1 ? min : Math.round(min / hwp),\r\n                    h = hwp > 1 ? Math.round(min * hwp) : min;\r\n                food.imgSrc = imgHost + path.replace(/\\.\\w+$/, '=' + h + 'x' + w + '$&' + '?quality=70');\r\n            }\r\n            else\r\n                food.imgSrc = imgRoot + 'dino80.png';\r\n            \r\n            food.discountIco = food.isDiscount == 1 ? 'ico-ok' : 'ico-no';\r\n            food.takeawayIco = food.takeawayTag > 0 ? 'ico-ok' : 'ico-no';\r\n            food.activeIco = food.foodIsActive == 1 ? 'ico-ok' : 'ico-no';\r\n            food.takeoutPackagingFee = food.takeoutPackagingFee > 0 ? parseFloat(food.takeoutPackagingFee) : '';\r\n            \r\n            if(food.prePrice == -1 || food.prePrice == food.price)\r\n            {\r\n                food.prePrice = food.price;\r\n                food.price = '';\r\n            }\r\n            if(food.vipPrice == -1 || food.vipPrice >= food.prePrice)\r\n            {\r\n                food.vipPrice = '';\r\n            }\r\n            food.price = food.price || '';\r\n            food.prePrice = food.prePrice || '';\r\n            food.vipPrice = food.vipPrice || '';\r\n            \r\n            var cfs = result[cid].foods,\r\n                unit = {\r\n                    unit: food.unit ? food.unit + ':' : '',\r\n                    price: food.price ? '' + parseFloat(food.price) : '',\r\n                    prePrice: food.prePrice ? '' + parseFloat(food.prePrice) : '',\r\n                    vipPrice: food.vipPrice ? '' + parseFloat(food.vipPrice) : ''\r\n                },\r\n                idx = inAarry(cfs, food, 'foodID');\r\n            //if(unit.prePrice == 'NaN') console.log(food);\r\n            if(idx == -1)\r\n            {\r\n                food.units = [unit];\r\n                cfs.push(food);\r\n            }\r\n            else\r\n            {//foodID\r\n                cfs[idx].units.push(unit);\r\n            }\r\n            \r\n        }\r\n        return result;\r\n    }\r\n    //\r\n    function inAarry(arr, obj, key)\r\n    {\r\n        for(var i = 0, l = arr.length; i < l; i++)\r\n        {\r\n            if(arr[i][key] == obj[key]) return i;\r\n        }\r\n        return -1;\r\n    }\r\n    \r\n}\r\n\r\n})(jQuery, window);\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n;\r\n;(function($) \r\n{\r\n\tvar defaults = {\r\n            data : {\r\n                isSearchMap: false,\r\n                keyword: '',\r\n                shopName: '',\r\n                tel: '',\r\n                address: '',\r\n                city: '',\r\n                area: '',\r\n                lng: '',\r\n                lat: ''\r\n            },\r\n            searchBox: '.search-box',\r\n            mapResult: '.map-result',\r\n            //mapContainer: '#shopMap',\r\n            mapCanvasId: 'mapCanvas',\r\n            load: function() { },\r\n            serach: function() { }\r\n        };\r\n\tfunction ShopMap(options)\r\n    {\r\n        this.cfg = $.extend({}, defaults, options);\r\n        //this.$shopMap = $(mapContainer);\r\n        this.sContent = '';\r\n        this.$searchBox = $(this.cfg.searchBox);\r\n        this.$mapResult = $(this.cfg.mapResult);\r\n        this.map = '';\r\n        this.searchArea = true;\r\n        this.mapPoint = {};\r\n        \r\n    }\r\n\tShopMap.prototype = \r\n    {\r\n        init: function()\r\n        {\r\n            var self = this,\r\n                markerTrick = false,\r\n                mapParams = self.cfg.data;\r\n            self.map = new BMap.Map(self.cfg.mapCanvasId);\r\n            //\r\n            self.map.addControl(new BMap.NavigationControl());\r\n            self.map.enableScrollWheelZoom();\r\n            self.sContent = [\r\n                '<dl class=\"map-shop-info\">',\r\n                    '<dt>' + mapParams.shopName + '</dt>',\r\n                    '<dd>',\r\n                        '<p><span></span>' + mapParams.tel + '</p>',\r\n                        '<p><span></span>' + mapParams.address + '</p>',\r\n                    '</dd>',\r\n                '</dl>'\r\n            ].join('');\r\n            \r\n            self[(mapParams.isSearchMap || !mapParams.lng || !mapParams.lat ? 'search' : 'load') + 'Map'](mapParams);\r\n            \r\n            if(self.$searchBox[0])\r\n            {\r\n                var $keyword = self.$searchBox.find('.map-keyword'),\r\n                    $searchBtn = self.$searchBox.find('.map-search-btn'),\r\n                    searchParams = $.extend({}, self.cfg.data);\r\n                $searchBtn.on('click', function ()\r\n                {\r\n                    searchParams.keyword = $.trim($keyword.val());\r\n                    self.searchMap(searchParams);\r\n                });\r\n            }\r\n            \r\n            \r\n            return this;\r\n        },\r\n        loadMap: function(data)\r\n        {\r\n            var self = this;\r\n            data = data || self.self.cfg.data;\r\n            self.map.centerAndZoom(new BMap.Point(data.lng, data.lat), 14);\r\n            self.map.enableScrollWheelZoom();\r\n\r\n            var marker = new BMap.Marker(new BMap.Point(data.lng, data.lat), \r\n                {\r\n                    enableMassClear: true,\r\n                    raiseOnDrag: true\r\n                });\r\n            marker.enableDragging();\r\n            self.map.addOverlay(marker);\r\n            marker.openInfoWindow(new BMap.InfoWindow(self.sContent));\r\n           /* map.addEventListener(\"click\", function(e){\r\n                if(!(e.overlay)){\r\n                    map.clearOverlays();\r\n                    marker.show();\r\n                    map.addOverlay(marker);\r\n                    marker.setPosition(e.point);\r\n                    setResult(e.point.lng, e.point.lat);\r\n                }\r\n            });*/\r\n            marker.addEventListener(\"click\", function(e)\r\n            {\r\n                 marker.openInfoWindow(new BMap.InfoWindow(self.sContent));\r\n            });\r\n            marker.addEventListener(\"dragend\", function(e)\r\n            {\r\n                self.setResult(e.point.lng, e.point.lat);\r\n            });\r\n            self.setResult(data.lng, data.lat);\r\n        },\r\n        searchMap : function (data)\r\n        {\r\n            var self = this;\r\n            data = data || self.cfg.data;\r\n            //self.map.centerAndZoom(new BMap.Point(116.404, 39.915), 14);\r\n            //self.map.enableScrollWheelZoom();\r\n                \r\n            var local = new BMap.LocalSearch(self.map, {\r\n                renderOptions: {map: self.map},\r\n                pageCapacity: 1,\r\n                onInfoHtmlSet : function (poi) {\r\n                    poi.marker.openInfoWindow(new BMap.InfoWindow(self.sContent));\r\n                    //target.openInfoWindow(infoWindow);\r\n                },\r\n                onMarkersSet : function (poi) {\r\n                    //console.info(poi.marker.infoWindow);\r\n                }\r\n            });\r\n            local.search(data.keyword || data.address || data.area || data.city);\r\n\r\n            local.setSearchCompleteCallback(function(results)\r\n            {\r\n                if(local.getStatus() !== BMAP_STATUS_SUCCESS)\r\n                {\r\n                    if(self.searchArea)\r\n                    {\r\n                        local.search(data.area);\r\n                        self.searchArea = false;\r\n                    } else\r\n                    {\r\n                        local.search(data.city);\r\n                    }\r\n                } else \r\n                {\r\n                    //marker.hide();\r\n                }\r\n            });\r\n            local.setMarkersSetCallback(function(pois)\r\n            {\r\n                for(var i = pois.length; i--;)\r\n                {\r\n                    var marker = pois[i].marker;\r\n                    marker.enableDragging();\r\n                    self.setResult(marker.point.lng, marker.point.lat);\r\n                    //var mapParams = {\r\n                    //  width : 250,     // \r\n                    //  height: 100,     // \r\n                    //  title : \"Hello\"  // \r\n                    //}\r\n                    //var infoWindow = new BMap.InfoWindow(\"World\", mapParams);  // \r\n                    //map.openInfoWindow(infoWindow,point); //\r\n                    marker.openInfoWindow(new BMap.InfoWindow(self.sContent));\r\n                    marker.addEventListener(\"click\", function(e)\r\n                    {\r\n                       // markerTrick = true;\r\n                        var pos = this.getPosition();\r\n                        self.setResult(pos.lng, pos.lat);\r\n                    });\r\n                    marker.addEventListener(\"dragend\", function(e)\r\n                    {\r\n                        self.setResult(e.point.lng, e.point.lat);\r\n                    });\r\n                }\r\n            });\r\n            \r\n        },\r\n         /*\r\n         * setResult : \r\n         * \r\n         * lng: \r\n         * lat: \r\n         */\r\n        setResult: function (lng, lat)\r\n        {\r\n            var self = this;\r\n            self.mapPoint = { lng: lng, lat: lat };\r\n            self.$mapResult[0] && self.$mapResult.html('' + lng + '     ' + lat);\r\n        }\r\n\t}\r\n    IX.ns(\"Hualala.Shop\");\r\n    Hualala.Shop.map = function(options) \r\n    { \r\n        return new ShopMap(options).init(); \r\n    };\r\n}(jQuery));\r\n\r\n\r\n\r\n\r\n\r\n\r\n;(function ($, window) {\r\n\t\r\n})(jQuery, window);;(function ($, window) {\r\n\tIX.ns(\"Hualala.Shop\");\r\n    /**\r\n\t  * \r\n\t  * @param {Object | String} shopInfo ID\r\n\t  * @param {jQuery Object} container  \r\n      * @param {function} callback  jQuery\r\n\t  * @return {NULL} \r\n\t  */\r\n    Hualala.Shop.createShopInfoHead = function(shopInfo, container, callback)\r\n    {\r\n        var $container = container || $('#ix_wrapper > .ix-body > .container'),\r\n            $shopInfoHead = $('<div class=\"bs-callout shop-info-head\"></div>');\r\n        !callback && $shopInfoHead.appendTo($container);\r\n        \r\n        var fn = function (shopInfo)\r\n        {\r\n            var tplData = {\r\n                    shopName: shopInfo.shopName,\r\n                    shopUrl: Hualala.Common.getShopUrl(shopInfo.shopID),\r\n                    shopListLink: Hualala.PageRoute.createPath('shop'),\r\n                    checked: shopInfo.status == 1 ? 'checked' : ''\r\n                };\r\n            \r\n            var tpl = Handlebars.compile(Hualala.TplLib.get('tpl_shop_info_head'));\r\n            \r\n            $shopInfoHead.append($(tpl(tplData))).find('input').bootstrapSwitch({\r\n                onColor : 'success',\r\n                onText : '',\r\n                offText : ''\r\n            }).on('switchChange.bootstrapSwitch', function (e, state)\r\n            {//\r\n                var $chkbox = $(this);\r\n                Hualala.Global.switchShopStatus({shopID: shopInfo.shopID, status: state}, function (rsp)\r\n                {\r\n                    if(rsp.resultcode != '000')\r\n                    {\r\n                        $chkbox.bootstrapSwitch('toggleState', true);\r\n                        rsp.resultmsg && Hualala.UI.TopTip({msg: rsp.resultmsg, type: 'danger'});\r\n                        return;\r\n                    }\r\n                });\r\n\t\t\t});;\r\n            //\r\n            $shopInfoHead.find('#resetPwd').on('click', function ()\r\n            {\r\n                var resetPwdTpl = Handlebars.compile(Hualala.TplLib.get('tpl_set_shop_client_pwd'));\r\n                var $resetPwdForm = $(resetPwdTpl(shopInfo));\r\n                //\r\n                var modal = new Hualala.UI.ModalDialog({\r\n                    id: 'resetCltPwdDlg',\r\n                    title: '',\r\n                    html: $resetPwdForm,\r\n                    sizeCls: 'modal-sm',\r\n                    hideCloseBtn: false\r\n                }).show();\r\n                var $feedback = $resetPwdForm.find('.has-feedback'),\r\n                    $feedbackIcon = $feedback.find('.form-control-feedback'),\r\n                    $errMsg = $feedback.find('small');\r\n                var $pwd = $resetPwdForm.find('#shopClinetPwd').data('validate', false).on('blur', function ()\r\n                {//\r\n                    var $this = $(this),\r\n                        l = $.trim($this.val()).length;\r\n                    $this.data('validate', false);\r\n                    if(!l)\r\n                        $errMsg.text('');\r\n                    else if(l < 6 || l > 16)\r\n                        $errMsg.text('616');\r\n                    else\r\n                    {\r\n                        $errMsg.text('');\r\n                        $this.data('validate', true);\r\n                    }\r\n                        \r\n                    var isValid = $this.data('validate');\r\n                    $feedback.toggleClass('has-success', isValid).toggleClass('has-error', !isValid);\r\n                    $feedbackIcon.toggleClass('glyphicon-ok', isValid).toggleClass('glyphicon-remove', !isValid);\r\n                });\r\n                ///\r\n                $resetPwdForm.find('#showPwd').change(function()\r\n                {\r\n                    $pwd.attr('type', this.checked ? 'text' : 'password');\r\n                });\r\n                //\r\n                modal._.footer.find('.btn-ok').on('click', function ()\r\n                {\r\n                    if(!$pwd.trigger('blur').data('validate')) return;\r\n                    \r\n                    Hualala.Global.setShopClientPwd({shopID: shopInfo.shopID, hLLAgentLoginPWD: $pwd.val()}, function (rsp)\r\n                    {\r\n                        if(rsp.resultcode != '000')\r\n                        {\r\n                            rsp.resultmsg && Hualala.UI.TopTip({msg: rsp.resultmsg, type: 'danger'});\r\n                            return;\r\n                        }\r\n                        modal.hide();\r\n                        Hualala.UI.TopTip({msg: '', type: 'success'});\r\n                    });\r\n                    \r\n                });\r\n                \r\n            });\r\n            //\r\n            callback && callback($shopInfoHead);\r\n        };\r\n        //shopInfo\r\n        if($.isPlainObject(shopInfo))\r\n        {\r\n            fn(shopInfo);\r\n            return;\r\n        }\r\n        //shopInfoshopIDajax\r\n        Hualala.Global.getShopInfo({shopID: shopInfo}, function (rsp)\r\n        {\r\n            if(rsp.resultcode != '000')\r\n            {\r\n                rsp.resultmsg && Hualala.UI.TopTip({msg: rsp.resultmsg, type: 'danger'});\r\n                return;\r\n            }\r\n            var shopInfo = rsp.data.records[0];\r\n            fn(shopInfo);\r\n        });\r\n        \r\n    };\r\n    \r\n    // \r\n    Hualala.Shop.createShopFuncNav = function (currentPageName, shopID, container)\r\n    {\r\n        var shopFuncs = ['shopInfo', 'shopMenu'],\r\n            R = Hualala.PageRoute,\r\n            $ul = $('<ul class=\"nav navbar-nav\"></ul>'),\r\n            $container = container || $('#ix_wrapper > .ix-body > .container');\r\n        \r\n        for(i = 0, l = shopFuncs.length; i < l; i++)\r\n        {\r\n            var shopFunc = shopFuncs[i],\r\n                isActive = shopFunc == currentPageName,\r\n                path = isActive ? 'javascript:;' : R.createPath(shopFunc, [shopID]),\r\n                label = R.getPageLabelByName(shopFunc);\r\n            \r\n            $('<li></li>').toggleClass('active', isActive).append($('<a></a>').attr('href', path).text(label)).appendTo($ul);\r\n        }\r\n        \r\n        return $('<div class=\"navbar navbar-default shop-func-nav\"></div>').append($ul).appendTo($container);\r\n    };\r\n    \r\n\tvar initShopList = function (pageType, params) {\r\n        var $body = $('#ix_wrapper > .ix-body > .container');\r\n\t\tvar queryPanel = new Hualala.Shop.QueryController({\r\n\t\t\tneedShopCreate : true,\r\n\t\t\tcontainer : $body,\r\n\t\t\tresultController : new Hualala.Shop.ShopListController({\r\n\t\t\t\tcontainer : $body,\r\n\t\t\t\tmodel : new Hualala.Shop.CardListModel({callServer : Hualala.Global.queryShop}),\r\n\t\t\t\tview : new Hualala.Shop.CardListView()\r\n\t\t\t})\r\n\t\t});\r\n\t\t// TODO \r\n\t};\r\n\tHualala.Shop.HomePageInit = initShopList;\r\n\r\n\tvar initShopBaseInfoMgr = function (pageType, params) {\r\n        var $body = $('#ix_wrapper > .ix-body > .container');\r\n        Hualala.UI.BreadCrumb({\r\n            container: $body,\r\n            hideRoot: true,\r\n            nodes: Hualala.PageRoute.getParentNamesByPath()\r\n        });\r\n\t\tHualala.Shop.initInfo($body, pageType, params);\r\n\t};\r\n\tHualala.Shop.BaseInfoMgrInit = initShopBaseInfoMgr;\r\n\r\n\tvar initFoodMenuMgr = function (pageType, params) {\r\n\t\tvar $body = $('#ix_wrapper > .ix-body > .container');\r\n\t\tHualala.UI.BreadCrumb({\r\n            container: $body,\r\n            hideRoot: true,\r\n            nodes: Hualala.PageRoute.getParentNamesByPath()\r\n        });\r\n        Hualala.Shop.createShopInfoHead(params, $body);\r\n        Hualala.Shop.createShopFuncNav(pageType, params, $body);\r\n        Hualala.Shop.initMenu($body, pageType, params);\r\n\t};\r\n\tHualala.Shop.FoodMenuMgrInit = initFoodMenuMgr;\r\n\r\n\tvar initCreateShop = function (pageType, params) {\r\n\t\tvar $body = $('#ix_wrapper > .ix-body > .container');\r\n        Hualala.UI.BreadCrumb({\r\n            container: $body,\r\n            hideRoot: true,\r\n            nodes: Hualala.PageRoute.getParentNamesByPath()\r\n        });\r\n        var tpl = Handlebars.compile(Hualala.TplLib.get('tpl_shop_create')),\r\n            $shopCreateWizard = $(tpl({\r\n                pcClientPath: Hualala.PageRoute.createPath('pcclient')\r\n            }));\r\n\t\t$body.append($shopCreateWizard);\r\n        Hualala.Shop.initCreate($shopCreateWizard);\r\n\t\t\r\n\t};\r\n\tHualala.Shop.CreateShopInit = initCreateShop;\r\n\r\n\t\r\n})(jQuery, window);;(function ($, window) {\r\n\tIX.ns(\"Hualala.Setting\");\r\n\tvar popoverMsg = Hualala.UI.PopoverMsgTip;\r\n\tvar toptip = Hualala.UI.TopTip;\r\n\tvar ServiceFormElsCfg = {\r\n\t\tadvanceTime : {\r\n\t\t\ttype : 'combo',\r\n\t\t\tlabel : '',\r\n\t\t\tdefaultVal : 0,\r\n\t\t\tprefix : '$',\r\n\t\t\tsurfix : '',\r\n\t\t\toptions : Hualala.TypeDef.MinuteIntervalOptions(),\r\n\t\t\tvalidCfg : {\r\n\t\t\t\tvalidators : {\r\n\t\t\t\t\tnotEmpty : {\r\n\t\t\t\t\t\tmessage : \"\"\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\tnoticeTime : {\r\n\t\t\ttype : 'combo',\r\n\t\t\tlabel : '',\r\n\t\t\tdefaultVal : 0,\r\n\t\t\toptions : Hualala.TypeDef.MinuteIntervalOptions(),\r\n\t\t\tvalidCfg : {\r\n\t\t\t\tvalidators : {\r\n\t\t\t\t\tnotEmpty : {\r\n\t\t\t\t\t\tmessage : \"\"\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\tminAmount : {\r\n\t\t\ttype : 'text',\r\n\t\t\tlabel : '',\r\n\t\t\tprefix : '',\r\n\t\t\tsurfix : '',\r\n\t\t\tdefaultVal : 0,\r\n\t\t\tvalidCfg : {\r\n\t\t\t\tvalidators : {\r\n\t\t\t\t\tnotEmpty : {\r\n\t\t\t\t\t\tmessage : \"\"\r\n\t\t\t\t\t},\r\n\t\t\t\t\tnumeric : {\r\n\t\t\t\t\t\tmessage: \"\"\r\n\t\t\t\t\t},\r\n\t\t\t\t\tgreaterThan : {\r\n\t\t\t\t\t\tinclusive : true,\r\n\t\t\t\t\t\tvalue : 0,\r\n\t\t\t\t\t\tmessage : \"0\"\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\tserviceAmount : {\r\n\t\t\ttype : 'text',\r\n\t\t\tlabel : '',\r\n\t\t\tprefix : '',\r\n\t\t\tsurfix : '',\r\n\t\t\tdefaultVal : 0,\r\n\t\t\tvalidCfg : {\r\n\t\t\t\tvalidators : {\r\n\t\t\t\t\tnumeric : {\r\n\t\t\t\t\t\tmessage: \"\"\r\n\t\t\t\t\t},\r\n\t\t\t\t\tgreaterThan : {\r\n\t\t\t\t\t\tinclusive : true,\r\n\t\t\t\t\t\tvalue : 0,\r\n\t\t\t\t\t\tmessage : \"0\"\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\tfreeServiceAmount : {\r\n\t\t\ttype : 'text',\r\n\t\t\tlabel : '',\r\n\t\t\tprefix : '',\r\n\t\t\tsurfix : '',\r\n\t\t\tdefaultVal : 0,\r\n\t\t\tvalidCfg : {\r\n\t\t\t\tvalidators : {\r\n\t\t\t\t\tnumeric : {\r\n\t\t\t\t\t\tmessage: \"\"\r\n\t\t\t\t\t},\r\n\t\t\t\t\tgreaterThan : {\r\n\t\t\t\t\t\tinclusive : true,\r\n\t\t\t\t\t\tvalue : 0,\r\n\t\t\t\t\t\tmessage : \"0\"\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\tholidayFlag : {\r\n\t\t\ttype : 'combo',\r\n\t\t\tlabel : '',\r\n\t\t\tdefaultVal : 0,\r\n\t\t\toptions : Hualala.TypeDef.HolidayFlagOptions,\r\n\t\t\tvalidCfg : {\r\n\t\t\t\tvalidators : {\r\n\t\t\t\t\tnotEmpty : {\r\n\t\t\t\t\t\tmessage : \"\"\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\topenDays : {\r\n\t\t\ttype : 'text',\r\n\t\t\tlabel : '',\r\n\t\t\tsurfix : '',\r\n\t\t\tdefaultVal : '',\r\n\t\t\tvalidCfg : {\r\n\t\t\t\tvalidators : {\r\n\t\t\t\t\tnotEmpty : {\r\n\t\t\t\t\t\tmessage : \"\"\r\n\t\t\t\t\t},\r\n\t\t\t\t\tdigits : {\r\n\t\t\t\t\t\tmessage: \"\"\r\n\t\t\t\t\t},\r\n\t\t\t\t\tgreaterThan : {\r\n\t\t\t\t\t\tinclusive : true,\r\n\t\t\t\t\t\tvalue : 0,\r\n\t\t\t\t\t\tmessage : \"0\"\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\tservicePeriods : {\r\n\t\t\ttype : 'section',\r\n\t\t\tlabel : '',\r\n\t\t\tmin : {\r\n\t\t\t\ttype : 'timepicker',\r\n\t\t\t\tsurfix : '<span class=\"glyphicon glyphicon-time\"></span>',\r\n\t\t\t\tdefaultVal : '',\r\n\t\t\t\tvalidCfg : {\r\n\t\t\t\t\tgroup : '.min-input',\r\n\t\t\t\t\tvalidators : {\r\n\t\t\t\t\t\tnotEmpty : {\r\n\t\t\t\t\t\t\tmessage : \"\"\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tmax : {\r\n\t\t\t\ttype : 'timepicker',\r\n\t\t\t\tsurfix : '<span class=\"glyphicon glyphicon-time\"></span>',\r\n\t\t\t\tdefaultVal : '',\r\n\t\t\t\tvalidCfg : {\r\n\t\t\t\t\tgroup : '.max-input',\r\n\t\t\t\t\tvalidators : {\r\n\t\t\t\t\t\tnotEmpty : {\r\n\t\t\t\t\t\t\tmessage : \"\"\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\treserveTableTime : {\r\n\t\t\ttype : 'combo',\r\n\t\t\tlabel : '',\r\n\t\t\tdefaultVal : 0,\r\n\t\t\toptions : Hualala.TypeDef.MinuteIntervalOptions(60),\r\n\t\t\tvalidCfg : {\r\n\t\t\t\tvalidators : {\r\n\t\t\t\t\tnotEmpty : {\r\n\t\t\t\t\t\tmessage : \"\"\r\n\t\t\t\t\t},\r\n\t\t\t\t\tnumeric : {\r\n\t\t\t\t\t\tmessage: \"\"\r\n\t\t\t\t\t},\r\n\t\t\t\t\tgreaterThan : {\r\n\t\t\t\t\t\tinclusive : true,\r\n\t\t\t\t\t\tvalue : 0,\r\n\t\t\t\t\t\tmessage : \"0\"\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\treserveTableDesc : {\r\n\t\t\ttype : 'text',\r\n\t\t\tlabel : '',\r\n\t\t\tdefaultVal : '',\r\n\t\t\tvalidCfg : {\r\n\t\t\t\tvalidators : {\r\n\t\t\t\t\tstringLength : {\r\n\t\t\t\t\t\tmax : 40,\r\n\t\t\t\t\t\tmessage : '40'\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\ttakeawayDeliveryAgent : {\r\n\t\t\ttype : 'text',\r\n\t\t\tlabel : '',\r\n\t\t\tdefaultVal : '',\r\n\t\t\tvalidCfg : {}\r\n\t\t},\r\n\t\ttakeawayDeliveryTime : {\r\n\t\t\ttype : 'text',\r\n\t\t\tlabel : '',\r\n\t\t\tsurfix : '',\r\n\t\t\tdefaultVal : '',\r\n\t\t\tvalidCfg : {\r\n\t\t\t\tvalidators : {\r\n\t\t\t\t\tnotEmpty : {\r\n\t\t\t\t\t\tmessage : \"\"\r\n\t\t\t\t\t},\r\n\t\t\t\t\tnumeric : {\r\n\t\t\t\t\t\tmessage: \"\"\r\n\t\t\t\t\t},\r\n\t\t\t\t\tgreaterThan : {\r\n\t\t\t\t\t\tinclusive : true,\r\n\t\t\t\t\t\tvalue : 0,\r\n\t\t\t\t\t\tmessage : \"0\"\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\ttakeawayScope : {\r\n\t\t\ttype : 'text',\r\n\t\t\tlabel : '',\r\n\t\t\tsurfix : '',\r\n\t\t\tdefaultVal : '',\r\n\t\t\tvalidCfg : {\r\n\t\t\t\tvalidators : {\r\n\t\t\t\t\tnotEmpty : {\r\n\t\t\t\t\t\tmessage : \"\"\r\n\t\t\t\t\t},\r\n\t\t\t\t\tnumeric : {\r\n\t\t\t\t\t\tmessage: \"\"\r\n\t\t\t\t\t},\r\n\t\t\t\t\tgreaterThan : {\r\n\t\t\t\t\t\tinclusive : true,\r\n\t\t\t\t\t\tvalue : 0,\r\n\t\t\t\t\t\tmessage : \"0\"\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\ttakeawayScopeDesc : {\r\n\t\t\ttype : 'text',\r\n\t\t\tlabel : '',\r\n\t\t\tdefaultVal : '',\r\n\t\t\tvalidCfg : {\r\n\t\t\t\tvalidators : {\r\n\t\t\t\t\tstringLength : {\r\n\t\t\t\t\t\tmax : 200,\r\n\t\t\t\t\t\tmessage : '200'\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\tsubmitSMSTemplateID : {\r\n\t\t\ttype : 'hidden',\r\n\t\t\tdefaultVal : ''\r\n\t\t},\r\n\t\tcheckSMSTemplateID : {\r\n\t\t\ttype : 'hidden',\r\n\t\t\tdefaultVal : ''\r\n\t\t},\r\n\t\tpayMethod : {\r\n\t\t\ttype : 'combo',\r\n\t\t\tlabel : '',\r\n\t\t\tdefaultVal : 0,\r\n\t\t\toptions : Hualala.TypeDef.PayMethodOptions,\r\n\t\t\tvalidCfg : {\r\n\t\t\t\tvalidators : {\r\n\t\t\t\t\tnotEmpty : {\r\n\t\t\t\t\t\tmessage : \"\"\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\tneedInputTableName : {\r\n\t\t\ttype : 'switcher',\r\n\t\t\tlabel : '',\r\n\t\t\tdefaultVal : 1,\r\n\t\t\tonLabel : '',\r\n\t\t\toffLabel : '',\r\n\t\t\tvalidCfg : {\r\n\t\t\t\tvalidators : {\r\n\t\t\t\t\t\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\tsupportInvoice : {\r\n\t\t\ttype : 'switcher',\r\n\t\t\tlabel : '',\r\n\t\t\tdefaultVal : 1,\r\n\t\t\tonLabel : '',\r\n\t\t\toffLabel : '',\r\n\t\t\tvalidCfg : {\r\n\t\t\t\tvalidators : {\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t\r\n\t\t},\r\n\t\tsupportCommitToSoftware : {\r\n\t\t\ttype : 'switcher',\r\n\t\t\tlabel : '',\r\n\t\t\tdefaultVal : 1,\r\n\t\t\tonLabel : '',\r\n\t\t\toffLabel : '',\r\n\t\t\tvalidCfg : {\r\n\t\t\t\tvalidators : {\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\tpayMethodAtShop : {\r\n\t\t\ttype : 'combo',\r\n\t\t\tlabel : '',\r\n\t\t\tdefaultVal : 0,\r\n\t\t\toptions : Hualala.TypeDef.PayMethodAtShopOptions,\r\n\t\t\tvalidCfg : {\r\n\t\t\t\tvalidators : {\r\n\t\t\t\t\tnotEmpty : {\r\n\t\t\t\t\t\tmessage : \"\"\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\tpayBeforeCommit : {\r\n\t\t\ttype : 'switcher',\r\n\t\t\tlabel : '',\r\n\t\t\tdefaultVal : 1,\r\n\t\t\tonLabel : '',\r\n\t\t\toffLabel : '',\r\n\t\t\tvalidCfg : {\r\n\t\t\t\tvalidators : {\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t\r\n\t\t},\r\n\t\tfetchFoodMode : {\r\n\t\t\ttype : 'combo',\r\n\t\t\tlabel : '',\r\n\t\t\tdefaultVal : 0,\r\n\t\t\toptions : Hualala.TypeDef.FetchFoodModeOptions,\r\n\t\t\tvalidCfg : {\r\n\t\t\t\tvalidators : {\r\n\t\t\t\t\tnotEmpty : {\r\n\t\t\t\t\t\tmessage : \"\"\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n\tvar ServiceFormElsHT = new IX.IListManager();\r\n\t_.each(ServiceFormElsCfg, function (el, k) {\r\n\t\tvar type = $XP(el, 'type');\r\n\t\tvar labelClz = 'col-sm-offset-1 col-sm-3 control-label';\r\n\t\tif (type == 'section') {\r\n\t\t\tvar id = minID = k + '_min_' + IX.id(), maxID = k + '_max_' + IX.id(),\r\n\t\t\t\tminName = k + '_min', maxName = k + '_max',\r\n\t\t\t\tmin = IX.inherit($XP(el, 'min', {}), {\r\n\t\t\t\t\tid : minID, name : minName, clz : 'col-sm-3',\r\n\t\t\t\t}), max = IX.inherit($XP(el, 'max', {}), {\r\n\t\t\t\t\tid : maxID, name : maxName, clz : 'col-sm-3',\r\n\t\t\t\t});\r\n\t\t\tServiceFormElsHT.register(k, IX.inherit(el, {\r\n\t\t\t\tid : id,\r\n\t\t\t\tlabelClz : labelClz,\r\n\t\t\t\tmin : min,\r\n\t\t\t\tmax : max\r\n\t\t\t}));\r\n\t\t} else {\r\n\t\t\tServiceFormElsHT.register(k, IX.inherit(el, {\r\n\t\t\t\tid : k + '_' + IX.id(),\r\n\t\t\t\tname : k,\r\n\t\t\t\tlabelClz : labelClz,\r\n\t\t\t\tclz : 'col-sm-5'\r\n\t\t\t}));\r\n\t\t}\r\n\t});\r\n\t\r\n\tvar editServiceView = Stapes.subclass({\r\n\t\t/**\r\n\t\t * \r\n\t\t * @param  {Object} cfg {triggerEl, serviceID, serviceName, model}\r\n\t\t *              @param {jQueryObj} triggerEl  \r\n\t\t *              @param {String} serviceID ID\r\n\t\t *              @param {String} serviceName \r\n\t\t *              @param {Object} model \r\n\t\t * @return {NULL}    \r\n\t\t */\r\n\t\tconstructor : function (cfg) {\r\n\t\t\tthis.$trigger = $XP(cfg, 'triggerEl');\r\n\t\t\tthis.serviceID = $XP(cfg, 'serviceID', null);\r\n\t\t\tthis.serviceName = $XP(cfg, 'serviceName', null);\r\n\t\t\tthis.model = $XP(cfg, 'model', null);\r\n\t\t\tthis.serviceList = Hualala.TypeDef.ShopBusiness;\r\n\t\t\tthis.modal = null;\r\n\t\t\tif (!this.serviceID || !this.serviceName || !this.model) {\r\n\t\t\t\tthrow(\"Service View init failed!\");\r\n\t\t\t}\r\n\t\t\tthis.loadTemplates();\r\n\t\t\tthis.serviceInfo = this.getServiceInfo('id', this.serviceID);\r\n\t\t\tthis.callServer = $XP(this.serviceInfo, 'callServer', '');\r\n\t\t\tif (IX.isFn(this.callServer)) {\r\n\t\t\t\tthis.callServer = this.callServer;\r\n\t\t\t} else if (!IX.isString(this.callServer)) {\r\n\t\t\t\tthrow(\"Configuration failed : Invalid Page Initialized for \" + this.callServer);\r\n\t\t\t\treturn false;\r\n\t\t\t} else if (IX.nsExisted(this.callServer)) {\r\n\t\t\t\tthis.callServer = IX.getNS(this.callServer);\r\n\t\t\t}\r\n\t\t\tthis.formParams = $XP(this.model.get('revParamJson'), this.serviceID);\r\n\t\t\tthis.initModal();\r\n\t\t\tthis.renderForm();\r\n\t\t\tthis.bindEvent();\r\n\t\t\tthis.emit('show');\r\n\t\t}\r\n\t});\r\n\teditServiceView.proto({\r\n\t\tloadTemplates : function () {\r\n\t\t\tvar layoutTpl = Handlebars.compile(Hualala.TplLib.get('tpl_shop_service_form_layout')),\r\n\t\t\t\tbtnTpl = Handlebars.compile(Hualala.TplLib.get('tpl_shop_modal_btns'));\r\n\t\t\tHandlebars.registerHelper('checkFormElementType', function (conditional, options) {\r\n\t\t\t\treturn (conditional == options.hash.type) ? options.fn(this) : options.inverse(this);\r\n\t\t\t});\r\n\t\t\tHandlebars.registerHelper('isInputGroup', function (prefix, surfix, options) {\r\n\t\t\t\treturn (!prefix && !surfix) ? options.inverse(this) : options.fn(this);\r\n\t\t\t});\r\n\t\t\tthis.set({\r\n\t\t\t\tlayoutTpl : layoutTpl,\r\n\t\t\t\tbtnTpl : btnTpl\r\n\t\t\t});\r\n\t\t},\t\r\n\t\tinitModal : function () {\r\n\t\t\tvar self = this;\r\n\t\t\tself.modal = new Hualala.UI.ModalDialog({\r\n\t\t\t\tid : 'service_edit',\r\n\t\t\t\tclz : 'service-modal',\r\n\t\t\t\ttitle : self.getModalTitle(),\r\n\t\t\t\tafterRemove : function () {\r\n\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t},\r\n\t\tinitSwitcher : function (selector) {\r\n\t\t\tvar self = this;\r\n\t\t\tself.modal._.body.find(selector).each(function () {\r\n\t\t\t\tvar $el = $(this),\r\n\t\t\t\t\tonLabel = $el.attr('data-onLabel'),\r\n\t\t\t\t\toffLabel = $el.attr('data-offLabel');\r\n\t\t\t\t$el.bootstrapSwitch({\r\n\t\t\t\t\tsize : 'normal',\r\n\t\t\t\t\tonColor : 'primary',\r\n\t\t\t\t\toffColor : 'default',\r\n\t\t\t\t\tonText : onLabel,\r\n\t\t\t\t\toffText : offLabel\r\n\t\t\t\t});\r\n\t\t\t});\r\n\t\t},\r\n\t\tinitTimePicker : function (selector) {\r\n\t\t\tvar self = this;\r\n\t\t\tself.modal._.body.find(selector).timepicker({\r\n\t\t\t\tminuteStep : 30,\r\n\t\t\t\tshowSeconds : false,\r\n\t\t\t\tshowMeridian :  false,\r\n\t\t\t\tdisableFocus : true,\r\n\t\t\t\tshowInputs : false\r\n\t\t\t});\r\n\t\t},\r\n\t\tgetServiceInfo : function (key, val) {\r\n\t\t\tvar self = this;\r\n\t\t\tvar operationMode = self.model.get('operationMode');\r\n\t\t\tvar servData = IX.inherit({}, _.find(this.serviceList, function (v) {return v[key] == val}));\r\n\t\t\tif (!IX.isEmpty($XP(servData, 'operationMode'))) {\r\n\t\t\t\tservData = IX.inherit(servData, {\r\n\t\t\t\t\tformKeys : $XP(servData, 'operationMode.' + operationMode)\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t\treturn servData;\r\n\t\t},\r\n\t\tgetModalTitle : function () {\r\n\t\t\treturn $XP(this.serviceInfo, 'label') + '';\r\n\t\t},\r\n\t\tbindEvent : function () {\r\n\t\t\tvar self = this;\r\n\t\t\tvar fvOpts = self.initValidFieldOpts();\r\n\t\t\tthis.on({\r\n\t\t\t\tshow : function () {\r\n\t\t\t\t\tthis.modal.show();\r\n\t\t\t\t},\r\n\t\t\t\thide : function () {\r\n\t\t\t\t\tthis.modal.hide();\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\tself.modal._.dialog.find('.btn').on('click', function (e) {\r\n\t\t\t\tvar $btn = $(this),\r\n\t\t\t\t\tact = $btn.attr('name');\r\n\t\t\t\tif (act == 'cancel') {\r\n\t\t\t\t\tself.emit('hide');\r\n\t\t\t\t} else {\r\n\t\t\t\t\tvar bv = self.modal._.body.find('form').data('bootstrapValidator');\r\n\t\t\t\t\t$btn.button('...');\r\n\t\t\t\t\tbv.validate();\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\tself.modal._.body.find('form').bootstrapValidator({\r\n\t\t\t\ttrigger : 'blur',\r\n\t\t\t\tfields : fvOpts\r\n\t\t\t}).on('error.field.bv', function (e, data) {\r\n\t\t\t\tvar $form = $(e.target),\r\n\t\t\t\t\tbv = $form.data('bootstrapValidator');\r\n\t\t\t}).on('success.form.bv', function (e, data) {\r\n\t\t\t\te.preventDefault();\r\n\t\t\t\tvar $form = $(e.target),\r\n\t\t\t\t\tbv = $form.data('bootstrapValidator');\r\n\t\t\t\tvar formParams = self.serializeForm();\r\n\t\t\t\tconsole.info(formParams);\r\n\t\t\t\tself.model.emit('setServiceParams', {\r\n\t\t\t\t\tcallServer : self.callServer,\r\n\t\t\t\t\tparams : formParams,\r\n\t\t\t\t\tserviceID : self.serviceID,\r\n\t\t\t\t\tfailFn : function () {\r\n\t\t\t\t\t\tself.modal._.footer.find('.btn[name=submit]').button('reset');\r\n\t\t\t\t\t},\r\n\t\t\t\t\tsuccessFn : function () {\r\n\t\t\t\t\t\tself.modal._.footer.find('.btn[name=submit]').button('reset');\r\n\t\t\t\t\t\tself.emit('hide');\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t});;\r\n\t\t},\r\n\t\tdecodeTimeStr : function (t) {\r\n\t\t\tif (t.length == 0) return '';\r\n\t\t\treturn t.substr(0,2) + ':' + t.substr(2);\r\n\t\t},\r\n\t\tencodeTimeStr : function (min, max) {\r\n\t\t\treturn (min + ',' + max).replace(/\\:/g, '');\r\n\t\t},\r\n\t\t// \r\n\t\tmapServiceFormElsData : function () {\r\n\t\t\tvar self = this,\r\n\t\t\t\tformKeys = $XP(self.serviceInfo, 'formKeys', '').split(','),\r\n\t\t\t\tformEls = _.map(formKeys, function (key) {\r\n\t\t\t\t\tvar elCfg = ServiceFormElsHT.get(key),\r\n\t\t\t\t\t\ttype = $XP(elCfg, 'type');\r\n\t\t\t\t\tif (type == 'section' && key == 'servicePeriods') {\r\n\t\t\t\t\t\tvar v = $XP(self.formParams, key, '').split(',');\r\n\t\t\t\t\t\tv = _.map(v, function (t) {\r\n\t\t\t\t\t\t\treturn self.decodeTimeStr(t);\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t\treturn IX.inherit(elCfg, {\r\n\t\t\t\t\t\t\tmin : IX.inherit($XP(elCfg, 'min'), {\r\n\t\t\t\t\t\t\t\tvalue : v[0] || $XP(elCfg, 'min.defaultVal')\r\n\t\t\t\t\t\t\t}),\r\n\t\t\t\t\t\t\tmax : IX.inherit($XP(elCfg, 'max'), {\r\n\t\t\t\t\t\t\t\tvalue : v[1] || $XP(elCfg, 'max.defaultVal')\r\n\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t} else if (type == 'combo') {\r\n\t\t\t\t\t\tvar v = $XP(self.formParams, key, $XP(elCfg, 'defaultVal')),\r\n\t\t\t\t\t\t\toptions = _.map($XP(elCfg, 'options'), function (op) {\r\n\t\t\t\t\t\t\t\treturn IX.inherit(op, {\r\n\t\t\t\t\t\t\t\t\tselected : $XP(op, 'value') == v ? 'selected' : ''\r\n\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\treturn IX.inherit(elCfg, {\r\n\t\t\t\t\t\t\tvalue : $XP(self.formParams, key, $XP(elCfg, 'defaultVal')),\r\n\t\t\t\t\t\t\toptions : options\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t} else if (type == 'switcher') {\r\n\t\t\t\t\t\treturn IX.inherit(elCfg, {\r\n\t\t\t\t\t\t\tchecked : $XP(self.formParams, key) == $XP(elCfg, 'defaultVal') ? 'checked' : ''\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\treturn IX.inherit(elCfg, {\r\n\t\t\t\t\t\t\tvalue : $XP(self.formParams, key, $XP(elCfg, 'defaultVal'))\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\tconsole.info(formEls);\r\n\t\t\treturn formEls;\r\n\t\t},\r\n\t\t// \r\n\t\trenderForm : function () {\r\n\t\t\tvar self = this,\r\n\t\t\t\tfvOpts = self.initValidFieldOpts(),\r\n\t\t\t\trenderData = self.mapServiceFormElsData(),\r\n\t\t\t\ttpl = self.get('layoutTpl'),\r\n\t\t\t\tbtnTpl = self.get('btnTpl'),\r\n\t\t\t\thtm = tpl({\r\n\t\t\t\t\tformClz : 'shop-service-form',\r\n\t\t\t\t\titems : renderData\r\n\t\t\t\t});\r\n\t\t\tself.modal._.body.html(htm);\r\n\t\t\tself.modal._.footer.html(btnTpl({\r\n\t\t\t\tbtns : [\r\n\t\t\t\t\t{clz : 'btn-default', name : 'cancel', label : ''},\r\n\t\t\t\t\t{clz : 'btn-warning', name : 'submit', label : ''}\r\n\t\t\t\t]\r\n\t\t\t}));\r\n\r\n\t\t\tself.initSwitcher(':checkbox[data-type=switcher]');\r\n\t\t\tself.initTimePicker('[data-type=timepicker]');\r\n\r\n\t\t},\r\n\t\t// \r\n\t\tserializeForm : function () {\r\n\t\t\tvar self = this,\r\n\t\t\t\tformKeys = $XP(self.serviceInfo, 'formKeys', '').split(','),\r\n\t\t\t\tret = {},\r\n\t\t\t\tformEls = _.map(formKeys, function (key) {\r\n\t\t\t\t\tvar elCfg = ServiceFormElsHT.get(key),\r\n\t\t\t\t\t\ttype = $XP(elCfg, 'type');\r\n\t\t\t\t\tif (type == 'section' && key == 'servicePeriods') {\r\n\t\t\t\t\t\tvar min = $('[name=' + key + '_min]').val(),\r\n\t\t\t\t\t\t\tmax = $('[name=' + key + '_max]').val();\r\n\t\t\t\t\t\tret[key] = self.encodeTimeStr(min, max);\r\n\t\t\t\t\t} else if (type == 'switcher') {\r\n\t\t\t\t\t\t// ret[key] = $('[name=' + key + ']').attr('checked') ? 1 : 0;\r\n\t\t\t\t\t\tret[key] = !$('[name=' + key + ']').data('bootstrapSwitch').options.state ? 0 : 1;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tret[key] = $('[name=' + key + ']').val();\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\treturn ret;\r\n\t\t},\r\n\t\t// \r\n\t\tinitValidFieldOpts : function () {\r\n\t\t\tvar self = this,\r\n\t\t\t\tformKeys = $XP(self.serviceInfo, 'formKeys', '').split(','),\r\n\t\t\t\tret = {};\r\n\t\t\t_.each(formKeys, function (key) {\r\n\t\t\t\tvar elCfg = ServiceFormElsHT.get(key),\r\n\t\t\t\t\ttype = $XP(elCfg, 'type');\r\n\t\t\t\tif (type == 'section') {\r\n\t\t\t\t\tvar min = key + '_min', max = key + '_max';\r\n\t\t\t\t\tret[min] = $XP(elCfg, 'min.validCfg', {});\r\n\t\t\t\t\tret[max] = $XP(elCfg, 'max.validCfg', {});\r\n\t\t\t\t} else {\r\n\t\t\t\t\tret[key] = $XP(elCfg, 'validCfg', {});\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\treturn ret;\r\n\t\t}\r\n\t});\r\n\tHualala.Setting.editServiceView = editServiceView;\r\n})(jQuery, window);;(function ($, window) {\r\n\tIX.ns(\"Hualala.Setting\");\r\n\tvar initShopMgr = function (pageType, params) {\r\n\t\tvar $body = $('#ix_wrapper > .ix-body > .container');\r\n\t\tvar queryPanel = new Hualala.Shop.QueryController({\r\n\t\t\tneedShopCreate : false,\r\n\t\t\tcontainer : $body,\r\n\t\t\tresultController : new Hualala.Shop.ShopListController({\r\n\t\t\t\tcontainer : $body,\r\n\t\t\t\tmodel : new Hualala.Shop.CardListModel({callServer : Hualala.Global.queryShop}),\r\n\t\t\t\tview : new Hualala.Shop.ShopListView()\r\n\t\t\t})\r\n\t\t});\r\n\t};\r\n\tHualala.Setting.ShopMgrInit = initShopMgr;\r\n})(jQuery, window);;(function ($, window) {\r\n\tIX.ns(\"Hualala.Account\");\r\n\tvar popoverMsg = Hualala.UI.PopoverMsgTip;\r\n\tvar toptip = Hualala.UI.TopTip;\r\n\tvar CardListModel = Hualala.Shop.CardListModel;\r\n\tvar AccountListModel = CardListModel.subclass({\r\n\t\tconstructor : CardListModel.prototype.constructor\r\n\t});\r\n\tAccountListModel.proto({\r\n\t\tinit : function (params) {\r\n\t\t\tthis.set({\r\n\t\t\t\tpageCount : 0,\r\n\t\t\t\ttotalSize : 0,\r\n\t\t\t\tpageNo : $XP(params, 'pageNo', 1),\r\n\t\t\t\tpageSize : $XP(params, 'pageSize', 15),\r\n\t\t\t\ttransCreateBeginTime : $XP(params, 'transCreateBeginTime', ''),\r\n\t\t\t\ttransCreateEndTime : $XP(params, 'transCreateEndTime', ''),\r\n\t\t\t\tsettleUnitID : $XP(params, 'settleUnitID', ''),\r\n\t\t\t\ttransStatus : $XP(params, 'transStatus', ''),\r\n\t\t\t\ttransType : $XP(params, 'transType', ''),\r\n\t\t\t\tgroupID : $XP(params, 'groupID', ''),\r\n\t\t\t\tminTransAmount : $XP(params, 'minTransAmount', ''),\r\n\t\t\t\tmaxTransAmount : $XP(params, 'maxTransAmount', ''),\r\n\t\t\t\tds_account : new IX.IListManager(),\r\n\t\t\t\tds_page : new IX.IListManager()\r\n\t\t\t});\r\n\t\t},\r\n\t\tupdatePagerParams : function (params) {\r\n\t\t\tvar self = this;\r\n\t\t\tvar pagerParamkeys = 'pageCount,totalSize,pageNo,pageSize,transCreateBeginTime,transCreateEndTime,settleUnitID,transStatus,transType,groupID,minTransAmount,maxTransAmount';\r\n\t\t\t_.each(params, function (v, k, l) {\r\n\t\t\t\tif (pagerParamkeys.indexOf(k) > -1) {\r\n\t\t\t\t\tself.set(k, v);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t},\r\n\t\tgetPagerParams : function () {\r\n\t\t\t// return {\r\n\t\t\t// \tPage : {\r\n\t\t\t// \t\tpageNo : this.get('pageNo'),\r\n\t\t\t// \t\tpageSize : this.get('pageSize')\r\n\t\t\t// \t},\r\n\t\t\t// \tsettleUnitID : this.get('settleUnitID'),\r\n\t\t\t// \ttransCreateBeginTime : this.get('transCreateBeginTime'),\r\n\t\t\t// \ttransCreateEndTime : this.get('transCreateEndTime'),\r\n\t\t\t// \ttransStatus : this.get('transStatus'),\r\n\t\t\t// \ttransType : this.get('transType'),\r\n\t\t\t// \tgroupID : this.get('groupID'),\r\n\t\t\t// \tminTransAmount : this.get('minTransAmount'),\r\n\t\t\t// \tmaxTransAmount : this.get('maxTransAmount')\r\n\t\t\t// };\r\n\t\t\treturn {\r\n\t\t\t\tpageNo : this.get('pageNo'),\r\n\t\t\t\tpageSize : this.get('pageSize'),\r\n\t\t\t\tsettleUnitID : this.get('settleUnitID'),\r\n\t\t\t\ttransCreateBeginTime : this.get('transCreateBeginTime'),\r\n\t\t\t\ttransCreateEndTime : this.get('transCreateEndTime'),\r\n\t\t\t\ttransStatus : this.get('transStatus'),\r\n\t\t\t\ttransType : this.get('transType'),\r\n\t\t\t\tgroupID : this.get('groupID'),\r\n\t\t\t\tminTransAmount : this.get('minTransAmount'),\r\n\t\t\t\tmaxTransAmount : this.get('maxTransAmount')\r\n\t\t\t};\r\n\t\t},\r\n\t\tupdateDataStore : function (data, pageNo) {\r\n\t\t\tvar self = this,\r\n\t\t\t\taccountHT = self.get('ds_account'),\r\n\t\t\t\tpageHT = self.get('ds_page');\r\n\t\t\tvar accountIDs = _.map(data, function (account, i, l) {\r\n\t\t\t\tvar settleUnitID = $XP(account, 'settleUnitID'),\r\n\t\t\t\t\tmAccount = new BaseAccountModel(account);\r\n\t\t\t\taccountHT.register(settleUnitID, mAccount);\r\n\t\t\t\treturn settleUnitID;\r\n\t\t\t});\r\n\t\t\tpageHT.register(pageNo, accountIDs);\r\n\t\t},\r\n\t\tresetDataStore : function () {\r\n\t\t\tvar self = this,\r\n\t\t\t\taccountHT = self.get('ds_account'),\r\n\t\t\t\tpageHT = self.get('ds_page');\r\n\t\t\taccountHT.clear();\r\n\t\t\tpageHT.clear();\r\n\t\t},\r\n\t\tload : function (params, cbFn) {\r\n\t\t\tvar self = this;\r\n\t\t\tself.updatePagerParams(params);\r\n\t\t\tself.callServer(self.getPagerParams(), function (res) {\r\n\t\t\t\tif (res.resultcode == '000') {\r\n\t\t\t\t\tself.updateDataStore($XP(res, 'data.records', []), $XP(res, 'data.page.pageNo'));\r\n\t\t\t\t\tself.updatePagerParams(IX.inherit($XP(res, 'data', {}), $XP(res, 'data.page', {})));\r\n\t\t\t\t} else {\r\n\t\t\t\t\ttoptip({\r\n\t\t\t\t\t\tmsg : $XP(res, 'resultmsg', ''),\r\n\t\t\t\t\t\ttype : 'danger'\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t\tcbFn(self);\r\n\t\t\t});\r\n\t\t},\r\n\t\tgetAccounts : function (pageNo) {\r\n\t\t\tvar self = this,\r\n\t\t\t\taccountHT = self.get('ds_account'),\r\n\t\t\t\tpageHT = self.get('ds_page');\r\n\t\t\tvar ret = _.map(accountHT.getByKeys(pageHT.get(pageNo)), function (mAccount) {\r\n\t\t\t\treturn mAccount.getAll();\r\n\t\t\t});\r\n\t\t\tconsole.info(\"pageData :\");\r\n\t\t\tconsole.info(ret);\r\n\t\t\treturn ret;\r\n\t\t},\r\n\t\tgetAccountModelByID : function (accountID) {\r\n\t\t\tvar self = this,\t\r\n\t\t\t\taccountHT = self.get('ds_account');\r\n\t\t\treturn accountHT.get(accountID);\r\n\t\t}\r\n\t});\r\n\r\n\r\n\tHualala.Account.AccountListModel = AccountListModel;\r\n\r\n\tvar BaseAccountModel = Stapes.subclass({\r\n\t\tconstructor : function (account) {\r\n\t\t\t!IX.isEmpty(account) && this.set(account);\r\n\t\t\tthis.bindEvent();\r\n\t\t}\r\n\t});\r\n\tBaseAccountModel.proto({\r\n\t\tbindEvent : function () {\r\n\t\t\tvar self = this;\r\n\t\t\tself.on({\r\n\t\t\t\t\"load\" : function (params) {\r\n\t\t\t\t\tvar settleUnitID = $XP(params, 'settleUnitID'),\r\n\t\t\t\t\t\tcbFn = $XF(params, 'cbFn');\r\n\t\t\t\t\tvar callServer = Hualala.Global.queryAccount,\r\n\t\t\t\t\t\tgroupID = $XP(Hualala.getSessionSite(), 'groupID', '');\r\n\t\t\t\t\tcallServer({\r\n\t\t\t\t\t\tsettleUnitID : settleUnitID,\r\n\t\t\t\t\t\tgroupID : groupID\r\n\t\t\t\t\t}, function (res) {\r\n\t\t\t\t\t\tvar records = $XP(res, \"data.records\", []);\r\n\t\t\t\t\t\tif (records.length == 0) {\r\n\t\t\t\t\t\t\tthrow(\"get Account Data (\" + settleUnitID + \") Failed!\");\r\n\t\t\t\t\t\t\treturn ;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tself.set(records[0]);\r\n\t\t\t\t\t\tcbFn();\r\n\t\t\t\t\t});\r\n\t\t\t\t},\r\n\t\t\t\t// \r\n\t\t\t\t\"withdrawCash\" : function (cfg) {\r\n\t\t\t\t\tvar callServer = Hualala.Global.withdrawCash,\r\n\t\t\t\t\t\tparams = $XP(cfg, 'params', {}),\r\n\t\t\t\t\t\tsettleUnitID = self.get('settleUnitID'),\r\n\t\t\t\t\t\tfailFn = $XF(cfg, 'failFn'),\r\n\t\t\t\t\t\tsuccessFn = $XF(cfg, 'successFn');\r\n\t\t\t\t\tcallServer(IX.inherit(params, {\r\n\t\t\t\t\t\tsettleUnitID : settleUnitID\r\n\t\t\t\t\t}), function (res) {\r\n\t\t\t\t\t\tif (res.resultcode !== '000') {\r\n\t\t\t\t\t\t\ttoptip({\r\n\t\t\t\t\t\t\t\tmsg : $XP(res, 'resultmsg', ''),\r\n\t\t\t\t\t\t\t\ttype : 'danger'\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\tfailFn();\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tvar transAmount = $XP(params, 'transAmount', 0),\r\n\t\t\t\t\t\t\t\tsettleBalance = self.get('settleBalance') || 0,\r\n\t\t\t\t\t\t\t\tnewSettleBalance = Hualala.Common.Math.sub(settleBalance - transAmount);\r\n\t\t\t\t\t\t\tself.set('settleBalance', newSettleBalance);\r\n\t\t\t\t\t\t\t// TODO update View\r\n\t\t\t\t\t\t\tsuccessFn();\r\n\t\t\t\t\t\t\ttoptip({\r\n\t\t\t\t\t\t\t\tmsg : '!',\r\n\t\t\t\t\t\t\t\ttype : 'success'\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t},\r\n\t\t\t\t// \r\n\t\t\t\t\"delete\" : function (cfg) {\r\n\t\t\t\t\tvar callServer = Hualala.Global.deleteAccount,\r\n\t\t\t\t\t\tsettleUnitID = self.get('settleUnitID'),\r\n\t\t\t\t\t\tgroupID = $XP(Hualala.getSessionSite(), 'groupID', ''),\r\n\t\t\t\t\t\tfailFn = $XF(cfg, 'failFn'),\r\n\t\t\t\t\t\tsuccessFn = $XF(cfg, 'successFn');\r\n\t\t\t\t\tcallServer({\r\n\t\t\t\t\t\tsettleUnitID : settleUnitID,\r\n\t\t\t\t\t\tgroupID : groupID\r\n\t\t\t\t\t}, function (res) {\r\n\t\t\t\t\t\tif (res.resultcode !== '000') {\r\n\t\t\t\t\t\t\ttoptip({\r\n\t\t\t\t\t\t\t\tmsg : $XP(res, 'resultmsg', ''),\r\n\t\t\t\t\t\t\t\ttype : 'danger'\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\tfailFn(settleUnitID);\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\ttoptip({\r\n\t\t\t\t\t\t\t\tmsg : '!',\r\n\t\t\t\t\t\t\t\ttype : 'success'\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t// TODO update View\r\n\t\t\t\t\t\t\tsuccessFn(settleUnitID);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t},\r\n\t\t\t\t// \r\n\t\t\t\t\"edit\" : function (cfg) {\r\n\t\t\t\t\tvar callServer = Hualala.Global.editAccount,\r\n\t\t\t\t\t\tsettleUnitID = self.get('settleUnitID'),\r\n\t\t\t\t\t\tgroupID = $XP(Hualala.getSessionSite(), 'groupID', ''),\r\n\t\t\t\t\t\tfailFn = $XF(cfg, 'failFn'),\r\n\t\t\t\t\t\tsuccessFn = $XF(cfg, 'successFn');\r\n\t\t\t\t\tcallServer(IX.inherit($XP(cfg, 'params', {}), {\r\n\t\t\t\t\t\tgroupID : groupID,\r\n\t\t\t\t\t\tsettleUnitID : settleUnitID\r\n\t\t\t\t\t}), function (res) {\r\n\t\t\t\t\t\tif (res.resultcode !== '000') {\r\n\t\t\t\t\t\t\ttoptip({\r\n\t\t\t\t\t\t\t\tmsg : $XP(res, 'resultmsg', ''),\r\n\t\t\t\t\t\t\t\ttype : 'danger'\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\tfailFn(settleUnitID);\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\ttoptip({\r\n\t\t\t\t\t\t\t\tmsg : '!',\r\n\t\t\t\t\t\t\t\ttype : 'success'\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t// TODO update View\r\n\t\t\t\t\t\t\tself.set($XP(cfg, 'params', {}));\r\n\t\t\t\t\t\t\tsuccessFn(settleUnitID);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t},\r\n\t\t\t\t// \r\n\t\t\t\t\"add\" : function (cfg) {\r\n\t\t\t\t\tvar callServer = Hualala.Global.addAccount,\r\n\t\t\t\t\t\tgroupID = $XP(Hualala.getSessionSite(), 'groupID', ''),\r\n\t\t\t\t\t\tfailFn = $XF(cfg, 'failFn'),\r\n\t\t\t\t\t\tsuccessFn = $XF(cfg, 'successFn');\r\n\t\t\t\t\tcallServer(IX.inherit($XP(cfg, 'params', {}), {\r\n\t\t\t\t\t\tgroupID : groupID\r\n\t\t\t\t\t}), function (res) {\r\n\t\t\t\t\t\tif (res.resultcode !== '000') {\r\n\t\t\t\t\t\t\ttoptip({\r\n\t\t\t\t\t\t\t\tmsg : $XP(res, 'resultmsg', ''),\r\n\t\t\t\t\t\t\t\ttype : 'danger'\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\tfailFn();\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\ttoptip({\r\n\t\t\t\t\t\t\t\tmsg : '!',\r\n\t\t\t\t\t\t\t\ttype : 'success'\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t// TODO update View\r\n\t\t\t\t\t\t\tself.set($XP(cfg, 'params', {}));\r\n\t\t\t\t\t\t\tsuccessFn();\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\t});\r\n\r\n\tHualala.Account.BaseAccountModel = BaseAccountModel;\r\n\r\n\tvar AccountTransListModel = AccountListModel.subclass({\r\n\t\tconstructor : function () {\r\n\t\t\tthis.callServer = Hualala.Global.queryAccountTransDetail;\r\n\t\t}\r\n\t});\r\n\tAccountTransListModel.proto({\r\n\t\tinit : function (params) {\r\n\t\t\tthis.set({\r\n\t\t\t\tpageCount : 0,\r\n\t\t\t\ttotalSize : 0,\r\n\t\t\t\tpageNo : $XP(params, 'pageNo', 1),\r\n\t\t\t\tpageSize : $XP(params, 'pageSize', 15),\r\n\t\t\t\ttransCreateBeginTime : $XP(params, 'transCreateBeginTime', ''),\r\n\t\t\t\ttransCreateEndTime : $XP(params, 'transCreateEndTime', ''),\r\n\t\t\t\tsettleUnitID : $XP(params, 'settleUnitID', ''),\r\n\t\t\t\ttransStatus : $XP(params, 'transStatus', ''),\r\n\t\t\t\ttransType : $XP(params, 'transType', ''),\r\n\t\t\t\tgroupID : $XP(params, 'groupID', ''),\r\n\t\t\t\tminTransAmount : $XP(params, 'minTransAmount', ''),\r\n\t\t\t\tmaxTransAmount : $XP(params, 'maxTransAmount', ''),\r\n\t\t\t\tds_trans : new IX.IListManager(),\r\n\t\t\t\tds_page : new IX.IListManager()\r\n\t\t\t});\r\n\t\t},\r\n\t\tupdateDataStore : function (data, pageNo) {\r\n\t\t\tvar self = this,\r\n\t\t\t\ttransHT = self.get('ds_trans'),\r\n\t\t\t\tpageHT = self.get('ds_page');\r\n\t\t\tvar transIDs = _.map(data, function (trans, i, l) {\r\n\t\t\t\tvar transID = $XP(trans, 'SUATransItemID'),\r\n\t\t\t\t\tmTrans = new BaseTransactionModel(trans);\r\n\t\t\t\ttransHT.register(transID, mTrans);\r\n\t\t\t\treturn transID;\r\n\t\t\t});\r\n\t\t\tpageHT.register(pageNo, transIDs);\r\n\t\t},\r\n\t\tresetDataStore : function () {\r\n\t\t\tvar self = this,\r\n\t\t\t\ttransHT = self.get('ds_trans'),\r\n\t\t\t\tpageHT = self.get('ds_page');\r\n\t\t\ttransHT.clear();\r\n\t\t\tpageHT.clear();\r\n\t\t},\r\n\t\tload : function (params, cbFn) {\r\n\t\t\tvar self = this;\r\n\t\t\tself.updatePagerParams(params);\r\n\t\t\tself.callServer(self.getPagerParams(), function (res) {\r\n\t\t\t\tif (res.resultcode == '000') {\r\n\t\t\t\t\tself.updateDataStore($XP(res, 'data.records', []), $XP(res, 'data.page.pageNo'));\r\n\t\t\t\t\tself.updatePagerParams(IX.inherit($XP(res, 'data', {}), $XP(res, 'data.page', {})));\r\n\t\t\t\t} else {\r\n\t\t\t\t\ttoptip({\r\n\t\t\t\t\t\tmsg : $XP(res, 'resultmsg', ''),\r\n\t\t\t\t\t\ttype : 'danger'\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t\tcbFn(self);\r\n\t\t\t});\r\n\t\t},\r\n\t\tgetDataByPageNo : function (pageNo) {\r\n\t\t\tvar self = this,\r\n\t\t\t\ttransHT = self.get('ds_trans'),\r\n\t\t\t\tpageHT = self.get('ds_page');\r\n\t\t\tvar ret = _.map(transHT.getByKeys(pageHT.get(pageNo)), function (mTrans) {\r\n\t\t\t\treturn mTrans.getAll();\r\n\t\t\t});\r\n\t\t\tconsole.info(\"pageData :\");\r\n\t\t\tconsole.info(ret);\r\n\t\t\treturn ret;\r\n\t\t},\r\n\t\tgetModelByID : function (transID) {\r\n\t\t\tvar self = this,\t\r\n\t\t\t\ttransHT = self.get('ds_trans');\r\n\t\t\treturn transHT.get(transID);\r\n\t\t}\r\n\t});\r\n\r\n\tHualala.Account.AccountTransListModel = AccountTransListModel;\r\n\r\n\tvar BaseTransactionModel = BaseAccountModel.subclass({\r\n\t\tconstructor : BaseAccountModel.prototype.constructor\r\n\t});\r\n\tBaseTransactionModel.proto({\r\n\t\tbindEvent : function () {\r\n\t\t\tvar self = this;\r\n\t\t\t\r\n\t\t}\r\n\t});\r\n\r\n\tHualala.Account.BaseTransactionModel = BaseTransactionModel;\r\n\r\n\tvar AccountQueryShopModel = Hualala.Shop.QueryModel.subclass({\r\n\t\tconstructor : function () {\r\n\t\t\t// \r\n\t\t\tthis.origCities = [];\r\n\t\t\tthis.origAreas = [];\r\n\t\t\tthis.origShops = [];\r\n\t\t\t// \r\n\t\t\tthis.isReady = false;\r\n\t\t\tthis.callServer = Hualala.Global.getShopQuerySchema;\r\n\t\t\t// this.callServer = Hualala.Global.getAccountQueryShop;\r\n\t\t}\r\n\t});\r\n\r\n\tHualala.Account.AccountQueryShopModel = AccountQueryShopModel;\r\n\r\n\tvar AccountQueryShopResultModel = Hualala.Shop.CardListModel.subclass({\r\n\t\tconstructor : function () {\r\n\t\t\tthis.origData = null;\r\n\t\t\t\r\n\t\t\tthis.dataStore = new IX.IListManager();\r\n\t\t}\r\n\t});\r\n\tAccountQueryShopResultModel.proto({\r\n\t\tinitDataStore : function (data) {\r\n\t\t\tvar self = this;\r\n\t\t\tself.origData = data;\r\n\t\t\t_.each(self.origData, function (shop) {\r\n\t\t\t\tself.dataStore.register($XP(shop, 'shipID'), shop);\r\n\t\t\t});\r\n\t\t},\r\n\t\tload : function (params, cbFn) {\r\n\t\t\tvar self = this;\r\n\t\t\tself.updatePagerParams(params);\r\n\t\t\tvar pageNo = self.get('pageNo'),\r\n\t\t\t\tpageSize = self.get('pageSize'),\r\n\t\t\t\tcityID = self.get('cityID'),\r\n\t\t\t\tareaID = self.get('areaID'),\r\n\t\t\t\tkeywordLst = self.get('keywordLst'),\r\n\t\t\t\ttotalSize = 0,\r\n\t\t\t\tstart = (pageNo - 1) * pageSize,\r\n\t\t\t\tend = pageSize * pageNo,\r\n\t\t\t\tpageCount = 0;\r\n\t\t\tvar shops = [];\r\n\t\t\tshops = areaID.length > 0 ? _.filter(self.origData, function (_shop) {\r\n\t\t\t\treturn $XP(_shop, 'areaID') == areaID;\r\n\t\t\t}) : self.origData;\r\n\t\t\tshops = cityID.length > 0 ? _.filter(shops, function (_shop) {\r\n\t\t\t\treturn $XP(_shop, 'cityID') == cityID;\r\n\t\t\t}) : shops;\r\n\t\t\tshops = keywordLst.length > 0 ? _.filter(shops, function (_shop) {\r\n\t\t\t\treturn $XP(_shop, 'shopName') == keywordLst;\r\n\t\t\t}) : shops;\r\n\t\t\ttotalSize = shops.length;\r\n\t\t\tpageCount = Math.ceil(totalSize / pageSize);\r\n\t\t\tshops = _.filter(shops, function (_shop, idx) {\r\n\t\t\t\treturn idx >= start && idx < end;\r\n\t\t\t});\r\n\t\t\tself.updateDataStore(shops, pageNo);\r\n\t\t\tself.updatePagerParams({\r\n\t\t\t\tpageCount : pageCount,\r\n\t\t\t\ttotalSize : totalSize,\r\n\t\t\t\tpageNo : pageNo,\r\n\t\t\t\tpageSize : pageSize\r\n\t\t\t});\r\n\t\t\tcbFn(self);\r\n\t\t}\r\n\t});\r\n\r\n\tHualala.Account.AccountQueryShopResultModel = AccountQueryShopResultModel;\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n})(jQuery, window);;(function ($, window) {\r\n\tIX.ns(\"Hualala.Account\");\r\n\tvar popoverMsg = Hualala.UI.PopoverMsgTip;\r\n\tvar toptip = Hualala.UI.TopTip;\r\n\tvar CardListView = Hualala.Shop.CardListView;\r\n\tvar AccountListView = CardListView.subclass({\r\n\t\tconstructor : CardListView.prototype.constructor\r\n\t});\r\n\tAccountListView.proto({\r\n\t\t// loadTemplates\r\n\t\t// View\r\n\t\tloadTemplates : function () {\r\n\t\t\tvar layoutTpl = Handlebars.compile(Hualala.TplLib.get('tpl_account_list_layout')),\r\n\t\t\t\tlistTpl = Handlebars.compile(Hualala.TplLib.get('tpl_account_list')),\r\n\t\t\t\titemTpl = Handlebars.compile(Hualala.TplLib.get('tpl_account_card')),\r\n\t\t\t\taddAccountTpl = Handlebars.compile(Hualala.TplLib.get('tpl_addAccount_Card'));\r\n\t\t\t// accountCard\r\n\t\t\tHandlebars.registerPartial(\"accountCard\", Hualala.TplLib.get('tpl_account_card'));\r\n\t\t\tHandlebars.registerPartial(\"addAccountCard\", Hualala.TplLib.get('tpl_addAccount_Card'));\r\n\r\n\t\t\tthis.set({\r\n\t\t\t\tlayoutTpl : layoutTpl,\r\n\t\t\t\tlistTpl : listTpl,\r\n\t\t\t\titemTpl : itemTpl\r\n\t\t\t});\r\n\t\t},\r\n\t\t// initLayout\r\n\t\tinitLayout : function () {\r\n\t\t\tvar layoutTpl = this.get('layoutTpl');\r\n\t\t\tvar htm = layoutTpl();\r\n\t\t\tthis.$container.append(htm);\r\n\t\t\tthis.$resultBox = this.$container.find('.account-list');\r\n\t\t\tthis.$list = this.$container.find('.account-list-body');\r\n\t\t\tthis.$pager = this.$container.find('.page-selection');\r\n\t\t\tthis.initPager();\r\n\t\t\tthis.bindEvent();\r\n\t\t\tthis.bindCardEvent();\r\n\t\t},\r\n\t\tbindCardEvent : function () {\r\n\t\t\tvar self = this;\r\n\t\t\tself.$list.on('click', '.btn.withdraw', function (e) {\r\n\t\t\t\tvar $btn = $(this);\r\n\t\t\t\tvar settleAccountID = $btn.parents('.bank-card').attr('data-id');\r\n\t\t\t\t// \r\n\t\t\t\tvar modal = new WithdrawCashView({\r\n\t\t\t\t\ttriggerEl : $btn,\r\n\t\t\t\t\tsettleUnitID : settleAccountID,\r\n\t\t\t\t\tmodel : self.model.getAccountModelByID(settleAccountID),\r\n\t\t\t\t\tparentView : self\r\n\t\t\t\t});\r\n\t\t\t});\r\n\t\t\tself.$list.on('click', '.create-account', function (e) {\r\n\t\t\t\tvar $btn = $(this);\r\n\t\t\t\t// TODO \r\n\t\t\t\tvar editAccount = new Hualala.Account.AccountEditView({\r\n\t\t\t\t\ttriggerEl : $btn,\r\n\t\t\t\t\tmode : 'add',\r\n\t\t\t\t\tmodel : null,\r\n\t\t\t\t\tparentView : self\r\n\t\t\t\t});\r\n\t\t\t});\r\n\t\t\tself.on({\r\n\t\t\t\t'updateSettleBalance' : function (mAccount) {\r\n\t\t\t\t\tvar settleUnitID = mAccount.get('settleUnitID'),\r\n\t\t\t\t\t\tsettleBalance = mAccount.get('settleBalance');\r\n\t\t\t\t\tself.$container.find('[data-id=' + settleUnitID + '] .cash > strong').html(settleBalance);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t},\r\n\t\t// \r\n\t\tmapRenderData : function (data) {\r\n\t\t\tvar self = this;\r\n\t\t\tvar ret = _.map(data, function (account, i, l) {\r\n\t\t\t\tvar settleUnitID = $XP(account, 'settleUnitID'),\r\n\t\t\t\t\thasDefault = $XP(account, 'defaultAccount', 0) == 0 ? false : true,\r\n\t\t\t\t\tbankInfo = Hualala.Common.mapBankInfo($XP(account, 'bankCode')),\r\n\t\t\t\t\tbankAccountStr = Hualala.Common.codeMask($XP(account, 'bankAccount', ''), 0, -4);\r\n\r\n\t\t\t\treturn {\r\n\t\t\t\t\tsettleUnitID : settleUnitID,\r\n\t\t\t\t\thasDefault : hasDefault,\r\n\t\t\t\t\tsettleUnitName : $XP(account, 'settleUnitName', ''),\r\n\t\t\t\t\tsettleBalance : parseFloat($XP(account, 'settleBalance', 0)),\r\n\t\t\t\t\tbankIcon : $XP(bankInfo, 'icon_16', ''),\r\n\t\t\t\t\tbankComName : $XP(bankInfo, 'name', ''),\r\n\t\t\t\t\tbankAccountStr : $XP(bankAccountStr, 'val', '').replace(/([\\w|*]{4})/g, '$1 ').replace(/([*])/g, '<span>$1</span>'),\r\n\t\t\t\t\tshopCount : parseInt($XP(account, 'shopCount', 0)),\r\n\t\t\t\t\tpath : Hualala.PageRoute.createPath('accountDetail', [settleUnitID])\r\n\t\t\t\t};\r\n\t\t\t});\r\n\t\t\treturn {\r\n\t\t\t\taccountCard : {\r\n\t\t\t\t\tlist : ret\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\t// \r\n\t\trender : function () {\r\n\t\t\tvar self = this,\r\n\t\t\t\tmodel = self.model,\r\n\t\t\t\tpagerParams = model.getPagerParams(),\r\n\t\t\t\tpageNo = $XP(pagerParams, 'pageNo');\r\n\t\t\tvar accounts = model.getAccounts(pageNo);\r\n\t\t\tvar renderData = self.mapRenderData(accounts);\r\n\t\t\tvar listTpl = self.get('listTpl');\r\n\t\t\tvar html = listTpl(renderData);\r\n\t\t\tself.$list.empty();\r\n\t\t\tself.$list.html(html);\r\n\t\t\tself.initPager({\r\n\t\t\t\ttotal : model.get('pageCount'),\r\n\t\t\t\tpage : model.get('pageNo'),\r\n\t\t\t\thref : 'javascript:void(0);'\r\n\t\t\t});\r\n\t\t},\r\n\t\trefresh : function () {\r\n\t\t\tvar self = this;\r\n\t\t\tself.render();\r\n\t\t}\r\n\t\t\r\n\t});\r\n\r\n\tHualala.Account.AccountListView = AccountListView;\r\n\r\n\tvar WithdrawCashView = Stapes.subclass({\r\n\t\t/**\r\n\t\t * \r\n\t\t * @param  {Object} cfg {triggerEl, settleUnitID, model}\r\n\t\t *              @param {jQueryObj} triggerEl \r\n\t\t *              @param {String} settleUnitID ID\r\n\t\t *              @param {Object} model \r\n\t\t *              @param {Object} parentView View\r\n\t\t * @return {Obj}     \r\n\t\t */\r\n\t\tconstructor : function (cfg) {\r\n\t\t\tthis.$trigger = $XP(cfg, 'triggerEl');\r\n\t\t\tthis.settleUnitID = $XP(cfg, 'settleUnitID', null);\r\n\t\t\tthis.model = $XP(cfg, 'model', null);\r\n\t\t\tthis.parentView = $XP(cfg, 'parentView', null);\r\n\t\t\tthis.modal = null;\r\n\t\t\tif (!this.settleUnitID || !this.model) {\r\n\t\t\t\tthrow(\"Withdraw Cash View init failed!\");\r\n\t\t\t}\r\n\t\t\tthis.loadTemplates();\r\n\t\t\tthis.initModal();\r\n\t\t\tthis.renderForm();\r\n\t\t\tthis.bindEvent();\r\n\t\t\tthis.emit('show');\t\t\r\n\t\t}\r\n\t});\r\n\r\n\tWithdrawCashView.proto({\r\n\t\tloadTemplates : function () {\r\n\t\t\tvar layoutTpl = Handlebars.compile(Hualala.TplLib.get('tpl_withdraw_form')),\r\n\t\t\t\tbtnTpl = Handlebars.compile(Hualala.TplLib.get('tpl_shop_modal_btns'));\r\n\t\t\tthis.set({\r\n\t\t\t\tlayoutTpl : layoutTpl,\r\n\t\t\t\tbtnTpl : btnTpl\r\n\t\t\t});\r\n\t\t},\r\n\t\tinitModal : function () {\r\n\t\t\tvar self = this;\r\n\t\t\tself.modal = new Hualala.UI.ModalDialog({\r\n\t\t\t\tid : 'account_withdraw',\r\n\t\t\t\tclz : 'service-modal',\r\n\t\t\t\ttitle : '',\r\n\t\t\t\tafterRemove : function () {\r\n\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t},\r\n\t\tmapFormElsData : function () {\r\n\t\t\tvar self = this,\r\n\t\t\t\taccountInfoKeys = [\r\n\t\t\t\t\t{key : 'settleUnitName', label : ''},\r\n\t\t\t\t\t{key : 'receiverName', label : ''},\r\n\t\t\t\t\t{key : 'bankName', label : ''},\r\n\t\t\t\t\t{key : 'bankAccount', label : ''},\r\n\t\t\t\t\t{key : 'settleBalance', label : ''}\r\n\t\t\t\t],\r\n\t\t\t\taccountInfo = _.map(accountInfoKeys, function (el) {\r\n\t\t\t\t\tvar k = $XP(el, 'key');\r\n\t\t\t\t\treturn {\r\n\t\t\t\t\t\tlabel : $XP(el, 'label', ''),\r\n\t\t\t\t\t\tvalue : k == 'settleBalance' ? ('<strong>' + self.model.get(k) + '</strong>') : self.model.get(k)\r\n\t\t\t\t\t};\r\n\t\t\t\t});\r\n\t\t\treturn {\r\n\t\t\t\taccountInfo : accountInfo,\r\n\t\t\t\tformClz : 'account-withdraw-form',\r\n\t\t\t\tlabelClz : 'col-sm-4 control-label',\r\n\t\t\t\tclz : 'col-sm-7',\r\n\t\t\t\tid : 'transAmount',\r\n\t\t\t\tlabel : '',\r\n\t\t\t\tname : 'transAmount',\r\n\t\t\t\tvalue : self.model.get('settleBalance')\r\n\t\t\t};\r\n\t\t},\r\n\t\trenderForm : function () {\r\n\t\t\tvar self = this,\r\n\t\t\t\trenderData = self.mapFormElsData(),\r\n\t\t\t\ttpl = self.get('layoutTpl'),\r\n\t\t\t\tbtnTpl = self.get('btnTpl'),\r\n\t\t\t\thtm = tpl(renderData);\r\n\t\t\tself.modal._.body.html(htm);\r\n\t\t\tself.modal._.footer.html(btnTpl({\r\n\t\t\t\tbtns : [\r\n\t\t\t\t\t{clz : 'btn-default', name : 'cancel', label : ''},\r\n\t\t\t\t\t{clz : 'btn-warning', name : 'submit', label : ''}\r\n\t\t\t\t]\r\n\t\t\t}));\r\n\t\t},\r\n\t\tbindEvent : function () {\r\n\t\t\tvar self = this;\r\n\t\t\tthis.on({\r\n\t\t\t\tshow : function () {\r\n\t\t\t\t\tthis.modal.show();\r\n\t\t\t\t},\r\n\t\t\t\thide : function () {\r\n\t\t\t\t\tthis.modal.hide();\r\n\t\t\t\t\tthis.parentView.emit('updateSettleBalance', self.model);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\tself.modal._.dialog.find('.btn').on('click', function (e) {\r\n\t\t\t\tvar $btn = $(this),\r\n\t\t\t\t\tact = $btn.attr('name');\r\n\t\t\t\tif (act == 'cancel') {\r\n\t\t\t\t\tself.emit('hide');\r\n\t\t\t\t} else {\r\n\t\t\t\t\tvar bv = self.modal._.body.find('form').data('bootstrapValidator');\r\n\t\t\t\t\t$btn.button('...');\r\n\t\t\t\t\tbv.validate();\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\tself.modal._.body.find('form').bootstrapValidator({\r\n\t\t\t\ttrigger : 'blur',\r\n\t\t\t\tfields : {\r\n\t\t\t\t\ttransAmount : {\r\n\t\t\t\t\t\tvalidators : {\r\n\t\t\t\t\t\t\tnotEmpty : {\r\n\t\t\t\t\t\t\t\tmessage : \"\"\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\tnumeric : {\r\n\t\t\t\t\t\t\t\tmessage: \"\"\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\tgreaterThan : {\r\n\t\t\t\t\t\t\t\tinclusive : false,\r\n\t\t\t\t\t\t\t\tvalue : 0,\r\n\t\t\t\t\t\t\t\tmessage : \"0\"\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\tlessThan : {\r\n\t\t\t\t\t\t\t\tinclusive : true,\r\n\t\t\t\t\t\t\t\tvalue : self.model.get('settleBalance')\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\taccuracy : {\r\n\t\t\t\t\t\t\t\taccuracy : 2,\r\n\t\t\t\t\t\t\t\tmessage : \"2\"\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}).on('error.field.bv', function (e, data) {\r\n\t\t\t\tvar $form = $(e.target),\r\n\t\t\t\t\tbv = $form.data('bootstrapValidator');\r\n\t\t\t}).on('success.form.bv', function (e, data) {\r\n\t\t\t\te.preventDefault();\r\n\t\t\t\tvar $form = $(e.target),\r\n\t\t\t\t\tbv = $form.data('bootstrapValidator');\r\n\t\t\t\tvar formParams = self.serializeForm();\r\n\t\t\t\tself.model.emit('withdrawCash', {\r\n\t\t\t\t\tparams : formParams,\r\n\t\t\t\t\tfailFn : function () {\r\n\t\t\t\t\t\tself.modal._.footer.find('.btn[name=submit]').button('reset');\r\n\t\t\t\t\t},\r\n\t\t\t\t\tsuccessFn : function () {\r\n\t\t\t\t\t\tself.modal._.footer.find('.btn[name=submit]').button('reset');\r\n\t\t\t\t\t\tself.emit('hide');\r\n\t\t\t\t\t}\r\n\t\t\t\t})\r\n\t\t\t});\r\n\t\t},\r\n\t\tserializeForm : function () {\r\n\t\t\tvar self = this,\r\n\t\t\t\t$body = self.modal._.body;\r\n\t\t\treturn {\r\n\t\t\t\ttransAmount : $body.find('#transAmount').val()\r\n\t\t\t};\r\n\t\t}\r\n\r\n\t});\r\n\r\n\tHualala.Account.WithdrawCashView = WithdrawCashView;\r\n\r\n\tvar QueryTransFormElsCfg = {\r\n\t\ttransCreateTime : {\r\n\t\t\ttype : 'section',\r\n\t\t\tlabel : '',\r\n\t\t\tmin : {\r\n\t\t\t\ttype : 'datetimepicker',\r\n\t\t\t\tsurfix : '<span class=\"glyphicon glyphicon-calendar\"></span>',\r\n\t\t\t\tdefaultVal : '',\r\n\t\t\t\tvalidCfg : {\r\n\t\t\t\t\tgroup : '.min-input',\r\n\t\t\t\t\tvalidators : {}\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tmax : {\r\n\t\t\t\ttype : 'datetimepicker',\r\n\t\t\t\tsurfix : '<span class=\"glyphicon glyphicon-calendar\"></span>',\r\n\t\t\t\tdefaultVal : '',\r\n\t\t\t\tvalidCfg : {\r\n\t\t\t\t\tgroup : '.max-input',\r\n\t\t\t\t\tvalidators : {}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\ttransAmount : {\r\n\t\t\ttype : 'section',\r\n\t\t\tlabel : '',\r\n\t\t\tmin : {\r\n\t\t\t\ttype : 'text',\r\n\t\t\t\tprefix : '',\r\n\t\t\t\tsurfix : '',\r\n\t\t\t\tdefaultVal : '',\r\n\t\t\t\tvalidCfg : {\r\n\t\t\t\t\tvalidators : {\r\n\t\t\t\t\t\tnumeric : {\r\n\t\t\t\t\t\t\tmessage: \"\"\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\tgreaterThan : {\r\n\t\t\t\t\t\t\tinclusive : true,\r\n\t\t\t\t\t\t\tvalue : 0,\r\n\t\t\t\t\t\t\tmessage : \"0\"\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tmax : {\r\n\t\t\t\ttype : 'text',\r\n\t\t\t\tprefix : '',\r\n\t\t\t\tsurfix : '',\r\n\t\t\t\tdefaultVal : '',\r\n\t\t\t\tvalidCfg : {\r\n\t\t\t\t\tvalidators : {\r\n\t\t\t\t\t\tnumeric : {\r\n\t\t\t\t\t\t\tmessage: \"\"\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\tgreaterThan : {\r\n\t\t\t\t\t\t\tinclusive : true,\r\n\t\t\t\t\t\t\tvalue : 0,\r\n\t\t\t\t\t\t\tmessage : \"0\"\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\ttransStatus : {\r\n\t\t\ttype : 'combo',\r\n\t\t\tlabel : '',\r\n\t\t\tdefaultVal : '',\r\n\t\t\toptions : Hualala.TypeDef.FSMTransStatus,\r\n\t\t\tvalidCfg : {\r\n\t\t\t\tvalidators : {\r\n\t\t\t\t\t\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\ttransType : {\r\n\t\t\ttype : 'combo',\r\n\t\t\tlabel : '',\r\n\t\t\tdefaultVal : '',\r\n\t\t\toptions : Hualala.TypeDef.FSMTransType,\r\n\t\t\tvalidCfg : {\r\n\t\t\t\tvalidators : {\r\n\t\t\t\t\t\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\tbutton : {\r\n\t\t\ttype : 'button',\r\n\t\t\tclz : 'btn btn-block btn-warning',\r\n\t\t\tlabel : ''\r\n\t\t}\r\n\t};\r\n\tvar QueryTransFormElsHT = new IX.IListManager();\r\n\t_.each(QueryTransFormElsCfg, function (el, k) {\r\n\t\tvar type = $XP(el, 'type');\r\n\t\tvar labelClz = 'col-xs-2 col-sm-2 col-md-2 control-label';\r\n\t\tif (type == 'section') {\r\n\t\t\tvar id = minID = k + '_min_' + IX.id(), maxID = k + '_max_' + IX.id(),\r\n\t\t\t\tminName = k == 'transCreateTime' ? 'transCreateBeginTime' : 'minTransAmount',\r\n\t\t\t\tmaxName = k == 'transCreateTime' ? 'transCreateEndTime' : 'maxTransAmount',\r\n\t\t\t\tmin = IX.inherit($XP(el, 'min', {}), {\r\n\t\t\t\t\tid : minID, name : minName, clz : 'col-xs-5 col-sm-5 col-md-5',\r\n\t\t\t\t}), max = IX.inherit($XP(el, 'max', {}), {\r\n\t\t\t\t\tid : maxID, name : maxName, clz : 'col-xs-5 col-sm-5 col-md-5',\r\n\t\t\t\t});\r\n\t\t\tQueryTransFormElsHT.register(k, IX.inherit(el, {\r\n\t\t\t\tid : id,\r\n\t\t\t\tlabelClz : labelClz,\r\n\t\t\t\tmin : min,\r\n\t\t\t\tmax : max\r\n\t\t\t}));\r\n\t\t} else {\r\n\t\t\tQueryTransFormElsHT.register(k, IX.inherit(el, {\r\n\t\t\t\tid : k + '_' + IX.id(),\r\n\t\t\t\tname : k,\r\n\t\t\t\tlabelClz : labelClz,\r\n\t\t\t}, $XP(el, 'type') !== 'button' ? {clz : 'col-xs-5 col-sm-8 col-md-5'} : null));\r\n\t\t}\r\n\t});\r\n\tvar TransResultCols = [\r\n\t\t{clz : '', label : ''},\r\n\t\t{clz : '', label : ''},\r\n\t\t{clz : '', label : ''},\r\n\t\t{clz : '', label : ''},\r\n\t\t{clz : '', label : ''},\r\n\t\t{clz : '', label : ''},\r\n\t\t{clz : '', label : ''},\r\n\t\t{clz : '', label : ''},\r\n\t\t{clz : '', label : ''},\r\n\t\t{clz : '', label : ''}\r\n\t];\r\n\r\n\tvar AccountTransListView = CardListView.subclass({\r\n\t\tconstructor : function () {\r\n\t\t\t// View\r\n\t\t\tthis.$container = null;\r\n\t\t\t// \r\n\t\t\tthis.$queryForm = null;\r\n\t\t\t// \r\n\t\t\tthis.$resultBox = null;\r\n\t\t\t// \r\n\t\t\tthis.$pager = null;\r\n\t\t\tthis.loadTemplates();\r\n\t\t}\r\n\t});\r\n\tAccountTransListView.proto({\r\n\t\tloadTemplates : function () {\r\n\t\t\tvar layoutTpl = Handlebars.compile(Hualala.TplLib.get('tpl_account_detail')),\r\n\t\t\t\ttableTpl = Handlebars.compile(Hualala.TplLib.get('tpl_transaQuery_result'));\r\n\t\t\tHandlebars.registerPartial(\"transaQueryForm\", Hualala.TplLib.get('tpl_transaQuery_form'));\r\n\t\t\tHandlebars.registerPartial(\"transaQueryResult\", Hualala.TplLib.get('tpl_transaQuery_result'));\r\n\t\t\tHandlebars.registerHelper('checkFormElementType', function (conditional, options) {\r\n\t\t\t\treturn (conditional == options.hash.type) ? options.fn(this) : options.inverse(this);\r\n\t\t\t});\r\n\t\t\tHandlebars.registerHelper('chkColType', function (conditional, options) {\r\n\t\t\t\treturn (conditional == options.hash.type) ? options.fn(this) : options.inverse(this);\r\n\t\t\t});\r\n\t\t\tthis.set({\r\n\t\t\t\tlayoutTpl : layoutTpl,\r\n\t\t\t\ttableTpl : tableTpl\r\n\t\t\t});\r\n\t\t},\r\n\t\tinitLayout : function () {\r\n\t\t\tvar layoutTpl = this.get('layoutTpl');\r\n\t\t\tvar result = [],\r\n\t\t\t\ttblClz = 'table-striped table-hover',\r\n\t\t\t\ttblHeaders = TransResultCols,\r\n\t\t\t\tquery = {cols : [\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tcolClz : 'col-sm-6',\r\n\t\t\t\t\t\titems : QueryTransFormElsHT.getByKeys(['transCreateTime', 'transAmount'])\r\n\t\t\t\t\t},\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tcolClz : 'col-sm-4',\r\n\t\t\t\t\t\titems : QueryTransFormElsHT.getByKeys(['transType', 'transStatus'])\r\n\t\t\t\t\t},\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tcolClz : 'col-sm-2',\r\n\t\t\t\t\t\titems : QueryTransFormElsHT.getByKeys(['button'])\r\n\t\t\t\t\t}\r\n\t\t\t\t]};\r\n\t\t\tvar htm = layoutTpl({\r\n\t\t\t\tquery : query,\r\n\t\t\t\tresult : {\r\n\t\t\t\t\tclz : tblClz,\r\n\t\t\t\t\tthead : tblHeaders,\r\n\t\t\t\t\trows : result\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\tthis.$container.html(htm);\r\n\t\t\tthis.$queryForm = this.$container.find('.query-form');\r\n\t\t\tthis.$resultBox = this.$container.find('.query-result');\r\n\t\t\tthis.$pager = this.$container.find('.page-selection');\r\n\t\t\tthis.render();\r\n\t\t\tthis.initPager();\r\n\t\t\tthis.initQueryEls();\r\n\t\t\tthis.bindEvent();\r\n\t\t\tthis.bindQueryEvent();\r\n\t\t},\r\n\t\tinitQueryEls : function () {\r\n\t\t\tvar self = this;\r\n\t\t\tself.$queryForm.find('[data-type=datetimepicker]').datetimepicker({\r\n\t\t\t\tformat : 'yyyy/mm/dd',\r\n\t\t\t\tstartDate : '2010/01/01',\r\n\t\t\t\tautoclose : true,\r\n\t\t\t\tminView : 'month',\r\n\t\t\t\ttodayBtn : true,\r\n\t\t\t\ttodayHighlight : true,\r\n\t\t\t\tlanguage : 'zh-CN'\r\n\t\t\t});\r\n\t\t\tself.$queryForm.on('click', '.input-group-addon', function (e) {\r\n\t\t\t\tvar $this = $(this),\r\n\t\t\t\t\t$picker = $this.prev(':text[data-type=datetimepicker]');\r\n\t\t\t\tif ($picker.length > 0) {\r\n\t\t\t\t\t$picker.datetimepicker('show');\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t},\r\n\t\tbindEvent : function () {\r\n\t\t\tvar self = this;\r\n\t\t\tself.$resultBox.tooltip({\r\n\t\t\t\tselector : '[title]'\r\n\t\t\t});\r\n\t\t\tself.$resultBox.on('click', '.btn[data-href]', function (e) {\r\n\t\t\t\tvar $btn = $(this),\r\n\t\t\t\t\tpath = $btn.attr('data-href');\r\n\t\t\t\tdocument.location.href = path;\r\n\t\t\t});\r\n\t\t\tself.$pager.on('page', function (e, pageNo) {\r\n\t\t\t\tvar params = self.model.getPagerParams();\r\n\t\t\t\tparams['pageNo'] = pageNo;\r\n\t\t\t\tself.model.emit('load', IX.inherit(params, {\r\n\t\t\t\t\tpageNo : $XP(params, 'pageNo', 1),\r\n\t\t\t\t\tpageSize : $XP(params, 'pageSize', 15)\r\n\t\t\t\t}));\r\n\t\t\t});\r\n\t\t},\r\n\t\tbindQueryEvent : function () {\r\n\t\t\tvar self = this;\r\n\t\t\tself.$resultBox.on('click', 'a[data-orderkey]', function (e) {\r\n\t\t\t\tvar $btn = $(this),\r\n\t\t\t\t\torderKey = $btn.attr('data-orderkey') || '',\r\n\t\t\t\t\ttransType = $btn.attr('data-type') || '',\r\n\t\t\t\t\ttransID = $btn.attr('data-id') || '',\r\n\t\t\t\t\torderID = $btn.attr('data-orderid') || '';\r\n\t\t\t\t// TODO show transaction detail modal\r\n\t\t\t\tvar detail = new Hualala.Account.AccountTransDetailModal({\r\n\t\t\t\t\ttriggerEl : $btn,\r\n\t\t\t\t\torderKey : orderKey,\r\n\t\t\t\t\torderID : orderID,\r\n\t\t\t\t\ttransType : transType,\r\n\t\t\t\t\ttransID : transID\r\n\t\t\t\t});\r\n\t\t\t});\r\n\t\t\tself.$queryForm.on('click', '.btn', function (e) {\r\n\t\t\t\t// TODO Update modal params and render query result\r\n\t\t\t\tvar params = self.getQueryFormParams();\r\n\t\t\t\tself.model.emit('load', params);\r\n\t\t\t});\r\n\t\t},\r\n\t\tgetQueryFormParams : function () {\r\n\t\t\tvar self = this;\r\n\t\t\t// var formKeys = ['transCreateBeginTime', 'transCreateEndTime', 'minTransAmount', 'maxTransAmount', 'transType', 'transStatus'];\r\n\t\t\tvar params = self.$queryForm.find('>form').serializeArray();\r\n\t\t\tvar ret = {};\r\n\t\t\t_.each(params, function (el, i) {\r\n\t\t\t\tvar k = $XP(el, 'name'), v = $XP(el, 'value', '');\r\n\t\t\t\tswitch(k) {\r\n\t\t\t\t\tcase 'transCreateBeginTime':\r\n\t\t\t\t\tcase 'transCreateEndTime':\r\n\t\t\t\t\t\tif (IX.isEmpty(v)) {\r\n\t\t\t\t\t\t\tv = '';\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tv = IX.Date.getDateByFormat(v, 'yyyyMMddHHmmss');\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tdefault :\r\n\t\t\t\t\t\tv = IX.isEmpty(v) ? '' : v;\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t\tret[k] = v;\r\n\t\t\t});\r\n\t\t\tconsole.info(ret);\r\n\t\t\treturn ret;\r\n\t\t},\r\n\t\tmapTimeData : function (s) {\r\n\t\t\tvar r = {value : '', text : ''};\r\n\t\t\tvar s1 = '';\r\n\t\t\tif (IX.isString(s) && s.length > 0) {\r\n\t\t\t\ts1 = s.replace(/([\\d]{4})([\\d]{2})([\\d]{2})([\\d]{2})([\\d]{2})([\\d]{2})/g, '$1/$2/$3 $4:$5:$6');\r\n\t\t\t\ts1 = IX.Date.getDateByFormat(s1, 'yyyy/MM/dd HH:mm');\r\n\t\t\t\tr = IX.inherit({value : s, text : s1});\r\n\t\t\t}\r\n\t\t\treturn r;\r\n\t\t},\r\n\t\tmapTransStatus : function (s) {\r\n\t\t\ts = (s + \"\") || '';\r\n\t\t\tvar status = Hualala.TypeDef.FSMTransStatus;\r\n\t\t\tvar m = _.filter(status, function (el) {\r\n\t\t\t\treturn $XP(el, 'value', '') == s;\r\n\t\t\t});\r\n\t\t\tif (s.length == 0 || m.length == 0) {\r\n\t\t\t\treturn {text : '', value : ''};\r\n\t\t\t}\r\n\t\t\treturn {text : $XP(m[0], 'label', ''), value : $XP(m[0], 'value', '')};\r\n\t\t},\r\n\t\tmapTransType : function (s) {\r\n\t\t\ts = s || '';\r\n\t\t\tvar types = Hualala.TypeDef.FSMTransType;\r\n\t\t\tvar m = _.filter(types, function (el) {\r\n\t\t\t\treturn $XP(el, 'value', '') == s;\r\n\t\t\t});\r\n\t\t\tif (s.length == 0 || m.length == 0) {\r\n\t\t\t\treturn {text : '', value : ''};\r\n\t\t\t}\r\n\t\t\treturn {text : $XP(m[0], 'label', ''), value : $XP(m[0], 'value', '')};\r\n\t\t},\r\n\t\tmapCashData : function (s) {\r\n\t\t\treturn {text : Hualala.Common.Math.prettyNumeric(s), value : s};\r\n\t\t},\r\n\t\tmapTransChanged : function (r) {\r\n\t\t\tvar transAmount = $XP(r, 'transAmount', 0),\r\n\t\t\t\ttransSalesCommission = $XP(r, 'transSalesCommission', 0),\r\n\t\t\t\ttransPoundage = $XP(r, 'transPoundage', 0),\r\n\t\t\t\ttransChanged = transAmount - transSalesCommission - transPoundage;\r\n\t\t\treturn {value : transChanged, text : transChanged};\r\n\t\t},\r\n\t\tmapColsRenderData : function (row) {\r\n\t\t\tvar self = this;\r\n\t\t\tvar colKeys = 'transCreateTime,SUATransItemID,transStatus,transType,transAmount,transSalesCommission,transPoundage,transChanged,transAfterBalance,rowControl';\r\n\t\t\tvar col = {clz : '', type : 'text'};\r\n\r\n\t\t\tvar cols = _.map(colKeys.split(','), function (k, i) {\r\n\t\t\t\tvar r = null;\r\n\t\t\t\tswitch(k) {\r\n\t\t\t\t\tcase 'transCreateTime':\r\n\t\t\t\t\t\tr = self.mapTimeData($XP(row, k, ''));\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 'SUATransItemID':\r\n\t\t\t\t\t\tr = {value : $XP(row, k, ''), text : $XP(row, k, '')};\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 'transStatus':\r\n\t\t\t\t\t\tr = self.mapTransStatus($XP(row, k, ''));\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 'transType':\r\n\t\t\t\t\t\tr = self.mapTransType($XP(row, k, ''));\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 'transAmount':\r\n\t\t\t\t\tcase 'transSalesCommission':\r\n\t\t\t\t\tcase 'transPoundage':\r\n\t\t\t\t\tcase 'transAfterBalance':\r\n\t\t\t\t\t\tr = self.mapCashData($XP(row, k, ''));\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 'transChanged':\r\n\t\t\t\t\t\tr = self.mapTransChanged(row);\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 'rowControl':\r\n\t\t\t\t\t\tvar transType = $XP(row, 'transType', ''),\r\n\t\t\t\t\t\t\ttransStatus = $XP(row, 'transStatus', '');\r\n\t\t\t\t\t\tvar hideBtnTransType = \"104,199,202,204,205,206,299\";\r\n\t\t\t\t\t\tr = {\r\n\t\t\t\t\t\t\ttype : 'button',\r\n\t\t\t\t\t\t\tbtnClz : (hideBtnTransType.indexOf(transType) >= 0 || (transType == \"203\" && transStatus < 1)) ? 'hidden' : '',\r\n\t\t\t\t\t\t\tlabel : '',\r\n\t\t\t\t\t\t\tSUATransItemID : $XP(row, 'SUATransItemID', ''),\r\n\t\t\t\t\t\t\ttransType : transType,\r\n\t\t\t\t\t\t\torderKey : $XP(row, 'orderKey', ''),\r\n\t\t\t\t\t\t\torderID : $XP(row, 'orderID', '')\r\n\t\t\t\t\t\t};\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t\treturn IX.inherit(col, r);\r\n\t\t\t});\r\n\t\t\treturn cols;\r\n\t\t},\r\n\t\tmapRenderData : function (data) {\r\n\t\t\tvar self = this;\r\n\t\t\tvar tblClz = 'table-striped table-hover',\r\n\t\t\t\ttblHeaders = TransResultCols;\r\n\t\t\tvar rows = _.map(data, function (row) {\r\n\t\t\t\treturn {\r\n\t\t\t\t\tclz : '',\r\n\t\t\t\t\tcols : self.mapColsRenderData(row)\r\n\t\t\t\t};\r\n\t\t\t});\r\n\t\t\treturn {\r\n\t\t\t\tclz : tblClz,\r\n\t\t\t\tthead : tblHeaders,\r\n\t\t\t\trows : rows\r\n\t\t\t};\r\n\t\t},\r\n\t\trender : function () {\r\n\t\t\tvar self = this,\r\n\t\t\t\tmodel = self.model,\r\n\t\t\t\tpagerParams = model.getPagerParams(),\r\n\t\t\t\tpageNo = $XP(pagerParams, 'pageNo');\r\n\t\t\tvar results = model.getDataByPageNo(pageNo);\r\n\t\t\tvar renderData = self.mapRenderData(results);\r\n\t\t\tvar tableTpl = self.get('tableTpl');\r\n\t\t\tvar html = tableTpl(renderData);\r\n\t\t\tself.$resultBox.empty();\r\n\t\t\tself.$resultBox.html(html);\r\n\t\t\tself.initPager({\r\n\t\t\t\ttotal : model.get('pageCount'),\r\n\t\t\t\tpage : model.get('pageNo'),\r\n\t\t\t\thref : 'javascript:void(0);'\r\n\t\t\t});\r\n\t\t}\r\n\t});\r\n\tHualala.Account.AccountTransListView = AccountTransListView;\r\n\r\n\tvar AccountQueryShopView = Hualala.Shop.QueryView.subclass({\r\n\t\tconstructor : Hualala.Shop.QueryView.prototype.constructor\r\n\t});\r\n\tHualala.Account.AccountQueryShopView = AccountQueryShopView;\r\n\r\n\tvar AccountQueryShopResultView = CardListView.subclass({\r\n\t\tconstructor : CardListView.prototype.constructor\r\n\t});\r\n\tAccountQueryShopResultView.proto({\r\n\t\tloadTemplates : function () {\r\n\t\t\tvar layoutTpl = Handlebars.compile(Hualala.TplLib.get('tpl_shop_list_layout')),\r\n\t\t\t\tlistTpl = Handlebars.compile(Hualala.TplLib.get('tpl_shop_list')),\r\n\t\t\t\titemTpl = Handlebars.compile(Hualala.TplLib.get('tpl_shop_table'));\r\n\t\t\t// shopCard\r\n\t\t\tHandlebars.registerPartial(\"shopTable\", Hualala.TplLib.get('tpl_shop_table'));\r\n\r\n\t\t\tthis.set({\r\n\t\t\t\tlayoutTpl : layoutTpl,\r\n\t\t\t\tlistTpl : listTpl,\r\n\t\t\t\titemTpl : itemTpl\r\n\t\t\t});\r\n\t\t},\r\n\t\t// \r\n\t\tmapRenderData : function (data) {\r\n\t\t\tvar self = this;\r\n\t\t\t\r\n\t\t\tvar ret = _.map(data, function (shop, i, l) {\r\n\t\t\t\treturn {\r\n\t\t\t\t\tclz : '',\r\n\t\t\t\t\tid : $XP(shop, 'shopID', ''),\r\n\t\t\t\t\tname : $XP(shop, 'shopName', ''),\r\n\t\t\t\t\tcity : $XP(shop, 'cityName', '')\r\n\t\t\t\t};\r\n\t\t\t});\r\n\t\t\treturn {\r\n\t\t\t\tshopTable : {\r\n\t\t\t\t\trows : ret\r\n\t\t\t\t}\r\n\t\t\t};\r\n\t\t},\r\n\t\trender : function () {\r\n\t\t\tvar self = this,\r\n\t\t\t\tmodel = self.model,\r\n\t\t\t\tpagerParams = model.getPagerParams(),\r\n\t\t\t\tpageNo = $XP(pagerParams, 'pageNo');\r\n\t\t\tvar shops = model.getShops(pageNo);\r\n\t\t\tvar renderData = self.mapRenderData(shops);\r\n\t\t\tvar listTpl = self.get('listTpl');\r\n\t\t\tvar html = listTpl(renderData);\r\n\t\t\tself.$list.empty();\r\n\t\t\tself.$list.html(html);\r\n\t\t\tself.initPager({\r\n\t\t\t\ttotal : model.get('pageCount'),\r\n\t\t\t\tpage : model.get('pageNo'),\r\n\t\t\t\thref : 'javascript:void(0);'\r\n\t\t\t});\r\n\t\t}\r\n\t});\r\n\tHualala.Account.AccountQueryShopResultView = AccountQueryShopResultView;\r\n})(jQuery, window);;(function ($, window) {\r\n\tIX.ns(\"Hualala.Account\");\r\n\tvar popoverMsg = Hualala.UI.PopoverMsgTip;\r\n\tvar toptip = Hualala.UI.TopTip;\r\n\tvar AccountListModel = Hualala.Account.AccountListModel;\r\n\tvar AccountListView = Hualala.Account.AccountListView;\r\n\tvar ShopListController = Hualala.Shop.ShopListController;\r\n\r\n\tvar QueryModel = Hualala.Shop.QueryModel;\r\n\tvar QueryView = Hualala.Shop.QueryView;\r\n\tvar QueryController = Hualala.Shop.QueryController;\r\n\r\n\tvar AccountListController = ShopListController.subclass({\r\n\t\t/**\r\n\t\t * \r\n\t\t * @param  {Object} cfg \r\n\t\t *          @param {JQueryObj} container \r\n\t\t *          @param {Object} view  View\r\n\t\t *          @param {Object} model \r\n\t\t * @return {Object}     \r\n\t\t */\r\n\t\tconstructor : ShopListController.prototype.constructor\r\n\t});\r\n\r\n\r\n\tHualala.Account.AccountListController = AccountListController;\r\n\r\n\tvar AccountQueryShopController = QueryController.subclass({\r\n\t\tconstructor : function (cfg) {\r\n\t\t\tthis.set({\r\n\t\t\t\tsessionData : Hualala.getSessionData()\r\n\t\t\t});\r\n\t\t\tthis.settleUnitID = $XP(cfg, 'settleUnitID', '');\r\n\t\t\tthis.settleName = $XP(cfg, 'settleName', '');\r\n\t\t\tthis.shopCount = $XP(cfg, 'shopCount', '');\r\n\t\t\tthis.container = $XP(cfg, 'container', null);\r\n\t\t\tthis.needShopCreate = false;\r\n\t\t\tthis.model = new Hualala.Account.AccountQueryShopModel();\r\n\t\t\tthis.view = new Hualala.Account.AccountQueryShopView();\r\n\t\t\tthis.resultContainer = $XP(cfg, 'resultContainer', null);\r\n\t\t\tthis.resultController = new Hualala.Account.AccountQueryShopResultController({\r\n\t\t\t\tcontainer : this.resultContainer,\r\n\t\t\t\tmodel : new Hualala.Account.AccountQueryShopResultModel(),\r\n\t\t\t\tview : new Hualala.Account.AccountQueryShopResultView()\r\n\t\t\t})\r\n\t\t\tthis.init();\r\n\t\t}\r\n\t});\r\n\tAccountQueryShopController.proto({\r\n\t\tinit : function () {\r\n\t\t\tvar self = this;\r\n\t\t\tself.bindEvent();\r\n\t\t\tself.model.emit('load', function () {\r\n\t\t\t\tif (!self.model.hasReady()) {\r\n\t\t\t\t\tthrow(\"Shop Query Init Failed!!\");\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\tself.resultController.initDataStore(self.model.getShops());\r\n\t\t\t\t// View\r\n\t\t\t\tself.view.emit('init');\r\n\t\t\t\t\r\n\t\t\t});\r\n\t\t},\r\n\t\t// \r\n\t\tbindEvent : function () {\r\n\t\t\t// \r\n\t\t\tthis.on({\r\n\t\t\t\treload : function () {\r\n\t\t\t\t\tvar self = this;\r\n\t\t\t\t\tself.model.distory();\r\n\t\t\t\t\tself.view.distory();\r\n\t\t\t\t\tself.init();\r\n\t\t\t\t},\r\n\t\t\t\tquery : function (params) {\r\n\t\t\t\t\tvar self = this;\r\n\t\t\t\t\tconsole.info('query params:');\r\n\t\t\t\t\tconsole.info(params);\r\n\t\t\t\t\tself.resultController && self.resultController.emit('load', IX.inherit(params, {\r\n\t\t\t\t\t\tpageNo : 1,\r\n\t\t\t\t\t\tpageSize : 15\r\n\t\t\t\t\t}));\r\n\t\t\t\t}\r\n\t\t\t}, this);\r\n\t\t\t// \r\n\t\t\tthis.model.on({\r\n\t\t\t\tload : function (cbFn) {\r\n\t\t\t\t\tvar self = this,\r\n\t\t\t\t\t\tparams = {\r\n\t\t\t\t\t\t\tsettleUnitID : self.settleUnitID,\r\n\t\t\t\t\t\t\tsettleName : self.settleName,\r\n\t\t\t\t\t\t\tshopCount : self.shopCount\r\n\t\t\t\t\t\t};\r\n\t\t\t\t\t\t// params = $XP(self.get('sessionData'), 'user', {});\r\n\t\t\t\t\tself.model.init(params, cbFn);\r\n\t\t\t\t}\r\n\t\t\t}, this);\r\n\t\t\t// \r\n\t\t\tthis.view.on({\r\n\t\t\t\tinit : function () {\r\n\t\t\t\t\tvar self = this;\r\n\t\t\t\t\tself.view.init({\r\n\t\t\t\t\t\tmodel : self.model,\r\n\t\t\t\t\t\tneedShopCreate : self.needShopCreate,\r\n\t\t\t\t\t\tcontainer : self.container\r\n\t\t\t\t\t});\r\n\t\t\t\t},\r\n\t\t\t\t// \r\n\t\t\t\tfilter : function (params) {\r\n\t\t\t\t\tvar self = this;\r\n\t\t\t\t\tself.emit('query', params);\r\n\t\t\t\t\t//TODO QuerychosenPanel\r\n\t\t\t\t},\r\n\t\t\t\t// \r\n\t\t\t\tquery : function (params) {\r\n\t\t\t\t\tvar self = this;\r\n\t\t\t\t\tself.emit('query', params);\r\n\t\t\t\t}\r\n\t\t\t}, this);\r\n\t\t}\r\n\t});\r\n\tHualala.Account.AccountQueryShopController = AccountQueryShopController;\r\n\r\n\tvar AccountQueryShopResultController = Hualala.Shop.ShopListController.subclass({\r\n\t\tconstructor : Hualala.Shop.ShopListController.prototype.constructor\r\n\t});\r\n\tAccountQueryShopResultController.proto({\r\n\t\tinitDataStore : function (data) {\r\n\t\t\tthis.model.initDataStore(data);\r\n\t\t},\r\n\t\tbindEvent : function () {\r\n\t\t\tthis.on({\r\n\t\t\t\tload : function (params) {\r\n\t\t\t\t\tvar self = this;\r\n\t\t\t\t\tif (!self.hasReady()) {\r\n\t\t\t\t\t\tself.init(params);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tself.model.emit('load', params);\r\n\t\t\t\t}\r\n\t\t\t}, this);\r\n\t\t\tthis.model.on({\r\n\t\t\t\tload : function (params) {\r\n\t\t\t\t\tvar self = this;\r\n\t\t\t\t\tvar cbFn = function () {\r\n\t\t\t\t\t\tself.view.emit('render');\r\n\t\t\t\t\t};\r\n\t\t\t\t\tself.model.load(params, cbFn);\r\n\t\t\t\t}\r\n\t\t\t}, this);\r\n\t\t\tthis.view.on({\r\n\t\t\t\trender : function () {\r\n\t\t\t\t\tvar self = this;\r\n\t\t\t\t\tself.view.render();\r\n\t\t\t\t},\r\n\t\t\t\treloadPager : function () {\r\n\t\t\t\t\tvar self = this;\r\n\t\t\t\t\tself.view.initPager(params);\r\n\t\t\t\t}\r\n\t\t\t}, this);\r\n\t\t}\r\n\t});\r\n\tHualala.Account.AccountQueryShopResultController = AccountQueryShopResultController;\r\n\t\r\n})(jQuery, window);;(function ($, window) {\r\n\tIX.ns(\"Hualala.Account\");\r\n\tvar popoverMsg = Hualala.UI.PopoverMsgTip;\r\n\tvar toptip = Hualala.UI.TopTip;\r\n\tvar BaseAccountModel = Hualala.Account.BaseAccountModel;\r\n\r\n\t/**/\r\n\tvar AccountMgrController = Stapes.subclass({\r\n\t\t/**\r\n\t\t * \r\n\t\t * @param  {Object} cfg {container, settleUnitID, accountModel, mgrView, transaDetailCtrl}\r\n\t\t * @return {Object}     AccountMgrController\r\n\t\t */\r\n\t\tconstructor : function (cfg) {\r\n\t\t\tthis.container = $XP(cfg, 'container', null);\r\n\t\t\tthis.settleUnitID = $XP(cfg, 'settleUnitID', null);\r\n\t\t\tthis.model = $XP(cfg, 'accountModel', null);\r\n\t\t\tthis.view = $XP(cfg, 'mgrView', null);\r\n\t\t\tthis.transaDetailCtrl = $XP(cfg, 'transaDetailCtrl', null);\r\n\t\t\tif (!this.container || !this.model || !this.view || !this.transaDetailCtrl) {\r\n\t\t\t\tthrow(\"Account Detail Mgr Init Failed!!\");\r\n\t\t\t\treturn ;\r\n\t\t\t}\r\n\t\t\tthis.init();\r\n\t\t}\r\n\t});\r\n\tAccountMgrController.proto({\r\n\t\t// \r\n\t\tinit : function () {\r\n\t\t\tvar self = this;\r\n\t\t\tself.bindEvent();\r\n\t\t\tself.model.emit('load', {\r\n\t\t\t\tsettleUnitID : self.settleUnitID,\r\n\t\t\t\tcbFn : function () {\r\n\t\t\t\t\tself.view.emit('init', {\r\n\t\t\t\t\t\tmodel : self.model,\r\n\t\t\t\t\t\tcontainer : self.container\r\n\t\t\t\t\t});\r\n\t\t\t\t\tself.view.emit('render');\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t},\r\n\t\t// \r\n\t\tbindEvent : function () {\r\n\t\t\tthis.on({\r\n\t\t\t\t// \r\n\t\t\t\tquery : function () {\r\n\t\t\t\t\tvar self = this;\r\n\t\t\t\t\t\r\n\t\t\t\t}\r\n\t\t\t}, this);\r\n\t\t\t\r\n\t\t\tthis.view.on({\r\n\t\t\t\tinit : function (params) {\r\n\t\t\t\t\tvar self = this;\r\n\t\t\t\t\tself.view.init(params);\r\n\t\t\t\t\tself.transaDetailCtrl.init({\r\n\t\t\t\t\t\tcontainer : self.container.find('.account-detail-box'),\r\n\t\t\t\t\t\tsettleUnitID : self.settleUnitID\r\n\t\t\t\t\t});\r\n\t\t\t\t},\r\n\t\t\t\trender : function () {\r\n\t\t\t\t\tvar self = this;\r\n\t\t\t\t\tself.view.render();\r\n\t\t\t\t}\r\n\t\t\t}, this);\r\n\t\t}\r\n\t});\r\n\r\n\tHualala.Account.AccountMgrController = AccountMgrController; \r\n\r\n\t/**/\r\n\tvar TransactionDetailController = Stapes.subclass({\r\n\t\tconstructor: function () {\r\n\t\t\tthis.set({\r\n\t\t\t\tsessionData : Hualala.getSessionData()\r\n\t\t\t});\r\n\t\t\tthis.container = null;\r\n\t\t\tthis.settleUnitID = null;\r\n\t\t\tthis.model = new Hualala.Account.AccountTransListModel();\r\n\t\t\tthis.view = new Hualala.Account.AccountTransListView();\r\n\t\t\t\r\n\t\t}\r\n\t});\r\n\tTransactionDetailController.proto({\r\n\t\tinit : function (cfg) {\r\n\t\t\tvar self = this;\r\n\t\t\tself.container = $XP(cfg, 'container', null);\r\n\t\t\tself.settleUnitID = $XP(cfg, 'settleUnitID', '');\r\n\t\t\tif (!this.container || !this.model || !this.view) {\r\n\t\t\t\tthrow(\"Account Transaction Detail Mgr Init Failed!!\");\r\n\t\t\t\treturn ;\r\n\t\t\t}\r\n\t\t\tself.bindEvent();\r\n\t\t\tself.model.init({\r\n\t\t\t\t\r\n\t\t\t\tgroupID : $XP(self.get('sessionData'), 'site.groupID'),\r\n\t\t\t\tsettleUnitID : self.settleUnitID\r\n\t\t\t});\r\n\t\t\tself.model.emit('load', {\r\n\t\t\t\tpageNo : 1, pageSize : 15,\r\n\t\t\t\tcbFn : function (model) {\r\n\t\t\t\t\tself.view.emit('init', {\r\n\t\t\t\t\t\tcontainer : self.container,\r\n\t\t\t\t\t\tmodel : model\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t},\r\n\t\tbindEvent : function () {\r\n\t\t\tthis.model.on({\r\n\t\t\t\tload : function (params) {\r\n\t\t\t\t\tvar self = this;\r\n\t\t\t\t\tvar cbFn = $XP(params, 'cbFn', function () {\r\n\t\t\t\t\t\tself.view.emit('render');\r\n\t\t\t\t\t});\r\n\t\t\t\t\tthis.model.load(params, cbFn);\r\n\t\t\t\t}\r\n\t\t\t}, this);\r\n\t\t\tthis.view.on({\r\n\t\t\t\tinit : function (cfg) {\r\n\t\t\t\t\tthis.view.init(cfg);\r\n\t\t\t\t},\r\n\t\t\t\trender : function () {\r\n\t\t\t\t\tthis.view.render();\r\n\t\t\t\t}\r\n\t\t\t}, this);\r\n\t\t}\r\n\t});\r\n\tHualala.Account.TransactionDetailController = TransactionDetailController;\r\n})(jQuery, window);\r\n;(function ($, window) {\r\n\tIX.ns(\"Hualala.Account\");\r\n\tvar popoverMsg = Hualala.UI.PopoverMsgTip;\r\n\tvar toptip = Hualala.UI.TopTip;\r\n\r\n\tvar AccountActs = [\r\n\t\t{clz : 'btn-success withdraw', act : 'withdraw', label : ''},\r\n\t\t{clz : 'btn-link', act : 'edit', label : ''},\r\n\t\t{clz : 'btn-link', act : 'queryShops', label : ''},\r\n\t\t{clz : 'btn-link', act : 'delete', label : ''}\r\n\t];\r\n\r\n\tvar AccountMgrView = Stapes.subclass({\r\n\t\tconstructor : function () {\r\n\t\t\t// View\r\n\t\t\tthis.$container = null;\r\n\t\t\t// \r\n\t\t\tthis.$nav = null;\r\n\t\t\tthis.breadCrumbs = null;\r\n\t\t\t// schema\r\n\t\t\tthis.$schema = null;\r\n\t\t\t// \r\n\t\t\tthis.$detail = null;\r\n\r\n\t\t\tthis.model = null;\r\n\r\n\t\t\tthis.loadTemplates();\r\n\t\t}\r\n\t});\r\n\r\n\tAccountMgrView.proto({\r\n\t\t/**\r\n\t\t * View\r\n\t\t * \r\n\t\t * @param  {Object} cfg {model, container}\r\n\t\t * @return {[type]}\r\n\t\t */\r\n\t\tinit : function (cfg) {\r\n\t\t\tthis.$container = $XP(cfg, 'container', null);\r\n\t\t\tthis.model = $XP(cfg, 'model', null);\r\n\t\t\tif (!this.$container || !this.model) {\r\n\t\t\t\tthrow(\"Account Detail View Init Failed!\");\r\n\t\t\t\treturn ;\r\n\t\t\t}\r\n\t\t\tthis.initLayout();\r\n\t\t},\r\n\t\tinitLayout : function () {\r\n\t\t\tvar layoutTpl = this.get('layoutTpl');\r\n\t\t\tvar htm = layoutTpl();\r\n\t\t\tthis.$container.html(htm);\r\n\t\t\tthis.$nav = this.$container.find('.account-nav');\r\n\t\t\tthis.$schema = this.$container.find('.account-schema-box');\r\n\t\t\tthis.$detail = this.$container.find('.account-detail-box');\r\n\t\t\tthis.bindEvent();\r\n\t\t},\r\n\t\tinitBreadCrumbs : function () {\r\n\t\t\tvar self = this,\r\n\t\t\t\t$nav = self.$nav,\r\n\t\t\t\tparentNames = Hualala.PageRoute.getParentNamesByPath();\r\n\t\t\tself.breadCrumbs = new Hualala.UI.BreadCrumb({\r\n\t\t\t\tcontainer : $nav,\r\n\t\t\t\thideRoot : true,\r\n\t\t\t\tnodes : parentNames,\r\n\t\t\t\tclz : 'account-crumbs',\r\n\t\t\t\tclickFn : function () {\r\n\t\t\t\t\tvar $this = $(this);\r\n\t\t\t\t\tdocument.location.href = $this.attr('data-href');\r\n\t\t\t\t},\r\n\t\t\t\tmapRenderData : function (data, hideRoot, clz) {\r\n\t\t\t\t\tvar list = _.map(data, function (el, idx, l) {\r\n\t\t\t\t\t\tvar label = $XP(el, 'label', ''),\r\n\t\t\t\t\t\t\tname = $XP(el, 'name', ''),\r\n\t\t\t\t\t\t\tpath = Hualala.PageRoute.createPath(name, [self.model.get('settleUnitID')]);\r\n\t\t\t\t\t\treturn {\r\n\t\t\t\t\t\t\tclz : 'crumb',\r\n\t\t\t\t\t\t\tlabel : label,\r\n\t\t\t\t\t\t\tpath : path,\r\n\t\t\t\t\t\t\tname : name,\r\n\t\t\t\t\t\t\tisLastNode : (data.length - 1 == idx) ? true : false\r\n\t\t\t\t\t\t};\r\n\t\t\t\t\t});\r\n\t\t\t\t\thideRoot === true && list.shift();\r\n\t\t\t\t\treturn {\r\n\t\t\t\t\t\tclz : clz,\r\n\t\t\t\t\t\titems : list\r\n\t\t\t\t\t};\r\n\t\t\t\t}\r\n\r\n\t\t\t});\r\n\r\n\t\t},\r\n\t\tloadTemplates : function () {\r\n\t\t\tvar layoutTpl = Handlebars.compile(Hualala.TplLib.get('tpl_accountMgr_layout')),\r\n\t\t\t\tschemaTpl = Handlebars.compile(Hualala.TplLib.get('tpl_account_schema')),\r\n\t\t\t\twithDrawTpl = Handlebars.compile(Hualala.TplLib.get('tpl_withdraw_form'));\r\n\t\t\t// \r\n\t\t\tHandlebars.registerPartial(\"accountCard\", Hualala.TplLib.get('tpl_account_card'));\r\n\t\t\tthis.set({\r\n\t\t\t\tlayoutTpl : layoutTpl,\r\n\t\t\t\tschemaTpl : schemaTpl,\r\n\t\t\t\twithDrawTpl : withDrawTpl\r\n\t\t\t});\r\n\t\t},\r\n\t\tbindEvent : function () {\r\n\t\t\tvar self = this;\r\n\t\t\tself.$schema.on('click', '.btn.withdraw', function (e) {\r\n\t\t\t\tself.withdraw($(this));\r\n\t\t\t});\r\n\t\t\tself.$schema.on('click', '[data-act]', function (e) {\r\n\t\t\t\tvar act = $(this).attr('data-act');\r\n\t\t\t\tvar $btn = $(this);\r\n\t\t\t\tswitch(act) {\r\n\t\t\t\t\tcase 'edit':\r\n\t\t\t\t\t\tself.editAccount($btn);\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 'queryShops':\r\n\t\t\t\t\t\tself.queryShops();\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 'delete':\r\n\t\t\t\t\t\tself.deleteAccount();\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\t\r\n\t\t\tself.on({\r\n\t\t\t\t'updateSettleBalance' : function (mAccount) {\r\n\t\t\t\t\tvar settleUnitID = mAccount.get('settleUnitID'),\r\n\t\t\t\t\t\tsettleBalance = Hualala.Common.Math.prettyNumeric(mAccount.get('settleBalance'));\r\n\t\t\t\t\tself.$container.find('[data-id=' + settleUnitID + '] .cash > strong').html(settleBalance);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t},\r\n\t\teditAccount : function ($trigger) {\r\n\t\t\tconsole.info('editAccount');\r\n\t\t\t// triggerEl, mode, model, parentView\r\n\t\t\tvar editAccount = new AccountEditView({\r\n\t\t\t\ttriggerEl : $trigger,\r\n\t\t\t\tmode : 'edit',\r\n\t\t\t\tmodel : this.model,\r\n\t\t\t\tparentView : this\r\n\t\t\t});\r\n\t\t},\r\n\t\twithdraw : function ($trigger) {\r\n\t\t\tvar self = this;\r\n\t\t\t// console.info('withdraw');\r\n\t\t\t// \r\n\t\t\tvar modal = new Hualala.Account.WithdrawCashView({\r\n\t\t\t\ttriggerEl : $trigger,\r\n\t\t\t\tsettleUnitID : self.model.get('settleUnitID'),\r\n\t\t\t\tmodel : self.model,\r\n\t\t\t\tparentView : self\r\n\t\t\t});\r\n\t\t},\r\n\t\tqueryShops : function ($trigger) {\r\n\t\t\tvar self = this;\r\n\t\t\tvar modal = new Hualala.Account.AccountQueryShopModal({\r\n\t\t\t\ttriggerEl : $trigger,\r\n\t\t\t\tsettleUnitID : self.model.get('settleUnitID'),\r\n\t\t\t\tmodel : self.model,\r\n\t\t\t\tparentView : self\r\n\t\t\t});\r\n\t\t\tconsole.info('queryShops');\r\n\t\t},\r\n\t\tdeleteAccount : function () {\r\n\t\t\t// console.info('deleteAccount');\r\n\t\t\tvar self = this;\r\n\t\t\tHualala.UI.Confirm({\r\n\t\t\t\ttitle : '',\r\n\t\t\t\tmsg : '',\r\n\t\t\t\tokLabel : '',\r\n\t\t\t\tokFn : function () {\r\n\t\t\t\t\tself.model.emit('delete', {\r\n\t\t\t\t\t\tsuccessFn : function (settleUnitID) {\r\n\t\t\t\t\t\t\tdocument.location.href = Hualala.PageRoute.createPath('account', [settleUnitID]);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\t\r\n\t\t},\r\n\t\tmapRenderData : function () {\r\n\t\t\tvar self = this,\r\n\t\t\t\tmodel = self.model,\r\n\t\t\t\tacts = AccountActs,\r\n\t\t\t\tacts1 = _.filter(IX.clone(acts), function (el) {\r\n\t\t\t\t\treturn $XP(el, 'act') != 'withdraw';\r\n\t\t\t\t}),\r\n\t\t\t\taccountCard = null;\r\n\t\t\tvar settleUnitID = model.get('settleUnitID') || '',\r\n\t\t\t\thasDefault = model.get('defaultAccount') == 0 ? false : true,\r\n\t\t\t\tbankInfo = Hualala.Common.mapBankInfo(model.get('bankCode')),\r\n\t\t\t\tbankAccountStr = Hualala.Common.codeMask((model.get('bankAccount') || ''), 0, -4);\r\n\r\n\t\t\taccountCard = {\r\n\t\t\t\tclz : 'pull-left',\r\n\t\t\t\tsettleUnitID : settleUnitID,\r\n\t\t\t\thasDefault : hasDefault,\r\n\t\t\t\tsettleUnitName : model.get('settleUnitName') || '',\r\n\t\t\t\tsettleBalance : parseFloat(model.get('settleBalance') || 0),\r\n\t\t\t\tbankIcon : $XP(bankInfo, 'icon_16', ''),\r\n\t\t\t\tbankComName : $XP(bankInfo, 'name', ''),\r\n\t\t\t\tbankAccountStr : $XP(bankAccountStr, 'val', '').replace(/([\\w|*]{4})/g, '$1 ').replace(/([*])/g, '<span>$1</span>'),\r\n\t\t\t\tshopCount : parseInt(model.get('shopCount') || 0),\r\n\t\t\t\tpath : Hualala.PageRoute.createPath('accountDetail', [settleUnitID]),\r\n\t\t\t\tisDetail : true,\r\n\t\t\t\tacts : IX.map(acts1, function (el, i) {\r\n\t\t\t\t\treturn IX.inherit(el, {\r\n\t\t\t\t\t\tisFirst : i == 0 ? true : false\r\n\t\t\t\t\t});\r\n\t\t\t\t})\r\n\t\t\t};\r\n\t\t\treturn {\r\n\t\t\t\taccountCard : accountCard,\r\n\t\t\t\tacts : _.map(acts, function (el) {\r\n\t\t\t\t\tif ($XP(el, 'act') == 'queryShops') {\r\n\t\t\t\t\t\treturn IX.inherit(el, {\r\n\t\t\t\t\t\t\tlabel : $XP(el, 'label', '') + '(' + parseInt(model.get('shopCount') || 0) + ')'\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn el;\r\n\t\t\t\t})\r\n\t\t\t};\r\n\t\t},\r\n\t\trender : function () {\r\n\t\t\tvar self = this,\r\n\t\t\t\tmodel = self.model,\r\n\t\t\t\trenderData = self.mapRenderData(),\r\n\t\t\t\ttpl = self.get('schemaTpl');\r\n\t\t\tvar htm = tpl(renderData);\r\n\t\t\tself.initBreadCrumbs();\r\n\t\t\tself.$schema.html(htm);\r\n\t\t},\r\n\t\trefresh : function () {\r\n\t\t\tthis.render();\r\n\t\t}\r\n\t});\r\n\t\r\n\tHualala.Account.AccountMgrView = AccountMgrView; \r\n\r\n\r\n\t// \r\n\tvar AccountEditFormElsCfg = {\r\n\t\treceiverType : {\r\n\t\t\ttype : \"radiogrp\",\r\n\t\t\tlabel : \"\",\r\n\t\t\tdefaultVal : 2,\r\n\t\t\toptions : Hualala.TypeDef.AccountReceiverTypes,\r\n\t\t\tvalidCfg : {\r\n\t\t\t\tvalidators : {}\r\n\t\t\t}\r\n\t\t},\r\n\t\treceiverName : {\r\n\t\t\ttype : \"text\",\r\n\t\t\tlabel : \"/\",\r\n\t\t\tdefaultVal : \"\",\r\n\t\t\tvalidCfg : {\r\n\t\t\t\tvalidators : {\r\n\t\t\t\t\tnotEmpty : {\r\n\t\t\t\t\t\tmessage : \"/\"\r\n\t\t\t\t\t},\r\n\t\t\t\t\tstringLength : {\r\n\t\t\t\t\t\tmax : 20,\r\n\t\t\t\t\t\tmessage : \"/20\"\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\tsettleUnitName : {\r\n\t\t\ttype : \"text\",\r\n\t\t\tlabel : \"\",\r\n\t\t\tdefaultVal : \"\",\r\n\t\t\tvalidCfg : {\r\n\t\t\t\tvalidators : {\r\n\t\t\t\t\tnotEmpty : {\r\n\t\t\t\t\t\tmessage : \"\"\r\n\t\t\t\t\t},\r\n\t\t\t\t\tstringLength : {\r\n\t\t\t\t\t\tmax : 50,\r\n\t\t\t\t\t\tmessage : \"50\"\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\tbankAccount : {\r\n\t\t\ttype : \"text\",\r\n\t\t\tlabel : \"\",\r\n\t\t\tdefaultVal : \"\",\r\n\t\t\tvalidCfg : {\r\n\t\t\t\tvalidators : {\r\n\t\t\t\t\tnotEmpty : {\r\n\t\t\t\t\t\tmessage : \"\"\r\n\t\t\t\t\t},\r\n\t\t\t\t\tstringLength : {\r\n\t\t\t\t\t\tmax : 30,\r\n\t\t\t\t\t\tmessage : \"30\"\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\tbankCode : {\r\n\t\t\ttype : \"combo\",\r\n\t\t\tlabel : \"\",\r\n\t\t\tdefaultVal : \"CMB\",\r\n\t\t\toptions : Hualala.TypeDef.BankOptions,\r\n\t\t\tvalidCfg : {\r\n\t\t\t\tvalidators : {\r\n\t\t\t\t\tnotEmpty : {\r\n\t\t\t\t\t\tmessage : \"\"\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\tbankName : {\r\n\t\t\ttype : \"text\",\r\n\t\t\tlabel : \"\",\r\n\t\t\tdefaultVal : \"\",\r\n\t\t\tprefix : '<span class=\"icon-CMB-16\"></span>',\r\n\t\t\tvalidCfg : {\r\n\t\t\t\tvalidators : {\r\n\t\t\t\t\tnotEmpty : {\r\n\t\t\t\t\t\tmessage : \"\"\r\n\t\t\t\t\t},\r\n\t\t\t\t\tstringLength : {\r\n\t\t\t\t\t\tmax : 40,\r\n\t\t\t\t\t\tmessage : \"40\"\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\tremark : {\r\n\t\t\ttype : \"text\",\r\n\t\t\tlabel : \"\",\r\n\t\t\tdefaultVal : \"\",\r\n\t\t\tvalidCfg : {\r\n\t\t\t\tvalidators : {\r\n\t\t\t\t\tstringLength : {\r\n\t\t\t\t\t\tmax : 250,\r\n\t\t\t\t\t\tmessage : \"250\"\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\tdefaultAccount : {\r\n\t\t\ttype : \"switcher\",\r\n\t\t\tlabel : \"\",\r\n\t\t\tdefaultVal : 1,\r\n\t\t\tonLabel : \"\",\r\n\t\t\toffLabel : \"\",\r\n\t\t\tvalidCfg : {\r\n\t\t\t\tvalidators : {}\r\n\t\t\t}\r\n\t\t},\r\n\t\treceiverLinkman : {\r\n\t\t\ttype : \"text\",\r\n\t\t\tlabel : \"\",\r\n\t\t\tdefaultVal : \"\",\r\n\t\t\tprefix : '<span class=\"glyphicon glyphicon-user\"></span>',\r\n\t\t\tvalidCfg : {\r\n\t\t\t\tvalidators : {\r\n\t\t\t\t\tnotEmpty : {\r\n\t\t\t\t\t\tmessage : \"\"\r\n\t\t\t\t\t},\r\n\t\t\t\t\tstringLength : {\r\n\t\t\t\t\t\tmax : 20,\r\n\t\t\t\t\t\tmessage : \"20\"\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\treceiverMobile : {\r\n\t\t\ttype : \"text\",\r\n\t\t\tlabel : \"\",\r\n\t\t\tdefaultVal : \"\",\r\n\t\t\tprefix : '<span class=\"glyphicon glyphicon-phone\"></span>',\r\n\t\t\tvalidCfg : {\r\n\t\t\t\tvalidators : {\r\n\t\t\t\t\tnotEmpty : {\r\n\t\t\t\t\t\tmessage : \"\"\r\n\t\t\t\t\t},\r\n\t\t\t\t\tstringLength : {\r\n\t\t\t\t\t\tmax : 30,\r\n\t\t\t\t\t\tmessage : \"30\"\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\treceiverEmail : {\r\n\t\t\ttype : \"text\",\r\n\t\t\tlabel : \"\",\r\n\t\t\tdefaultVal : \"\",\r\n\t\t\tprefix : '<span class=\"glyphicon glyphicon-envelope\"></span>',\r\n\t\t\tvalidCfg : {\r\n\t\t\t\tvalidators : {\r\n\t\t\t\t\tstringLength : {\r\n\t\t\t\t\t\tmax : 50,\r\n\t\t\t\t\t\tmessage : \"30\"\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n\tvar AccountEditFormElsHT = new IX.IListManager();\r\n\t_.each(AccountEditFormElsCfg, function (el, k) {\r\n\t\tvar type = $XP(el, 'type');\r\n\t\tvar labelClz = 'col-sm-offset-1 col-sm-3 control-label';\r\n\t\tif (type == 'radiogrp') {\r\n\t\t\tvar ops = _.map($XP(el, 'options'), function (op) {\r\n\t\t\t\treturn IX.inherit(op, {\r\n\t\t\t\t\tid : k + '_' + IX.id(),\r\n\t\t\t\t\tname : k,\r\n\t\t\t\t\tclz : 'col-sm-6'\r\n\t\t\t\t});\r\n\t\t\t});\r\n\t\t\tAccountEditFormElsHT.register(k, IX.inherit(el, {\r\n\t\t\t\tid : '',\r\n\t\t\t\toptions : ops,\r\n\t\t\t\tlabelClz : labelClz,\r\n\t\t\t\tclz : 'col-sm-5'\r\n\t\t\t}));\r\n\t\t} else {\r\n\t\t\tAccountEditFormElsHT.register(k, IX.inherit(el, {\r\n\t\t\t\tid : k + '_' + IX.id(),\r\n\t\t\t\tname : k,\r\n\t\t\t\tlabelClz : labelClz,\r\n\t\t\t\tclz : 'col-sm-5'\r\n\t\t\t}));\r\n\t\t}\r\n\t\t\r\n\t});\r\n\t\r\n\t// \r\n\tvar AccountEditView = Stapes.subclass({\r\n\t\t/**\r\n\t\t * \r\n\t\t * @param  {Object} cfg {triggerEl, mode, model, parentView}\r\n\t\t * \t\t\t\t@param {jQueryObj} triggerEl \r\n\t\t * \t\t\t\t@param {String} mode  add:edit:; read:\r\n\t\t * \t\t\t\t@param {Object} model \r\n\t\t * \t\t\t\t@param {Object} parentView View\r\n\t\t * @return {Object}\t\t\r\n\t\t */\r\n\t\tconstructor : function (cfg) {\r\n\t\t\tthis.$trigger = $XP(cfg, 'trigger', null);\r\n\t\t\tthis.mode = $XP(cfg, 'mode', 'edit');\r\n\t\t\tthis.model = $XP(cfg, 'model', null) || new Hualala.Account.BaseAccountModel();\r\n\t\t\tthis.parentView = $XP(cfg, 'parentView', null);\r\n\t\t\tthis.modal = null;\r\n\t\t\tthis.formKeys = 'receiverType,receiverName,settleUnitName,bankAccount,bankCode,bankName,remark,defaultAccount,receiverLinkman,receiverMobile,receiverEmail'.split(',');\r\n\t\t\tthis.loadTemplates();\r\n\t\t\tthis.initModal();\r\n\t\t\tthis.renderForm();\r\n\t\t\tthis.bindEvent();\r\n\t\t\tthis.emit('show');\r\n\t\t}\r\n\t});\r\n\tAccountEditView.proto({\r\n\t\tloadTemplates : function () {\r\n\t\t\tvar layoutTpl = Handlebars.compile(Hualala.TplLib.get('tpl_account_edit')),\r\n\t\t\t\tbtnTpl = Handlebars.compile(Hualala.TplLib.get('tpl_shop_modal_btns'));\r\n\t\t\tHandlebars.registerHelper('checkFormElementType', function (conditional, options) {\r\n\t\t\t\treturn (conditional == options.hash.type) ? options.fn(this) : options.inverse(this);\r\n\t\t\t});\r\n\t\t\tHandlebars.registerHelper('isInputGroup', function (prefix, surfix, options) {\r\n\t\t\t\treturn (!prefix && !surfix) ? options.inverse(this) : options.fn(this);\r\n\t\t\t});\r\n\t\t\tthis.set({\r\n\t\t\t\tlayoutTpl : layoutTpl,\r\n\t\t\t\tbtnTpl : btnTpl\r\n\t\t\t});\r\n\t\t},\r\n\t\tgetModalTitle : function () {\r\n\t\t\treturn (this.mode == 'edit' ?  '' : '') + '';\r\n\t\t},\r\n\t\tinitModal : function () {\r\n\t\t\tvar self = this;\r\n\t\t\tself.modal = new Hualala.UI.ModalDialog({\r\n\t\t\t\tid : 'account_edit',\r\n\t\t\t\tclz : 'account-modal',\r\n\t\t\t\ttitle : self.getModalTitle(),\r\n\t\t\t\tafterRemove : function () {\r\n\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t},\r\n\t\tmapFormElsData : function () {\r\n\t\t\tvar self = this,\r\n\t\t\t\tformKeys = self.formKeys;\r\n\t\t\tvar formEls = _.map(formKeys, function (key) {\r\n\t\t\t\tvar elCfg = AccountEditFormElsHT.get(key),\r\n\t\t\t\t\ttype = $XP(elCfg, 'type');\r\n\t\t\t\tif (type == 'combo') {\r\n\t\t\t\t\tvar v = self.model.get(key) || $XP(elCfg, 'defaultVal'),\r\n\t\t\t\t\t\toptions = _.map($XP(elCfg, 'options'), function (op) {\r\n\t\t\t\t\t\t\treturn IX.inherit(op, {\r\n\t\t\t\t\t\t\t\tselected : $XP(op, 'value') == v ? 'selected' : ''\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\treturn IX.inherit(elCfg, {\r\n\t\t\t\t\t\tvalue : v,\r\n\t\t\t\t\t\toptions : options\r\n\t\t\t\t\t});\r\n\t\t\t\t} else if (type == 'radiogrp') {\r\n\t\t\t\t\tvar v = self.model.get(key) || $XP(elCfg, 'defaultVal'),\r\n\t\t\t\t\t\toptions = _.map($XP(elCfg, 'options'), function (op) {\r\n\t\t\t\t\t\t\treturn IX.inherit(op, {\r\n\t\t\t\t\t\t\t\tchecked : $XP(op, 'value') == v ? 'checked' : ''\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\treturn IX.inherit(elCfg, {\r\n\t\t\t\t\t\tvalue : v,\r\n\t\t\t\t\t\toptions : options\r\n\t\t\t\t\t});\r\n\t\t\t\t} else if (type == 'switcher') {\r\n\t\t\t\t\treturn IX.inherit(elCfg, {\r\n\t\t\t\t\t\tchecked : self.model.get(key) == $XP(elCfg, 'defaultVal') ? 'checked' : ''\r\n\t\t\t\t\t});\r\n\t\t\t\t} else {\r\n\t\t\t\t\treturn IX.inherit(elCfg, {\r\n\t\t\t\t\t\tvalue : self.model.get(key) || $XP(elCfg, 'defaultVal')\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\treturn formEls;\r\n\t\t},\r\n\t\trenderForm : function () {\r\n\t\t\tvar self = this,\r\n\t\t\t\trenderData = self.mapFormElsData(),\r\n\t\t\t\ttpl = self.get('layoutTpl'),\r\n\t\t\t\tbtnTpl = self.get('btnTpl'),\r\n\t\t\t\thtm = tpl({\r\n\t\t\t\t\tformClz : 'account-form',\r\n\t\t\t\t\titems : renderData\r\n\t\t\t\t});\r\n\t\t\tself.modal._.body.html(htm);\r\n\t\t\tself.modal._.footer.html(btnTpl({\r\n\t\t\t\tbtns : [\r\n\t\t\t\t\t{clz : 'btn-default', name : 'cancel', label : ''},\r\n\t\t\t\t\t{clz : 'btn-warning', name : 'submit', label : self.mode == 'edit' ? '' : ''}\r\n\t\t\t\t]\r\n\t\t\t}));\r\n\r\n\t\t\tself.initSwitcher(':checkbox[data-type=switcher]');\r\n\t\t},\r\n\t\tinitValidFieldOpts : function () {\r\n\t\t\tvar self = this,\r\n\t\t\t\tformKeys = self.formKeys,\r\n\t\t\t\tret = {};\r\n\t\t\t_.each(formKeys, function (key) {\r\n\t\t\t\tvar elCfg = AccountEditFormElsHT.get(key),\r\n\t\t\t\t\ttype = $XP(elCfg, 'type');\r\n\t\t\t\tif (type == 'section') {\r\n\t\t\t\t\tvar min = key + '_min', max = key + '_max';\r\n\t\t\t\t\tret[min] = $XP(elCfg, 'min.validCfg', {});\r\n\t\t\t\t\tret[max] = $XP(elCfg, 'max.validCfg', {});\r\n\t\t\t\t} else {\r\n\t\t\t\t\tret[key] = $XP(elCfg, 'validCfg', {});\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\treturn ret;\r\n\t\t},\r\n\t\tbindEvent : function () {\r\n\t\t\tvar self = this;\r\n\t\t\tvar fvOpts = self.initValidFieldOpts();\r\n\t\t\tthis.on({\r\n\t\t\t\tshow : function () {\r\n\t\t\t\t\tthis.modal.show();\r\n\t\t\t\t},\r\n\t\t\t\thide : function () {\r\n\t\t\t\t\tthis.modal.hide();\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\tself.modal._.dialog.find('.btn').on('click', function (e) {\r\n\t\t\t\tvar $btn = $(this),\r\n\t\t\t\t\tact = $btn.attr('name');\r\n\t\t\t\tif (act == 'cancel') {\r\n\t\t\t\t\tself.emit('hide');\r\n\t\t\t\t} else {\r\n\t\t\t\t\tvar bv = self.modal._.body.find('form').data('bootstrapValidator');\r\n\t\t\t\t\t$btn.button('...');\r\n\t\t\t\t\tbv.validate();\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\tself.modal._.body.find('form').bootstrapValidator({\r\n\t\t\t\ttrigger : 'blur',\r\n\t\t\t\tfields : fvOpts\r\n\t\t\t}).on('error.field.bv', function (e, data) {\r\n\t\t\t\tvar $form = $(e.target),\r\n\t\t\t\t\tbv = $form.data('bootstrapValidator');\r\n\t\t\t}).on('success.form.bv', function (e, data) {\r\n\t\t\t\te.preventDefault();\r\n\t\t\t\tvar $form = $(e.target),\r\n\t\t\t\t\tbv = $form.data('bootstrapValidator');\r\n\t\t\t\tvar formParams = self.serializeForm();\r\n\t\t\t\tconsole.info(formParams);\r\n\t\t\t\tself.model.emit(self.mode, {\r\n\t\t\t\t\tparams : formParams,\r\n\t\t\t\t\tfailFn : function () {\r\n\t\t\t\t\t\tself.modal._.footer.find('.btn[name=submit]').button('reset');\r\n\t\t\t\t\t},\r\n\t\t\t\t\tsuccessFn : function () {\r\n\t\t\t\t\t\tself.modal._.footer.find('.btn[name=submit]').button('reset');\r\n\t\t\t\t\t\tself.parentView && IX.isFn(self.parentView.refresh) && self.parentView.refresh();\r\n\t\t\t\t\t\tself.emit('hide');\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t});\r\n\t\t},\r\n\t\tinitSwitcher : function (selector) {\r\n\t\t\tvar self = this;\r\n\t\t\tself.modal._.body.find(selector).each(function () {\r\n\t\t\t\tvar $el = $(this),\r\n\t\t\t\t\tonLabel = $el.attr('data-onLabel'),\r\n\t\t\t\t\toffLabel = $el.attr('data-offLabel');\r\n\t\t\t\t$el.bootstrapSwitch({\r\n\t\t\t\t\tsize : 'normal',\r\n\t\t\t\t\tonColor : 'primary',\r\n\t\t\t\t\toffColor : 'default',\r\n\t\t\t\t\tonText : onLabel,\r\n\t\t\t\t\toffText : offLabel\r\n\t\t\t\t});\r\n\t\t\t});\r\n\t\t},\r\n\t\tserializeForm : function () {\r\n\t\t\tvar self = this,\r\n\t\t\t\tformKeys = self.formKeys,\r\n\t\t\t\tret = {},\r\n\t\t\t\tformEls = _.map(formKeys, function (key) {\r\n\t\t\t\t\tvar elCfg = AccountEditFormElsHT.get(key),\r\n\t\t\t\t\t\ttype = $XP(elCfg, 'type');\r\n\t\t\t\t\tif (type == 'switcher') {\r\n\t\t\t\t\t\t// ret[key] = $('[name=' + key + ']').attr('checked') ? 1 : 0;\r\n\t\t\t\t\t\tret[key] = !$('[name=' + key + ']').data('bootstrapSwitch').options.state ? 0 : 1;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tret[key] = $('[name=' + key + ']').val();\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\treturn ret;\r\n\t\t}\r\n\t});\r\n\r\n\tHualala.Account.AccountEditView = AccountEditView;\r\n\r\n\tvar AccountQueryShopModal = Stapes.subclass({\r\n\t\tconstructor : function (cfg) {\r\n\t\t\tthis.$trigger = $XP(cfg, 'trigger', null);\r\n\t\t\tthis.model = $XP(cfg, 'model', null);\r\n\t\t\tthis.parentView = $XP(cfg, 'parentView', null);\r\n\t\t\tthis.modal = null;\r\n\t\t\tthis.$queryBox = null;\r\n\t\t\tthis.$resultBox = null;\r\n\t\t\tthis.queryCtrl = null;\r\n\t\t\tthis.set({\r\n\t\t\t\tsettleUnitID : this.model.get('settleUnitID'),\r\n\t\t\t\tsettleName : this.model.get('settleUnitName'),\r\n\t\t\t\tshopCount : this.model.get('shopCount'),\r\n\t\t\t});\r\n\r\n\t\t\tthis.loadTemplates();\r\n\t\t\tthis.initModal();\r\n\t\t\tthis.render();\r\n\t\t\tthis.bindEvent();\r\n\t\t\tthis.initQueryBox();\r\n\t\t\tthis.emit('show');\r\n\t\t}\r\n\t});\r\n\tAccountQueryShopModal.proto({\r\n\t\tloadTemplates : function () {\r\n\t\t\tvar layoutTpl = Handlebars.compile(Hualala.TplLib.get('tpl_account_query_shop')),\r\n\t\t\t\tbtnTpl = Handlebars.compile(Hualala.TplLib.get('tpl_shop_modal_btns'));\r\n\t\t\t\r\n\t\t\tthis.set({\r\n\t\t\t\tlayoutTpl : layoutTpl,\r\n\t\t\t\tbtnTpl : btnTpl\r\n\t\t\t});\r\n\t\t},\r\n\t\tinitModal : function () {\r\n\t\t\tvar self = this;\r\n\t\t\tself.modal = new Hualala.UI.ModalDialog({\r\n\t\t\t\tid : 'account_query_shop',\r\n\t\t\t\tclz : 'account-modal',\r\n\t\t\t\ttitle : \"\",\r\n\t\t\t\tafterRemove : function () {\r\n\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t},\r\n\t\trender : function () {\r\n\t\t\tvar self = this,\r\n\t\t\t\tlayoutTpl = self.get('layoutTpl'),\r\n\t\t\t\tbtnTpl = self.get('btnTpl');\r\n\t\t\tvar settleUnitName = self.model.get('settleUnitName') || '',\r\n\t\t\t\tbtns = [{clz : 'btn-default', name : 'cancel', label : ''}];\r\n\t\t\tvar htm = layoutTpl({\r\n\t\t\t\tclz : '',\r\n\t\t\t\ttitle : settleUnitName,\r\n\t\t\t\tlabel : \"\"\r\n\t\t\t});\r\n\t\t\tself.modal._.body.html(htm);\r\n\t\t\tself.modal._.footer.html(btnTpl({\r\n\t\t\t\tbtns : btns\r\n\t\t\t}));\r\n\t\t\tself.$queryBox = self.modal._.body.find('.query-box');\r\n\t\t\tself.$resultBox = self.modal._.body.find('.result-box');\r\n\t\t},\r\n\t\tbindEvent : function () {\r\n\t\t\tvar self = this;\r\n\t\t\tthis.on({\r\n\t\t\t\t\"show\" : function () {\r\n\t\t\t\t\tself.modal.show();\r\n\t\t\t\t},\r\n\t\t\t\t\"hide\" : function () {\r\n\t\t\t\t\tself.modal.hide();\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\tself.modal._.dialog.find('.btn').on('click', function (e) {\r\n\t\t\t\tvar $btn = $(this),\r\n\t\t\t\t\tact = $btn.attr('name');\r\n\t\t\t\tif (act == 'cancel') {\r\n\t\t\t\t\tself.emit('hide');\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t},\r\n\t\tinitQueryBox : function () {\r\n\t\t\tvar self = this;\r\n\t\t\tself.queryCtrl = new Hualala.Account.AccountQueryShopController({\r\n\t\t\t\tcontainer : self.$queryBox,\r\n\t\t\t\tresultContainer : self.$resultBox,\r\n\t\t\t\tsettleUnitID : self.get('settleUnitID'),\r\n\t\t\t\tsettleName : self.get('settleName'),\r\n\t\t\t\tshopCount : self.get('shopCount')\r\n\t\t\t\t// resultController : new Hualala.Account.AccountQueryShopResultController({\r\n\t\t\t\t// \tcontainer : self.$resultBox,\r\n\t\t\t\t// \tmodel : new Hualala.Account.AccountQueryShopResultModel(),\r\n\t\t\t\t// \tview : new Hualala.Account.AccountQueryShopResultView()\r\n\t\t\t\t// })\r\n\t\t\t});\r\n\t\t}\r\n\t});\r\n\tHualala.Account.AccountQueryShopModal = AccountQueryShopModal;\r\n\r\n\t// \r\n\tvar PersonUnit = Hualala.Constants.PersonUnit,\r\n\t\tCashUnit = Hualala.Constants.CashUnit;\r\n\tvar getOrderSubTypeLabel = function (orderSubType) {\r\n\t\tif (IX.isEmpty(orderSubType)) return '';\r\n\t\tvar l = Hualala.TypeDef.ShopBusiness;\r\n\t\tvar m = _.find(l, function (el) {\r\n\t\t\tvar id = $XP(el, 'id');\r\n\t\t\treturn id == orderSubType;\r\n\t\t});\r\n\t\tif (!m) return '';\r\n\t\treturn $XP(m, 'label', '');\r\n\t};\r\n\tvar getGenderLabel = function (v) {\r\n\t\tif (IX.isEmpty(v)) return '';\r\n\t\tvar l = Hualala.TypeDef.GENDER;\r\n\t\tvar m = _.find(l, function (el) {\r\n\t\t\tvar id = $XP(el, 'value');\r\n\t\t\treturn id == v;\r\n\t\t});\r\n\t\tif (!m) return '';\r\n\t\treturn $XP(m, 'label', '');\r\n\t};\r\n\tvar mapUserFields = function (cfg, data) {\r\n\t\tvar label = $XP(cfg, 'label', ''), fieldType = $XP(cfg, 'fieldType', ''), fields = $XP(cfg, 'fields', []);\r\n\t\tvar userSex = $XP(data, 'userSex', '');\r\n\t\tuserSex = IX.isEmpty(userSex) ? '' : '(' + getGenderLabel(userSex) + ')';\r\n\t\tvar _fields = _.map(fields, function (key) {\r\n\t\t\tvar fieldLabelCfg = OrderPayFieldLabelLib[key], label = $XP(fieldLabelCfg, 'label', ''),\r\n\t\t\t\tunit = $XP(fieldLabelCfg, 'unit', ''), clz = $XP(fieldLabelCfg, 'clz', '');\r\n\t\t\tvar value = $XP(data, key, '');\r\n\t\t\tvalue += (key == 'userName') ? userSex : '';\r\n\t\t\tvalue += unit;\r\n\t\t\treturn {\r\n\t\t\t\tkey : key,\r\n\t\t\t\tclz : clz,\r\n\t\t\t\tlabel : label,\r\n\t\t\t\tvalue : value\r\n\t\t\t};\r\n\t\t});\r\n\t\treturn {\r\n\t\t\tlabel : label,\r\n\t\t\tfieldType : fieldType,\r\n\t\t\tfields : _fields\r\n\t\t};\r\n\t};\r\n\tvar mapOrderFields = function (cfg, data) {\r\n\t\tvar label = $XP(cfg, 'label', ''), fieldType = $XP(cfg, 'fieldType', ''), fields = $XP(cfg, 'fields', []);\r\n\t\tvar orderSubType = $XP(data, 'orderSubType', ''),\r\n\t\t\torderSubTypeLabel = getOrderSubTypeLabel(orderSubType);\r\n\t\torderSubTypeLabel = IX.isEmpty(orderSubTypeLabel) ? '' : '(' + orderSubTypeLabel + ')';\r\n\t\tvar _fields = _.map(fields, function (key) {\r\n\t\t\tvar fieldLabelCfg = OrderPayFieldLabelLib[key], label = $XP(fieldLabelCfg, 'label', ''),\r\n\t\t\t\tunit = $XP(fieldLabelCfg, 'unit', ''), clz = $XP(fieldLabelCfg, 'clz', '');\r\n\t\t\tvar value = $XP(data, key, '');\r\n\t\t\tswitch(key) {\r\n\t\t\t\tcase 'timeName':\r\n\t\t\t\tcase 'consumptionTypeName' :\r\n\t\t\t\tcase 'promotionDesc' :\r\n\t\t\t\tcase 'orderRemark':\r\n\t\t\t\t\tclz += IX.isEmpty(value) ? ' hidden' : '';\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'orderTime':\r\n\t\t\t\tcase 'orderCreateTime':\r\n\t\t\t\t\tvalue = IX.Date.getDateByFormat(Hualala.Common.formatDateTimeValue(value), 'yyyy/MM/dd HH:mm');\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'statusName':\r\n\t\t\t\t\tvar isAlreadyPaid = $XP(data, 'isAlreadyPaid', 0),\r\n\t\t\t\t\t\torderStatus = $XP(data, 'orderStatus', '');\r\n\t\t\t\t\tvar surfix = '';\r\n\t\t\t\t\tif (orderStatus >= 20 && isAlreadyPaid == 1) {\r\n\t\t\t\t\t\tsurfix = \"<span></span>\";\r\n\t\t\t\t\t} else if (orderStatus >= 20 && isAlreadyPaid == 0) {\r\n\t\t\t\t\t\tsurfix = '<span color=\"red\">' + (orderStatus == 20 ? \"\" : \"\") + \"</span>\";\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tsurfix = \"<span></span>\";\r\n\t\t\t\t\t}\r\n\t\t\t\t\tsurfix = '(' + surfix + ')';\r\n\t\t\t\t\tvalue = value + surfix;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'takeoutAddress' :\r\n\t\t\t\t\tclz += orderSubType == 20 || orderSubType == 21 ? '' : ' hidden';\r\n\t\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t\tvalue += unit;\r\n\t\t\treturn {\r\n\t\t\t\tkey : key,\r\n\t\t\t\tclz : clz,\r\n\t\t\t\tlabel : label,\r\n\t\t\t\tvalue : value\r\n\t\t\t};\r\n\t\t});\r\n\t\treturn {\r\n\t\t\tlabel : label,\r\n\t\t\torderSubTypeLabel : orderSubTypeLabel,\r\n\t\t\tfieldType : fieldType,\r\n\t\t\tfields : _fields\r\n\t\t};\r\n\t};\r\n\tvar mapPayFields = function (cfg, data) {\r\n\t\tvar label = $XP(cfg, 'label', ''), fieldType = $XP(cfg, 'fieldType', ''), fields = $XP(cfg, 'fields', []);\r\n\t\tvar orderSubType = $XP(data, 'orderSubType', '');\r\n\t\tvar _fields = _.map(fields, function (key) {\r\n\t\t\tvar fieldLabelCfg = OrderPayFieldLabelLib[key], label = $XP(fieldLabelCfg, 'label', ''),\r\n\t\t\t\tunit = $XP(fieldLabelCfg, 'unit', ''), clz = $XP(fieldLabelCfg, 'clz', '');\r\n\t\t\tvar value = $XP(data, key, '');\r\n\t\t\tswitch(key) {\r\n\t\t\t\tcase 'serviceAmount':\r\n\t\t\t\tcase 'discountAmount':\r\n\t\t\t\tcase 'freeAmount':\r\n\t\t\t\tcase 'giftAmount':\r\n\t\t\t\tcase 'cardDiscountAmount':\r\n\t\t\t\tcase 'pointBalance':\r\n\t\t\t\tcase 'moneyBalance':\r\n\t\t\t\tcase 'orderRefundAmount':\r\n\t\t\t\t\tclz += value == 0 ? ' hidden' : '';\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'presentInfo':\r\n\t\t\t\t\tclz += IX.isEmpty(value) ? ' hidden' : '';\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'takeoutPackagingAmount':\r\n\t\t\t\t\tclz += orderSubType == 20 || orderSubType == 21 ? '' : ' hidden';\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t}\r\n\t\t\tvalue += unit;\r\n\t\t\treturn {\r\n\t\t\t\tkey : key,\r\n\t\t\t\tclz : clz,\r\n\t\t\t\tlabel : label,\r\n\t\t\t\tvalue : value\r\n\t\t\t};\r\n\t\t});\r\n\t\treturn {\r\n\t\t\tlabel : label,\r\n\t\t\tfieldType : fieldType,\r\n\t\t\tfields : _fields\r\n\t\t};\r\n\t};\r\n\tvar mapFoodsFields = function (cfg, data) {\r\n\t\tvar label = $XP(cfg, 'label', ''), fieldType = $XP(cfg, 'fieldType', ''), fields = $XP(cfg, 'fields', []);\r\n\t\tvar dishes = $XP(data, 'records', []),\r\n\t\t\tcategories = _.groupBy(dishes, function (dish) {return $XP(dish, 'foodCategoryID');});\r\n\t\tcategories = _.map(categories, function (cate, key) {\r\n\t\t\tvar foodCategoryName = '';\r\n\t\t\tvar foodCategorySum = cate.length;\r\n\t\t\tvar _dishes = _.map(cate, function (dish) {\r\n\t\t\t\tvar _dish = {};\r\n\t\t\t\t_.each(fields, function (k) {\r\n\t\t\t\t\tvar v = $XP(dish, k, ''),\r\n\t\t\t\t\t\tunit = !IX.isEmpty(OrderPayFieldLabelLib[k]) && !IX.isEmpty(OrderPayFieldLabelLib[k]['unit']) ?\r\n\t\t\t\t\t\t\tOrderPayFieldLabelLib[k]['unit'] : '';\r\n\t\t\t\t\tif (k == 'foodCategoryName') {\r\n\t\t\t\t\t\tfoodCategoryName = v;\r\n\t\t\t\t\t}\r\n\t\t\t\t\t\r\n\t\t\t\t\t_dish[k] = v + unit;\r\n\t\t\t\t});\r\n\t\t\t\treturn _dish;\r\n\t\t\t});\r\n\t\t\treturn {\r\n\t\t\t\tfoodCategoryName : foodCategoryName,\r\n\t\t\t\tfoodCategorySum : '(' + foodCategorySum + ')',\r\n\t\t\t\tfoodCategoryID : key,\r\n\t\t\t\trows : _dishes\r\n\t\t\t}\r\n\t\t});\r\n\t\t\r\n\t\treturn {\r\n\t\t\tfieldType : fieldType,\r\n\t\t\tlabel : label,\r\n\t\t\tcategories : categories\r\n\t\t};\r\n\t};\r\n\tvar OrderPayFieldLabelLib = {\r\n\t\t\"userName\" : {label : \"\", clz : \"col-xs-6\"},\r\n\t\t\"userLoginMobile\" : {label : \"\", clz : \"col-xs-6\"},\r\n\t\t\"orderID\" : {label : \"\", clz : \"col-xs-6\"},\r\n\t\t\"orderCheckPWD\" : {label : \"\", clz : \"col-xs-6\"},\r\n\t\t\"person\" : {label : \"\", unit : PersonUnit, clz : \"col-xs-6\"},\r\n\t\t\"timeName\" : {label : \"\", clz : \"col-xs-6\"},\r\n\t\t\"tableName\" : {label : \"\", clz : \"col-xs-6\"},\r\n\t\t\"shopOrderKey\" : {label : \"\", clz : \"col-xs-6\"},\r\n\t\t\"orderTime\" : {label : \"\", clz : \"col-xs-12\"},\r\n\t\t\"orderCreateTime\" : {label : \"\", clz : \"col-xs-12\"},\r\n\t\t\"statusName\" : {label : \"\", clz : \"col-xs-12\"},\r\n\t\t\"takeoutAddress\" : {label : \"\", clz : \"col-xs-6\"},\r\n\t\t\"consumptionTypeName\" : {label : \"\", clz : \"col-xs-12\"},\r\n\t\t\"promotionDesc\" : {label : \"\", clz : \"col-xs-12\"},\r\n\t\t\"orderRemark\" : {label : \"\", clz : \"col-xs-12\"},\r\n\t\t\"foodAmount\" : {label : \"\", unit : CashUnit, clz : \"col-xs-6\"},\r\n\t\t\"serviceAmount\" : {label : \"\", unit : CashUnit, clz : \"col-xs-6\"},\r\n\t\t\"paidAmount\" : {label : \"\", unit : CashUnit, clz : \"col-xs-6\"},\r\n\t\t\"promotionTotalAmount\" : {label : \"\", unit : CashUnit, clz : \"col-xs-6\"},\r\n\t\t\"discountAmount\" : {label : \"\", unit : CashUnit, clz : \"col-xs-6\"},\r\n\t\t\"freeAmount\" : {label : \"\", unit : CashUnit, clz : \"col-xs-6\"},\r\n\t\t\"giftAmount\" : {label : \"\", unit : CashUnit, clz : \"col-xs-6\"},\r\n\t\t\"presentInfo\" : {label : \"\", clz : \"col-xs-6\"},\r\n\t\t\"cardDiscountAmount\" : {label : \"\", unit : CashUnit, clz : \"col-xs-6\"},\r\n\t\t\"pointBalance\" : {label : \"\", unit : CashUnit, clz : \"col-xs-6\"},\r\n\t\t\"moneyBalance\" : {label : \"\", unit : CashUnit, clz : \"col-xs-6\"},\r\n\t\t\"takeoutPackagingAmount\" : {label : \"\", unit : CashUnit, clz : \"col-xs-6\"},\r\n\t\t\"orderTotal\" : {label : \"\", unit : CashUnit, clz : \"col-xs-6\"},\r\n\t\t\"orderRefundAmount\" : {label : \"\", unit : CashUnit, clz : \"col-xs-6\"},\r\n\t\t\"shopName\" : {label : \"\", clz : \"col-xs-6\"},\r\n\t\t\"shopTel\" : {label : \"\", clz : \"col-xs-6\"},\r\n\t\t\"foodPrice\" : {label : \"\", unit : CashUnit}\r\n\t};\r\n\tvar OrderPayDetailElsCfg = {\r\n\t\tuserFields : {\r\n\t\t\tlabel : \"\",\r\n\t\t\tfieldType : \"list\",\r\n\t\t\tfields : [\"userName\",\"userLoginMobile\"],\r\n\t\t\tmapFn : mapUserFields\r\n\t\t},\r\n\t\torderFields : {\r\n\t\t\tlabel : \"\",\r\n\t\t\tfieldType : \"list\",\r\n\t\t\tfields : [\"orderID\",\"orderCheckPWD\",\"person\",\"timeName\",\"tableName\",\"shopOrderKey\",\"orderTime\",\"orderCreateTime\",\r\n\t\t\t\"statusName\",\"takeoutAddress\",\"consumptionTypeName\",\"promotionDesc\",\"orderRemark\"],\r\n\t\t\tmapFn : mapOrderFields\r\n\t\t},\r\n\t\tpayFields : {\r\n\t\t\tlabel : \"\",\r\n\t\t\tfieldType : \"list\",\r\n\t\t\tfields : [\"foodAmount\",\"serviceAmount\",\"paidAmount\",\"promotionTotalAmount\",\"discountAmount\",\r\n\t\t\t\"freeAmount\",\"giftAmount\",\"presentInfo\",\"cardDiscountAmount\",\"pointBalance\",\"moneyBalance\",\"takeoutPackagingAmount\",\r\n\t\t\t\"orderTotal\",\"orderRefundAmount\",\"shopName\",\"shopTel\"],\r\n\t\t\tmapFn : mapPayFields\r\n\t\t},\r\n\t\tfoodsFields : {\r\n\t\t\tlabel : \"\",\r\n\t\t\tfieldType : \"table\",\r\n\t\t\tfields : [\"foodCategoryName\",\"foodCategoryID\",\"foodName\",\"foodUnit\",\"foodPrice\",\"foodAmount\"],\r\n\t\t\tmapFn : mapFoodsFields\r\n\t\t}\r\n\r\n\t};\r\n\t\r\n\tvar AccountTransDetailModal = Stapes.subclass({\r\n\t\t/**\r\n\t\t * \r\n\t\t * @param  {Object} cfg {triggerEl, orderKey, orderID, transType, transID}\r\n\t\t * @return {Object}\r\n\t\t */\r\n\t\tconstructor : function (cfg) {\r\n\t\t\tthis.$trigger = $XP(cfg, 'triggerEl');\r\n\t\t\tthis.orderKey = $XP(cfg, 'orderKey', '');\r\n\t\t\tthis.orderID = $XP(cfg, 'orderID', '');\r\n\t\t\tthis.transType = $XP(cfg, 'transType', '');\r\n\t\t\tthis.transID = $XP(cfg, 'transID', '');\r\n\t\t\tthis.transTypes = Hualala.TypeDef.FSMTransType;\r\n\t\t\tthis.transTypeHT = new IX.IListManager();\r\n\t\t\tthis.initTransTypeLib();\r\n\t\t\tthis.modal = null;\r\n\t\t\tthis.tplName = $XP(this.transTypeHT.get(this.transType), 'tpl', null);\r\n\t\t\tthis.callServerName = $XP(this.transTypeHT.get(this.transType), 'queryCall', null);\r\n\t\t\tthis.callServer = null;\r\n\t\t\tif (IX.isFn(this.callServerName)) {\r\n\t\t\t\tthis.callServer = this.callServerName;\r\n\t\t\t} else if (!IX.isString(this.callServerName)) {\r\n\t\t\t\tthrow(\"Configuration failed : Invalid Page Initialized for \" + this.callServerName);\r\n\t\t\t\treturn false;\r\n\t\t\t} else if (IX.nsExisted(this.callServerName)) {\r\n\t\t\t\tthis.callServer = IX.getNS(this.callServerName);\r\n\t\t\t}\r\n\t\t\tthis.queryKeys = $XP(this.transTypeHT.get(this.transType), 'queryKeys', null);\r\n\t\t\tif (!this.tplName || !this.callServer) return null;\r\n\t\t\tthis.loadTemplates();\r\n\t\t\tthis.initModal();\r\n\t\t\tthis.bindEvent();\r\n\t\t\tthis.emit('load', this.mapQueryParams());\r\n\t\t}\r\n\t});\r\n\tAccountTransDetailModal.proto({\r\n\t\tinitTransTypeLib : function () {\r\n\t\t\tvar self = this;\r\n\t\t\t_.each(this.transTypes, function (el) {\r\n\t\t\t\tvar type = $XP(el, 'value', '').toString();\r\n\t\t\t\tif (type.length > 0) {\r\n\t\t\t\t\tself.transTypeHT.register(type, el);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t},\r\n\t\tloadTemplates : function () {\r\n\t\t\tvar self = this;\r\n\t\t\tvar layoutTpl = Handlebars.compile(Hualala.TplLib.get(self.tplName)),\r\n\t\t\t\tbtnTpl = Handlebars.compile(Hualala.TplLib.get('tpl_shop_modal_btns'));\r\n\t\t\tHandlebars.registerHelper('chkFieldType', function (conditional, options) {\r\n\t\t\t\treturn (conditional == options.hash.type) ? options.fn(this) : options.inverse(this);\r\n\t\t\t});\r\n\t\t\tthis.set({\r\n\t\t\t\tlayoutTpl : layoutTpl,\r\n\t\t\t\tbtnTpl : btnTpl\r\n\t\t\t});\r\n\t\t},\r\n\t\tinitModal : function () {\r\n\t\t\tvar self = this;\r\n\t\t\tself.modal = new Hualala.UI.ModalDialog({\r\n\t\t\t\tid : 'account_trans_detail',\r\n\t\t\t\tclz : 'account-modal',\r\n\t\t\t\tsizeCls : 'modal-lg',\r\n\t\t\t\ttitle : \"\",\r\n\t\t\t\tafterRemove : function () {\r\n\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t},\r\n\t\tbindEvent : function () {\r\n\t\t\tvar self = this;\r\n\t\t\tself.on({\r\n\t\t\t\t\"load\" : function (params) {\r\n\t\t\t\t\tself.callServer(params, function (res) {\r\n\t\t\t\t\t\tif (res.resultcode == '000') {\r\n\t\t\t\t\t\t\tself.render($XP(res, 'data', null));\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\ttoptip({\r\n\t\t\t\t\t\t\t\tmsg : $XP(res, 'resultmsg', ''),\r\n\t\t\t\t\t\t\t\ttype : 'danger'\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t},\r\n\t\t\t\t\"show\" : function () {\r\n\t\t\t\t\tself.modal.show();\r\n\t\t\t\t},\r\n\t\t\t\t\"hide\" : function () {\r\n\t\t\t\t\tself.modal.hide();\r\n\t\t\t\t}\r\n\t\t\t}, this);\r\n\t\t\tself.modal._.dialog.on('click', '.btn', function (e) {\r\n\t\t\t\tvar $btn = $(this),\r\n\t\t\t\t\tact = $btn.attr('name');\r\n\t\t\t\tif (act == 'cancel') {\r\n\t\t\t\t\tself.emit('hide');\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t},\r\n\t\tmapOrderPayDetail : function (data) {\r\n\t\t\tvar self = this;\r\n\t\t\tvar fieldsets = \"userFields,orderFields,payFields,foodsFields\".split(',');\r\n\t\t\tfieldsets = _.map(fieldsets, function (key, i) {\r\n\t\t\t\tvar fieldCfg = OrderPayDetailElsCfg[key];\r\n\t\t\t\tvar mapFn = $XF(fieldCfg, 'mapFn');\r\n\t\t\t\tvar cfg = _.pick(fieldCfg, 'label', 'fieldType', 'fields');\r\n\t\t\t\treturn mapFn(cfg, $XP(data, 'data', {}));\r\n\t\t\t});\r\n\t\t\tconsole.info(fieldsets);\r\n\t\t\tvar orderSubType = $XP(data, 'data.orderSubType', ''),\r\n\t\t\t\torderSubTypeLabel = getOrderSubTypeLabel(orderSubType);\r\n\t\t\torderSubTypeLabel = IX.isEmpty(orderSubTypeLabel) ? '' : '(' + orderSubTypeLabel + ')';\r\n\t\t\tvar printDetail = {\r\n\t\t\t\tlabel : \"\",\r\n\t\t\t\torderSubTypeLabel : orderSubTypeLabel,\r\n\t\t\t\tcontent : $XP(data, 'data.orderPrnStr', '').replace(/\\n/g, '<br/>')\r\n\t\t\t};\r\n\r\n\t\t\treturn {\r\n\t\t\t\tfieldsets : fieldsets,\r\n\t\t\t\tprintDetail : printDetail\r\n\t\t\t};\r\n\t\t},\r\n\t\tmapFsmCustomerDetail : function (data) {\r\n\t\t\tvar self = this;\r\n\t\t\tvar settleUnitDetail = $XP(data, 'settleUnitDetail', [])[0],\r\n\t\t\t\tcustomerCard = $XP(data, 'customerCard', [])[0];\r\n\t\t\tvar transType = $XP(settleUnitDetail, 'transType'),\r\n\t\t\t\ttransTypeLabel = $XP(self.transTypeHT.get(transType), 'label', '');\r\n\t\t\tsettleUnitDetail = IX.each(settleUnitDetail, {}, function (acc, el, k) {\r\n\t\t\t\tvar cashKeys = 'transAfterBalance,transAmount,transSalesCommission';\r\n\t\t\t\tif (cashKeys.indexOf(k) >= 0) {\r\n\t\t\t\t\tacc[k] = Hualala.Common.Math.prettyNumeric(Hualala.Common.Math.prettyPrice(el));\r\n\t\t\t\t} else if (k == 'transType') {\r\n\t\t\t\t\tacc = IX.inherit(acc, {\r\n\t\t\t\t\t\ttransType : el,\r\n\t\t\t\t\t\ttransTypeLabel : $XP(self.transTypeHT.get(el), 'label', '')\r\n\t\t\t\t\t});\r\n\t\t\t\t} else {\r\n\t\t\t\t\tacc[k] = el;\r\n\t\t\t\t}\r\n\t\t\t\treturn acc;\r\n\t\t\t});\r\n\t\t\tcustomerCard = IX.each(customerCard, {}, function (acc, el, k) {\r\n\t\t\t\tvar cashKeys = 'saveCashTotal,saveMoneyTotal,moneyBalance';\r\n\t\t\t\tif (cashKeys.indexOf(k) >= 0) {\r\n\t\t\t\t\tacc[k] = Hualala.Common.Math.prettyNumeric(Hualala.Common.Math.prettyPrice(el));\r\n\t\t\t\t} else {\r\n\t\t\t\t\tacc[k] = el;\r\n\t\t\t\t}\r\n\t\t\t\treturn acc;\r\n\t\t\t});\r\n\t\t\treturn {\r\n\t\t\t\tsettleUnitDetail : IX.inherit(settleUnitDetail, {\r\n\t\t\t\t\ttransTypeLabel : transTypeLabel\r\n\t\t\t\t}),\r\n\t\t\t\tcustomerCard : customerCard\r\n\t\t\t};\r\n\t\t},\r\n\t\tmapRenderData : function (data) {\r\n\t\t\tvar self = this;\r\n\t\t\tvar type = _.last(self.callServerName.split('.'));\r\n\t\t\tvar ret = null;\r\n\t\t\tswitch(type) {\r\n\t\t\t\tcase \"queryAccountOrderPayDetail\":\r\n\t\t\t\t\tret = self.mapOrderPayDetail(data);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase \"queryAccountFsmCustomerDetail\":\r\n\t\t\t\t\tret = self.mapFsmCustomerDetail(data);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tdefault : \r\n\t\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t\treturn ret;\r\n\t\t},\r\n\t\trender : function (data) {\r\n\t\t\tvar self = this;\r\n\t\t\tvar renderData = self.mapRenderData(data),\r\n\t\t\t\tlayoutTpl = self.get('layoutTpl'),\r\n\t\t\t\tbtnTpl = self.get('btnTpl');\r\n\t\t\tvar htm = layoutTpl(renderData);\r\n\t\t\tself.modal._.body.html(htm);\r\n\t\t\tself.modal._.footer.html(btnTpl({\r\n\t\t\t\tbtns : [\r\n\t\t\t\t\t{clz : 'btn-default', name : 'cancel', label : ''}\r\n\t\t\t\t]\r\n\t\t\t}));\r\n\t\t\tself.emit('show');\r\n\t\t},\r\n\t\tmapQueryParams : function () {\r\n\t\t\tvar self = this;\r\n\t\t\tvar params = {};\r\n\t\t\t_.each(self.queryKeys.split(','), function (k) {\r\n\t\t\t\tvar _k = k == 'SUA_TransItemID' ? 'transID' : k;\r\n\t\t\t\tparams[k] = self[_k]; \r\n\t\t\t});\r\n\t\t\tconsole.info('queryParams:');\r\n\t\t\tconsole.info(params);\r\n\t\t\treturn params;\r\n\t\t}\r\n\t});\r\n\tHualala.Account.AccountTransDetailModal = AccountTransDetailModal;\r\n\r\n\t\r\n})(jQuery, window);;(function ($, window) {\r\n\tIX.ns(\"Hualala.Account\");\r\n\tvar initAccountListPage = function () {\r\n\t\tvar $body = $('#ix_wrapper > .ix-body > .container');\r\n\t\tvar accountListPanel = new Hualala.Account.AccountListController({\r\n\t\t\tcontainer : $body,\r\n\t\t\tview : new Hualala.Account.AccountListView(),\r\n\t\t\tmodel : new Hualala.Account.AccountListModel({\r\n\t\t\t\tcallServer : Hualala.Global.queryAccount\r\n\t\t\t})\r\n\t\t});\r\n\t\taccountListPanel.emit('load', {\r\n\t\t\tpageNo : 1,\r\n\t\t\tpageSize : 15\r\n\t\t});\r\n\t};\r\n\r\n\tvar initAccountMgrPage = function () {\r\n\t\tvar ctx = Hualala.PageRoute.getPageContextByPath();\r\n\t\tvar $body = $('#ix_wrapper > .ix-body > .container');\r\n\t\tvar accountMgrCtrl = new Hualala.Account.AccountMgrController({\r\n\t\t\tcontainer : $body,\r\n\t\t\tsettleUnitID : $XP(ctx, 'params', [])[0],\r\n\t\t\taccountModel : new Hualala.Account.BaseAccountModel(),\r\n\t\t\tmgrView : new Hualala.Account.AccountMgrView(),\r\n\t\t\ttransaDetailCtrl : new Hualala.Account.TransactionDetailController()\r\n\t\t});\r\n\t\t// $body.html(\"<h1></h1>\");\r\n\t};\r\n\r\n\tHualala.Account.AccountMgrInit = initAccountMgrPage;\r\n\t\r\n\tHualala.Account.AccountListInit = initAccountListPage;\r\n})(jQuery, window);;(function ($, window) {\r\n\tIX.ns(\"Hualala.Order\");\r\n\tvar popoverMsg = Hualala.UI.PopoverMsgTip;\r\n\tvar toptip = Hualala.UI.TopTip;\r\n\r\n\tvar OrderQueryResultModel = Stapes.subclass({\r\n\t\t/**\r\n\t\t *  \r\n\t\t * @param  {Object} cfg\t\r\n\t\t * \t\t@param {Function} callServer \r\n\t\t * \t\t@param {Array} queryKeys \r\n\t\t * \t\t@param {Array} cities \r\n\t\t * \t\t@param {Function} initQueryParams \r\n\t\t * \t\t@param {Boolean} hasPager true:false.default true\r\n\t\t * @return {Object}\r\n\t\t */\r\n\t\tconstructor : function (cfg) {\r\n\t\t\tthis.callServer = $XP(cfg, 'callServer', null);\r\n\t\t\tif (!this.callServer) {\r\n\t\t\t\tthrow(\"callServer is empty!\");\r\n\t\t\t\treturn ;\r\n\t\t\t}\r\n\t\t\tthis.cities = $XP(cfg, 'cities', []);\r\n\t\t\tthis.queryKeys = $XP(cfg, 'queryKeys', []);\r\n\t\t\tthis.pagerKeys = 'pageCount,totalSize,pageNo,pageSize'.split(',');\r\n\t\t\tthis.queryParamsKeys = null;\r\n\t\t\tthis.hasPager = $XP(cfg, 'hasPager', true);\r\n\t\t\tthis.recordModel = $XP(cfg, 'recordModel', BaseOrderRecordModel);\r\n\t\t\tvar initQueryParams = $XF(cfg, 'initQueryParams');\r\n\t\t\tinitQueryParams.apply(this);\r\n\t\t}\r\n\t});\r\n\r\n\tOrderQueryResultModel.proto({\r\n\t\tinit : function (params, cities) {\r\n\t\t\tthis.cities = cities || this.cities;\r\n\t\t\tthis.set(IX.inherit({\r\n\t\t\t\tds_record : new IX.IListManager(),\r\n\t\t\t\tds_page : new IX.IListManager()\r\n\t\t\t}, this.hasPager ? {\r\n\t\t\t\tpageCount : 0,\r\n\t\t\t\ttotalSize : 0,\r\n\t\t\t\tpageNo : $XP(params, 'pageNo', 1),\r\n\t\t\t\tpageSize : $XP(params, 'pageSize', 15)\r\n\t\t\t} : {}));\r\n\t\t\tthis.queryParamsKeys = !this.hasPager ? this.queryKeys : this.queryKeys.concat(this.pagerKeys);\r\n\t\t},\r\n\t\tupdatePagerParams : function (params) {\r\n\t\t\tvar self = this;\r\n\t\t\tvar queryParamsKeys = self.queryParamsKeys.join(',');\r\n\t\t\t_.each(params, function (v, k, l) {\r\n\t\t\t\tif (queryParamsKeys.indexOf(k) > -1) {\r\n\t\t\t\t\tself.set(k, v);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t},\r\n\t\tgetPagerParams : function () {\r\n\t\t\tvar self = this;\r\n\t\t\tvar ret = {};\r\n\t\t\t_.each(self.queryParamsKeys, function (k) {\r\n\t\t\t\tret[k] = self.get(k);\r\n\t\t\t});\r\n\t\t\treturn ret;\r\n\t\t},\r\n\t\tupdateDataStore : function (data, pageNo) {\r\n\t\t\tvar self = this,\r\n\t\t\t\trecordHT = self.get('ds_record'),\r\n\t\t\t\tpageHT = self.get('ds_page');\r\n\t\t\tpageNo = self.hasPager ? pageNo : 1;\r\n\t\t\tvar recordIDs = _.map(data, function (r, i, l) {\r\n\t\t\t\tvar id = pageNo + '_' + IX.id(),\r\n\t\t\t\t\tmRecord = new self.recordModel(IX.inherit(r, {\r\n\t\t\t\t\t\t'__id__' : id\r\n\t\t\t\t\t}));\r\n\t\t\t\trecordHT.register(id, mRecord);\r\n\t\t\t\treturn id;\r\n\t\t\t});\r\n\t\t\tpageHT.register(pageNo, recordIDs);\r\n\t\t},\r\n\t\tresetDataStore : function () {\r\n\t\t\tthis.recordHT.clear();\r\n\t\t\tthis.pageHT.clear();\r\n\t\t},\r\n\t\tload : function (params, cbFn) {\r\n\t\t\tvar self = this;\r\n\t\t\tself.updatePagerParams(params);\r\n\t\t\tself.callServer(self.getPagerParams(), function (res) {\r\n\t\t\t\tif (res.resultcode == '000') {\r\n\t\t\t\t\tself.updateDataStore($XP(res, 'data.records', []), $XP(res, 'data.page.pageNo'));\r\n\t\t\t\t\tself.updatePagerParams($XP(res, 'data.page', {}));\r\n\t\t\t\t} else {\r\n\t\t\t\t\ttoptip({\r\n\t\t\t\t\t\tmsg : $XP(res, 'resultmsg', ''),\r\n\t\t\t\t\t\ttype : 'danger'\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t\tcbFn(self);\r\n\t\t\t});\r\n\t\t},\r\n\t\tgetRecordsByPageNo : function (pageNo) {\r\n\t\t\tvar self = this,\r\n\t\t\t\trecordHT = self.get('ds_record'),\r\n\t\t\t\tpageHT = self.get('ds_page');\r\n\t\t\tpageNo = !self.hasPager ? 1 : pageNo;\r\n\t\t\tvar ret = _.map(recordHT.getByKeys(pageHT.get(pageNo)), function (mRecord, i, l) {\r\n\t\t\t\treturn mRecord.getAll();\r\n\t\t\t});\r\n\t\t\tconsole.info(\"pageData\");\r\n\t\t\tconsole.info(ret);\r\n\t\t\treturn ret;\r\n\t\t},\r\n\t\tgetRecordModelByID : function (id) {\r\n\t\t\tvar self = this,\r\n\t\t\t\trecordHT = self.get('ds_record');\r\n\t\t\treturn recordHT.get(id);\r\n\t\t},\r\n\t\tgetCityByCityID : function (cityID) {\r\n\t\t\tif (IX.isEmpty(cityID)) return null;\r\n\t\t\tvar l = this.cities;\r\n\t\t\tvar m = _.find(l, function (el) {\r\n\t\t\t\treturn $XP(el, 'cityID') == cityID;\r\n\t\t\t});\r\n\t\t\treturn m;\r\n\t\t}\r\n\t});\r\n\r\n\tHualala.Order.OrderQueryResultModel = OrderQueryResultModel;\r\n\r\n\t/* */\r\n\tvar BaseOrderRecordModel = Stapes.subclass({\r\n\t\tconstructor : function (order) {\r\n\t\t\tthis.set(order);\r\n\t\t}\r\n\t});\r\n\tBaseOrderRecordModel.proto({\r\n\r\n\t});\r\n\tHualala.Order.BaseOrderRecordModel = BaseOrderRecordModel;\r\n})(jQuery, window);;(function ($, window) {\r\n\tIX.ns(\"Hualala.Order\");\r\n\tvar popoverMsg = Hualala.UI.PopoverMsgTip;\r\n\tvar toptip = Hualala.UI.TopTip;\r\n\r\n\r\n\tvar OrderQueryTableHeaderCfg = [\r\n\t\t{key : \"cityID\", clz : \"\", label : \"\"},\r\n\t\t{key : \"shopName\", clz : \"\", label : \"\"},\r\n\t\t{key : \"orderID\", clz : \"\", label : \"\"},\r\n\t\t{key : \"userName\", clz : \"\", label : \"\"},\r\n\t\t{key : \"orderTime\", clz : \"\", label : \"\"},\r\n\t\t{key : \"orderStatus\", clz : \"\", label : \"\"},\r\n\t\t{key : \"orderTotal\", clz : \"\", label : \"\"},\r\n\t\t{key : \"moneyBalance\", clz : \"\", label : \"\"},\r\n\t\t{key : \"pointBalance\", clz : \"\", label : \"\"},\r\n\t\t{key : \"orderRefundAmount\", clz : \"\", label : \"/\"},\r\n\t\t{key : \"total\", clz : \"\", label : \"\"},\r\n\t\t{key : \"shouldSettlementTotal\", clz : \"\", label : \"\"},\r\n\t\t{key : \"rowControl\", clz : \"\", label : \"\"}\r\n\t];\r\n\tvar OrderQueryDuringTableHeaderCfg = [\r\n\t\t{key : \"cityID\", clz : \"\", label : \"\"},\r\n\t\t{key : \"billDate\", clz : \"\", label : \"\"},\r\n\t\t{key : \"count\", clz : \"\", label : \"\"},\r\n\t\t{key : \"giftAmountTotal\", clz : \"\", label : \"\"},\r\n\t\t{key : \"orderTotal\", clz : \"\", label : \"\"},\r\n\t\t{key : \"orderWaitTotal\", clz : \"\", label : \"\"},\r\n\t\t{key : \"orderRegAmount\", clz : \"\", label : \"\"},\r\n\t\t{key : \"orderRefundAmount\", clz : \"\", label : \"\"},\r\n\t\t{key : \"total\", clz : \"\", label : \"\"},\r\n\t\t{key : \"orderTotal\", clz : \"\", label : \"\"},\r\n\t\t{key : \"rowControl\", clz : \"\", label : \"\"}\r\n\t];\r\n\r\n\tvar OrderQueryDishHotTableHeaderCfg = [\r\n\t\t{key : \"index\", clz : \"\", label : \"\"},\r\n\t\t{key : \"foodName\", clz : \"\", label : \"\"},\r\n\t\t{key : \"foodCategoryName\", clz : \"\", label : \"\"},\r\n\t\t{key : \"sumPrice\", clz : \"\", label : \"\"},\r\n\t\t{key : \"sumMaster\", clz : \"\", label : \"\"}\r\n\t];\r\n\r\n\tvar OrderQueryUserTableHeaderCfg = [\r\n\t\t{key : \"userName\", clz : \"\", label : \"\"},\r\n\t\t{key : \"userSex\", clz : \"\", label : \"\"},\r\n\t\t{key : \"userLoginMobile\", clz : \"\", label : \"\"},\r\n\t\t{key : \"sumRecord\", clz : \"\", label : \"\"},\r\n\t\t{key : \"foodAmount\", clz : \"\", label : \"\"},\r\n\t\t{key : \"minOrderTime\", clz : \"\", label : \"\"},\r\n\t\t{key : \"maxOrderTime\", clz : \"\", label : \"\"}\r\n\t];\r\n\r\n\tvar mapColItemRenderData = function (row, rowIdx, colKey) {\r\n\t\tvar self = this;\r\n\t\tvar ctx = Hualala.PageRoute.getPageContextByPath(), pageName = $XP(ctx, 'name'),\r\n\t\t\tpagerParams = self.model.getPagerParams(), queryKeys = self.model.queryKeys;\r\n\t\tvar r = {value : \"\", text : \"\"}, v = $XP(row, colKey, '');\r\n\t\tswitch(colKey) {\r\n\t\t\tcase \"cityID\":\r\n\t\t\t\tv = self.getCityByCityID(v);\r\n\t\t\t\tr.value = $XP(v, 'cityID', '');\r\n\t\t\t\tr.text = $XP(v, 'cityName', '');\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"userName\":\r\n\t\t\t\tvar m = $XP(row, 'userMobile', ''),\r\n\t\t\t\t\ts = Hualala.Common.getGender($XP(row, 'userSex', ''));\r\n\t\t\t\ts = IX.isEmpty(s) ? '' : '(' + $XP(s, 'label', '') + ')';\r\n\t\t\t\tm = IX.isEmpty(m) ? '' : '(' + m + ')';\r\n\t\t\t\tr.value = $XP(row, 'userID', '');\r\n\t\t\t\tr.text = v + s + m;\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"orderTime\":\r\n\t\t\tcase \"minOrderTime\":\r\n\t\t\tcase \"maxOrderTime\":\r\n\t\t\t\tr.value = v;\r\n\t\t\t\tr.text = IX.Date.getDateByFormat(Hualala.Common.formatDateTimeValue(v), 'yyyy/MM/dd HH:mm');\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"orderStatus\":\r\n\t\t\t\tv = Hualala.Common.getOrderStatus(v);\r\n\t\t\t\tr.value = $XP(v, 'value', '');\r\n\t\t\t\tr.text = $XP(v, 'label', '');\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"billDate\":\r\n\t\t\t\tr.value = v;\r\n\t\t\t\tr.text = IX.Date.getDateByFormat(Hualala.Common.formatDateTimeValue(v), 'yyyy/MM/dd');\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"index\" :\r\n\t\t\t\tr.value = rowIdx;\r\n\t\t\t\tr.text = rowIdx + 1;\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"sumMaster\":\r\n\t\t\t\tr.value = v;\r\n\t\t\t\tr.text = v + \"&nbsp;\" + $XP(row, 'foodUnit', '');\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"sumPrice\":\r\n\t\t\t\tr.value = v || 0;\r\n\t\t\t\tr.text = Hualala.Common.Math.prettyPrice(Hualala.Common.Math.div(r.value, $XP(row, 'sumMaster', 1)));\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"userSex\":\r\n\t\t\t\tr.value = v;\r\n\t\t\t\tr.text = $XP(Hualala.Common.getGender($XP(row, 'userSex', '')), 'label', '');\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"rowControl\" :\r\n\t\t\t\tif (pageName == 'orderQuery') {\r\n\t\t\t\t\tr = {\r\n\t\t\t\t\t\ttype : 'button',\r\n\t\t\t\t\t\tbtns : [\r\n\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\tlabel : '', \r\n\t\t\t\t\t\t\t\tlink : 'javascript:void(0);', \r\n\t\t\t\t\t\t\t\tclz : '', \r\n\t\t\t\t\t\t\t\tid : $XP(row, 'orderKey', ''), \r\n\t\t\t\t\t\t\t\ttype : ''\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t]\r\n\t\t\t\t\t};\r\n\t\t\t\t} else if (pageName == 'orderQueryDay' || pageName == 'orderQueryDuring' ) {\r\n\t\t\t\t\tvar n = pageName == \"orderQueryDuring\" ? \"orderQueryDay\" : \"orderQuery\",\r\n\t\t\t\t\t\tparams = _.map(queryKeys, function (k) {\r\n\t\t\t\t\t\t\treturn $XP(pagerParams, k, '');\r\n\t\t\t\t\t\t}),\r\n\t\t\t\t\t\tlink = '';\r\n\t\t\t\t\t\tif (n == 'orderQuery') {\r\n\t\t\t\t\t\t\tparams = params.concat(['','','','']);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tlink = Hualala.PageRoute.createPath(n, params);\r\n\t\t\t\t\tr = {\r\n\t\t\t\t\t\ttype : 'button',\r\n\t\t\t\t\t\tbtns : [\r\n\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\tlabel : '', \r\n\t\t\t\t\t\t\t\tlink : link, \r\n\t\t\t\t\t\t\t\tclz : '', \r\n\t\t\t\t\t\t\t\tid : '', \r\n\t\t\t\t\t\t\t\ttype : ''\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t]\r\n\t\t\t\t\t};\r\n\t\t\t\t}\r\n\t\t\t\tbreak;\r\n\t\t\tdefault : \r\n\t\t\t\tr.value = r.text = $XP(row, colKey, '');\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\t\treturn r;\r\n\t};\r\n\r\n\t/**\r\n\t * \r\n\t * @param {Array|Object} records  \r\n\t * @return {Array|Obejct}\t\r\n\t */\r\n\tHualala.Order.mapQueryOrderResultRenderData = function (records) {\r\n\t\tvar self = this;\r\n\t\tvar clz = \"col-md-12\",\r\n\t\t\ttblClz = \"table-striped table-hover\",\r\n\t\t\ttblHeaders = OrderQueryTableHeaderCfg;\r\n\t\tvar mapColsRenderData = function (row, idx) {\r\n\t\t\tvar colKeys = _.map(tblHeaders, function (el) {\r\n\t\t\t\treturn $XP(el, 'key', '');\r\n\t\t\t});\r\n\t\t\t// colKeys.push('rowControl');\r\n\t\t\tvar col = {clz : '', type : 'text'};\r\n\t\t\tvar cols = _.map(colKeys, function (k, i) {\r\n\t\t\t\tvar r = mapColItemRenderData.apply(self, [row, idx, k]);\r\n\t\t\t\treturn IX.inherit(col, r);\r\n\t\t\t});\r\n\t\t\treturn cols;\r\n\t\t};\r\n\t\tvar rows = _.map(records, function (row, idx) {\r\n\t\t\treturn {\r\n\t\t\t\tclz : '',\r\n\t\t\t\tcols : mapColsRenderData(row, idx)\r\n\t\t\t};\r\n\t\t});\r\n\t\treturn {\r\n\t\t\tclz : clz,\r\n\t\t\ttblClz : tblClz,\r\n\t\t\tthead : tblHeaders,\r\n\t\t\trows : rows\r\n\t\t};\r\n\t};\r\n\t/**\r\n\t *  \r\n\t * @param  {[type]} records\r\n\t * @return {[type]}\r\n\t */\r\n\tHualala.Order.mapQueryOrderDuringRenderData = function (records) {\r\n\t\tvar self = this;\r\n\t\tvar ctx = Hualala.PageRoute.getPageContextByPath();\r\n\t\tvar pageName = $XP(ctx, 'name');\r\n\t\tvar pagerParams = self.model.getPagerParams();\r\n\t\tvar queryKeys = self.model.queryKeys;\r\n\t\tvar clz = \"col-md-12\",\r\n\t\t\ttblClz = \"table-striped table-hover\",\r\n\t\t\ttblHeaders = IX.clone(OrderQueryDuringTableHeaderCfg);\r\n\t\tif (pageName == 'orderQueryDuring') {\r\n\t\t\ttblHeaders = _.map(tblHeaders, function (el) {\r\n\t\t\t\tvar key = $XP(el, 'key', '');\r\n\t\t\t\tif (key == 'billDate') {\r\n\t\t\t\t\tel = IX.inherit(el, {\r\n\t\t\t\t\t\tkey : 'shopName', clz : \"\", label : \"\"\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t\treturn el;\r\n\t\t\t});\r\n\t\t}\r\n\t\tvar mapColsRenderData = function (row, idx) {\r\n\t\t\tvar colKeys = _.map(tblHeaders, function (el) {\r\n\t\t\t\treturn $XP(el, 'key', '');\r\n\t\t\t});\r\n\t\t\t// colKeys.push('rowControl');\r\n\t\t\tvar col = {clz : '', type : 'text'};\r\n\t\t\tvar cols = _.map(colKeys, function (k, i) {\r\n\t\t\t\tvar r = mapColItemRenderData.apply(self, [row, idx, k]);\r\n\t\t\t\treturn IX.inherit(col, r);\r\n\t\t\t});\r\n\t\t\treturn cols;\r\n\t\t};\r\n\t\tvar rows = _.map(records, function (row, idx) {\r\n\t\t\treturn {\r\n\t\t\t\tclz : '',\r\n\t\t\t\tcols : mapColsRenderData(row, idx)\r\n\t\t\t};\r\n\t\t});\r\n\t\treturn {\r\n\t\t\tclz : clz,\r\n\t\t\ttblClz : tblClz,\r\n\t\t\tthead : tblHeaders,\r\n\t\t\trows : rows\r\n\t\t};\r\n\t};\r\n\t/**\r\n\t * \r\n\t * @param  {[type]} records\r\n\t * @return {[type]}\r\n\t */\r\n\tHualala.Order.mapQueryDishesHotRenderData = function (records) {\r\n\t\tvar self = this;\r\n\t\tvar clz = \"col-md-12\",\r\n\t\t\ttblClz = \"table-striped table-hover\",\r\n\t\t\ttblHeaders = OrderQueryDishHotTableHeaderCfg;\r\n\t\tvar mapColsRenderData = function (row, idx) {\r\n\t\t\tvar colKeys = _.map(tblHeaders, function (el) {\r\n\t\t\t\treturn $XP(el, 'key', '');\r\n\t\t\t});\r\n\t\t\t// colKeys.push('rowControl');\r\n\t\t\tvar col = {clz : '', type : 'text'};\r\n\t\t\tvar cols = _.map(colKeys, function (k, i) {\r\n\t\t\t\tvar r = mapColItemRenderData.apply(self, [row, idx, k]);\r\n\t\t\t\treturn IX.inherit(col, r);\r\n\t\t\t});\r\n\t\t\treturn cols;\r\n\t\t};\r\n\t\tvar rows = _.map(records, function (row, idx) {\r\n\t\t\treturn {\r\n\t\t\t\tclz : '',\r\n\t\t\t\tcols : mapColsRenderData(row, idx)\r\n\t\t\t};\r\n\t\t});\r\n\t\treturn {\r\n\t\t\tclz : clz,\r\n\t\t\ttblClz : tblClz,\r\n\t\t\tthead : tblHeaders,\r\n\t\t\trows : rows\r\n\t\t};\r\n\t};\r\n\r\n\t/**\r\n\t * \r\n\t * @param  {[type]} records\r\n\t * @return {[type]}\r\n\t */\r\n\tHualala.Order.mapQueryUserRenderData = function (records) {\r\n\t\tvar self = this;\r\n\t\tvar clz = \"col-md-12\",\r\n\t\t\ttblClz = \"table-striped table-hover\",\r\n\t\t\ttblHeaders = OrderQueryUserTableHeaderCfg;\r\n\t\tvar mapColsRenderData = function (row, idx) {\r\n\t\t\tvar colKeys = _.map(tblHeaders, function (el) {\r\n\t\t\t\treturn $XP(el, 'key', '');\r\n\t\t\t});\r\n\t\t\t// colKeys.push('rowControl');\r\n\t\t\tvar col = {clz : '', type : 'text'};\r\n\t\t\tvar cols = _.map(colKeys, function (k, i) {\r\n\t\t\t\tvar r = mapColItemRenderData.apply(self, [row, idx, k]);\r\n\t\t\t\treturn IX.inherit(col, r);\r\n\t\t\t});\r\n\t\t\treturn cols;\r\n\t\t};\r\n\t\tvar rows = _.map(records, function (row, idx) {\r\n\t\t\treturn {\r\n\t\t\t\tclz : '',\r\n\t\t\t\tcols : mapColsRenderData(row, idx)\r\n\t\t\t};\r\n\t\t});\r\n\t\treturn {\r\n\t\t\tclz : clz,\r\n\t\t\ttblClz : tblClz,\r\n\t\t\tthead : tblHeaders,\r\n\t\t\trows : rows\r\n\t\t};\r\n\t};\r\n\r\n\t/**\r\n\t * \r\n\t * @param  {Array|Object} data \t\r\n\t * @return {NULL}\r\n\t */\r\n\tHualala.Order.renderQueryOrderResult = function (data) {\r\n\t\tvar self = this;\r\n\t\tself.$result.empty();\r\n\t\tself.$result.html(self.get('resultTpl')(data));\r\n\t};\r\n\r\n\tvar OrderQueryResultView = Stapes.subclass({\r\n\t\t/**\r\n\t\t * View\r\n\t\t * @param  {Object} cfg\r\n\t\t * \t\t\t@param {Function} mapResultRenderData \r\n\t\t * \t\t\t@param {Function} renderResult \r\n\t\t * @return {Object}\r\n\t\t */\r\n\t\tconstructor : function (cfg) {\r\n\t\t\tthis.$container = null;\r\n\t\t\tthis.$resultBox = null;\r\n\t\t\tthis.$result = null;\r\n\t\t\tthis.$pager = null;\r\n\t\t\tthis.set('mapResultRenderData', $XF(cfg, 'mapResultRenderData'));\r\n\t\t\tthis.set('renderResult', $XF(cfg, 'renderResult'));\r\n\t\t\tthis.loadTemplate();\r\n\t\t}\r\n\t});\r\n\tOrderQueryResultView.proto({\r\n\t\t/**\r\n\t\t * View\r\n\t\t * @param  {Object} cfg\r\n\t\t * \t\t\t@param {jQueryObj} container \r\n\t\t * \t\t\t@param {Object} model \r\n\t\t * @return \r\n\t\t */\r\n\t\tinit : function (cfg) {\r\n\t\t\tthis.$container = $XP(cfg, 'container', null);\r\n\t\t\tthis.model = $XP(cfg, 'model', null);\r\n\t\t\tif (!this.$container || !this.model) {\r\n\t\t\t\tthrow(\"Query Result View Init Faild!\");\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tthis.initLayout();\r\n\t\t},\r\n\t\tloadTemplate : function () {\r\n\t\t\tvar layoutTpl = Handlebars.compile(Hualala.TplLib.get('tpl_shop_list_layout')),\r\n\t\t\t\tresultTpl = Handlebars.compile(Hualala.TplLib.get('tpl_base_datagrid'));\r\n\t\t\tHandlebars.registerPartial(\"colBtns\", Hualala.TplLib.get('tpl_base_grid_colbtns'));\r\n\t\t\tHandlebars.registerHelper('chkColType', function (conditional, options) {\r\n\t\t\t\treturn (conditional == options.hash.type) ? options.fn(this) : options.inverse(this);\r\n\t\t\t});\r\n\t\t\tthis.set({\r\n\t\t\t\tlayoutTpl : layoutTpl,\r\n\t\t\t\tresultTpl : resultTpl\r\n\t\t\t});\r\n\t\t},\r\n\t\tinitLayout : function () {\r\n\t\t\tvar layoutTpl = this.get('layoutTpl');\r\n\t\t\tvar htm = layoutTpl();\r\n\t\t\tthis.$container.append(htm);\r\n\t\t\tthis.$resultBox = this.$container.find('.shop-list');\r\n\t\t\tthis.$result = this.$container.find('.shop-list-body');\r\n\t\t\tthis.$pager = this.$container.find('.page-selection');\r\n\t\t\tthis.initPager();\r\n\t\t\tthis.bindEvent();\r\n\t\t},\r\n\t\tinitPager : function (params) {\r\n\t\t\tvar self = this;\r\n\t\t\tif (!self.model.hasPager) return;\r\n\t\t\tvar baseCfg = {total : 0, page : 1, maxVisible : 10, leaps : true};\r\n\t\t\tthis.$pager.IXPager(IX.inherit(baseCfg, params));\r\n\t\t},\r\n\t\tbindEvent : function () {\r\n\t\t\tvar self = this;\r\n\t\t\tself.model.hasPager && self.$pager.on('page', function (e, pageNo) {\r\n\t\t\t\tvar params = self.model.getPagerParams();\r\n\t\t\t\tparams['pageNo'] = pageNo;\r\n\t\t\t\tself.model.emit('load', IX.inherit(params, {\r\n\t\t\t\t\tpageNo : $XP(params, 'pageNo', 1),\r\n\t\t\t\t\tpageSize : $XP(params, 'pageSize', 15)\r\n\t\t\t\t}));\r\n\t\t\t});\r\n\t\t},\r\n\t\tmapRenderData : function (records) {\r\n\t\t\tvar mapFn = this.get('mapResultRenderData');\r\n\t\t\tvar ret = IX.isFn(mapFn) ? mapFn.apply(this, arguments) : null;\r\n\t\t\treturn ret;\r\n\t\t},\r\n\t\trenderRecords : function (data) {\r\n\t\t\tvar renderFn = this.get('renderResult');\r\n\t\t\tIX.isFn(renderFn) && renderFn.apply(this, arguments);\r\n\t\t},\r\n\t\trender : function () {\r\n\t\t\tvar self = this,\r\n\t\t\t\tmodel = self.model,\r\n\t\t\t\thasPager = model.hasPager,\r\n\t\t\t\tpagerParams = model.getPagerParams(),\r\n\t\t\t\tpageNo = $XP(pagerParams, 'pageNo', 1);\r\n\t\t\tvar records = model.getRecordsByPageNo(pageNo);\r\n\t\t\tvar renderData = self.mapRenderData(records);\r\n\t\t\tself.renderRecords(renderData);\r\n\t\t\thasPager && self.initPager({\r\n\t\t\t\ttotal : model.get('pageCount'),\r\n\t\t\t\tpage : model.get('pageNo'),\r\n\t\t\t\thref : 'javascript:void(0);'\r\n\t\t\t});\r\n\t\t},\r\n\t\tgetCityByCityID : function (cityID) {\r\n\t\t\tvar self = this;\r\n\t\t\tvar c = self.model.getCityByCityID(cityID);\r\n\t\t\treturn c;\r\n\t\t}\r\n\t});\r\n\r\n\tHualala.Order.OrderQueryResultView = OrderQueryResultView;\r\n})(jQuery, window);\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n;(function ($, window) {\r\n\tIX.ns(\"Hualala.Order\");\r\n\tvar popoverMsg = Hualala.UI.PopoverMsgTip;\r\n\tvar toptip = Hualala.UI.TopTip;\r\n\r\n\tvar OrderListController = Stapes.subclass({\r\n\t\t/**\r\n\t\t * \r\n\t\t * @param  {Object} cfg\r\n\t\t * \t\t\t@param {Object} view View\r\n\t\t * \t\t\t@param {Object} model Model\r\n\t\t * \t\t\t@param {JQueryObj} container \r\n\t\t * @return {[type]}\r\n\t\t */\r\n\t\tconstructor : function (cfg) {\r\n\t\t\tthis.set({\r\n\t\t\t\tsessionData : Hualala.getSessionData()\r\n\t\t\t});\r\n\t\t\tthis.container = $XP(cfg, 'container', null);\r\n\t\t\tthis.view = $XP(cfg, 'view', null);\r\n\t\t\tthis.model = $XP(cfg, 'model', null);\r\n\t\t\tif (!this.view || !this.model || !this.container) {\r\n\t\t\t\tthrow(\"Query Result init faild!\");\r\n\t\t\t}\r\n\t\t\tthis.isReady = false;\r\n\t\t\tthis.bindEvent();\r\n\t\t}\r\n\t});\r\n\tOrderListController.proto({\r\n\t\tinit : function (params) {\r\n\t\t\tthis.model.init($XP(params, 'params', {}), $XP(params, 'cities', null));\r\n\t\t\tthis.view.init({\r\n\t\t\t\tmodel : this.model,\r\n\t\t\t\tcontainer : this.container\r\n\t\t\t});\r\n\t\t\tthis.isReady = true;\r\n\t\t},\r\n\t\thasReady : function () {return this.isReady;},\r\n\t\tbindEvent : function () {\r\n\t\t\tthis.on({\r\n\t\t\t\tload : function (params) {\r\n\t\t\t\t\tvar self = this;\r\n\t\t\t\t\tif (!self.hasReady()) {\r\n\t\t\t\t\t\tself.init(params);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tself.model.emit('load', $XP(params, 'params', {}));\r\n\t\t\t\t}\r\n\t\t\t}, this);\r\n\t\t\tthis.model.on({\r\n\t\t\t\tload : function (params) {\r\n\t\t\t\t\tvar self = this;\r\n\t\t\t\t\tvar cbFn = function () {\r\n\t\t\t\t\t\tself.view.emit('render');\r\n\t\t\t\t\t};\r\n\t\t\t\t\tself.model.load(params, cbFn);\r\n\t\t\t\t}\r\n\t\t\t}, this);\r\n\t\t\tthis.view.on({\r\n\t\t\t\trender : function () {\r\n\t\t\t\t\tvar self = this;\r\n\t\t\t\t\tself.view.render();\r\n\t\t\t\t}\r\n\t\t\t}, this);\r\n\t\t}\r\n\t});\r\n\r\n\tHualala.Order.OrderListController = OrderListController;\r\n})(jQuery, window);;(function ($, window) {\r\n\tIX.ns(\"Hualala.Order\");\r\n\tvar popoverMsg = Hualala.UI.PopoverMsgTip;\r\n\tvar toptip = Hualala.UI.TopTip;\r\n\r\n\tHualala.Order.initQueryParams = function () {\r\n\t\tvar ctx = Hualala.PageRoute.getPageContextByPath();\r\n\t\tvar self = this;\r\n\t\tvar queryVals = $XP(ctx, 'params', []);\r\n\t\tvar queryKeys = self.queryKeys;\r\n\t\tvar params = _.object(queryKeys, queryVals);\r\n\t\tself.set(params);\r\n\t};\r\n\r\n\tvar QueryModel = Hualala.Shop.QueryModel.subclass({\r\n\t\t/**\r\n\t\t * \r\n\t\t * @param  {Object} cfg\r\n\t\t * \t\t\t@param {Array} queryKeys \r\n\t\t * \t\t\t@param {Function} initQueryParams \r\n\t\t * \t\t\t\r\n\t\t * @return {Object}\r\n\t\t */\r\n\t\tconstructor : function (cfg) {\r\n\t\t\t// \r\n\t\t\tthis.origCities = [];\r\n\t\t\tthis.origAreas = [];\r\n\t\t\tthis.origShops = [];\r\n\t\t\tthis.queryKeys = $XP(cfg, 'queryKeys', []);\r\n\t\t\t// \r\n\t\t\tthis.isReady = false;\r\n\t\t\tthis.callServer = Hualala.Global.getShopQuerySchema;\r\n\t\t\tvar initQueryParams = $XF(cfg, 'initQueryParams');\r\n\t\t\tinitQueryParams.apply(this);\r\n\t\t}\r\n\t});\r\n\tQueryModel.proto({\r\n\t\tgetQueryParams : function () {\r\n\t\t\tvar self = this;\r\n\t\t\tvar vals = _.map(self.queryKeys, function (k) {\r\n\t\t\t\treturn self.get(k);\r\n\t\t\t});\r\n\t\t\tvar params = _.object(self.queryKeys, vals);\r\n\t\t\tconsole.info(\"Order Query Params is :\");\r\n\t\t\tconsole.info(params);\r\n\t\t\treturn params;\r\n\t\t}\r\n\t});\r\n\r\n\tHualala.Order.QueryModel = QueryModel;\r\n})(jQuery, window);;(function ($, window) {\r\n\tIX.ns(\"Hualala.Order\");\r\n\tvar popoverMsg = Hualala.UI.PopoverMsgTip;\r\n\tvar toptip = Hualala.UI.TopTip;\r\n\r\n\t/**\r\n\t *  \r\n\t * @type {Object}\r\n\t */\r\n\tHualala.Order.QueryFormElsCfg = {\r\n\t\torderTime : {\r\n\t\t\ttype : 'section',\r\n\t\t\tlabel : '',\r\n\t\t\tmin : {\r\n\t\t\t\ttype : 'datetimepicker',\r\n\t\t\t\t// surfix : '<span class=\"glyphicon glyphicon-calendar\"></span>',\r\n\t\t\t\tdefaultVal : '',\r\n\t\t\t\tvalidCfg : {\r\n\t\t\t\t\tgroup : '.min-input',\r\n\t\t\t\t\tvalidators : {}\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tmax : {\r\n\t\t\t\ttype : 'datetimepicker',\r\n\t\t\t\t// surfix : '<span class=\"glyphicon glyphicon-calendar\"></span>',\r\n\t\t\t\tdefaultVal : '',\r\n\t\t\t\tvalidCfg : {\r\n\t\t\t\t\tgroup : '.max-input',\r\n\t\t\t\t\tvalidators : {}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\tcityID : {\r\n\t\t\ttype : 'combo',\r\n\t\t\tlabel : '',\r\n\t\t\tdefaultVal : '',\r\n\t\t\toptions : [],\r\n\t\t\tvalidCfg : {\r\n\t\t\t\tvalidators : {}\r\n\t\t\t}\r\n\t\t},\r\n\t\tshopID : {\r\n\t\t\ttype : 'combo',\r\n\t\t\tlabel : '',\r\n\t\t\tdefaultVal : '',\r\n\t\t\toptions : [],\r\n\t\t\tvalidCfg : {\r\n\t\t\t\tvalidators : {}\r\n\t\t\t}\r\n\t\t},\r\n\t\torderStatus : {\r\n\t\t\ttype : 'combo',\r\n\t\t\tlabel : '',\r\n\t\t\tdefaultVal : '',\r\n\t\t\toptions : Hualala.TypeDef.OrderStatus,\r\n\t\t\tvalidCfg : {\r\n\t\t\t\tvalidators : {}\r\n\t\t\t}\r\n\t\t},\r\n\t\torderTotal : {\r\n\t\t\ttype : 'section',\r\n\t\t\tlabel : '',\r\n\t\t\tmin : {\r\n\t\t\t\ttype : 'text',\r\n\t\t\t\t// prefix : '',\r\n\t\t\t\t// surfix : '',\r\n\t\t\t\tdefaultVal : '',\r\n\t\t\t\tvalidCfg : {\r\n\t\t\t\t\tvalidators : {\r\n\t\t\t\t\t\tnumeric : {\r\n\t\t\t\t\t\t\tmessage: \"\"\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\tgreaterThan : {\r\n\t\t\t\t\t\t\tinclusive : true,\r\n\t\t\t\t\t\t\tvalue : 0,\r\n\t\t\t\t\t\t\tmessage : \"0\"\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tmax : {\r\n\t\t\t\ttype : 'text',\r\n\t\t\t\t// prefix : '',\r\n\t\t\t\t// surfix : '',\r\n\t\t\t\tdefaultVal : '',\r\n\t\t\t\tvalidCfg : {\r\n\t\t\t\t\tvalidators : {\r\n\t\t\t\t\t\tnumeric : {\r\n\t\t\t\t\t\t\tmessage: \"\"\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\tgreaterThan : {\r\n\t\t\t\t\t\t\tinclusive : true,\r\n\t\t\t\t\t\t\tvalue : 0,\r\n\t\t\t\t\t\t\tmessage : \"0\"\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\torderID : {\r\n\t\t\ttype : 'text',\r\n\t\t\tlabel : '',\r\n\t\t\tdefaultVal : '',\r\n\t\t\tvalidCfg : {\r\n\t\t\t\tvalidators : {\r\n\t\t\t\t\tnumeric : {\r\n\t\t\t\t\t\tmessage: \"\"\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\tuserMobile : {\r\n\t\t\ttype : 'text',\r\n\t\t\tlabel : '',\r\n\t\t\tdefaultVal : '',\r\n\t\t\tvalidCfg : {\r\n\t\t\t\tvalidators : {\r\n\t\t\t\t\tnumeric : {\r\n\t\t\t\t\t\tmessage: \"\"\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\tuserLoginMobile : {\r\n\t\t\ttype : 'text',\r\n\t\t\tlabel : '',\r\n\t\t\tdefaultVal : '',\r\n\t\t\tvalidCfg : {\r\n\t\t\t\tvalidators : {\r\n\t\t\t\t\tnumeric : {\r\n\t\t\t\t\t\tmessage: \"\"\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\tfoodCategoryName : {\r\n\t\t\ttype : 'text',\r\n\t\t\tlabel : '',\r\n\t\t\tdefaultVal : '',\r\n\t\t\tvalidCfg : {\r\n\t\t\t\tvalidators : {}\r\n\t\t\t}\r\n\t\t},\r\n\t\tuserName : {\r\n\t\t\ttype : 'text',\r\n\t\t\tlabel : '',\r\n\t\t\tdefaultVal : '',\r\n\t\t\tvalidCfg : {\r\n\t\t\t\tvalidators : {}\r\n\t\t\t}\r\n\t\t},\r\n\t\tbutton : {\r\n\t\t\ttype : 'button',\r\n\t\t\tclz : 'btn btn-block btn-warning',\r\n\t\t\tlabel : ''\r\n\t\t}\r\n\t};\r\n\tvar QueryFormElsHT = new IX.IListManager();\r\n\t_.each(Hualala.Order.QueryFormElsCfg, function (el, k) {\r\n\t\tvar type = $XP(el, 'type');\r\n\t\tvar labelClz = 'col-xs-2 col-sm-2 col-md-4 control-label';\r\n\t\tif (type == 'section') {\r\n\t\t\tvar id = minID = k + '_min_' + IX.id(), maxID = k + '_max_' + IX.id(),\r\n\t\t\t\tminName = k == 'orderTime' ? 'startDate' : 's_orderTotal',\r\n\t\t\t\tmaxName = k == 'orderTime' ? 'endDate' : 'e_orderTotal',\r\n\t\t\t\tmin = IX.inherit($XP(el, 'min', {}), {\r\n\t\t\t\t\tid : minID, name : minName, clz : 'col-xs-5 col-sm-5 col-md-5',\r\n\t\t\t\t}), max = IX.inherit($XP(el, 'max', {}), {\r\n\t\t\t\t\tid : maxID, name : maxName, clz : 'col-xs-5 col-sm-5 col-md-5',\r\n\t\t\t\t});\r\n\t\t\tQueryFormElsHT.register(k, IX.inherit(el, {\r\n\t\t\t\tid : id,\r\n\t\t\t\tlabelClz : 'col-xs-2 col-sm-2 col-md-2 control-label',\r\n\t\t\t\tmin : min,\r\n\t\t\t\tmax : max\r\n\t\t\t}));\r\n\t\t} else {\r\n\t\t\tQueryFormElsHT.register(k, IX.inherit(el, {\r\n\t\t\t\tid : k + '_' + IX.id(),\r\n\t\t\t\tname : k,\r\n\t\t\t\tlabelClz : labelClz,\r\n\t\t\t}, $XP(el, 'type') !== 'button' ? {clz : 'col-xs-8 col-sm-8 col-md-8'} : null));\r\n\t\t}\r\n\t});\r\n\r\n\t/**\r\n\t * \r\n\t * @return {Object}\r\n\t */\r\n\tHualala.Order.mapOrderQueryFormRenderData = function () {\r\n\t\tvar self = this;\r\n\t\tvar queryKeys = self.model.queryKeys;\r\n\t\tvar query = {cols : [\r\n\t\t\t{\r\n\t\t\t\tcolClz : 'col-md-4',\r\n\t\t\t\titems : QueryFormElsHT.getByKeys(['orderTime', 'orderTotal'])\r\n\t\t\t},\r\n\t\t\t{\r\n\t\t\t\tcolClz : 'col-md-2',\r\n\t\t\t\titems : QueryFormElsHT.getByKeys(['cityID', 'shopID'])\r\n\t\t\t},\r\n\t\t\t{\r\n\t\t\t\tcolClz : 'col-md-3',\r\n\t\t\t\titems : QueryFormElsHT.getByKeys(['orderStatus', 'orderID'])\r\n\t\t\t},\r\n\t\t\t{\r\n\t\t\t\tcolClz : 'col-md-3',\r\n\t\t\t\titems : QueryFormElsHT.getByKeys(['userMobile'])\r\n\t\t\t},\r\n\t\t\t{\r\n\t\t\t\tcolClz : 'col-md-offset-1 col-md-2',\r\n\t\t\t\titems : QueryFormElsHT.getByKeys(['button'])\r\n\t\t\t}\r\n\t\t]};\r\n\t\treturn {\r\n\t\t\tquery : query\r\n\t\t};\r\n\t};\r\n\r\n\t/**\r\n\t * ,\r\n\t * @return {Object}\r\n\t */\r\n\tHualala.Order.mapOrderQueryBaseFormRenderData = function () {\r\n\t\tvar self = this;\r\n\t\tvar queryKeys = self.model.queryKeys;\r\n\t\tvar query = {cols : [\r\n\t\t\t{\r\n\t\t\t\tcolClz : 'col-md-4',\r\n\t\t\t\titems : QueryFormElsHT.getByKeys(['orderTime'])\r\n\t\t\t},\r\n\t\t\t{\r\n\t\t\t\tcolClz : 'col-md-2',\r\n\t\t\t\titems : QueryFormElsHT.getByKeys(['cityID'])\r\n\t\t\t},\r\n\t\t\t{\r\n\t\t\t\tcolClz : 'col-md-2',\r\n\t\t\t\titems : QueryFormElsHT.getByKeys(['shopID'])\r\n\t\t\t},\r\n\t\t\t{\r\n\t\t\t\tcolClz : 'col-md-2',\r\n\t\t\t\titems : QueryFormElsHT.getByKeys(['orderStatus'])\r\n\t\t\t},\r\n\t\t\t{\r\n\t\t\t\tcolClz : 'col-md-2',\r\n\t\t\t\titems : QueryFormElsHT.getByKeys(['button'])\r\n\t\t\t}\r\n\t\t]};\r\n\t\treturn {\r\n\t\t\tquery : query\r\n\t\t};\r\n\t};\r\n\r\n\t/**\r\n\t * \r\n\t * @return {Object}\r\n\t */\r\n\tHualala.Order.mapDishesHotQueryFormRenderData = function () {\r\n\t\tvar self = this;\r\n\t\tvar queryKeys = self.model.queryKeys;\r\n\t\tvar query = {cols : [\r\n\t\t\t{\r\n\t\t\t\tcolClz : 'col-md-2',\r\n\t\t\t\titems : QueryFormElsHT.getByKeys(['cityID'])\r\n\t\t\t},\r\n\t\t\t{\r\n\t\t\t\tcolClz : 'col-md-2',\r\n\t\t\t\titems : QueryFormElsHT.getByKeys(['shopID'])\r\n\t\t\t},\r\n\t\t\t{\r\n\t\t\t\tcolClz : 'col-md-4',\r\n\t\t\t\titems : QueryFormElsHT.getByKeys(['orderTime'])\r\n\t\t\t},\r\n\t\t\t{\r\n\t\t\t\tcolClz : 'col-md-2',\r\n\t\t\t\titems : QueryFormElsHT.getByKeys(['foodCategoryName'])\r\n\t\t\t},\r\n\t\t\t{\r\n\t\t\t\tcolClz : 'col-md-2',\r\n\t\t\t\titems : QueryFormElsHT.getByKeys(['button'])\r\n\t\t\t}\r\n\t\t]};\r\n\t\treturn {\r\n\t\t\tquery : query\r\n\t\t};\r\n\t};\r\n\r\n\t/**\r\n\t * \r\n\t * @return {Object}\r\n\t */\r\n\tHualala.Order.mapUsersQueryFormRenderData = function () {\r\n\t\tvar self = this;\r\n\t\tvar queryKeys = self.model.queryKeys;\r\n\t\tvar query = {cols : [\r\n\t\t\t{\r\n\t\t\t\tcolClz : 'col-md-3',\r\n\t\t\t\titems : QueryFormElsHT.getByKeys(['cityID'])\r\n\t\t\t},\r\n\t\t\t{\r\n\t\t\t\tcolClz : 'col-md-3',\r\n\t\t\t\titems : QueryFormElsHT.getByKeys(['shopID'])\r\n\t\t\t},\r\n\t\t\t{\r\n\t\t\t\tcolClz : 'col-md-4',\r\n\t\t\t\titems : QueryFormElsHT.getByKeys(['orderTime'])\r\n\t\t\t},\r\n\t\t\t\r\n\t\t\t{\r\n\t\t\t\tcolClz : 'col-md-3',\r\n\t\t\t\titems : QueryFormElsHT.getByKeys(['userLoginMobile'])\r\n\t\t\t},\r\n\t\t\t{\r\n\t\t\t\tcolClz : 'col-md-3',\r\n\t\t\t\titems : QueryFormElsHT.getByKeys(['userName'])\r\n\t\t\t},\r\n\t\t\t{\r\n\t\t\t\tcolClz : 'col-md-offset-4 col-md-2',\r\n\t\t\t\titems : QueryFormElsHT.getByKeys(['button'])\r\n\t\t\t}\r\n\t\t]};\r\n\t\treturn {\r\n\t\t\tquery : query\r\n\t\t};\r\n\t};\r\n\r\n\tvar QueryView = Stapes.subclass({\r\n\t\t/**\r\n\t\t * View\r\n\t\t * @param  {Object} cfg\r\n\t\t * \t\t\t@param {Function} mapRenderDataFn \r\n\t\t * @return {Object}\r\n\t\t */\r\n\t\tconstructor : function (cfg) {\r\n\t\t\tthis.isReady = false;\r\n\t\t\tthis.$container = null;\r\n\t\t\tthis.$queryBox = null;\r\n\t\t\tthis.loadTemplates();\r\n\t\t\tthis.set('mapRenderDataFn', $XF(cfg, 'mapRenderDataFn'));\r\n\t\t}\r\n\t});\r\n\r\n\tQueryView.proto({\r\n\t\tinit : function (cfg) {\r\n\t\t\tthis.model = $XP(cfg, 'model', null);\r\n\t\t\tthis.$container = $XP(cfg, 'container', null);\r\n\t\t\tif (!this.model || !this.$container || this.$container.length == 0) {\r\n\t\t\t\tthrow(\"Init Query View Failed!!\");\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tthis.renderLayout();\r\n\t\t\tthis.bindEvent();\r\n\t\t\tthis.isReady = true;\r\n\t\t\tthis.emit('query', this.getQueryParams());\r\n\t\t},\r\n\t\t// View\r\n\t\thasReady : function () {return this.isReady;},\r\n\t\tloadTemplates : function () {\r\n\t\t\tvar self = this;\r\n\t\t\tvar layoutTpl = Handlebars.compile(Hualala.TplLib.get('tpl_order_queryLayout')),\r\n\t\t\t\tcomboOptsTpl = Handlebars.compile(Hualala.TplLib.get('tpl_order_comboOpts'));\r\n\t\t\tHandlebars.registerPartial(\"orderQueryForm\", Hualala.TplLib.get('tpl_order_queryForm'));\r\n\t\t\tHandlebars.registerHelper('checkFormElementType', function (conditional, options) {\r\n\t\t\t\treturn (conditional == options.hash.type) ? options.fn(this) : options.inverse(this);\r\n\t\t\t});\r\n\t\t\tHandlebars.registerHelper('isInputGroup', function (prefix, surfix, options) {\r\n\t\t\t\treturn (!prefix && !surfix) ? options.inverse(this) : options.fn(this);\r\n\t\t\t});\r\n\t\t\tthis.set({\r\n\t\t\t\tlayoutTpl : layoutTpl,\r\n\t\t\t\tcomboOptsTpl : comboOptsTpl\r\n\t\t\t});\r\n\t\t},\r\n\t\tinitQueryFormEls : function () {\r\n\t\t\tvar self = this,\r\n\t\t\t\tels = self.model.getQueryParams(),\r\n\t\t\t\tcityID = $XP(els, 'cityID', ''),\r\n\t\t\t\tshopID = $XP(els, 'shopID', '');\r\n\t\t\tself.initCityComboOpts(cityID);\r\n\t\t\tself.initShopComboOpts(cityID, shopID);\r\n\t\t\t_.each(els, function (v, k) {\r\n\t\t\t\tif (k == 'startDate' || k == 'endDate') {\r\n\t\t\t\t\tv = IX.isEmpty(v) ? '' : IX.Date.getDateByFormat(Hualala.Common.formatDateTimeValue(v), 'yyyy/MM/dd');\r\n\t\t\t\t}\r\n\t\t\t\tself.$queryBox.find('[name=' + k + ']').val(v);\r\n\t\t\t});\r\n\t\t},\r\n\t\tinitCityComboOpts : function (curCityID) {\r\n\t\t\tvar self = this,\r\n\t\t\t\tcities = self.model.getCities();\r\n\t\t\tif (IX.isEmpty(cities)) return ;\r\n\t\t\tcities = _.map(cities, function (city) {\r\n\t\t\t\tvar id = $XP(city, 'cityID', ''), name = $XP(city, 'cityName', '');\r\n\t\t\t\treturn {\r\n\t\t\t\t\tvalue : id,\r\n\t\t\t\t\tlabel : name,\r\n\t\t\t\t\tselected : id == curCityID ? 'selected' : ''\r\n\t\t\t\t};\r\n\t\t\t});\r\n\t\t\tcities.unshift({\r\n\t\t\t\tvalue : '',\r\n\t\t\t\tlabel : '',\r\n\t\t\t\tselected : IX.isEmpty(curCityID) ? 'selected' : ''\r\n\t\t\t});\r\n\t\t\tvar optTpl = self.get('comboOptsTpl'),\r\n\t\t\t\thtm = optTpl({\r\n\t\t\t\t\topts : cities\r\n\t\t\t\t}),\r\n\t\t\t\t$select = self.$queryBox.find('select[name=cityID]');\r\n\t\t\t$select.html(htm);\r\n\t\t},\r\n\t\tinitShopComboOpts : function (curCityID, curShopID) {\r\n\t\t\tvar self = this,\r\n\t\t\t\tshops = IX.isEmpty(curCityID) ? self.model.getShops() : self.model.getShopsByCityID(curCityID);\r\n\t\t\tif (IX.isEmpty(shops)) return;\r\n\t\t\tshops = _.map(shops, function (shop) {\r\n\t\t\t\tvar id = $XP(shop, 'shopID', ''), name = $XP(shop, 'shopName', '');\r\n\t\t\t\treturn {\r\n\t\t\t\t\tvalue : id,\r\n\t\t\t\t\tlabel : name,\r\n\t\t\t\t\tselected : id == curShopID ? 'selected' : ''\r\n\t\t\t\t};\r\n\t\t\t});\r\n\t\t\tshops.unshift({\r\n\t\t\t\tvalue : '',\r\n\t\t\t\tlabel : '',\r\n\t\t\t\tselected : IX.isEmpty(curShopID) ? 'selected' : ''\r\n\t\t\t});\r\n\t\t\tvar optTpl = self.get('comboOptsTpl'),\r\n\t\t\t\thtm = optTpl({\r\n\t\t\t\t\topts : shops\r\n\t\t\t\t}),\r\n\t\t\t\t$select = self.$queryBox.find('select[name=shopID]');\r\n\t\t\t$select.html(htm);\r\n\t\t},\r\n\t\tinitQueryEls : function () {\r\n\t\t\tvar self = this;\r\n\t\t\tself.$queryBox.find('[data-type=datetimepicker]').datetimepicker({\r\n\t\t\t\tformat : 'yyyy/mm/dd',\r\n\t\t\t\tstartDate : '2010/01/01',\r\n\t\t\t\tautoclose : true,\r\n\t\t\t\tminView : 'month',\r\n\t\t\t\ttodayBtn : true,\r\n\t\t\t\ttodayHighlight : true,\r\n\t\t\t\tlanguage : 'zh-CN'\r\n\t\t\t});\r\n\t\t\tself.$queryBox.on('click', '.input-group-addon', function (e) {\r\n\t\t\t\tvar $this = $(this),\r\n\t\t\t\t\t$picker = $this.prev(':text[data-type=datetimepicker]');\r\n\t\t\t\tif ($picker.length > 0) {\r\n\t\t\t\t\t$picker.datetimepicker('show');\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t},\r\n\t\tmapRenderLayoutData : function () {\r\n\t\t\tvar mapFn = this.get('mapRenderDataFn');\r\n\t\t\treturn IX.isFn(mapFn) && mapFn.apply(this);\r\n\t\t},\r\n\t\trenderLayout : function () {\r\n\t\t\tvar self = this,\r\n\t\t\t\tlayoutTpl = self.get('layoutTpl'),\r\n\t\t\t\tmodel = self.model;\r\n\t\t\tvar renderData = self.mapRenderLayoutData();\r\n\t\t\tvar html = layoutTpl(renderData);\r\n\t\t\tself.$queryBox = $(html);\r\n\t\t\tself.$container.html(self.$queryBox);\r\n\t\t\tself.initQueryFormEls();\r\n\t\t\tself.initQueryEls();\r\n\t\t},\r\n\t\tbindEvent : function () {\r\n\t\t\tvar self = this;\r\n\t\t\tself.$queryBox.on('change', 'select', function (e) {\r\n\t\t\t\tvar $this = $(this),\r\n\t\t\t\t\tv = $this.val();\r\n\t\t\t\tself.initShopComboOpts(v, '');\r\n\t\t\t});\r\n\t\t\tself.$queryBox.on('click', '.btn.btn-warning', function (e) {\r\n\t\t\t\tvar $this = $(this);\r\n\t\t\t\tself.emit('query', self.getQueryParams());\r\n\t\t\t});\r\n\t\t},\r\n\t\tgetQueryParams : function () {\r\n\t\t\tvar self = this,\r\n\t\t\t\tkeys = self.model.queryKeys,\r\n\t\t\t\t$form = self.$queryBox.find('form'),\r\n\t\t\t\tels = $form.serializeArray();\r\n\t\t\tels = _.map(els, function (el) {\r\n\t\t\t\tvar n = $XP(el, 'name'), v = $XP(el, 'value', '');\r\n\t\t\t\tif (n == 'startDate' || n == 'endDate') {\r\n\t\t\t\t\tv = IX.isEmpty(v) ? '' : IX.Date.getDateByFormat(v, 'yyyyMMddHHmmss');\r\n\t\t\t\t\treturn {\r\n\t\t\t\t\t\tname : n,\r\n\t\t\t\t\t\tvalue : v\r\n\t\t\t\t\t};\r\n\t\t\t\t}\r\n\t\t\t\treturn el;\r\n\t\t\t});\r\n\t\t\tels = _.object(_.pluck(els, 'name'), _.pluck(els, 'value'));\r\n\t\t\tself.model.set(els);\r\n\t\t\treturn els;\r\n\t\t}\r\n\r\n\t});\r\n\r\n\tHualala.Order.QueryView = QueryView;\r\n})(jQuery, window);;(function ($, window) {\r\n\tIX.ns(\"Hualala.Order\");\r\n\tvar popoverMsg = Hualala.UI.PopoverMsgTip;\r\n\tvar toptip = Hualala.UI.TopTip;\r\n\t\r\n\tvar QueryController = Hualala.Shop.QueryController.subclass({\r\n\t\t/**\r\n\t\t * \r\n\t\t * @param  {Object} cfg \r\n\t\t * \t\t\t@param {JQueryObj} container \r\n\t\t * \t\t\t@param {Object} resultController \r\n\t\t * \t\t\t@param {Object} model \r\n\t\t * \t\t\t@param {Object} view \r\n\t\t * @return {Object}\t\r\n\t\t */\r\n\t\tconstructor : function (cfg) {\r\n\t\t\tthis.set({\r\n\t\t\t\tsessionData : Hualala.getSessionData()\r\n\t\t\t});\r\n\t\t\tthis.container = $XP(cfg, 'container', null);\r\n\t\t\tthis.resultController = $XP(cfg, 'resultController', null);\r\n\t\t\tthis.model = $XP(cfg, 'model', null);\r\n\t\t\tthis.view = $XP(cfg, 'view', null);\r\n\t\t\tif (!this.container || !this.model || !this.view || !this.resultController) {\r\n\t\t\t\tthrow(\"QueryController init faild!\");\r\n\t\t\t}\r\n\t\t\tthis.init();\r\n\t\t}\r\n\t});\r\n\tQueryController.proto({\r\n\t\t// \r\n\t\tbindEvent : function () {\r\n\t\t\t// \r\n\t\t\tthis.on({\r\n\t\t\t\treload : function () {\r\n\t\t\t\t\tvar self = this;\r\n\t\t\t\t\tself.model.distory();\r\n\t\t\t\t\tself.view.distory();\r\n\t\t\t\t\tself.init();\r\n\t\t\t\t},\r\n\t\t\t\tquery : function (params) {\r\n\t\t\t\t\tvar self = this;\r\n\t\t\t\t\tvar cities = self.model.getCities();\r\n\t\t\t\t\tconsole.info('query params:');\r\n\t\t\t\t\tconsole.info(params);\r\n\t\t\t\t\tself.resultController && self.resultController.emit('load', {\r\n\t\t\t\t\t\tparams : IX.inherit(params, {\r\n\t\t\t\t\t\t\tpageNo : 1,\r\n\t\t\t\t\t\t\tpageSize : 15\r\n\t\t\t\t\t\t}),\r\n\t\t\t\t\t\tcities : cities\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t}, this);\r\n\t\t\t// \r\n\t\t\tthis.model.on({\r\n\t\t\t\tload : function (cbFn) {\r\n\t\t\t\t\tvar self = this,\r\n\t\t\t\t\t\tparams = $XP(self.get('sessionData'), 'user', {});\r\n\t\t\t\t\tself.model.init(params, cbFn);\r\n\t\t\t\t}\r\n\t\t\t}, this);\r\n\t\t\t// \r\n\t\t\tthis.view.on({\r\n\t\t\t\tinit : function () {\r\n\t\t\t\t\tvar self = this;\r\n\t\t\t\t\tself.view.init({\r\n\t\t\t\t\t\tmodel : self.model,\r\n\t\t\t\t\t\tneedShopCreate : self.needShopCreate,\r\n\t\t\t\t\t\tcontainer : self.container\r\n\t\t\t\t\t});\r\n\t\t\t\t},\r\n\t\t\t\t// \r\n\t\t\t\tfilter : function (params) {\r\n\t\t\t\t\tvar self = this;\r\n\t\t\t\t\tself.emit('query', params);\r\n\t\t\t\t\t//TODO QuerychosenPanel\r\n\t\t\t\t},\r\n\t\t\t\t// \r\n\t\t\t\tquery : function (params) {\r\n\t\t\t\t\tvar self = this;\r\n\t\t\t\t\tself.emit('query', params);\r\n\t\t\t\t}\r\n\t\t\t}, this);\r\n\t\t}\r\n\t});\r\n\tHualala.Order.QueryController = QueryController;\r\n})(jQuery, window);;(function ($, window) {\r\n\tIX.ns(\"Hualala.Order\");\r\n\t/**/\r\n\tvar initOrderPageLayout = function () {\r\n\t\tvar ctx = Hualala.PageRoute.getPageContextByPath();\r\n\t\tvar $body = $('#ix_wrapper > .ix-body > .container');\r\n\t\t$body.empty();\r\n\t\tvar mapNavRenderData = function () {\r\n\t\t\tvar navs = _.map(Hualala.TypeDef.OrderSubNavType, function (v, i, list) {\r\n\t\t\t\tvar params = _.map($XP(v, 'pkeys', []), function (v) {\r\n\t\t\t\t\treturn '';\r\n\t\t\t\t});\r\n\r\n\t\t\t\treturn {\r\n\t\t\t\t\tactive : $XP(ctx, 'name') == v.name ? 'active' : '',\r\n\t\t\t\t\tdisabled : '',\r\n\t\t\t\t\tpath : Hualala.PageRoute.createPath(v.name, params) || '#',\r\n\t\t\t\t\tname : v.name,\r\n\t\t\t\t\tlabel : v.label,\r\n\t\t\t\t};\r\n\t\t\t});\r\n\t\t\treturn {\r\n\t\t\t\ttoggle : {\r\n\t\t\t\t\ttarget : '#order_navbar'\r\n\t\t\t\t},\r\n\t\t\t\titems : navs\r\n\t\t\t};\r\n\t\t};\r\n\t\tvar navTpl = Handlebars.compile(Hualala.TplLib.get('tpl_order_subnav'));\r\n\t\tHandlebars.registerPartial(\"toggle\", Hualala.TplLib.get('tpl_site_navbarToggle'));\r\n\t\t$body.html('<div class=\"order-subnav clearfix\" /><div class=\"order-body\" ><div class=\"order-query-box\"></div><div class=\"order-result-box\"></div></div>');\r\n\t\tvar $navbar = $body.find('.order-subnav'),\r\n\t\t\t$pageBody = $body.find('.order-body');\r\n\t\t$navbar.html(navTpl(mapNavRenderData()));\r\n\t};\r\n\t/**/\r\n\tvar initOrderChartPage = function () {\r\n\t\tvar ctx = Hualala.PageRoute.getPageContextByPath();\r\n\t\tvar $body = $('#ix_wrapper > .ix-body > .container');\r\n\t\tinitOrderPageLayout();\r\n\r\n\t};\r\n\t/**/\r\n\tvar initQueryOrderPage = function () {\r\n\t\tvar ctx = Hualala.PageRoute.getPageContextByPath();\r\n\t\tvar $body = $('#ix_wrapper > .ix-body > .container');\r\n\t\tinitOrderPageLayout();\r\n\t\tvar $pageBody = $body.find('.order-body');\r\n\t\tvar queryKeys = $XP(_.findWhere(Hualala.TypeDef.OrderSubNavType, {name : $XP(ctx, 'name')}), 'pkeys');\r\n\t\tvar queryPanel = new Hualala.Order.QueryController({\r\n\t\t\tcontainer : $pageBody,\r\n\t\t\tresultController : new Hualala.Order.OrderListController({\r\n\t\t\t\tcontainer : $pageBody,\r\n\t\t\t\tmodel : new Hualala.Order.OrderQueryResultModel({\r\n\t\t\t\t\tcallServer : Hualala.Global.queryOrderDetail,\r\n\t\t\t\t\tqueryKeys : queryKeys,\r\n\t\t\t\t\tinitQueryParams : Hualala.Order.initQueryParams\r\n\t\t\t\t}),\r\n\t\t\t\tview : new Hualala.Order.OrderQueryResultView({\r\n\t\t\t\t\tmapResultRenderData : Hualala.Order.mapQueryOrderResultRenderData,\r\n\t\t\t\t\trenderResult : Hualala.Order.renderQueryOrderResult\r\n\t\t\t\t})\r\n\t\t\t}),\r\n\t\t\tmodel : new Hualala.Order.QueryModel({\r\n\t\t\t\tqueryKeys : queryKeys,\r\n\t\t\t\tinitQueryParams : Hualala.Order.initQueryParams\r\n\t\t\t}),\r\n\t\t\tview : new Hualala.Order.QueryView({\r\n\t\t\t\tmapRenderDataFn : Hualala.Order.mapOrderQueryFormRenderData\r\n\t\t\t})\r\n\t\t});\r\n\t};\r\n\t/**/\r\n\tvar initQueryOrderDayDetailPage = function () {\r\n\t\tvar ctx = Hualala.PageRoute.getPageContextByPath();\r\n\t\tvar $body = $('#ix_wrapper > .ix-body > .container');\r\n\t\tinitOrderPageLayout();\r\n\t\tvar $pageBody = $body.find('.order-body');\r\n\t\tvar queryKeys = $XP(_.findWhere(Hualala.TypeDef.OrderSubNavType, {name : $XP(ctx, 'name')}), 'pkeys');\r\n\t\tvar queryPanel = new Hualala.Order.QueryController({\r\n\t\t\tcontainer : $pageBody,\r\n\t\t\tresultController : new Hualala.Order.OrderListController({\r\n\t\t\t\tcontainer : $pageBody,\r\n\t\t\t\tmodel : new Hualala.Order.OrderQueryResultModel({\r\n\t\t\t\t\tcallServer : Hualala.Global.queryOrderDayDetail,\r\n\t\t\t\t\tqueryKeys : queryKeys,\r\n\t\t\t\t\tinitQueryParams : Hualala.Order.initQueryParams\r\n\t\t\t\t}),\r\n\t\t\t\tview : new Hualala.Order.OrderQueryResultView({\r\n\t\t\t\t\tmapResultRenderData : Hualala.Order.mapQueryOrderDuringRenderData,\r\n\t\t\t\t\trenderResult : Hualala.Order.renderQueryOrderResult\r\n\t\t\t\t})\r\n\t\t\t}),\r\n\t\t\tmodel : new Hualala.Order.QueryModel({\r\n\t\t\t\tqueryKeys : queryKeys,\r\n\t\t\t\tinitQueryParams : Hualala.Order.initQueryParams\r\n\t\t\t}),\r\n\t\t\tview : new Hualala.Order.QueryView({\r\n\t\t\t\tmapRenderDataFn : Hualala.Order.mapOrderQueryBaseFormRenderData\r\n\t\t\t})\r\n\t\t});\r\n\t};\r\n\t/**/\r\n\tvar initQueryOrderDuringDetailPage = function () {\r\n\t\tvar ctx = Hualala.PageRoute.getPageContextByPath();\r\n\t\tvar $body = $('#ix_wrapper > .ix-body > .container');\r\n\t\tinitOrderPageLayout();\r\n\t\tvar $pageBody = $body.find('.order-body');\r\n\t\tvar queryKeys = $XP(_.findWhere(Hualala.TypeDef.OrderSubNavType, {name : $XP(ctx, 'name')}), 'pkeys');\r\n\t\tvar queryPanel = new Hualala.Order.QueryController({\r\n\t\t\tcontainer : $pageBody,\r\n\t\t\tresultController : new Hualala.Order.OrderListController({\r\n\t\t\t\tcontainer : $pageBody,\r\n\t\t\t\tmodel : new Hualala.Order.OrderQueryResultModel({\r\n\t\t\t\t\tcallServer : Hualala.Global.queryOrderDuringDetail,\r\n\t\t\t\t\tqueryKeys : queryKeys,\r\n\t\t\t\t\tinitQueryParams : Hualala.Order.initQueryParams\r\n\t\t\t\t}),\r\n\t\t\t\tview : new Hualala.Order.OrderQueryResultView({\r\n\t\t\t\t\tmapResultRenderData : Hualala.Order.mapQueryOrderDuringRenderData,\r\n\t\t\t\t\trenderResult : Hualala.Order.renderQueryOrderResult\r\n\t\t\t\t})\r\n\t\t\t}),\r\n\t\t\tmodel : new Hualala.Order.QueryModel({\r\n\t\t\t\tqueryKeys : queryKeys,\r\n\t\t\t\tinitQueryParams : Hualala.Order.initQueryParams\r\n\t\t\t}),\r\n\t\t\tview : new Hualala.Order.QueryView({\r\n\t\t\t\tmapRenderDataFn : Hualala.Order.mapOrderQueryBaseFormRenderData\r\n\t\t\t})\r\n\t\t});\r\n\t};\r\n\t/**/\r\n\tvar initQueryOrderDishesHotPage = function () {\r\n\t\tvar ctx = Hualala.PageRoute.getPageContextByPath();\r\n\t\tvar $body = $('#ix_wrapper > .ix-body > .container');\r\n\t\tinitOrderPageLayout();\r\n\t\tvar $pageBody = $body.find('.order-body');\r\n\t\tvar queryKeys = $XP(_.findWhere(Hualala.TypeDef.OrderSubNavType, {name : $XP(ctx, 'name')}), 'pkeys');\r\n\t\tvar queryPanel = new Hualala.Order.QueryController({\r\n\t\t\tcontainer : $pageBody,\r\n\t\t\tresultController : new Hualala.Order.OrderListController({\r\n\t\t\t\tcontainer : $pageBody,\r\n\t\t\t\tmodel : new Hualala.Order.OrderQueryResultModel({\r\n\t\t\t\t\thasPager : false,\r\n\t\t\t\t\tcallServer : Hualala.Global.queryOrderDishesHot,\r\n\t\t\t\t\tqueryKeys : queryKeys,\r\n\t\t\t\t\tinitQueryParams : Hualala.Order.initQueryParams\r\n\t\t\t\t}),\r\n\t\t\t\tview : new Hualala.Order.OrderQueryResultView({\r\n\t\t\t\t\tmapResultRenderData : Hualala.Order.mapQueryDishesHotRenderData,\r\n\t\t\t\t\trenderResult : Hualala.Order.renderQueryOrderResult\r\n\t\t\t\t})\r\n\t\t\t}),\r\n\t\t\tmodel : new Hualala.Order.QueryModel({\r\n\t\t\t\tqueryKeys : queryKeys,\r\n\t\t\t\tinitQueryParams : Hualala.Order.initQueryParams\r\n\t\t\t}),\r\n\t\t\tview : new Hualala.Order.QueryView({\r\n\t\t\t\tmapRenderDataFn : Hualala.Order.mapDishesHotQueryFormRenderData\r\n\t\t\t})\r\n\t\t});\r\n\t};\r\n\t/**/\r\n\tvar initQueryOrderCustomerPage = function () {\r\n\t\tvar ctx = Hualala.PageRoute.getPageContextByPath();\r\n\t\tvar $body = $('#ix_wrapper > .ix-body > .container');\r\n\t\tinitOrderPageLayout();\r\n\t\tvar $pageBody = $body.find('.order-body');\r\n\t\tvar queryKeys = $XP(_.findWhere(Hualala.TypeDef.OrderSubNavType, {name : $XP(ctx, 'name')}), 'pkeys');\r\n\t\tvar queryPanel = new Hualala.Order.QueryController({\r\n\t\t\tcontainer : $pageBody,\r\n\t\t\tresultController : new Hualala.Order.OrderListController({\r\n\t\t\t\tcontainer : $pageBody,\r\n\t\t\t\tmodel : new Hualala.Order.OrderQueryResultModel({\r\n\t\t\t\t\thasPager : false,\r\n\t\t\t\t\tcallServer : Hualala.Global.queryUserOrderStatistic,\r\n\t\t\t\t\tqueryKeys : queryKeys,\r\n\t\t\t\t\tinitQueryParams : Hualala.Order.initQueryParams\r\n\t\t\t\t}),\r\n\t\t\t\tview : new Hualala.Order.OrderQueryResultView({\r\n\t\t\t\t\tmapResultRenderData : Hualala.Order.mapQueryUserRenderData,\r\n\t\t\t\t\trenderResult : Hualala.Order.renderQueryOrderResult\r\n\t\t\t\t}) \r\n\t\t\t}),\r\n\t\t\tmodel : new Hualala.Order.QueryModel({\r\n\t\t\t\tqueryKeys : queryKeys,\r\n\t\t\t\tinitQueryParams : Hualala.Order.initQueryParams\r\n\t\t\t}),\r\n\t\t\tview : new Hualala.Order.QueryView({\r\n\t\t\t\tmapRenderDataFn : Hualala.Order.mapUsersQueryFormRenderData\r\n\t\t\t})\r\n\t\t});\r\n\t};\r\n\r\n\r\n\tHualala.Order.OrderPageLayoutInit = initOrderPageLayout;\r\n\tHualala.Order.OrderChartInit = initOrderChartPage;\r\n\tHualala.Order.QueryOrderInit = initQueryOrderPage;\r\n\tHualala.Order.QueryOrderByDayDetailInit = initQueryOrderDayDetailPage;\r\n\tHualala.Order.QueryOrderByDuringDetailInit = initQueryOrderDuringDetailPage;\r\n\tHualala.Order.QueryOrderDishesHotInit = initQueryOrderDishesHotPage;\r\n\tHualala.Order.QueryOrderCustomerInit = initQueryOrderCustomerPage;\r\n\r\n})(jQuery, window);;(function ($, window) {\r\n\tIX.ns(\"Hualala.Common\");\r\n\tvar pageBrickConfigs = [\r\n\t\t{name : 'account', title : '', label : '..', brickClz : 'home-brick-md-2', itemClz : 'brick-item brick-item-2', icon : 'icon-pay'},\r\n\t\t{name : 'order', title : '', label : '.', brickClz : 'home-brick-md-3', itemClz : 'brick-item', icon : 'icon-order'},\r\n\t\t{name : 'shop', title : '', label : '..', brickClz : 'home-brick-md-1', itemClz : 'brick-item', icon : 'icon-home'},\r\n\t\t{name : 'pcclient', title : '', label : '', brickClz : 'home-brick-md-1', itemClz : 'brick-item', icon : 'icon-download'},\r\n\t\t{name : 'user', title : '', label : '.', brickClz : 'home-brick-md-1', itemClz : 'brick-item', icon : 'icon-lock'},\r\n\t\t{name : 'setting', title : '', label : '.', brickClz : 'home-brick-md-2', itemClz : 'brick-item', icon : 'icon-setting'}\r\n\t];\r\n\tfunction isSupportedBrowser () {\r\n\t\tvar bd = Hualala.Common.Browser;\r\n\t\tvar isIE = !$XP(bd, 'ie', null) ? false : true,\r\n\t\t\tversion = parseInt($XP(bd, 'ie', 0));\r\n\t\tvar allowOldVersion = IX.Cookie.get('allowOldVersion') == 1 ? true : false;\r\n\t\tif (!isIE || allowOldVersion) return true;\r\n\t\tif (version > 8) return true;\r\n\t\tvar msg = version == 8 ? \r\n\t\t\t'IE<br/>' : \r\n\t\t\t'IE<br/>';\r\n\t\tvar browserLib = [\r\n\t\t\t{\r\n\t\t\t\thref : '',\r\n\t\t\t\ticon : '',\r\n\t\t\t\tname : 'IE10',\r\n\t\t\t\tdesc : 'IE10HTML5CSS3'\r\n\t\t\t},\r\n\t\t\t{\r\n\t\t\t\thref : '',\r\n\t\t\t\ticon : '',\r\n\t\t\t\tname : 'IE11',\r\n\t\t\t\tdesc : 'IE11HTML5CSS3'\r\n\t\t\t},\r\n\t\t\t{\r\n\t\t\t\thref : '',\r\n\t\t\t\ticon : '',\r\n\t\t\t\tname : 'Chrome',\r\n\t\t\t\tdesc : 'ChromeHTML5CSS3'\r\n\t\t\t},\r\n\t\t\t{\r\n\t\t\t\thref : '',\r\n\t\t\t\ticon : '',\r\n\t\t\t\tname : 'Firefox',\r\n\t\t\t\tdesc : 'FireFoxMozillaHTML5CSS3'\r\n\t\t\t}\r\n\t\t];\r\n\t\tvar tpl = Handlebars.compile(Hualala.TplLib.get('tpl_site_browserSupport'));\r\n\t\tvar $jumbotron = $(tpl({msg : msg, items : browserLib}));\r\n\t\t$('body > #ix_wrapper').remove();\r\n\t\t$jumbotron.appendTo($('body'));\r\n\t\t$jumbotron.find('.btn').click(function (e) {\r\n\t\t\tIX.Cookie.set('allowOldVersion', 1);\r\n\t\t\tHualala.Router.check();\r\n\t\t});\r\n\t\treturn false;\r\n\t}\r\n\tfunction initPageLayout (pageCfg, pageType) {\r\n\t\tvar session = Hualala.getSessionData(),\r\n\t\t\tlayoutTpl = Handlebars.compile(Hualala.TplLib.get('tpl_site_layout'));\r\n\t\tvar isLogin = !$XP(Hualala.getSessionUser(), 'loginName', null) ? false : true,\r\n\t\t\tloginName = $XP(session, 'user.loginName', ''),\r\n\t\t\tgroupName = $XP(session, 'site.groupName', '');\r\n\t\tvar mapRanderData = function () {\r\n\t\t\tvar header = {\r\n\t\t\t\tpcClientPath : Hualala.PageRoute.createPath('pcclient'),\r\n\t\t\t\thualalaUrl : Hualala.Global.HualalaWebSite,\r\n\t\t\t\tloginName : loginName,\r\n\t\t\t\tmerchantRoot : Hualala.PageRoute.createPath('main'),\r\n\t\t\t\tgroupName : groupName,\r\n\t\t\t\t// isLogin : !isLogin ? 'hidden' : '',\r\n\t\t\t\tisLogin : isLogin,\r\n\t\t\t\tlogoutPath : Hualala.Global.getLogoutJumpToUrl(),\r\n\t\t\t\tlogo : Hualala.Global.getDefaultImage('logo'),\r\n\t\t\t},\r\n\t\t\tfooter = {\r\n\t\t\t\taboutPath : Hualala.PageRoute.createPath(\"about\") || '#',\r\n\t\t\t\tcontactPath : Hualala.PageRoute.createPath(\"contact\") || '#',\r\n\t\t\t\tgozapLogo : Hualala.Global.getDefaultImage('gozap')\r\n\t\t\t};\r\n\t\t\treturn {\r\n\t\t\t\theader : header,\r\n\t\t\t\tfooter : footer\r\n\t\t\t};\r\n\t\t};\r\n\t\tvar $wrapper = $(layoutTpl(mapRanderData()));\r\n\t\t$('body > #ix_wrapper').remove();\r\n\t\tif (isSupportedBrowser()) {\r\n\t\t\t$wrapper.appendTo($('body'));\r\n\t\t}\r\n\t\tif ($.fn.bootstrapValidator) {\r\n\t\t\t$.fn.bootstrapValidator.DEFAULT_OPTIONS = $.extend({}, $.fn.bootstrapValidator.DEFAULT_OPTIONS, {\r\n\t\t\t\tmessage: '',\r\n                trigger: 'blur',\r\n\t\t\t\tfeedbackIcons : {\r\n\t\t\t\t\tvalid : 'glyphicon glyphicon-ok',\r\n\t\t\t\t\tinvalid : 'glyphicon glyphicon-remove',\r\n\t\t\t\t\tvalidating : 'glyphicon glyphicon-refresh'\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\t$.fn.bootstrapValidator.validators.accuracy = {\r\n\t\t\t\tvalidate : function (validator, $field, options) {\r\n\t\t\t\t\tvar accuracy = $XP(options, 'accuracy', null),\r\n\t\t\t\t\t\tmessage = $XP(options, 'message', '');\r\n\t\t\t\t\taccuracy = isNaN(accuracy) ? null : accuracy;\r\n\t\t\t\t\tvar value = $field.val();\r\n\t\t\t\t\tvar regxStr = (IX.isEmpty(accuracy) || accuracy == 0) ? \"^\\\\d+$\" : \"^\\\\d+(\\\\.\\\\d{1,\" + accuracy + \"})?$\",\r\n\t\t\t\t\t\tregX = null;\r\n\t\t\t\t\tregX = new RegExp(regxStr);\r\n\t\t\t\t\tif (isNaN(value)) {\r\n\t\t\t\t\t\treturn {\r\n\t\t\t\t\t\t\tvalid : false,\r\n\t\t\t\t\t\t\tmessage : \"\"\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (!regX.test(value)) {\r\n\t\t\t\t\t\treturn {\r\n\t\t\t\t\t\t\tvalid : false,\r\n\t\t\t\t\t\t\tmessage : message\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn true;\r\n\t\t\t\t}\r\n\t\t\t};\r\n\t\t}\r\n\t}\r\n\r\n\tfunction initSiteNavBar (pageType) {\r\n\t\tvar session = Hualala.getSessionData(),\r\n\t\t\tnavTpl = Handlebars.compile(Hualala.TplLib.get('tpl_site_navbar')),\r\n\t\t\tnavToggleTpl = Handlebars.compile(Hualala.TplLib.get('tpl_site_navbarToggle'));\r\n\t\tvar mapRanderData = function () {\r\n\t\t\tvar navs = _.map(Hualala.TypeDef.SiteNavType, function (v, i, list) {\r\n\t\t\t\treturn {\r\n\t\t\t\t\tactive : !Hualala.Global.isCurrentPage(v.name) ? '' : 'active',\r\n\t\t\t\t\tdisabled : '',\r\n\t\t\t\t\tpath : Hualala.PageRoute.createPath(v.name) || '#',\r\n\t\t\t\t\tname : v.name,\r\n\t\t\t\t\tlabel : v.label,\r\n\t\t\t\t};\r\n\t\t\t});\r\n\t\t\treturn {items : navs};\r\n\t\t};\r\n\t\tvar $navbar = $(navTpl(mapRanderData())),\r\n\t\t\t$navToggle = $(navToggleTpl({target : '#site_navbar'})),\r\n\t\t\t$header = $('#ix_wrapper .ix-header');\r\n\t\t$header.find('> .container .navbar-collapse').remove();\r\n\t\t$header.find('> .container').append($navbar);\r\n\t\t$header.find('> .container > .navbar-header .navbar-toggle').remove();\r\n\t\t$header.find('> .container > .navbar-header').prepend($navToggle);\r\n\r\n\t}\r\n\r\n\tfunction initHomePage (pageType, params) {\r\n\t\tvar site = Hualala.getSessionSite(),\r\n\t\t\tuser = Hualala.getSessionUser(),\r\n\t\t\troles = Hualala.getSessionRoles(),\r\n\t\t\tpcclient = Hualala.getSessionPCClient(),\r\n\t\t\trights = Hualala.getSessionUserRight();\r\n\t\tvar $body = $('#ix_wrapper > .ix-body > .container');\r\n\t\tvar mapRanderData = function () {\r\n\t\t\tvar ht = new IX.IListManager();\r\n\t\t\tvar ret = null;\r\n\t\t\tIX.iterate(rights, function (el) {\r\n\t\t\t\tht.register(el.name, el);\r\n\t\t\t});\r\n\t\t\tret = _.map(pageBrickConfigs, function (el, i, l) {\r\n\t\t\t\tvar name = $XP(el, 'name');\r\n\t\t\t\tvar hasRight = !ht.get(name) ? false : true;\r\n\t\t\t\treturn IX.inherit(el, {\r\n\t\t\t\t\titemClz : ($XP(el, 'itemClz', '') + ' ' + (!hasRight ? 'disabled' : ''))\r\n\t\t\t\t});\r\n\t\t\t});\r\n\t\t\treturn ret;\r\n\t\t};\r\n\t\t// Home Page \r\n\t\tvar tpl = Handlebars.compile(Hualala.TplLib.get('tpl_site_homepage'));\r\n\t\tvar $bricks = $(tpl({bricks : mapRanderData()}));\r\n\t\t$body.html($bricks);\r\n\t\t$bricks.on('mouseenter mouseleave click', '.brick-item', function (e) {\r\n\t\t\tvar $this = $(this), pageName = $this.attr('data-pagename'),\r\n\t\t\t\teType = e.type;\r\n\t\t\tif ($this.hasClass('disabled')) return false;\r\n\t\t\tif (eType == 'click') {\r\n\t\t\t\t// console.info($this.attr('data-pagename'));\r\n\t\t\t\tdocument.location.href = Hualala.PageRoute.createPath(pageName);\r\n\t\t\t} else {\r\n\t\t\t\t$this.toggleClass('hover');\r\n\t\t\t}\r\n\t\t\t\r\n\t\t});\r\n\t}\r\n\r\n\tfunction initLoginPage (pageType, params) {\r\n\t\tvar tpl = Handlebars.compile(Hualala.TplLib.get('tpl_site_login'));\r\n\t\tvar $loginBox = $(tpl({\r\n\t\t\tbannerImg : Hualala.Global.getDefaultImage('loginBanner')\r\n\t\t}));\r\n\t\tvar $body = $('#ix_wrapper > .ix-body > .container');\r\n\t\t$body.html($loginBox);\r\n\t\tHualala.Entry.initLogin($loginBox);\r\n\t}\r\n\r\n\r\n\tHualala.Common.LoginInit = initLoginPage;\r\n\tHualala.Common.initPageLayout = initPageLayout;\r\n\tHualala.Common.initSiteNavBar = initSiteNavBar;\r\n\tHualala.Common.HomePageInit = initHomePage;\r\n\r\n\tHualala.Common.IndexInit = function () {\r\n\t\tdocument.location.href = Hualala.PageRoute.createPath(\"main\");\r\n\t}\r\n\t\r\n})(jQuery, window);;(function ($, window) {\r\n\tIX.ns(\"Hualala\");\r\n\tvar sessionData = null;\r\n\t// SessionData\r\n\tHualala.getSessionData = function () {return sessionData;};\r\n\tHualala.getSessionSite = function () {return $XP(sessionData, 'site', null); };\r\n\tHualala.getSessionUser = function () {return $XP(sessionData, 'user', null); };\r\n\tHualala.getSessionRoles = function () {return $XP(sessionData, 'roles', []); };\r\n\tHualala.getSessionPCClient = function () {return $XP(sessionData, 'pcClient', null); };\r\n\tHualala.getSessionUserRight = function () {return $XP(sessionData, 'userRight', [])};\r\n\t// \r\n\tHualala.isSessionUser = function (groupLoginName, loginName) {\r\n\t\tvar _name = $XP(sessionData, 'user.groupLoginName') + $XP(sessionData, 'user.loginName');\r\n\t\treturn sessionData && _name == (groupLoginName + loginName);\r\n\t};\r\n\r\n\tfunction loadSession(appData, cbFn) {\r\n\t\tif (!$XP(appData, 'user', null)) {\r\n\t\t\tthrow(\"Permission Deny!!\");\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tsessionData = appData;\r\n\t\tcbFn();\r\n\t}\r\n\r\n\tfunction initMainPage(cbFn) {\r\n\t\tvar tick = IX.getTimeInMS();\r\n\t\tlog(\"Merchant Sys INIT : \" + tick);\r\n\t\tHualala.Global.loadAppData({}, function (appData) {\r\n\t\t\tlog(\"Load Merchant APP Data in (ms): \" + (IX.getTimeInMS() - tick));\r\n\t\t\tif ($XP(appData, 'resultcode') != 0) {\r\n\t\t\t\tdocument.location.href = Hualala.PageRoute.createPath('login');\r\n\t\t\t\tthrow(\"Session Data Load Faild!! resultcode = \" + $XP(appData, 'resultcode', '') + \"; resultMsg = \" + $XP(appData, 'resultmsg', ''));\r\n\t\t\t\treturn;\t\r\n\t\t\t}\r\n\t\t\tloadSession($XP(appData, 'data', {}), function () {\r\n\t\t\t\tlog(\"Merchant Sys INIT DONE in (ms): \" + (IX.getTimeInMS() - tick));\r\n\t\t\t\tcbFn();\r\n\t\t\t});\r\n\t\t}, function () {\r\n\t\t\tdocument.location.href = Hualala.PageRoute.createPath('login');\r\n\t\t\treturn ;\r\n\t\t});\r\n\t}\r\n\r\n\tfunction initRouteEngine () {\r\n\t\tif (!IX.nsExisted(\"Hualala.ajaxEngine.init\")) return;\r\n\t\t$.ajaxSetup({\r\n\t\t\tbeforeSend : function (xhr) {\r\n\t\t\t\txhr.setRequestHeader('X-CSRF-Token', $('meta[name=\"csrf-token\"]').attr('content'));\r\n\t\t\t}\r\n\t\t});\r\n\t\tHualala.ajaxEngine.init({\r\n\t\t\tajaxFn : jQuery.ajax,\r\n\t\t\tbaseUrl : Hualala.Global.HOME,\r\n\t\t\tcommonUrl : Hualala.Global.CommonSite,\r\n\t\t\timgUrl : Hualala.Global.IMAGE_ROOT\r\n\t\t});\r\n\t\t// Hualala.urlEngine would be initialized as ajaxEngine was initialized! ignore urlEngine's initializing.\r\n\t};\r\n\r\n\t\r\n\t/**\r\n\t * \r\n\t * @param  {Object} cfg {config:{}, type : \"login|main|shop|setting|account|user...\"}\r\n\t * @return {NULL}     \r\n\t */\r\n\tvar APPInitialized = false, currentType;\r\n\t\r\n\tHualala.init = function () {\r\n\t\tif (!APPInitialized) {\r\n\t\t\tinitRouteEngine();\r\n\t\t\t\r\n\t\t\t// initMainPage(function () {\r\n\t\t\t// \tHualala.PageRoute.start(function (pageName) {\r\n\t\t\t// \t\tvar hasNoNavPages = 'main,pcclient,about,contact';\r\n\t\t\t// \t\tHualala.Common.initPageLayout({}, pageName);\r\n\t\t\t// \t\tif (hasNoNavPages.indexOf(pageName) < 0) {\r\n\t\t\t// \t\t\tHualala.Common.initSiteNavBar(pageName);\r\n\t\t\t// \t\t}\r\n\t\t\t// \t});\r\n\t\t\t// });\r\n\t\t\tHualala.PageRoute.start(function (pageName, pageParams, pageInitFn) {\r\n\t\t\t\tvar hasNoNavPages = 'main,pcclient,about,contact,login';\r\n\t\t\t\tvar commonPages = _.filter(hasNoNavPages.split(','), function (v) {return v != 'main'}).join(',');\r\n\t\t\t\tif (commonPages.indexOf(pageName) >= 0) {\r\n\t\t\t\t\tHualala.Common.initPageLayout({}, pageName);\r\n\t\t\t\t\tif (hasNoNavPages.indexOf(pageName) < 0) {\r\n\t\t\t\t\t\tHualala.Common.initSiteNavBar(pageName);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tpageInitFn && pageInitFn.apply(null, [pageName, pageParams]);\r\n\t\t\t\t\treturn ;\r\n\t\t\t\t}\r\n\t\t\t\tinitMainPage(function () {\r\n\t\t\t\t\tHualala.Common.initPageLayout({}, pageName);\r\n\t\t\t\t\tif (hasNoNavPages.indexOf(pageName) < 0) {\r\n\t\t\t\t\t\tHualala.Common.initSiteNavBar(pageName);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tpageInitFn && pageInitFn.apply(null, [pageName, pageParams]);\r\n\t\t\t\t});\r\n\t\t\t});\r\n\t\t\tAPPInitialized = true;\r\n\t\t}\r\n\t};\r\n\r\n})(jQuery, window);;(function ($, window) {\r\n\tIX.ns(\"Hualala.PageRoute\");\r\n\tvar Router = Hualala.Router,\r\n\t\troutes = Hualala.Global.Route;\r\n\tvar isInitialized = false,\r\n\t\tPageConfigurations = {},\r\n\t\tPath2NameMapping = {};\r\n\r\n\tfunction mappingRoute (_path, _name, _reg) {\r\n\t\tvar match = _path.match(_reg);\r\n\t\tif (!match) return;\r\n\t\tvar s = match.shift(),\r\n\t\t\tarr = s.split('/');\r\n\t\tarr = _.map(arr, function (v, i, l) {\r\n\t\t\tvar bingo = _.indexOf(s, v);\r\n\t\t\tif (bingo > -1) {\r\n\t\t\t\treturn '_';\r\n\t\t\t}\r\n\t\t\treturn v;\r\n\t\t});\r\n\t\tarr.push(\"\"); arr.unshift(\"\");\r\n\t\tvar _pattern = arr.join(\"_\");\r\n\t\tPath2NameMapping[_pattern] = _name;\r\n\t}\r\n\r\n\tvar detectPageInitializor = (function () {\r\n\t\tvar ht = new IX.I1ToNManager();\r\n\t\tvar fnames = [];\r\n\t\tfunction _checkItem(fname) {\r\n\t\t\tif (!IX.isFn(IX.getNS(fname)))\r\n\t\t\t\treturn false;\r\n\t\t\tvar _list = ht.get(fname),\r\n\t\t\t\t_fn = IX.getNS(fname);\r\n\t\t\tfor (var j = 0; j < _list.length; j++)\r\n\t\t\t\tPageConfigurations[_list[j]].init = _fn;\r\n\t\t\tht.remove(fname);\r\n\t\t\treturn true;\r\n\t\t}\r\n\r\n\t\tfunction _checking() {\r\n\t\t\tfnames = IX.loop(fnames, [], function (acc, fname) {\r\n\t\t\t\tif (!_checkItem(fname))\r\n\t\t\t\t\tacc.push(fname);\r\n\t\t\t\treturn acc;\r\n\t\t\t});\r\n\t\t\treturn fnames.length == 0;\r\n\t\t}\r\n\r\n\t\tfunction _check () {\r\n\t\t\tfnames = IX.Array.toSet(fnames);\r\n\t\t\tIX.checkReady(_checking, IX.emptyFn, 40, {\r\n\t\t\t\tmaxAge : 15000,\r\n\t\t\t\texpire : function () {\r\n\t\t\t\t\talert(\"Can't find page inializor : \\n\" + fnames.join(\"\\n\"));\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\t\t\r\n\t\tfunction _detect(name, fname) {\r\n\t\t\tvar _fn = null;\r\n\t\t\tif (IX.isFn(fname)) {\r\n\t\t\t\t_fn = fname;\r\n\t\t\t} else if (!IX.isString(fname)) {\r\n\t\t\t\tthrow(\"Configuration failed : Invalid Page Initialized for \" + name);\r\n\t\t\t\treturn false;\r\n\t\t\t} else if (IX.nsExisted(fname)) {\r\n\t\t\t\t_fn = IX.getNS(fname);\r\n\t\t\t}\r\n\t\t\tif (IX.isFn(_fn)) {\r\n\t\t\t\treturn PageConfigurations[name].init = _fn;\r\n\t\t\t}\r\n\t\t\tht.put(fname, name);\r\n\t\t\tfnames.push(fname);\r\n\t\t}\r\n\t\treturn {\r\n\t\t\tstart : function () {setTimeout(_check, 1);},\r\n\t\t\tdetect : _detect\r\n\t\t}\r\n\t})();\r\n\r\n\t/**\r\n\t * \r\n\t * @param  {String} name   \r\n\t * @param  {Array|NULL} params \r\n\t * @return {String}        \r\n\t */\r\n\tfunction getPathByName (name, params) {\r\n\t\tvar cfg = PageConfigurations[name];\r\n\t\tif (!cfg) \r\n\t\t\treturn console.err(\"Can't find route : \" + name);\r\n\t\tvar path = $XP(cfg, 'path'), reg = $XP(cfg, 'reg'),\r\n\t\t\tmatch = path.match(reg);\r\n\t\tvar genPath = function (p) {\r\n\t\t\treturn Hualala.Global.HOME + p;\r\n\t\t};\r\n\t\tif (!match || match.length < 1) {\r\n\t\t\treturn console.err(\"The Path of Route (\" + name + \") is wrong!!\");\r\n\t\t} else if (match.length == 1) {\r\n\t\t\treturn genPath(path);\r\n\t\t} else if (match.length > 1 && IX.isArray(params) && (match.length - 1) == params.length) {\r\n\t\t\tmatch.shift();\r\n\t\t\t_.each(match, function (v, i, m) {\r\n\t\t\t\tpath = path.replace(v, params[i]);\r\n\t\t\t});\r\n\t\t\treturn genPath(path);\r\n\t\t}\r\n\t}\r\n\t/**\r\n\t * pageConfig : {\r\n\t * \t\tname : \"\",\r\n\t * \t\tpath : \"\",\r\n\t * \t\treg : RegExp,\r\n\t * \t\tbodyClz : \"\", default \"\"\r\n\t * \t\tPageInitiator : \"Hualala.User.init\" or function (cfg) {}\r\n\t * }\r\n\t * @param  {[type]} cbFn [description]\r\n\t * @return {[type]}      [description]\r\n\t */\r\n\tvar pageConfigs = [\r\n\t\t// home page \r\n\t\t// \r\n\t\t{\r\n\t\t\tname : \"login\", path : \"/#login\", reg : /login$/, bodyClz : \"\",\r\n\t\t\tPageInitiator : \"Hualala.Common.LoginInit\", label : \"\"\r\n\t\t},\r\n\t\t// home page\r\n\t\t{\r\n\t\t\tname : \"main\", path : \"/#home\", reg : /home$/, bodyClz : \"\",\r\n\t\t\tPageInitiator : \"Hualala.Common.HomePageInit\", label : \"\"\r\n\t\t},\r\n\r\n\t\t// \t\t\r\n\t\t{\r\n\t\t\tname : \"shop\", path : \"/#shop\", reg : /shop$/, bodyClz : \"\",\r\n\t\t\tPageInitiator : \"Hualala.Shop.HomePageInit\", parentName : \"main\", label : \"\"\r\n\t\t},\r\n\t\t// \r\n\t\t{\r\n\t\t\tname : \"shopCreate\", path : \"/#shop/create\", reg : /shop\\/create$/, bodyClz : \"\",\r\n\t\t\tPageInitiator : \"Hualala.Shop.CreateShopInit\", parentName : \"shop\", label : \"\"\r\n\t\t},\r\n\t\t// \r\n\t\t{\r\n\t\t\tname : \"shopInfo\", path : \"/#shop/{id}/info\", reg : /shop\\/(.*)\\/info$/, bodyClz : \"\",\r\n\t\t\tPageInitiator : \"Hualala.Shop.BaseInfoMgrInit\", parentName : \"shop\", label : \"\"\r\n\t\t},\r\n\t\t// \r\n\t\t{\r\n\t\t\tname : \"shopMenu\", path : \"/#shop/{id}/menu\", reg : /shop\\/(.*)\\/menu$/, bodyClz : \"\",\r\n\t\t\tPageInitiator : \"Hualala.Shop.FoodMenuMgrInit\", parentName : \"shop\", label : \"\"\r\n\t\t},\r\n\r\n\t\t// \r\n\t\t{\r\n\t\t\tname : \"setting\", path : \"/#setting\", reg : /setting$/, bodyClz : \"\",\r\n\t\t\tPageInitiator : \"Hualala.Setting.ShopMgrInit\", parentName : \"main\", label : \"\"\r\n\t\t},\r\n\r\n\t\t// \r\n\t\t{\r\n\t\t\tname : \"account\", path : \"/#account\", reg : /account$/, bodyClz : \"\",\r\n\t\t\tPageInitiator : \"Hualala.Account.AccountListInit\", parentName : \"main\", label : \"\"\r\n\t\t},\r\n\t\t// \r\n\t\t{\r\n\t\t\tname : \"accountDetail\", path : \"/#account/{id}/detail\", reg : /account\\/(.*)\\/detail$/, bodyClz : \"\",\r\n\t\t\tPageInitiator : \"Hualala.Account.AccountMgrInit\", parentName : \"account\", label : \"\"\r\n\t\t},\r\n\r\n\t\t// \r\n\t\t{\r\n\t\t\tname : \"user\", path : \"/#user\", reg : /user$/, bodyClz : \"\",\r\n\t\t\tPageInitiator : \"Hualala.User.UserListInit\", parentName : \"main\", label : \"\"\r\n\t\t},\r\n\r\n\t\t// \r\n\t\t{\r\n\t\t\tname : \"order\", path : \"/#order\", reg : /order$/, bodyClz : \"\",\r\n\t\t\tPageInitiator : \"Hualala.Order.OrderChartInit\", parentName : \"main\", label : \"\"\r\n\t\t},\r\n\r\n\t\t// \r\n\t\t/*\r\n\t\t\tb : begin date(SecondTick)\r\n\t\t\te : end date(SecondTick)\r\n\t\t\tc : city ID\r\n\t\t\ts : order status ID\r\n\t\t\tn : shop ID\r\n\t\t\tm : mobile number\r\n\t\t\to : order key\r\n\t\t\ti : min amount\r\n\t\t\ta : max amount\r\n\r\n\t\t */\r\n\t\t{\r\n\t\t\tname : \"orderQuery\", path : \"/#order/query/b{begin}/e{end}/c{cityID}/n{shopID}/s{status}/m{mobile}/o{orderKey}/i{minAmount}/a{maxAmount}\", \r\n\t\t\treg : /order\\/query\\/b(.*)\\/e(.*)\\/c(.*)\\/n(.*)\\/s(.*)\\/m(.*)\\/o(.*)\\/i(.*)\\/a(.*)$/,\r\n\t\t\tbodyClz : \"\", PageInitiator : \"Hualala.Order.QueryOrderInit\", parentName : \"main\", label : \"\"\r\n\t\t},\r\n\r\n\t\t// \r\n\t\t/*\r\n\t\t\tb : begin date(SecondTick)\r\n\t\t\te : end date(SecondTick)\r\n\t\t\tc : city ID\r\n\t\t\ts : order status ID\r\n\t\t\tn : shop ID\r\n\t\t */\r\n\t\t{\r\n\t\t\tname : \"orderQueryDay\", path : \"/#order/query/day/b{begin}/e{end}/c{cityID}/n{shopID}/s{status}\",\r\n\t\t\treg : /order\\/query\\/day\\/b(.*)\\/e(.*)\\/c(.*)\\/n(.*)\\/s(.*)/, bodyClz : \"\",\r\n\t\t\tPageInitiator : \"Hualala.Order.QueryOrderByDayDetailInit\", parentName : \"main\", label : \"\"\r\n\t\t},\r\n\r\n\t\t// \r\n\t\t/*\r\n\t\t\tb : begin date(SecondTick)\r\n\t\t\te : end date(SecondTick)\r\n\t\t\tc : city ID\r\n\t\t\ts : order status ID\r\n\t\t\tn : shop ID\r\n\t\t */\r\n\t\t{\r\n\t\t\tname : \"orderQueryDuring\", path : \"/#order/query/during/b{begin}/e{end}/c{cityID}/n{shopID}/s{status}\",\r\n\t\t\treg : /order\\/query\\/during\\/b(.*)\\/e(.*)\\/c(.*)\\/n(.*)\\/s(.*)/, bodyClz : \"\", \r\n\t\t\tPageInitiator : \"Hualala.Order.QueryOrderByDuringDetailInit\", parentName : \"main\", label : \"\"\r\n\t\t},\r\n\r\n\t\t// \r\n\t\t/*\r\n\t\t\tb : begin date(SecondTick)\r\n\t\t\te : end date(SecondTick)\r\n\t\t\tc : city ID\r\n\t\t\tn : shopID\r\n\t\t\ts : foodCategoryName\r\n\t\t */\r\n\t\t{\r\n\t\t\tname : \"orderDishesHot\", path : \"/#order/dishes/hot/b{begin}/e{end}/c{cityID}/n{shopID}/s{foodCategoryName}\",\r\n\t\t\treg : /order\\/dishes\\/hot\\/b(.*)\\/e(.*)\\/c(.*)\\/n(.*)\\/s(.*)/, bodyClz : \"\",\r\n\t\t\tPageInitiator : \"Hualala.Order.QueryOrderDishesHotInit\", parentName : \"main\", label : \"\"\r\n\t\t},\r\n\r\n\t\t// \r\n\t\t/*\r\n\t\t\tb : begin date(SecondTick)\r\n\t\t\te : end date(SecondTick)\r\n\t\t\tc : city ID\r\n\t\t\tn : shopID\r\n\t\t\tu : customerName\r\n\t\t\tm : mobile\r\n\t\t */\r\n\t\t{\r\n\t\t\tname : \"orderQueryCustomer\", path : \"/#order/customer/b{begin}/e{end}/c{cityID}/n{shopID}/m{mobile}/u{customerName}\",\r\n\t\t\treg : /order\\/customer\\/b(.*)\\/e(.*)\\/c(.*)\\/n(.*)\\/m(.*)\\/u(.*)/, bodyClz : \"\",\r\n\t\t\tPageInitiator : \"Hualala.Order.QueryOrderCustomerInit\", parentName : \"main\", label : \"\"\r\n\t\t},\r\n\r\n\r\n\t\t// PC\r\n\t\t{\r\n\t\t\tname : \"pcclient\", path : \"/#download\", reg : /download$/, bodyClz : \"\",\r\n\t\t\tPageInitiator : \"Hualala.Common.PCClientDownloadInit\", parentName : \"main\", label : \"\"\r\n\t\t},\r\n\r\n\t\t// \r\n\t\t{\r\n\t\t\tname : \"about\", path : \"/#about\", reg : /about$/, bodyClz : \"\",\r\n\t\t\tPageInitiator : \"Hualala.Common.AboutInit\", parentName : \"main\", label : \"\"\r\n\t\t},\r\n\r\n\t\t// \r\n\t\t{\r\n\t\t\tname : \"contact\", path : \"/#contact\", reg : /contact$/, bodyClz : \"\",\r\n\t\t\tPageInitiator : \"Hualala.Common.ContactInit\", parentName : \"main\", label : \"\"\r\n\t\t},\r\n\t\t// pathhome\r\n\t\t{\r\n\t\t\tname : \"index\", path : \"\", reg : /(.*)$/, bodyClz : \"\",\r\n\t\t\tPageInitiator : \"Hualala.Common.IndexInit\"\r\n\t\t}\r\n\t];\r\n\tIX.iterate(pageConfigs, function (cfg) {\r\n\t\tvar _cfg = IX.inherit({\r\n\t\t\tbodyClz : \"ix-minor\",\r\n\t\t\tpath : \"\"\r\n\t\t}, cfg);\r\n\t\tvar _name = $XP(cfg, 'name'), _path = $XP(cfg, 'path'), _reg = $XP(cfg, 'reg');\r\n\t\tmappingRoute(_path, _name, _reg);\r\n\t\tPageConfigurations[_name] = {\r\n\t\t\tname : _name, bodyClz : $XP(_cfg, 'bodyClz', ''), path : _path, reg : $XP(_cfg, 'reg', null),\r\n\t\t\tparentName : $XP(cfg, 'parentName', null), label : $XP(cfg, 'label', '')\r\n\t\t};\r\n\t\tvar _pageInit = \"PageInitiator\" in _cfg ? _cfg.PageInitiator : null;\r\n\t\tif (!IX.isString(_pageInit) && !IX.isFn(_pageInit))\r\n\t\t\t_pageInit = IX.emptyFn;\r\n\t\tdetectPageInitializor.detect(_name, _pageInit);\r\n\t});\r\n\tdetectPageInitializor.start();\r\n\r\n\r\n\tHualala.PageRoute.start = function (cbFn) {\r\n\t\tisInitialized = true;\r\n\t\tRouter.flush().config({mode : 'history', root : Hualala.Global.HOME});\r\n\t\t// Router.flush().config({mode : 'history'});\r\n\t\t// IE Browser can not support this method ??\r\n\t\t_.each(PageConfigurations, function (route, name, l) {\r\n\t\t\tvar re = $XP(route, 'reg'), initFn = $XF(route, 'init'), handler = null;\r\n\t\t\t\r\n\t\t\thandler = function (params) {\r\n\t\t\t\tconsole.info(\"INFO: Init Page :\" + name);\r\n\t\t\t\tconsole.info(\"Load Page :\" + name);\r\n\t\t\t\tconsole.info(\"arguments is :\" + params);\r\n\t\t\t\tIX.isFn(cbFn) && cbFn(name, params, initFn);\r\n\t\t\t\t\r\n\t\t\t\t// initFn && initFn.apply(null, [name, params]);\r\n\t\t\t};\r\n\t\t\t\r\n\t\t\tRouter.add(re, handler);\r\n\t\t});\r\n\t\tRouter.listen().check();\r\n\t};\r\n\r\n\tHualala.PageRoute.createPath = getPathByName;\r\n\r\n\tHualala.PageRoute.getCurrentPath = function () {\r\n\t\treturn location.hash;\r\n\t};\r\n\r\n\tHualala.PageRoute.getPageContextByPath = function (path) {\r\n\t\tvar fragment = path || Hualala.Router.getFragment();\r\n\t\tvar match = _.filter(PageConfigurations, function (el, k, l) {\r\n\t\t\treturn !!fragment.match(el.reg);\r\n\t\t});\r\n\t\tvar params = null;\r\n\t\tif (match.length == 0) return null;\r\n\t\tif (match.length == 1) {\r\n\t\t\tparams = fragment.match(match[0]['reg']);\r\n\t\t\tparams.shift();\r\n\t\t\treturn IX.inherit({params : params}, match[0]);\r\n\t\t}\r\n\t\tmatch = _.filter(match, function (el, k, l) {\r\n\t\t\treturn el.name != 'index';\r\n\t\t});\r\n\t\tparams = fragment.match(match[match.length - 1]['reg']);\r\n\t\tparams.shift();\r\n\t\treturn IX.inherit({params : params}, match[match.length - 1]);\r\n\t};\r\n\r\n\tHualala.PageRoute.getParentNamesByPath = function (path) {\r\n\t\tvar curContext = Hualala.PageRoute.getPageContextByPath(path);\r\n\t\tvar curName = $XP(curContext, 'name', null);\r\n\t\tvar ret = [];\r\n\t\twhile(!IX.isEmpty(curName)) {\r\n\t\t\tret.unshift({\r\n\t\t\t\tname : curName,\r\n\t\t\t\tlabel : $XP(curContext, 'label', ''),\r\n                path: Hualala.PageRoute.createPath(curName, curContext.params)\r\n\t\t\t});\r\n\t\t\tvar parentName = $XP(curContext, 'parentName', null);\r\n\t\t\tcurContext = IX.isEmpty(parentName) ? null : $XP(PageConfigurations, parentName, null);\r\n\t\t\tcurName = $XP(curContext, 'name', null);\r\n\t\t}\r\n        ret[ret.length - 1].isLastNode = true;\r\n\t\treturn ret;\r\n\t};\r\n    \r\n    Hualala.PageRoute.getPageLabelByName = function (name) {\r\n        if(!name) return null;\r\n        var cfg = PageConfigurations[name];\r\n        if(!cfg) return null;\r\n        return cfg.label;\r\n    };\r\n    \r\n\r\n})(jQuery, window);"]}