{"version":3,"file":"common.min.js","sources":["common.js"],"names":["VERSION","guid","Object","create","CachedFunction","slice","Array","prototype","_","attributes","eventHandlers","-1","addEvent","event","type","push","handler","scope","addEventHandler","argTypeOrMap","argHandlerOrScope","argScope","eventMap","eventString","events","split","i","l","length","eventType","call","this","_guid","addGuid","object","forceGuid","attr","clone","obj","typeOf","extend","proto","createSubclass","props","includeEvents","constructor","Error","on","realConstructor","apply","arguments","superclass","hasOwnProperty","Events","extendThis","parent","subclass","key","emitEvents","data","explicitType","explicitGuid","handlers","args","shift","unshift","makeUuid","replace","c","r","Math","random","v","toString","removeAttribute","keys","silent","trim","mutateData","oldValue","emit","removeEventHandler","h","splice","setAttribute","value","itemExists","has","newValue","specificEvent","str","val","String","toLowerCase","updateAttribute","fn","item","get","types","splittedTypes","all","off","Module","each","ctx","filter","filtered","input","results","items","getAll","getAllAsArray","arr","id","map","mapped","remove","set","objOrKey","valueOrSilent","size","update","keyOrFn","Stapes","mixinEvents","classOnly","version","exports","module","define","amd","window","IX","currentVersion","isEmptyFn","undefined","BaseTypes","function","Function","string","boolean","Boolean","number","Number","isTypeFn","typeUtils","isEmpty","isBoolean","isObject","isString","isNumber","isFn","isArray","ob","isElement","el","nodeType","getClass","match","loopFn","varr","sIdx","eIdx","acc0","fun","isAscLoop","len","acc","min","max","xlen","idx","iterateFn","loopUtils","iterate","fnIterate","fname","loop","loopbreak","_ex","partLoop","loopDsc","p","arrUtils","cvtToArray","iterable","toArray","cloneFn","Date","RegExp","propertyName","property","deepCompare","y","x","propertyUtils","hasProperty","pName","ex","names","pObj","getProperty","defV","setProperty","_name","pop","_sname","e","getPropertyAsFunction","fName","emptyFn","nsLoopFn","nsname","nsObj","flag","curname","namespaceUtils","ns","name","nsExisted","setNS","getNS","objName","extendFn","dst","src","_p","extendUtils","inherit","getTimeInMS","getTime","ua","navigator","userAgent","checkUA","keywords","indexOf","hasEventListener","_handlerWrapper","evt","target","srcElement","_bindHandlers","isBind","isOnce","_EVENTNAMES","eventName","browserUtils","isMSIE7","document","isSafari","openDatabase","isMSIE","isOpera","isChrome","isFirefox","isMSWin","getComputedStyle","defaultView","currentStyle","style","getUrlParam","paramList","location","search","substring","listen","eName","etype","attachEvent","addEventListener","detachEvent","removeEventListener","bind","bindOnce","locationUtils","toAnchor","hash","selfFn","o","checkReadyFn","condFn","execFn","period","_config","_checkFn","maxAge","startTick","expireFn","setTimeout","_period","$XP","$XF","isNaN","executeUtils","safeExec","execute","checkReady","tryFn","domUtils","decodeTXT","txt","replaceAll","encodeTXT","createDiv","clz","node","createElement","className","body","appendChild","domEl","getElementById","errUtils","err","errMsg","alert","mathUtils","inRange","x1","x2","_idx","idUtils","ifRectIntersect","_rect1","_rect2","abs","maxx","minx","maxy","miny","$X","$XA","$XE","Test","detectAttrsFn","checkFn","injectorFn","count","nc","listFn","matchorFn","isListFn","n","trunc","join","listProp","matchor","listFun","log","s","console","Debug","info","IXDEBUG","getEqualFn","equalFn","a","b","equal","isFoundFn","elem","_merge","arr1","arr2","_arr1","_arr2","j","k","len1","len2","concat","_self","init","isFound","toSet","sort","cmpFn","isSameSet","compact","validFn","pushx","flat","matchFn","start","deleteCount","insertArray","iArr","merge","IState","toggle","origStat","newStat","IManager","_ht","isRegistered","register","unregister","clear","destroy","IList","_keyList","IXArray","indexOfFn","removeFn","appendFn","isLast","getList","getSize","tryRemove","append","tryAdd","insertBefore","dstKey","dstIdx","I1ToNManager","eqFn","_eqFn","_mgr","hasEntryFn","list","hasValue","put","IListManager","_super","_list","registerFn","hasKey","isLastKey","getKeys","getByKeys","getFirst","inst","DataStore","_items","_fields","row","col","_isUTC","fields4Day","fields4Time","ds","ts","_formatStr","sp","nstr","multi","substr","_format","date","fields","getPrefix","format","checkData","checkTime","isValid","isDate","sps","m","d","setDS","setTS","setUTC","isUTC","getDS","getTS","formatDate","formatTime","formatStr","formatDateStr","formatTimeStr","getDateText","olderTSInSec","tsInSec","interval","round","dateStr","dt","getDateByFormat","_dateStr","_formatType","_dateObj","dateFormat","getFullYear","_month","getMonth","_day","getDate","_hour","getHours","_minute","getMinutes","_second","getSeconds","getTimeTickInSec","_str","parseInt","Net","head","getElementsByTagName","getRequestFn","XMLHttpRequest","ActiveXObject","loadFn","durl","cbFun","request","onreadystatechange","readyState","status","responseText","statusText","open","send","loadJsFn","nextFn","script","onload","loadJsFilesInSeqFn","jsFiles","_nextFn","loadCssFn","cssFile","cssNode","rel","href","media","loadFile","loadCss","loadJsFiles","nextFun","fnName","argList","dependencyConfig","afterFn","config","beforeFn","cssFiles","delay","win","fnHT","eventFnHT","handlersHT","keySn","genKey","executeEvent","fKey","_register","_key","_unregister","fnKey","bindFn","ids","unbind","handlerIds","scrollTo","$Xw","defaultParamFn","_params","defaulRspFn","cbFn","getFunProp","_cfg","defFn","_fn","ajaxRouteFn","callerRouteDef","channel","dataType","onsuccess","preAjax","postAjax","onfail","urlRouteFn","routeDef","ifAjax","_url","route","url","urlType","createRouteHT","routes","UrlRouter","urlFac","_routeHT","params","genUrl","tryLockChannel","unlockChannel","parentNode","removeChild","AjaxCaller","_ajaxFn","_callerHT","failFn","_caller","_channel_","_t","code","_cbFn","_contentType","_data","JSON","stringify","contentType","success","fail","error","UrlFactory","_urls","_route","replaceByParams","_urlBase","baseUrl","cfg","UrlEngine","_urlFac","ajaxFn","reset","createRouter","createCaller","ajaxParam","urlEngine","ajaxEngine","Xml","parser","doc","DOMParser","parseFromString","async","loadXML","getXmlString","xmlDoc","XMLSerializer","serializeToString","xml","duplicate","Dom","valueFn","cnode","nextSibling","getFn","tagN","nodeName","textFn","innerText","textContent","cdataFn","nodeValue","firstFn","inTagFn","tag","content","attrs","_attrs","inPureTagFn","attrFn","attN","getAttribute","setAttrFn","first","next","cdata","text","setAttr","dataAttr","setDataAttr","isAncestor","ancestor","tagName","is","inTag","inPureTag","$XD","HtmlDocument","hasFn","clzName","addFn","clzs","getStyle","_elem","styles","_value","filters","opacity","camelize","_css","getPropertyValue","_i","display","capitalize","hasClass","removeClass","addClass","toggleClass","parentEl","firstChild","pnode","getWindowScreen","documentElement","_scrollX","scrollX","scrollLeft","_scrollY","scrollY","scrollTop","scroll","scrollWidth","scrollHeight","clientWidth","clientHeight","getScroll","_dom","_window","parentWindow","pageYOffset","pageXOffset","getZIndex","zIndex","offsetParent","rect","ri","getWindowScrollTop","getPosition","isFixed","getBoundingClientRect","left","top","offsetWidth","offsetHeight","$XH","Cookie","getOptions","options","vals","expires","toUTCString","setTime","path","domain","secure","_set","encodeURIComponent","cookie","cookies","cookieN","decodeURIComponent","Task","taskFn","times","execFlag","_times","_total","_ts","stop","clearTimeout","tplRegex","rpRegex","idRegex","regSplit","reg","_splitArr","_matchArr","_len","_arr","separate","parseTpl","tplstr","tplMgr","newTpl","html","tpl","appendTpl","reformTpl","curTpl","_openTpl","newName","newTplName","_closeTpl","_regSplit","tplArr","contentArr","nameArr","emptyTpl","render","renderData","getTpl","ITemplate","_tpl","_dataFn","getProps","renderFn","tplId","t","charAt","itm","idata","loopReplace","_render","_get_p_tpl","_id","tm","ci","substrByLength","maxLength","stringArr","matchPRC_regx","strLen","simpleCharLen","subStringByMaxLength","reString","reLength","stringLength","UrlRegEx","EmailPattern","ScriptPattern","FormPattern","TrimPattern","ReplaceKeyPattern","B","A","toUpperCase","os","end","ws","test","stripTags","stripScripts","stripFormTag","strip","isSpaces","isPassword","isEmail","email","exec","tail","dehtml","enhtml","pickUrls","replaceUrls","_r","_f","pick4Replace","toSafe","padLeft","nLen","ch","padRight","movePointLeft","scale","s1","s2","ps","sign","movePointRight","movePoint","__method","UUID","itoh","generate","floor","Util","Image","_getImageDataUrl","img","cw","w","canvas","width","height","getContext","drawImage","dataURL","toDataURL","getRatioWH","rw","rh","wratio","hratio","getImageData","imgEl","wh","setImageData","imgData","keepRatio","cwEl","getData","setData","timeInSecond","getFieldValues","_time","f","time","toText","toWeek","toDate","incYear","curTime","toTime","toShort","strs","shouldAppend","toInterval","_date","toSimpleInterval","Event","stopPropagation","cancelBubble","preventDefault","returnValue","getIXScriptEl","scripts","ixEl","SELF_PATH","SCRIPT_ROOT","urlItemFn","columns","urlDef","RouteAttrDefValue","UrlStore","_routes","_urlItemFn","routeName","urlList","_urlGenerator","urlGenerator","createEntries","isCaller","isRef","ajaxStore","initEngine","urlStore","Hualala","mappingUrls","genUrls","createRoute","Common","getSourceImage","settings","watermark","cut","offsetX","offsetY","rotate","quality","imgDomain","Global","IMAGE_RESOURCE_WATERMARK_DOMAIN","IMAGE_RESOURCE_DOMAIN","lastSlash","lastIndexOf","fileName","suffix","scaleE","cutE","paramE","scaleRule","percent","lockMin","lockMax","unlock","lockMinZoomOut","lockMinZoomIn","lockMaxZoomOut","lockMaxZoomIn","unlockZoomOut","unlockZoomIn","cutRule","normal","ret","jQuery","$","loadImageErr","defaultPhotoImg","avatarFn","getDefaultImage","formatDateTimeValue","fullLen","setCenter","offset","strByteLength","sum","charCode","charCodeAt","substrByte","s3","Browser","browser","getMinuteIntervalOptions","Constants","SecondsOfDay","parseForm","form","$form","serializeArray","result","codeMask","orig","mapBankInfo","bankCode","banks","TypeDef","BankOptions","bankHT","iconSizes","icons","getGender","GENDER","find","getOrderStatus","OrderStatus","getShopUrl","shopID","HualalaWebSite","prettyNumeric","num","separator","l1","restoreNumeric","prettyPrice","price","parseFloat","toFixed","dot","add","baseNum","v1","sub","precision","numberToFixed","div","ceil","SiteNavType","label","OrderSubNavType","pkeys","valueStr","ShopNoteType","TASTE","COOKING","FOOD_COMMENT","ORDER_COMMENT","FREE_REASON","RETURN_REASON","CHARGE_BACK","OrderSubType","EATIN","RESERVE","Flash","DIY","QUEUE","TAKEOUT","PICKUP","TimeID","allday","breakfast","lunch","afternoon","dinner","supper","ShopStatus","FoodAttr","AUTOADD","SPECIALTY","RECOMMEND","NEW","DISCOUNT","COMMENTS","CANREFUND","SETFOOD","TakeawayTag","NOTAKEAWAY","TAKEAWAY","ONLYTAKEAWAY","HASIMAGE","FSMTransType","queryCall","queryKeys","FSMTransStatus","FSMTransDetail","AccountReceiverTypes","ShopBusiness","businessIsSupported","callServer","formKeys","operationMode",1,"PayMethodOptions","PayMethodAtShopOptions","FetchFoodModeOptions","HolidayFlagOptions","MinuteIntervalOptions","endMin","gap","cur","minsOfHour","SecondsOfHour","minsOfDay","day","hour","NameOfDay","SecondsOfWeek","NumberKeys","Alphabet","PersonUnit","CashUnit","Router","mode","root","history","clearSlashes","getFragment","fragment","decodeURI","pathname","re","param","flush","check","self","current","clearInterval","setInterval","navigate","pushState","Pymatch","name2pys","setNames","is_sim","sa","simpy","sb","getAlt","py","c2","c1","sc","split2","pinyin","cache","pymatch","pyprefix","pys","isHz","W_first_exactly_match","W_other_match","alt","W_fuzzy_match","W_zcs_match_zhchsh","pmatch","pattern","inplace","q","W_hzmatch","match2","input_c","ai","stkp","instr","is_py","pyidx","ti","tpys","tn","tpy","stack","rnames","name2py","hz","nhz","searchLetter","handledIdx","bi","bn","back","get_match","get_input","langs","Matcher","lang","_matcher","_loadMatchConfig","callback","_match","refresh"],"mappings":"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","sourcesContent":["/** \r\n * -------------------------------------------------\r\n * Copyright (c) 2014, All rights reserved. \r\n * Hualala-Merchant-Management\r\n * \r\n * @version : 0.1.0\r\n * @author : HuHao\r\n * @description : Hualala Merchant Management System.  \r\n * -------------------------------------------------\r\n */ \r\n\r\n//\r\n//  ____  _                           _\r\n// / ___|| |_ __ _ _ __   ___  ___   (_)___  (*)\r\n// \\___ \\| __/ _` | '_ \\ / _ \\/ __|  | / __|\r\n//  ___) | || (_| | |_) |  __/\\__ \\_ | \\__ \\\r\n// |____/ \\__\\__,_| .__/ \\___||___(_)/ |___/\r\n//              |_|              |__/\r\n//\r\n// (*) the Javascript MVC microframework that does just enough\r\n//\r\n// (c) Hay Kranen < hay@bykr.org >\r\n// Released under the terms of the MIT license\r\n// < http://en.wikipedia.org/wiki/MIT_License >\r\n//\r\n// Stapes.js : http://hay.github.com/stapes\r\n;(function() {\r\n    'use strict';\r\n\r\n    var VERSION = \"0.8.1\";\r\n\r\n    // Global counter for all events in all modules (including mixed in objects)\r\n    var guid = 1;\r\n\r\n    // Makes _.create() faster\r\n    if (!Object.create) {\r\n        var CachedFunction = function(){};\r\n    }\r\n\r\n    // So we can use slice.call for arguments later on\r\n    var slice = Array.prototype.slice;\r\n\r\n    // Private attributes and helper functions, stored in an object so they\r\n    // are overwritable by plugins\r\n    var _ = {\r\n        // Properties\r\n        attributes : {},\r\n\r\n        eventHandlers : {\r\n            \"-1\" : {} // '-1' is used for the global event handling\r\n        },\r\n\r\n        guid : -1,\r\n\r\n        // Methods\r\n        addEvent : function(event) {\r\n            // If we don't have any handlers for this type of event, add a new\r\n            // array we can use to push new handlers\r\n            if (!_.eventHandlers[event.guid][event.type]) {\r\n                _.eventHandlers[event.guid][event.type] = [];\r\n            }\r\n\r\n            // Push an event object\r\n            _.eventHandlers[event.guid][event.type].push({\r\n                \"guid\" : event.guid,\r\n                \"handler\" : event.handler,\r\n                \"scope\" : event.scope,\r\n                \"type\" : event.type\r\n            });\r\n        },\r\n\r\n        addEventHandler : function(argTypeOrMap, argHandlerOrScope, argScope) {\r\n            var eventMap = {},\r\n                scope;\r\n\r\n            if (typeof argTypeOrMap === \"string\") {\r\n                scope = argScope || false;\r\n                eventMap[ argTypeOrMap ] = argHandlerOrScope;\r\n            } else {\r\n                scope = argHandlerOrScope || false;\r\n                eventMap = argTypeOrMap;\r\n            }\r\n\r\n            for (var eventString in eventMap) {\r\n                var handler = eventMap[eventString];\r\n                var events = eventString.split(\" \");\r\n\r\n                for (var i = 0, l = events.length; i < l; i++) {\r\n                    var eventType = events[i];\r\n                    _.addEvent.call(this, {\r\n                        \"guid\" : this._guid || this._.guid,\r\n                        \"handler\" : handler,\r\n                        \"scope\" : scope,\r\n                        \"type\" : eventType\r\n                    });\r\n                }\r\n            }\r\n        },\r\n\r\n        addGuid : function(object, forceGuid) {\r\n            if (object._guid && !forceGuid) return;\r\n\r\n            object._guid = guid++;\r\n\r\n            _.attributes[object._guid] = {};\r\n            _.eventHandlers[object._guid] = {};\r\n        },\r\n\r\n        // This is a really small utility function to save typing and produce\r\n        // better optimized code\r\n        attr : function(guid) {\r\n            return _.attributes[guid];\r\n        },\r\n\r\n        clone : function(obj) {\r\n            var type = _.typeOf(obj);\r\n\r\n            if (type === 'object') {\r\n                return _.extend({}, obj);\r\n            }\r\n\r\n            if (type === 'array') {\r\n                return obj.slice(0);\r\n            }\r\n        },\r\n\r\n        create : function(proto) {\r\n            if (Object.create) {\r\n                return Object.create(proto);\r\n            } else {\r\n                CachedFunction.prototype = proto;\r\n                return new CachedFunction();\r\n            }\r\n        },\r\n\r\n        createSubclass : function(props, includeEvents) {\r\n            props = props || {};\r\n            includeEvents = includeEvents || false;\r\n\r\n            var superclass = props.superclass.prototype;\r\n\r\n            // Objects always have a constructor, so we need to be sure this is\r\n            // a property instead of something from the prototype\r\n            var realConstructor = props.hasOwnProperty('constructor') ? props.constructor : function(){};\r\n\r\n            function constructor() {\r\n                // Be kind to people forgetting new\r\n                if (!(this instanceof constructor)) {\r\n                    throw new Error(\"Please use 'new' when initializing Stapes classes\");\r\n                }\r\n\r\n                // If this class has events add a GUID as well\r\n                if (this.on) {\r\n                    _.addGuid( this, true );\r\n                }\r\n\r\n                realConstructor.apply(this, arguments);\r\n            }\r\n\r\n            if (includeEvents) {\r\n                _.extend(superclass, Events);\r\n            }\r\n\r\n            constructor.prototype = _.create(superclass);\r\n            constructor.prototype.constructor = constructor;\r\n\r\n            _.extend(constructor, {\r\n                extend : function() {\r\n                    return _.extendThis.apply(this, arguments);\r\n                },\r\n\r\n                // We can't call this 'super' because that's a reserved keyword\r\n                // and fails in IE8\r\n                'parent' : superclass,\r\n\r\n                proto : function() {\r\n                    return _.extendThis.apply(this.prototype, arguments);\r\n                },\r\n\r\n                subclass : function(obj) {\r\n                    obj = obj || {};\r\n                    obj.superclass = this;\r\n                    return _.createSubclass(obj);\r\n                }\r\n            });\r\n\r\n            // Copy all props given in the definition to the prototype\r\n            for (var key in props) {\r\n                if (key !== 'constructor' && key !== 'superclass') {\r\n                    constructor.prototype[key] = props[key];\r\n                }\r\n            }\r\n\r\n            return constructor;\r\n        },\r\n\r\n        emitEvents : function(type, data, explicitType, explicitGuid) {\r\n            explicitType = explicitType || false;\r\n            explicitGuid = explicitGuid || this._guid;\r\n\r\n            // #30: make a local copy of handlers to prevent problems with\r\n            // unbinding the event while unwinding the loop\r\n            var handlers = slice.call(_.eventHandlers[explicitGuid][type]);\r\n\r\n            for (var i = 0, l = handlers.length; i < l; i++) {\r\n                // Clone the event to prevent issue #19\r\n                var event = _.extend({}, handlers[i]);\r\n                var scope = (event.scope) ? event.scope : this;\r\n\r\n                if (explicitType) {\r\n                    event.type = explicitType;\r\n                }\r\n\r\n                event.scope = scope;\r\n                event.handler.call(event.scope, data, event);\r\n            }\r\n        },\r\n\r\n        // Extend an object with more objects\r\n        extend : function() {\r\n            var args = slice.call(arguments);\r\n            var object = args.shift();\r\n\r\n            for (var i = 0, l = args.length; i < l; i++) {\r\n                var props = args[i];\r\n                for (var key in props) {\r\n                    object[key] = props[key];\r\n                }\r\n            }\r\n\r\n            return object;\r\n        },\r\n\r\n        // The same as extend, but uses the this value as the scope\r\n        extendThis : function() {\r\n            var args = slice.call(arguments);\r\n            args.unshift(this);\r\n            return _.extend.apply(this, args);\r\n        },\r\n\r\n        // from http://stackoverflow.com/a/2117523/152809\r\n        makeUuid : function() {\r\n            return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {\r\n                var r = Math.random()*16|0, v = c == 'x' ? r : (r&0x3|0x8);\r\n                return v.toString(16);\r\n            });\r\n        },\r\n\r\n        removeAttribute : function(keys, silent) {\r\n            silent = silent || false;\r\n\r\n            // Split the key, maybe we want to remove more than one item\r\n            var attributes = _.trim(keys).split(\" \")\r\n                ,mutateData = {}\r\n                ;\r\n\r\n            // Actually delete the item\r\n            for (var i = 0, l = attributes.length; i < l; i++) {\r\n                var key = _.trim(attributes[i]);\r\n\r\n                if (key) {\r\n                    // Store data for mutate event\r\n                    mutateData.key = key;\r\n                    mutateData.oldValue = _.attr(this._guid)[key];\r\n\r\n                    delete _.attr(this._guid)[key];\r\n\r\n                    // If 'silent' is set, do not throw any events\r\n                    if (!silent) {\r\n                        this.emit('change', key);\r\n                        this.emit('change:' + key);\r\n                        this.emit('mutate', mutateData);\r\n                        this.emit('mutate:' + key, mutateData);\r\n                        this.emit('remove', key);\r\n                        this.emit('remove:' + key);\r\n                    }\r\n\r\n                    // clean up\r\n                    delete mutateData.oldValue;\r\n                }\r\n            }\r\n        },\r\n\r\n        removeEventHandler : function(type, handler) {\r\n            var handlers = _.eventHandlers[this._guid];\r\n\r\n            if (type && handler) {\r\n                // Remove a specific handler\r\n                handlers = handlers[type];\r\n                if (!handlers) return;\r\n\r\n                for (var i = 0, l = handlers.length, h; i < l; i++) {\r\n                    h = handlers[i].handler;\r\n                    if (h && h === handler) {\r\n                        handlers.splice(i--, 1);\r\n                        l--;\r\n                    }\r\n                }\r\n            } else if (type) {\r\n                // Remove all handlers for a specific type\r\n                delete handlers[type];\r\n            } else {\r\n                // Remove all handlers for this module\r\n                _.eventHandlers[this._guid] = {};\r\n            }\r\n        },\r\n\r\n        setAttribute : function(key, value, silent) {\r\n            silent = silent || false;\r\n\r\n            // We need to do this before we actually add the item :)\r\n            var itemExists = this.has(key);\r\n            var oldValue = _.attr(this._guid)[key];\r\n\r\n            // Is the value different than the oldValue? If not, ignore this call\r\n            if (value === oldValue) {\r\n                return;\r\n            }\r\n\r\n            // Actually add the item to the attributes\r\n            _.attr(this._guid)[key] = value;\r\n\r\n            // If 'silent' flag is set, do not throw any events\r\n            if (silent) {\r\n                return;\r\n            }\r\n\r\n            // Throw a generic event\r\n            this.emit('change', key);\r\n\r\n            // And a namespaced event as well, NOTE that we pass value instead of\r\n            // key here!\r\n            this.emit('change:' + key, value);\r\n\r\n            // Throw namespaced and non-namespaced 'mutate' events as well with\r\n            // the old value data as well and some extra metadata such as the key\r\n            var mutateData = {\r\n                \"key\" : key,\r\n                \"newValue\" : value,\r\n                \"oldValue\" : oldValue || null\r\n            };\r\n\r\n            this.emit('mutate', mutateData);\r\n            this.emit('mutate:' + key, mutateData);\r\n\r\n            // Also throw a specific event for this type of set\r\n            var specificEvent = itemExists ? 'update' : 'create';\r\n\r\n            this.emit(specificEvent, key);\r\n\r\n            // And a namespaced event as well, NOTE that we pass value instead of key\r\n            this.emit(specificEvent + ':' + key, value);\r\n        },\r\n\r\n        trim : function(str) {\r\n            return str.replace(/^\\s\\s*/, '').replace(/\\s\\s*$/, '');\r\n        },\r\n\r\n        typeOf : function(val) {\r\n            if (val === null || typeof val === \"undefined\") {\r\n                // This is a special exception for IE, in other browsers the\r\n                // method below works all the time\r\n                return String(val);\r\n            } else {\r\n                return Object.prototype.toString.call(val).replace(/\\[object |\\]/g, '').toLowerCase();\r\n            }\r\n        },\r\n\r\n        updateAttribute : function(key, fn, silent) {\r\n            var item = this.get(key);\r\n\r\n            // In previous versions of Stapes we didn't have the check for object,\r\n            // but still this worked. In 0.7.0 it suddenly doesn't work anymore and\r\n            // we need the check. Why? I have no clue.\r\n            var type = _.typeOf(item);\r\n\r\n            if (type === 'object' || type === 'array') {\r\n                item = _.clone(item);\r\n            }\r\n\r\n            var newValue = fn.call(this, item, key);\r\n            _.setAttribute.call(this, key, newValue, silent || false);\r\n        }\r\n    };\r\n\r\n    // Can be mixed in later using Stapes.mixinEvents(object);\r\n    var Events = {\r\n        emit : function(types, data) {\r\n            data = (typeof data === \"undefined\") ? null : data;\r\n\r\n            var splittedTypes = types.split(\" \");\r\n\r\n            for (var i = 0, l = splittedTypes.length; i < l; i++) {\r\n                var type = splittedTypes[i];\r\n\r\n                // First 'all' type events: is there an 'all' handler in the\r\n                // global stack?\r\n                if (_.eventHandlers[-1].all) {\r\n                    _.emitEvents.call(this, \"all\", data, type, -1);\r\n                }\r\n\r\n                // Catch all events for this type?\r\n                if (_.eventHandlers[-1][type]) {\r\n                    _.emitEvents.call(this, type, data, type, -1);\r\n                }\r\n\r\n                if (typeof this._guid === 'number') {\r\n                    // 'all' event for this specific module?\r\n                    if (_.eventHandlers[this._guid].all) {\r\n                        _.emitEvents.call(this, \"all\", data, type);\r\n                    }\r\n\r\n                    // Finally, normal events :)\r\n                    if (_.eventHandlers[this._guid][type]) {\r\n                        _.emitEvents.call(this, type, data);\r\n                    }\r\n                }\r\n            }\r\n        },\r\n\r\n        off : function() {\r\n            _.removeEventHandler.apply(this, arguments);\r\n        },\r\n\r\n        on : function() {\r\n            _.addEventHandler.apply(this, arguments);\r\n        }\r\n    };\r\n\r\n    _.Module = function() {\r\n\r\n    };\r\n\r\n    _.Module.prototype = {\r\n        each : function(fn, ctx) {\r\n            var attr = _.attr(this._guid);\r\n            for (var key in attr) {\r\n                var value = attr[key];\r\n                fn.call(ctx || this, value, key);\r\n            }\r\n        },\r\n\r\n        extend : function() {\r\n            return _.extendThis.apply(this, arguments);\r\n        },\r\n\r\n        filter : function(fn) {\r\n            var filtered = [];\r\n            var attributes = _.attr(this._guid);\r\n\r\n            for (var key in attributes) {\r\n                if ( fn.call(this, attributes[key], key)) {\r\n                    filtered.push( attributes[key] );\r\n                }\r\n            }\r\n\r\n            return filtered;\r\n        },\r\n\r\n        get : function(input) {\r\n            if (typeof input === \"string\") {\r\n                // If there is more than one argument, give back an object,\r\n                // like Underscore's pick()\r\n                if (arguments.length > 1) {\r\n                    var results = {};\r\n\r\n                    for (var i = 0, l = arguments.length; i < l; i++) {\r\n                        var key = arguments[i];\r\n                        results[key] = this.get(key);\r\n                    }\r\n\r\n                    return results;\r\n                } else {\r\n                    return this.has(input) ? _.attr(this._guid)[input] : null;\r\n                }\r\n            } else if (typeof input === \"function\") {\r\n                var items = this.filter(input);\r\n                return (items.length) ? items[0] : null;\r\n            }\r\n        },\r\n\r\n        getAll : function() {\r\n            return _.clone( _.attr(this._guid) );\r\n        },\r\n\r\n        getAllAsArray : function() {\r\n            var arr = [];\r\n            var attributes = _.attr(this._guid);\r\n\r\n            for (var key in attributes) {\r\n                var value = attributes[key];\r\n\r\n                if (_.typeOf(value) === \"object\" && !value.id) {\r\n                    value.id = key;\r\n                }\r\n\r\n                arr.push(value);\r\n            }\r\n\r\n            return arr;\r\n        },\r\n\r\n        has : function(key) {\r\n            return (typeof _.attr(this._guid)[key] !== \"undefined\");\r\n        },\r\n\r\n        map : function(fn, ctx) {\r\n            var mapped = [];\r\n            this.each(function(value, key) {\r\n                mapped.push( fn.call(ctx || this, value, key) );\r\n            }, ctx || this);\r\n            return mapped;\r\n        },\r\n\r\n        // Akin to set(), but makes a unique id\r\n        push : function(input, silent) {\r\n            if (_.typeOf(input) === \"array\") {\r\n                for (var i = 0, l = input.length; i < l; i++) {\r\n                    _.setAttribute.call(this, _.makeUuid(), input[i], silent || false);\r\n                }\r\n            } else {\r\n                _.setAttribute.call(this, _.makeUuid(), input, silent || false);\r\n            }\r\n\r\n            return this;\r\n        },\r\n\r\n        remove : function(input, silent) {\r\n            if (typeof input === 'undefined') {\r\n                // With no arguments, remove deletes all attributes\r\n                _.attributes[this._guid] = {};\r\n                this.emit('change remove');\r\n            } else if (typeof input === \"function\") {\r\n                this.each(function(item, key) {\r\n                    if (input(item)) {\r\n                        _.removeAttribute.call(this, key, silent);\r\n                    }\r\n                });\r\n            } else {\r\n                // nb: checking for exists happens in removeAttribute\r\n                _.removeAttribute.call(this, input, silent || false);\r\n            }\r\n\r\n            return this;\r\n        },\r\n\r\n        set : function(objOrKey, valueOrSilent, silent) {\r\n            if (typeof objOrKey === \"object\") {\r\n                for (var key in objOrKey) {\r\n                    _.setAttribute.call(this, key, objOrKey[key], valueOrSilent || false);\r\n                }\r\n            } else {\r\n                _.setAttribute.call(this, objOrKey, valueOrSilent, silent || false);\r\n            }\r\n\r\n            return this;\r\n        },\r\n\r\n        size : function() {\r\n            var size = 0;\r\n            var attr = _.attr(this._guid);\r\n\r\n            for (var key in attr) {\r\n                size++;\r\n            }\r\n\r\n            return size;\r\n        },\r\n\r\n        update : function(keyOrFn, fn, silent) {\r\n            if (typeof keyOrFn === \"string\") {\r\n                _.updateAttribute.call(this, keyOrFn, fn, silent || false);\r\n            } else if (typeof keyOrFn === \"function\") {\r\n                this.each(function(value, key) {\r\n                    _.updateAttribute.call(this, key, keyOrFn);\r\n                });\r\n            }\r\n\r\n            return this;\r\n        }\r\n    };\r\n\r\n    var Stapes = {\r\n        \"_\" : _, // private helper functions and properties\r\n\r\n        \"extend\" : function() {\r\n            return _.extendThis.apply(_.Module.prototype, arguments);\r\n        },\r\n\r\n        \"mixinEvents\" : function(obj) {\r\n            obj = obj || {};\r\n\r\n            _.addGuid(obj);\r\n\r\n            return _.extend(obj, Events);\r\n        },\r\n\r\n        \"on\" : function() {\r\n            _.addEventHandler.apply(this, arguments);\r\n        },\r\n\r\n        \"subclass\" : function(obj, classOnly) {\r\n            classOnly = classOnly || false;\r\n            obj = obj || {};\r\n            obj.superclass = classOnly ? function(){} : _.Module;\r\n            return _.createSubclass(obj, !classOnly);\r\n        },\r\n\r\n        \"version\" : VERSION\r\n    };\r\n\r\n    // This library can be used as an AMD module, a Node.js module, or an\r\n    // old fashioned global\r\n    if (typeof exports !== \"undefined\") {\r\n        // Server\r\n        if (typeof module !== \"undefined\" && module.exports) {\r\n            exports = module.exports = Stapes;\r\n        }\r\n        exports.Stapes = Stapes;\r\n    } else if (typeof define === \"function\" && define.amd) {\r\n        // AMD\r\n        define(function() {\r\n            return Stapes;\r\n        });\r\n    } else {\r\n        // Global scope\r\n        window.Stapes = Stapes;\r\n    }\r\n})();\r\n;/* \r\n * Shortcut list: \r\n$X = IX.get;\r\n$XA = IX.cvtToArray;\r\n$XD = IX.Dom;\r\n$XE = IX.err;\r\n$XF = IX.getPropertyAsFunction;\r\n$XH = IX.HtmlDocument;\r\n$XP = IX.getProperty;\r\n *\r\n*/\r\n\r\n/**\r\n *  IX is a basic library which provider following functions: {\r\n *  \tisEmpty(param) : return if param is undefined, null or empty string.\r\n *  \tisObject(parma) : return if param is an instance of object.\r\n *  \tisString(param) : return if param is an instance of string. Empty string will not be taken as String.\r\n *  \tisFn(param): return if param is an instance of string.\r\n *  \tisBoolean(param): return if param is an Boolean.\r\n *  \tisArray(param) : return if param is an instance of Array.\r\n *\t\tgetClass(param) : return param's type with toLowerCase\r\n *  \r\n *  \thasProperty(object, propertyName)\r\n *  \tsetProperty(object, propertyName, defaultValue)\r\n *  \tgetProperty(object, propertyName, defaultValue): \r\n *  \t\t\tif object has a property named as propertyName, return its value no matter if it is null or empty;\r\n *  \t\t\totherwise return the defaultValue; \r\n *  \tgetPropertyAsFunction\r\n *\t\tclone(object): create a duplicate object and return it. \r\n *\t\t\t\tThe new object is totally different with object although the value is same.\r\n *\r\n *\t\tns(namespaceName): check if namespaceName is existed in current page window. \r\n *\t\t\t\tIf not, create it to keep. \r\n *\t\tnsExisted(namespaceName) : return if namespaceName is existed in current page wilndow.\r\n *\t\tgetNS(namespaceName): check if namespaceName is existed in current page window,\r\n *\t\t\t\tIf yes, return the object identified by namespaceName. Otherwise, return false.\r\n *\r\n *\t\titerate(arrayObject, fn): iterate to call fn for every elements in arrayObject by sequence.\r\n *\t\t\t\tfn is a function to accept such object and index of object in arrayObject. \r\n *\t\t\t\tit can be defined as function(item, indexOfItemInArray)\r\n *\t\tfnIterate(arrayObject, fnName): similar with iterate function, but no need to provide function.\r\n\r\n *\t\t\t\tfnName should be a string to identified a function for each element in array.\r\n *\t\tloop(arrayObject, accumulator, iterateFunction): iterate to do accumulation for every elements in arrayObject by sequence.\r\n *\t\t\t\titerateFunction can be defined as function(oldAccumulator, item, indexOfItemInArray), its task is\r\n *\t\t\t\t\tdeal with the item and the oldAccumulator and return the newAccumulator to help loop function to \r\n *\t\t\t\t\tget the result of accumulation.\r\n * \t\tpartLoop(arrayObject, startIndex, endIndex, accumulator, iterateFunction):  basically, it is same as loop function.\r\n * \t\t\t\tBut it will not deal with all elements by the elements from startIndex to endIndex(not include endIndex).\r\n * \t\t\t\t\tIf the startIndex or endIndex is over-ranged, it just uses the proper index. \r\n *      loopDsc(arrayObject, accumulator, iterateFunction): basically, it is same as loop function. \r\n *      \t\tBut it will deal with element from the last one to the first one.\r\n *      each(object, accumulator, iterateFunction) : it will deal with all properties for object and return the accumulated result.\r\n *      \t\t iterateFunction can be defined as function(oldAccumulator, propertyValue, propertyName, indexOfPropertyInObject), \r\n *      \t\t\tits task is\tdeal with the property and the oldAccumulator and return the newAccumulator to help each function to \r\n *\t\t\t\t\tget the result of accumulation.\r\n *\t\t\r\n *\t\textend(dst, src): copy all properties from src to dst no matter if the property has existed in dst. \r\n *\t\t\t\tAfter copying, return new dst. src will not be changed but dst should be changed.\r\n *\t\tinherit(src, ...): create a new object, copy all properties from each src by sequence.\r\n *\t\t\t\tAfter copying, return new object. Each src will not be changed.\r\n *\r\n *\t\tisMSIE: the value to indicate if current browser is MicroSoft IE.\r\n *\t\tisMSIE7: the value to indicate if current browser is MicroSoft IE 7.0.\r\n *\t\tisSafari: the value to indicate if current browser is Safari.\r\n *\t\tgetUrlParam(key, defaultValue) : try to return the value of parameter identified by key in current URL. \r\n *\t\t\t\tIf current URL has not included the key, return the default value.\r\n *\t\tlisten(type, target, eventName,  handerFunction): try to attach/detach an event handler on specified target.\r\n *\t\t\t\ttype: \"attach\" or \"detach\"\r\n *\t\t\t\ttarget: should be a DOM object.\r\n *\t\t\t\teventName:  for example \"click\", \"mousemove\",...\r\n *\t\t\t\thandlerFunction : an event handler.\r\n *\r\n *\t\ttoAnchor(anchorName): let current focus jump to specified anchor named as anchorName.\r\n *\r\n *\t\temptyFn: just a function shell but do nothing.\r\n *\t\texecute(functionName, arguments): find the object which namespace is functionName. \r\n *\t\t\t\tIf it is function, call it using the given arguments which is array.\r\n *\t\ttryFn(functionObject): try to execute the given functionObject. If the given object is not function, do nothing.\r\n *\r\n *\t\tget(domEl): try to get a DOM element by domEl which can be element or id of element.\t\r\n *  }\r\n */\r\nwindow.IX = (function(){\r\n\tvar currentVersion=\"1.0\";\r\n\t\r\n\tvar isEmptyFn = function(str){\r\n\t\treturn (str===undefined||str===null||str===\"\");\t\t\r\n\t};\r\n\tvar BaseTypes = {\r\n\t\t\"object\": Object,\r\n\t\t\"function\": Function,\r\n\t\t\"string\":String,\r\n\t\t\"boolean\":Boolean,\r\n\t\t\"number\": Number\r\n\t};\r\n\tvar isTypeFn = function(type){\r\n\t\tvar fn =function(obj){\r\n\t\t\treturn (!isEmptyFn(obj) && (typeof(obj)==type || obj instanceof BaseTypes[type]));\r\n\t\t};\r\n\t\treturn fn; \r\n\t};\r\n\r\n\tvar typeUtils = {\r\n\t\tisEmpty : isEmptyFn,\r\n\t\tisBoolean : isTypeFn(\"boolean\"),\r\n\t\tisObject : isTypeFn(\"object\"),\r\n\t\tisString : isTypeFn(\"string\"),\r\n\t\tisNumber : isTypeFn(\"number\"),\r\n\t\tisFn : isTypeFn(\"function\"),\r\n\t\tisArray : function(ob) {return (!!ob && ob instanceof Array);},\r\n\t\tisElement: function(el){return el.nodeType===1;},\r\n\t\tgetClass : function (ob) { return Object.prototype.toString.call(ob).match(/^\\[object\\s(.*)\\]$/)[1].toLowerCase();}\r\n\t};\r\n\t\r\n\tvar loopFn = function(varr,sIdx,eIdx, acc0, fun, isAscLoop) {\r\n\t\tif (varr==null ||varr.length==0){\r\n\t\t\treturn acc0;\r\n\t\t}\r\n\t\tvar len=varr.length;\r\n\t\teIdx = (eIdx==-1)?len: eIdx;\r\n\t\tif (sIdx>=eIdx){\r\n\t\t\treturn acc0;\r\n\t\t}\r\n\t\tvar acc = acc0, min = Math.max(0, sIdx), max = Math.min(len, eIdx);\r\n\t\tvar xlen = len -1;\r\n\t\tfor (var i=0; i<=xlen; i+=1) {\r\n\t\t\tvar idx = isAscLoop?i:(xlen-i);\r\n\t\t\t//try{\r\n\t\t\tif (idx>=min && idx <max && (idx in varr)){\r\n\t\t\t\tacc = fun(acc, varr[idx], idx);\r\n\t\t\t}\r\n\t\t\t//}catch(e){\r\n\t\t\t\t//alert(e);\r\n\t\t\t//}\r\n\t\t}\r\n\t\treturn acc;\r\n\t};\r\n\tvar iterateFn = function(arr, fun){\r\n\t\tif (isEmptyFn(arr))\r\n\t\t\treturn;\r\n\t\tvar len = arr.length;\r\n\t\tfor (var i=0; i<len; i+=1)\t\t\t\r\n\t\t\tfun(arr[i], i);\r\n\t};\r\n\tvar loopUtils = {\r\n\t\titerate: iterateFn,\r\n\t\tfnIterate :function(arr, fname){\r\n\t\t\titerateFn(arr, function(item){\r\n\t\t\t\tif ((fname in item) && typeUtils.isFn(item[fname]))\r\n\t\t\t\t\titem[fname]();\r\n\t\t\t});\r\n\t\t},\r\n\t\tloop:function(varr, acc0, fun) {\r\n\t\t\treturn loopFn(varr, 0, -1, acc0, fun, true);\r\n\t\t},\r\n\t\tloopbreak: function(varr, fun) {\r\n\t\t\ttry{\r\n\t\t\t\tloopFn(varr, 0, -1, 0, fun, true);\r\n\t\t\t}catch(_ex){\r\n\t\t\t\t//log(_ex);\r\n\t\t\t}\r\n\t\t},\r\n\t\tpartLoop:function(varr,sIdx,eIdx, acc0, fun) {\r\n\t\t\treturn loopFn(varr,sIdx,eIdx, acc0, fun, true);\r\n\t\t},\r\n\t\tloopDsc:function(varr, acc0, fun) {\r\n\t\t\treturn loopFn(varr,0, -1, acc0, fun, false);\r\n\t\t},\r\n\t\tmap : function(arr, fun){\r\n\t\t\treturn loopFn(arr, 0, -1, [], function(acc, item, idx){\r\n\t\t\t\tacc.push(fun(item,idx));\r\n\t\t\t\treturn acc;\r\n\t\t\t}, true);\r\n\t\t},\r\n\t\teach:function(obj, acc0, fun){\r\n\t\t\tvar acc = acc0, p=\"\", idx = 0;\r\n\t\t\tfor (p in obj){\r\n\t\t\t\tacc = fun(acc, obj[p], p, idx);\r\n\t\t\t\tidx+=1;\r\n\t\t\t}\r\n\t\t\treturn acc;\r\n\t\t}\r\n\t};\r\n\r\n\tvar arrUtils = {\r\n\t\tcvtToArray : function (iterable) {\r\n\t\t\tif (!iterable)\r\n\t\t\t\treturn [];\r\n\t\t\tif (iterable.toArray)\r\n\t\t\t\treturn iterable.toArray();\r\n\t\r\n\t\t\tvar results = [];\r\n\t\t\tvar len = iterable.length;\r\n\t\t\tfor (var i = 0; i < len; i++)\r\n\t\t\t\tresults.push(iterable[i]);\r\n\t\t    return results;\r\n\t\t}\r\n\t};\r\n\t\r\n\t/**\r\n\t * Creates a deep copy of an object.\r\n\t * Attention: there is no support for recursive references.\r\n\t * @param {Object} object The object to be cloned.\r\n\t * @returns {Object} The object clone.\r\n\t * @example\r\n\t * var obj =  {\r\n\t *         name : 'John',\r\n\t *         cars : {\r\n\t *                 Mercedes : { color : 'blue' },\r\n\t *                 Porsche : { color : 'red' }\r\n\t *         }\r\n\t * };\r\n\t * var clone = IX.clone( obj );\r\n\t * clone.name = 'Paul';\r\n\t * clone.cars.Porsche.color = 'silver';\r\n\t * alert( obj.name );\t// John\r\n\t * alert( clone.name );\t// Paul\r\n\t * alert( obj.cars.Porsche.color );\t// red\r\n\t * alert( clone.cars.Porsche.color );\t// silver\r\n\t */\r\n\tvar cloneFn =function(obj) {\r\n\t\tvar clone;\r\n\r\n\t\t// Array.\r\n\t\tif (typeUtils.isArray(obj)) {\r\n\t\t\tclone = [];\r\n\t\t\tfor (var i = 0; i < obj.length; i++)\r\n\t\t\t\tclone[i] = cloneFn(obj[i]);\r\n\t\t\treturn clone;\r\n\t\t}\r\n\r\n\t\t// \"Static\" types.\r\n\t\tif (obj === null || (typeof(obj) != 'object') || (obj instanceof String) || (obj instanceof Number)\r\n\t\t\t\t|| (obj instanceof Boolean) || (obj instanceof Date) || (obj instanceof RegExp)) {\r\n\t\t\treturn obj;\r\n\t\t}\r\n\r\n\t\t// Objects.\r\n\t\tclone = new obj.constructor();\r\n\t\tfor (var propertyName in obj) {\r\n\t\t\tvar property = obj[propertyName];\r\n\t\t\tclone[propertyName] = cloneFn(property);\r\n\t\t}\r\n\t\treturn clone;\r\n\t};\r\n\r\n\t/*\r\n\t\tdeepCompare\r\n\t*/\r\n    var deepCompare = function (y, x) {\r\n        if (x == null || y == null || x == undefined || y == undefined) return x == y;\r\n        for (p in y) {\r\n            if (!(p in x) || typeof (x[p]) == 'undefined')\r\n                return false;\r\n            if (y[p]) {\r\n                if (typeof (x[p]) != typeof (y[p])) return false;\r\n                switch (typeof (y[p])) {\r\n                    case 'object':\r\n                        if (!deepCompare(y[p], x[p]))\r\n                            return false;\r\n                        break;\r\n                    case 'function':\r\n                        if (typeof (x[p]) == 'undefined' || y[p].toString() != x[p].toString())\r\n                            return false;\r\n                        break;\r\n                    default:\r\n                        if (y[p] != x[p])\r\n                            return false;\r\n                }\r\n            }\r\n            else if (x[p])\r\n                return false;\r\n        }\r\n        for (p in x) {\r\n            if (!(p in y) || typeof (y[p]) == 'undefined')\r\n                return false;\r\n        }\r\n        return true;\r\n    };\r\n\tvar propertyUtils = {\r\n\t\thasProperty : function(obj, pName){\r\n\t\t\tif (!obj)\r\n\t\t\t\treturn false;\r\n\t\t\ttry{\r\n\t\t\t\tif(pName in obj) return true;\r\n\t\t\t}catch(ex){}\r\n\t\t\tvar names = pName.split(\".\");\r\n\t\t\tvar pObj = obj;\r\n\t\t\tvar len = names.length;\r\n\t\t\tfor (var i=0; i<len; i++) {\r\n\t\t\t\ttry{\r\n\t\t\t\t\tif (pObj && (names[i] in pObj)) \r\n\t\t\t\t\t\tpObj = pObj[names[i]];\r\n\t\t\t\t\t else \r\n\t\t\t\t\t\treturn false;\r\n\t\t\t\t}catch(_ex){\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn true;\r\n\t\t},\r\n\t\tgetProperty : function(obj, pName, defV) {\r\n\t\t\tvar v = (defV!=undefined) ? defV : null;\r\n\t\t\tif (obj==null)\r\n\t\t\t\treturn v;\r\n\t\t\ttry{\r\n\t\t\t\tif(pName in obj) return obj[pName];\r\n\t\t\t}catch(ex){}\r\n\t\t\tvar names = pName.split(\".\");\r\n\t\t\tvar pObj = obj;\r\n\t\t\tvar len = names.length;\r\n\t\t\tfor (var i=0; i<len; i++) {\r\n\t\t\t\ttry{\r\n\t\t\t\t\tif (pObj && (names[i] in pObj)) {\r\n\t\t\t\t\t\tpObj = pObj[names[i]];\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\treturn v;\r\n\t\t\t\t\t}\r\n\t\t\t\t}catch(_ex){\r\n\t\t\t\t\treturn v;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn pObj;\r\n\t\t},\r\n\t\tsetProperty : function(obj, pName, v){\r\n\t\t\ttry{\r\n\t\t\t\tif(pName in obj) {\r\n\t\t\t\t\tobj[pName] = v;\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t}catch(ex){}\r\n\t\t\tvar names = pName.split(\".\");\r\n\t\t\tvar pObj = obj, _name = names.pop();\r\n\t\t\tvar len = names.length;\r\n\t\t\tfor (var i=0; i<len; i++) {\r\n\t\t\t\tvar _sname = names[i];\r\n\t\t\t\ttry{\r\n\t\t\t\t\tif (!(_sname in pObj) || !pObj[_sname] || typeof pObj[_sname] !=\"object\" )\r\n\t\t\t\t\t\tpObj[_sname] = {};\r\n\t\t\t\t} catch(e){\r\n\t\t\t\t\tpObj[_sname] = {};\r\n\t\t\t\t}\r\n\t\t\t\tpObj = pObj[_sname];\r\n\t\t\t}\r\n\t\t\tpObj[_name] = v;\r\n\t\t},\r\n\t\tgetPropertyAsFunction:function(obj, fName){\r\n\t\t\tvar fn = IX.getProperty(obj, fName);\r\n\t\t\treturn IX.isFn(fn)?fn : IX.emptyFn;\r\n\t\t},\r\n\t\tclone :cloneFn,\r\n\t\tdeepCompare: deepCompare\r\n\t};\r\n\r\n\tvar nsLoopFn = function(nsname, fn){\r\n\t\tvar names = nsname.split(\".\");\r\n\t\tif (names[0]==\"window\")\r\n\t\t\tnames.shift();\r\n\t\tvar nsObj = window, flag = true, i=0, len = names.length; \r\n\t\twhile(i<len && flag){\r\n\t\t\tvar curname = names[i];\r\n\t\t\tflag = fn(curname, nsObj);\r\n\t\t\tif(flag)\r\n\t\t\t\tnsObj = nsObj[curname];\r\n\t\t\ti++;\r\n\t\t}\r\n\t\treturn flag;\r\n\t};\r\n\tvar namespaceUtils = {\r\n\t\tns : function(nsname){\r\n\t\t\tnsLoopFn(nsname, function(name, obj){\r\n\t\t\t\tif (!(name in obj))\r\n\t\t\t\t\tobj[name] = {};\r\n\t\t\t\treturn true;\r\n\t\t\t});\r\n\t\t},\r\n\t\tnsExisted : function(nsname){\r\n\t\t\treturn nsLoopFn(nsname, function(name, obj){\r\n\t\t\t\treturn obj && (name in obj);\r\n\t\t\t});\r\n\t\t},\r\n\t\tsetNS : function(nsname, obj){\r\n\t\t\tvar names = nsname.split(\".\");\r\n\t\t\tif (names[0]==\"window\")\r\n\t\t\t\tnames.shift();\r\n\t\t\tif (names.length==0 || IX.isEmpty(names[0]))\r\n\t\t\t\treturn;\r\n\t\t\tvar nsObj = window, len = names.length;\r\n\t\t\tfor (var i=0; i<len-1; i++){\r\n\t\t\t\tvar curname = names[i];\r\n\t\t\t\tif (!(curname in nsObj))\r\n\t\t\t\t\tnsObj[curname] = {};\r\n\t\t\t\tnsObj = nsObj[curname];\r\n\t\t\t}\r\n\t\t\tnsObj[names[len-1]] = obj;\r\n\t\t},\r\n\t\tgetNS :function(objName) {\r\n\t\t\treturn nsLoopFn(objName, function(name, obj){\r\n\t\t\t\treturn (name in obj)?obj[name]:false;\r\n\t\t\t});\r\n\t\t}\r\n\t};\r\n\r\n\tvar extendFn = function(dst, src) {\r\n\t\tif (dst==null || dst==undefined)\r\n\t\t\tdst = {};\r\n\t\tfor (var _p in src)\r\n\t\t\tdst[_p] = src[_p];\r\n\t\treturn dst;\r\n\t};\r\n\tvar extendUtils = {\r\n\t\t// obj = IX.extend(dst, src);\r\n\t\t// obj will has all members in both dst and src, \r\n\t\t// in same time, dst will has all members in src. \r\n\t\textend: extendFn,\r\n\t\t// obj = IX.inherit(src1, src2, src3,...);\r\n\t\t// obj will has all members in all src*, \r\n\t\t// and all src* will not be changed. \r\n\t\tinherit : function(){\r\n\t\t\treturn loopUtils.loop(arrUtils.cvtToArray(arguments), {}, function(acc, item){\r\n\t\t\t\treturn extendFn(acc, item);\r\n\t\t\t});\r\n\t\t}\r\n\t};\r\n\r\n\tvar getTimeInMS = function() {return (new Date()).getTime();};\r\n\tvar ua = navigator.userAgent.toLowerCase();\r\n\tvar checkUA = function(keywords){\r\n\t\treturn ua.indexOf(keywords)!=-1;\r\n\t};\r\n\tvar hasEventListener = (\"addEventListener\" in window) ;\r\n\tvar _handlerWrapper = function(handler) {\r\n\t\tvar fn = function(evt){\r\n\t\t\tvar e = evt || window.event;\r\n\t\t\tif (!(\"target\" in e))\r\n\t\t\t\te.target = e.srcElement; // for IE hack\r\n\t\t\treturn handler(e);\r\n\t\t};\r\n\t\treturn fn;\r\n\t};\r\n\tvar _bindHandlers = function(el, handlers, isBind, isOnce){\r\n\t\tif(!el) return;\r\n\t\t\t\t\r\n\t\tisBind&&(el._EVENTNAMES||(el._EVENTNAMES={}));\r\n\t\tIX.iterate([\"click\", \"dblclick\", \"focus\", \"blur\", \"keyup\", \"keydown\", \"mouseover\", \"mouseout\", \"resize\", \"scroll\" ,\"mousedown\", \"mousemove\", \"mouseup\",\"touchstart\", \"touchend\", \"touchmove\"], function(eventName){\r\n\t\t\tif (eventName in handlers){\t\t\t\t\t\t\t\t\r\n\t\t\t\tif(isBind){\r\n\t\t\t\t\tif(isOnce&&el._EVENTNAMES[eventName])\r\n\t\t\t\t\t\treturn;\t\t\t\r\n\t\t\t\t\tel._EVENTNAMES[eventName] = true;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tIX[isBind?\"attachEvent\":\"detachEvent\"](el, eventName, _handlerWrapper(handlers[eventName]));\r\n\t\t\t}\t\t\t\r\n\t\t});\r\n\t};\r\n\tvar browserUtils = {\r\n\t\tisMSIE7:(document.all && checkUA(\"msie 7.0\")),\r\n\t\tisSafari:(window.openDatabase && checkUA(\"safari\")),\r\n\t\t\r\n\t\tisMSIE: checkUA(\"msie\") && !checkUA(\"opera\"),    //匹配IE浏览器\r\n\r\n\t\tisOpera : checkUA(\"opera\"),   //匹配Opera浏览器\r\n\t\tisChrome: checkUA(\"chrome\"),   //匹配Chrome浏览器\r\n\t\tisFirefox: checkUA(\"firefox\") && !checkUA(\"webkit\"),   //匹配Firefox浏览器\r\n\t\t// isYunfisClient: checkUA(\"Yunfis\") || !checkUA(\"yunfis\"),   //匹配yunfis客户端\r\n\t\t\r\n\t\tisMSWin : checkUA(\"windows\"),\r\n\t\t\r\n\t\tgetTimeInMS : getTimeInMS,\r\n\t\t\r\n\t\tgetComputedStyle : (document.defaultView && \"getComputedStyle\" in document.defaultView) ? function(el){\r\n\t\t\treturn document.defaultView.getComputedStyle(el);  \r\n\t\t}:function(el){\t\t\r\n\t\t\treturn el.currentStyle || el.style; \r\n\t\t},\r\n\t\t\r\n\t\tgetUrlParam :function (key, defV){\r\n\t\t\tvar paramList = window.location.search.substring(1).split(\"&\");\r\n\t\t\tvar len = paramList.length;\r\n\t\t\tfor(var i=0; i<len; i+=1){\r\n\t\t\t\tvar _p = paramList[i]; \r\n\t\t\t\tif(_p.indexOf(key+\"=\")==0)\r\n\t\t\t\t\treturn _p.substring(key.length+1);\r\n\t\t\t}\r\n\t\t\treturn defV;\r\n\t\t},\r\n\t\t/** low performance. should not use it */\r\n\t\tlisten : function(type, target, eName, fn){\r\n\t\t\tvar _p = hasEventListener ?  {\r\n\t\t\t\tfname : type==\"detach\"?\"removeEventListener\":\"addEventListener\",\r\n\t\t\t\tetype  :eName\r\n\t\t\t} :{\r\n\t\t\t\tfname : type+ \"Event\",\r\n\t\t\t\tetype : \"on\" + eName\r\n\t\t\t};\r\n\t\t\ttarget[_p.fname](_p.etype, fn, false);\r\n\t\t},\r\n\t\tattachEvent : hasEventListener?function(target, eName, fn){\r\n\t\t\t\ttarget.addEventListener(eName, fn, false);\r\n\t\t\t}:function(target, eName, fn){\r\n\t\t\t\ttarget.attachEvent(\"on\" + eName, fn);\r\n\t\t\t},\r\n\t\tdetachEvent : hasEventListener?function(target, eName, fn){\r\n\t\t\t\ttarget.removeEventListener(eName, fn, false);\r\n\t\t\t}:function(target, eName, fn){\r\n\t\t\t\ttarget.detachEvent(\"on\" + eName, fn);\r\n\t\t\t},\r\n\t\tbind : function(el, handlers) {_bindHandlers(el, handlers, true);},\t\t\r\n\t\t//unbind : function(el, handlers) {_bindHandlers(el, handlers, false);}, //TODO: invalid\t\r\n\t\t//Attach a handler to an event for the element. The handler is executed at most once per element.\r\n\t\tbindOnce: function(el, handlers){\t\t\t\r\n\t\t\t_bindHandlers(el, handlers, true,true);\r\n\t\t},\r\n\t\ton : function(target, eName, fn) {\r\n\t\t\ttarget[\"on\" + eName] = fn;\r\n\t\t}\r\n\t};\r\n\t\r\n\tvar locationUtils = {\t\t\t\t\r\n\t\ttoAnchor : function(name){\r\n\t\t\twindow.location.hash = \"#\" + name;\r\n\t\t}\t\t\r\n\t};\r\n\t\r\n\tvar emptyFn=function(){/**Empty Fn*/};\r\n\tvar selfFn = function(o){return o;};\r\n\t/**\r\n\t *  _config :{\r\n\t *     maxAge : timeInMSec, default no limit;\r\n\t *     expire:\r\n\t *  } \r\n\t */\r\n\tvar checkReadyFn = function(condFn, execFn, period, _config){\t\t\r\n\t\tvar _period = Math.max(20, period || 100);\r\n\t\tvar maxAge = $XP(_config, \"maxAge\", null), expireFn = $XF(_config, \"expire\"), startTick = null;\r\n\t\tif (isNaN(maxAge))\r\n\t\t\tmaxAge = null;\t\t\r\n\t\tfunction _checkFn(){\t\t\t\r\n\t\t\tif (condFn())\r\n\t\t\t\texecFn();\r\n\t\t\telse if (maxAge!=null && (getTimeInMS()-startTick)>maxAge)\r\n\t\t\t\texpireFn();\r\n\t\t\telse\r\n\t\t\t\tsetTimeout(_checkFn, _period);\r\n\t\t}\r\n\t\tif (maxAge!=null)\r\n\t\t\tstartTick = getTimeInMS();\r\n\t\t_checkFn();\r\n\t};\r\n\tvar executeUtils = {\r\n\t\temptyFn : emptyFn,\r\n\t\tselfFn: selfFn,\r\n\t\tsafeExec : function(fn){\r\n\t\t\t//try {\r\n\t\t\t\tfn();\r\n\t\t\t//}catch(e){\r\n\t\t\t//\talert(IX.Test.listProp(e));\r\n\t\t\t//}\r\n\t\t},\r\n\t\texecute : function(fname, args) {\r\n\t\t\tvar fn = namespaceUtils.getNS(fname);\r\n\t\t\tif (typeUtils.isFn(fn)){\r\n\t\t\t\tfn.apply(null, args);\r\n\t\t\t}\r\n\t\t},\r\n\t\tcheckReady : checkReadyFn, \r\n\t\ttryFn : function(fn){\r\n\t\t\treturn (typeUtils.isFn(fn))? fn() : emptyFn();\r\n\t\t}\r\n\t};\r\n\t\r\n\tvar domUtils = {\r\n\t\tdecodeTXT : function(txt){\r\n\t\t\treturn (txt+\"\").replaceAll(\"&nbsp;\", ' ').replaceAll(\"&lt;\", \"<\").replaceAll(\"&gt;\", \">\").replaceAll(\"&amp;\", \"&\");\r\n\t\t},\r\n\t\tencodeTXT : function(txt){\r\n\t\t\treturn (txt+\"\").replaceAll('&', '&amp;').replaceAll(\"<\",\"&lt;\").replaceAll(\">\", \"&gt;\").replaceAll(\" \", \"&nbsp;\");\r\n\t\t},\r\n\t\tcreateDiv : function(id,clz){\r\n//\t\t\tlog (\"createDiv :\" + id + \" \" + clz);\r\n\t\t\tvar node = document.createElement('div');\r\n\t\t\tif (!IX.isEmpty(clz))\r\n\t\t\t\tnode.className = clz;\r\n\t\t\tnode.id = id;\r\n\t\t\tdocument.body.appendChild(node);\r\n\t\t\treturn node;\r\n\t\t},\r\n\t\tget : function(domEl){\r\n\t\t\tif (IX.isEmpty(domEl))\r\n\t\t\t\treturn null;\r\n\t\t\tif (typeUtils.isString(domEl) || typeUtils.isNumber(domEl) )\r\n\t\t\t\treturn document.getElementById(domEl);\r\n\t\t\tif (\"ownerDocument\" in domEl)\r\n\t\t\t\treturn domEl;\r\n\t\t\treturn null;\t\r\n\t\t}\r\n\t};\r\n\tvar errUtils = {\r\n\t\terr : function(errMsg) {\r\n\t\t\talert(errMsg);\r\n\t\t}\r\n\t};\r\n\tvar mathUtils = {\r\n\t\tinRange : function(x, x1, x2){return (x-x1)*(x-x2)<=0;}\t\r\n\t};\r\n\t\r\n\tvar _idx = 0;\r\n\tvar idUtils = {\r\n\t\tid : function(){\r\n\t\t\t_idx ++;\r\n\t\t\treturn \"ix\"+_idx;\r\n\t\t}\t\r\n\t};\r\n\r\n\tvar ifRectIntersect = function (_rect1, _rect2) {\r\n        return Math.abs(_rect1.maxx + _rect1.minx - _rect2.minx - _rect2.maxx) <= _rect2.maxx - _rect2.minx + _rect1.maxx - _rect1.minx\r\n            && Math.abs(_rect1.maxy + _rect1.miny - _rect2.miny - _rect2.maxy) <= _rect2.maxy - _rect2.miny + _rect1.maxy - _rect1.miny;\r\n    };\r\n\t\r\n\treturn extendUtils.inherit(typeUtils, arrUtils, propertyUtils, namespaceUtils, loopUtils, \r\n\t\t\textendUtils, browserUtils, locationUtils, executeUtils,domUtils,errUtils, mathUtils, idUtils, {\r\n\t\tversion: currentVersion,\r\n\t\tifRectIntersect: ifRectIntersect\r\n\t});\r\n})();\r\n$X = IX.get;\r\n/**\r\n * $XA is an shortcut to IX.cvtToArray.\t\r\n * @param {} iterable : an object which can be iterated.\r\n * @return : Array object\r\n */\r\n$XA = IX.cvtToArray;\r\n$XE = IX.err;\r\n/**\r\n * $XP is an shortcut for IX.getProperty. For example:\r\n * \t\tvar myId = $XP(config, \"id\", 123)\r\n * \t\tit means assign config.id to myId, if config has no property named as \"id\", assign 123 to myId. \r\n *  \r\n */\r\n$XP = IX.getProperty;\r\n/**\r\n * $XF is an shortcut for IX.getPropertyAsFunction. For example:\r\n * \t\tvar closeFn = $XF(config, \"close\")\r\n * \t\tit means assign config.close to closeFn, if config has no property named as \"close\", assign IX.emptyFn to closeFn. \r\n *  \r\n */\r\n$XF = IX.getPropertyAsFunction;\r\n\r\nIX.Test =(function(){\r\n\tvar detectAttrsFn = function(obj, checkFn, injectorFn) { // injectorFn: function(result, name, value)\r\n\t\tvar count = 0;\r\n\t\treturn  IX.each(obj, \"\", function(acc, item, nc){\r\n\t\t\ttry{\r\n\t\t\t\tif (checkFn(item,nc)){\r\n\t\t\t\t\tcount += 1;\r\n\t\t\t\t\treturn injectorFn(acc,  nc, item) + (count%5==4?\"\\r\\n\":\"\");\r\n\t\t\t\t}\r\n\t\t\t}catch(e){alert(e);}\r\n\t\t\treturn acc;\r\n\t\t});\r\n\t};\r\n\tvar listFn = function(obj, matchorFn, type){\r\n\t\tif (type!=\"fun\" && IX.isString(obj)){\r\n\t\t\treturn \"String:\" + obj.toString();\r\n\t\t}\r\n\t\tvar isListFn = type==\"fun\"; \r\n\t\treturn (isListFn?\"Funcs:\":\"Props:\") + detectAttrsFn(obj, function(o){\r\n\t\t\t\treturn (((!isListFn && !IX.isFn(o)) || (isListFn && IX.isFn(o))));\r\n\t\t\t}, function(r, n, v) {\r\n\t\t\t\treturn [r, n, isListFn?\"\": [':\"', (\"\"+v).trunc(60), '\" '].join(\"\"), \", \"].join(\"\");\r\n\t\t\t}\r\n\t\t);\r\n\t};\r\n\treturn {\r\n\t\tlistProp:function(obj, matchor) {\r\n\t\t\treturn listFn(obj, matchor, \"\");\r\n\t\t},\r\n\t\tlistFun:function(obj, matchor) {\r\n\t\t\treturn listFn(obj, matchor, \"fun\");\r\n\t\t}\r\n\t};\r\n})();\r\n\r\nwindow.log = (\"IXDEBUG\" in window)? function(s){\r\n\tif (console)\r\n\t\tconsole.log(s);\r\n} : IX.emptyFn;\r\n\r\n// Debug 当IXDEBUG为true时，可以进入Debug模式\r\nIX.Debug = (function () {\r\n\treturn {\r\n\t\tinfo : function (s) {\r\n\t\t\tif (\"IXDEBUG\" in window && window.IXDEBUG === true && console) {\r\n\t\t\t\tconsole.log(s);\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n})();\r\n\r\n//////////////////////////////////////////////////// TEST-Utils finished////////\r\n\r\n/**\r\n *  IX.Array is a supplement for Array.prototype. It includes: {\r\n *  \tinit(length, defaultValue): create a new Array that each element is set to defaultValue.\r\n *  \tisFound(element, arrayObject, equalFn): return if element is in current arrayObject by equalFn.\r\n *  \t\t\tFor equalFn, should be defined as function(a,b) and return boolean value; \r\n *  \t\t\tif the caller don't provide the function and a has equal operator, use a.equal to compare.\r\n *  \t\t\totherwise, using default operator \"==\".\r\n *  \ttoSet(arrayObject, equalFn): return unduplicated array of arrayObject by equalFn.\r\n *  \tisSame(arrayObject1, arrayObject2, equalFn): return if arrayObject1 is same set as arrayObject2 no matter thr order of array elements.\r\n *  \tcompact(arrayObject, validFn):return an array object which remove all not valid elements from arrayObject by validFn. \t \r\n *  \tremove(arrayObject, element, equalFn): return new array object which removed matched elements from arrayObject.\r\n *  \tpushx(arrayObject, item): return arrayObject which add item as last element.\r\n *  \tindexOf(arrayObject, matchFn): return the index of first matched element. If no matched, return -1;\r\n *  \tsplice(arrayObject, startIndex, deleteCount, insertArrayObject): \r\n *  \t\t\tdelete \"deleteCount\" elements from startIndex in arrayObject and insert insertArrayObject into startIndex of arrayObject\r\n *  \t\t\tafter all, return the new array object.   \r\n *  }\r\n * \r\n */\r\nIX.Array = (function(){\r\n\tvar getEqualFn = function(equalFn){\r\n\t\treturn IX.isFn(equalFn)?equalFn:function(a, b) {\r\n\t\t\treturn (IX.isObject(a) &&(\"equal\" in a) &&  IX.isFn(a.equal))?a.equal(b):(a==b);\r\n\t\t};\r\n\t};\r\n\t\r\n\tvar isFoundFn = function(elem, arr, equalFn){\r\n\t\tif (arr==null ||arr.length==0)\r\n\t\t\treturn false;\r\n\t\tfor (var i=arr.length-1; i>=0; i--) {\r\n\t\t\tif (equalFn(elem, arr[i]))\r\n\t\t\t\treturn true;\r\n\t\t}\r\n\t\treturn false;\r\n\t};\r\n\t/** merge arr1 and and arr2 into new arr:\r\n\t * \tarr1: [1,3,5,7,9, 19,21,22], arr2: [2,3,4, 18,19,20]\r\n\t * merge[arr1,arr2] = [2,1,  3,  4,18, 5,7,9,  19, 21,22, 20] \r\n\t *  3 and 19 are key points:  \r\n\t */ \r\n\tvar _merge = function(arr1, arr2, equalFn){\r\n\t\tvar _arr1 = arr1 ||[], _arr2 = arr2 ||[];\r\n\t\tvar i=0, j=0, k=0, arr = [];\r\n\t\tvar len1= _arr1.length, len2 = _arr2.length;\r\n\t\tfor(i=0; i<len2; i++){\r\n\t\t\tfor (j=0; j<len1; j++){\r\n\t\t\t\tif (equalFn(_arr2[i], _arr1[j])) {\r\n\t\t\t\t\tfor (k=0; k<i; k++)\r\n\t\t\t\t\t\tarr.push(_arr2.shift());\r\n\t\t\t\t\t_arr2.shift();\r\n\t\t\t\t\tfor (k=0; k<=j; k++)\r\n\t\t\t\t\t\tarr.push(_arr1.shift());\r\n\t\t\t\t\treturn arr.concat(_merge(_arr1, _arr2, equalFn));\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn arr.concat(_arr1, _arr2);\r\n\t};\r\n\t\r\n\tvar _self = null;\r\n\t_self = {\r\n\t\tinit : function(len, defV){\r\n\t\t\tvar arr = [];\r\n\t\t\tfor (var i=0; i<len; i++)\r\n\t\t\t\tarr[i] = IX.clone(defV);\r\n\t\t\treturn arr;\r\n\t\t},\r\n\t\tisFound : function(elem, arr, equalFn){\r\n\t\t\treturn isFoundFn(elem, arr, getEqualFn(equalFn));\r\n\t\t},\r\n\t\ttoSet : function(arr, equalFn) {\r\n\t\t\tvar fn = getEqualFn(equalFn);\r\n\t\t\treturn IX.loop(arr, [], function(acc, item){\r\n\t\t\t\tif (!_self.isFound(item, acc, fn))\r\n\t\t\t\t\tacc.push(item);\r\n\t\t\t\treturn acc;\r\n\t\t\t});\r\n\t\t},\r\n\t\tsort : function(arr, cmpFn){\r\n\t\t\tvar arr1 = IX.map(arr, function(item){return item;});\r\n\t\t\treturn arr1.sort(cmpFn);\r\n\t\t},\r\n\t\tisSameSet:function(_arr1, _arr2, equalFn){\r\n\t\t\tvar arr1 = _self.toSet(_arr1), arr2 = _self.toSet(_arr2);\r\n\t\t\tif (arr1==null && arr2==null)\r\n\t\t\t\treturn true;\r\n\t\t\tif (arr1==null || arr2==null || arr1.length!=arr2.length)\r\n\t\t\t\treturn false;\r\n\t\t\tif (arr1.length==0 && arr2.length==0)\r\n\t\t\t\treturn true;\r\n\t\t\t\r\n\t\t\tvar fn = getEqualFn(equalFn);\r\n\t\t\tfor (var i=arr1.length-1; i>=0; i--){\r\n\t\t\t\tif (!isFoundFn(arr1[i], arr2, fn))\r\n\t\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t\treturn true;\r\n\t\t},\r\n\t\tcompact: function(arr, validFn) {\r\n\t\t\tvar fn = IX.isFn(validFn)?validFn:function(item){return item;};\r\n\t\t\treturn IX.loop(arr, [], function(acc, item) {\r\n\t\t\t\tif (fn(item))\r\n\t\t\t\t\tacc.push(item);\r\n\t\t\t\treturn acc;\r\n\t\t\t});\r\n\t\t},\r\n\t\tremove:function(arr, elem, equalFn){\r\n\t\t\tvar fn = getEqualFn(equalFn);\r\n\t\t\treturn IX.loop(arr, [], function(acc, item){\r\n\t\t\t\tif (!fn(elem, item))\r\n\t\t\t\t\tacc.push(item);\r\n\t\t\t\treturn acc;\r\n\t\t\t});\r\n\t\t},\r\n\t\tpushx:function(arr, item){\r\n\t\t\tarr.push(item);\r\n\t\t\treturn arr;\r\n\t\t},\r\n\t\t\r\n\t\tflat : function(arr) {\r\n\t\t\treturn IX.isArray(arr)?IX.loop(arr, [], function(acc, item){\r\n\t\t\t\treturn acc.concat(_self.flat(item));\r\n\t\t\t}) : [arr];\r\n\t\t},\r\n\t\tindexOf :function(arr, matchFn) {\r\n\t\t\tif(!arr || arr.length==0)\r\n\t\t\t\treturn -1;\r\n\t\t\tvar len = arr.length;\r\n\t\t\tfor (var i=0; i<len; i++) {\r\n\t\t\t\tif (matchFn(arr[i]))\r\n\t\t\t\t\treturn i;\r\n\t\t\t}\r\n\t\t\treturn -1;\r\n\t\t},\r\n\r\n\t\t// exmaples:\r\n\t\t// arr= [\"a\", \"b\", \"c\", \"d\"]\r\n\t\t// (arr, 4) : return []\r\n\t\t// (arr, 3):  remove 1 elem: arr[3]; return [\"a\", \"b\", \"c\"];\r\n\t\t// (arr, 3, 4) : return []\r\n\t\t// (arr, 1, 2) : remove 2 elems: arr[1], arr[2]; return [\"a\", \"d\"];\r\n\t\t// (arr, 1, 2, [\"g\", \"k\", \"l\"]) : remove 2 elems: arr[1], arr[2] and add 3 elems; \r\n\t\t//              return [\"a\", \"g\", \"k\", \"l\", \"d\"];\r\n\t\t// (arr, 1, 0, [\"g\", \"k\", \"l\"]) : remove 0 elems and add 3 elems; \r\n\t\t//              return [\"a\", \"g\", \"k\", \"l\", \"b\", \"c\", \"d\"];\r\n\t\tsplice:function(arr, start, deleteCount, insertArray) {\r\n\t\t\tvar count = isNaN(deleteCount)?1:deleteCount;\r\n\t\t\tvar len = arr.length;\r\n\t\t\tif (start<0 || start>len || count<0 || (start+count)>len){\r\n\t\t\t\treturn [];\r\n\t\t\t}\r\n\t\t\tvar iArr = insertArray?insertArray:[];\r\n\t\t\treturn [].concat(arr.slice(0, start), iArr, arr.slice(start+count));\r\n\t\t},\r\n\t\t\r\n\t\t/** merge arr1 and and arr2 into new arr:\r\n\t\t * \tarr1: [1,3,5,7,9, 19,21,22], arr2: [2,3,4, 18,19,20]\r\n\t\t * merge[arr1,arr2] = [2,  1,3,  4,18, 5,7,9,19, 21,22, 20] \r\n\t\t *  3 and 19 are key points:  \r\n\t\t */ \r\n\t\tmerge : function(arr1, arr2, equalFn){\r\n\t\t\treturn _merge(arr1, arr2, getEqualFn(equalFn));\r\n\t\t}\r\n\t};\r\n\treturn _self;\r\n})();\r\n\r\nIX.IState = (function(){\r\n\treturn {\r\n\t\ttoggle :function(origStat, newStat){\r\n\t\t\treturn (newStat==undefined)?!origStat : newStat;\r\n\t\t}\r\n\t};\r\n})();\r\n\r\nIX.IManager = function(){\r\n\tvar _ht = {};\r\n\treturn {\r\n\t\tisRegistered : function(name){\r\n\t\t\treturn (name in _ht) && (_ht[name]);\r\n\t\t},\r\n\t\tregister: function(name, obj) {\r\n\t\t\t_ht[name] = obj;\r\n\t\t},\r\n\t\tunregister : function(name){\r\n\t\t\t_ht[name] = null;\r\n\t\t},\r\n\t\tget: function(name){\r\n\t\t\treturn (name in _ht)?_ht[name]: null;\r\n\t\t},\r\n\t\tclear : function() {\r\n\t\t\t_ht = {};\r\n\t\t},\r\n\t\tdestroy : function() {\r\n\t\t\tdelete _ht;\r\n\t\t}\r\n\t};\r\n};\r\n\r\nIX.IList = function(){\r\n\tvar _keyList = [];\r\n\tvar IXArray =  IX.Array;\r\n\tvar indexOfFn = function(key) {\r\n\t\treturn key ? IXArray.indexOf(_keyList, function(item) {\r\n\t\t\treturn item == key;\r\n\t\t}) : -1;\r\n\t};\r\n\tvar removeFn = function(idx) {\r\n\t\tif (idx >= 0 && idx<_keyList.length)\r\n\t\t\t_keyList = _keyList.slice(0, idx).concat(_keyList.slice(idx+1));\r\n\t};\r\n\tvar appendFn = function(key){\r\n\t\tif (!_keyList || _keyList.length == 0)\r\n\t\t\t_keyList = [key];\r\n\t\telse {\r\n\t\t\tvar idx = indexOfFn(key);\r\n\t\t\tremoveFn(idx);\r\n\t\t\t_keyList.push(key);\r\n\t\t}\r\n\t};\r\n\treturn {\r\n\t\tisEmpty :function(){return _keyList.length==0;},\r\n\t\tisLast : function(k){return _keyList.length>0 && k==_keyList[_keyList.length-1];},\r\n\t\tgetList : function(){return _keyList;},\r\n\t\tgetSize: function(){return _keyList.length;},\r\n\t\tindexOf : indexOfFn,\r\n\t\tremove : removeFn,\r\n\t\ttryRemove : function(key){\r\n\t\t\tremoveFn(indexOfFn(key));\r\n\t\t},\r\n\t\tappend : appendFn,\r\n\t\ttryAdd :function(key){\r\n\t\t\tif (!_keyList || _keyList.length == 0)\r\n\t\t\t\t_keyList = [key];\r\n\t\t\telse if (indexOfFn(key) <0)\r\n\t\t\t\t_keyList.push(key);\r\n\t\t},\r\n\t\tinsertBefore : function(key, dstKey) {\r\n\t\t\t// find the dstKey, if not exist, append current key to the end of list.\r\n\t\t\tvar dstIdx = indexOfFn(dstKey);\r\n\t\t\tif (dstIdx == -1) {\r\n\t\t\t\tappendFn(key);\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\t// find the key, if current key is before dstKey, do nothing.\r\n\t\t\tvar idx = indexOfFn(key);\r\n\t\t\tif (idx != -1 && dstIdx - idx == 1)\r\n\t\t\t\treturn;\r\n\t\t\t// else remove the existed record and insert it before dstKey.\r\n\t\t\tif (idx >= 0) {\r\n\t\t\t\tremoveFn(idx);\r\n\t\t\t\tdstIdx = indexOfFn(dstKey);\r\n\t\t\t}\r\n\t\t\t_keyList = _keyList.slice(0, dstIdx).concat([key], _keyList.slice(idx));\r\n\t\t},\r\n\t\tclear : function(){\r\n\t\t\t_keyList = [];\r\n\t\t},\r\n\t\tdestroy : function(){\r\n\t\t\tdelete _keyList;\r\n\t\t}\r\n\t};\r\n};\r\nIX.I1ToNManager = function(eqFn) {\r\n\tvar _eqFn = IX.isFn(eqFn)?eqFn : function(item, value){return item==value;};\r\n\t\r\n\tvar _mgr = new IX.IManager();\r\n\t\r\n\tvar hasEntryFn = function(key) {\r\n\t\tvar list = _mgr.get(key);\r\n\t\treturn list && list.length>0;\t\t\r\n\t};\r\n\tvar indexOfFn = function(arr, value) {\r\n\t\treturn IX.Array.indexOf(arr, function(item){return _eqFn(item, value);});\r\n\t};\r\n\t\r\n\treturn IX.inherit(_mgr, {\r\n\t\thasValue :hasEntryFn,\r\n\t\tput : function(k, v) {\r\n\t\t\tif (!hasEntryFn(k)) {\r\n\t\t\t\t_mgr.register(k, [v]);\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tvar list = _mgr.get(k);\r\n\t\t\tif (indexOfFn(list, v)==-1)\r\n\t\t\t\t_mgr.register(k, list.concat(v));\r\n\t\t},\r\n\t\tremove : function(k, v){\r\n\t\t\tvar list = _mgr.get(k);\r\n\t\t\tvar idx = indexOfFn(list, v);\r\n\t\t\tif (idx >= 0)\r\n\t\t\t\t_mgr.register(k, IX.Array.splice(list, idx));\t\r\n\t\t}\t\r\n\t});\r\n};\r\nIX.IListManager = function() {\r\n\tvar _super = new IX.IManager();\r\n\tvar _list = new IX.IList();\r\n\t\r\n\tvar registerFn = function(key, obj) {\t\t\r\n\t\t_super.register(key, obj);\r\n\t\tvar idx = _list.indexOf(key);\r\n\t\tif (obj) {\r\n\t\t\tif (idx == -1)\r\n\t\t\t\t_list.append(key);\r\n\t\t} else \r\n\t\t\t_list.remove(idx);\r\n\t};\r\n\tvar listFn = function(keys) {\r\n\t\treturn IX.map(keys, function(item) {return _super.get(item);});\r\n\t};\r\n\treturn IX.inherit(_super, {\r\n\t\t// register should not change the sequence of key.\r\n\t\tregister : registerFn,\r\n\t\tunregister : function(key){registerFn(key);},\r\n\t\tisEmpty :function(){return _list.isEmpty();},\r\n\t\tgetSize : function(){return _list.getSize();},\r\n\t\thasKey : _super.isRegistered,\r\n\t\tisLastKey : function(key){return _list.isLast(key);},\r\n\t\tgetKeys : function() {return _list.getList();},\r\n\t\tgetByKeys : function(keys){return listFn(keys);},\r\n\t\tgetAll : function() {return listFn(_list.getList());},\r\n\t\titerate: function(fn){IX.iterate(_list.getList(), function(item){fn(_super.get(item));}); },\r\n\t\tgetFirst : function() {\r\n\t\t\tvar arr = _list.getList();\r\n\t\t\tif (!arr || arr.length == 0)\r\n\t\t\t\treturn null;\r\n\t\t\tvar len = arr.length;\r\n\t\t\tfor (var i = 0; i < len; i++) {\r\n\t\t\t\tvar inst = _super.get(arr[i]);\r\n\t\t\t\tif (inst) \r\n\t\t\t\t\treturn inst;\r\n\t\t\t}\r\n\t\t\treturn null;\r\n\t\t},\r\n\t\t// only for key. append will remove existed record in keyList and append it to the end\r\n\t\tappend : _list.append,\r\n\t\tinsertBefore : _list.insertBefore,\r\n\t\tremove : function(key) {registerFn(key);},\r\n\t\t\r\n\t\tclear : function(){\r\n\t\t\t_super.clear();\r\n\t\t\t_list.clear();\r\n\t\t},\r\n\t\t\t\t\r\n\t\tdestroy : function() {\r\n\t\t\t_super.destroy();\r\n\t\t\tdelete _super;\r\n\t\t\t_list.destroy();\r\n\t\t\tdelete _list;\r\n\t\t}\r\n\t});\r\n};\r\n\r\n/**\r\n * data : {\r\n * \t\ttype : \"array\"/\"json\", [option; default :\"json\"]\r\n * \t\t// for array:\r\n * \t\tfields :[\"name1\", \"name2\", ...],\r\n * \t\titems:[ [value1, value2, ...], ...]\r\n * \t\t// for json:\r\n * \t\titems : [{name1: value1, name2: value2},...]\r\n *  }\r\n *  return: [{name1: value1, name2: value2},...]\r\n */\r\nIX.DataStore = function(data){\r\n\tvar _items = $XP(data, \"items\", []);\r\n\tif (_items.length>0 && $XP(data, \"type\", \"json\")!=\"json\"){\r\n\t\tvar _fields = $XP(data, \"fields\", []);\r\n\t\t_items =  IX.map(_items, function(row){\r\n\t\t\treturn IX.loop(_fields, {}, function(acc, col, idx){\r\n\t\t\t\tacc[col] = IX.isArray(row)?row[idx]:row[col];\r\n\t\t\t\treturn acc;\r\n\t\t\t});\r\n\t\t});\r\n\t}\r\n\t\r\n\treturn IX.map(_items, function(item){\r\n\t\tvar id = $XP(item, \"id\");\r\n\t\tif (IX.isEmpty(id))\r\n\t\t\titem.id = IX.id();\r\n\t\treturn item;\r\n\t});\r\n};\r\n\r\nIX.Date = (function(){\r\n\tvar _isUTC = false;\r\n\tvar fields4Day = [\"FullYear\", \"Month\", \"Date\"], fields4Time = [\"Hours\", \"Minutes\", \"Seconds\"];\r\n\tvar ds = \"-\", ts = \":\";\r\n\t\r\n\tvar _formatStr = function(str, sp) {\r\n\t\tif (IX.isEmpty(str))\r\n\t\t\treturn \"\";\r\n\t\tstr = str.split(sp, 3);\r\n\t\treturn IX.map(sp==ds?[4,2,2]:[2,2,2], function(item, idx){\r\n\t\t\tvar nstr = (str.length>idx?str[idx]:\"\");\r\n\t\t\treturn (\"0\".multi(item) + nstr).substr(nstr.length, item);\r\n\t\t}).join(sp);\r\n\t}; \r\n\t\r\n\tvar _format = function(date, fields, sp){\r\n\t\tvar getPrefix = \"get\" + (_isUTC?\"UTC\":\"\");\r\n\t\tvar str = IX.map(fields, function(item){\r\n\t\t\treturn date[getPrefix + item]()*1 + (item==\"Month\"?1:0);\r\n\t\t}).join(sp);\r\n\t\treturn _formatStr(str, sp);\r\n\t};\r\n\t\r\n\tvar format = function(date, type) {\r\n\t\tif (type==\"Date\")\r\n\t\t\treturn _format(date, fields4Day, ds);\r\n\t\tif (type==\"Time\")\r\n\t\t\treturn _format(date, fields4Time, ts);\r\n\t\treturn _format(date, fields4Day, ds) + \" \" + _format(date,fields4Time, ts);\r\n\t};\r\n\r\n\tvar checkData =function(acc, item, idx){\r\n\t\treturn acc || isNaN(item) || item.indexOf(\".\")>=0 || (idx==0 && item.length!=4) || (idx>0 && item.length>2);\r\n\t};\r\n\tvar checkTime =function(acc, item, idx){\r\n\t\treturn acc || isNaN(item) || item.indexOf(\".\")>=0 || item.length>2;\r\n\t};\r\n\tvar isValid = function(str, type){\r\n\t\tvar isDate = type == \"Date\";\r\n\t\tvar sps  = str.split(isDate?ds :ts, 3);\r\n\t\tif (sps.length!=3 || IX.loop(sps, false, isDate?checkData:checkTime))\r\n\t\t\treturn false;\r\n\t\tif (isDate){\r\n\t\t\tvar m = sps[1]*1;\r\n\t\t\tvar d = sps[2]*1;\r\n\t\t\treturn !(m<=0 || m>12 || d<=0 || d>31);\r\n\t\t}\r\n\t\tvar h = sps[0]*1;\r\n\t\tvar m = sps[1]*1;\r\n\t\tvar s = sps[2]*1;\r\n\t\treturn  !(h<0||h>23 || m<0||m>59 || s<0|| s>59);\r\n\t};\r\n\t\r\n\treturn {\r\n\t\tsetDS : function(v){ds = v;},\r\n\t\tsetTS : function(v){ts = v;},\r\n\t\tsetUTC : function(isUTC){\r\n\t\t\t_isUTC= isUTC;\r\n\t\t}, \r\n\t\tgetDS : function(){return ds;},\r\n\t\tgetTS : function(){return ts;},\r\n\t\tisUTC :function(){\r\n\t\t\treturn _isUTC;\r\n\t\t},\r\n\t\t// return YYYY/MM/DD hh:mm:ss \r\n\t\tformat:format,\r\n\t\t// return YYYY/MM/DD\r\n\t\tformatDate:function(date) {\r\n\t\t\treturn format(date, \"Date\");\r\n\t\t},\r\n\t\t// return hh:mm:ss\r\n\t\tformatTime:function(date) {\r\n\t\t\treturn format(date, \"Time\");\r\n\t\t},\r\n\t\t\r\n\t\t// return YYYY/MM/DD hh:mm:ss \r\n\t\tformatStr:function(str) {\r\n\t\t\tstr = (str + \" \").split(\" \");\r\n\t\t\treturn _formatStr(str[0], ds) + \" \" + _formatStr(str[1], ts);\r\n\t\t},\r\n\t\t// return YYYY/MM/DD\r\n\t\tformatDateStr:function(str){\r\n\t\t\treturn _formatStr(str, ds);\r\n\t\t},\r\n\t\t// return hh:mm:ss\r\n\t\tformatTimeStr:function(str){\r\n\t\t\treturn _formatStr(str, ts);\r\n\t\t},\r\n\t\t\r\n\t\tgetDateText : function(olderTSInSec, tsInSec) {\r\n\t\t\tvar interval = tsInSec -olderTSInSec ;\r\n\t\t\tif (interval<10)\r\n\t\t\t\treturn \"刚才\";\r\n\t\t\tif (interval<60)\r\n\t\t\t\treturn Math.round(interval) + \"秒钟前\";\r\n\t\t\tinterval /= 60;\t\r\n\t\t\tif (interval<60)\r\n\t\t\t\treturn Math.round(interval) + \"分钟前\";\r\n\t\t\tinterval /= 60;\r\n\t\t\tif (interval<24)\r\n\t\t\t\treturn Math.round(interval) + \"小时前\";\r\n\t\t\tinterval /= 24;\t\r\n\t\t\tif (interval<7)\r\n\t\t\t\treturn Math.round(interval) + \"天前\";\t\t\t\r\n\t\t\tinterval /= 7;\t\r\n\t\t\tif (interval<4.33)\r\n\t\t\t\treturn Math.round(interval) + \"周前\";\r\n\t\t\tinterval /= 4.33;\r\n\t\t\tif (interval<12)\r\n\t\t\t\treturn Math.round(interval) + \"个月前\";\r\n\t\t\treturn Math.round(interval/12) + \"年前\";\t\t\r\n\t\t},\r\n\t\t\r\n\t\t// accept YYYY/MM/DD hh:mm:ss return true/false;\r\n\t\tisValid : function(dateStr, type) {\r\n\t\t\tvar dt = dateStr.split(\" \");\r\n\t\t\tif (type==\"Date\" ||type==\"Time\")\r\n\t\t\t\treturn dt.length==1 && isValid(dt[0], type);\r\n\t\t\t\r\n\t\t\treturn dt.length==2 && isValid(dt[0], \"Date\") && isValid(dt[1], \"Time\");\r\n\t\t},\r\n\t\t/*\r\n\t\t\tpara: \r\n\t\t\t\t_date: date string, e.g. 2010-01-01 9:20:30 or 2010/01/01 9:20:30\r\n\t\t\t\t_format: format string, e.g. \"yyyy-MM-dd HH:mm:ss\"\r\n\t\t\treturn \r\n\t\t\t\tstring\r\n\t\t*/\r\n\t\tgetDateByFormat: function (_dateStr, _formatType) {\r\n            try {\r\n            \tif(_dateStr == null || _dateStr === \"\") return \"\";\r\n                var _dateObj = typeof _dateStr == \"number\" ? new Date(_dateStr) : typeof _dateStr == \"string\" ? new Date((_dateStr+\"\").replace(/-/g, \"/\")) : _dateStr, dateFormat = _formatType || \"yyyy-MM-dd HH:mm:ss\";\r\n\r\n                dateFormat = dateFormat.replace(\"yyyy\", _dateObj.getFullYear());\r\n                var _month = _dateObj.getMonth() + 1,\r\n\t\t\t\t\t_day = _dateObj.getDate(),\r\n\t\t\t\t\t_hour = _dateObj.getHours(),\r\n\t\t\t\t\t_minute = _dateObj.getMinutes(),\r\n\t\t\t\t\t_second = _dateObj.getSeconds();\r\n                dateFormat = dateFormat.replace(\"MM\", _month > 9 ? _month : (\"0\" + _month));\r\n                dateFormat = dateFormat.replace(\"dd\", _day > 9 ? _day : (\"0\" + _day));\r\n                dateFormat = dateFormat.replace(\"HH\", _hour > 9 ? _hour : (\"0\" + _hour));\r\n                dateFormat = dateFormat.replace(\"mm\", _minute > 9 ? _minute : (\"0\" + _minute));\r\n                dateFormat = dateFormat.replace(\"ss\", _second > 9 ? _second : (\"0\" + _second));\r\n\r\n                return dateFormat;\r\n            } catch (ex) {\r\n                return _dateStr;\r\n            }\r\n        },\r\n        getTimeTickInSec : function (_dateStr) {\r\n        \tvar _str = IX.Date.getDateByFormat(_dateStr, 'yyyy/MM/dd HH:mm:ss');\r\n        \treturn parseInt((new Date(_str)).getTime() / 1000);\r\n        }\r\n\t};\r\n})();\r\n/**\r\n *\tIX.Net is a library for networking. It includes: {\r\n *\t\tloadFile(url, responseHandler): active AJAX requirement and let responseHandler deal with response(Text).\r\n *\t\tloadCss(cssUrl): load CSS and  apply to current document.\r\n *\t\tloadJsFiles(jsFileUrlArray, postHandler): load all js files in array, and execute postHandler after all jsFiles are loaded.\r\n *\t\ttryFn(fnName, argsArray,  dependency): try to execute function fnName with parameters argsArray.\r\n *\t\t\t\tIf the function is not existed, resolve the dependency and try it again.\r\n *\t\t\t\tdependency:{\r\n *\t\t\t\t\tbeforeFn: function before applying dependency.\r\n *\t\t\t\t\tcssFiles: all required CSS files for current function call.\r\n *\t\t\t\t\tjsFiles: all required JS files for current function call.\r\n *\t\t\t\t\tafterFn: function after executing current function call.\r\n *\t\t\t\t\tdelay: the milliseconds for waiting after js files are loaded.\r\n *\t\t\t\t}\r\n *\t}\r\n */\r\nIX.Net = (function(){\r\n\tvar head= document.getElementsByTagName('head')[0];\r\n\tvar getRequestFn = function(){\r\n\t\tif (\"XMLHttpRequest\" in window) {\r\n\t\t\treturn new XMLHttpRequest();\r\n\t\t}\r\n\t\tif (\"ActiveXObject\" in window){\r\n\t\t\treturn new ActiveXObject(\"Microsoft.XMLHTTP\");\r\n\t\t}\r\n\t\treturn null;\r\n\t};\r\n\tvar loadFn = function(durl, cbFun){\r\n\t\tvar request = getRequestFn();\r\n\t\tif(!request){\r\n\t\t\t$XE(\"unsupport AJAX. Failed\");return;\r\n\t\t}\r\n\t\trequest.onreadystatechange  = function(){\r\n\t\t\tif (request.readyState == 4){\r\n\t\t\t\tif (request.status == 200){\r\n\t\t\t\t\tif (IX.isFn(cbFun)){cbFun(request.responseText);}\r\n\t\t\t\t} else { \r\n\t\t\t\t\t$XE(\"There was an error: (\" + request.status + \") \" + request.statusText);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t};\r\n\t\trequest.open(\"GET\", durl, true);\r\n\t\trequest.send(\"\");\r\n\t};\r\n\tvar loadJsFn = function(durl, nextFn){\r\n\t\tvar script= document.createElement('script');\r\n\t\tscript.type= 'text/javascript';\r\n\t\tscript.src= durl;\r\n\t\tif (IX.isFn(nextFn)){\r\n\t\t\tif (script.readyState){ // IE\r\n\t\t\t\tscript.onreadystatechange= function () {\r\n\t\t\t\t\tlog(\"STATE: [\" +durl +\"]:\" +  this.readyState);\r\n\t\t\t\t\tif (script.readyState == 'complete' || script.readyState=='loaded') {\r\n\t\t\t\t\t\tscript.onreadystatechange = null;\r\n\t\t\t\t\t\tnextFn();\r\n\t\t\t\t\t}\r\n\t\t\t\t};\r\n\t\t\t} else {\r\n\t\t\t\tscript.onload= nextFn;\r\n\t\t\t}\r\n\t\t}\r\n\t\thead.appendChild(script);\r\n\t};\r\n\tvar loadJsFilesInSeqFn = function(jsFiles, nextFn){\r\n\t\tvar _nextFn = IX.isFn(nextFn)?nextFn:IX.emptyFn;\r\n\t\tif (!jsFiles || jsFiles.length==0)\r\n\t\t\treturn _nextFn();\r\n\t\tvar n = jsFiles.length;\r\n\t\tvar idx =0;\r\n\t\tvar fn = function(){\r\n\t\t\tloadJsFn(jsFiles[idx], function(){\r\n\t\t\t\tidx +=1;\r\n\t\t\t\treturn (idx<n)?fn():_nextFn();\r\n\t\t\t});\r\n\t\t};\r\n\t\tfn();\r\n\t};\r\n\tvar loadCssFn = function(cssFile){\r\n\t\tvar cssNode = document.createElement('link');\r\n\t\tcssNode.type = 'text/css';\r\n\t\tcssNode.rel = 'stylesheet';\r\n\t\tcssNode.href = cssFile;\r\n\t\tcssNode.media = 'screen';\r\n\t\thead.appendChild(cssNode);\r\n\t};\r\n\treturn {\r\n\t\tloadFile:loadFn,\r\n\t\tloadCss:loadCssFn,\r\n\t\tloadJsFiles:function(jsFiles, nextFun, mode){\r\n\t\t\t//if (!mode || mode==\"seq\" ){\r\n\t\t\t\tloadJsFilesInSeqFn(jsFiles, nextFun);\r\n\t\t\t//}\r\n\t\t},\r\n\t\ttryFn:function(fnName, argList,dependencyConfig){\r\n\t\t\tvar fn = function(){\t\t\t\t\r\n\t\t\t\tIX.execute(fnName, argList);\r\n\t\t\t\tIX.tryFn(dependencyConfig.afterFn);\r\n\t\t\t};\r\n\t\t\tif (!IX.nsExisted(fnName)){\r\n\t\t\t\tif (!dependencyConfig){\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\tvar config = dependencyConfig;\r\n\t\t\t\tIX.tryFn(config.beforeFn);\r\n\t\t\t\tIX.iterate(config.cssFiles, loadCssFn);\r\n\t\t\t\tvar delay = config.delay || 100;\r\n\t\t\t\tloadJsFilesInSeqFn(config.jsFiles, function(){\r\n\t\t\t\t\tsetTimeout(fn,delay);\r\n\t\t\t\t});\r\n\t\t\t} else\r\n\t\t\t\tfn();\r\n\t\t}\r\n\t};\r\n})();\r\n\r\nIX.win = (function(){\r\n\tvar fnHT = {}, eventFnHT = {}, handlersHT = IX.I1ToNManager();\r\n\tvar keySn = 0;\r\n\tvar genKey = function(){return \"f_\" + (keySn++);};\r\n\t\r\n\tvar hasEventListener = (\"addEventListener\" in window) ;\r\n\tvar attachEvent = hasEventListener?function(target, eName, fn){\r\n\t\ttarget.addEventListener(eName, fn, false);\r\n\t}:function(target, eName, fn){\r\n\t\ttarget.attachEvent(\"on\" + eName, fn);\r\n\t};\r\n\tvar detachEvent = hasEventListener?function(target, eName, fn){\r\n\t\ttarget.removeEventListener(eName, fn, false);\r\n\t}:function(target, eName, fn){\r\n\t\ttarget.detachEvent(\"on\" + eName, fn);\r\n\t};\r\n\t\r\n\tvar executeEvent = function(eName, e){\r\n\t\tIX.iterate(handlersHT.get(eName), function(fKey){\r\n\t\t\t//try{\r\n\t\t\tif (IX.isFn(fnHT[fKey]))\r\n\t\t\t\tfnHT[fKey](e);\r\n\t\t\t//}catch(ex){\r\n\t\t\t//\tconsole.log(ex);\r\n\t\t\t//}\r\n\t\t});\r\n\t};\r\n\t\r\n\tvar _register = function(eName, fn){\r\n\t\tvar _key = genKey();\r\n\r\n\t \tif(!fn._key){\r\n\t \t\tfn._key = _key;\r\n\t\t\tfnHT[_key] = fn;\r\n\t\t\thandlersHT.put(eName, _key);\t\t\r\n\t\t}\r\n\r\n\t\tif (eName in eventFnHT)\r\n\t\t\treturn _key;\r\n\t\teventFnHT[eName] = function(evt){\r\n\t\t\tvar e = evt || window.event;\r\n\t\t\tif (!(\"target\" in e))\r\n\t\t\t\te.target = e.srcElement; // for IE hack\r\n\t\t\treturn executeEvent(eName, e);\r\n\t\t};\r\n\t\tattachEvent(window, eName, eventFnHT[eName]);\r\n\t\treturn _key;\r\n\t};\r\n\tvar _unregister = function(eName, fnKey){\r\n\t\tfnHT[fnKey] = null;\r\n\t\thandlersHT.remove(eName, fnKey);\r\n\t\tif (handlersHT.hasValue(eName))\r\n\t\t\treturn;\r\n\t\tdetachEvent(window, eName, eventFnHT[eName]);\r\n\t\teventFnHT[eName] = null;\r\n\t};\r\n\t\r\n\tvar _bindHandlers = function(handlers, isBind){\r\n\t\tvar bindFn = isBind?_register: _unregister;\r\n\t\tvar ids = IX.loop([\"click\", \"resize\", \"scroll\" ,\"mousedown\", \"mouseover\", \"mouseout\"], {}, function(acc, eventName){\r\n\t\t\tif (eventName in handlers)\r\n\t\t\t\tacc[eventName] = bindFn(eventName, handlers[eventName]);\r\n\t\t\treturn acc;\r\n\t\t});\r\n\t\tif (isBind)\r\n\t\t\treturn ids;\r\n\t};\r\n\treturn {\r\n\t\t/**\r\n\t\t * handlers :{\r\n\t\t * \t\tclick : fun\r\n\t\t * \t\tresize : fun\r\n\t\t * }\r\n\t\t * return {\r\n\t\t * \t\tclick : handlerId1,\r\n\t\t * \t\tresize : handlerId2\r\n\t\t * }\r\n\t\t */\r\n\t\tbind : function(handlers){return _bindHandlers(handlers, true);},\r\n\t\t/**\r\n\t\t * handlerIds {\r\n\t\t * \t\tclick : handlerId1,\r\n\t\t * \t\tresize : handlerId2\r\n\t\t * }\r\n\t\t */\r\n\t\tunbind : function(handlerIds){_bindHandlers(handlerIds, false);},\r\n\t\tscrollTo : function(x,y){\r\n\t\t\twindow.scrollTo(x, y);\r\n\t\t\texecuteEvent(\"scroll\", null);\r\n\t\t}\r\n\t};\r\n})();\r\n\r\n$Xw = IX.win;\r\n\r\n(function() {\t\r\nfunction defaultParamFn(_name, _params){return _params;}\r\nfunction defaulRspFn(data, cbFn){IX.isFn(cbFn) && cbFn(data);}\r\nfunction getFunProp(_cfg, _name, defFn){\r\n\tvar _fn = $XP(_cfg, _name);\r\n\treturn IX.isFn(_fn)?_fn :defFn;\r\n}\r\n\r\nfunction ajaxRouteFn(callerRouteDef){\r\n\treturn {\r\n\t\tchannel : $XP(callerRouteDef, \"channel\", callerRouteDef.name),\r\n\t\ttype : $XP(callerRouteDef, \"type\", \"POST\"),\r\n\t\tdataType : $XP(callerRouteDef, \"dataType\", \"form\"),\r\n\t\tonsuccess : getFunProp(callerRouteDef, \"onsuccess\", defaulRspFn),\r\n\t\tpreAjax : getFunProp(callerRouteDef, \"preAjax\", defaultParamFn),\r\n\t\tpostAjax : $XF(callerRouteDef, \"postAjax\"),\r\n\t\tonfail : getFunProp(callerRouteDef, \"onfail\", defaulRspFn)\r\n\t};\r\n}\r\nfunction urlRouteFn(routeDef, ifAjax){\r\n\tvar _url = $XP(routeDef, \"url\");\r\n\tif (IX.isEmpty(_url))\r\n\t\treturn null;\r\n\tvar route = ifAjax ? ajaxRouteFn(routeDef) : {};\r\n\troute.url = _url;\r\n\troute.urlType = $XP(routeDef, \"urlType\", \"base\") + \"Url\";\t\r\n\treturn route;\t\r\n}\r\nfunction createRouteHT(routes, ifAjax){\r\n\treturn IX.loop(routes, {}, function(acc, routeDef){\r\n\t\tvar _name = $XP(routeDef, \"name\");\r\n\t\tif (IX.isEmpty(_name))\r\n\t\t\treturn acc;\r\n\t\tvar route = urlRouteFn(routeDef, ifAjax);\r\n\t\tif (route)\r\n\t\t\tacc [_name] = route;\r\n\t\treturn acc;\r\n\t});\r\n}\r\n\r\nfunction UrlRouter(routes, urlFac){\r\n\tvar _routeHT = createRouteHT(routes);\r\n\tvar r = function(_name, params){\r\n\t\treturn urlFac.genUrl(_routeHT[_name], params);\r\n\t};\r\n\treturn r;\r\n}\r\n\r\nfunction tryLockChannel(channel){\r\n\tvar id = \"ajaxChannel_\" + channel;\r\n\tif ($X(id))\r\n\t\treturn false;\r\n\tIX.createDiv(id, \"ajax-channel\");\r\n\t//console.log (\"lock channel: \" + channel);\r\n\treturn true;\r\n}\r\nfunction unlockChannel(channel){\r\n\tvar el = $X(\"ajaxChannel_\" + channel);\r\n\tif (el)\r\n\t\tel.parentNode.removeChild(el);\r\n\t//console.log (\"unlock channel: \" + channel);\r\n}\r\nfunction AjaxCaller(routes, _ajaxFn, urlFac){\r\n\tvar _callerHT = createRouteHT(routes, true);\r\n\tvar c = function(_name, params, cbFn, failFn){\r\n\t\tvar _caller = _callerHT[_name];\r\n\t\tif (!_caller)\r\n\t\t\treturn;\r\n\r\n\t\tvar channel = params && params._channel_ ? params._channel_ : _caller.channel;\r\n\t\tif (!$XP(params, '_t')) {\r\n\t\t\tparams = IX.inherit(params, {_t : ''});\r\n\t\t}\r\n\r\n\t\tif (!tryLockChannel(channel)){\r\n\t\t\t_caller.onfail({\r\n\t\t\t\tcode : 0,\r\n\t\t\t\terr : \"channel in using:\"+ channel\r\n\t\t\t}, failFn, params);\t\t\t\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar _cbFn = IX.isFn(cbFn) ? cbFn : IX.emptyFn;\r\n\t\tvar _contentType =  _caller.dataType == 'json' ? 'application/json; charset=UTF-8' : 'application/x-www-form-urlencoded; charset=UTF-8';\r\n\t\tvar _data = _caller.preAjax(_name, params);\r\n\t\t_data = _caller.dataType == 'json' ? JSON.stringify(_data) : _data;\r\n\t\t_ajaxFn({\r\n\t\t\turl : urlFac.genUrl(_caller, params),\r\n\t\t\ttype :  _caller.type,\r\n\t\t\tcontentType : _contentType,\r\n\t\t\tdata : _data,\r\n\t\t\tsuccess : function(data) {\r\n\t\t\t\tunlockChannel(channel);\r\n\t\t\t\t_caller.onsuccess(data, _cbFn, params);\r\n\t\t\t},\r\n\t\t\tfail: function(data){\r\n\t\t\t\tunlockChannel(channel);\r\n\t\t\t\t_caller.onfail(data, failFn, params);\r\n\t\t\t},\r\n\t\t\terror: function(data){\r\n\t\t\t\tunlockChannel(channel);\r\n\t\t\t\t_caller.onfail(data, failFn, params);\r\n\t\t\t}\r\n\t\t});\r\n\t\t_caller.postAjax(_name, params, _cbFn);\r\n\t};\r\n\treturn c;\r\n}\r\n\r\nfunction UrlFactory(){\r\n\tvar _urls = {};\r\n\tvar genUrl = function(_route, params){\r\n\t\tif (!_route)\r\n\t\t\treturn \"\";\r\n\t\tvar url = _route.url;\r\n\t\tvar _url = IX.isFn(url)?url(params):url.replaceByParams(params);\r\n\t\tvar _urlBase = (_route.urlType in _urls)?_urls[_route.urlType] : _urls.baseUrl;\r\n\t\treturn _urlBase + _url;\r\n\t};\r\n\treturn {\r\n\t\tinit : function(cfg){_urls = IX.inherit(_urls, cfg);},\r\n\t\tgenUrl : genUrl\r\n\t};\r\n}\r\n\r\nfunction UrlEngine(ifAjax){  \r\n\tvar _ajaxFn = null, _urlFac = new UrlFactory();\r\n\t\r\n\tvar init = function(cfg){\r\n\t\tif (ifAjax && IX.isFn(cfg.ajaxFn))\r\n\t\t\t_ajaxFn = cfg.ajaxFn;\r\n\t\t_urlFac.init(cfg);\t\t\r\n\t};\r\n\treturn IX.inherit({\r\n\t\t/** cfg : {\r\n\t\t * \t\tajaxFn :function(ajaxParams)\r\n\t\t * \t\tbaseUrl : \"https://...\",\r\n\t\t * \t\t[name]Url : \"https: //....\"\r\n\t\t * }\r\n\t\t */\r\n\t\tinit : init, // function(cfg)\r\n\t\treset : init,\t\r\n\t\t/** routes : [{ \r\n\t\t * \t\tname : \"page.entry\",\r\n\t\t * \t\turl : \"/session\" / function(params){return \"/abc\";},\r\n\t\t * \t\turlType : \"urlName\", //default \"base\"\r\n\t\t * \t}]\t\r\n\t\t *  return : function(name, params){}\r\n\t\t */\r\n\t\tcreateRouter : function(routes){\r\n\t\t\treturn new UrlRouter(routes, _urlFac);\r\n\t\t}\t\r\n\t}, ifAjax?{\r\n\t\t/** routes : [{ \r\n\t\t * \t\tname : \"signIn\",\r\n\t\t * \t\turl : \"/session\" / function(params){return \"/abc\";},\r\n\t\t * \t\turlType : \"urlName\", //default \"base\"\r\n\t\t * \r\n\t\t * \t\tchannel : \"named-channel\", //default common\r\n\t\t * \t\ttype : \"POST\"/\"GET\"/\"DELETE\" , //default \"POST\"\r\n\t\t * \t\tpreAjax : function(name, params){return params;}, // default null;\r\n\t\t * \t\tpostAjax : function(name, params, cbFn){}, //default null;\r\n\t\t * \t\tonsuccess : function(data,cbFn, params), \r\n\t\t * \t\tonfail : function(data, failFn, params) // default null;\r\n\t\t * \t}]\t\r\n\t\t * return : function(name, params, cbFn, failFn){}\r\n\t\t */\r\n\t\tcreateCaller: function(routes){\r\n\t\t\treturn new AjaxCaller(routes, function(ajaxParam){\r\n\t\t\t\tif (IX.isFn(_ajaxFn)) _ajaxFn(ajaxParam);\r\n\t\t\t}, _urlFac);\r\n\t\t}\r\n\t} : {});\r\n}\r\n \r\nIX.urlEngine = new UrlEngine();\r\nIX.ajaxEngine = new UrlEngine(true);\r\n})();\r\n/**\r\n * \tIX.Xml is a library to deal with XML string or document. It includes: {\r\n * \t\tparser(xmlString): it convert xmlString to XML document object and return.\r\n * \t\tgetXmlString(xmlDocument) : it convert XML document to string and return.\r\n *  \tduplicate(xmlDocument) : it duplicate xml document object and return.\r\n * \t}\r\n */\r\nIX.Xml = (function(){return {\r\n\tparser:function(str){\r\n\t\tstr = IX.isString(str)?str:\"\";\r\n\t\tvar doc = null;\r\n\t\tif (\"DOMParser\" in window) {\r\n\t\t\tdoc = (new DOMParser()).parseFromString(str, \"text/xml\");\r\n\t\t}else if (\"ActiveXObject\" in window){\r\n\t\t\tdoc=new ActiveXObject(\"Microsoft.XMLDOM\");\r\n\t\t\tdoc.async=\"false\";\r\n\t\t\tdoc.loadXML(str);\r\n\t\t} else {\r\n\t\t\t$XE(\"this browser can't support XML parser.\");\r\n\t\t}\r\n\t\treturn doc;\r\n\t},\r\n\tgetXmlString:function(xmlDoc){\r\n\t\tif(!xmlDoc==null){\r\n\t\t\treturn \"\";\r\n\t\t}\r\n\t\tif(IX.nsExisted(\"document.implementation.createDocument\")) {\r\n\t\t\treturn (new XMLSerializer()).serializeToString(xmlDoc);\r\n\t\t}else if (\"ActiveXObject\" in window){\r\n\t\t\treturn xmlDoc.xml;\r\n\t\t} else {\r\n\t\t\t$XE(\"this browser can't support XML parser.\");\r\n\t\t}\r\n\t\treturn \"\";\r\n\t},\r\n\tduplicate:function(xmlDoc){\r\n\t\treturn this.parser(this.getXmlString(xmlDoc));\r\n\t}\r\n};})();\r\n\r\n/**\r\n * \tIX.Dom is a library to deal with DOM. It includes :{\r\n * \t\tfirst(node, tagN): try to get the first child of DOM element node which tag name is tagN.\r\n * \t\tnext(node, tagN): try to get the first next sibling of DOM element node which tag name is tagN.\r\n * \t\tcdata(node, tagN): try to get the text of DOM element node which is involved by CDATA tag.\r\n * \t\ttext (node, tagN): try to get the text of DOM element node.\r\n * \t\tattr (node, attN): try to get the value of attribute of DOM element node which name is attrN.\r\n * \t\t\r\n * \t\tinTag(tagN, content, attrs): \r\n * \t\tinPureTag(tagN, content, attrs): \r\n * }\r\n */\r\nIX.Dom = (function(){\r\n\tvar loopFn = function(node, type, checkFn, valueFn) {\r\n\t\tif (!node) return valueFn(null);\r\n\t\tvar cnode = (\"firstChild\" in node)?node[type==\"first\"?\"firstChild\":\"nextSibling\"]:null;\r\n\t\twhile(cnode!=null && !checkFn(cnode))\r\n\t\t\tcnode = cnode.nextSibling;\r\n\t\treturn valueFn(cnode);\r\n\t};\r\n\t\r\n\tvar getFn = function(node, tagN, type){\r\n\t\treturn IX.isString(tagN)?loopFn(node, type, function(cnode){\r\n\t\t\t\t\treturn cnode.nodeName.toLowerCase()==tagN;\r\n\t\t\t\t},function(cnode){\r\n\t\t\t\t\treturn cnode;\r\n\t\t\t\t}\r\n\t\t\t):null;\r\n\t};\r\n\tvar textFn = IX.isMSIE?function(node){return node? node.innerText:\"\";}:function(node){return node?node.textContent:\"\";};\r\n\t\r\n\tvar cdataFn = function(node){\r\n\t\tif (!node)\r\n\t\t\treturn \"\";\r\n\t\treturn loopFn(node,\"first\",function(cnode){\r\n\t\t\t\treturn cnode.nodeType==4;\r\n\t\t\t},function(cnode){\r\n\t\t\t\treturn cnode?cnode.nodeValue:\"\";\r\n\t\t\t}\r\n\t\t);\r\n\t};\r\n\tvar firstFn = function(node,tagN) {\r\n\t\treturn getFn(node,tagN, \"first\");\r\n\t};\r\n\t\t\r\n\tvar inTagFn = function(tag, content, attrs){//attrs should like [[pramName, paramValue],...\r\n\t\tvar _attrs = IX.loop(attrs, [],  function(acc, item){\r\n\t\t\treturn acc.concat(' ', item[0], '=\"', item[1], '\"');\r\n\t\t});\r\n\t\tvar arr = [].concat(\"<\", tag, _attrs, \">\", content, \"</\", tag, \">\");\r\n\t\treturn arr.join(\"\");\r\n\t};\r\n\tvar inPureTagFn = function(tag, content, attrs){\r\n\t\treturn inTagFn(tag, [\"<![CDATA[\", content, \"]]>\"].join(\"\"),  attrs);\r\n\t};\r\n\tvar attrFn = function(node, attN){\r\n\t\tif(!node)\r\n\t\t\treturn \"\";\r\n\t\tvar val = node.getAttribute(attN);\r\n\t\treturn IX.isEmpty(val)?\"\":val;\r\n\t};\r\n\tvar setAttrFn = function(node, attN, val){\r\n\t\tif(!node)\r\n\t\t\treturn;\r\n\t\tif (val)\r\n\t\t\tnode.setAttribute(attN, val);\r\n\t\telse\r\n\t\t\tnode.removeAttribute(attN);\t\t\t\r\n\t};\r\n\treturn {\r\n\t\tfirst:firstFn,\r\n\t\tnext:function(node, tagN){\r\n\t\t\treturn getFn(node, tagN,\"next\");\r\n\t\t},\r\n\t\tcdata:function(node, tagN){\r\n\t\t\treturn cdataFn(firstFn(node, tagN));\r\n\t\t},\r\n\t\ttext:function(node, tagN){\r\n\t\t\treturn textFn(firstFn(node, tagN));\r\n\t\t},\r\n\t\tattr:attrFn,\r\n\t\tsetAttr:setAttrFn,\r\n\t\tdataAttr :function(node, name){\r\n\t\t\treturn attrFn(node, \"data-\" + name);\r\n\t\t},\r\n\t\tsetDataAttr : function(node, name, val){\r\n\t\t\tsetAttrFn(node, \"data-\" + name, val);\r\n\t\t},\r\n\t\tremove: function(node){\r\n\t\t\tif(node)\r\n\t\t\t\tif(node.parentNode)\r\n\t\t\t\t\tnode.parentNode.removeChild(node);\r\n\t\t},\r\n\t\tisAncestor : function(node, ancestor){\r\n\t\t\tvar el = node;\r\n\t\t\twhile(el){\t\t\t\t\r\n\t\t\t\tif (el== ancestor)\r\n\t\t\t\t\treturn true;\r\n\t\t\t\tvar nodeName = el.nodeName.toLowerCase();\r\n\t\t\t\tel = (nodeName==\"body\")? null: el.parentNode;\r\n\t\t\t}\r\n\t\t\treturn false;\r\n\t\t},\r\n\t\tancestor : function(node, tagName){\r\n\t\t\tif (!node)\r\n\t\t\t\treturn null;\r\n\t\t\tvar el =  node;\r\n\t\t\twhile(el){\r\n\t\t\t\tvar nodeName = el.nodeName.toLowerCase();\r\n\t\t\t\tif (nodeName==tagName)\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tel =(nodeName==\"body\")? null: el.parentNode;\r\n\t\t\t}\r\n\t\t\treturn el;\r\n\t\t},\r\n\t\tis : function(el, tagName){\r\n\t\t\treturn el.nodeName.toLowerCase() == tagName;\r\n\t\t},\r\n\t\tinTag : inTagFn,\r\n\t\tinPureTag : inPureTagFn\r\n\t};\r\n})();\r\n$XD = IX.Dom;\r\n/*\r\n*\t\tgetStyle(node, styleName): get node's style. e.g. $XD.getStyle(node, \"border-left-width\"), $XD.getStyle(node, \"font-size\")\r\n*/\r\nIX.HtmlDocument = (function(){\r\n\tvar hasFn = function(el, clzName){\r\n\t\treturn el!=null && (\"className\" in el)&& IX.Array.isFound(clzName, (el.className+\"\").split(\" \"));\r\n\t};\r\n\tvar removeFn = function(el, clzName){\r\n\t\tif (!el) return;\r\n\t\tvar clz = IX.Array.remove(el.className.split(\" \"), clzName);\r\n\t\tel.className = clz.join(\" \");\r\n\t};\r\n\tvar addFn = function(el, clzName) {\r\n\t\tif (!el) return;\r\n\t\tvar clzs = IX.Array.toSet(el.className.split(\" \").concat(clzName));\r\n\t\tel.className = clzs.join(\" \");\r\n\t};\r\n\tvar nextFn = function(node, clzName){\r\n\t\tif (!node)\r\n\t\t\treturn null;\r\n\t\tvar el = node.nextSibling;\r\n\t\twhile(el){\r\n\t\t\tif (hasFn(el, clzName))\r\n\t\t\t\treturn el;\r\n\t\t\tel = el.nextSibling;\r\n\t\t}\r\n\t\treturn el;\r\n\t};\r\n\r\n\tvar getStyle = function(_elem,styles){\r\n        var _value=null, elem= IX.get(_elem);\r\n        styles = styles != \"float\" ? styles : document.defaultView ? \"float\" : \"styleFloat\";\r\n        if(styles == \"opacity\"){\r\n        \tif(elem.filters){//IE, two ways to get opacity because two ways to set opacity and must be set opacity before get\r\n        \t\tif(elem.filters.length > 0){\r\n\t\t            try {\r\n\t\t                _value = elem.filters['DXImageTransform.Microsoft.Alpha'].opacity / 100;\r\n\t\t            }catch(e) {\r\n\t\t                try {\r\n\t\t                    _value = elem.filters('alpha').opacity;\r\n\t\t                } catch(err){}\r\n\t\t            }\r\n\t        \t}else{\r\n\t        \t\t_value = \"1\";\r\n\t        \t}\r\n        \t}else{//w3c\r\n        \t\t_value = elem.style.opacity;\r\n        \t}\r\n        }else{\r\n\t        _value=elem.style[styles] || elem.style[styles.camelize()];\r\n\t        if(!_value){\r\n\t             if (document.defaultView && document.defaultView.getComputedStyle) {\r\n\t                var _css=document.defaultView.getComputedStyle(elem, null);\r\n\t                _value= _css ? _css.getPropertyValue(styles) : null;\r\n\t             }else if (elem.currentStyle){\r\n\t                _value = elem.currentStyle[styles.camelize()];\r\n\t             }\r\n\t        }\r\n\t        if(_value==\"auto\" && IX.Array.indexOf([\"width\",\"height\"], function(_i){return styles == _i;}) > -1 && elem.style.display!=\"none\"){\r\n\t            _value=elem[\"offset\"+styles.capitalize()]+\"px\";\r\n\t        }\r\n        }\r\n        return _value==\"auto\" ? null :_value;\r\n    };\r\n\treturn {\r\n\t\tgetStyle : getStyle,\r\n\t\thasClass : hasFn,\r\n\t\tremoveClass : removeFn,\r\n\t\taddClass : addFn,\r\n\t\ttoggleClass : function(el, clzName){\r\n\t\t\tif (!el) return;\r\n\t\t\tif (hasFn(el, clzName))\r\n\t\t\t\tremoveFn(el, clzName);\r\n\t\t\telse addFn(el, clzName);\r\n\t\t},\r\n\t\tnext :nextFn,\r\n\t\tfirst : function(parentEl, clzName){\r\n\t\t\tif (!parentEl)\r\n\t\t\t\treturn null;\r\n\t\t\tvar el = parentEl.firstChild;\r\n\t\t\treturn hasFn(el, clzName)?el: nextFn(el, clzName);\r\n\t\t},\r\n\t\tisAncestor : function(node, pnode) {\r\n\t\t\tif (!node)\r\n\t\t\t\treturn false;\r\n\t\t\tvar el =  node;\r\n\t\t\twhile(el!=null){\r\n\t\t\t\tif (el==pnode)\r\n\t\t\t\t\treturn true;\r\n\t\t\t\tel = el.parentNode;\r\n\t\t\t\tif (el && el.nodeName.toLowerCase()==\"body\")\r\n\t\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t\treturn false;\r\n\t\t},\r\n\t\tancestor : function(node, clzName){\r\n\t\t\tif (!node)\r\n\t\t\t\treturn null;\r\n\t\t\tvar el =  node;\r\n\t\t\twhile(el!=null && !hasFn(el, clzName)){\r\n\t\t\t\tel = el.parentNode;\r\n\t\t\t\tif (el && el.nodeName.toLowerCase()==\"body\")\r\n\t\t\t\t\tel = null;\r\n\t\t\t}\r\n\t\t\treturn el;\r\n\t\t},\r\n\t\t\r\n\t\tgetWindowScreen : function(){\r\n\t\t\tvar body = document.documentElement;\r\n\t\t\tvar win = window;\r\n\t\t\tvar _scrollX = \"scrollX\" in win?win.scrollX:body.scrollLeft,\r\n\t\t\t\t_scrollY = \"scrollX\" in win?win.scrollY:body.scrollTop;\r\n\t\t\t\r\n\t\t\treturn {\r\n\t\t\t\tscroll : [_scrollX, _scrollY, body.scrollWidth, body.scrollHeight],\r\n\t\t\t\tsize : [body.clientWidth, body.clientHeight]\r\n\t\t\t};\r\n\t\t},\r\n\t\tgetScroll: function(_dom){\r\n            if (_dom && _dom.nodeType != 9){//not document\r\n            \treturn {\r\n                    scrollTop: _dom.scrollTop,\r\n                    scrollLeft: _dom.scrollLeft\r\n                };\r\n            }\r\n            var _window = !_dom ? window : _dom.defaultView || _dom.parentWindow;\r\n            return { scrollTop: _window.pageYOffset\r\n\t\t\t\t    || _window.document.documentElement.scrollTop\r\n\t\t\t\t    || _window.document.body.scrollTop\r\n\t\t\t\t    || 0,\r\n                scrollLeft: _window.pageXOffset\r\n\t\t\t\t    || _window.document.documentElement.scrollLeft\r\n\t\t\t\t    || _window.document.body.scrollLeft\r\n\t\t\t\t    || 0\r\n            };\r\n\t\t},\r\n\t\tgetZIndex : function(el) {\r\n\t\t\tvar style = null, zIndex = null;\r\n\t\t\twhile(el && el.tagName.toLowerCase()!=\"body\"){\r\n\t\t\t\tstyle = IX.getComputedStyle(el);\t\t\t\t\r\n\t\t\t\tif (style.zIndex !=\"auto\")\r\n\t\t\t\t\treturn style.zIndex - 0;\r\n\t\t\t\tel = el.offsetParent;\r\n\t\t\t}\r\n\t\t\treturn 0;\r\n\t\t},\r\n\t\t/* ri : [ left, top, width, height] */\r\n\t\trect : function(el, ri){\r\n\t\t\tIX.iterate([\"left\", \"top\", \"width\", \"height\"], function(attr, idx){\r\n\t\t\t\tif (ri[idx]!=null)\r\n\t\t\t\t\tel.style[attr] = ri[idx] + \"px\";\r\n\t\t\t});\r\n\t\t},\r\n\t\tgetWindowScrollTop : function() {\r\n\t\t\treturn window.pageYOffset || document.documentElement.scrollTop || document.body.scrollTop\t|| 0;\r\n\t\t},\r\n\t\tgetPosition : function(el, isFixed){\r\n\t\t\t// getBoundingClientRect : Supported by firefox,chrome,IE8+,opera,safari\r\n\t\t\t// Return {top, left, right, bottom[, width, height]}\r\n\t\t\t// width and height are not supported in IE\r\n\t\t\t// top|left|right|bottom are offset value for visible part of window.\r\n\t\t\tvar rect = el.getBoundingClientRect(),\r\n\t\t\t\tdoc = document.documentElement || document.body;\r\n\t\t\treturn [\r\n\t\t\t\trect.left + (isFixed ? 0 : window.scrollX || doc.scrollLeft),\r\n\t\t\t\trect.top + (isFixed ? 0 : window.scrollY || doc.scrollTop),\r\n\t\t\t\tel.offsetWidth,\r\n\t\t\t\tel.offsetHeight\r\n\t\t\t];\r\n\t\t}\r\n\t};\t\r\n})();\r\n$XH = IX.HtmlDocument;\r\n\r\nIX.Cookie = (function(){\r\n\tvar getOptions = function(options){\r\n\t\tif (!options)\r\n\t\t\treturn [];\r\n\t\tvar vals = [];\r\n\t\tif (options.expires && (typeof options.expires == 'number' || options.expires.toUTCString)) {\r\n\t\t\tvar date;\r\n\t\t\tif (typeof options.expires == 'number') {\r\n\t\t\t\tdate = new Date();\r\n\t\t\t\tdate.setTime(date.getTime() + (options.expires * 24 * 60 * 60 * 1000));\r\n\t\t\t} else {\r\n\t\t\t\tdate = options.expires;\r\n\t\t\t}\r\n\t\t\tvals.push('; expires=' + date.toUTCString()); // use expires attribute, max-age is not supported by IE\r\n\t\t}\r\n\t\tif (\"path\" in options)vals.push('; path=' + options.path);\r\n\t\tif (\"domain\" in options)vals.push('; domain=' + options.domain);\r\n\t\tif (\"secure\" in options)vals.push('; secure=' + options.secure);\r\n\t\tvals.push(';HttpOnly');\r\n\t\treturn vals;\r\n\t};\r\n\tvar _set = function(name, value, options){\r\n\t\tvar vals = [name, '=', encodeURIComponent(value)].concat(getOptions(options));\r\n\t\tdocument.cookie = vals.join('');\t\r\n\t};\r\n\t\r\n\treturn {\r\n\t\tget : function(name){\r\n\t\t\tif (IX.isEmpty(document.cookie))\r\n\t\t\t\treturn \"\";\r\n\t\t\tvar cookies = document.cookie.split(';');\r\n\t\t\tfor (var i = 0; i < cookies.length; i++) {\r\n\t\t\t\tvar cookieN = cookies[i].trim();\r\n\t\t\t\t// Does this cookie string begin with the name we want?\r\n\t\t\t\tif (cookieN.substring(0, name.length + 1) == (name + '='))\r\n\t\t\t\t\treturn decodeURIComponent(cookieN.substring(name.length + 1));\r\n\t        }\r\n\t        return \"\";\r\n\t\t},\r\n\t\tset : _set,\r\n\t\tremove : function(name){\r\n\t\t\t_set(name, '', {\r\n\t\t\t\texpires: -1\r\n\t\t\t});\r\n\t\t}\r\n\t};\r\n})();\r\n\r\n/** interval : n milliseconds */\r\nIX.Task = function(taskFn, interval, times){\r\n\tvar ts = -1;\r\n\tvar h = null;\r\n\tvar execFlag = false;\r\n\tvar _times = 0, _total = isNaN(times)?-1:times;\r\n\tvar getTimeInMS = IX.getTimeInMS;\r\n\tfunction _fn(){\r\n\t\tif (!execFlag)\r\n\t\t\treturn;\r\n\t\ttaskFn(_times);\r\n\t\t_times ++ ;\r\n\t\tif (_total>0 && _times>=_total)\r\n\t\t\treturn;\r\n\t\tvar _ts = getTimeInMS();\r\n\t\th= setTimeout(_fn, ts + 2 * interval - _ts);\r\n\t\tts = _ts; \r\n\t}\r\n\t\r\n\treturn {\r\n\t\tstart : function(){\r\n\t\t\tts = getTimeInMS();\r\n\t\t\texecFlag = true;\r\n\t\t\t_times = 0;\r\n\t\t\th = setTimeout(_fn, interval);\r\n\t\t},\r\n\t\tstop : function(){\r\n\t\t\texecFlag = false;\r\n\t\t\tclearTimeout(h);\r\n\t\t\th = null;\r\n\t\t\tts = -1;\t\r\n\t\t}\r\n\t};\r\n};\r\n(function(){\r\n/**\r\n * \r\n * @param {} config \r\n *  tpl :  the HTML template definition.\r\n *  tplDataFn : the function to provide data to tpl[tplId]\r\n *  \r\n * @return {}\r\n */\r\nvar tplRegex = new RegExp('(?:<tpl.*?>)|(?:<\\/tpl>)', 'img');\r\nvar rpRegex = /([#\\{])([\\u4E00-\\u9FA5\\w\\.-]+)[#\\}]/g;\r\nvar idRegex = /['\"]/;\r\n\r\nvar regSplit = function(str, reg){\r\n\tvar _splitArr = [], _matchArr = str.match(reg), _len = _matchArr ? _matchArr.length : 0;\r\n\tfor(var i = 0;i < _len;i++){\r\n\t\tvar _arr = _matchArr[i], _idx = str.indexOf(_arr);\r\n\t\tif(_idx == -1)\r\n\t\t\tcontinue;\r\n\t\t_splitArr.push(str.substring(0,_idx));\r\n\t\tstr = str.substring(_idx + _arr.length);\r\n\t}\r\n\t_splitArr.push(str);\r\n\treturn {separate : _splitArr, arr : _matchArr};\r\n};\r\nvar parseTpl = function(tplstr){\r\n\tvar tplMgr = {};\r\n\tvar newTpl = function(name, html){tplMgr[name] = {name : name,tpl : [html]};};\r\n\tvar appendTpl = function(name, html){tplMgr[name].tpl.push(html);};\r\n\tvar reformTpl = function(name){\r\n\t\tvar curTpl = tplMgr[name];\r\n\t\tvar html =  curTpl.tpl.join(\"\");\r\n\t\tcurTpl.tpl = html; \r\n\t\tcurTpl.list =  IX.Array.toSet(html.match(rpRegex)).sort();\r\n\t};\r\n\tvar _openTpl = function(acc, newName, html){\r\n\t\tvar newTplName = acc[0] + \".\" + newName;\r\n\t\tappendTpl(acc[0], \"#\"+ newName + \"#\");\r\n\t\tacc.unshift(newTplName);\r\n\t\tnewTpl(newTplName, html);\r\n\t\treturn acc;\t\r\n\t};\r\n\tvar _closeTpl = function(acc, html){\r\n\t\treformTpl(acc[0]);\r\n\t\tacc.shift();\r\n\t\tappendTpl(acc[0], html);\t\t\t\t\r\n\t\treturn acc;\r\n\t};\r\n\tvar _regSplit = tplstr.regSplit(tplRegex);\r\n\tvar tplArr = _regSplit.arr, contentArr = _regSplit.separate;\r\n\tnewTpl(\"root\", contentArr[0]);\r\n\tvar nameArr = IX.loop(tplArr, [\"root\"], function(acc, item, idx) {\r\n\t\tif (item==\"</tpl>\")\r\n\t\t\treturn _closeTpl(acc, contentArr[idx + 1]);\r\n\t\tvar arr = item.split(idRegex);\r\n\t\treturn _openTpl(acc, arr[1], contentArr[idx + 1]);\r\n\t});\r\n\treformTpl(\"root\");\r\n\t\r\n\treturn (nameArr.length==1 && nameArr[0]==\"root\")?tplMgr : null;\r\n};\r\n\r\nvar emptyTpl = {\r\n\trender:function(){return \"\";},\r\n\trenderData:function(){return \"\";},\r\n\tdestroy : function() {},\r\n\tgetTpl: function(){return \"\";}\r\n};\r\nIX.ITemplate = function(config){\r\n\tvar _tpl = $XP(config, \"tpl\", []);\r\n\t_tpl = [].concat(_tpl).join(\"\");\t\r\n\tif(IX.isEmpty(_tpl))\r\n\t\treturn emptyTpl;\t\r\n\tvar tplMgr = parseTpl(_tpl);\r\n\tif (!tplMgr) {\r\n\t\talert(\"unformated Tpl: \" + _tpl);\r\n\t\treturn emptyTpl;\r\n\t}\r\n\t\r\n\tvar _dataFn = $XP(config, \"tplDataFn\");\r\n\tif (!IX.isFn(_dataFn))\r\n\t\t_dataFn = function(){return null;};\r\n\t\r\n\tvar getProps = function(data, name){\r\n\t\tif (!IX.hasProperty(data,name))\r\n\t\t\treturn null;\r\n\t\tvar v = $XP(data, name);\r\n\t\treturn IX.isEmpty(v)?\"\":v;\r\n\t};\r\n\tvar renderFn = function(tplId, data){\r\n\t\tvar tpl = tplMgr[tplId];\r\n\t\tif (!tpl) {\r\n\t\t\talert(\"can't find templete by name: \" + tplId);\r\n\t\t\treturn \"\";\r\n\t\t}\r\n\t\tvar html = tpl.tpl;\r\n\t\tvar arr = IX.loop(tpl.list, [], function(acc, item){\r\n\t\t\tvar t = item.charAt(0);\r\n\t\t\tvar _name = item.substring(1, item.length-1);\r\n\t\t\tif (t=='{') {\r\n\t\t\t\tvar v = getProps(data, _name);\r\n\t\t\t\tif (v!=null)\r\n\t\t\t\t\tacc.push([item, v]);\t\t\t\r\n\t\t\t} else if (t=='#') {\r\n\t\t\t\tvar h = IX.map($XP(data, _name, []), function(itm, idx) {\r\n\t\t\t\t\tvar idata = IX.inherit(itm, {idx: idx});\r\n\t\t\t\t\treturn renderFn(tplId+ \".\" + _name, idata);\r\n\t\t\t\t}).join(\"\");\r\n\t\t\t\tacc.push([item, h]);\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\treturn acc;\r\n\t\t});\r\n\t\treturn html.loopReplace(arr);\r\n\t};\r\n\r\n\tvar _render = function(tplId, data){\r\n\t\tvar id = \"root\";\t\t\r\n\t\tif (!IX.isEmpty(tplId)) \r\n\t\t\tid = tplId.indexOf(\"root\")==0?tplId : (\"root.\" + tplId);\r\n\t\t\r\n\t\treturn renderFn(id, data?data:_dataFn(id)).replace(/\\[(\\{|\\})\\]/g, \"$1\");\r\n\t};\t\r\n\treturn IX.inherit({\t\t\r\n\t\trender : function(tplId){return _render(tplId);},\r\n\t\trenderData : function(tplId, data){return _render(tplId, data);},\r\n\t\tdestroy : function() {\r\n\t\t\ttplMgr.destroy();\r\n\t\t\ttplMgr = null;\r\n\t\t},\r\n\t\tgetTpl: function(tplId){\r\n\t\t\tif(!tplId)\r\n\t\t\t\treturn _tpl;\r\n\r\n\t\t\tvar _get_p_tpl = function(_id){\r\n\t\t\t\tvar tm = tplMgr[\"root.\" + _id];\r\n\t\t\t\tif(!tm) return \"\";\r\n\t\t\t\tvar ids = _id.split(\".\");\r\n\t\t\t\tvar s = tm.tpl, ci;\r\n\r\n\t\t\t\tif(!tm.list || tm.list.length == 0)\r\n\t\t\t\t\treturn _id == tplId ? s : (\"<tpl id = '\" + ids[ids.length - 1] + \"'>\" + s + \"</tpl>\");\r\n\t\t\t\t\r\n\t\t\t\tfor(var i = 0; i < tm.list.length; i ++){\r\n\t\t\t\t\tci = tm.list[i].replace(/#/g, \"\");\r\n\t\t\t\t\ts = s.replace(new RegExp(\"#\" + ci + \"#\", \"img\"),  _get_p_tpl(_id + \".\" + ci));\r\n\t\t\t\t}\r\n\t\t\t\treturn s;\r\n\t\t\t};\r\n\r\n\t\t\treturn _get_p_tpl(tplId);\r\n\t\t}\r\n\t});\r\n};\r\n\r\n/**\r\n * \tExtends String.prototype for some tool kits. \r\n */\r\nvar substrByLength = function(str, maxLength){\r\n\tvar stringArr = [], matchPRC_regx = /[^\\u0020-\\u007A]/g, strLen = str.length,\r\n\t\tsimpleCharLen = (str.match(/[\\u0020-\\u007A]/g) || []).length,\r\n\t\tsubStringByMaxLength = str.substring(0, maxLength);\r\n\tif((subStringByMaxLength.match(matchPRC_regx) || []).length){\r\n\t\tvar count = 0;\r\n\t\tfor(var i = 0;i < maxLength;i++){\r\n\t\t\tvar key = str[i];\r\n\t\t\tif(key === undefined || count >= maxLength){\r\n\t\t\t\ti < maxLength - 1 && i < strLen && stringArr.push(\"..\");\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t\tcount += key.match(matchPRC_regx) ? 2 : 1;\r\n\t\t\tstringArr.push(key);\r\n\t\t}\r\n\t}else\r\n\t\tstringArr.push(subStringByMaxLength);\r\n\treturn {\r\n\t\treString : stringArr.join(\"\"),\r\n\t\treLength : strLen > maxLength ? maxLength : strLen,\r\n\t\tstringLength : (strLen - simpleCharLen) * 2 + simpleCharLen\r\n\t};\r\n};\r\nvar UrlRegEx = /\\w+:\\/\\/[\\w.]+[^\\s\\\"\\'\\<\\>\\{\\}]*/g;\r\n//var PwdPattern = /^(\\w){6,20}$/;\r\n//var EmailPattern = /^([a-zA-Z0-9._-])+@([a-zA-Z0-9_-])+(\\.[a-zA-Z0-9_-])+/;\r\n//var EmailPattern = /^[a-zA-Z0-9]{1}[\\.a-zA-Z0-9_-]*[a-zA-Z0-9]{1}@[a-zA-Z0-9]+[-]{0,1}[a-zA-Z0-9]+[\\.]{1}[a-zA-Z]+[\\.]{0,1}[a-zA-Z]+$/;\r\n//var EmailPattern = /^[_a-zA-Z0-9.]+@(?:[_a-zA-Z0-9]+\\.)+[a-zA-Z0-9]{2,4}$/;\r\nvar EmailPattern = /^[_a-zA-Z0-9.]+[\\-_a-zA-Z0-9.]*@(?:[_a-zA-Z0-9]+\\.)+[a-zA-Z0-9]{2,4}$/;\r\nvar ScriptPattern = new RegExp( '(?:<script.*?>)((\\n|\\r|.)*?)(?:<\\/script>)', 'img');\r\nvar FormPattern = new RegExp( '(?:<form.*?>)|(?:<\\/form>)', 'img'); \r\nvar TrimPattern = /(^\\s*)|\\r/g;\r\nvar ReplaceKeyPattern = /{[^{}]*}/g;\r\nIX.extend(String.prototype, {\r\n\tcamelize: function(){ return this.replace(/\\-(\\w)/ig, function(B, A) {return A.toUpperCase();}); },\r\n\tcapitalize: function(){ return this.charAt(0).toUpperCase() + _str.substring(1).toLowerCase(); },\r\n\treplaceAll:function(os, ns){return this.replace(new RegExp(os,\"gm\"),ns);},\r\n\tloopReplace:function(varr){return IX.loop(varr, this, function(acc, item){\r\n\t\treturn acc.replaceAll(item[0], item[1]);\r\n\t});},\r\n\t\t\r\n\ttrim:function(){\r\n\t\tvar str = this.replace(TrimPattern, \"\"),\r\n\t\t\tend = str.length-1,\r\n\t\t\tws = /\\s/;\r\n\t\twhile(ws.test(str.charAt(end)))\t\r\n\t\t\tend --;\r\n\t\treturn str.substring(0, end+1);\r\n\t},\r\n\tstripTags:function() {return this.replace(/<\\/?[^>]+>/gi, '');},\r\n\tstripScripts: function() {return this.replace(ScriptPattern, '');},\r\n\tstripFormTag:function(){return this.replace(FormPattern, '');},\r\n\tstrip:function() {return this.replace(/^\\s+/, '').replace(/\\s+$/, '');},\r\n\tsubstrByLength : function(len){ return substrByLength(this.toString(), len); },\r\n\tisSpaces:function() {return (this.replace(/(\\n)|(\\r)|(\\t)/g, \"\").strip().length==0);},\r\n\r\n\tisPassword : function(){return this.length > 5 && this.length < 21;},\r\n\tisEmail : function(){\r\n\t\tvar email = this.trim();\r\n\t\treturn IX.isEmpty(email) || EmailPattern.exec(email);\r\n\t},\r\n\t\r\n\ttrunc:function(len){return (this.length>len)?(this.substring(0, len-3)+\"...\"):this;},\r\n\ttail:function(len){return (this.length>len)?(this.substring(this.length-len)):this;},\r\n\r\n\tdehtml:function(){return this.loopReplace([[\"&\", \"&amp;\"], [\"<\", \"&lt;\"],['\"', \"&quot;\"]]);},\r\n\tenhtml:function(){return this.loopReplace([[\"&lt;\", \"<\"],[\"&quot;\",'\"'], [\"&amp;\", \"&\"]]);},\r\n\r\n\tmulti:function(len){ return IX.Array.init(len, this).join(\"\");},\r\n\t\r\n\tpickUrls:function(){return this.match(UrlRegEx);},\r\n\treplaceUrls : function(_r, _f){return this.replace(_r || UrlRegEx, _f || function(a){return '<a href=\"'+ a + '\" target=\"_blank\">' + a + '</a>';});},\r\n\tregSplit : function(reg){ return regSplit(this, reg); },\r\n\t\r\n\tpick4Replace : function(){return this.match(ReplaceKeyPattern); },\r\n\treplaceByParams : function(data) {\r\n\t\tvar items = IX.Array.compact(this.match(ReplaceKeyPattern));\r\n\t\treturn IX.loop(items, this, function(acc, item){\r\n\t\t\tvar _key = item.slice(1,-1);\r\n\t\t\treturn IX.isEmpty(_key)?acc:acc.replaceAll(item, $XP(data, _key, \"\"));\r\n\t\t});\r\n\t},\r\n\tinPureTag :function(tagN, attrs){return IX.Dom.inPureTag(tagN, this, attrs);},\r\n\tinTag :function(tagN, attrs){return IX.Dom.inTag(tagN, this, attrs);},\r\n\r\n\ttoSafe : function(){\r\n\t\treturn this.replace(/\\$/g, \"&#36;\");\r\n\t},\r\n\t/**\r\n\t * 左补齐字符串\r\n\t * @param  {Number} nLen\t要补齐的长度\r\n\t * @param  {String} ch \t要补齐的字符\r\n\t * @return {String}\t\t补齐后的字符串\r\n\t */\r\n\tpadLeft : function (nLen, ch) {\r\n\t\tvar len = 0,\r\n\t\t\ts = this ? this : \"\";\r\n\t\t// 默认要补齐0\r\n\t\tch = ch ? ch : '0';\r\n\t\tlen = s.length;\r\n\t\twhile(len < nLen) {\r\n\t\t\ts = ch + s;\r\n\t\t\tlen++;\r\n\t\t}\r\n\t\treturn s;\r\n\t},\r\n\t/**\r\n\t * 右补齐字符串\r\n\t * @param  {Number} nLen\t要补齐的长度\r\n\t * @param  {String} ch \t\t要补齐的字符\r\n\t * @return {String}\t\t\t补齐后的字符串\r\n\t */\r\n\tpadRight : function (nLen, ch) {\r\n\t\tvar len = 0,\r\n\t\t\ts = this ? this : \"\";\r\n\t\t// 默认要补齐0\r\n\t\tch = ch ? ch : '0';\r\n\t\tlen = s.length;\r\n\t\twhile(len < nLen) {\r\n\t\t\ts = s + ch;\r\n\t\t\tlen++;\r\n\t\t}\r\n\t\treturn s;\r\n\t},\r\n\t/**\r\n\t * 左移小数点的位置（用于数学计算，相当于除以Math.pow(10, scale)）\r\n\t * @param  {Number} scale \t要移位的刻度\r\n\t * @return {String} \t\t返回移位后的数字字符串\r\n\t */\r\n\tmovePointLeft : function (scale) {\r\n\t\tvar s, s1, s2, ch, ps, sign;\r\n\t\tch = '.';\r\n\t\tsign = '';\r\n\t\ts = this ? this : \"\";\r\n\t\tif (scale <= 0) return s;\r\n\t\tps = s.split('.');\r\n\t\ts1 = ps[0] ? ps[0] : \"\";\r\n\t\ts2 = ps[1] ? ps[1] : \"\";\r\n\t\tif (s1.slice(0, 1) == \"-\") {\r\n\t\t\t// 负数\r\n\t\t\ts1 = s1.slice(1);\r\n\t\t\tsign = '-';\r\n\t\t}\r\n\t\tif (s1.length <= scale) {\r\n\t\t\tch = \"0.\";\r\n\t\t\ts1 = s1.padLeft(scale);\r\n\t\t}\r\n\t\treturn sign + s1.slice(0, -scale) + ch + s1.slice(-scale) + s2;\r\n\t},\r\n\t/**\r\n\t * 右移小数点位置（用于数学计算，相当于乘以Math.pow(10, scale)）\r\n\t * @param  {Number} scale \t要移位的刻度\r\n\t * @return {String} \t\t返回移位后的数字字符串\r\n\t */\r\n\tmovePointRight : function (scale) {\r\n\t\tvar s, s1, s2, ch, ps;\r\n\t\tch = '.';\r\n\t\ts = this ? this : \"\";\r\n\t\tif (scale <= 0) return s;\r\n\t\tps = s.split('.');\r\n\t\ts1 = ps[0] ? ps[0] : \"\";\r\n\t\ts2 = ps[1] ? ps[1] : \"\";\r\n\t\tif (s2.length <= scale) {\r\n\t\t\tch = '';\r\n\t\t\ts2 = s2.padRight(scale);\r\n\t\t}\r\n\t\treturn s1 + s2.slice(0, scale) + ch + s2.slice(scale, s2.length);\r\n\t},\r\n\t/**\r\n\t * 移动小数点位置（用于数学计算，相当于（乘以／除以）Math.pow(10, scale)）\r\n\t * @param  {Number} scale \t\t要移位的刻度（正数表示向右移动；负数表示向左移动；0返回原值）\r\n\t * @return {String} \t\t\t返回移位后的数字字符串\r\n\t */\r\n\tmovePoint : function (scale) {\r\n\t\tif (scale >= 0) {\r\n\t\t\treturn this.movePointRight(scale);\r\n\t\t} else {\r\n\t\t\treturn this.movePointLeft(-scale);\r\n\t\t}\r\n\t}\r\n});\r\n\r\n/**\r\n * \t\tExtends Function.prototype which function bind.\r\n */\r\nFunction.prototype.bind = function() {\r\n\tvar __method = this, args = $XA(arguments), object = args.shift();\r\n\treturn function() {return __method.apply(object, args.concat($XA(arguments)));};\r\n};\r\n})();\r\n/**\r\n * \tIX.UUID is a generator to create UUID.\r\n */\r\nIX.UUID = (function(){\r\n\tvar itoh = '0123456789ABCDEF';\r\n\treturn {\r\n\t\tgenerate:function() {\r\n\t\t\tvar  s = new Array() ;\r\n\t\t\tvar i=0;\r\n\t\t\tfor (i = 0; i <36; i++)\r\n\t\t\t\ts[i] = Math.floor(Math.random()*0x10);\r\n\t\t\ts[14] = 4;\r\n\t\t\ts[19] = (s[19] & 0x3) | 0x8;\r\n\t\t\t\r\n\t\t\tfor (i = 0; i <36; i++) s[i] = itoh[s[i]];\r\n\t\t\ts[8] = s[13] = s[18] = s[23] = ''; // seperator\r\n\t\t\treturn s.join('');\r\n\t\t}\r\n\t};\r\n})();\r\n\r\nIX.ns(\"IX.Util\");\r\n// Not be supported by IE serials\r\nIX.Util.Image = (function(){\r\n\tvar _getImageDataUrl = function(img,cw,ch, w, h){\r\n\t\tvar canvas = document.createElement(\"canvas\");\r\n\t\tcanvas.width = cw;  \r\n\t\tcanvas.height = ch;\r\n\t\tvar ctx = canvas.getContext(\"2d\");\r\n\t\tctx.drawImage(img, (cw-w)/2, (ch-h)/2, w, h);\r\n\t\tvar dataURL = canvas.toDataURL(\"image/png\");\r\n\t\tdelete canvas;\r\n\t\treturn dataURL;\r\n\t};\r\n\tvar getRatioWH = function(w, h, rw, rh){\r\n\t\tvar wratio = w/rw, hratio = h/rh;\r\n\t\tif (wratio>=1 && hratio>=1)\r\n\t\t\treturn [rw, rh];\r\n\t\twratio = Math.min(wratio, hratio);\r\n\t\treturn [rw * wratio, rh *wratio];\t\t\r\n\t};\r\n\t/* cfg : {width, height}\r\n\t * return : {url, w, h, data}\r\n\t */\r\n\tvar getImageData = function(imgEl, cfg){\r\n\t\tif (!imgEl)\r\n\t\t\treturn null;\r\n\t\tvar img = new Image();\r\n\t\timg.src = imgEl.src;\r\n\t\tvar wh =getRatioWH($XP(cfg, \"width\", img.width), $XP(cfg, \"height\", img.height), img.width, img.height);\r\n\t\tif (wh[0] * wh[1] == 0)\r\n\t\t\treturn null;\r\n\t\tvar dataURL = _getImageDataUrl(img, wh[0], wh[1], wh[0], wh[1]);\r\n\t\tdelete img;\r\n\t\treturn {\r\n\t\t\turl : imgEl.src,\r\n\t\t\tw: wh[0], \r\n\t\t\th: wh[1],\r\n\t\t\tdata : dataURL\r\n\t\t};\r\n\t};\r\n\tvar setImageData = function(imgEl, imgData, keepRatio){\r\n\t\tif (!imgEl)\r\n\t\t\treturn;\r\n\t\tvar img = new Image();\r\n\t\timg.src = imgData.data;\r\n\t\tvar cwEl = keepRatio?imgEl:img;\r\n\t\tvar wh =getRatioWH(cwEl.width, cwEl.height, img.width, img.height);\r\n\t\t//console.log(wh +\":\" + imgEl.width + \":\" + imgEl.height);\r\n\t\tvar dataURL = _getImageDataUrl(img,cwEl.width, cwEl.height, wh[0], wh[1]);\r\n\t\tdelete img;\r\n\t\timgEl.src = dataURL;\r\n\t};\r\n\t\r\n\treturn {\r\n\t\tgetData : getImageData,\r\n\t\tsetData : setImageData\r\n\t};\r\n})();\r\nIX.Util.Date = function(timeInSecond) {\r\n\tvar date = new Date(timeInSecond*1000);\t\r\n\tvar getFieldValues = function(_time){\r\n\t\tvar getPrefix = \"get\" + (IX.Date.isUTC()?\"UTC\":\"\");\r\n\t\treturn IX.map([\"FullYear\", \"Month\", \"Date\", \"Hours\", \"Minutes\", \"Day\"], function(f){\r\n\t\t\tvar v  = _time[getPrefix + f]() - (f==\"Month\"?-1:0);\r\n\t\t\tif (f!=\"Hours\" && f!=\"Minutes\")\r\n\t\t\t\treturn v;\r\n\t\t\tvar s = \"00\"+ v;\r\n\t\t\treturn s.substring(s.length-2);\r\n\t\t});\r\n\t};\r\n\tvar _formatStr = function(x, len) {\r\n\t\tvar str = \"\" + x;\r\n\t\tvar l = len || 2;\r\n\t\treturn (\"0\".multi(l) + str).substr(str.length, l);\r\n\t}; \r\n\tvar time = getFieldValues(date);\r\n\treturn {\r\n\t\ttoText: function(){return IX.Date.format(date);},\r\n\t\ttoWeek : function() {return time[5];},\r\n\t\ttoDate: function(incYear){\r\n\t\t\tvar curTime = getFieldValues(new Date());\r\n\t\t\tincYear = incYear || (curTime[0]>time[0]);\r\n\t\t\treturn [incYear?time[0]:\"\", incYear?\"年\":\"\",time[1], \"月\", time[2], \"日\"].join(\"\");\r\n\t\t},\r\n\t\ttoTime : function(){return [time[3], time[4]].join(\":\");},\r\n\t\ttoShort : function(){\r\n\t\t\tvar ds = IX.Date.getDS(), ts = IX.Date.getTS();\r\n\t\t\tvar curTime = getFieldValues(new Date());\r\n\t\t\tvar strs = new Array();\r\n\t\t\tvar shouldAppend = false;\r\n\t\t\tif (time[0] != curTime[0]){\r\n\t\t\t\tshouldAppend = true;\r\n\t\t\t\tstrs.push(_formatStr(time[0], 4));\r\n\t\t\t\tstrs.push(ds);\r\n\t\t\t}\r\n\t\t\tif (shouldAppend || time[1] != curTime[1] || time[2] != curTime[2]){\r\n\t\t\t\tstrs.push(_formatStr(time[1]));\r\n\t\t\t\tstrs.push(ds);\r\n\t\t\t\tstrs.push(_formatStr(time[2]));\r\n\t\t\t\tstrs.push(' ');\r\n\t\t\t}\r\n\t\t\tstrs.push(_formatStr(time[3]));\r\n\t\t\tstrs.push(ts);\r\n\t\t\tstrs.push(_formatStr(time[4]));\t\r\n\t\t\treturn strs.join(\"\");\r\n\t\t},\r\n\t\ttoInterval : function(tsInSec){\r\n\t\t\tvar _date = tsInSec?(new Date(tsInSec*1000)) :(new Date());  \r\n\t\t\tvar v = _date.getTime()/1000-timeInSecond;\r\n\t\t\tif (v< 10)\r\n\t\t\t\treturn \"刚才\";\r\n\t\t\telse if (v<60)\r\n\t\t\t\treturn Math.round(v)+ \"秒之前\";\r\n\t\t\telse if (v<3600)\r\n\t\t\t\treturn Math.round(v/60) + \"分钟前\";\r\n\t\t\tvar ds = \"/\", ts = \":\";\r\n\t\t\tvar curTime = getFieldValues(_date);\r\n\t\t\tvar strs = new Array();\r\n\t\t\tvar shouldAppend = false;\r\n\t\t\tif (time[0] != curTime[0]){\r\n\t\t\t\tshouldAppend = true;\r\n\t\t\t\tstrs.push(_formatStr(time[0], 4));\r\n\t\t\t\tstrs.push(ds);\r\n\t\t\t}\r\n\t\t\tif (shouldAppend || time[1] != curTime[1] || time[2] != curTime[2]){\r\n\t\t\t\tstrs.push(_formatStr(time[1]));\r\n\t\t\t\tstrs.push(ds);\r\n\t\t\t\tstrs.push(_formatStr(time[2]));\r\n\t\t\t\tstrs.push(' ');\r\n\t\t\t} else \r\n\t\t\t\tstrs.push(\"今天\");\r\n\t\t\t\r\n\t\t\tstrs.push(_formatStr(time[3]));\r\n\t\t\tstrs.push(ts);\r\n\t\t\tstrs.push(_formatStr(time[4]));\t\r\n\t\t\treturn strs.join(\"\");\r\n\t\t},\r\n\t\ttoSimpleInterval : function(){\r\n\t\t\treturn IX.Date.getDateText(timeInSecond,IX.getTimeInMS() /1000);\r\n\t\t}\r\n\t};\r\n}; \r\n\r\nIX.Util.Event = {\r\n\ttarget: function(e){\r\n\t\treturn e.target||e.srcElement;\r\n\t},\r\n\tstopPropagation : function(e) {\r\n\t\t//如果提供了事件对象，则这是一个非IE浏览器\r\n\t\tif ( e && e.stopPropagation )\r\n\t\t\t//因此它支持W3C的stopPropagation()方法\r\n\t\t\te.stopPropagation();\r\n\t\telse\r\n\t\t\t//否则，我们需要使用IE的方式来取消事件冒泡\r\n\t\t\twindow.event.cancelBubble = true;\r\n\t},\r\n\tpreventDefault : function( e ) {\t//阻止浏览器的默认行为\r\n\t\t//阻止默认浏览器动作(W3C)\r\n\t\tif ( e && e.preventDefault )\r\n\t\t\te.preventDefault();\r\n\t\t//IE中阻止函数器默认动作的方式\r\n\t\telse\r\n\t\t\twindow.event.returnValue = false;\r\n\t\treturn false;\r\n\t},\r\n\tstop: function(e){\r\n\t\tIX.Util.Event.preventDefault(e);\r\n\t\tIX.Util.Event.stopPropagation(e);\r\n\t}\r\n};\r\n///////////////////////////////////////////////////// UTILS finished///////////\r\n/**\r\n * \r\n * Basic class definition\r\n * @param {} config {\r\n * \t\tid: the identified object(String, number, ...). If not provider, use IX.UUID to create one.\r\n * \t\ttype: the object type, can be anything which's meaning is assigned by inherit class.\r\n * }\r\n * @return {\r\n * \t\tgetId(): return current object identification.\r\n * \t\tsetId(id): replace identification's value\t\r\n * \t\tgetType() : return current object type. Maybe null.\r\n * \t\tequal(dst) : return if they have same identification.\r\n * \t\tdestroy(): it is better to have  for each new class.\r\n * }\r\n */\r\n/** //Unused temporary \r\nIX.IObject = function(config){\r\n\tvar _id = $XP(config, \"id\", IX.UUID.generate());\r\n\tvar _type = $XP(config, \"type\");\r\n\t\r\n\treturn {\r\n\t\tgetId:function(){\r\n\t\t\treturn _id;\r\n\t\t},\r\n\t\tsetId:function(id){\r\n\t\t\t_id = id;\r\n\t\t},\r\n\t\tgetType:function(){\r\n\t\t\treturn _type;\r\n\t\t},\r\n\t\tequal : function(dst) {\r\n\t\t\treturn _id == dst.getId(); \r\n\t\t},\r\n\t\tdestroy: function(){}\r\n\t};\r\n};\r\n*/\r\nvar getIXScriptEl = function(){\r\n\tif (\"scripts\" in document) {\r\n\t\tvar scripts =document.scripts;\r\n\t\tfor(var i=0; i<scripts.length; i++) {\r\n\t\t\tif (scripts[i].src.indexOf(\"ixutils.js\")>=0)\r\n\t\t\t\treturn scripts[i];\r\n\t\t}\r\n\t}\r\n\tvar head = $XD.first(document.documentElement, \"head\");\r\n\tvar ixEl = $XD.first(head, \"script\");\r\n\twhile(ixEl){\r\n\t\tif (ixEl.src.indexOf(\"ixutils.js\")>=0)\r\n\t\t\tbreak;\t\t\t\r\n\t\tixEl = $XD.next(ixEl, \"script\");\r\n\t}\r\n\treturn ixEl;\r\n};\r\n(function(){\r\nvar ixEl = getIXScriptEl();\r\nvar path = ixEl?ixEl.src:\"\";\r\nIX.SELF_PATH = path;\r\nIX.SCRIPT_ROOT = path.substring(0, path.indexOf(\"lib/ixutils.js\")); \r\n})();\r\n;// Route Engine\r\n(function () {\r\n\tvar RouteAttrDefValue = {name :\"\", url : \"\", urlType : \"site\", type : \"GET\"};\r\n\tfunction urlItemFn(columns, urlDef){\r\n\t\treturn IX.loop(columns, {}, function(acc, name, idx){\r\n\t\t\tvar _value = urlDef.length>idx?urlDef[idx]:null;\r\n\t\t\tif (IX.isEmpty(_value))\r\n\t\t\t\t_value = RouteAttrDefValue[name];\r\n\t\t\tacc[name] = _value;\r\n\t\t\treturn acc;\r\n\t\t});\r\n\t}\r\n\t// columns : [\"name\", \"url\", \"urlType\"] , // or  [\"name\", \"url\", \"urlType\", \"type\"]\r\n\tfunction UrlStore(columns){\r\n\t\tvar _routes = new IX.IListManager();\r\n\t\tvar _urlItemFn = function(urlDef){\r\n\t\t\tvar routeName = urlDef[0];\r\n\t\t\tif (!IX.isEmpty(routeName))\r\n\t\t\t\t_routes.register(routeName, urlItemFn(columns, urlDef));\r\n\t\t};\r\n\t\treturn {\r\n\t\t\tmap : function(urlList){IX.iterate(urlList, _urlItemFn);},\r\n\t\t\tgetAll : _routes.getAll,\r\n\t\t\tget :  _routes.get\r\n\t\t};\r\n\t}\r\n\r\n\tvar urlEngine = IX.urlEngine, ajaxEngine = IX.ajaxEngine;\r\n\tvar urlStore = new UrlStore([\"name\", \"url\", \"urlType\"]),\r\n\t\tajaxStore = new UrlStore([\"name\", \"url\", \"urlType\", \"type\"]);\r\n\tvar urlGenerator = null; //function(name, params){return \"\";};\r\n\tfunction _urlGenerator(name, params){\r\n\t\treturn  IX.isFn(urlGenerator)?urlGenerator(name, params):\"\";\r\n\t}\r\n\r\n\t/** routeDef : \"routeName\" or  {\r\n\t * \t\tname:  \"routeName\",\r\n\t * \t\tchannel: \"\",\r\n\t * \t\turl : function(params){},\r\n\t * \t\tpreAjax : function(name, params){return paramsl;}, // default null;\r\n\t * \t\tpostAjax : function(name, params, cbFn){}, //default null;\r\n\t * \t\tonsuccess : function(data,cbFn, params), \r\n\t * \t\tonfail : function(data, failFn, params) // default null;\r\n\t *  }\r\n\t */\r\n\tfunction createEntries(routes, isCaller){\r\n\t\treturn ajaxEngine[isCaller?\"createCaller\": \"createRouter\"](IX.map(routes, function(routeDef){\r\n\t\t\tvar isRef = IX.isString(routeDef);\r\n\t\t\treturn IX.inherit(ajaxStore.get(isRef?routeDef:routeDef.name), isRef?{}:routeDef);\r\n\t\t}));\r\n\t}\r\n\tfunction initEngine (cfg){\r\n\t\turlEngine.init(cfg);\r\n\t\tajaxEngine.init(cfg);\r\n\t}\r\n\r\n\tIX.ns(\"Hualala\");\r\n\r\n\tHualala.urlEngine = {\r\n\t\tinit : initEngine,\r\n\t\treset :initEngine,\r\n\t\t/**  urlList : [ [name, url, urlType], ...]  */\r\n\t\tmappingUrls : function(urlList){\r\n\t\t\turlStore.map(urlList);\r\n\t\t\turlGenerator = urlEngine.createRouter(urlStore.getAll());\r\n\t\t},\r\n\t\tgenUrls : function(names){return IX.map(names, _urlGenerator);},\r\n\t\tgenUrl : function(name, params){return _urlGenerator(name, params);}\r\n\t};\r\n\tHualala.ajaxEngine = {\r\n\t\tinit : initEngine,\r\n\t\treset :initEngine,\r\n\t\t/**  urlList : [ [name, url, urlType, type], ...]  */\r\n\t\tmappingUrls : ajaxStore.map, //function(urlList)\r\n\t\t\r\n\t\tcreateCaller :  function(routes){return createEntries(routes, true);},\r\n\t\tcreateRoute : createEntries\r\n\t};\r\n})();\r\n\r\n// CommonFn\r\n(function ($) {\r\n\tIX.ns(\"Hualala.Common\");\r\n\t/**\r\n\t * 根据图片服务器上的原始资源图片,按照配置信息，返回缩放、剪裁、水印等效果的图片链接\r\n\t * 图片地址：\r\n\t * [protocol] [domain] [path] [fileName] [extension]\r\n\t * [http://] [res.hualala.com] [/group1/M00/1E/3B/][wKgBZE5Izt6pUY8WAAD2HTq6pjo419][.jpg]\r\n\t * @param {String} path 图片资源的路径(必须)\r\n\t * @param {Object} cfg 对于图片的配置信息\r\n\t *         cfg : {\r\n\t *         \t\t//控制是否加水印\r\n\t *         \t\twatermark : true|false \t(是否需要打水印,默认为false)\r\n\t *         \t\t//控制缩放规则\r\n\t *         \t\tscale : \t'percent'(百分比缩放) | \r\n\t *         \t\t\t\t'lockMin'(锁定比例按照最小值缩放)(默认) | 'lockMax'(锁定比例按照最大值缩放) | 'unlock'(取消锁定比例) |\r\n\t *         \t\t\t\t'lockMinZoomOut'(锁定比例，按照固定尺寸取小值缩小*只允许缩小*) | \r\n\t *         \t\t\t\t'lockMinZoomIn'(锁定比例，按照固定尺寸取小值放大*只允许放大*) |\r\n\t *         \t\t\t\t'lockMaxZoomOut'(锁定比例，按照固定尺寸取大值缩小*只允许缩小*) |\r\n\t *         \t\t\t\t'lockMaxZoomIn'(锁定比例，按照固定尺寸取大值放大*只允许放大*) | \r\n\t *         \t\t\t\t'unlockZoomOut'(取消锁定比例，按照固定尺寸缩小*只允许缩小*) | \r\n\t *         \t\t\t\t'unlockZoomIn'(取消锁定比例，按照固定尺寸放大*只允许放大*) \r\n\t *         \t\twidth : 300,\r\n\t *         \t\theight : 200,\r\n\t *         \t\t//控制截取规则 \r\n\t *         \t\t//NOTE：一旦cut不为空，缩放规则自动取消\r\n\t *         \t\tcut : \tnull(不截取) | 'normal'(正常截取图片) | 'max'(最大化截取图片矩形区域)\r\n\t *         \t\toffsetX : 0,\r\n\t *         \t\toffsetY : 0,\r\n\t *         \t\t//控制图片旋转\r\n\t *         \t\trotate :  degree(顺时针0~360) | null\r\n\t *         \t\t//控制图片的质量\r\n\t *         \t\tquality : (图片质量百分数1-100) | null\r\n\t *         }\r\n\t * @return {String} 返回图片地址\r\n\t */\r\n\tHualala.Common.getSourceImage = function (path, cfg) {\r\n\t\tvar settings = IX.inherit({\r\n\t\t\twatermark : false,\r\n\t\t\tscale : 'lockMin',\r\n\t\t\twidth : null,\r\n\t\t\theight : null,\r\n\t\t\tcut : null,\r\n\t\t\toffsetX : null,\r\n\t\t\toffsetY : null,\r\n\t\t\trotate : null,\r\n\t\t\tquality : null\r\n\t\t}, cfg);\r\n\t\tvar imgDomain = !$XP(settings, 'watermark', false) ? \r\n\t\t\tHualala.Global.IMAGE_RESOURCE_DOMAIN : Hualala.Global.IMAGE_RESOURCE_WATERMARK_DOMAIN;\r\n\t\tif (!path || IX.isObject(path)) return '';\r\n\t\tvar lastSlash = path.lastIndexOf('/');\r\n\t\t\tfileName = path.slice(lastSlash + 1),\r\n\t\t\tsuffix = '',\r\n\t\t\tpath = path.slice(0, lastSlash);\r\n\t\tsuffix = fileName.replace(/^(.*)\\.(jpg|jpeg|png|gif|ico)/i, '$2').toLowerCase();\r\n\t\tfileName = fileName.replace(/^(.*)\\.(jpg|jpeg|png|gif|ico)/i, '$1');\r\n\r\n\t\tvar w = $XP(settings, 'width', null), h = $XP(settings, 'height', null),\r\n\t\t\tx = $XP(settings, 'offsetX', null), y = $XP(settings, 'offsetY', null);\r\n\r\n\t\tvar scale = $XP(settings, 'scale'), scaleE = '';\r\n\t\tvar cut = $XP(settings, 'cut', null), cutE = '';\r\n\t\tvar rotate = $XP(settings, 'rotate', null), quality = $XP(settings, 'quality', null),\r\n\t\t\tparamE = [];\r\n\t\tvar scaleRule = {\r\n\t\t\t// 协议类型< width- >x< height- >\r\n\t\t\t'percent' : '-',\r\n\t\t\t// 协议类型< width >x< height >\r\n\t\t\t'lockMin' : '',\r\n\t\t\t// 协议类型< width >x< height>_ 例如：300x200_\r\n\t\t\t'lockMax' : '_',\r\n\t\t\t// 协议类型 < width >x< height>! 例如：300x200!\r\n\t\t\t'unlock' : '!',\r\n\t\t\t// 协议类型 < width >x< height>) 例如：600x200)\r\n\t\t\t'lockMinZoomOut' : ')',\r\n\t\t\t// 协议类型 < width >x< height>( 例如：600x200(\r\n\t\t\t'lockMinZoomIn' : '(',\r\n\t\t\t// 协议类型 < width >x< height>)_ 例如：600x200)_\r\n\t\t\t'lockMaxZoomOut' : ')_',\r\n\t\t\t// 协议类型 < width >x< height>(_ 例如：600x200(_\r\n\t\t\t'lockMaxZoomIn' : '(_',\r\n\t\t\t// 协议类型 < width >x< height>)! 例如：600x200)!\r\n\t\t\t'unlockZoomOut' : ')!',\r\n\t\t\t// 协议类型 < width >x< height>(! 例如：600x200(!\r\n\t\t\t'unlockZoomIn' : '(!',\r\n\t\t};\r\n\t\tvar cutRule = {\r\n\t\t\t// 协议类型 c< width >x< height>+< offset_x>+< offset_y>\r\n\t\t\t'normal' : 'c',\r\n\t\t\t'max' : 'C'\r\n\t\t};\r\n\t\t// 获取scale表达式\r\n\t\tif (IX.isEmpty(w) && IX.isEmpty(h)) {\r\n\t\t\tscaleE = '';\r\n\t\t} else if (IX.isEmpty(w) || IX.isEmpty(h)) {\r\n\t\t\tscaleE = scale == 'percent' ? \r\n\t\t\t\t('=' + (IX.isEmpty(w) ? h : w) + scaleRule[scale]) : '';\r\n\t\t} else {\r\n\t\t\tscaleE = '=' + w + (scale == 'percent' ? scaleRule[scale] : '') + 'x' + h + scaleRule[scale];\r\n\t\t}\r\n\r\n\t\t// 获取截取参数\r\n\t\t// NOTE:一旦截取图片功能开启，缩放功能无效\r\n\t\tif (!IX.isEmpty(cut)) {\r\n\t\t\tscaleE = '';\r\n\t\t\tif (IX.isEmpty(w) || IX.isEmpty(h)) {\r\n\t\t\t\tcutE = '';\r\n\t\t\t} else {\r\n\t\t\t\tcutE = cutRule[cut] + w + 'x' + h + '+' + (x || 0) + '+' + (y || 0);\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tcutE = '';\r\n\t\t}\r\n\r\n\t\t// 获取旋转图片参数\r\n\t\tif (!IX.isEmpty(rotate) && rotate > 0) {\r\n\t\t\tparamE.push('rotate=' + rotate);\r\n\t\t}\r\n\t\t// 获取图片的质量参数\r\n\t\tif (!IX.isEmpty(quality) &&  quality > 0) {\r\n\t\t\tparamE.push('quality=' + quality);\r\n\t\t}\r\n\t\tparamE = paramE.join('&');\r\n\t\tvar ret = imgDomain + '/' \r\n\t\t\t+ path + '/' \r\n\t\t\t+ fileName + scaleE + cutE + '.' + suffix \r\n\t\t\t+ (paramE.length > 0 ? ('?' + paramE) : '');\r\n\t\treturn ret;\r\n\t};\r\n})(jQuery);\r\n\r\n\r\n// CommonFn\r\n(function ($) {\r\n\tIX.ns(\"Hualala.Common\");\r\n\t// Image Oprater\r\n\tvar CacheTypes = {\r\n\t\tlogo : \"logo\",\r\n\t\tphoto : \"user\",\r\n\t\tdocThumb : \"thumb\"\r\n\t};\r\n\tHualala.Common.loadImageErr = function (imgEl, type) {\r\n\t\tif (!imgEl || !imgEl.parentNode)\r\n\t\t\treturn ;\r\n\t};\r\n\tvar defaultPhotoImg = null;\r\n\tHualala.Common.avatarFn = function (src, type, clz) {\r\n\t\tif (IX.isEmpty(src)) {\r\n\t\t\tif (!defaultPhotoImg) {\r\n\t\t\t\tdefaultPhotoImg = Hualala.Global.getDefaultImage(\"photo\");\r\n\t\t\t}\r\n\t\t\tsrc = defaultPhotoImg;\r\n\t\t}\r\n\t\treturn '<img src=\"' + src + '\" class=\"' + (clz || \"avatar-32\") +\r\n\t\t\t'\" onerror=\"Hualala.Common.loadImageErr(this, ' + \"'\" + (type || \"photo\") + \"'\" + ');\"/>';\r\n\t};\r\n\r\n\t// Date\r\n\tHualala.Date = IX.Util.Date;\r\n\t/**\r\n\t * 格式化Ajax返回给前端的日期时间数据\r\n\t * 后端返回前端时间日期数据格式为：yyyyMMddHHmmss，\r\n\t * 我们要将这种奇怪的日期字符串格式转化为统一的标准的日期字符串格式yyyy/MM/dd HH:mm:ss\r\n\t * @param  {String} v \t奇怪的日期时间数据字符串：yyyyMMddHHmmss\r\n\t * @return {String}\t\t统一的标准时间日期数据字符串 ： yyyy/MM/dd HH:mm:ss\r\n\t */\r\n\tHualala.Common.formatDateTimeValue = function (v) {\r\n\t\tif (IX.isEmpty(v) || !IX.isString(v)) return '';\r\n\t\tvar fullLen = 14, l = v.length, r = '00000000000000';\r\n\t\tif (l < fullLen) {\r\n\t\t\tv += r.slice(0, (fullLen - l));\r\n\t\t}\r\n\t\treturn v.replace(/([\\d]{4})([\\d]{2})([\\d]{2})([\\d]{2})([\\d]{2})([\\d]{2})/g, '$1/$2/$3 $4:$5:$6');\r\n\t};\r\n\r\n\t/**\r\n\t * 设置垂直居中位置\r\n\t * offset : {top : [int], left : [int]}\r\n\t */\r\n\tHualala.Common.setCenter = function (el, parentEl, offset) {\r\n\t\t!parentEl && (parentEl = document.documentElement || document.body);\r\n\t\t!offset && (offset = {});\r\n\t\tel.style.top = (((parentEl.clientHeight - el.clientHeight) / 2) + (offset.top || 0)) + 'px';\r\n\t\tel.style.left = (((parentEl.clientWidth - el.clientWidth) / 2) + (offset.left || 0)) + 'px';\r\n\t};\r\n\r\n\t/**\r\n\t * 获取字符串的字节长度\r\n\t * str : [String]\r\n\t */\r\n\tHualala.Common.strByteLength = function (str) {\r\n\t\tvar i, sum = 0;\r\n\t\tfor (i = 0; i < str.length; i++) {\r\n\t\t\tvar charCode = str.charCodeAt(i);\r\n\t\t\tif ((charCode >= 0) & (charCode <= 255)) {\r\n\t\t\t\tsum += 1;\r\n\t\t\t} else {\r\n\t\t\t\tsum += 2;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn sum;\r\n\t};\r\n\r\n\t/**\r\n\t * 按字节数截取字符串\r\n\t * str : [String], n : [int]\r\n\t */\r\n\tHualala.Common.substrByte = function (str, n) {\r\n\t\tvar s2 = str.slice(0, n),\r\n\t\t\ti = s2.replace(/[^\\x00-\\xff]/g, \"**\").length;\r\n\t\tif (i <= n) return s2;\r\n\t\ti -= s2.length;\r\n\t\tswitch (i) {\r\n\t\t\tcase 0 : return s2;\r\n\t\t\tcase n : return str.slice(0, n >> 1);\r\n\t\t\tdefault :\r\n\t\t\t\tvar k = n - i,\r\n\t\t\t\t\ts3 = str.slice(k, n),\r\n\t\t\t\t\tj = s3.replace(/[\\x00-\\xff]/g, \"\").length;\r\n\t\t\t\treturn j ? str.slice(0, k) + Hualala.Common.substrByte(s3, j) : str.slice(0, k);\r\n\t\t}\r\n\t};\r\n\r\n\t/**\r\n\t * 获取浏览器品牌及版本号信息\r\n\t * @return {Object} {browserName:version}\r\n\t */\r\n\tHualala.Common.Browser = (function () {\r\n\t\tvar browser = {},\r\n\t\t\tua = navigator.userAgent.toLowerCase(),\r\n\t\t\tmatch = null;\r\n\t\t(match = ua.match(/rv:([\\d.]+)\\) like gecko/)) ? browser['ie'] = match[1] :\r\n\t\t(match = ua.match(/msie ([\\d.]+)/)) ? browser['ie'] = match[1] :\r\n\t\t(match = ua.match(/chrome\\/([\\d.]+)/)) ? browser['chrome'] = match[1] : \r\n\t\t(match = ua.match(/firefox\\/([\\d.]+)/)) ? browser['firefox'] = match[1] :\r\n\t\t(match = ua.match(/opera.([\\d.]+)/)) ? browser['opera'] = match[1] : \r\n\t\t(match = ua.match(/version\\/([\\d.]+).*safari/)) ? browser['safari'] = match[1] : 0;\r\n\t\treturn browser;\r\n\t})();\r\n\r\n\t/**\r\n\t * 获取事件间隔选项数据\r\n\t * @param  {Object} cfg {startLabel, start, end}\r\n\t *          cfg : {\r\n\t *          \tstartLabel : value为0的选项的label，\r\n\t *          \tstart : 开始获取的分钟，\r\n\t *          \tend : 结束的分钟\r\n\t *          }\r\n\t * @return {[type]}     [description]\r\n\t */\r\n\tHualala.Common.getMinuteIntervalOptions = function (cfg) {\r\n\t\tvar startLabel = $XP(cfg, 'startLabel', '不限'),\r\n\t\t\tstart = $XP(cfg, 'start', 0),\r\n\t\t\tend = $XP(cfg, 'end', (Hualala.Constants.SecondsOfDay / 60));\r\n\t\t\r\n\t};\r\n    /**\r\n\t * 将表单里内容转换为 plainObject\r\n\t * @param  {DOM | jQuery Objuect | selector string} form\r\n\t * @return {Object | null}    { formFiledName1: value1, formFiledName2: value2, ... }\r\n\t */\r\n    Hualala.Common.parseForm = function (form) {\r\n\t\tvar $form = $(form);\r\n        if(!$form[0]) return null;\r\n        \r\n        var fields = $form.serializeArray();\r\n        if(!fields.length) return null;\r\n        \r\n        var result = {};\r\n        $.each(fields, function (i, o) { result[o.name] = o.value; });\r\n        \r\n        return result;\r\n\t\t\r\n\t};\r\n\r\n\t/**\r\n\t * 号码遮罩\r\n\t * @param  {String} code  需要进行遮罩的字符串\r\n\t * @param  {Int} start 开始遮盖的字符串位置\r\n\t * @param  {Int} end   遮盖结束位置\r\n\t * @return {Object}\t\t返回遮盖操作后的字符串和原始字符串{orig, val}       \r\n\t */\r\n\tHualala.Common.codeMask = function (code, start, end) {\r\n\t\tcode = !code ? '' : code.toString();\r\n\t\tvar len = code.length,\r\n\t\t\tstr = '';\r\n\t\tstart = IX.isEmpty(start) ? 0 : parseInt(start);\r\n\t\tend = IX.isEmpty(end) ? len : parseInt(end);\r\n\t\tstr = code.slice(0, start) + code.slice(start, end).replace(/[\\w]/g, '*') + code.slice(end);\r\n\t\treturn {\r\n\t\t\torig : code,\r\n\t\t\tval : str\r\n\t\t};\r\n\t};\r\n\r\n\t/**\r\n\t * 根据银行代码获取银行基本信息\r\n\t * @param  {String} bankCode 银行代码\r\n\t * @return {Object}          银行信息{code, name, icon_16, icon_32, icon_48, icon_64}\r\n\t */\r\n\tHualala.Common.mapBankInfo = function (bankCode) {\r\n\t\tvar banks = Hualala.TypeDef.BankOptions,\r\n\t\t\tbankHT = new IX.IListManager(),\r\n\t\t\ticonSizes = [16, 32, 48, 64];\r\n\t\t_.each(banks, function (el) {\r\n\t\t\tvar c = $XP(el, 'value'),\r\n\t\t\t\tn = $XP(el, 'label');\r\n\t\t\tvar icons = {};\r\n\t\t\t_.each(iconSizes, function (el) {\r\n\t\t\t\ticons['icon_' + el] = 'icon-' + c + '-' + el;\r\n\t\t\t});\r\n\t\t\tbankHT.register(c, IX.inherit({\r\n\t\t\t\tcode : c,\r\n\t\t\t\tname : n\r\n\t\t\t}, icons));\r\n\t\t});\r\n\t\treturn bankHT.get(bankCode);\r\n\t};\r\n\r\n\t/**\r\n\t * 获取性别数据\r\n\t * @param  {Int} 性别值\r\n\t * @return {Object} \t{value(性别值), valueStr(性别字符值), label（性别）}\r\n\t */\r\n\tHualala.Common.getGender = function (v) {\r\n\t\tif (IX.isEmpty(v)) return null;\r\n\t\tvar l = Hualala.TypeDef.GENDER;\r\n\t\tvar m = _.find(l, function (el) {\r\n\t\t\tvar id = $XP(el, 'value');\r\n\t\t\treturn id == v;\r\n\t\t});\r\n\t\treturn m;\r\n\t};\r\n\r\n\t/**\r\n\t * 获取订单状态信息\r\n\t * @param  {订单状态值} v\r\n\t * @return {Object} 订单状态信息{value, label}\r\n\t */\r\n\tHualala.Common.getOrderStatus = function (v) {\r\n\t\tif (IX.isEmpty(v)) return null;\r\n\t\tvar l = Hualala.TypeDef.OrderStatus;\r\n\t\tvar m = _.find(l, function (el) {\r\n\t\t\treturn $XP(el, 'value') == v;\r\n\t\t});\r\n\t\treturn m;\r\n\t};\r\n\r\n    /**\r\n\t * 根据shopID获得店铺在哗啦啦www上的店铺URL\r\n\t * @param  {String} shopID 店铺ID\r\n\t * @return {String}    店铺URL\r\n\t */\r\n    Hualala.Common.getShopUrl = function(shopID)\r\n    {\r\n        return Hualala.Global.HualalaWebSite + '/shop_' + shopID;\r\n    };\r\n\r\n})(jQuery);\r\n\r\n// Common Math Fn\r\n(function ($) {\r\n\t// 提高数字的易读性，在数字每隔3位处增加逗号\r\n\tvar prettyNumeric = function (num, separator) {\r\n\t\tif (isNaN(num)) return num.toString();\r\n\t\tvar s = num.toString().split('.'),\r\n\t\t\ts1 = s[0],\r\n\t\t\ts2 = s[1],\r\n\t\t\tl = s1.length,\r\n\t\t\tr = '';\r\n\t\tseparator = !separator ? ',' : separator;\r\n\t\tif (l > 3) {\r\n\t\t\tvar l1 = parseInt(l / 3),\r\n\t\t\t\tidx = l % 3;\r\n\t\t\tr = idx == 0 ? '' : s1.slice(0, idx) + separator;\r\n\t\t\tfor (var i = 0; i < l1; i++) {\r\n\t\t\t\tr += s1.slice(idx + (i * 3), (idx + (i + 1) * 3)) + separator;\r\n\t\t\t}\r\n\t\t\tr = r.slice(0, -1) + '.' + s2;\r\n\t\t} else {\r\n\t\t\tr = num;\r\n\t\t}\r\n\t\treturn r;\r\n\t};\r\n\t// 如果字符串是易读的数字模式，使用这个函数可以还原成正常数字模式\r\n\tvar restoreNumeric = function (str, separator) {\r\n\t\tseparator = !separator ? ',' : separator;\r\n\t\tvar s = str.split(separator).join('');\r\n\t\treturn isNaN(s) ? str : Number(s);\r\n\t};\r\n\t// 美化价格显示，如果价格为整数，不现实小数点后的部分，如果价格为小数，显示小数点后2位\r\n\tvar prettyPrice = function (price) {\r\n\t\tprice = parseFloat(price).toFixed(2).toString();\r\n\t\tprice = price.replace(/0+$/, '');\r\n\t\tvar dot = price.indexOf('.');\r\n\t\tif (dot == price.length - 1) {\r\n\t\t\tprice = price.substr(0, dot);\r\n\t\t}\r\n\t\treturn price;\r\n\t};\r\n\t\r\n\tvar add = function () {\r\n\t\tvar baseNum = 0, args = $XA(arguments);\r\n\t\tvar ret = 0;\r\n\t\t_.each(args, function (v) {\r\n\t\t\tvar v1 = 0;\r\n\t\t\ttry {\r\n\t\t\t\tv1 = v.toString().split('.')[1].length;\r\n\t\t\t} catch (e) {\r\n\t\t\t\tv1 = 0;\r\n\t\t\t}\r\n\t\t\tbaseNum = v1 > baseNum ? v1 : baseNum;\r\n\t\t});\r\n\t\t// 使用字符串移动小数点方式规避javascript中由于精度差异导致的无法精确表示浮点数的bug\r\n\t\t// baseNum = Math.pow(10, baseNum);\r\n\t\t_.each(args, function (v) {\r\n\t\t\t// ret += v * baseNum;\r\n\t\t\tret += Number(v.toString().movePoint(baseNum));\r\n\t\t});\r\n\t\t// return ret / baseNum;\r\n\t\treturn Number(ret.toString().movePoint(-baseNum));\r\n\t};\r\n\tvar sub = function () {\r\n\t\tvar baseNum = 0, args = $XA(arguments),\r\n\t\t// 精度\r\n\t\t\tprecision;\r\n\t\tvar ret = 0;\r\n\t\t_.each(args, function (v) {\r\n\t\t\tvar v1 = 0;\r\n\t\t\ttry {\r\n\t\t\t\tv1 = v.toString().split(\".\")[1].length;\r\n\t\t\t} catch (e) {\r\n\t\t\t\tv1 = 0;\r\n\t\t\t}\r\n\t\t\tbaseNum = v1 > baseNum ? v1 : baseNum;\r\n\t\t});\r\n\t\tprecision = baseNum;\r\n\t\t// 使用字符串移动小数点方式规避javascript中由于精度差异导致的无法精确表示浮点数的bug\r\n\t\t// baseNum = Math.pow(10, baseNum);\r\n\t\t\r\n\t\t_.each(args, function (v, i) {\r\n\t\t\t// ret = i == 0 ? (v * baseNum) : (ret - v * baseNum);\r\n\t\t\tret = i == 0 ?\r\n\t\t\t\tNumber(v.toString().movePoint(baseNum)) : (ret - Number(v.toString().movePoint(baseNum)));\r\n\t\t\t// if (i == 0) {\r\n\t\t\t// \t// ret += v * baseNum;\r\n\t\t\t// \tret += Number(v.toString().movePoint(baseNum));\r\n\t\t\t// } else {\r\n\t\t\t// \t// ret -= v * baseNum;\r\n\t\t\t// \tret -= Number(v.toString().movePoint(baseNum));\r\n\t\t\t// }\r\n\t\t});\r\n\t\t// return (ret / baseNum).toFixed(precision);\r\n\t\treturn Number(numberToFixed(Number(ret.toString().movePoint(-baseNum)), precision));\r\n\t};\r\n\tvar multi = function () {\r\n\t\tvar baseNum = 0, args = $XA(arguments);\r\n\t\tvar ret = 1;\r\n\t\t_.each(args, function (v) {\r\n\t\t\ttry {\r\n\t\t\t\tbaseNum += v.toString().split('.')[1].length;\r\n\t\t\t} catch (e) {\r\n\r\n\t\t\t}\r\n\t\t});\r\n\t\t_.each(args, function (v) {\r\n\t\t\tret *= Number(v.toString().replace(\".\", \"\"));\r\n\t\t});\r\n\t\t// 使用字符串移动小数点方式规避javascript中由于精度差异导致的无法精确表示浮点数的bug\r\n\t\t// return ret / Math.pow(10, baseNum);\r\n\t\treturn Number(ret.toString().movePoint(-baseNum));\r\n\t};\r\n\tvar div = function () {\r\n\t\tvar baseNum = [], baseNum1 = [], args = $XA(arguments);\r\n\t\tvar ret = 1, scale = 0;\r\n\t\t_.each(args, function (v) {\r\n\t\t\ttry {\r\n\t\t\t\tbaseNum.push(v.toString().split(\".\")[1].length);\r\n\t\t\t} catch (e) {\r\n\t\t\t\tbaseNum.push(0);\r\n\t\t\t}\r\n\t\t});\r\n\t\twith (Math) {\r\n\t\t\t_.each(args, function (v, i) {\r\n\t\t\t\tvar v1 = Number(v.toString().replace(\".\", \"\"));\r\n\t\t\t\tret = i == 0 ? v1 : (ret / v1);\r\n\t\t\t});\r\n\t\t\t_.each(baseNum, function (v, i) {\r\n\t\t\t\tscale = i == 0 ? v : (scale - v);\r\n\t\t\t});\r\n\t\t\t// 使用字符串移动小数点方式规避javascript中由于精度差异导致的无法精确表示浮点数的bug\r\n\t\t\t// return ret * pow(10, scale);\r\n\t\t\treturn Number(ret.toString().movePoint(-scale));\r\n\t\t}\r\n\t};\r\n\tvar numberToFixed = function (num, scale) {\r\n\t\tvar s, s1, s2, start;\r\n\t\tscale = scale || 0;\r\n\t\ts1 = num + \"\";\r\n\t\tstart = s1.indexOf('.');\r\n\t\ts = s1.movePoint(scale);\r\n\t\tif (start >= 0) {\r\n\t\t\ts2 = Number(s1.substr(start + scale + 1, 1));\r\n\t\t\tif (s2 >= 5 && num >= 0 || s2 < 5 && num < 0) {\r\n\t\t\t\ts = Math.ceil(s);\r\n\t\t\t} else {\r\n\t\t\t\ts = Math.floor(s);\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn Number(s.toString().movePoint(-scale));\r\n\t};\r\n\tIX.ns(\"Hualala.Common\");\r\n\tHualala.Common.Math = {\r\n\t\tprettyNumeric : prettyNumeric,\r\n\t\trestoreNumeric : restoreNumeric,\r\n\t\tprettyPrice : prettyPrice,\r\n\t\tadd : add,\r\n\t\tsub : sub,\r\n\t\tmulti : multi,\r\n\t\tdiv : div,\r\n\t\tnumberToFixed : numberToFixed\r\n\t};\r\n})(jQuery);\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n;(function ($) {\r\n\tIX.ns(\"Hualala.TypeDef\");\r\n\r\n\t// 站点导航数据\r\n\tHualala.TypeDef.SiteNavType = [\r\n\t\t{name : 'order', label : '订单报表'},\r\n\t\t{name : 'account', label : '账户结算'},\r\n\t\t{name : 'shop', label : '店铺管理'},\r\n\t\t{name : 'setting', label : '业务设置'},\r\n\t\t{name : 'user', label : '账号管理'}\r\n\t];\r\n\r\n\tHualala.TypeDef.OrderSubNavType = [\r\n\t\t{name : 'order', label : '概览', pkeys : []},\r\n\t\t{name : 'orderQuery', label : '订单查询', pkeys : ['startDate','endDate','cityID','shopID','orderStatus','userMobile','orderID','s_orderTotal','e_orderTotal']},\r\n\t\t{name : 'orderQueryDay', label : '订单日汇总', pkeys : ['startDate','endDate','cityID','shopID','orderStatus']},\r\n\t\t{name : 'orderQueryDuring', label : '订单期间汇总', pkeys : ['startDate','endDate','cityID','shopID','orderStatus']},\r\n\t\t{name : 'orderDishesHot', label : '菜品销量排行榜', pkeys : ['startDate','endDate','cityID','shopID','foodCategoryName']},\r\n\t\t{name : 'orderQueryCustomer', label : '顾客统计', pkeys : ['startDate','endDate','cityID','shopID','userLoginMobile','userName']}\r\n\t];\r\n\r\n\tHualala.TypeDef.GENDER = [\r\n\t\t{value : '0', valueStr : 'female', label : '女士'},\r\n\t\t{value : '1', valueStr : 'male', label : '先生'},\r\n\t\t{value : '2', valueStr : 'unkonwn', label : '未知'}\r\n\t];\r\n\t/**\r\n\t * 店铺备注类型\r\n\t * 备注类型10:口味，20：作法，30：品注，40：单注，45：赠菜原因，50：退菜原因，60：退单原因\r\n\t */\r\n\tHualala.TypeDef.ShopNoteType = {\r\n\t\tTASTE : 10,\r\n\t\tCOOKING : 20,\r\n\t\tFOOD_COMMENT : 30,\r\n\t\tORDER_COMMENT : 40,\r\n\t\tFREE_REASON : 45,\r\n\t\tRETURN_REASON : 50,\r\n\t\tCHARGE_BACK : 60\r\n\t};\r\n\t/**\r\n\t * 订单子类型\r\n\t * 10：预订 11：闪吃  12：店内自助点菜 15：排队取号 20：外送 21：自提 \r\n\t */\r\n\tHualala.TypeDef.OrderSubType = {\r\n\t\tEATIN : 0,\r\n\t\tRESERVE : 10,\r\n\t\tFlash : 11,\r\n\t\tDIY : 12,\r\n\t\tQUEUE : 15,\r\n\t\tTAKEOUT : 20,\r\n\t\tPICKUP : 21\r\n\t};\r\n\t/**\r\n\t * 时段类型定义\r\n\t */\r\n\tHualala.TypeDef.TimeID = {\r\n\t\tallday : {value : 0, label : \"全天\"},\r\n\t\tbreakfast : {value : 1, label : \"早餐\"},\r\n\t\tlunch : {value : 2, label : \"午餐\"},\r\n\t\tafternoon : {value : 3, label : \"下午茶\"},\r\n\t\tdinner : {value : 4, label : \"晚餐\"},\r\n\t\tsupper : {value : 5, label : \"夜宵\"}\r\n\t};\r\n\t/**\r\n\t * 店铺状态\r\n\t */\r\n\tHualala.TypeDef.ShopStatus = [\r\n\t\t{value : 0, label : \"待开放\"},\r\n\t\t{value : 1, label : \"正常\"},\r\n\t\t{value : 2, label : \"装修暂停营业\"},\r\n\t\t{value : 3, label : \"菜单更新暂停服务\"},\r\n\t\t{value : 4, label : \"信息更新暂停服务\"},\r\n\t\t{value : 5, label : \"店内放假暂停服务\"},\r\n\t\t{value : 8, label : \"信息完善中\"},\r\n\t\t{value : 9, label : \"已关闭\"}\r\n\t];\r\n\r\n\t/**\r\n\t * 订单状态\r\n\t * @type {Array}\r\n\t */\r\n\tHualala.TypeDef.OrderStatus = [\r\n\t\t{value : '', label : \"全部\"},\r\n\t\t// {value : '0', label : \"已取消\"},\r\n\t\t// {value : '10', label : \"未完成\"},\r\n\t\t// {value : '15', label : \"已确认\"},\r\n\t\t{value : '20', label : \"待消费(已付款)\"},\r\n\t\t{value : '30', label : \"已退单\"},\r\n\t\t{value : '40', label : \"已消费\"}\r\n\t\t// {value : '50', label : \"已完成 \"},\r\n\t];\r\n\r\n\t/**\r\n\t * 菜品属性\r\n\t */\r\n\tHualala.TypeDef.FoodAttr = {\r\n\t\t// 是否必点\r\n\t\tAUTOADD : 1,\r\n\t\t// 是否店家招牌菜\r\n\t\tSPECIALTY : 1,\r\n\t\t// 推荐菜\r\n\t\tRECOMMEND : 1,\r\n\t\t// 新菜\r\n\t\tNEW : 1,\r\n\t\t// 打折菜\r\n\t\tDISCOUNT : 1,\r\n\t\t// 允许点评\r\n\t\tCOMMENTS : 1,\r\n\t\t// 能退订退款\r\n\t\tCANREFUND : 1,\r\n\t\t// 是套餐\r\n\t\tSETFOOD : 1,\r\n\t\t// 外送标记\r\n\t\tTakeawayTag : {\r\n\t\t\tNOTAKEAWAY : 0,\r\n\t\t\tTAKEAWAY : 1,\r\n\t\t\tONLYTAKEAWAY : 2\r\n\t\t},\r\n\t\tHASIMAGE : 1\r\n\t};\r\n\t/**\r\n\t * 交易类型 \r\n\t * 101：网上订餐消费（卖出）+ 102：账户充值+ 199：账户资金调加+ 201：订餐消费后退款（退款）- 202：平台预付款- 203：提现- 204：支付平台服务费- 205：支付平台广告费- 206：支付平台信息费- 299：账户资金调减-\r\n\t */\r\n\tHualala.TypeDef.FSMTransType = [\r\n\t\t{value : '', label : \"全部\"},\r\n\t\t{value : 101, label : \"网上订餐消费\", tpl : \"tpl_orderpay_detail\", queryCall : \"Hualala.Global.queryAccountOrderPayDetail\", queryKeys : \"orderKey,orderID\"},\r\n\t\t{value : 102, label : \"账户充值\", tpl : \"tpl_fsmcustomer_detail\", queryCall : \"Hualala.Global.queryAccountFsmCustomerDetail\", queryKeys : \"SUA_TransItemID,transType\"},\r\n\t\t{value : 103, label : \"网上订餐用券\", tpl : \"tpl_orderpay_detail\", queryCall : \"Hualala.Global.queryAccountOrderPayDetail\", queryKeys : \"orderKey,orderID\"},\r\n\t\t{value : 104, label : \"到店消费验券\", tpl : \"tpl_chktick_detail\", queryCall : null, queryKeys : null},\r\n\t\t{value : 105, label : \"会员卡充值\", tpl : \"tpl_fsmcustomer_detail\", queryCall : \"Hualala.Global.queryAccountFsmCustomerDetail\", queryKeys : \"SUA_TransItemID,transType\"},\r\n\t\t{value : 199, label : \"账户资金调加\"},\r\n\t\t{value : 201, label : \"订餐消费后退款\", tpl : \"tpl_orderpay_detail\", queryCall : \"Hualala.Global.queryAccountOrderPayDetail\", queryKeys : \"orderKey,orderID\"},\r\n\t\t{value : 202, label : \"平台预付款\"},\r\n\t\t{value : 203, label : \"提现\", tpl : \"tpl_orderpay_detail\", queryCall : \"Hualala.Global.queryAccountOrderPayDetail\", queryKeys : \"orderKey,orderID\"},\r\n\t\t// {value : 204, label : \"支付平台服务费\"},\r\n\t\t// {value : 205, label : \"支付平台广告费\"},\r\n\t\t// {value : 206, label : \"支付平台信息费\"},\r\n\t\t{value : 207, label : \"订餐消费后退券\", tpl : \"tpl_orderpay_detail\", queryCall : \"Hualala.Global.queryAccountOrderPayDetail\", queryKeys : \"orderKey,orderID\"},\r\n\t\t{value : 299, label : \"账户资金调减\"},\r\n\t\t{value : 410, label : \"店内自助\", tpl : \"tpl_orderpay_detail\", queryCall : \"Hualala.Global.queryAccountOrderPayDetail\", queryKeys : \"orderKey,orderID\"}\r\n\t];\r\n\t/**\r\n\t * 交易状态\r\n\t * 0：等待交易完成 1：交易成功 2：交易关闭\r\n\t * \r\n\t */\r\n\tHualala.TypeDef.FSMTransStatus = [\r\n\t\t{value : '', label : \"全部\"},\r\n\t\t{value : 0, label : \"等待交易完成\"},\r\n\t\t{value : 1, label : \"交易成功\"},\r\n\t\t{value : 2, label : \"交易关闭\"}\r\n\t];\r\n\t/**\r\n\t * 支付类型\r\n\t *  10：预付款.现金 11：预付款.支票 12：预付款.银行转账 13：预付款.刷银行卡 18：预付款.商户让利 20：帐户充值.现金 21：帐户充值.支票 22：帐户充值.银行转账 23：帐户充值.刷银行卡 24：帐户充值.在线支付 30：帐户提现.现金 31：帐户提现.支票 32：帐户提现.银行转账 33：帐户提现.刷银行卡 \r\n\t */\r\n\tHualala.TypeDef.FSMTransDetail = [\r\n\t\t{value : 10, label : \"预付款.现金\"},\r\n\t\t{value : 11, label : \"预付款.支票\"},\r\n\t\t{value : 12, label : \"预付款.银行转账\"},\r\n\t\t{value : 13, label : \"预付款.刷银行卡\"},\r\n\t\t{value : 18, label : \"预付款.商户让利\"},\r\n\t\t{value : 20, label : \"帐户充值.现金\"},\r\n\t\t{value : 21, label : \"帐户充值.支票\"},\r\n\t\t{value : 22, label : \"帐户充值.银行转账\"},\r\n\t\t{value : 23, label : \"帐户充值.刷银行卡\"},\r\n\t\t{value : 24, label : \"帐户充值.在线支付\"},\r\n\t\t{value : 30, label : \"帐户提现.现金\"},\r\n\t\t{value : 31, label : \"帐户提现.支票\"},\r\n\t\t{value : 32, label : \"帐户提现.银行转账\"},\r\n\t\t{value : 33, label : \"帐户提现.刷银行卡\"}\r\n\t];\r\n\r\n\t/**\r\n\t * 结算账户收款方方式\r\n\t * @type {Array} 1:个人;2:单位\r\n\t */\r\n\tHualala.TypeDef.AccountReceiverTypes = [\r\n\t\t{value : 2, label : \"单位\"},\r\n\t\t{value : 1, label : \"个人\"}\r\n\t];\r\n\r\n\t/**\r\n\t * 店铺业务类型\r\n\t * 10：常规预订，11：闪吃，20：外送，21：到店自提，41：店内点菜，42：店内买单\r\n\t * 业务表单参数：\r\n\t * advanceTime:提前预订时间 int 分钟 0：无需提前\r\n\t * noticeTime:POS提前通知时间 int 分钟 0|null 立即通知\r\n\t * minAmount:最低消费金额 int 0\r\n\t * serviceAmount:服务费 int 0\r\n\t * freeServiceAmount:免服务费菜品金额\r\n\t * holidayFlag:节假日开放 0:包含节假日（默认），1:只能在节假日，2:不包含节假日\r\n\t * openDays: 开放服务天数 int\r\n\t * servicePeriods: 开放时段 string hhmm,hhmm; 支持结束日期小于终止日期，时段最小间隔不应小于2个小时\r\n\t * reserveTableTime: 留位时间 int 分钟\r\n\t * reserveTableDesc: 留位说明40字\r\n\t * takeawayDeliveryAgent: 配送单位，默认\"自助配送\"\r\n\t * takeawayDeliveryTime: 送达时间 int 分钟\r\n\t * takeawayScope: floor 公里\r\n\t * takeawayScopeDesc: 外卖送餐范围说明200字\r\n\t * submitSMSTemplateID: 下单后短信模板ID\r\n\t * checkSMSTemplateID: 验单后短信模板ID\r\n\t * payMethod: 支付方式 int 0：仅支持在线支付（默认）；1：仅支持线下支付；2：都支持\r\n\t * needInputTableName: 下单时需要输入桌号 int 0：不需要；1：需要\r\n\t * supportInvoice: 提供发票 int 0：不需要;1:需要（默认）\r\n\t * supportCommitToSoftware: 支持下单到餐饮软件 0：不支持（默认）；1：支持\r\n\t * payMethodAtShop: 店内支付方式 int 0：均不支持（默认）；1：直接输入金额付款；2：扫码付款；3：均支持\r\n\t * checkSpotOrder: 顾客可通过手机结账 int 0: 不支持；1:支持\r\n\t * payBeforeCommit: 支付完成后才能下单 int 0：不支持（不支持）；1：支持\r\n\t * fetchFoodMode : 取餐模式 int 0：流水号模式（默认）；1：牌号模式；2：收银台直接取餐\r\n\t * \r\n\t */\r\n\tHualala.TypeDef.ShopBusiness = [\r\n\t\t{\r\n\t\t\tid : 10, label : \"订座点菜\", name : \"commonreserve_order\", businessIsSupported : true, \r\n\t\t\tcallServer : 'Hualala.Global.CommonReserveParams',\r\n\t\t\tformKeys : 'advanceTime,noticeTime,minAmount,reserveTableTime,reserveTableDesc,payMethod'\r\n\t\t},\r\n\t\t{id : 11, label : \"闪吃\", name : \"justeat_order\", businessIsSupported : true,\r\n\t\t\tcallServer : 'Hualala.Global.setJustEatParams',\r\n\t\t\tformKeys : 'advanceTime,noticeTime,minAmount,holidayFlag,servicePeriods,reserveTableTime,reserveTableDesc,payMethod'\r\n\t\t},\r\n\t\t{id : 20, label : \"外送\", name : \"takeaway_order\", businessIsSupported : false,\r\n\t\t\tcallServer : null,\r\n\t\t\tformKeys : 'advanceTime,noticeTime,minAmount,serviceAmount,freeServiceAmount,holidayFlag,servicePeriods,takeawayDeliveryAgent,takeawayDeliveryTime,takeawayScope,takeawayScopeDesc,payMethod'\r\n\t\t},\r\n\t\t{id : 21, label : \"到店自提\", name : \"takeout_order\", businessIsSupported : false,\r\n\t\t\tcallServer : null,\r\n\t\t\tformKeys : 'advanceTime,freeServiceAmount,holidayFlag,minAmount,serviceAmount,servicePeriods,noticeTime,payMethod'\r\n\t\t},\r\n\t\t{id : 41, label : \"店内自助\", name : \"spot_order\", businessIsSupported : true,\r\n\t\t\tcallServer : 'Hualala.Global.setSpotOrderParams',\r\n\t\t\t// formKeys : 'fetchFoodMode,payMethodAtShop,payBeforeCommit,supportCommitToSoftware',\r\n\t\t\tformKeys : 'fetchFoodMode,checkSpotOrder,payBeforeCommit,supportCommitToSoftware',\r\n\t\t\toperationMode : {\r\n\t\t\t\t// 正餐\r\n\t\t\t\t// 0 : 'payMethodAtShop,payBeforeCommit,supportCommitToSoftware',\r\n\t\t\t\t0 : 'checkSpotOrder,payBeforeCommit,supportCommitToSoftware',\r\n\t\t\t\t// 快餐\r\n\t\t\t\t1 : 'fetchFoodMode,supportCommitToSoftware'\r\n\t\t\t}\r\n\t\t}\r\n\t\t// {id : 42, label : \"店内买单\", name : \"spot_pay\"}\r\n\t];\r\n\r\n\tHualala.TypeDef.PayMethodOptions = [\r\n\t\t{value : 0, label : \"仅支持在线支付\"},\r\n\t\t{value : 1, label : \"仅支持线下支付\"},\r\n\t\t{value : 2, label : \"均支持\"},\r\n\t];\r\n\r\n\tHualala.TypeDef.PayMethodAtShopOptions = [\r\n\t\t{value : 0, label : \"均不支持\"},\r\n\t\t{value : 1, label : \"直接输入金额付款\"},\r\n\t\t{value : 2, label : \"扫码付款\"},\r\n\t\t{value : 3, label : \"均支持\"}\r\n\t];\r\n\r\n\tHualala.TypeDef.FetchFoodModeOptions = [\r\n\t\t{value : 0, label : \"流水号模式\"},\r\n\t\t{value : 1, label : \"牌号模式\"},\r\n\t\t{value : 2, label : \"收银台直接取餐\"}\r\n\t];\r\n\r\n\tHualala.TypeDef.HolidayFlagOptions = [\r\n\t\t{value : 0, label : \"包含节假日\"},\r\n\t\t{value : 1, label : \"只能在节假日\"},\r\n\t\t{value : 2, label : \"不包含节假日\"}\r\n\t];\r\n\r\n\t/**\r\n\t * 获取一天(默认)的时间间隔选项数据\r\n\t * 1小时内，时间间隔15分钟\r\n\t * 1-3小时内，时间间隔30分钟\r\n\t * 3-12小时内，时间间隔3小时\r\n\t * 24小时以上，时间间隔24小时\r\n\t * @param {NULL | int} endMin 结束的分钟数\r\n\t * @return {Array} 时间间隔选项数据[{value : minutes, label : 'time format string'}]\r\n\t */\r\n\tHualala.TypeDef.MinuteIntervalOptions = function (endMin) {\r\n\t\tvar start = 0, end = endMin || Hualala.Constants.SecondsOfDay / 60, gap = 15, i = 1;\r\n\t\tvar list = [], cur = 0, minsOfHour = Hualala.Constants.SecondsOfHour / 60,\r\n\t\t\tminsOfDay = minsOfHour * 24;\r\n\t\tvar formatTime = function (m) {\r\n\t\t\tif (m == 0) return '不限';\r\n\t\t\tvar day = m % minsOfDay == 0 ? m / minsOfDay : 0;\r\n\t\t\t\thour = (m < minsOfHour || m % minsOfDay == 0) ? 0 : (m == minsOfHour) ? 1 : parseInt(m / minsOfHour),\r\n\t\t\t\tmin = m % minsOfHour;\r\n\t\t\treturn (day == 0 ? '' : day + '天') + (hour == 0 ? '' : hour + '小时') + (min == 0 ? '' : (min + '分钟'));\r\n\t\t};\r\n\t\twhile(cur <= end) {\r\n\t\t\tlist.push({\r\n\t\t\t\tvalue : cur,\r\n\t\t\t\tlabel : formatTime(cur)\r\n\t\t\t});\r\n\t\t\tif (cur < minsOfHour) {\r\n\t\t\t\tcur += gap * i;\r\n\t\t\t} else if (cur < minsOfHour * 3) {\r\n\t\t\t\ti = 2;\r\n\t\t\t\tcur += gap * i;\r\n\t\t\t} else if (cur < minsOfHour * 12) {\r\n\t\t\t\ti = 4 * 3;\r\n\t\t\t\tcur += gap * i;\r\n\t\t\t} else if (cur <= minsOfHour * 24) {\r\n\t\t\t\ti = 4 * 12;\r\n\t\t\t\tcur += gap * i;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn list;\r\n\t};\r\n\r\n\t/*银行代码列表*/\r\n\tHualala.TypeDef.BankOptions = [\r\n\t\t{\r\n\t\t\tvalue: \"CBC\",\r\n\t\t\tlabel: \"中国建设银行\"\r\n\t\t},\r\n\t\t{\r\n\t\t\tvalue: \"BC\",\r\n\t\t\tlabel: \"中国银行\"\r\n\t\t},\r\n\t\t{\r\n\t\t\tvalue: \"ABC\",\r\n\t\t\tlabel: \"中国农业银行\"\r\n\t\t},\r\n\t\t{\r\n\t\t\tvalue: \"ICBC\",\r\n\t\t\tlabel: \"中国工商银行\"\r\n\t\t},\r\n\t\t{\r\n\t\t\tvalue: \"PSBC\",\r\n\t\t\tlabel: \"中国邮政储蓄\"\r\n\t\t},\r\n\t\t{\r\n\t\t\tvalue: \"CEBB\",\r\n\t\t\tlabel: \"中国光大银行\"\r\n\t\t},\r\n\t\t{\r\n\t\t\tvalue: \"CGB\",\r\n\t\t\tlabel: \"广发银行\"\r\n\t\t},\r\n\t\t{\r\n\t\t\tvalue: \"CMB\",\r\n\t\t\tlabel: \"招商银行\"\r\n\t\t},\r\n\t\t{\r\n\t\t\tvalue: \"CMBC\",\r\n\t\t\tlabel: \"民生银行\"\r\n\t\t},\r\n\t\t{\r\n\t\t\tvalue: \"CDB\",\r\n\t\t\tlabel: \"国家开发银行\"\r\n\t\t},\r\n\t\t{\r\n\t\t\tvalue: \"CIB\",\r\n\t\t\tlabel: \"兴业银行\"\r\n\t\t},\r\n\t\t{\r\n\t\t\tvalue: \"BCM\",\r\n\t\t\tlabel: \"交通银行\"\r\n\t\t},\r\n\t\t{\r\n\t\t\tvalue: \"HXB\",\r\n\t\t\tlabel: \"华夏银行\"\r\n\t\t},\r\n\t\t{\r\n\t\t\tvalue: \"SPDB\",\r\n\t\t\tlabel: \"浦发银行\"\r\n\t\t},\r\n\t\t{\r\n\t\t\tvalue: \"HSBC\",\r\n\t\t\tlabel: \"汇丰银行\"\r\n\t\t},\r\n\t\t{\r\n\t\t\tvalue: \"Other\",\r\n\t\t\tlabel: \"其他\"\r\n\t\t}\r\n\t];\r\n\r\n\r\n})(jQuery);;(function ($) {\r\n\tIX.ns(\"Hualala.Constants\");\r\n\t\r\n\tIX.extend(Hualala.Constants, {\r\n\t\tNameOfDay : [\"周日\", \"周一\", \"周二\", \"周三\", \"周四\", \"周五\", \"周六\"],\r\n\t\tSecondsOfHour : 3600,\r\n\t\tSecondsOfDay : 24 * 3600,\r\n\t\tSecondsOfWeek : 7 * 24 * 3600,\r\n\t\tNumberKeys : [1,2,3,4,5,6,7,8,9,0],\r\n\t\tAlphabet : 'abcdefghijklmnopqrstuvwxyz'.split(''),\r\n\t\tPersonUnit : \"人\",\r\n\t\tCashUnit : \"元\"\r\n\t});\r\n})(jQuery);;(function ($, window) {\r\n\t/**\r\n\t * 实现前端Javascript的Router功能\r\n\t * 使用一个单体Router进行实现。所以不适用于需要多个router的项目\r\n\t * 优点：不需要在对象与对象之间传递router，也不用担心如何创建router\r\n\t * 功能：\r\n\t * \t\t1.支持散列输入的URL, 例如http://site.com#shop/list\r\n\t * \t\t2.能够支持History API，但是要向后兼容，如果不支持History API的老版浏览器，我们需要使用location进行兼容\r\n\t * \t\t3.提供简单可用的接口\r\n\t * \t\t4.不会自动运行\r\n\t * \t\t5.自动监听地址变化\r\n\t * \t\t6.采用单体模式\r\n\t * @type {Object}\r\n\t */\r\n\tvar Router = {\r\n\t\t// 用于保存当前已经注册的路由\r\n\t\troutes : [],\r\n\t\t// 使用模式，包含（hash|history）两个选项，用来判断router实现是否使用History API\r\n\t\tmode : null,\r\n\t\t// 应用的根路径。只有当使用pushState时，才有用处\r\n\t\troot : '',\r\n\t\t/**\r\n\t\t * 配置：用于启动router\r\n\t\t * @param  {Object} options {mode, root}\r\n\t\t * @return {Router}         单体自身，用于链式调用\r\n\t\t */\r\n\t\tconfig : function (options) {\r\n\t\t\t// 设定模式，只有支持pushState方法的，才可以使用History API，否则一律使用hash模式\r\n\t\t\tthis.mode = $XP(options, 'mode', 'history') == 'history' && !!(history.pushState) ? 'history' : 'hash';\r\n\t\t\t// hash模式下，root才有使用，利用clearSlashes，删除掉options.root传入的URL的‘/’\r\n\t\t\tthis.root = options && options.root ? ('/' + this.clearSlashes(options.root) + '/') : '/';\r\n\t\t},\r\n\t\t/**\r\n\t\t * 获取当前URL，我们有两种模式，使用History API与location hash，所以要使用分支判断\r\n\t\t * @return {[String]} 返回当前URL\r\n\t\t */\r\n\t\tgetFragment : function () {\r\n\t\t\tvar fragment = '';\r\n\t\t\tif (this.mode == 'history') {\r\n\t\t\t\tfragment = this.clearSlashes(decodeURI(location.pathname + location.search));\r\n\t\t\t\t// history模式下，需要删除所有get参数\r\n\t\t\t\tfragment = fragment.replace(/\\?(.*)$/, '');\r\n\t\t\t\t// add hash part by huhao\r\n\t\t\t\tfragment = fragment + location.hash;\r\n\r\n\t\t\t\t// history模式下，需要将root部分删除\r\n\t\t\t\tfragment = this.root != '/' ? fragment.replace(this.root, '') : fragment;\r\n\t\t\t} else {\r\n\t\t\t\tvar match = window.location.href.match(/#(.*)$/);\r\n\t\t\t\tfragment = match ? match[1] : '';\r\n\t\t\t}\r\n\t\t\treturn this.clearSlashes(fragment);\r\n\t\t},\r\n\t\tclearSlashes : function (path) {\r\n\t\t\treturn path.toString().replace(/\\/$/, '').replace(/^\\//, '');\r\n\t\t},\r\n\t\t/**\r\n\t\t * 添加路由\r\n\t\t * 如果只传递一个方法，我们把它当做一个默认路由处理器,并把路由当做一个空字符串\r\n\t\t * @param {String} re      路由匹配的规则（可以是实际的路由，也可以是正则字串）\r\n\t\t * @param {Function} handler 路由的处理器\r\n\t\t * @return {Router} 单体自身，用于链式调用\r\n\t\t */\r\n\t\tadd : function (re, handler) {\r\n\t\t\tif (IX.isFn(re)) {\r\n\t\t\t\thandler = re;\r\n\t\t\t\tre = '';\r\n\t\t\t}\r\n\t\t\tthis.routes.push({re : re, handler : handler});\r\n\t\t\treturn this;\r\n\t\t},\r\n\t\t/**\r\n\t\t * 删除路由\r\n\t\t * 传递一个合法的正则表达式或者handler处理器就可以删除路由\r\n\t\t * @param  {regular|function} param 正则表达式|处理方法\r\n\t\t * @return {Router}       单体自身，用于链式调用\r\n\t\t */\r\n\t\tremove : function (param) {\r\n\t\t\tfor (var i = 0, r, l = this.routes.length; i < l, r = this.routes[i]; i++) {\r\n\t\t\t\tif (r.handler === param || r.re === param) {\r\n\t\t\t\t\tthis.routes.splice(i, 1);\r\n\t\t\t\t\treturn this;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn this;\r\n\t\t},\r\n\t\t/**\r\n\t\t * 重置Router\r\n\t\t * @return {Router} \r\n\t\t */\r\n\t\tflush : function () {\r\n\t\t\tthis.routes = [];\r\n\t\t\tthis.mode = null;\r\n\t\t\tthis.root = '/';\r\n\t\t\treturn this;\r\n\t\t},\r\n\t\t/**\r\n\t\t * 比对注册的路由\r\n\t\t * 可以使用传入的路由，也可以使用getFragment方法获取当前的路由，\r\n\t\t * 然后循环查找进行匹配\r\n\t\t * @param  {String} f 传入的路由\r\n\t\t * @return {Router}       单体自身，用于链式调用\r\n\t\t */\r\n\t\tcheck : function (f) {\r\n\t\t\tvar fragment = f || this.getFragment();\r\n\t\t\tfor (var i = 0, l = this.routes.length; i < l; i++) {\r\n\t\t\t\tvar match = fragment.match(this.routes[i].re);\r\n\t\t\t\tif (match) {\r\n\t\t\t\t\tmatch.shift();\r\n\t\t\t\t\tthis.routes[i].handler.apply({}, match);\r\n\t\t\t\t\treturn this;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn this;\r\n\t\t},\r\n\t\t/**\r\n\t\t * 监控变化\r\n\t\t * 我们不需要手动的不停运行check方法，我们需要一个地址栏发生变化时，通知我们的逻辑。\r\n\t\t * 这种变化包括触发浏览器的返回、前进按钮。\r\n\t\t * History API中的popstate事件，他是URL发生变化时执行的回调。但是一些浏览器在页面加载的时候不会触发这个事件。\r\n\t\t * 同时，在mode被设定为hash的时候，我们也要执行监控，所以可以采用setInterval来轮询监控状态\r\n\t\t * @return {Router}       单体自身，用于链式调用\r\n\t\t */\r\n\t\tlisten : function () {\r\n\t\t\tvar self = this;\r\n\t\t\t// 我们需要保存一个当前的URL用于比较\r\n\t\t\tvar current = self.getFragment();\r\n\t\t\tvar fn = function () {\r\n\t\t\t\tif (current !== self.getFragment()) {\r\n\t\t\t\t\tcurrent = self.getFragment();\r\n\t\t\t\t\tself.check(current);\r\n\t\t\t\t}\r\n\t\t\t};\r\n\t\t\tclearInterval(this.interval);\r\n\t\t\tthis.interval = setInterval(fn, 50);\r\n\t\t\treturn this;\r\n\t\t},\r\n\t\t/**\r\n\t\t * 改变路由（URL）\r\n\t\t * @param  {String} path 路由路径\r\n\t\t * @return {Router}       单体自身，用于链式调用\r\n\t\t */\r\n\t\tnavigate : function (path) {\r\n\t\t\tpath = path || '';\r\n\t\t\tif (this.mode == 'history') {\r\n\t\t\t\t// history.pushState(null, null, this.root + this.clearSlashes(path));\r\n\t\t\t\thistory.pushState(null, null, this.root + \"#\" + this.clearSlashes(path));\r\n\t\t\t} else {\r\n\t\t\t\twindow.location.href.match(/#(.*)$/);\r\n\t\t\t\twindow.location.href = window.location.href.replace(/#(.*)$/, '') + '#' + path;\r\n\t\t\t}\r\n\t\t\treturn this;\r\n\t\t}\r\n\t};\r\n\tIX.ns('Hualala');\r\n\tHualala.Router = Router;\r\n})(jQuery, window);;/* 模糊拼音匹配算法\r\n首次使用:\r\nvar p = new Pymatch([{id:1,name:\"张三\",py:\"zhang;san\"},{id:2,name:\"李四\",py:\"li;si\"},{id:5,name:\"张JohnSmith李Mary四\",py:\"zhang;li;si\"},{id:8,name:\"查理\",py:\"cha,zha;li\"}])\r\n多音字的不同拼音用','分隔，如前面的\"cha,zha\"\r\n直接匹配:\r\np.match(\"zs\")相当于p.clear();p.input(\"zs\");return p.get_match()\r\n当用户开始输入:\r\np.input('z')\r\np.input('h')\r\np.input('an')\r\np.input('gsa')\r\np.input('n')\r\np.input(\"李四\")\r\n当用户回退:\r\np.back(1) // 回到输入了\"zhangsan李\"的状态\r\np.back(3) // 回到输入了\"zhangs\"的状态\r\n清空所有输入:\r\np.clear()\r\n当用户的联系人列表变化时(会自动清空所有输入):\r\np.setNames([{name:\"张三\",py:\"zhang;san\"},{name:\"李四\",py:\"li;si\"},{name:\"张JohnSmith李Mary四\",py:\"zhang;li;si\"},{name:\"王二\",py:\"wang;er\"}])\r\n\r\np的内部数据结构\r\nrnames:[{id:1,...}, {id:2,...}, {id:5,...}, {id:8,...}, {id:9,...}], // ===原始的setNames设定的names\r\nnames:[[\"张三\",[\"zhang\"],[\"san\"]],[\"李四\",[\"li\"],[\"si\"]],[\"王三表\",[\"wang\"],[\"san\"],[\"biao\"]],[[\"张月五\"],[\"zhang\"],[\"yue\"],[\"wu\"]],[\"张;\", [\"zhang\"], [\"mary\"]],[\"查理\",[\"cha\",\"zha\"],[\"li\"]]],\r\npyidx:{\r\nz:[0,0,3,0,4,0], // 下标0,2,4,6,...表示z出现的名字在names中的位置\r\ns:[0,1,1,1,2,1],\r\n'ln':[1,0],\r\nw:[2,0,3,2],\r\nb:[2,2],\r\ny:[3,1],\r\nm:[4,1]\r\n}\r\nidx:{\r\n张:[0,0,3,0,4,0],\r\n三:[0,1,2,1],\r\n李:[1,0],\r\n四:[1,1],\r\n王:[2,0],\r\n表:[2,2],\r\n月:[3,1],\r\n五:[3,2]\r\n}\r\n*/\r\nvar Pymatch=(function(){\r\n  function constructor(name2pys) { this.setNames(name2pys); }\r\n\r\n  var simpy = { 'l': 'ln', 'n': 'ln' };\r\n  var W_hzmatch = 1.2, // 汉字整字匹配权重\r\n      W_first_exactly_match = 0.3, // 首字母精确匹配权重\r\n      W_other_match = 1 - W_first_exactly_match, // 其它字母匹配权重\r\n      W_fuzzy_match = 0.0, // 首字母模糊匹配权重\r\n      W_zcs_match_zhchsh = 0.1; // 输入的zcs匹配拼音的zhchsh权重\r\n\r\n  // 检查a,b是否模糊匹配\r\n  function is_sim(a, b) {\r\n    var sa=simpy[a];\r\n    if(sa) {\r\n      var sb = simpy[b];\r\n      return sb && sa==sb;\r\n    }\r\n    return false;\r\n  }\r\n\r\n  function getAlt(py) {\r\n    var c1 = py.charAt(0), c2;\r\n    if(c1=='z' || c1=='c' || c1=='s') {\r\n      c2 = py.charAt(1);\r\n      return c1 + (c2 == 'h'? py.substr(2) : 'h' + py.substr(1));\r\n    }\r\n    var sc = simpy[c1];\r\n    if(!sc) return false;\r\n    c2 = sc.charAt(0);\r\n    return (c2 == c1? sc.charAt(1): c2) + py.substr(1);\r\n  }\r\n\r\n  function split2(s, pinyin, cache) {\r\n    var n=s.length, a=[];\r\n    var t = s.charAt(0);\r\n    if(t<'a' || t>'z') {\r\n      if(n<=1)\r\n        a = [[t]];\r\n      else {\r\n        var r = s.substr(1);\r\n        var b = cache[r];\r\n        if(b==undefined)\r\n          b = split2(r, pinyin, cache);\r\n        if(b) {\r\n          if(b.length <= 1) b = b[0];\r\n          a = [[t].concat(b)];\r\n        }\r\n      }\r\n    }\r\n    else {\r\n      for(var k=1; k<=n; ++k) {\r\n        t = s.substr(0, k);\r\n        if(!pinyin[t])\r\n          break;\r\n        if(k<n) {\r\n          var r = s.substr(k);\r\n          var b = cache[r];\r\n          if(b==undefined)\r\n            b = split2(r, pinyin, cache);\r\n          if(!b) continue;\r\n          if(b.length <= 1) b = b[0];\r\n          a.unshift([t].concat(b));\r\n        }\r\n        else\r\n          a.unshift([t]);\r\n      }\r\n    }\r\n    if(a.length <= 0)\r\n      a = false;\r\n    cache[s] = a;\r\n    return a;\r\n  }\r\n\r\n  /* 检查拼音前缀是否和多音字的某个发音匹配\r\n   pyprefix-拼音前缀\r\n   pys-数组,每个元素是多音字的一个拼音\r\n   isHz-true表示处理汉字模糊匹配, false不处理\r\n   返回: false-不匹配, 浮点数-匹配度\r\n   */\r\n  function pymatch(pyprefix, pys, isHz) {\r\n    var n = pys.length, i, k = pyprefix.length;\r\n    for(i=0; i<n; ++i) {\r\n      var py = pys[i];\r\n      if(py.substr(0,k)==pyprefix) {\r\n        var v = py.length-1;\r\n        return v<=0? W_first_exactly_match: (W_first_exactly_match+W_other_match*(k-1)/v);\r\n      }\r\n    }\r\n\r\n    if(isHz) {\r\n      var alt = getAlt(pyprefix);\r\n      if(!alt) return false;\r\n      k = alt.length;\r\n      for(i=0; i<n; ++i) {\r\n        var py = pys[i];\r\n        if(py.substr(0,k)==alt) {\r\n          var v = py.length-1, m=W_fuzzy_match;\r\n          var c1 = py.charAt(0);\r\n          if(c1=='z'||c1=='c'||c1=='s') {\r\n            m += W_zcs_match_zhchsh;\r\n            var c2 = py.charAt(1);\r\n            if(c2 == 'h') {\r\n              k -= 1;\r\n              v -= 1;\r\n            }\r\n          }\r\n          if(v<=0)\r\n            return m;\r\n          return m+W_other_match*(k-1)/v;\r\n        }\r\n      }\r\n    }\r\n    return false;\r\n  }\r\n\r\n  /*\r\n   pattern: split后的结果\r\n   name: 数组, [0]是汉字名字, 从[1]开始是每个字的拼音数组(里面的元素是多音字的每个发音)\r\n   i: 开始匹配的位置\r\n   e: 结束匹配的位置(不含)\r\n   inplace: false-一直向前找, true-就地匹配\r\n   返回: false表示不匹配, [匹配位置, 匹配数, 匹配权重]\r\n   */\r\n  function pmatch(pattern, name, i, e, inplace) {\r\n    if(!pattern) return false;\r\n    var r, k=pattern.length, v=0;\r\n    for(; v<k; ++v) {\r\n      if(typeof(pattern[v])!=\"string\")\r\n        break;\r\n    }\r\n    while(i+v<=e) {\r\n      var q = i, j=0, m=0.0;\r\n      for(; j<v; ++j, ++q) {\r\n        var p = pattern[j];\r\n        var c = p.charAt(0);\r\n        if(c>='a'&&c<='z') {\r\n          r = pymatch(p, name[q], (name[0].charAt(q-1)!=';'));\r\n          if(r===false) break;\r\n          m += r;\r\n        }\r\n        else if(c == name[0].charAt(q-1))\r\n          m += W_hzmatch;\r\n        else\r\n          break;\r\n      }\r\n      if(j>=v) {\r\n        if(j>=k) return [i, v, m];\r\n        for(; j<k; ++j) {\r\n          var p = pattern[j];\r\n          r = pmatch(p, name, q, e, true);\r\n          if(r)\r\n            return [i, v+r[1], m+r[2]];\r\n        }\r\n      }\r\n      if(inplace) return false;\r\n      ++i;\r\n    }\r\n    return false;\r\n  }\r\n\r\n  function match2(s, name, i, e) {\r\n    if(s.length<=0) return false;\r\n\r\n    if(i==undefined)\r\n      i = 1;\r\n    if(e==undefined)\r\n      e = name.length;\r\n    pinyin = {};\r\n    for(var j=i; j<e; ++j) {\r\n      var pys = name[j];\r\n      var k = pys.length, m;\r\n      var isHz = (name[0].charAt(j-1)!=';');\r\n      for(m=0; m<k; ++m) {\r\n        var py = pys[m];\r\n        var n = py.length, v;\r\n        for(v=1; v<=n; ++v)\r\n          pinyin[py.substr(0,v)] = true;\r\n        if(isHz) {\r\n          var alt = getAlt(py);\r\n          if(!alt) continue;\r\n          n = alt.length;\r\n          for(v=1; v<=n; ++v)\r\n            pinyin[alt.substr(0,v)] = true;\r\n        }\r\n      }\r\n    }\r\n\r\n    var p = split2(s, pinyin, {});\r\n    return pmatch(p, name, i, e, false);\r\n  }\r\n\r\n  // 匹配堆栈元素[idx, 匹配位置, 匹配数, 匹配权重]\r\n  function input_c() {\r\n    var k=this.stkp - 1;\r\n    var i, n, a, b=[], t, ai;\r\n    if(k<=0) {\r\n      var c = this.instr[k];\r\n      var is_py = (c>='a' && c<='z');\r\n      if(is_py) {\r\n        var sc = simpy[c];\r\n        if(!sc) sc = c;\r\n        a = this.pyidx[sc];\r\n      }\r\n      else\r\n        a = this.idx[c];\r\n      if(a) {\r\n        n = a.length;\r\n        for(i=0; i<n; i+=2) {\r\n          var x = a[i], j=a[i+1], name=this.names[x];\r\n          if(is_py) {\r\n            var tpys = name[j+1];\r\n            var tn = tpys.length, ti;\r\n            var m = W_fuzzy_match; // 默认模糊匹配\r\n            for(ti=0; ti<tn; ++ti) {\r\n              var tpy = tpys[ti], d = tpy.charAt(0);\r\n              if(c == d) {\r\n                if(name[0].charAt(j)!=';' && (c=='z'||c=='c'||c=='s') && tpy.charAt(1)=='h')\r\n                  m = W_zcs_match_zhchsh; // zcs匹配zh/ch/sh\r\n                else\r\n                  m = W_first_exactly_match; // 首字母精确匹配\r\n                break;\r\n              }\r\n              if(is_sim(c, d))\r\n                break;\r\n            }\r\n            if(ti>=tn) throw \"Pymatch internal data error\";\r\n            t = [x, j+1, 1, m];\r\n          }\r\n          else\r\n            t = [x, j+1, 1, W_hzmatch]; // 汉字整字匹配\r\n          b.push(t);\r\n        }\r\n      }\r\n    }\r\n    else {\r\n      a = this.stack[k-1];\r\n      n = a.length;\r\n      var s = this.instr.substr(0,k+1);\r\n      for(i=0; i<n; ++i) {\r\n        ai = a[i];\r\n        var x = ai[0];\r\n        t = match2(s, this.names[x], ai[1]);\r\n        if(t)\r\n          b.push([x].concat(t));\r\n      }\r\n    }\r\n    this.stack[k] = b;\r\n  }\r\n\r\n  constructor.prototype = {\r\n    setNames: function(name2pys) {\r\n      this.rnames = name2pys;\r\n      this.names = [];\r\n      this.pyidx = {};\r\n      this.idx = {};\r\n      this.stack = [];\r\n      this.instr = \"\";\r\n      this.stkp = 0;\r\n\r\n      var i, n = name2pys ? name2pys.length : 0;\r\n      for(i=0; i<n; ++i) {\r\n        var name2py = name2pys[i];\r\n        var hz = name2py.name;\r\n        var pys = name2py.py;\r\n        pys = ((!pys || pys==\"\") ? []: pys.split(';'));\r\n        var k=hz.length, j, m, nhz=\"\", t=0, x=i;\r\n        var searchLetter=true; // 0-正在寻找连续英文串的开始(大写或小写字母), 1-正在寻找结束\r\n        for(j=0; j<k; ++j) {\r\n          var c = hz.charAt(j);\r\n          if(searchLetter) {\r\n            if((c>='A' && c<='Z') || (c>='a'&&c<='z')) {\r\n              searchLetter = false;\r\n              m = j;\r\n              continue;\r\n            }\r\n          }\r\n          else {\r\n            if(c>='a' && c<='z') continue;\r\n            nhz += ';';\r\n            pys.splice(t, 0, hz.substr(m, j-m).toLowerCase());\r\n            ++t;\r\n            if(c>='A' && c<='Z') {\r\n              m = j;\r\n              continue;\r\n            }\r\n            searchLetter = true;\r\n          }\r\n          if(nhz.indexOf(c) < 0) {\r\n            var a = this.idx[c];\r\n            if(a)\r\n              a.push(x, t);\r\n            else\r\n              this.idx[c] = [x, t];\r\n          }\r\n          nhz += c;\r\n          ++t;\r\n        }\r\n        if(!searchLetter) {\r\n          nhz += ';';\r\n          pys.splice(t, 0, hz.substr(m).toLowerCase());\r\n          ++t;\r\n        }\r\n        var handledIdx={};\r\n        for(j=0; j<t; ++j) {\r\n          if(!pys[j])\r\n          \tcontinue;\r\n\t\t\tpys[j] = pys[j].split(',');\r\n          var b = pys[j];\r\n          var bn = b.length, bi;\r\n          for(bi=0; bi<bn; ++bi) {\r\n            var c = b[bi].charAt(0);\r\n            var sc = simpy[c];\r\n            if(sc) c = sc;\r\n            if(handledIdx[c]) continue;\r\n            var a = this.pyidx[c];\r\n            if(a)\r\n              a.push(x, j);\r\n            else\r\n              this.pyidx[c] = [x, j];\r\n            handledIdx[c] = true;\r\n          }\r\n        }\r\n        pys.unshift(nhz);\r\n        this.names.push(pys);\r\n      }\r\n    },\r\n\r\n    input: function(s) {\r\n      var i, n=s.length;\r\n      for(i=0; i<n; ++i) {\r\n        var c = s.charAt(i);\r\n        if(c==';') continue;\r\n        var j = this.stkp;\r\n        this.stkp = j+1;\r\n        if(j>=this.instr.length || c != this.instr.charAt(j)) {\r\n          if(c>='A' && c<='Z') c = c.toLowerCase();\r\n          this.instr = this.instr.substr(0, j) + c;\r\n          input_c.apply(this);\r\n        }\r\n      }\r\n    },\r\n\r\n    back: function(n) {\r\n      var k = this.stkp;\r\n      if(n<=k)\r\n        this.stkp = k - n;\r\n    },\r\n    \r\n    clear: function() { this.stkp = 0; },\r\n    \r\n    match: function(s) {\r\n      this.clear();\r\n      this.input(s);\r\n      return this.get_match();\r\n    },\r\n    \r\n    get_input: function() {\r\n      return this.instr.substr(0,this.stkp);\r\n    },\r\n    \r\n    get_match: function() {\r\n      var k = this.stkp;\r\n      if(k<=0) return [];\r\n      var a = this.stack[k-1];\r\n      var n = a.length, b=[];\r\n      for(var i=0; i<n; ++i) {\r\n        var ai = a[i], x = ai[0], e = this.names[x][0].length;\r\n        // 第一个字母匹配的位置加权系数1.0, 出现的越早越好\r\n        b.push([this.rnames[x], (ai[3] + (e - ai[1] + 1)/e)/e]);\r\n      }\r\n      b.sort(function(x,y){return y[1]-x[1];});\r\n      return b;\r\n    }\r\n  };\r\n\r\n  return constructor;\r\n}());\r\n;// Hualala.Matcher\r\n(function(){\r\n\tIX.ns(\"Hualala\");\r\n\t\r\n\t//支持的语言种类\r\n\tvar langs = \"zh-cn,zh-tw,en,\";\r\n\t/*\r\n\t\tvar matcher = new Matcher();\r\n\t\tmatcher.match\r\n\t\t\tparams : key  匹配条件\r\n\t\t\t\t\t callback 回调 参数 infolist[{id,name,py}......]\r\n\t\t\t\t\t lang 语言种类 但不会改变config.lang\r\n\t\tmatcher.refresh\t刷新匹配文件\r\n\t*/\r\n\tHualala.Matcher = function(cfg){\r\n\t\tvar config = $.extend(true, {\r\n\t\t\tlang : \"zh-cn\"\r\n\t\t}, cfg);\r\n\r\n\t\tvar _matcher = new Pymatch([]);\r\n\r\n\t\tvar _loadMatchConfig = function(lang, callback){\r\n\t\t\t//IX.Net.loadFile(\"../\" + lang + \".json\", function(rspTxt){});\r\n\t\t\tcallback && callback();\r\n\t\t};\r\n\r\n\t\tvar _match = function(key,data, callback){\r\n\t\t\t_matcher.setNames(data);\r\n\t\t\tcallback.call(null,_matcher.match(key));\t\r\n\t\t};\r\n\t\t_loadMatchConfig(config.lang);\r\n\r\n\t\treturn {\r\n\t\t\tmatch: function(key, data, callback, lang){\r\n\t\t\t\tif(lang && langs.indexOf(lang + \",\") > -1){\r\n\t\t\t\t\t_loadMatchConfig(lang, function(){\r\n\t\t\t\t\t\t_match(key,data, callback);\r\n\t\t\t\t\t});\r\n\t\t\t\t}else{\r\n\t\t\t\t\t_match(key, data, callback);\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\trefresh:function(lang){\r\n\t\t\t\tlang = lang && langs.indexOf(lang + \",\") > -1 ? lang : config.lang;\r\n\t\t\t\t_loadMatchConfig(config.lang);\r\n\t\t\t}\r\n\t\t};\r\n\t};\r\n})();\r\n"]}