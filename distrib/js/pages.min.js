/*! Hualala-Merchant-Management 2014-08-26 */

!function(a){IX.ns("Hualala.Entry");var b=[{name:"group_name",type:"text",palceholder:"请输入集团主账号",clz:"form-control input-md",key:"groupName",field:{validators:{notEmpty:{message:"集团主账号不能为空"}}}},{name:"login_pwd",type:"passowrd",palceholder:"请输入登陆密码",clz:"form-control input-md",key:"password",field:{validators:{notEmpty:{message:"密码不能为空"},callback:{callback:function(a){var b=6,c=32;return a.length<6||a.length>32?{valid:!1,message:"密码长度必须在"+b+"位到"+c+"位之间"}:{valid:!0}}}}}},{name:"login_auth",type:"text",palceholder:"请输入验证码",clz:"form-control input-md",key:"authCode",field:{validators:{notEmpty:{message:"验证码不能为空"}}}}],c=function(b){var c=a($XP(b,"container")),d=c.find(".auth-img"),e=c.find(".progress"),f=Hualala.Global.genAuthCode,g=function(a){e[a?"removeClass":"addClass"]("hidden"),d[a?"addClass":"removeClass"]("hidden")},h=function(a){g(!0),f({},function(b){var c=null;"000"==$XP(b,"resultcode")?c=$XP(b,"data.code",null):(Hualala.UI.TopTip({type:"warning",msg:"获取验证码失败"}),g()),a(c)})},i=function(a){return a?(d.attr("src",a),void setTimeout(function(){g()},500)):void setTimeout(function(){h(i)},1e3)},j=function(){c.delegate(".auth-img","click",function(b){d=a(b.target),h(i)})},k=function(){h(i),j()};return k(),{genCode:function(){h(i)}}};Hualala.Entry.initLogin=function(d){if(!d||0==d.length)return void console.err("Login Form init failed!");var e=Hualala.Global.loginCallServer,f={},g=d.find("#login_sub"),h=g.parent().find(".progress"),i=d.find(".ix-authcode"),j=(new c({container:i}),function(a){h[a?"removeClass":"addClass"]("hidden"),g[a?"addClass":"removeClass"]("hidden")}),k=function(){var a={};return _.each(b,function(b){var c=$XP(b,"name"),d=$XP(b,"field");a[c]=d}),a},l=function(){var c={};return _.each(b,function(b){var e=$XP(b,"name"),f=$XP(b,"key"),g=a("[name="+e+"]",d).val();c[f]=g}),c},m=function(){f=k(),d.bootstrapValidator({trigger:"blur",fields:f}).on("error.field.bv",function(b){{var c=a(b.target);c.data("bootstrapValidator")}j()}).on("success.form.bv",function(b){b.preventDefault();var c=a(b.target),d=(c.data("bootstrapValidator"),l());console.info("login params : "),console.info(d),e(d,function(a){0==a.resultcode?document.location.href=Hualala.PageRoute.createPath("main"):Hualala.UI.TopTip({type:"danger",msg:$XP(a,"resultmsg")}),j()})}),d.delegate("#login_sub","click",function(){j(!0);var a=d.data("bootstrapValidator");a.validate()})};m()}}(jQuery,window),function(){IX.ns("Hualala.Shop");var a=(Hualala.UI.PopoverMsgTip,Hualala.UI.TopTip),b=Stapes.subclass({constructor:function(){this.origCities=[],this.origAreas=[],this.origShops=[],this.isReady=!1,this.callServer=Hualala.Global.getShopQuerySchema}});b.proto({init:function(b,c){var d=this;d.isReady=!1,d.callServer(b,function(b){"000"==b.resultcode?(d.origCities=$XP(b,"data.cities",[]),d.origAreas=$XP(b,"data.areas",[]),d.origShops=$XP(b,"data.shops",[]),d.initDataModel(),d.isReady=!0):(a({msg:$XP(b,"resultmsg",""),type:"danger"}),d.isReady=!1),c(d)})},initDataModel:function(){var a=this,b=new IX.IListManager,c=new IX.IListManager,d=new IX.IListManager;_.each(this.origCities,function(c){var d=$XP(c,"cityID"),e=_.filter(a.origShops,function(a){return $XP(a,"cityID")==d}),f=_.filter(a.origAreas,function(a){return $XP(a,"cityID")==d});e=_.pluck(e,"shopID"),f=_.pluck(f,"areaID"),b.register(d,IX.inherit(c,{shopLst:e,areaLst:f}))}),_.each(this.origAreas,function(b){var d=$XP(b,"areaID"),e=_.filter(a.origShops,function(a){return $XP(a,"areaID")==d});e=_.pluck(e,"areaID"),c.register(d,IX.inherit(b,{shopLst:e}))}),_.each(this.origShops,function(a){var b=$XP(a,"shopID");d.register(b,a)}),a.set({ds_city:b,ds_area:c,ds_shop:d})},hasReady:function(){return this.isReady},getCities:function(a){a=IX.isEmpty(a)?null:IX.isString(a)?[a]:a;var b=this.get("ds_city"),c=null;return c=b[a?"getByKeys":"getAll"](a)},getShops:function(a){a=IX.isEmpty(a)?null:IX.isString(a)?[a]:a;var b=this.get("ds_shop"),c=null;return c=b[a?"getByKeys":"getAll"](a)},getAreas:function(a){a=IX.isEmpty(a)?null:IX.isString(a)?[a]:a;var b=this.get("ds_area"),c=null;return c=b[a?"getByKeys":"getAll"](a)},destroy:function(){this.origCities=[],this.origAreas=[],this.origShops=[],this.isReady=!1}}),Hualala.Shop.QueryModel=b}(jQuery,window),function(a){IX.ns("Hualala.Shop");var b=(Hualala.UI.PopoverMsgTip,Hualala.UI.TopTip,Stapes.subclass({constructor:function(){this.isReady=!1,this.needShopCreate=!1,this.$container=null,this.$queryBox=null,this.$filter=null,this.$query=null,this.loadTemplates()}}));b.proto({init:function(a){if(this.model=$XP(a,"model",null),this.needShopCreate=$XP(a,"needShopCreate",!1),this.$container=$XP(a,"container",null),!this.model||!this.$container||0==this.$container.length)throw"Init Query View Failed!!";this.renderLayout(),this.bindEvent(),this.isReady=!0,this.emit("filter",this.getFilterParams())},hasReady:function(){return this.isReady},loadTemplates:function(){var a=Handlebars.compile(Hualala.TplLib.get("tpl_shop_query")),b=Handlebars.compile(Hualala.TplLib.get("tpl_shop_filter"));Handlebars.registerPartial("shopCity",Hualala.TplLib.get("tpl_shop_filter")),Handlebars.registerPartial("toggle",Hualala.TplLib.get("tpl_site_navbarToggle")),this.set({queryTpl:a,filterTpl:b})},mapChosenShopData:function(){var a=this,b=this.model.getCities(),c=[];return _.each(b,function(b){var d=$XP(b,"cityName",""),e=($XP(b,"cityID",""),$XP(b,"shopLst")),f=a.model.getShops(e);c.push({name:d,items:_.map(f,function(a){return{code:$XP(a,"shopID"),name:$XP(a,"shopName")}})})}),c},mapRenderLayoutData:function(){var a=this.model.getCities(),b=(this.model.getShops(),this.mapFilterData({type:"city",name:"城市：",focus:0,data:a})),c=this.mapChosenShopData();return{clz:"",shopCity:b,toggle:{target:"#shop_query"},needShopCreate:this.needShopCreate,optGrp:c}},renderLayout:function(){var b=this,c=b.get("queryTpl"),d=(b.model,b.mapRenderLayoutData()),e=c(d);this.$queryBox=a(e),this.$container.prepend(this.$queryBox),this.$filter=this.$queryBox.find(".filter"),this.$query=this.$queryBox.find(".query")},mapFilterData:function(a){var b=$XP(a,"data",[]),c=$XP(a,"type"),d=$XP(a,"name"),e=$XP(a,"focus",0),f={type:c,name:d,items:[]},g=0,h={focusClz:"",type:c,code:-1,name:"全部",count:0};return f.items=_.map(b,function(a){var b=c+"Count",d=parseInt($XP(a,b,0));return g+=d,{focusClz:"",type:c,code:$XP(a,c+"ID",""),name:$XP(a,c+"Name",""),count:d}}),h=IX.inherit(h,{count:g,focusClz:""}),f.items.unshift(h),f.items[e].focusClz="disabled",f},renderAreaFilter:function(a){var b=this,c=b.get("filterTpl"),d=(b.model,b.mapFilterData({type:"area",name:"区域：",focus:0,data:a})),e=c(d);this.$filter.find(".area").remove(),this.$filter.append(e)},bindEvent:function(){var b=this;this.$filter.on("click",".btn-link[data-city]",function(){var c=a(this),d=c.attr("data-city"),e=null;-1!=d?(e=b.model.getCities(d),e=$XP(e[0],"areaLst",null),e=b.model.getAreas(e),b.renderAreaFilter(e)):b.$filter.find(".area").remove(),b.$filter.find(".btn-link[data-city]").removeClass("disabled"),c.addClass("disabled"),b.emit("filter",b.getFilterParams())}),this.$filter.on("click",".btn-link[data-area]",function(){{var c=a(this);c.attr("data-area")}b.$filter.find(".btn-link[data-area]").removeClass("disabled"),c.addClass("disabled"),b.emit("filter",b.getFilterParams())}),this.$query.on("click",".create-shop",function(){a(this);document.location.href=Hualala.PageRoute.createPath("shopCreate")})},destroy:function(){this.isReady=!1,this.needShopCreate=!1,this.$container.find(".shop-query").remove(),this.$queryBox=null,this.$filter=null,this.$query=null},getFilterParams:function(){var a=this,b=a.$filter.find(".btn-link.disabled"),c=b.filter("[data-city]").attr("data-city"),d=b.filter("[data-area]").attr("data-area");return c=c&&-1!=c?c:"",d=d&&-1!=d?d:"",{cityID:c,areaID:d,keywordLst:""}},getQueryParams:function(){return{}}}),Hualala.Shop.QueryView=b}(jQuery,window),function(){IX.ns("Hualala.Shop");var a=(Hualala.UI.PopoverMsgTip,Hualala.UI.TopTip,Hualala.Shop.QueryModel),b=Hualala.Shop.QueryView,c=Stapes.subclass({constructor:function(c){this.set({sessionData:Hualala.getSessionData()}),this.container=$XP(c,"container",null),this.needShopCreate=$XP(c,"needShopCreate",!1),this.resultController=$XP(c,"resultController",null),this.model=new a,this.view=new b,this.init()}});c.proto({init:function(){var a=this;a.bindEvent(),a.model.emit("load",function(){if(!a.model.hasReady())throw"Shop Query Init Failed!!";a.view.emit("init")})},bindEvent:function(){this.on({reload:function(){var a=this;a.model.distory(),a.view.distory(),a.init()},query:function(a){var b=this;console.info("query params:"),console.info(a),b.resultController&&b.resultController.emit("load",IX.inherit(a,{pageNo:1,pageSize:15}))}},this),this.model.on({load:function(a){var b=this,c=$XP(b.get("sessionData"),"user",{});b.model.init(c,a)}},this),this.view.on({init:function(){var a=this;a.view.init({model:a.model,needShopCreate:a.needShopCreate,container:a.container})},filter:function(a){var b=this;b.emit("query",a)},query:function(a){var b=this;b.emit("query",a)}},this)}}),Hualala.Shop.QueryController=c}(jQuery,window),function(){IX.ns("Hualala.Shop");var a=(Hualala.UI.PopoverMsgTip,Hualala.UI.TopTip),b=Stapes.subclass({constructor:function(a){if(this.callServer=$XP(a,"callServer",null),!this.callServer)throw"callServer is empty!"}});b.proto({init:function(a){this.set({pageCount:0,totalSize:0,pageNo:$XP(a,"Page.pageNo",1),pageSize:$XP(a,"Page.pageSize",15),cityID:$XP(a,"cityID",""),areaID:$XP(a,"areaID",""),keywordLst:$XP(a,"keywordLst",""),ds_shop:new IX.IListManager,ds_page:new IX.IListManager})},updatePagerParams:function(a){var b=this,c="pageCount,totalSize,pageNo,pageSize,cityID,areaID,keywordLst";_.each(a,function(a,d){c.indexOf(d)>-1&&b.set(d,a)})},getPagerParams:function(){return{Page:{pageNo:this.get("pageNo"),pageSize:this.get("pageSize")},cityID:this.get("cityID"),areaID:this.get("areaID"),keywordLst:this.get("keywordLst")}},updateDataStore:function(a,b){var d=this,e=d.get("ds_shop"),f=d.get("ds_page"),g=_.map(a,function(a){var b=$XP(a,"shopID"),d=new c(a);return e.register(b,d),b});f.register(b,g)},resetDataStore:function(){var a=this,b=a.get("ds_shop"),c=a.get("ds_page");b.clear(),c.clear()},load:function(b,c){var d=this;d.updatePagerParams(b),d.callServer(d.getPagerParams(),function(b){"000"==b.resultcode?(d.updateDataStore($XP(b,"data.records",[]),$XP(b,"data.pageNo")),d.updatePagerParams($XP(b,"data",{}))):a({msg:$XP(b,"resultmsg",""),type:"danger"}),c(d)})},getShops:function(a){var b=this,c=b.get("ds_shop"),d=b.get("ds_page"),e=_.map(c.getByKeys(d.get(a)),function(a){return a.getAll()});return console.info("pageData:"),console.info(e),e},getShopModelByShopID:function(a){var b=this,c=b.get("ds_shop");return c.get(a)},updateShopStatus:function(a,b,c){var d=this,e=d.get("ds_shop"),f=e.get(a);f.emit("switchShopStatus",{status:b,failFn:c})},updateShopBusinessStatus:function(a,b){var c=this,d=c.get("ds_shop"),e=$XP(a,"shopID"),f=d.get(e);f.emit("switchBusinessStatus",{name:$XP(a,"name"),id:$XP(a,"id"),status:$XP(a,"state"),failFn:b})}}),Hualala.Shop.CardListModel=b;var c=Stapes.subclass({constructor:function(a){this.switchShopStatusCallServer=Hualala.Global.switchShopStatus,this.switchShopBusinessStatusCallServer=Hualala.Global.switchShopServiceFeatureStatus,this.set(a),this.bindEvent()}});c.proto({switchShopStatus:function(b,c){var d=this,e=d.get("shopID");d.set("status",b),console.info("Switch Shop ["+d.get("shopID")+"] status "+b),this.switchShopStatusCallServer({shopID:e,status:b},function(f){"000"!==f.resultcode?(a({msg:$XP(f,"resultmsg",""),type:"danger"}),d.set("status",b?0:1),c(e)):a({msg:"切换成功!",type:"success"})})},switchShopBusinessStatus:function(b){var c=this,d=c.get("shopID"),e=$XF(b,"failFn"),f=$XP(b,"name"),g=$XP(b,"id"),h=$XP(b,"status"),i=function(a,b){var d=c.get("serviceFeatures").split(",");1==b?d.push(a):d=_.filter(d,function(b){return b!==a}),c.set("serviceFeatures",d.join(","))};i(f,h),console.info("Switch Shop ["+c.get("shopID")+"] ServiceFeature: "+c.get("serviceFeatures")),this.switchShopBusinessStatusCallServer({shopID:d,serviceFeature:f,operation:h},function(b){"000"!==b.resultcode?(a({msg:$XP(b,"resultmsg",""),type:"danger"}),i(f,h?0:1),e({shopID:d,id:g})):a({msg:"切换成功!",type:"success"})})},bindEvent:function(){var b=this;this.on({switchShopStatus:function(a){var b=$XP(a,"status"),c=$XF(a,"failFn");this.switchShopStatus(b,c)},switchBusinessStatus:function(a){this.switchShopBusinessStatus(a)},setServiceParams:function(c){var d=$XF(c,"callServer"),e=$XP(c,"params",{}),f=$XP(c,"serviceID"),g=b.get("shopID"),h=$XF(c,"failFn"),i=$XF(c,"successFn");d(IX.inherit(e,{shopID:g,strType:f}),function(c){if("000"!==c.resultcode)a({msg:$XP(c,"resultmsg",""),type:"danger"}),h();else{var d={};d[f]=e,b.set("revParamJson",IX.inherit(b.get("revParamJson"),d)),i(),a({msg:"配置成功!",type:"success"})}})}})}})}(jQuery,window),function(a){IX.ns("Hualala.Shop");var b=(Hualala.UI.PopoverMsgTip,Hualala.UI.TopTip,Stapes.subclass({constructor:function(){this.$container=null,this.$resultBox=null,this.$list=null,this.$pager=null,this.loadTemplates()}}));b.proto({init:function(a){if(this.$container=$XP(a,"container",null),this.model=$XP(a,"model",null),!this.$container||!this.model)throw"CardList View Init Failed!";this.initLayout()},initLayout:function(){var a=this.get("layoutTpl"),b=a();this.$container.append(b),this.$resultBox=this.$container.find(".shop-list"),this.$list=this.$container.find(".shop-list-body"),this.$pager=this.$container.find(".page-selection"),this.initPager(),this.bindEvent()},initPager:function(a){var b={total:0,page:1,maxVisible:10,leaps:!0};this.$pager.IXPager(IX.inherit(b,a))},bindEvent:function(){var b=this;b.$list.tooltip({selector:"[title]"}),b.$list.on("click",".btn[data-href]",function(){var b=a(this),c=b.attr("data-href");document.location.href=c}),b.$pager.on("page",function(a,c){var d=b.model.getPagerParams();d.Page.pageNo=c,b.model.emit("load",IX.inherit(d,{pageNo:$XP(d,"Page.pageNo",1),pageSize:$XP(d,"Page.pageSize",15)}))})},loadTemplates:function(){var a=Handlebars.compile(Hualala.TplLib.get("tpl_shop_list_layout")),b=Handlebars.compile(Hualala.TplLib.get("tpl_shop_list")),c=Handlebars.compile(Hualala.TplLib.get("tpl_shop_card")),d=Handlebars.compile(Hualala.TplLib.get("tpl_shop_tags"));Handlebars.registerPartial("shopTag",Hualala.TplLib.get("tpl_shop_tags")),Handlebars.registerPartial("shopCard",Hualala.TplLib.get("tpl_shop_card")),this.set({layoutTpl:a,listTpl:b,itemTpl:c,tagTpl:d})},mapRenderData:function(a){var b=function(a){return _.map(a,function(a){return{clz:"label-info",tag:a}})},c=_.map(a,function(a){var c=$XP(a,"address",""),d=Hualala.Common.strByteLength(c),e="";return e=72>d?c:Hualala.Common.substrByte(c,70)+"...",{clz:"",id:$XP(a,"shopID",""),name:$XP(a,"shopName",""),img:Hualala.Common.getSourceImage($XP(a,"imagePath",""),{width:100,height:100,quality:50}),tags:b($XP(a,"tags",[])),address:c,slugAddr:e,tel:$XP(a,"tel",""),infoHref:Hualala.PageRoute.createPath("shopInfo",[$XP(a,"shopID","")]),menuHref:Hualala.PageRoute.createPath("shopMenu",[$XP(a,"shopID","")]),checked:1==$XP(a,"status")?"checked":""}});return{shopCard:{list:c}}},initSwitcher:function(b){var c=this;c.$list.find(b).bootstrapSwitch({size:"normal",onColor:"success",offColor:"default",onText:"已开通",offText:"未开通"}),c.$list.find(b).on("switchChange.bootstrapSwitch",function(d,e){var f=a(this),g=f.attr("data-shop"),e=e?1:0;c.model.updateShopStatus(g,e,function(a){c.$list.find(b).filter("[data-shop="+a+"]").bootstrapSwitch("toggleState",!0)})})},render:function(){var a=this,b=a.model,c=b.getPagerParams(),d=$XP(c,"Page.pageNo"),e=b.getShops(d),f=a.mapRenderData(e),g=a.get("listTpl"),h=g(f);a.$list.empty(),a.$list.html(h),a.initPager({total:b.get("pageCount"),page:b.get("pageNo"),href:"javascript:void(0);"}),a.initSwitcher(":checkbox[name=switcher]")}}),Hualala.Shop.CardListView=b;var c=b.subclass({constructor:function(){this.$container=null,this.$resultBox=null,this.$list=null,this.$pager=null,this.loadTemplates()}});c.proto({bindEvent:function(){var b=this;b.$list.tooltip({selector:"[title]"}),b.$pager.on("page",function(a,c){var d=b.model.getPagerParams();d.Page.pageNo=c,b.model.emit("load",IX.inherit(d,{pageNo:$XP(d,"Page.pageNo",1),pageSize:$XP(d,"Page.pageSize",15)}))}),b.$list.on("click",".btn[data-business]",function(){var c=a(this),d=c.attr("data-shop"),e=c.attr("data-business"),f=c.attr("data-business-id");b.initBusinessModal(c,d,e,f)})},loadTemplates:function(){var a=Handlebars.compile(Hualala.TplLib.get("tpl_shop_list_layout")),b=Handlebars.compile(Hualala.TplLib.get("tpl_shop_list")),c=Handlebars.compile(Hualala.TplLib.get("tpl_shop_list_item")),d=Handlebars.compile(Hualala.TplLib.get("tpl_shop_tags"));Handlebars.registerPartial("shopTag",Hualala.TplLib.get("tpl_shop_tags")),Handlebars.registerPartial("shopItem",Hualala.TplLib.get("tpl_shop_list_item")),this.set({layoutTpl:a,listTpl:b,itemTpl:c,tagTpl:d})},getShopBusiness:function(a){var b=Hualala.TypeDef.ShopBusiness,c=new IX.IListManager,d=$XP(a,"serviceFeatures",""),e=$XP(a,"revParamJson",{}),f=null;return _.each(b,function(b){var f=($XP(b,"id"),$XP(b,"name"));switcherStatus=d.indexOf(f)>=0?1:0;var g=IX.inherit(b,$XP(e,"id"),{switcherStatus:switcherStatus,shopID:$XP(a,"shopID")});c.register(f,g)}),f=_.filter(c.getAll(),function(a){return 1==$XP(a,"businessIsSupported",!1)})},mapBusinessRenderData:function(a){var b=this,c=b.getShopBusiness(a);return _.map(c,function(a){var b=$XP(a,"name"),c="pic-"+b,d="switcher_business",e=1==$XP(a,"switcherStatus")?"checked":"";return{icon:c,label:$XP(a,"label"),switcherName:d,shopID:$XP(a,"shopID"),type:b,id:$XP(a,"id"),open:e,desc:""}})},chkHasAccountRole:function(){var a=Hualala.getSessionUser(),b=$XP(a,"role");roles=Hualala.getSessionRoles();var c=_.find(roles,function(a){var c=$XP(a,"roleType"),d=_.find(b,function(b){return $XP(a,"id")==b});return!!d&&("account"==c||"all"==c)});return!!c},mapRenderData:function(a){var b=this,c=_.map(a,function(a){return{clz:"",shopID:$XP(a,"shopID",""),shopName:$XP(a,"shopName",""),hideAccount:b.chkHasAccountRole()?"":"hidden",settleName:$XP(a,"settleName",""),switcherName:"switcher_status",shopOpen:1==$XP(a,"status")?"checked":"",business:b.mapBusinessRenderData(a)}});return{shopItem:{list:c}}},initSwitcher:function(b){var c=this;c.$list.find(b).bootstrapSwitch({size:"normal",onColor:":checkbox[name=switcher_business]"==b?"primary":"success",offColor:"default",onText:"已开通",offText:"未开通"}),c.$list.find(b).on("switchChange.bootstrapSwitch",function(d,e){var f=a(this),g=f.attr("name"),h=f.attr("data-shop"),e=e?1:0,i=f.attr("data-business"),j=f.attr("data-business-id");"switcher_status"==g?c.model.updateShopStatus(h,e,function(a){c.$list.find(b).filter("[data-shop="+a+"]").bootstrapSwitch("toggleState",!0)}):c.model.updateShopBusinessStatus({shopID:h,name:i,id:j,status:e},function(a){c.$list.find(b).filter("[data-shop="+$XP(a,"shopID")+"][data-business-id="+$XP(a,"id")+"]").bootstrapSwitch("toggleState",!0)})})},render:function(){var a=this,b=a.model,c=b.getPagerParams(),d=$XP(c,"Page.pageNo"),e=b.getShops(d),f=a.mapRenderData(e),g=a.get("listTpl"),h=g(f);a.$list.empty(),a.$list.html(h),a.initPager({total:b.get("pageCount"),page:b.get("pageNo"),href:"javascript:void(0);"}),a.initSwitcher(":checkbox[name=switcher_business]"),a.initSwitcher(":checkbox[name=switcher_status]")},initBusinessModal:function(a,b,c,d){{var e=this;new Hualala.Setting.editServiceView({triggerEl:a,serviceID:d,serviceName:c,model:e.model.getShopModelByShopID(b)})}}}),Hualala.Shop.ShopListView=c}(jQuery,window),function(){IX.ns("Hualala.Shop");var a=(Hualala.UI.PopoverMsgTip,Hualala.UI.TopTip,Hualala.Shop.ShopListModel,Hualala.Shop.ShopListView,Stapes.subclass({constructor:function(a){if(this.set({sessionData:Hualala.getSessionData()}),this.container=$XP(a,"container",null),this.view=$XP(a,"view",null),this.model=$XP(a,"model",null),!this.view||!this.model||!this.container)throw"Shop List init faild!!";this.isReady=!1,this.bindEvent()}}));a.proto({init:function(a){this.model.init(a),this.view.init({model:this.model,container:this.container}),this.isReady=!0},hasReady:function(){return this.isReady},bindEvent:function(){this.on({load:function(a){var b=this;b.hasReady()||b.init(a),b.model.emit("load",a)}},this),this.model.on({load:function(a){var b=this,c=function(){b.view.emit("render")};b.model.load(a,c)}},this),this.view.on({render:function(){var a=this;a.view.render()},reloadPager:function(a){var b=this;b.view.initPager(a)}},this)}}),Hualala.Shop.ShopListController=a}(jQuery,window),function(a){IX.ns("Hualala.Shop");var b=function(){{var b=a("#ix_wrapper > .ix-body > .container");new Hualala.Shop.QueryController({needShopCreate:!0,container:b,resultController:new Hualala.Shop.ShopListController({container:b,model:new Hualala.Shop.CardListModel({callServer:Hualala.Global.queryShop}),view:new Hualala.Shop.CardListView})})}};Hualala.Shop.HomePageInit=b;var c=function(){var b=a("#ix_wrapper > .ix-body > .container");b.html('<div class="jumbotron"><h1>这里是店铺详情管理页面</h1><p>提供查看店铺信息，编辑店铺信息</p></div>')};Hualala.Shop.BaseInfoMgrInit=c;var d=function(){var b=a("#ix_wrapper > .ix-body > .container");b.html('<div class="jumbotron"><h1>这里是店铺菜谱管理页面</h1><p>提供查看店铺菜谱信息，编辑店铺菜谱信息</p></div>')};Hualala.Shop.FoodMenuMgrInit=d;var e=function(){var b=a("#ix_wrapper > .ix-body > .container");b.html('<div class="jumbotron"><h1>这里是创建店铺页面</h1><p>创建店铺向导功能在这个入口实现</p></div>')};Hualala.Shop.CreateShopInit=e}(jQuery,window),function(a){IX.ns("Hualala.Setting");var b=(Hualala.UI.PopoverMsgTip,Hualala.UI.TopTip,{advanceTime:{type:"combo",label:"用户提前预订时间",defaultVal:0,prefix:"$",surfix:"元",options:Hualala.TypeDef.MinuteIntervalOptions(),validCfg:{validators:{notEmpty:{message:"用户提前预订时间不能为空"}}}},noticeTime:{type:"combo",label:"订单提前通知时间",defaultVal:0,options:Hualala.TypeDef.MinuteIntervalOptions(),validCfg:{validators:{notEmpty:{message:"订单提前通知时间不能为空"}}}},minAmount:{type:"text",label:"最低消费金额",prefix:"￥",surfix:"元",defaultVal:0,validCfg:{validators:{notEmpty:{message:"最低消费金额不能为空"},numeric:{message:"最低消费金额必须为数字"},greaterThan:{inclusive:!0,value:0,message:"最低消费金额必须大于或等于0"}}}},serviceAmount:{type:"text",label:"服务费",prefix:"￥",surfix:"元",defaultVal:0,validCfg:{validators:{numeric:{message:"服务费必须为数字"},greaterThan:{inclusive:!0,value:0,message:"服务费必须大于或等于0"}}}},freeServiceAmount:{type:"text",label:"免服务费菜品金额",prefix:"￥",surfix:"元",defaultVal:0,validCfg:{validators:{numeric:{message:"免服务费菜品金额必须为数字"},greaterThan:{inclusive:!0,value:0,message:"免服务费菜品金额必须大于或等于0"}}}},holidayFlag:{type:"combo",label:"节假日开放",defaultVal:0,options:Hualala.TypeDef.HolidayFlagOptions,validCfg:{validators:{notEmpty:{message:"节假日开放不能为空"}}}},openDays:{type:"text",label:"开放服务天数",surfix:"天",defaultVal:"",validCfg:{validators:{notEmpty:{message:"开放服务天数不能为空"},digits:{message:"开放服务天数必须为数字"},greaterThan:{inclusive:!0,value:0,message:"开放服务天数必须大于或等于0"}}}},servicePeriods:{type:"section",label:"开放时段",min:{type:"timepicker",surfix:'<span class="glyphicon glyphicon-time"></span>',defaultVal:"",validCfg:{group:".min-input",validators:{notEmpty:{message:"起始时间不能为空"}}}},max:{type:"timepicker",surfix:'<span class="glyphicon glyphicon-time"></span>',defaultVal:"",validCfg:{group:".max-input",validators:{notEmpty:{message:"结束时间不能为空"}}}}},reserveTableTime:{type:"combo",label:"留位时间",defaultVal:0,options:Hualala.TypeDef.MinuteIntervalOptions(60),validCfg:{validators:{notEmpty:{message:"留位时间不能为空"},numeric:{message:"留位时间必须为数字"},greaterThan:{inclusive:!0,value:0,message:"留位时间必须大于或等于0"}}}},reserveTableDesc:{type:"text",label:"留位特别说明",defaultVal:"",validCfg:{validators:{stringLength:{max:40,message:"留位特别说明不能超过40个字"}}}},takeawayDeliveryAgent:{type:"text",label:"配送单位",defaultVal:"自助配送",validCfg:{}},takeawayDeliveryTime:{type:"text",label:"预计送餐所需时间",surfix:"分钟",defaultVal:"",validCfg:{validators:{notEmpty:{message:"预计送餐所需时间不能为空"},numeric:{message:"预计送餐所需时间必须为数字"},greaterThan:{inclusive:!0,value:0,message:"预计送餐所需时间必须大于或等于0"}}}},takeawayScope:{type:"text",label:"送餐范围",surfix:"公里",defaultVal:"",validCfg:{validators:{notEmpty:{message:"送餐范围不能为空"},numeric:{message:"送餐范围必须为数字"},greaterThan:{inclusive:!0,value:0,message:"送餐范围必须大于或等于0"}}}},takeawayScopeDesc:{type:"text",label:"送餐范围说明",defaultVal:"",validCfg:{validators:{stringLength:{max:200,message:"送餐范围说明不能超过200个字"}}}},submitSMSTemplateID:{type:"hidden",defaultVal:""},checkSMSTemplateID:{type:"hidden",defaultVal:""},payMethod:{type:"combo",label:"可选支付方式",defaultVal:0,options:Hualala.TypeDef.PayMethodOptions,validCfg:{validators:{notEmpty:{message:"可选支付方式不能为空"}}}},needInputTableName:{type:"switcher",label:"下单时输入桌号",defaultVal:1,onLabel:"需要",offLabel:"不需要",validCfg:{validators:{notEmpty:{message:"下单时输入桌号不能为空"}}}},supportInvoice:{type:"switcher",label:"提供发票",defaultVal:1,onLabel:"需要",offLabel:"不需要",validCfg:{validators:{notEmpty:{message:"提供发票不能为空"}}}},supportCommitToSoftware:{type:"switcher",label:"下单到餐饮软件",defaultVal:1,onLabel:"支持",offLabel:"不支持",validCfg:{validators:{notEmpty:{message:"下单到餐饮软件不能为空"}}}},payMethodAtShop:{type:"combo",label:"店内支付方式",defaultVal:0,options:Hualala.TypeDef.PayMethodAtShopOptions,validCfg:{validators:{notEmpty:{message:"店内支付方式不能为空"}}}},payBeforeCommit:{type:"switcher",label:"支付完成后能下单",defaultVal:1,onLabel:"支持",offLabel:"不支持",validCfg:{validators:{notEmpty:{message:"支付完成后能下单不能为空"}}}},fetchFoodMode:{type:"combo",label:"取餐模式",defaultVal:0,options:Hualala.TypeDef.FetchFoodModeOptions,validCfg:{validators:{notEmpty:{message:"取餐模式不能为空"}}}}}),c=new IX.IListManager;_.each(b,function(a,b){var d=$XP(a,"type"),e="col-sm-offset-1 col-sm-3 control-label";if("section"==d){var f=minID=b+"_min_"+IX.id(),g=b+"_max_"+IX.id(),h=b+"_min",i=b+"_max",j=IX.inherit($XP(a,"min",{}),{id:minID,name:h,clz:"col-sm-3"}),k=IX.inherit($XP(a,"max",{}),{id:g,name:i,clz:"col-sm-3"});c.register(b,IX.inherit(a,{id:f,labelClz:e,min:j,max:k}))}else c.register(b,IX.inherit(a,{id:b+"_"+IX.id(),name:b,labelClz:e,clz:"col-sm-5"}))});var d=Stapes.subclass({constructor:function(a){if(this.$trigger=$XP(a,"triggerEl"),this.serviceID=$XP(a,"serviceID",null),this.serviceName=$XP(a,"serviceName",null),this.model=$XP(a,"model",null),this.serviceList=Hualala.TypeDef.ShopBusiness,this.modal=null,!this.serviceID||!this.serviceName||!this.model)throw"Service View init failed!";if(this.loadTemplates(),this.serviceInfo=this.getServiceInfo("id",this.serviceID),this.callServer=$XP(this.serviceInfo,"callServer",""),IX.isFn(this.callServer))this.callServer=this.callServer;else{if(!IX.isString(this.callServer))throw"Configuration failed : Invalid Page Initialized for "+name;IX.nsExisted(this.callServer)&&(this.callServer=IX.getNS(this.callServer))}this.formParams=$XP(this.model.get("revParamJson"),this.serviceID),this.initModal(),this.renderForm(),this.bindEvent(),this.emit("show")}});d.proto({loadTemplates:function(){var a=Handlebars.compile(Hualala.TplLib.get("tpl_shop_service_form_layout")),b=Handlebars.compile(Hualala.TplLib.get("tpl_shop_modal_btns"));Handlebars.registerHelper("checkFormElementType",function(a,b){return a==b.hash.type?b.fn(this):b.inverse(this)}),Handlebars.registerHelper("isInputGroup",function(a,b,c){return a||b?c.fn(this):c.inverse(this)}),this.set({layoutTpl:a,btnTpl:b})},initModal:function(){var a=this;a.modal=new Hualala.UI.ModalDialog({id:"service_edit",clz:"service-modal",title:a.getModalTitle(),afterRemove:function(){}})},initSwitcher:function(b){var c=this;c.modal._.body.find(b).each(function(){var b=a(this),c=b.attr("data-onLabel"),d=b.attr("data-offLabel");b.bootstrapSwitch({size:"normal",onColor:"primary",offColor:"default",onText:c,offText:d})})},initTimePicker:function(a){var b=this;b.modal._.body.find(a).timepicker({minuteStep:30,showSeconds:!1,showMeridian:!1,disableFocus:!0,showInputs:!1})},getServiceInfo:function(a,b){return _.find(this.serviceList,function(c){return c[a]==b})},getModalTitle:function(){return $XP(this.serviceInfo,"label")+"配置"},bindEvent:function(){var b=this,c=b.initValidFieldOpts();this.on({show:function(){this.modal.show()},hide:function(){this.modal.hide()}}),b.modal._.dialog.find(".btn").on("click",function(){var c=a(this),d=c.attr("name");if("cancel"==d)b.emit("hide");else{var e=b.modal._.body.find("form").data("bootstrapValidator");c.button("提交中..."),e.validate()}}),b.modal._.body.find("form").bootstrapValidator({trigger:"blur",fields:c}).on("error.field.bv",function(b){{var c=a(b.target);c.data("bootstrapValidator")}}).on("success.form.bv",function(c){c.preventDefault();var d=a(c.target),e=(d.data("bootstrapValidator"),b.serializeForm());console.info(e),b.model.emit("setServiceParams",{callServer:b.callServer,params:e,serviceID:b.serviceID,failFn:function(){b.modal._.footer.find(".btn[name=submit]").button("reset")},successFn:function(){b.modal._.footer.find(".btn[name=submit]").button("reset"),b.emit("hide")}})})},decodeTimeStr:function(a){return 0==a.length?"":a.substr(0,2)+":"+a.substr(2)},encodeTimeStr:function(a,b){return(a+","+b).replace(/\:/g,"")},mapServiceFormElsData:function(){var a=this,b=$XP(a.serviceInfo,"formKeys","").split(","),d=_.map(b,function(b){var d=c.get(b),e=$XP(d,"type");if("section"==e&&"servicePeriods"==b){var f=$XP(a.formParams,b,"").split(",");return f=_.map(f,function(b){return a.decodeTimeStr(b)}),IX.inherit(d,{min:IX.inherit($XP(d,"min"),{value:f[0]||$XP(d,"min.defaultVal")}),max:IX.inherit($XP(d,"max"),{value:f[1]||$XP(d,"max.defaultVal")})})}if("combo"==e){var f=$XP(a.formParams,b,$XP(d,"defaultVal")),g=_.map($XP(d,"options"),function(a){return IX.inherit(a,{selected:$XP(a,"value")==f?"selected":""})});return IX.inherit(d,{value:$XP(a.formParams,b,$XP(d,"defaultVal")),options:g})}return"switcher"==e?IX.inherit(d,{checked:$XP(a.formParams,b)==$XP(d,"defaultVal")?"checked":""}):IX.inherit(d,{value:$XP(a.formParams,b,$XP(d,"defaultVal"))})});return console.info(d),d},renderForm:function(){var a=this,b=(a.initValidFieldOpts(),a.mapServiceFormElsData()),c=a.get("layoutTpl"),d=a.get("btnTpl"),e=c({formClz:"shop-service-form",items:b});a.modal._.body.html(e),a.modal._.footer.html(d({btns:[{clz:"btn-default",name:"cancel",label:"取消"},{clz:"btn-warning",name:"submit",label:"保存"}]})),a.initSwitcher(":checkbox[data-type=switcher]"),a.initTimePicker("[data-type=timepicker]")},serializeForm:function(){{var b=this,d=$XP(b.serviceInfo,"formKeys","").split(","),e={};_.map(d,function(d){var f=c.get(d),g=$XP(f,"type");if("section"==g&&"servicePeriods"==d){var h=a("[name="+d+"_min]").val(),i=a("[name="+d+"_max]").val();e[d]=b.encodeTimeStr(h,i)}else e[d]="switcher"==g?a("[name="+d+"]").attr("checked")?1:0:a("[name="+d+"]").val()})}return e},initValidFieldOpts:function(){var a=this,b=$XP(a.serviceInfo,"formKeys","").split(","),d={};return _.each(b,function(a){var b=c.get(a),e=$XP(b,"type");if("section"==e){var f=a+"_min",g=a+"_max";d[f]=$XP(b,"min.validCfg",{}),d[g]=$XP(b,"max.validCfg",{})}else d[a]=$XP(b,"validCfg",{})}),d}}),Hualala.Setting.editServiceView=d}(jQuery,window),function(a){IX.ns("Hualala.Setting");var b=function(){{var b=a("#ix_wrapper > .ix-body > .container");new Hualala.Shop.QueryController({needShopCreate:!1,container:b,resultController:new Hualala.Shop.ShopListController({container:b,model:new Hualala.Shop.CardListModel({callServer:Hualala.Global.queryShop}),view:new Hualala.Shop.ShopListView})})}};Hualala.Setting.ShopMgrInit=b}(jQuery,window),function(a){function b(){var b=Hualala.Common.Browser,c=$XP(b,"ie",null)?!0:!1,d=parseInt($XP(b,"ie",0)),e=1==IX.Cookie.get("allowOldVersion")?!0:!1;if(!c||e)return!0;if(d>8)return!0;var f=8==d?"您使用的IE浏览器版本过于陈旧，可能无法获得我们为您提供的良好的用户体验。<br/>我们建议您使用以下的浏览器或插件进行访问！":"您使用的IE浏览器版本过于陈旧，无法使用我们为您提供的管理功能。<br/>请您使用以下提供的浏览器进行访问！",g=[{href:"",icon:"",name:"IE10",desc:"IE10浏览器是微软公司出品的现代浏览器，已经支持大部分HTML5，CSS3特性"},{href:"",icon:"",name:"IE11",desc:"IE11浏览器是微软公司出品的现代浏览器，已经支持绝大部分HTML5，CSS3特性"},{href:"",icon:"",name:"Chrome",desc:"Chrome浏览器是谷歌公司退出的现代浏览器，完全支持HTML5，CSS3标准的特性，具有更快的浏览网页速度。"},{href:"",icon:"",name:"Firefox",desc:"FireFox是Mozilla推出的现代浏览器，完全支持HTML5，CSS3标准的特性。"}],h=Handlebars.compile(Hualala.TplLib.get("tpl_site_browserSupport")),i=a(h({msg:f,items:g}));
return a("body > #ix_wrapper").remove(),i.appendTo(a("body")),i.find(".btn").click(function(){IX.Cookie.set("allowOldVersion",1),Hualala.Router.check()}),!1}function c(){var c=Hualala.getSessionData(),d=Handlebars.compile(Hualala.TplLib.get("tpl_site_layout")),e=$XP(Hualala.getSessionUser(),"loginName",null)?!0:!1,f=$XP(c,"user.loginName",""),g=$XP(c,"site.groupName",""),h=function(){var a={pcClientPath:Hualala.PageRoute.createPath("pcclient"),hualalaUrl:Hualala.Global.HualalaWebSite,loginName:f,merchantRoot:Hualala.PageRoute.createPath("main"),groupName:g,isLogin:e,logoutPath:Hualala.Global.getLogoutJumpToUrl(),logo:Hualala.Global.getDefaultImage("logo")},b={aboutPath:Hualala.PageRoute.createPath("about")||"#",contactPath:Hualala.PageRoute.createPath("contact")||"#",gozapLogo:Hualala.Global.getDefaultImage("gozap")};return{header:a,footer:b}},i=a(d(h()));a("body > #ix_wrapper").remove(),b()&&i.appendTo(a("body")),a.fn.bootstrapValidator&&(a.fn.bootstrapValidator.DEFAULT_OPTIONS=a.extend({},a.fn.bootstrapValidator.DEFAULT_OPTIONS,{message:"您输入的数据有误，请核对后再次输入",trigger:"blur",feedbackIcons:{valid:"glyphicon glyphicon-ok",invalid:"glyphicon glyphicon-remove",validating:"glyphicon glyphicon-refresh"}}))}function d(){var b=(Hualala.getSessionData(),Handlebars.compile(Hualala.TplLib.get("tpl_site_navbar"))),c=Handlebars.compile(Hualala.TplLib.get("tpl_site_navbarToggle")),d=function(){var a=_.map(Hualala.TypeDef.SiteNavType,function(a){return{active:Hualala.Global.isCurrentPage(a.name)?"active":"",disabled:"",path:Hualala.PageRoute.createPath(a.name)||"#",name:a.name,label:a.label}});return{items:a}},e=a(b(d())),f=a(c({target:"#site_navbar"})),g=a("#ix_wrapper .ix-header");g.find("> .container .navbar-collapse").remove(),g.find("> .container").append(e),g.find("> .container > .navbar-header .navbar-toggle").remove(),g.find("> .container > .navbar-header").prepend(f)}function e(){var b=(Hualala.getSessionSite(),Hualala.getSessionUser(),Hualala.getSessionRoles(),Hualala.getSessionPCClient(),Hualala.getSessionUserRight()),c=a("#ix_wrapper > .ix-body > .container"),d=function(){var a=new IX.IListManager,c=null;return IX.iterate(b,function(b){a.register(b.name,b)}),c=_.map(g,function(b){var c=$XP(b,"name"),d=a.get(c)?!0:!1;return IX.inherit(b,{itemClz:$XP(b,"itemClz","")+" "+(d?"":"disabled")})})},e=Handlebars.compile(Hualala.TplLib.get("tpl_site_homepage")),f=a(e({bricks:d()}));c.html(f),f.on("mouseenter mouseleave click",".brick-item",function(b){var c=a(this),d=c.attr("data-pagename"),e=b.type;return c.hasClass("disabled")?!1:void("click"==e?document.location.href=Hualala.PageRoute.createPath(d):c.toggleClass("hover"))})}function f(){var b=Handlebars.compile(Hualala.TplLib.get("tpl_site_login")),c=a(b({bannerImg:Hualala.Global.getDefaultImage("loginBanner")})),d=a("#ix_wrapper > .ix-body > .container");d.html(c),Hualala.Entry.initLogin(c)}IX.ns("Hualala.Common");var g=[{name:"account",title:"结算",label:"提现.账户设置.结算报表",brickClz:"home-brick-md-2",itemClz:"brick-item brick-item-2",icon:"ficon-pay"},{name:"order",title:"订单",label:"报表.菜品排行",brickClz:"home-brick-md-3",itemClz:"brick-item",icon:"ficon-order"},{name:"shop",title:"店铺管理",label:"开店.信息.菜谱",brickClz:"home-brick-md-1",itemClz:"brick-item",icon:"ficon-home"},{name:"pcclient",title:"下载哗啦啦",label:"",brickClz:"home-brick-md-1",itemClz:"brick-item",icon:"ficon-download"},{name:"user",title:"账号管理",label:"账号.权限",brickClz:"home-brick-md-1",itemClz:"brick-item",icon:"ficon-lock"},{name:"setting",title:"业务设置",label:"开通业务.业务参数",brickClz:"home-brick-md-2",itemClz:"brick-item",icon:"ficon-setting"}];Hualala.Common.LoginInit=f,Hualala.Common.initPageLayout=c,Hualala.Common.initSiteNavBar=d,Hualala.Common.HomePageInit=e}(jQuery,window),function(a){function b(a,b){if(!$XP(a,"user",null))throw"Permission Deny!!";e=a,b()}function c(a){var c=IX.getTimeInMS();log("Merchant Sys INIT : "+c),Hualala.Global.loadAppData({},function(d){if(log("Load Merchant APP Data in (ms): "+(IX.getTimeInMS()-c)),0!=$XP(d,"resultcode"))throw document.location.href=Hualala.PageRoute.createPath("login"),"Session Data Load Faild!! resultcode = "+$XP(d,"resultcode","")+"; resultMsg = "+$XP(d,"resultmsg","");b($XP(d,"data",{}),function(){log("Merchant Sys INIT DONE in (ms): "+(IX.getTimeInMS()-c)),a()})})}function d(){IX.nsExisted("Hualala.ajaxEngine.init")&&(a.ajaxSetup({beforeSend:function(b){b.setRequestHeader("X-CSRF-Token",a('meta[name="csrf-token"]').attr("content"))}}),Hualala.ajaxEngine.init({ajaxFn:jQuery.ajax,baseUrl:Hualala.Global.HOME,commonUrl:Hualala.Global.CommonSite,imgUrl:Hualala.Global.IMAGE_ROOT}))}IX.ns("Hualala");var e=null;Hualala.getSessionData=function(){return e},Hualala.getSessionSite=function(){return $XP(e,"site",null)},Hualala.getSessionUser=function(){return $XP(e,"user",null)},Hualala.getSessionRoles=function(){return $XP(e,"roles",[])},Hualala.getSessionPCClient=function(){return $XP(e,"pcClient",null)},Hualala.getSessionUserRight=function(){return $XP(e,"userRight",[])},Hualala.isSessionUser=function(a,b){var c=$XP(e,"user.groupLoginName")+$XP(e,"user.loginName");return e&&c==a+b};var f=!1;Hualala.init=function(){f||(d(),Hualala.PageRoute.start(function(a){var b="main,pcclient,about,contact,login",d=_.filter(b.split(","),function(a){return"main"!=a}).join(",");return d.indexOf(a)>=0?(Hualala.Common.initPageLayout({},a),void(b.indexOf(a)<0&&Hualala.Common.initSiteNavBar(a))):void c(function(){Hualala.Common.initPageLayout({},a),b.indexOf(a)<0&&Hualala.Common.initSiteNavBar(a)})}),f=!0)}}(jQuery,window),function(){function a(a,b,c){var d=a.match(c);if(d){var e=d.shift(),g=e.split("/");g=_.map(g,function(a){var b=_.indexOf(e,a);return b>-1?"_":a}),g.push(""),g.unshift("");var h=g.join("_");f[h]=b}}function b(a,b){var c=e[a];if(!c)return console.err("Can't find route : "+a);var d=$XP(c,"path"),f=$XP(c,"reg"),g=d.match(f),h=function(a){return Hualala.Global.HOME+a};return!g||g.length<1?console.err("The Path of Route ("+a+") is wrong!!"):1==g.length?h(d):g.length>1&&IX.isArray(b)&&g.length-1==b.length?(g.shift(),_.each(g,function(a,c){d=d.replace(a,b[c])}),h(d)):void 0}IX.ns("Hualala.PageRoute");var c=Hualala.Router,d=(Hualala.Global.Route,!1),e={},f={},g=function(){function a(a){if(!IX.isFn(IX.getNS(a)))return!1;for(var b=f.get(a),c=IX.getNS(a),d=0;d<b.length;d++)e[b[d]].init=c;return f.remove(a),!0}function b(){return g=IX.loop(g,[],function(b,c){return a(c)||b.push(c),b}),0==g.length}function c(){g=IX.Array.toSet(g),IX.checkReady(b,IX.emptyFn,40,{maxAge:15e3,expire:function(){alert("Can't find page inializor : \n"+g.join("\n"))}})}function d(a,b){var c=null;if(IX.isFn(b))c=b;else{if(!IX.isString(b))throw"Configuration failed : Invalid Page Initialized for "+a;IX.nsExisted(b)&&(c=IX.getNS(b))}return IX.isFn(c)?e[a].init=c:(f.put(b,a),void g.push(b))}var f=new IX.I1ToNManager,g=[];return{start:function(){setTimeout(c,1)},detect:d}}(),h=[{name:"login",path:"/#login",reg:/login$/,bodyClz:"",PageInitiator:"Hualala.Common.LoginInit"},{name:"main",path:"/#home",reg:/home$/,bodyClz:"",PageInitiator:"Hualala.Common.HomePageInit"},{name:"shop",path:"/#shop",reg:/shop$/,bodyClz:"",PageInitiator:"Hualala.Shop.HomePageInit"},{name:"shopCreate",path:"/#shop/create",reg:/shop\/create$/,bodyClz:"",PageInitiator:"Hualala.Shop.CreateShopInit"},{name:"shopInfo",path:"/#shop/{id}/info",reg:/shop\/(.*)\/info$/,bodyClz:"",PageInitiator:"Hualala.Shop.BaseInfoMgrInit"},{name:"shopMenu",path:"/#shop/{id}/menu",reg:/shop\/(.*)\/menu$/,bodyClz:"",PageInitiator:"Hualala.Shop.FoodMenuMgrInit"},{name:"setting",path:"/#setting",reg:/setting$/,bodyClz:"",PageInitiator:"Hualala.Setting.ShopMgrInit"},{name:"account",path:"/#account",reg:/account$/,bodyClz:"",PageInitiator:"Hualala.Account.AccountListInit"},{name:"accountDetail",path:"/#account/{id}/detail",reg:/account\/(.*)\/detail$/,bodyClz:"",PageInitiator:"Hualala.Account.AccountMgrInit"},{name:"user",path:"/#user",reg:/user$/,bodyClz:"",PageInitiator:"Hualala.User.UserListInit"},{name:"order",path:"/#order",reg:/order$/,bodyClz:"",PageInitiator:"Hualala.Order.OrderChartInit"},{name:"pcclient",path:"/#download",reg:/download$/,bodyClz:"",PageInitiator:"Hualala.Common.PCClientDownloadInit"},{name:"about",path:"/#about",reg:/about$/,bodyClz:"",PageInitiator:"Hualala.Common.AboutInit"},{name:"contact",path:"/#contact",reg:/contact$/,bodyClz:"",PageInitiator:"Hualala.Common.ContactInit"}];IX.iterate(h,function(b){var c=IX.inherit({bodyClz:"ix-minor",path:""},b),d=$XP(b,"name"),f=$XP(b,"path"),h=$XP(b,"reg");a(f,d,h),e[d]={name:d,bodyClz:$XP(c,"bodyClz",""),path:f,reg:$XP(c,"reg",null)};var i="PageInitiator"in c?c.PageInitiator:null;IX.isString(i)||IX.isFn(i)||(i=IX.emptyFn),g.detect(d,i)}),g.start(),Hualala.PageRoute.start=function(a){d=!0,c.flush().config({mode:"history",root:Hualala.Global.HOME}),_.each(e,function(b,d){var e=$XP(b,"reg"),f=$XF(b,"init"),g=null;g=function(b){console.info("INFO: Init Page :"+d),IX.isFn(a)&&a(d),console.info("Load Page :"+d),console.info("arguments is :"+b),f&&f.apply(null,[d,b])},c.add(e,g)}),c.listen().check()},Hualala.PageRoute.createPath=b,Hualala.PageRoute.getCurrentPath=function(){return location.hash},Hualala.PageRoute.getPageContextByPath=function(a){var b=a||Hualala.Router.getFragment(),c=_.filter(e,function(a){return!!b.match(a.reg)}),d=null;return 0==c.length?null:1==c.length?(d=b.match(c[0].reg),d.shift(),IX.inherit({params:d},c[0])):(c=_.filter(c,function(a){return"index"!=a.name}),d=b.match(c[c.length-1].reg),d.shift(),IX.inherit({params:d},c[c.length-1]))}}(jQuery,window);
//# sourceMappingURL=pages.min.map